[{"path":"index.html","id":"前言","chapter":"前言","heading":"前言","text":"本书为 Modelling Survival Data Medical Research 4th Edition, David Collett 的翻译。翻译的目的有二：现有的生存分析中文专著屈指可数，其中能与原书在内容的广度和深度方面对标的数量为 \\(\\log1\\)；在人类彻底被 AI 取代之前，或至少翻译的工作被 AI 取代之前，或至少专著翻译的工作被 AI 取代之前，译者希望能有所贡献。可以说，对于那些愿意付出必要努力来为生存数据适当建模的研究者，本书是难得的宝藏。“routine statistical questions, questionable statistical routines.” - D. R. Cox可点击带 \\(\\blacktriangleright\\) 的标题以展开图表，例如\n排版说明：由于第 3 章和第 5 章篇幅较长、公式较多，为减少渲染时间，已将这两章划分为两个页面。尽管如此，每次打开页面仍需加载一段时间；丰富的示例贯穿全书，为方便跳转，示例均给出了交叉引用；图表一般都在上下文中，不给出交叉引用；对于所跨章节较多的图表，会在上下文中重复给出；为保持阅读的连贯性，图表均已折叠（如上面的封面图片）。阅读提示：左侧为“章”的导航栏，右侧为各章中“节”的导航栏；左上角的搜索框一般需要两个字及以上的关键词才会显示结果（例如搜索“风”不显示结果，而搜索“风险”会给出结果），原因不详；本书给出了丰富的超链接，为方便对照阅读，可按住 Ctrl 后点击超链接以打开新的标签页。水平不足，能力有限。Email: 1210683652@qq.com","code":""},{"path":"index.html","id":"原书前言","chapter":"前言","heading":"原书前言","text":"本书描述并说明了使用来自生物医学研究的各种例子对生存数据进行分析的建模方法。我在介绍这一主题的多场讲座和课程（包括入门和高级水平）方面的经验，以及在提供生存数据分析建议方面的经验，对其内容产生了重大影响。最终呈现的是一本关于中等水平生存分析的全面实用的书，我希望它将继续满足制药行业和生物医学研究中心的统计学家、分析自己数据的科学家和临床医生，以及攻读本科或研究生生存分析课程的学生们的需求。本版有一个关于贝叶斯生存分析的新章节，以反映这种方法越来越受欢迎。鉴于现代统计方法实施的计算机软件资源越来越丰富，其他章节已被改写或广泛修订。具体来说，对关于参数模型的第 5 章进行了修订，并在新的第 6 章中描述了基于样条的风险和累积风险函数的参数模型。已重写关于区间删失生存数据的第 9 章，以提供分析这类数据的现代方法。此外，还纳入了有关评估拟合模型的预测能力、纵向和生存数据的联合建模以及分段指数模型的新内容。R 软件现在广泛用于生存数据的分析，这不仅是因为该软件能跟上统计发展，还因为它对所有人都是免费开放的。新增的最后一章展示了如何使用 R 软件实现本书中所述的方法，并指导读者如何解读输出结果，以及如何将这些结果与前面章节使用的示例进行对照理解。本书的主要部分由第 1 章到第 7 章组成。在第 1 章中介绍了生存分析之后，第 2 章描述了总结生存数据和比较两组或两组以上生存时间的方法。第 3 章介绍了建模方法，其中详细介绍了 Cox 回归模型。接下来的一章介绍了检查拟合模型的充分性的方法。第 5 章介绍了参数比例风险模型和加速失效时间模型。在第 6 章关于灵活参数模型之后，第 7 章介绍了参数模型的模型检查诊断。其余章节描述了基本模型的一些扩展。第 8 章介绍了时依变量的使用，第 9 章考虑了区间删失数据的分析。第 10 章介绍了脆弱模型，以允许使用随机效应对个体或个体组之间的差异进行建模。第 11 章总结了在无法做出比例风险假设时可以使用的技术，并展示了如何使用这些模型来比较多个机构的生存结局。第 12 章介绍了包含不同死因的竞争风险模型，而第 13 章则描述了 Cox 回归模型的扩展，以应对相同或不同类型的多次事件，包括事件历史分析。第 14 章总结了当存在相依删失时分析数据的方法，第 15 章介绍了如何确定以生存时间为结果变量的研究的样本量要求。第 16 章和第 17 章分别介绍了贝叶斯方法和 R 软件的使用。每一章都包含足够的方法细节，以便读者对技术和它们所基于的假设有深入的理解，并帮助读者调整方法来处理非标准问题。前面几章中的一些例子是基于较少的观测数据构建的，这比通常的生物医学研究项目要少。这使得分析方法更容易被阐明，同时也方便将表格形式的结果展示与从计算机软件获得的输出结果进行对比。附录中给出了一些额外的数据集，可用于更全面地理解方法论，或作为学生练习。本书中使用的所有数据集均可以电子形式从出版商的网站 https://www.routledge.com 获取。（译者注：具体链接为这里）在撰写本书时，我假定读者具有统计方法的基本知识，并且对线性回归分析有一定的了解。有时会使用矩阵代数，但了解线性代数并不是必要条件。每章末尾都给出了参考书目说明和延伸阅读的建议，但为了不中断流程，文本本身的参考文献已保持在最低限度。我感谢已故的 Doug Altman, James Gallagher, Alan Kimber, Sandro Leidi, Mike Patefield, Anne Whitehead 和 John Whitehead 在准备本书当前版本和早期版本时提供的帮助，并感谢 NHS 血液和移植部门的允许在许多示例中使用来自英国移植登记处的数据。我特别感谢所有不厌其烦地告诉我早期版本中的错误的人。尽管这些内容已得到纠正，但我很高兴获悉本版本中的任何进一步错误、歧义和遗漏：d.collett@btinternet.com。最后，我要感谢我的妻子 Janet 在本书写作期间的支持和鼓励。David CollettOctober 2022","code":""},{"path":"作者介绍.html","id":"作者介绍","chapter":"作者介绍","heading":"作者介绍","text":"David Collett 在 University Leicester 获得其首个学位，之后在 University Newcastle 获得了统计学硕士学位，在 University Hull 获得了统计学博士学位。David 在 University Reading 应用统计学系担任讲师和高级讲师超过 25 年，其中 8 年担任该系主任。2003 年，他被任命为英国国家医疗服务体系血液与移植部 (NHS Blood Transplant) 统计与临床研究副主任。这包括监督 30 多名工作人员的统计工作，以及与移植临床医生和研究科学家的合作。David 后来成为 NHS Blood Transplant 临床试验部主任，负责移植和输血医学临床试验的设计、实施和分析。他在退休前担任 Southampton Statistical Sciences Research Institute,\nUniversity Southampton 客座主席。他现在喜欢呆在高尔夫球场上。","code":""},{"path":"目录.html","id":"目录","chapter":"目录","heading":"目录","text":"生存分析\n1.1 生存分析的应用\n1.2 生存数据的特殊特征\n1.2.1 删失\n1.2.2 独立删失\n1.2.3 研究时间和患者时间\n\n1.3 一些示例\n1.4 生存函数，风险函数和累积风险函数\n1.4.1 生存函数\n1.4.2 风险函数\n1.4.3 累积风险函数\n\n1.5 用于生存分析的计算机软件\n1.6 延伸阅读\n1.1 生存分析的应用1.2 生存数据的特殊特征\n1.2.1 删失\n1.2.2 独立删失\n1.2.3 研究时间和患者时间\n1.2.1 删失1.2.2 独立删失1.2.3 研究时间和患者时间1.3 一些示例1.4 生存函数，风险函数和累积风险函数\n1.4.1 生存函数\n1.4.2 风险函数\n1.4.3 累积风险函数\n1.4.1 生存函数1.4.2 风险函数1.4.3 累积风险函数1.5 用于生存分析的计算机软件1.6 延伸阅读一些非参数程序\n2.1 估计生存函数\n2.1.1 生存函数的生命表估计\n2.1.2 生存函数的 Kaplan-Meier 估计\n2.1.3 生存函数的 Nelson-Aalen 估计\n\n2.2 生存函数估计的标准误\n2.2.1 Kaplan-Meier 估计的标准误\n2.2.2 其他估计的标准误\n2.2.3 生存函数的置信区间\n\n2.3 估计风险函数\n2.3.1 风险函数的生命表估计\n2.3.2 Kaplan-Meier 型估计\n2.3.3 估计累积风险函数\n\n2.4 估计生存时间的中位数和百分位数\n2.5 中位数和百分位数的置信区间\n2.6 两组生存数据的比较\n2.6.1 两组生存数据的比较\n2.6.2 log-rank 检验\n2.6.3 Wilcoxon 检验\n2.6.4 Peto-Peto 检验\n2.6.5 log-rank 检验、Wilcoxon 检验和 Peto-Peto 检验的比较\n\n2.7 三组或更多组生存数据的比较\n2.8 分层检验\n2.9 log-rank 趋势检验\n2.10 延伸阅读\n2.1 估计生存函数\n2.1.1 生存函数的生命表估计\n2.1.2 生存函数的 Kaplan-Meier 估计\n2.1.3 生存函数的 Nelson-Aalen 估计\n2.1.1 生存函数的生命表估计2.1.2 生存函数的 Kaplan-Meier 估计2.1.3 生存函数的 Nelson-Aalen 估计2.2 生存函数估计的标准误\n2.2.1 Kaplan-Meier 估计的标准误\n2.2.2 其他估计的标准误\n2.2.3 生存函数的置信区间\n2.2.1 Kaplan-Meier 估计的标准误2.2.2 其他估计的标准误2.2.3 生存函数的置信区间2.3 估计风险函数\n2.3.1 风险函数的生命表估计\n2.3.2 Kaplan-Meier 型估计\n2.3.3 估计累积风险函数\n2.3.1 风险函数的生命表估计2.3.2 Kaplan-Meier 型估计2.3.3 估计累积风险函数2.4 估计生存时间的中位数和百分位数2.5 中位数和百分位数的置信区间2.6 两组生存数据的比较\n2.6.1 两组生存数据的比较\n2.6.2 log-rank 检验\n2.6.3 Wilcoxon 检验\n2.6.4 Peto-Peto 检验\n2.6.5 log-rank 检验、Wilcoxon 检验和 Peto-Peto 检验的比较\n2.6.1 两组生存数据的比较2.6.2 log-rank 检验2.6.3 Wilcoxon 检验2.6.4 Peto-Peto 检验2.6.5 log-rank 检验、Wilcoxon 检验和 Peto-Peto 检验的比较2.7 三组或更多组生存数据的比较2.8 分层检验2.9 log-rank 趋势检验2.10 延伸阅读Cox 回归模型\n3.1 风险函数建模\n3.1.1 用于两组比较的模型\n3.1.2 一般比例风险模型\n\n3.2 模型的线性部分\n3.2.1 纳入一个变量\n3.2.2 纳入一个因素\n3.2.3 纳入一个交互作用\n3.2.4 纳入一个混合项\n\n3.3 拟合 Cox 回归模型\n3.3.1 模型的似然函数\n3.3.2 结的处理\n3.3.3 Newton-Raphson 程序\n\n3.4 置信区间和假设检验\n3.4.1 风险比的标准误和置信区间\n3.4.2 两个示例\n\n3.5 比较替代模型\n3.5.1 \\(-2\\log\\hat{L}\\) 统计量\n3.5.2 比较嵌套模型\n\n3.6 模型选择策略\n3.6.1 变量选择程序\n\n3.7 使用 lasso 进行变量选择\n3.7.1 Cox 回归中的 lasso\n3.7.2 数据准备\n\n3.8 非线性项\n3.8.1 非线性检验\n3.8.2 非线性建模\n3.8.3 分数多项式\n\n3.9 参数估计的解释\n3.9.1 具有一个变量的模型\n3.9.2 估计风险函数和生存函数\n\n3.10 参数估计的解释\n3.10.1 无协变量的特例\n3.10.2 基线函数估计的一些近似\n\n3.11 风险调整的生存函数\n3.11.1 分组风险调整的生存函数\n\n3.12 一致性，预测能力和解释的变异\n3.12.1 一致性的度量\n3.12.2 预测能力\n3.12.3 Cox 回归模型解释的变异\n3.12.4 解释的变异的度量\n3.12.5 模型验证\n\n3.13 时依 ROC 曲线\n3.13.1 灵敏度和特异度\n3.13.2 疾病概率建模\n3.13.3 ROC 曲线\n3.13.4 时依 ROC 曲线\n\n3.14 比例风险建模和 log-rank 检验\n3.15 延伸阅读\n3.1 风险函数建模\n3.1.1 用于两组比较的模型\n3.1.2 一般比例风险模型\n3.1.1 用于两组比较的模型3.1.2 一般比例风险模型3.2 模型的线性部分\n3.2.1 纳入一个变量\n3.2.2 纳入一个因素\n3.2.3 纳入一个交互作用\n3.2.4 纳入一个混合项\n3.2.1 纳入一个变量3.2.2 纳入一个因素3.2.3 纳入一个交互作用3.2.4 纳入一个混合项3.3 拟合 Cox 回归模型\n3.3.1 模型的似然函数\n3.3.2 结的处理\n3.3.3 Newton-Raphson 程序\n3.3.1 模型的似然函数3.3.2 结的处理3.3.3 Newton-Raphson 程序3.4 置信区间和假设检验\n3.4.1 风险比的标准误和置信区间\n3.4.2 两个示例\n3.4.1 风险比的标准误和置信区间3.4.2 两个示例3.5 比较替代模型\n3.5.1 \\(-2\\log\\hat{L}\\) 统计量\n3.5.2 比较嵌套模型\n3.5.1 \\(-2\\log\\hat{L}\\) 统计量3.5.2 比较嵌套模型3.6 模型选择策略\n3.6.1 变量选择程序\n3.6.1 变量选择程序3.7 使用 lasso 进行变量选择\n3.7.1 Cox 回归中的 lasso\n3.7.2 数据准备\n3.7.1 Cox 回归中的 lasso3.7.2 数据准备3.8 非线性项\n3.8.1 非线性检验\n3.8.2 非线性建模\n3.8.3 分数多项式\n3.8.1 非线性检验3.8.2 非线性建模3.8.3 分数多项式3.9 参数估计的解释\n3.9.1 具有一个变量的模型\n3.9.2 估计风险函数和生存函数\n3.9.1 具有一个变量的模型3.9.2 估计风险函数和生存函数3.10 参数估计的解释\n3.10.1 无协变量的特例\n3.10.2 基线函数估计的一些近似\n3.10.1 无协变量的特例3.10.2 基线函数估计的一些近似3.11 风险调整的生存函数\n3.11.1 分组风险调整的生存函数\n3.11.1 分组风险调整的生存函数3.12 一致性，预测能力和解释的变异\n3.12.1 一致性的度量\n3.12.2 预测能力\n3.12.3 Cox 回归模型解释的变异\n3.12.4 解释的变异的度量\n3.12.5 模型验证\n3.12.1 一致性的度量3.12.2 预测能力3.12.3 Cox 回归模型解释的变异3.12.4 解释的变异的度量3.12.5 模型验证3.13 时依 ROC 曲线\n3.13.1 灵敏度和特异度\n3.13.2 疾病概率建模\n3.13.3 ROC 曲线\n3.13.4 时依 ROC 曲线\n3.13.1 灵敏度和特异度3.13.2 疾病概率建模3.13.3 ROC 曲线3.13.4 时依 ROC 曲线3.14 比例风险建模和 log-rank 检验3.15 延伸阅读Cox 回归模型的模型检查\n4.1 Cox 回归模型的残差\n4.1.1 Cox-Snell 残差\n4.1.2 修正的 Cox-Snell 残差\n4.1.3 鞅残差\n4.1.4 偏差残差\n4.1.5 Schoenfeld 残差\n4.1.6 得分残差\n\n4.2 模型拟合的评估\n4.2.1 基于 Cox-Snell 残差的图形\n4.2.2 基于鞅残差和偏差残差的图形\n4.2.3 检查协变量的函数形式\n\n4.3 识别有影响的观测\n4.3.1 观测对单个参数估计的影响\n4.3.2 观测对参数估计集的影响\n4.3.3 有影响观测的处理\n\n4.4 检验比例风险假设\n4.4.1 对数累积风险图\n4.4.2 使用 Schoenfeld 残差\n4.4.3 非比例风险的检验\n4.4.4 添加时依变量\n\n4.5 建议\n4.6 延伸阅读\n4.1 Cox 回归模型的残差\n4.1.1 Cox-Snell 残差\n4.1.2 修正的 Cox-Snell 残差\n4.1.3 鞅残差\n4.1.4 偏差残差\n4.1.5 Schoenfeld 残差\n4.1.6 得分残差\n4.1.1 Cox-Snell 残差4.1.2 修正的 Cox-Snell 残差4.1.3 鞅残差4.1.4 偏差残差4.1.5 Schoenfeld 残差4.1.6 得分残差4.2 模型拟合的评估\n4.2.1 基于 Cox-Snell 残差的图形\n4.2.2 基于鞅残差和偏差残差的图形\n4.2.3 检查协变量的函数形式\n4.2.1 基于 Cox-Snell 残差的图形4.2.2 基于鞅残差和偏差残差的图形4.2.3 检查协变量的函数形式4.3 识别有影响的观测\n4.3.1 观测对单个参数估计的影响\n4.3.2 观测对参数估计集的影响\n4.3.3 有影响观测的处理\n4.3.1 观测对单个参数估计的影响4.3.2 观测对参数估计集的影响4.3.3 有影响观测的处理4.4 检验比例风险假设\n4.4.1 对数累积风险图\n4.4.2 使用 Schoenfeld 残差\n4.4.3 非比例风险的检验\n4.4.4 添加时依变量\n4.4.1 对数累积风险图4.4.2 使用 Schoenfeld 残差4.4.3 非比例风险的检验4.4.4 添加时依变量4.5 建议4.6 延伸阅读参数回归模型\n5.1 风险函数的模型\n5.1.1 指数分布\n5.1.2 Weibull 分布\n5.1.3 log-logistic 分布\n5.1.4 log-logistic 分布\n5.1.5 Gompertz 分布\n5.1.6 逆高斯分布\n5.1.7 gamma 分布\n5.1.8 一些其他分布\n\n5.2 评估参数模型的适用性\n5.3 为单样本拟合参数模型\n5.3.1 随机删失数据的似然函数\n\n5.4 拟合指数和 Weibull 模型\n5.4.1 拟合指数分布\n5.4.2 拟合 Weibull 分布\n5.4.3 Weibull 分布百分位数的标准误\n\n5.5 用于两组比较的 Weibull 模型\n5.5.1 探索性分析\n5.5.2 拟合模型\n\n5.6 Weibull 比例风险模型\n5.6.1 拟合模型\n5.6.2 Weibull 模型百分位数的标准误\n5.6.3 模型的对数线性形式\n5.6.4 探索性分析\n\n5.7 比较替代的 Weibull 比例风险模型\n5.8 Gompertz 比例风险模型\n5.9 模型选择\n5.10 用于两组比较的加速失效时间模型\n5.10.1 与比例风险模型的比较\n5.10.2 百分位-百分位图\n\n5.11 用于两组比较的加速失效时间模型\n5.11.1 加速失效时间模型的对数线性形式\n\n5.12 参数加速失效时间模型\n5.12.1 Weibull 加速失效时间模型\n5.12.2 log-logistic 加速失效时间模型\n5.12.3 log-normal 加速失效时间模型\n\n5.13 拟合并比较加速失效时间模型\n5.14 参数模型中解释的变异的度量\n5.14.1 参数模型的预测能力\n\n5.15 比例几率模型\n5.15.1 log-logistic 比例几率模型\n\n5.16 治愈率建模\n5.17 协变量调整的影响\n5.18 延伸阅读\n5.1 风险函数的模型\n5.1.1 指数分布\n5.1.2 Weibull 分布\n5.1.3 log-logistic 分布\n5.1.4 log-logistic 分布\n5.1.5 Gompertz 分布\n5.1.6 逆高斯分布\n5.1.7 gamma 分布\n5.1.8 一些其他分布\n5.1.1 指数分布5.1.2 Weibull 分布5.1.3 log-logistic 分布5.1.4 log-logistic 分布5.1.5 Gompertz 分布5.1.6 逆高斯分布5.1.7 gamma 分布5.1.8 一些其他分布5.2 评估参数模型的适用性5.3 为单样本拟合参数模型\n5.3.1 随机删失数据的似然函数\n5.3.1 随机删失数据的似然函数5.4 拟合指数和 Weibull 模型\n5.4.1 拟合指数分布\n5.4.2 拟合 Weibull 分布\n5.4.3 Weibull 分布百分位数的标准误\n5.4.1 拟合指数分布5.4.2 拟合 Weibull 分布5.4.3 Weibull 分布百分位数的标准误5.5 用于两组比较的 Weibull 模型\n5.5.1 探索性分析\n5.5.2 拟合模型\n5.5.1 探索性分析5.5.2 拟合模型5.6 Weibull 比例风险模型\n5.6.1 拟合模型\n5.6.2 Weibull 模型百分位数的标准误\n5.6.3 模型的对数线性形式\n5.6.4 探索性分析\n5.6.1 拟合模型5.6.2 Weibull 模型百分位数的标准误5.6.3 模型的对数线性形式5.6.4 探索性分析5.7 比较替代的 Weibull 比例风险模型5.8 Gompertz 比例风险模型5.9 模型选择5.10 用于两组比较的加速失效时间模型\n5.10.1 与比例风险模型的比较\n5.10.2 百分位-百分位图\n5.10.1 与比例风险模型的比较5.10.2 百分位-百分位图5.11 用于两组比较的加速失效时间模型\n5.11.1 加速失效时间模型的对数线性形式\n5.11.1 加速失效时间模型的对数线性形式5.12 参数加速失效时间模型\n5.12.1 Weibull 加速失效时间模型\n5.12.2 log-logistic 加速失效时间模型\n5.12.3 log-normal 加速失效时间模型\n5.12.1 Weibull 加速失效时间模型5.12.2 log-logistic 加速失效时间模型5.12.3 log-normal 加速失效时间模型5.13 拟合并比较加速失效时间模型5.14 参数模型中解释的变异的度量\n5.14.1 参数模型的预测能力\n5.14.1 参数模型的预测能力5.15 比例几率模型\n5.15.1 log-logistic 比例几率模型\n5.15.1 log-logistic 比例几率模型5.16 治愈率建模5.17 协变量调整的影响5.18 延伸阅读灵活的参数模型\n6.1 分段指数模型\n6.2 使用样条函数建模\n6.2.1 B 样条\n6.2.2 限制性立方样条\n6.2.3 结数和位置\n\n6.3 风险函数的灵活模型\n6.4 对数累积风险函数的灵活模型\n6.5 灵活的比例几率模型\n6.6 延伸阅读\n6.1 分段指数模型6.2 使用样条函数建模\n6.2.1 B 样条\n6.2.2 限制性立方样条\n6.2.3 结数和位置\n6.2.1 B 样条6.2.2 限制性立方样条6.2.3 结数和位置6.3 风险函数的灵活模型6.4 对数累积风险函数的灵活模型6.5 灵活的比例几率模型6.6 延伸阅读参数模型的模型检查\n7.1 参数模型的残差\n7.1.1 标准化残差\n7.1.2 Cox-Snell 残差\n7.1.3 鞅残差\n7.1.4 偏差残差\n7.1.5 得分残差\n\n7.2 特定参数模型的残差\n7.2.1 Weibull 分布\n7.2.2 log-logistic 分布\n7.2.3 log-normal 分布\n7.2.4 残差分析\n\n7.3 比较观测的和拟合的生存函数\n7.4 识别有影响的观测\n7.4.1 观测对单个参数估计的影响\n7.4.2 观测对参数估计集的影响\n\n7.5 检验 Weibull 模型的比例风险\n7.6 延伸阅读\n7.1 参数模型的残差\n7.1.1 标准化残差\n7.1.2 Cox-Snell 残差\n7.1.3 鞅残差\n7.1.4 偏差残差\n7.1.5 得分残差\n7.1.1 标准化残差7.1.2 Cox-Snell 残差7.1.3 鞅残差7.1.4 偏差残差7.1.5 得分残差7.2 特定参数模型的残差\n7.2.1 Weibull 分布\n7.2.2 log-logistic 分布\n7.2.3 log-normal 分布\n7.2.4 残差分析\n7.2.1 Weibull 分布7.2.2 log-logistic 分布7.2.3 log-normal 分布7.2.4 残差分析7.3 比较观测的和拟合的生存函数7.4 识别有影响的观测\n7.4.1 观测对单个参数估计的影响\n7.4.2 观测对参数估计集的影响\n7.4.1 观测对单个参数估计的影响7.4.2 观测对参数估计集的影响7.5 检验 Weibull 模型的比例风险7.6 延伸阅读时依变量\n8.1 时依变量的类型\n8.1.1 时依系数\n\n8.2 时依变量的建模\n8.2.1 拟合含时依变量的模型\n\n8.3 时依变量的编码\n8.4 累积风险函数和生存函数的估计\n8.5 模型比较和验证\n8.5.1 治疗的比较\n8.5.2 评估模型的充分性\n\n8.6 时依变量的一些应用\n8.6.1 一些例子\n\n8.7 纵向数据和生存数据的联合建模\n8.7.1 纵向建模\n8.7.2 联合模型\n8.7.3 联合模型的一些扩展\n\n8.8 延伸阅读\n8.1 时依变量的类型\n8.1.1 时依系数\n8.1.1 时依系数8.2 时依变量的建模\n8.2.1 拟合含时依变量的模型\n8.2.1 拟合含时依变量的模型8.3 时依变量的编码8.4 累积风险函数和生存函数的估计8.5 模型比较和验证\n8.5.1 治疗的比较\n8.5.2 评估模型的充分性\n8.5.1 治疗的比较8.5.2 评估模型的充分性8.6 时依变量的一些应用\n8.6.1 一些例子\n8.6.1 一些例子8.7 纵向数据和生存数据的联合建模\n8.7.1 纵向建模\n8.7.2 联合模型\n8.7.3 联合模型的一些扩展\n8.7.1 纵向建模8.7.2 联合模型8.7.3 联合模型的一些扩展8.8 延伸阅读区间删失生存数据\n9.1 区间删失\n9.1.1 当前状态数据\n\n9.2 估计生存函数\n9.2.1 生存函数估计的推导\n\n9.3 半参数比例风险模型\n9.3.1 半参数 Turnbull 模型\n9.3.2 区间删失数据的分段指数模型\n\n9.4 参数模型\n9.5 延伸阅读\n9.1 区间删失\n9.1.1 当前状态数据\n9.1.1 当前状态数据9.2 估计生存函数\n9.2.1 生存函数估计的推导\n9.2.1 生存函数估计的推导9.3 半参数比例风险模型\n9.3.1 半参数 Turnbull 模型\n9.3.2 区间删失数据的分段指数模型\n9.3.1 半参数 Turnbull 模型9.3.2 区间删失数据的分段指数模型9.4 参数模型9.5 延伸阅读脆弱模型\n10.1 脆弱性的介绍\n10.1.1 随机效应\n10.1.2 个体脆弱性\n10.1.3 共享脆弱性\n\n10.2 个体脆弱性建模\n10.2.1 脆弱性分布\n10.2.2 可观测生存函数和风险函数\n\n10.3 gamma 脆弱性分布\n10.3.1 脆弱性对可观测风险函数的影响\n10.3.2 脆弱性对可观测风险比的影响\n\n10.4 拟合参数脆弱模型\n10.4.1 gamma 脆弱性\n\n10.5 拟合半参数脆弱模型\n10.5.1 lognormal 脆弱效应\n10.5.2 gamma 脆弱效应\n\n10.6 比较带脆弱性的模型\n10.6.1 脆弱性存在的检验\n\n10.7 共享脆弱模型\n10.7.1 拟合共享脆弱模型\n10.7.2 比较共享脆弱模型\n\n10.8 脆弱建模的其他方面\n10.8.1 模型检查\n10.8.2 相关脆弱模型\n10.8.3 依赖性度量\n10.8.4 模型拟合中的数值问题\n\n10.9 延伸阅读\n10.1 脆弱性的介绍\n10.1.1 随机效应\n10.1.2 个体脆弱性\n10.1.3 共享脆弱性\n10.1.1 随机效应10.1.2 个体脆弱性10.1.3 共享脆弱性10.2 个体脆弱性建模\n10.2.1 脆弱性分布\n10.2.2 可观测生存函数和风险函数\n10.2.1 脆弱性分布10.2.2 可观测生存函数和风险函数10.3 gamma 脆弱性分布\n10.3.1 脆弱性对可观测风险函数的影响\n10.3.2 脆弱性对可观测风险比的影响\n10.3.1 脆弱性对可观测风险函数的影响10.3.2 脆弱性对可观测风险比的影响10.4 拟合参数脆弱模型\n10.4.1 gamma 脆弱性\n10.4.1 gamma 脆弱性10.5 拟合半参数脆弱模型\n10.5.1 lognormal 脆弱效应\n10.5.2 gamma 脆弱效应\n10.5.1 lognormal 脆弱效应10.5.2 gamma 脆弱效应10.6 比较带脆弱性的模型\n10.6.1 脆弱性存在的检验\n10.6.1 脆弱性存在的检验10.7 共享脆弱模型\n10.7.1 拟合共享脆弱模型\n10.7.2 比较共享脆弱模型\n10.7.1 拟合共享脆弱模型10.7.2 比较共享脆弱模型10.8 脆弱建模的其他方面\n10.8.1 模型检查\n10.8.2 相关脆弱模型\n10.8.3 依赖性度量\n10.8.4 模型拟合中的数值问题\n10.8.1 模型检查10.8.2 相关脆弱模型10.8.3 依赖性度量10.8.4 模型拟合中的数值问题10.9 延伸阅读非比例风险和机构的比较\n11.1 非比例风险\n11.1.1 对给定时间的事件概率建模\n\n11.2 分层比例风险模型\n11.2.1 治疗之间的非比例风险\n\n11.3 限制性平均生存\n11.3.1 伪值的使用\n\n11.4 机构的比较\n11.4.1 \\(RAFR\\) 的区间估计\n11.4.2 泊松回归模型的使用\n11.4.3 随机机构效应\n\n11.5 延伸阅读\n11.1 非比例风险\n11.1.1 对给定时间的事件概率建模\n11.1.1 对给定时间的事件概率建模11.2 分层比例风险模型\n11.2.1 治疗之间的非比例风险\n11.2.1 治疗之间的非比例风险11.3 限制性平均生存\n11.3.1 伪值的使用\n11.3.1 伪值的使用11.4 机构的比较\n11.4.1 \\(RAFR\\) 的区间估计\n11.4.2 泊松回归模型的使用\n11.4.3 随机机构效应\n11.4.1 \\(RAFR\\) 的区间估计11.4.2 泊松回归模型的使用11.4.3 随机机构效应11.5 延伸阅读竞争风险\n12.1 竞争风险的介绍\n12.2 总结竞争风险数据\n12.2.1 生存函数的 Kaplan-Meier 估计\n\n12.3 风险和累积发生率函数\n12.3.1 原因别风险函数\n12.3.2 原因别累计发生率函数\n12.3.3 关注的其他函数\n\n12.4 原因别风险建模\n12.4.1 竞争风险模型的似然函数\n12.4.2 累积发生率函数的参数模型\n\n12.5 原因别发生率建模\n12.5.1 Fine Gray 竞争风险模型\n\n12.6 模型检查\n12.7 延伸阅读\n12.1 竞争风险的介绍12.2 总结竞争风险数据\n12.2.1 生存函数的 Kaplan-Meier 估计\n12.2.1 生存函数的 Kaplan-Meier 估计12.3 风险和累积发生率函数\n12.3.1 原因别风险函数\n12.3.2 原因别累计发生率函数\n12.3.3 关注的其他函数\n12.3.1 原因别风险函数12.3.2 原因别累计发生率函数12.3.3 关注的其他函数12.4 原因别风险建模\n12.4.1 竞争风险模型的似然函数\n12.4.2 累积发生率函数的参数模型\n12.4.1 竞争风险模型的似然函数12.4.2 累积发生率函数的参数模型12.5 原因别发生率建模\n12.5.1 Fine Gray 竞争风险模型\n12.5.1 Fine Gray 竞争风险模型12.6 模型检查12.7 延伸阅读多次事件和事件史分析\n13.1 计数过程的介绍\n13.1.1 强度函数建模\n13.1.2 作为计数过程的生存数据\n13.1.3 方差-协方差阵的稳健估计\n\n13.2 复发事件建模\n13.2.1 Anderson Gill 模型\n13.2.2 Prentice, Williams, Peterson 模型\n\n13.3 多种事件\n13.3.1 Wei, Lin Weissfeld 模型\n\n13.4 事件史分析\n13.4.1 事件史分析模型\n\n13.5 延伸阅读\n13.1 计数过程的介绍\n13.1.1 强度函数建模\n13.1.2 作为计数过程的生存数据\n13.1.3 方差-协方差阵的稳健估计\n13.1.1 强度函数建模13.1.2 作为计数过程的生存数据13.1.3 方差-协方差阵的稳健估计13.2 复发事件建模\n13.2.1 Anderson Gill 模型\n13.2.2 Prentice, Williams, Peterson 模型\n13.2.1 Anderson Gill 模型13.2.2 Prentice, Williams, Peterson 模型13.3 多种事件\n13.3.1 Wei, Lin Weissfeld 模型\n13.3.1 Wei, Lin Weissfeld 模型13.4 事件史分析\n13.4.1 事件史分析模型\n13.4.1 事件史分析模型13.5 延伸阅读相依删失\n14.1 识别相依删失\n14.2 对相依删失的敏感性\n14.2.1 敏感性分析\n14.2.2 相依删失的影响\n\n14.3 相依删失建模\n14.3.1 相依删失的 Cox 回归模型\n\n14.4 延伸阅读\n14.1 识别相依删失14.2 对相依删失的敏感性\n14.2.1 敏感性分析\n14.2.2 相依删失的影响\n14.2.1 敏感性分析14.2.2 相依删失的影响14.3 相依删失建模\n14.3.1 相依删失的 Cox 回归模型\n14.3.1 相依删失的 Cox 回归模型14.4 延伸阅读生存研究的样本量要求\n15.1 区分两个治疗组\n15.2 计算所需的死亡人数\n15.2.1 所需死亡人数的推导\n\n15.3 计算所需的患者人数\n15.1 区分两个治疗组15.2 计算所需的死亡人数\n15.2.1 所需死亡人数的推导\n15.2.1 所需死亡人数的推导15.3 计算所需的患者人数贝叶斯生存分析\n16.1 贝叶斯定理\n16.2 贝叶斯推断\n16.3 生存数据的贝叶斯模型\n16.3.1 简单指数模型的贝叶斯版本\n\n16.4 纳入先验信息\n16.4.1 无信息先验信息\n16.4.2 模糊先验信息\n16.4.3 实质的先验信息\n\n16.5 总结后验信息\n16.5.1 点估计\n16.5.2 区间估计\n16.5.3 贝叶斯假设检验\n\n16.6 计算后验分布\n16.6.1 拒绝采样\n16.6.2 使用 MCMC 从后验分布中采样\n\n16.7 预测分布\n16.8 贝叶斯模型比较\n16.8.1 用于比较模型的 DIC 统计量\n16.8.2 用于比较模型的 WAIC 统计量\n\n16.9 注释\n16.10 延伸阅读\n16.1 贝叶斯定理16.2 贝叶斯推断16.3 生存数据的贝叶斯模型\n16.3.1 简单指数模型的贝叶斯版本\n16.3.1 简单指数模型的贝叶斯版本16.4 纳入先验信息\n16.4.1 无信息先验信息\n16.4.2 模糊先验信息\n16.4.3 实质的先验信息\n16.4.1 无信息先验信息16.4.2 模糊先验信息16.4.3 实质的先验信息16.5 总结后验信息\n16.5.1 点估计\n16.5.2 区间估计\n16.5.3 贝叶斯假设检验\n16.5.1 点估计16.5.2 区间估计16.5.3 贝叶斯假设检验16.6 计算后验分布\n16.6.1 拒绝采样\n16.6.2 使用 MCMC 从后验分布中采样\n16.6.1 拒绝采样16.6.2 使用 MCMC 从后验分布中采样16.7 预测分布16.8 贝叶斯模型比较\n16.8.1 用于比较模型的 DIC 统计量\n16.8.2 用于比较模型的 WAIC 统计量\n16.8.1 用于比较模型的 DIC 统计量16.8.2 用于比较模型的 WAIC 统计量16.9 注释16.10 延伸阅读使用 R 进行生存分析\n17.1 R 的介绍\n17.2 数据输入和编辑\n17.2.1 从文件中读取和操作数据\n17.2.2 R 包\n\n17.3 非参数程序\n17.4 Cox 回归模型\n17.4.1 变量选择和 lasso\n17.4.2 预测能力和解释的变异的度量\n17.4.3 时依 ROC 曲线\n\n17.5 Cox 回归模型中的模型检查\n17.5.1 残差分析\n17.5.2 识别有影响的观测\n17.5.3 检验比例风险假设\n\n17.6 参数生存模型\n17.7 灵活的参数模型\n17.7.1 分段指数模型\n17.7.2 风险函数的模型\n17.7.3 对数累积风险函数的模型\n\n17.8 参数模型中的模型检查\n17.8.1 有影响的值\n17.8.2 比较观测的和拟合的生存函数\n\n17.9 时依变量\n17.9.1 时变系数\n17.9.2 纵向数据和生存数据的联合建模\n\n17.10 区间删失数据\n17.10.1 生存函数的非参数最大似然估计\n17.10.2 区间删失数据的半参数模型\n17.10.3 区间删失数据的参数模型\n\n17.11 脆弱模型\n17.11.1 拟合具有个体脆弱性的参数脆弱模型\n17.11.2 拟合具有共享脆弱性的参数脆弱模型\n17.11.3 拟合具有个体 lognormal 脆弱性的半参数模型\n17.11.4 拟合具有个体 gamma 脆弱性的半参数模型\n17.11.5 拟合具有共享脆弱性的半参数模型\n\n17.12 竞争风险\n17.12.1 原因别的风险函数的估计和建模\n17.12.2 估计累计发生率函数\n17.12.3 累积发生率的 Fine Gray 模型\n\n17.13 多次事件和事件历史建模\n17.14 相依删失\n17.15 贝叶斯生存分析\n17.15.1 贝叶斯参数建模\n17.15.2 贝叶斯半参数建模\n17.15.3 风险函数的灵活模型\n\n17.16 延伸阅读\n17.1 R 的介绍17.2 数据输入和编辑\n17.2.1 从文件中读取和操作数据\n17.2.2 R 包\n17.2.1 从文件中读取和操作数据17.2.2 R 包17.3 非参数程序17.4 Cox 回归模型\n17.4.1 变量选择和 lasso\n17.4.2 预测能力和解释的变异的度量\n17.4.3 时依 ROC 曲线\n17.4.1 变量选择和 lasso17.4.2 预测能力和解释的变异的度量17.4.3 时依 ROC 曲线17.5 Cox 回归模型中的模型检查\n17.5.1 残差分析\n17.5.2 识别有影响的观测\n17.5.3 检验比例风险假设\n17.5.1 残差分析17.5.2 识别有影响的观测17.5.3 检验比例风险假设17.6 参数生存模型17.7 灵活的参数模型\n17.7.1 分段指数模型\n17.7.2 风险函数的模型\n17.7.3 对数累积风险函数的模型\n17.7.1 分段指数模型17.7.2 风险函数的模型17.7.3 对数累积风险函数的模型17.8 参数模型中的模型检查\n17.8.1 有影响的值\n17.8.2 比较观测的和拟合的生存函数\n17.8.1 有影响的值17.8.2 比较观测的和拟合的生存函数17.9 时依变量\n17.9.1 时变系数\n17.9.2 纵向数据和生存数据的联合建模\n17.9.1 时变系数17.9.2 纵向数据和生存数据的联合建模17.10 区间删失数据\n17.10.1 生存函数的非参数最大似然估计\n17.10.2 区间删失数据的半参数模型\n17.10.3 区间删失数据的参数模型\n17.10.1 生存函数的非参数最大似然估计17.10.2 区间删失数据的半参数模型17.10.3 区间删失数据的参数模型17.11 脆弱模型\n17.11.1 拟合具有个体脆弱性的参数脆弱模型\n17.11.2 拟合具有共享脆弱性的参数脆弱模型\n17.11.3 拟合具有个体 lognormal 脆弱性的半参数模型\n17.11.4 拟合具有个体 gamma 脆弱性的半参数模型\n17.11.5 拟合具有共享脆弱性的半参数模型\n17.11.1 拟合具有个体脆弱性的参数脆弱模型17.11.2 拟合具有共享脆弱性的参数脆弱模型17.11.3 拟合具有个体 lognormal 脆弱性的半参数模型17.11.4 拟合具有个体 gamma 脆弱性的半参数模型17.11.5 拟合具有共享脆弱性的半参数模型17.12 竞争风险\n17.12.1 原因别的风险函数的估计和建模\n17.12.2 估计累计发生率函数\n17.12.3 累积发生率的 Fine Gray 模型\n17.12.1 原因别的风险函数的估计和建模17.12.2 估计累计发生率函数17.12.3 累积发生率的 Fine Gray 模型17.13 多次事件和事件历史建模17.14 相依删失17.15 贝叶斯生存分析\n17.15.1 贝叶斯参数建模\n17.15.2 贝叶斯半参数建模\n17.15.3 风险函数的灵活模型\n17.15.1 贝叶斯参数建模17.15.2 贝叶斯半参数建模17.15.3 风险函数的灵活模型17.16 延伸阅读附录 最大似然估计\n.1 关于单个未知参数的推断\n.2 关于未知参数向量的推断\n.1 关于单个未知参数的推断A.2 关于未知参数向量的推断附录 B 额外数据集\nB.1 慢性活动性肝炎\nB.2 膀胱癌的复发\nB.3 黑鸭的生存\nB.4 骨髓移植\nB.5 慢性肉芽肿病\nB.1 慢性活动性肝炎B.2 膀胱癌的复发B.3 黑鸭的生存B.4 骨髓移植B.5 慢性肉芽肿病参考书目","code":""},{"path":"chap1.html","id":"chap1","chapter":"第 1 章 生存分析","heading":"第 1 章 生存分析","text":"生存分析 (survival analysis) 是一种分析数据的术语，该数据以时间为形式，用于描述从定义明确的时间起点 (time origin) 到某个特定事件或终点的发生。在医学研究中，时间起点通常对应于将个体招募到实验研究中，例如比较两种或多种治疗的临床试验。这又可能与特定疾病的诊断、治疗方案的开始或某些不良事件的发生相吻合。如果终点是患者的死亡，那么得出的数据就是实际的生存时间。然而，当终点不是致命的，例如疼痛减轻或症状复发时，也可以获得类似形式的数据。","code":""},{"path":"chap1.html","id":"sec1-1","chapter":"第 1 章 生存分析","heading":"1.1 生存分析的应用","text":"这本书的重点是生物医学中事件发生时间 (time--event) 数据的分析，在生物医学中，生存分析这一术语被广泛使用，即使终点不是死亡。然而，同样的技术也可用于许多其他应用领域，在这些领域中，它们被不同地称为事件历史分析 (event history analysis)、持续时间分析 (duration analysis)、转移分析 (transition analysis)、可靠性分析 (reliability analysis) 或失效时间建模 (failure-time modelling) 。生存分析在许多领域有所应用，本节概述了其中的一些。在犯罪学中，获释的囚犯可能会继续犯罪，从获释到随后犯罪的时间就是生存时间。这里，由于可能犯下的罪行不同，可能存在多种终点。对不同罪行发生时间及其影响因素的比较，将有助于对释放到社区的罪犯进行辅导。该领域的其他应用还包括犯罪生涯的持续时间、从犯罪到随后被捕的时间以及假释的持续时间。在工程学中，从器械（如洗碗机或洗衣机）出现机械问题到该器械再次正常工作的这段时间，对于维护客户满意度至关重要。有些物品可能无法修复，因此无法记录修复时间。同时，调查与维修时间相关的因素也很重要，比如物品的使用年限、使用程度以及保养状况等。在实验性农业中，种子发芽的时间、植物发病的时间以及农作物收获的时间都是事件发生时间。通常有很多因素可能会影响这些持续时间，确定最重要的因素将使实践得以完善。例如，用除草剂处理一块土地后，化学品首次出现效果的时间就是生存时间，影响这一时间的因素可能有助于确定产品的特性。此时，很难记录除草剂出现效果的确切时间，只有在一定的时间段内才能知道是否产生了效果。在金融领域，从提交申请到获得批准，处理抵押贷款申请所需的时间产生了事件发生时间的数据。有些申请没有进行到终点，可能是因为房屋销售失败，或者申请人安排了其他资金来源。然而，这也可能是因为申请流程已经花费了很长时间，因此必须考虑这些因撤销申请而删失 (censored) 的时间。同样，一家公司偿还贷款所花费的时间也会产生生存数据，其中因贷款违约而产生的删失时间也包含在内。信贷公司可能非常关心诸如公司规模、年龄以及贷款规模等因素如何影响还款时间。在人力资源领域，雇主可能会调查在特定时间段内开始工作的员工的在职时长。在分析时，许多员工可能仍在工作，因此他们只能提供关于在职时间的部分信息。特别令人感兴趣的是影响在职期的因素，如初始工资、工资涨幅、员工的资质等。填补招聘职位所需的时间或首次晋升所需的时间都是该领域生存时间的进一步实例。在大型组织的不同部门之间，对这些事件发生时间的比较可能特别有助于识别好的管理规范。在市场营销领域，客户流失率是一个重要的业务指标，它指的是在特定时间段内停用公司产品或服务的客户比例。之所以这一指标如此重要，很大程度上是因为获取新客户的成本往往远高于留住现有客户的成本。生存分析在该领域有众多应用，例如客户离开公司的时间、取消服务协议的时间、升级产品（如 iPhone 或电脑）的时间，以及计算机软件或 iCloud 存储服务的订阅时长等。在所有这些情况下，客户流失的原因可能有很多，如服务不佳、产品质量低劣以及成本问题等。流失时间还可能取决于一些其他因素，比如客户是否是通过其他客户推荐获得的、客户在客服电话上花费的时间以及是否有优惠活动可用等。对这些因素对客户留存时间的影响进行分析，有助于公司了解如何留住客户。在政治学领域，在选举过程后组建政府的时间有时可能很短，但在其他情况下，各政党之间可能需要长时间的谈判。政府组建的延误可能会对政治或经济产生不利影响。研究相关因素，如参与谈判的政党数量、最大政党所占的多数席位以及各参与政党在意识形态上的冲突等，都有助于确定政府组建的时间。此外，在政治学领域，事件发生时间分析的其他应用还包括政治生涯的长度、内阁政府的任期以及美国参议员的任期。在国际关系领域，战争的持续时间、贸易协定的期限以及政府的任期等，都适用于生存分析的方法。在心理学领域，心理治疗疗程结束与行为发生临床显著变化之间的时间区间与潜在问题的治疗有关。例如，在治疗酒精滥用问题时，识别与戒酒所需时间相关的因素至关重要。这些因素可能包括家族酒精依赖史、社会经济地位、个性问题、在就业保障和维持方面的困难，以及个体交往对象的吸烟和饮酒习惯。识别导致戒酒的因素可能有助于相关患者的管理。本书的重点是生存分析在医学研究数据中的应用，因此，大部分一般性讨论将以个体患者从进入研究到死亡或其他终点的生存时间来表述。","code":""},{"path":"chap1.html","id":"sec1-2","chapter":"第 1 章 生存分析","heading":"1.2 生存数据的特殊特征","text":"我们必须首先考虑为什么生存数据不适用于数据分析中使用的标准统计程序。其中一个原因是生存数据通常不是对称分布的。通常，由一组相似个体的生存时间构建的直方图会倾向于正偏态分布，也就是说，直方图在包含最多观测的区间的右侧会有一个较长的“尾巴”。因此，假设这类数据具有正态分布是不合理的。这个问题可以通过首先对数据进行转换以获得更对称的分布来解决，例如取对数。然而，更好的方法是采用其他分布。生存数据的主要特征是生存时间经常是删失的 (censored)。这使得标准方法不适用。下一节将描述删失的具体内容。","code":""},{"path":"chap1.html","id":"sec1-2-1","chapter":"第 1 章 生存分析","heading":"1.2.1 删失","text":"个体的生存时间称为删失，是指对该个体而言，感兴趣的终点尚未观察到。这可能是因为研究的数据要在一些人还活着的时候进行分析。或者在分析时个体的生存状态可能未知，因为该个体已经失访 (lost follow-). 例如，假设某患者在被招募参加临床试验后，搬到国内的另一个地区或另一个国家，无法再追踪到。关于该患者的生存经历，唯一可获得的信息是他或她最后一次被确认存活的日期。这个日期可能是患者最后一次到诊所进行常规检查的日期。当已知死亡原因与治疗无关时，实际的生存时间也可视为删失。然而，很难确定患者的死亡是否与他正在接受的特定治疗有关。例如，考虑一位参加前列腺癌替代疗法临床试验的患者，他遭遇了致命的交通事故。这场事故可能是由于眩晕发作导致的，而眩晕可能是分配给该患者的治疗方案的副作用。如果是这样的话，那么死亡就与治疗有关。在这种情况下，所有原因导致的死亡的生存时间，或患者正在接受治疗的主要疾病以外的其他原因导致的死亡时间，也可能需要进行生存分析。在每种情况下，在时间 \\(t_0\\) 进入研究的患者在时间 \\(t_0+t\\) 死亡。然而，\\(t\\) 是未知的，要么是因为此人还活着，要么是由于他或她已失访。如果个体最后的已知生存时间为 \\(t_0+c\\)，则时间 \\(c\\) 称为删失生存时间 (censored survival time). 这种删失发生在个体进入研究之后，即最后已知生存时间的右侧，因此称为右删失 (right censoring). 右删失生存时间小于实际但未知的生存时间。研究观察期结束时发生的右删失通常称为行政删失 (administrative censoring).另一种形式的审查是左删失 (left censoring)，当个体的实际生存时间小于观测时间时就会遇到这种情况。考虑一项研究以说明这种形式的删失，该研究的兴趣集中在手术切除原发肿瘤后特定癌症的复发时间。术后三个月对患者进行检查以确定癌症是否复发，这时可能会发现部分患者出现了复发。对于此类患者，实际复发时间不到三个月，这些患者的复发时间是左删失。左删失的发生率远低于右删失，因此本书的重点将放在右删失生存数据的分析中。另一种类型的删失是区间删失 (interval censoring). 此时，已知个体在一段时间内经历过某个事件。再次考虑上述左删失讨论中使用的有关肿瘤复发时间的例子。如果患者在三个月后观察到疾病已痊愈，但在术后六个月检查时发现疾病复发，则该患者的实际复发时间在三个月至六个月之间。观测复发时间称为区间删失。我们将在第 9 章讨论区间删失。","code":""},{"path":"chap1.html","id":"sec1-2-2","chapter":"第 1 章 生存分析","heading":"1.2.2 独立删失","text":"在分析删失的生存数据时，一个重要的假设是，个体的实际生存时间 \\(t\\) 不依赖于任何导致该个体的生存时间在时间 \\(c\\) 删失的机制，其中 \\(c<t\\)。这种类型的删失称为独立删失或非信息性删失 (independent non-informative censoring). 这意味着，如果我们考虑一组具有相同相关预后变量值的个体，则生存时间在时间 \\(c\\) 处删失的个体必须代表该组中生存到该时间的所有其他个体。如果删失过程随机进行，则生存时间删失的患者将代表删失时处于风险中的患者。类似地，当要在日历时间中的预定点或在每个患者的时间起点之后的固定时间区间分析生存数据时，仍然活着的个体的预后可视为与删失独立，只要在检查数据之前指定分析时间即可。然而，如果个体的生存时间因身体状况恶化而停止治疗导致删失，则不能做出这一假设。此类删失称为相依删失或信息性删失 (dependent informative censoring). 本书中大多数章节介绍的生存分析方法仅在独立性删失的假设下才有效，但第 14 章将介绍能够考虑相依删失的技术。","code":""},{"path":"chap1.html","id":"sec1-2-3","chapter":"第 1 章 生存分析","heading":"1.2.3 研究时间和患者时间","text":"在典型的研究中，患者并非都在同一时间招募，而是在数月甚至数年的时间内陆续招募。招募完成后，将对患者进行跟踪调查，直至其去世，或者直至研究结束，此时将分析数据。尽管可以观察到一些患者的实际生存时间，但一些患者可能会在招募后失去联系，而其他患者在研究结束时可能仍然健在。个体参与研究的时间段称为研究时间 (study time).临床试验中八个人的研究时间如图 1.1 所示，其中进入研究的时间用“•”表示。该图显示，个体 1, 4, 5 和 8 在研究过程中死亡 (D)，个体 2 和 7 失访 (L)，个体 3 和 6 在观察期结束时仍然活着 ().就每个患者而言，试验在 \\(t_0\\) 开始。图 1.1 所示的八个个体的相应生存时间如图 1.2 所示。患者在研究中经历的时间段，从其时间起点开始测量，通常称为患者时间 (patient time). 从时间起点到患者死亡 (D) 的时间段即为生存时间，这是为个体 1, 4, 5 和 8 记录的。剩余个体的生存时间是右删失的 (C).\n在实践中，记录的实际数据将是每个个体进入研究的日期，以及每个个体死亡或最后已知存活的日期。然后可以计算生存时间，以天、周或月为单位，以最合适的为准。大多数用于生存分析的计算机软件包都可以根据日期形式的数据执行此类计算。","code":""},{"path":"chap1.html","id":"sec1-3","chapter":"第 1 章 生存分析","heading":"1.3 一些示例","text":"在本节中，通过许多示例说明生存数据的基本特征。这些示例中的数据将用于说明后续章节中介绍的一些统计技术。示例 1.1  (停用宫内节育器的时间) 在涉及避孕措施的试验中，预防怀孕是评估可接受性的一个明显标准。然而，现代避孕措施的失败率非常低，因此，诸如闭经（长期无出血）、不规则或延长出血等出血障碍的发生情况，在评估某种避孕方法时变得尤为重要。为了推动对分析避孕试验中女性月经出血数据方法的研究，世界卫生组织提供了涉及多种不同类型避孕方法的临床试验数据 (, 1987). 这些数据集的一部分涉及女性开始使用某种避孕方法到停用该方法的时间，如果已知停用原因，则记录停用原因。表 1.1 中的数据指的是从开始使用一种特定类型的宫内节育器 (intrauterine device, IUD)，称为 Multiload 250，到因月经出血问题而停用该设备所经历的周数。这些数据来自 18 名女性，她们的年龄都在 18 至 35 岁之间，且都有过两次怀孕经历。删失的停用时间用星号标记。\n在此示例中，时间起点对应于女性使用宫内节育器的第一天，终点是因出血问题导致的停用。研究中的一些女性因为想要怀孕或不再需要避孕药而停用宫内节育器，而其他女性则只是失访。这些原因导致了 13, 18, 23, 38, 54 和 56 周的删失停用时间。该研究方案要求记录每位女性的月经出血经历，为期两年。出于实际原因，每个女性在招募后两年内都无法接受检查以确定她们是否仍在使用宫内节育器，这就是为什么有 3 个停用时间大于 104 周的右删失时间。分析这些数据的一个目的是总结停用时间的分布。然后我们可能希望估计停用宫内节育器的中位时间，或者估计女性在特定时间段后停用该设备的概率。事实上，以时间为函数的这种估计概率图将为数据提供一个有用的总结。示例 1.2  (患乳腺癌妇女的预后) 乳腺癌是西方国家女性最常见的癌症形式之一。然而，肿瘤的生物学行为往往难以预测，许多研究集中在肿瘤是否可能已经转移或扩散到身体的其他器官。大约 80% 的原发性乳腺癌女性患者可能患有已经转移到其他部位的肿瘤。如果能确定这些患者，可以针对她们进行辅助治疗，而剩下的 20% 可以通过手术治愈。Middlesex Hospital 开展了一项调查，相关记录可见 Leathem Brooks (1987). 该调查旨在评估一种组织化学标志物，用以区分已经发生转移和未发生转移的原发性乳腺癌。研究中的标志物是一种来自罗马蜗牛 Helix pomatia 的白蛋白腺凝集素，即 Helix pomatia agglutinin (HPA). 这种标志物与发生局部淋巴结转移的乳腺癌细胞结合，而经 HPA 染色的细胞可以通过显微镜检查来识别。为了探究 HPA 染色是否可用于预测罹患乳腺癌女性的生存状况，研究者开展了一项回顾性研究，研究对象为接受乳腺癌手术治疗的女性的病历记录。对这些女性的肿瘤切片进行 HPA 处理，随后将每个肿瘤分为阳性染色和阴性染色，其中阳性染色表示肿瘤具有转移潜力。该研究于 1987 年 7 月结束，此时计算了死于乳腺癌的女性的生存时间。对于 1987 年 7 月时生存状态未知的女性，从手术日期到她们最后一次被确认存活的日期之间的时间视为删失生存时间。死于乳腺癌以外原因的女性的生存时间也视为右删失。表 1.2 中的数据指的是 1969 年 1 月至 1971 年 12 月期间接受单纯或根治性乳房切除术治疗的 II 级、III 级或 IV 级肿瘤的女性的生存月数。在表中，每位女性的生存时间根据其肿瘤是否为阳性染色进行分类。\n在分析这项研究的数据时，我们特别感兴趣的是，这两组女性的生存经历是否存在差异。如果有证据表明，那些 HPA 染色阴性的女性在术后往往比那些染色阳性的女性活得更长，我们将得出结论，癌症患者的预后取决于染色程序的结果。示例 1.3  (多发性骨髓瘤患者的生存率) 多发性骨髓瘤是一种恶性疾病，其特征是异常浆细胞（一种白细胞）在骨髓中积聚。骨内异常浆细胞的增殖导致疼痛和骨组织的破坏。多发性骨髓瘤患者也会出现贫血、出血、反复感染和虚弱。这种情况总是致命的，除非接受治疗。Medical Center University West Virginia, USA 进行了一项研究，其目的是检验某些解释变量或协变量的值与患者生存时间之间的关系。在这项研究中，主要响应变量是多发性骨髓瘤从诊断到死亡的时间，以月为单位。表 1.3 中的数据来自 Krall, Uthoff Harley (1975)，涉及 48 名患者，他们的年龄都在 50 至 80 岁之间。到研究完成时，部分患者还未死亡，因此他们的生存时间是右删失的。表中个体生存状态的编码规则为：0 表示删失观测，1 表示多发性骨髓瘤死亡。\n在诊断时，记录了每位患者的许多解释变量的值。这些包括患者的年龄（岁）、性别（1 = 男性，2 = 女性）、血尿素氮 (Bun) 水平、血清钙 (Ca)、血红蛋白 (Hb)、骨髓中血浆细胞的百分比 (Pcells) 和一个指示变量 (Protein)，用于指示尿液中是否存在 Bence-Jones 蛋白（0 = 不存在，1 = 存在）。分析这些数据的主要目的是研究风险因素 Bun, Ca, Hb, Pcells 和 Protein 对多发性骨髓瘤患者生存时间的影响。这些风险因素的影响可能会因患者的年龄或性别而改变，因此，还需要研究生存时间与重要风险因素之间的关系在每个性别以及不同年龄组中的一致性程度。示例 1.4  (前列腺癌两种疗法的比较) 1967年，Veteran’s Administration Cooperative Urological Research Group 开始了一项随机对照临床试验，以比较前列腺癌的疗法。该试验是双盲的，研究中使用的两种疗法是安慰剂和 1.0 毫克己烯雌酚 (DES)。每天口服治疗。研究的时间起点是患者被随机分配接受治疗的日期，终点是患者死于前列腺癌的日期。完整的数据集在 Andrews Herzberg (1985) 中给出，但本例中使用的数据来自患有 III 期癌症的患者，即有证据表明这些患者的肿瘤局部扩展至前列腺包膜之外，但血清前列腺酸性磷酸酶未升高。此外，这些患者没有心血管病史，在试验开始时心电图结果正常，白天没有卧床休息。除了记录研究中每个患者的生存时间外，还记录了许多其他预后因素的信息。其中包括患者进入试验时的年龄、他们的血清血红蛋白水平（单位：g/100 ml）、原发肿瘤大小（单位：cm2）以及肿瘤分期和分级的综合指数值。这个指数称为 Gleason 指数；越晚期，该指数的值就越大。表 1.4 给出了 38 名患者的记录数据，其中生存时间以月为单位。因其他原因死亡或失访的患者的生存时间视为删失。研究结束时，若患者死于前列腺癌，则与个体状态相关的变量的值为 1，若生存时间删失，则为 0。当个体接受 DES 治疗时，与治疗组别相关的变量取值为 2，而当个体接受安慰剂治疗时，变量取值为 1.\n本研究的主要目的是确定是否有证据表明接受 DES 治疗的患者比接受安慰剂治疗的患者生存时间更长。由于本例所依据的数据来自一项随机试验，人们可能会期望两组治疗患者中预后因素（即患者年龄、血清血红蛋白水平、肿瘤大小和 Gleason 指数）的分布是相似的。然而，依赖这一假设并不明智。例如，结果表明安慰剂组患者的肿瘤平均大小可能大于接受 DES 治疗的患者。如果大肿瘤患者的预后比小肿瘤患者差，那么治疗效果就会被高估，除非在分析中充分考虑肿瘤的大小。因此，首先有必要确定是否有任何协变量与生存时间相关。若如此，在比较两个治疗组患者的生存时间时，需要考虑这些变量的效应。","code":""},{"path":"chap1.html","id":"sec1-4","chapter":"第 1 章 生存分析","heading":"1.4 生存函数，风险函数和累积风险函数","text":"在总结生存数据时，主要关注三个函数，即生存函数 (survival survivor function)、风险函数 (hazard function) 和累积风险函数 (cumulative hazard function). 因此，这些函数在第一章中定义。","code":""},{"path":"chap1.html","id":"sec1-4-1","chapter":"第 1 章 生存分析","heading":"1.4.1 生存函数","text":"个体的实际生存时间 \\(t\\) 可以视为变量 \\(T\\) 的观测，其中 \\(T\\) 可以取任意非负值。\\(T\\) 可取的值具有概率分布，我们将 \\(T\\) 称为与生存时间相关的随机变量。现假设该随机变量具有概率密度函数为 \\(f(t)\\) 的概率分布。\\(T\\) 的分布函数由下式给出\\[\\begin{equation}\nF(t)=\\mathrm{P}(T<t)=\\int_0^tf(u)\\mathrm{d}u\n\\tag{1.1}\n\\end{equation}\\]表示生存时间小于某个值 \\(t\\) 的概率。该函数也称为累积发生率函数 (cumulative incidence function)，因为它总结了在时间 \\(t\\) 之前发生的死亡的累积概率生存函数 \\(S(t)\\) 定义为生存时间大于等于 \\(t\\) 的概率，因此根据式 (1.1)\\[\\begin{equation}\nS(t)=\\text{P}(T\\geqslant t)=1-F(t)\n\\tag{1.2}\n\\end{equation}\\]因此，生存函数可以用来表示一个个体在任何给定时间之后生存的概率。","code":""},{"path":"chap1.html","id":"sec1-4-2","chapter":"第 1 章 生存分析","heading":"1.4.2 风险函数","text":"风险函数 (hazard function) 广泛用于表示某个时间 \\(t\\) 发生的事件（如死亡）的风险或危险 (hazard risk). 该函数是从一个个体在时间 \\(t\\) 死亡的概率中获得的，前提是这个个体已经生存到了这个时间。为了正式定义等下函数，考虑与个体生存时间相关的随机变量 \\(T\\) 在 \\(t\\) 和 \\(t+\\delta t\\) 之间的概率，条件是 \\(T\\) 大于等于 \\(t\\)，即 \\(P(t \\le T < t + \\delta t | T \\ge t)\\)。风险函数 \\(h(t)\\) 是该量的极限值，因为 \\(\\delta t\\) 趋于零，所以\\[\\begin{equation}\nh(t)=\\lim_{\\delta t\\to0}\\left\\{\\frac{\\text{P}(t\\leqslant T<t+\\delta t\\mid T\\geqslant t)}{\\delta t}\\right\\}\n\\tag{1.3}\n\\end{equation}\\]函数 \\(h(t)\\) 也称为风险率 (hazard rate)、瞬时死亡率 (instantaneous death rate)、强度率 (intensity rate) 或死亡作用力 (force motality).根据式 (1.3) 中风险函数的定义，\\(h(t)\\) 是时间 \\(t\\) 处的事件率，前提是事件在 \\(t\\) 之前没有发生。具体而言，如果生存时间以天为单位，\\(h(t)\\) 是在第 \\(t\\) 天开始时有事件发生风险的个体在该天经历事件的近似概率。时间 \\(t\\) 的风险函数也可以视为个体在单位时间内经历的预期事件数，假设在此之前没有发生过事件，并假设风险在该时间段内是恒定的。根据式 (1.3) 中风险函数的定义，生存函数和风险函数之间存在一些有用的关系。根据概率论，以事件 \\(B\\) 的发生为条件，事件 \\(\\) 的概率由 \\(\\text{P}(|B)=\\text{P}(AB)/\\text{P}(B)\\) 给出，其中 \\(\\text{P}(AB)\\) 是 \\(\\) 和 \\(B\\) 共同发生的概率。使用该关系，式 (1.3) 风险函数定义中的条件概率\\[\\begin{aligned}\\frac{\\mathrm{P}(t\\leqslant T<t+\\delta t)}{\\mathrm{P}(T\\geqslant t)}\\end{aligned}\\]等于\\[\\begin{aligned}\\frac{F(t+\\delta t)-F(t)}{S(t)}\\end{aligned}\\]其中 \\(F(t)\\) 为 \\(T\\) 的分布函数。那么\\[h(t)=\\lim_{\\delta t\\to0}\\left\\{\\frac{F(t+\\delta t)-F(t)}{\\delta t}\\right\\}\\frac{1}{S(t)}\\]现在\\[\\lim_{\\delta t\\to0}\\left\\{\\frac{F(t+\\delta t)-F(t)}{\\delta t}\\right\\}\\]是 \\(F(t)\\) 关于 \\(t\\) 的导数的定义式，也就是 \\(f(t)\\)，因此\\[\\begin{equation}\nh(t)=\\frac{f(t)}{S(t)}\n\\tag{1.4}\n\\end{equation}\\]总之，式 (1.1), (1.2) 和 (1.4) 表明，利用 \\(f(t),S(t),h(t)\\) 中的任何一个可以确定其他两个。","code":""},{"path":"chap1.html","id":"sec1-4-3","chapter":"第 1 章 生存分析","heading":"1.4.3 累积风险函数","text":"根据式 (1.4) 可以得出\\[\\begin{equation}\nh(t)=-\\frac{\\mathrm{d}}{\\mathrm{d}t}\\{\\log S(t)\\}\n\\tag{1.5}\n\\end{equation}\\]因此\\[\\begin{equation}\nS(t)=\\exp\\left\\{-H(t)\\right\\}\n\\tag{1.6}\n\\end{equation}\\]其中\\[\\begin{equation}\nH(t)=\\int_0^th(u)\\mathrm{d}u\n\\tag{1.7}\n\\end{equation}\\]函数 \\(H(t)\\) 在生存分析中作用广泛，称为集成或累积风险函数 (integrated cumulative hazard function). 根据式 (1.6)，累积风险函数也可根据生存函数得到，因为\\[\\begin{equation}\nH(t)=-\\log S(t)\n\\tag{1.8}\n\\end{equation}\\]累积风险函数 \\(H(t)\\) 是直到时间 \\(t\\) 时发生事件的累积风险。如果事件是死亡，则 \\(H(t)\\) 总结了截至时间 \\(t\\) 的死亡风险，前提是死亡在 \\(t\\) 之前尚未发生。时间 \\(t\\) 处的累积风险函数也可解释为从时间起点到 \\(t\\) 的时间区间内发生事件的预期数量。累积风险函数有可能大于 1. 使用式 (1.8)，当 \\(-\\log S(t)\\geqslant1\\) 即 \\(S(t)\\leqslant e^{-1}=0.37\\) 时，\\(H(t)\\geqslant1\\)。当时间 \\(t\\) 之后发生事件的概率小于 0.37 时，累积风险大于 1，这意味着在时间区间 \\((0, t)\\) 内预计会发生多个事件。因此生存函数 \\(S(t)\\) 可以更准确地定义为时间 \\(t\\) 之后发生一个或多个事件的概率。将累积风险函数解释为预期事件数仅在事件可能重复发生的情况下是合理的，例如当事件是感染、偏头痛或癫痫发作的发生；而当感兴趣的事件是死亡时，这种解释依赖于个体在死亡发生后立即复活！分析事件多次发生时间的方法将在第 13 章讨论，并且当可能发生多次事件时，对风险和累积风险函数更数学的解释包含在该章的 13.1 节中。在生存数据分析中，根据生存时间估计生存函数、风险函数和累积风险函数。第 2 章和第 3 章描述了不需要指定 \\(T\\) 的概率密度函数形式的估计方法，而第 5 章介绍了基于特定生存时间分布假设的方法。","code":""},{"path":"chap1.html","id":"sec1-5","chapter":"第 1 章 生存分析","heading":"1.5 用于生存分析的计算机软件","text":"本书将要介绍的大多数生存数据分析技术都需要合适的计算机软件来实施。目前已有许多用于生存分析的计算机软件包，但商业软件包，例如，SAS (SAS Institute Inc.)、Stata (StataCorp) 和 S-PLUS (TIBCO Software Inc.) 具有最广泛的功能。此外，R 统计计算环境 (R Core Team, 2021) 是一款免费软件，根据 GNU General Public\nLicense 条款发布。S-PLUS 和 R 都是 S 统计编程语言的现代实现，并包含一系列全面的用于生存分析的模块。本书后续章节描述的任何分析都可以使用这四个软件包中的任何一个来执行。由于 R 的广泛使用且易于获取，因此第 17 章详细描述了其在生存分析中的应用。在某些情况下，软件包生成的输出中的数值结果可能有所不同。这通常是由于使用不同的默认计算方法造成的。当数据集包含两个或多个具有相同生存时间的个体时，就会出现一个特别重要的例子。在这种情况下，SAS phreg 程序和 R 函数 coxph (Theerneau, 2022) 默认采用不同的方法来处理这些相关观测，从而导致输出存在差异。默认设置当然可以更改，第 3 章第 3.3.2 节描述了生存时间结 (tied survival times) 的处理。有关使用 R 函数 coxph 的更多详细信息可以在第 17 章第 17.4 节中找到。数值上的差异也可能是由于控制某些迭代过程收敛的参数使用不同的设置以及用于数值优化的不同方法造成的。","code":""},{"path":"chap1.html","id":"sec1-6","chapter":"第 1 章 生存分析","heading":"1.6 延伸阅读","text":"许多关于医学研究统计的一般书籍都介绍了生存数据分析中使用的技术，例如 Altman (1991) 和 Armitage, Berry Matthews (2002) 的书籍。 Machin, Cheung Parmar (2006) 提供了使用非技术语言分析临床试验生存数据的实用指南。有许多教科书介绍了生存分析的方法，并通过实例加以说明。Lee Wang (2013) 从生物学和医学的角度提供了广泛的主题概述，而 Marubini Valsecchi (1995) 则描述了临床试验和观察性研究中生存数据的分析。Hosmer、Lemeshow和May（2008）对生存分析进行了平衡的阐述，其中包括模型开发和拟合模型中参数估计的解释等优秀章节。Kleinand Moeschberger (2005) 在其综合教科书中包含了许多示例数据集和练习，而 Kleinbaum Klein (2012) 则提供了一本关于生存分析的自学教材。Mills (2010) 也提供了一本使用 R 和 Stata 的生存和事件历史分析实用指南。Breslow Day (1987) 以及 Woodward (2014) 描述了生存分析在流行病学数据分析中的应用。Crowder et al. (1991) 和 Meeker, Escobar amd Pascual (2022) 介绍了生存分析在其他领域的应用，他们重点关注可靠性数据的分析，而 Box-Steffensmeier Jones (2004) 则从非数学的角度介绍了社会科学中的事件发生时间分析。Kalbfleisch Prentice (2002) 以及 Lawless (2002) 对该主题进行了全面描述。这些书是为研究生统计学家或研究工作者编写的，通常视为参考书，而不是介绍性文本。Cox Oakes (1984) 的研究专著以及 Hinkley, Reid Snell (1991) 专门讨论生存分析的章节对生存分析进行了简要回顾。Hougaard (2000) 关于多变量生存数据的书在介绍了生存分析的基本特征后，讨论了更先进的主题。Aalen, Borgan Gjessing (2008) 展示了如何使用随机过程分析删失数据，结合了医学实际例子。Therneau Grambsch (2000) 将生存分析的介绍建立在计数过程方法的基础上，从而使材料更加数学化。Harrell (2015) 详细介绍了其他文本中没有的统计模型开发过程中出现的许多问题，包括对案例研究的广泛讨论。有很多关于特定软件包在数据分析中的使用的一般性书籍，其中一些书籍详细描述了这些软件包在生存数据分析中的应用。Allison (2010) 为 SAS 软件在生存分析中的应用提供了全面的指南。Cleves, Gould Marchenko (2016) 介绍了 Stata 在生存分析中的应用，而 Kohler Kreuter (2012) 则提供了 Stata 在数据分析中使用的一般介绍。Therneau Grambsch (2000) 详细描述了如何使用 SAS 和 S-PLUS 来拟合 Cox 回归模型及其扩展。该书还描述了一些 SAS 宏和 S-PLUS 函数，这些函数补充了这些软件包中可用的标准函数。Tableman Kim (2004) 也描述了 S-PLUS 在生存分析中的应用，而 Broström (2022) 和 Moore (2016) 则展示了 R 在生存数据分析中的应用。Venables Ripley (2002) 描述了如何在 S 环境中进行图形和数值数据分析，这种环境在 R 和 S-PLUS 中都可实现；请注意，S 代码通常可以在 R 下运行。关于 R 的更多参考文献见第 17 章末尾。","code":""},{"path":"chap2.html","id":"chap2","chapter":"第 2 章 一些非参数程序","heading":"第 2 章 一些非参数程序","text":"分析一组生存数据的第一步是呈现特定总体中个体生存时间的数字或图形总结。这些总结本身可能令人感兴趣，或作为对数据进行更详细分析的前奏。通过生存函数和风险函数的估计，可以方便地总结生存数据。第 2.1 节和第 2.3 节描述了从单个生存数据样本估计这些函数的方法。这些方法被认为是非参数的或无分布的 (distribution-free)，因为它们不需要对生存时间的分布做出特定的假设。一旦找到生存函数的估计，就可以估计生存时间分布的中位数和其他百分位数，如第 2.4 节所示。数据的数字总结，基于对数据的概率分布假设得出，将在第 5 章考虑。当比较两组患者的生存时间时，可以使用生存函数估计对每组个体的生存经历进行非正式比较。然而，有更正式的程序可以比较两组生存数据。第 2.6 节描述了用于比较两组或多组生存时间的三种非参数程序，即 log-rank, Wilcoxon 和 Peto-Peto 检验。","code":""},{"path":"chap2.html","id":"sec2-1","chapter":"第 2 章 一些非参数程序","heading":"2.1 估计生存函数","text":"首先假设我们有一个生存时间样本，其中没有任何删失的观测。生存函数 \\(S(t)\\) 由式 (1.2) 定义，是个体生存时间大于等于 \\(t\\) 的概率。该函数可以通过经验生存函数 (empirical survival function) 来估计，由下式给出\\[\\begin{equation}\n\\hat S(t)=\\frac{\\text{生存时间 }\\ge t \\text{ 的个体数量}}{\\text{数据集中的个体数量}}\n\\tag{2.1}\n\\end{equation}\\]等价地，\\(\\hat S(t)=1 − \\hat F(t)\\)，其中 \\(\\hat F(t)\\) 是经验分布函数 (empirical distribution function)，即研究中在 \\(t\\) 时刻生存的个体总数与该组个体总数的比值。请注意，经验生存函数在第一个死亡时间 \\(t\\) 之前等于 1，在最终死亡时间之后等于 0.假设生存函数估计 \\(\\hat S(t)\\) 在两个相邻死亡时间之间是恒定的，因此 \\(\\hat S(t)\\) 关于 \\(t\\) 的图像是阶跃函数 (step function). 在每个生存时间之后，函数立即下降。示例 2.1  (肺转移) 恶性骨肿瘤或骨肉瘤患者治疗中的一项并发症是肿瘤经常扩散到肺部。这种肺部转移会危及生命。在一项有关治疗骨肉瘤引起的肺转移的研究中，Burdette Gehan (1970) 给出了 11 名男性患者的以下生存时间（以月为单位）：11 13 13 13 13 13 14 14 15 15 17. 使用式 (2.1)，生存函数在第 11, 13, 14, 15 和 17 个月时的估计值为 1.000, 0.909, 0.455, 0.273 和 0.091. 生存函数的估计值从时间起点到 11 个月为 1，在 17 个月后为 0. 图 2.1 给出了生存函数估计的图示。当存在删失观测时，上述示例中所示的估计生存函数的方法无法使用。原因是该方法不允许将在时间 \\(t\\) 之前生存时间删失的个体的信息用于计算时间 \\(t\\) 处的生存函数估计。以下部分描述了可用于存在删失生存时间情况下估计 \\(S(t)\\) 的非参数方法。","code":""},{"path":"chap2.html","id":"sec2-1-1","chapter":"第 2 章 一些非参数程序","heading":"2.1.1 生存函数的生命表估计","text":"生存函数的生命表估计 (life-table estimate)，也称为生存函数的精算估计 (actuarial estimate)，是通过首先将观察期划分为一系列时间区间而获得的。这些区间不一定是等长的，尽管它们通常是等长的。使用的区间数量取决于研究中的人数，但通常在 5 到 15 之间。假设有 \\(m\\) 个这样的区间，第 \\(j(=1,2,\\cdots,m)\\) 个区间的时间范围为 \\([t^\\prime_{j-1},t^\\prime_j)\\)，我们取 \\(t_0 = 0\\) 且 \\(t_m = \\infty\\)。另外，令 \\(d_j\\) 和 \\(c_j\\) 分别表示该时间区间内的死亡人数和删失生存时间数，令 \\(n_j\\) 为在第 \\(j\\) 个区间开始时存活且面临死亡风险的个体数量。我们现在假设删失程序是这样的，即删失生存时间在第 \\(j\\) 个时间区间内均匀出现，因此在该时间区间内处于风险的平均人数为\\[\\begin{equation}\nn'_j=n_j-c_j/2\n\\tag{2.2}\n\\end{equation}\\]该假设有时称为精算假设 (actuarial assumption).在第 \\(j\\) 个区间内，死亡概率可以通过 \\(d_{j}/n_{j}^{\\prime}\\) 来估计，因此对应的生存概率为 \\((n'_j-d_j)/n'_j\\) 。现考虑个体在时间 \\(t_{j-1}^{\\prime},j=2,3,\\ldots,m\\) 之后生存的概率，即生存到第 \\(j\\) 个区间开始后的某个时间。这将是个体在前 \\(j − 1\\) 个区间中生存的概率的乘积，因此生存函数的生命表估计由下式给出\\[\\begin{equation}\nS^*(t)=\\prod_{=1}^{j-1}\\left(\\frac{n_i'-d_i}{n_i'}\\right)\n\\tag{2.3}\n\\end{equation}\\]其中 \\(t'_{j-1}\\leqslant t<t'_j,j=2,3,\\ldots,m\\). 在第一个区间 \\(t'_0\\) 开始之后的生存概率估计当然是 1，而在 \\(t'_m\\) 之外的生存概率估计为 0. 生存函数的图形估计将是一个阶跃函数，在每个时间区间内函数值恒定。示例 2.2  (多发性骨髓瘤患者的生存情况) 为了说明生命表估计值的计算，请考虑表 1.3 中给出的 48 名多发性骨髓瘤患者的生存时间数据。在此示例中，将忽略为每个个体收集的关于其他解释变量的信息。首先对生存时间进行分组，得出研究前五年和随后三年的死亡患者人数 \\(d_j\\) 和删失人数 \\(c_j\\). 然后计算每个区间开始时处于死亡风险的人数 \\(n_j\\)，以及调整后的处于风险数 \\(n′_j\\). 最后，估计每个区间的生存概率，使用式 (2.3) 获得生存函数估计。计算如表 2.1 所示，其中时间段以月为单位。第 \\(j\\) 个区间从时间 \\(t^\\prime_{j−1}\\) 开始，在时间 \\(t^\\prime_{j}\\) 之前结束，表示为 \\(t_{j−1}^{\\prime}-\\)，其中 \\(j=1,2,\\cdots,m\\)。\n生存函数的生命表估计图如图 2.2 所示。使用这种方法得到的生存函数估计的形式对其构造中使用的区间选择很敏感，正如直方图的形状取决于类别区间的选择一样。另一方面，生命表估计特别适用于实际死亡时间未知的情况，这时唯一可用的信息是在一系列连续时间区间内发生的死亡数和删失观测数。在实践中，这种区间删失的生存数据相当常见。当实际生存时间已知时，仍然可以使用生命表估计，如例 2.2 所示，但生存时间的分组确实会导致一些信息丢失。使用其他方法来估计生存函数会更为合适，例如生存函数的 Kaplan-Meier 估计。","code":""},{"path":"chap2.html","id":"sec2-1-2","chapter":"第 2 章 一些非参数程序","heading":"2.1.2 生存函数的 Kaplan-Meier 估计","text":"分析未分组的删失生存数据的第一步通常是获得生存函数的 Kaplan-Meier 估计。因此，这一估计是经过详细考虑的。为了获得 Kaplan-Meier 估计，需要构建一系列时间区间，就像生命表估计一样。然而，每个这样的区间都被设计成只包含一个死亡时间，且这个死亡时间被认为发生在该区间的开始时刻。作为说明，假设 \\(t_{(1)},t_{(2)}, t_{(3)}\\) 是按秩次 (rank order) 排列的三个生存时间，即 \\(t_{(1)}<t_{(2)}<t_{(3)}\\)，并且 \\(c\\) 是介于 \\(t_{(2)}\\) 和 \\(t_{(3)}\\) 之间的删失生存时间。然后，构建的区间从时间 \\(t_{(1)},t_{(2)}\\) 和 \\(t_{(3)}\\) 开始，每个区间包含一个死亡时间，尽管在任何特定死亡时间可能有多个个体死亡。请注意，没有区间从删失时间 \\(c\\) 开始。现在假设有 2 个人在 \\(t_{(1)}\\) 死亡，1 个人在 \\(t_{(2)}\\) 死亡，3 个人在 \\(t_{(3)}\\) 死亡。如图 2.3 所示，其中 D 代表死亡，C 代表删失生存时间。\n时间起点用 \\(t_0\\) 表示，因此有一个从 \\(t_0\\) 开始的初始时间段，在 \\(t_{(1)}\\)（第一次死亡时间）之前结束。这意味着从 \\(t_0\\) 到 \\(t_{(1)}\\) 的区间将不包括死亡时间。第一个构造的区间的范围从 \\(t_{(1)}\\) 延伸到 \\(t_{(2)}\\) 之前，并且由于第二次死亡时间为 \\(t_{(2)}\\)，因此该区间包括 \\(t_{(1)}\\) 处的单个死亡时间。第二个区间从时间 \\(t_{(2)}\\) 开始，在 \\(t_{(3)}\\) 之前结束，包括 \\(t_{(2)}\\) 处的死亡时间和删失时间 \\(c\\)。还有从 \\(t_{(3)}\\) 开始的第三个区间，其中包含最长的生存时间 \\(t_{(3)}\\)。一般来说，假设有 \\(n\\) 个个体，生存时间为 \\(t_1, t_2,...,t_n\\)。其中一些观测可能是右删失的，并且也可能有多个个体具有相同的生存时间。因此，我们假设个体中有 \\(r\\) 个死亡时间，其中 \\(r \\le n\\)。将这些死亡时间按升序排列后，第 \\(j\\) 个死亡时间记为 \\(t_{(j)}\\)，其中 \\(j = 1, 2,...,r\\)，因此 \\(r\\) 个死亡时间依次为 \\(t_{(1)} < t_{(2)} < \\cdots < t_{(r)}\\)。在时间 \\(t_{(j)}\\) 之前还存活的个体数量，包括此时即将死亡的个体数量，表示为 \\(n_j\\)，并且 \\(d_j\\) 表示此时死亡的数量，其中 \\(j = 1, 2,...,r\\)。从 \\(t_{(j)} − \\delta\\) 到 \\(t_{(j)}\\) 的时间区间（其中 \\(\\delta\\) 是无穷小的时间区间）包含一次死亡时间。由于在 \\(t_{(j)}\\) 之前有 \\(n_j\\) 个个体还存活，并且在 \\(t_{(j)}\\) 时有 \\(d_j\\) 个个体死亡，因此个体在 \\(t_{(j)} − \\delta\\) 到 \\(t_{(j)}\\) 的时间区间内死亡的概率估计为 \\(d_j/n_j\\)。在该时间区间内相应的生存概率估计为 \\((n_j − d_j )/n_j\\)。有时删失生存时间与一个或多个死亡时间同时出现的情况，导致死亡时间和删失生存时间看似同时发生。在这种情况下计算 \\(n_j\\) 值时，删失生存时间视为在死亡时间之后立即发生。从构建时间区间的方式来看，从 \\(t_{(j)}\\) 到 \\(t_{(j+1)} − \\delta\\)（下一次死亡时间之前）的区间不包含任何死亡。因此，从 \\(t_{(j)}\\) 到 \\(t_{(j+1)} − \\delta\\) 的生存概率为 1，并且从 \\(t_{(j)}-\\delta\\) 到 \\(t_{(j)}\\) 以及从 \\(t_{(j)}\\) 到 \\(t_{(j+1)} − \\delta\\) 的联合生存概率可估计为 \\((n_j − d_j )/n_j\\)。当 \\(\\delta\\) 趋于零时，\\((n_j − d_j )/n_j\\) 就是 \\(t_{(j)}\\) 到 \\(t_{(j+1)}\\) 区间的生存概率估计。我们现在假设样本中个体的死亡是相互独立发生的。那么，在构造的第 \\(k\\) 个时间区间 \\([t_{(k)}, t_{(k+1)})\\)（其中 \\(k=1, 2,...,r\\)，且 \\(t_{(r+1)}\\) 定义为 \\(\\infty\\)）中的任意时间 \\(t\\) 处生存函数的估计将是生存到 \\(t_{(k)}\\) 之后的概率的估计。这实际上是生存到 \\([t_{(k)}, t_{(k+1)})\\) 这个区间以及所有之前区间的概率，并由此得到 Kaplan-Meier 生存函数估计，其表达式为：\\[\\begin{equation}\n\\hat{S}(t)=\\prod_{j=1}^k\\left(\\frac{n_j-d_j}{n_j}\\right)\n\\tag{2.4}\n\\end{equation}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r\\)，对于 \\(t<t_{(1)}\\) 有 \\(\\hat S(t)=1\\)，且 \\(t_{(r+1)}\\) 取 \\(\\infty\\)。如果最大的观测是删失生存时间 \\(t ^*\\)，则对于 \\(t > t^*\\)，\\(\\hat S(t)\\) 是未定义的。另一方面，如果最大生存时间 \\(t_{(r)}\\) 是右删失观测，则 \\(n_r = d_r\\)，对于 \\(t \\ge t_{(r)}\\)，\\(\\hat S(t)\\) 为 0. 生存函数的 Kaplan-Meier 估计图是一个阶跃函数，其中生存概率估计在相邻死亡时间之间保持恒定，并在每个死亡时间减少。式 (2.4) 表明，对于式 (2.3) 中生存函数的生命表估计，Kaplan-Meier 估计是由一系列概率估计的乘积得到的。事实上，Kaplan-Meier 估计是式 (2.3) 中生命表估计的极限值，因为区间数量趋于无穷大且宽度趋于零。因此，Kaplan-Meier 估计也称为生存函数的乘积极限估计 (product-limit estimate).请注意，如果数据集中没有删失生存时间，则式 (2.4) 中的 \\(n_j − d_j = n_{j+1}, j = 1, 2,...,k\\)，并且展开乘积可以得到\\[\\hat{S}(t)=\\frac{n_2}{n_1}\\times\\frac{n_3}{n_2}\\times\\cdots\\times\\frac{n_{k+1}}{n_k}\\]对于 \\(k = 1, 2,...,r − 1\\)，这可简化为 \\(n_{k+1}/n_1\\)。对于 \\(t<t_{(1)}\\) 有 \\(\\hat S(t) = 1\\)；对于 \\(t \\ge t_{(r)}\\) 有 \\(\\hat S(t) = 0\\)。现在，\\(n_1\\) 是在第一次死亡时间之前处于风险中的个体数量，即样本的个体数量，\\(n_{k+1}\\) 是生存时间大于等于 \\(t_{(k+1)}\\) 的个体数量。因此，在没有删失的情况下，\\(\\hat S(t)\\) 只是式 (2.1) 中定义的经验生存函数。因此，Kaplan-Meier 估计是经验生存函数的推广，该函数用于适应删失观测。示例 2.3  (停用宫内节育器的时间) 表 1.1 给出了 18 名妇女停用宫内节育器的时间数据。对于这些数据，生存函数 \\(S(t)\\) 表示妇女在任何时间 \\(t\\) 后停用避孕装置的概率。使用式 (2.4) 可以很容易地获得生存函数的 Kaplan-Meier 估计，所需的计算如表 2.2 所示。\n生存函数估计如图 2.4 所示。请注意，由于最大停用时间 107 天是删失的，因此在 \\(t=107\\) 之后无法定义 \\(\\hat S(t)\\)。","code":""},{"path":"chap2.html","id":"sec2-1-3","chapter":"第 2 章 一些非参数程序","heading":"2.1.3 生存函数的 Nelson-Aalen 估计","text":"基于单个事件时间生存函数的另一种估计是 Nelson-Aalen 估计，由下式给出\\[\\begin{equation}\n\\tilde{S}(t)=\\prod_{j=1}^k\\exp(-d_j/n_j)\n\\tag{2.5}\n\\end{equation}\\]如第 2.3.3 节所示，可以从累积风险函数估计中获得该估计。此外，生存函数的 Kaplan-Meier 估计可以看作是 Nelson-Aalen 估计的近似。为了证明这一点，利用如下结果\\[\\begin{aligned}e^{-x}&=1-x+\\frac{x^2}{2}-\\frac{x^3}{6}+\\cdots\\end{aligned}\\]当 \\(x\\) 很小时，该式近似于 \\(1−x\\)。因此只要 \\(d+j\\) 相对于 \\(n_j\\) 很小（除非在最长的生存时间），就有 \\(\\exp ({-d_j/n_j})\\approx1-(d_j/n_j)=(n_j-d_j)/n_j\\)。因此，式 (2.4) 中的 Kaplan-Meier 估计 \\(\\hat S(t)\\) 近似于式 (2.5) 中的 Nelson-Aalen 估计 \\(\\tilde S(t)\\)。生存函数的 Nelson-Aalen 估计，也称为 Altshuler 估计，在任何给定时间都始终大于 Kaplan-Meier 估计，因为对于 \\(x\\) 的所有值，\\(e−x\\ge 1−x\\)。尽管已证明 Nelson-Allen 估计在小样本中比 Kaplan-Meiser 估计表现更好，但在许多情况下，估计值将非常相似，特别是在较早的生存时间。由于 Kaplan-Meier 估计是经验生存函数的一般形式，因此具有许多值得推荐的地方。示例 2.4  (停用宫内节育器的时间) 表 2.2 所示的值给出了停用宫内节育器数据的生存函数的 Kaplan-Meier 估计，可用于计算 Nelson-Aalen 估计。这一估计如表 2.3 所示。\n从该表中我们可以看出，Kaplan-Meier 和 Nelson-Aalen 对生存函数的估计相差小于 0.04。然而，当我们在第 2.2 节中考虑这些估计的精度时，我们发现 0.04 的差异没有实际意义。","code":""},{"path":"chap2.html","id":"sec2-2","chapter":"第 2 章 一些非参数程序","heading":"2.2 生存函数估计的标准误","text":"解释任何量的估计的重要辅助手段是估计的精度，这反映在估计的标准误中。其定义为估计的方差估计的平方根，并且可用于构造感兴趣的量的区间估计。本节给出了生存函数估计的标准误。由于 Kaplan-Meier 估计是生存函数最重要和最广泛使用的估计，因此本节将详细介绍 \\(\\hat S(t)\\) 标准误的推导。这种推导的细节可以在第一次阅读时省略。","code":""},{"path":"chap2.html","id":"sec2-2-1","chapter":"第 2 章 一些非参数程序","heading":"2.2.1 Kaplan-Meier 估计的标准误","text":"对于 \\([t_{(k)},t_{(k+1)})\\) 区间中的任何 \\(t\\) 值，生存函数的 Kaplan-Meier 估计可以写为\\[\\begin{aligned}\\hat{S}(t)=\\prod_{j=1}^k\\hat{p}_j\\end{aligned}\\]其中 \\(k=1,2,\\cdots,r\\)，\\(\\hat p_j=(n_j−d_j)/n_j\\) 是个体在开始于 \\(t_{(j)}\\) 的时间区间内生存的概率估计，\\(j=1,2,\\cdots,r\\)。取对数\\[\\log\\hat{S}(t)=\\sum_{j=1}^k\\log\\hat{p}_j\\]因此 \\(\\log \\hat S(t)\\) 的方差由下式给出\\[\\begin{equation}\n\\text{var }\\left\\{\\log\\hat{S}(t)\\right\\}=\\sum_{j=1}^k\\text{ var }\\left\\{\\log\\hat{p}_j\\right\\}\n\\tag{2.6}\n\\end{equation}\\]现在，可以假设在开始于 \\(t_{(j)}\\) 的区间中生存的个体数量服从参数为 \\(n_j\\) 和 \\(p_j\\) 的二项分布 (binomial distribution)，其中 \\(p_j\\) 是在该区间中生存的真实概率。生存数为 \\(n_j−d_j\\)，利用参数为 \\(n,p\\) 的二项随机变量的方差为 \\(np(1−p)\\) 这一结果，\\(n_j−d_j\\) 的方差由下式给出\\[\\text{var}\\,\\,(n_j-d_j)=n_jp_j(1-p_j)\\]由于 \\(\\hat p_j=(n_j-d_j)/n_j\\)，\\(\\hat p_j\\) 的方差为 \\(\\text{var}\\,(n_j-d_j)/n_j^2\\)，即 \\(p_j(1-p_j)/n_j\\)。那么 \\(\\hat p_j\\) 的方差可估计为\\[\\begin{equation}\n\\hat p_j(1-\\hat p_j)/n_j\n\\tag{2.7}\n\\end{equation}\\]为了获得 \\(\\log \\hat p_j\\) 的方差，我们需利用随机变量函数近似方差的一般结果。根据这个结果，随机变量 \\(X\\) 的函数 \\(g(X)\\) 的方差由下式给出\\[\\begin{equation}\n\\text{var }\\{g(X)\\}\\approx\\left\\{\\frac{\\text{d}g(X)}{\\text{d}X}\\right\\}^2\\text{ var}\\left(X\\right)\n\\tag{2.8}\n\\end{equation}\\]这称为随机变量函数方差的泰勒级数近似 (Taylor series approximation). 使用式 (2.8)，\\(\\log \\hat p_j\\) 的近似方差为 \\(\\mathrm{var}\\left(\\hat{p}_j\\right)/\\hat{p}_j^2\\)，再使用式 (2.7)，\\(\\log \\hat p_j\\) 的近似方差为 \\(\\left(1-\\hat{p}_j\\right)/\\left(n_j\\hat{p}_j\\right)\\)，替换 \\(\\hat p_j\\) 后简化为\\[\\begin{equation}\n\\frac{d_j}{n_j(n_j-d_j)}\n\\tag{2.9}\n\\end{equation}\\]那么，根据式 (2.6)\\[\\begin{equation}\n\\text{var }\\left\\{\\log\\hat{S}(t)\\right\\}\\approx\\sum_{j=1}^k\\frac{d_j}{n_j(n_j-d_j)}\n\\tag{2.10}\n\\end{equation}\\]再次应用式 (2.8) 中的结果，给出\\[\\text{var }\\left\\{\\log\\hat{S}(t)\\right\\}\\approx\\frac{1}{[\\hat{S}(t)]^2}\\text{var }\\left\\{\\hat{S}(t)\\right\\}\\]因此\\[\\begin{equation}\n\\text{var }\\left\\{\\hat{S}(t)\\right\\}\\approx[\\hat{S}(t)]^2\\sum_{j=1}^k\\frac{d_j}{n_j(n_j-d_j)}\n\\tag{2.11}\n\\end{equation}\\]最后，生存函数的 Kaplan-Meier 估计的标准误，定义为估计的方差估计的平方根，由下式给出\\[\\begin{equation}\n\\text{se }\\left\\{\\hat{S}(t)\\right\\}\\approx\\hat{S}(t)\\left\\{\\sum_{j=1}^k\\frac{d_j}{n_j(n_j-d_j)}\\right\\}^{\\frac{1}{2}}\n\\tag{2.12}\n\\end{equation}\\]其中 \\(t_{(k)}\\le t<t_{(k+1)}\\)。这个结果称为 Greenwood 公式。如果没有删失生存时间，则 \\(n_j-d_j=n_{j+1}\\)，式 (2.9) 成为 \\((n_j-n_{j+1})/n_jn_{j+1}\\)。现在\\[\\begin{aligned}\\sum_{j=1}^k\\frac{n_j-n_{j+1}}{n_jn_{j+1}}&=\\sum_{j=1}^k\\left(\\frac{1}{n_{j+1}}-\\frac{1}{n_j}\\right)=\\frac{n_1-n_{k+1}}{n_1n_{k+1}}\\end{aligned}\\]在无删失时，对于 \\(t_{(k)}\\le t<t_{(k+1)},k=1,2,\\cdots,r-1\\) 有 \\(\\hat S(t)=n_{k+1}/n_1\\)，因此上式可写作\\[\\frac{1-\\hat S(t)}{n_1\\hat S(t)}\\]因此，根据式 (2.11)，\\(\\hat S(t)\\) 的方差估计为 \\(\\hat{S}(t)[1-\\hat{S}(t)]/n_1\\)。这是式 (2.1) 中给出的经验生存函数方差的估计，其假设在时间 \\(t\\) 处于风险中的个体数量服从参数为 \\(n_1,S(t)\\) 的二项分布。","code":""},{"path":"chap2.html","id":"sec2-2-2","chapter":"第 2 章 一些非参数程序","heading":"2.2.2 其他估计的标准误","text":"生存函数的生命表估计在形式上类似于 Kaplan-Meier 估计，因此该估计的标准误是以类似的方式获得的。沿用 2.1.1 节的记号，生命表估计的标准误由下式给出\\[\\text{se }\\left\\{S^*(t)\\right\\}\\approx S^*(t)\\left\\{\\sum_{j=1}^k\\frac{d_j}{n_j^\\prime(n_j^\\prime-d_j)}\\right\\}^{\\frac{1}{2}}\\]Nelson-Aalen 估计的标准误为\\[\\text{se }\\left\\{\\tilde{S}(t)\\right\\}\\approx\\tilde{S}(t)\\left\\{\\sum_{j=1}^k\\frac{d_j}{n_j^2}\\right\\}^{\\frac12}\\]但也存在其他表达式。","code":""},{"path":"chap2.html","id":"sec2-2-3","chapter":"第 2 章 一些非参数程序","heading":"2.2.3 生存函数的置信区间","text":"一旦计算出生存函数的标准误估计，就可以找到生存函数在给定时间 \\(t\\) 处的置信区间。置信区间是生存函数的区间估计，其以预设的概率包含真实生存函数值。以这种方式构建的区间有时称为逐点置信区间 (pointwise confidence intervals)，因为它们适用于特定的生存时间。通过在给定时间 \\(t\\) 假设生存函数的估计服从均值为 \\(S(t)\\)，方差由式 (2.11) 给出的正态分布，我们可以获得生存函数在 \\(t\\) 时刻真实值的置信区间。该区间是根据标准正态分布的百分位点计算得出的。因此，如果 \\(Z\\) 是一个具有标准正态分布的随机变量，则该分布的上（单侧）\\(\\alpha/2\\) 分位点或双侧 \\(\\alpha\\) 分位点为 \\(z_{\\alpha/2}\\)，满足 \\(\\text P(Z>z_{\\alpha/2})=\\alpha/2\\)。该概率是标准正态曲线在下 \\(z_{\\alpha/2}\\) 右侧的面积，如图 2.5 所示。例如，标准正态分布的双侧 5% 和 1% 分位点 \\(z_{0.025}\\) 和 \\(z_{0.005}\\) 分别为 1.96 和 2.58.\n对于给定的 \\(t\\) 值，\\(S(t)\\) 的 \\(100(1−\\alpha)\\%\\) 置信区间为 \\(\\left[\\hat S(t)-z_{\\alpha/2}\\,\\text{se}\\,\\{\\hat S(t)\\},\\,\\,\\hat S(t)+z_{\\alpha/2}\\,\\text{se}\\,\\{\\hat S(t)\\}\\right]\\)，其中，\\(\\text{se}\\,\\{\\hat S(t)\\}\\) 可根据式 (2.12) 得出。\\(S(t)\\) 的这些区间可以叠加在生存函数估计的图中，如示例 2.5 所示。该方法的问题在于其置信区间是对称的。当生存函数估计接近 0 或 1 时，对称区间是不合适的，因为它们可能导致生存函数的置信区间超出 (0, 1) 区间。一个务实的解决方案是将任何大于 1 的上限替换为 1.0，将任何小于 0 的下限替换为 0.0.另一种方法是先将 \\(\\hat S(t)\\) 转换为 \\((−\\infty, \\infty)\\) 范围内的一个值，然后为转换后的值获得一个置信区间。接着，将得到的置信区间反向转换，以给出 \\(S(t)\\) 本身的置信区间。可能的转换方法包括 logistic 转换，即 \\(\\log[S(t)/\\{1 − S(t)\\}]\\)，以及互补双对数 (complementary log-log) 转换，即 \\(\\log\\{− \\log S(t)\\}\\)。注意到，根据式 (1.8)，后一个量是累积风险函数的对数。在任何情况下，都可以使用式 (2.8) 中的近似来获得 \\(\\hat S(t)\\) 转换值的标准误。例如，\\(\\log\\{-\\log\\hat{S}(t)\\}\\) 的方差是从式 (2.10) 中 \\(\\text{var}\\left\\{\\log\\hat{S}(t)\\right\\}\\) 的表达式获得的。使用式 (2.8) 中的一般结果，\\[\\mathrm{var}\\left\\{\\log(-X)\\right\\}\\approx\\frac1{X^2}\\operatorname{var}\\left(X\\right)\\]令 \\(X=\\log\\hat{S}(t)\\) 得到\\[\\begin{aligned}\\text{var }\\left[\\log\\{-\\log\\hat{S}(t)\\}\\right]\\approx\\frac1{\\{\\log\\hat{S}(t)\\}^2}\\sum_{j=1}^k\\frac{d_j}{n_j(n_j-d_j)}\\end{aligned}\\]\\(\\log\\{-\\log\\hat{S}(t)\\}\\) 的标准误为此量的平方根，得到如下形式的 \\(100(1 − \\alpha)\\%\\) 置信限\\[\\hat{S}(t)^{\\exp[\\pm z_{\\alpha/2}\\operatorname{se}\\{\\log[-\\log\\hat{S}(t)]\\}]}\\]其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。进一步的问题是，在生存时间分布的尾部，即当 \\(\\hat S(t)\\) 接近于 0 或 1 时，使用 Greenwood 公式获得的 \\(\\hat S(t)\\) 的方差可能会低估实际方差。在这些情况下，可以使用 \\(\\hat S(t)\\) 标准误的替代表达式。Peto et al. (1977) 提出 \\(\\hat S(t)\\) 的标准误应根据下式获得\\[\\text{se}\\left\\{\\hat{S}(t)\\right\\}=\\frac{\\hat{S}(t)√\\{1-\\hat{S}(t)\\}}{√(n_k)}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r,\\hat S(t)\\) 为 \\(S(t)\\) 的 Kaplan-Meier 估计，\\(n_k\\) 为在 \\(t_{(k)}\\) 处于风险的个体数，\\(t_{(k)}\\) 为第 \\(k\\) 个构造区间的起点。\\(\\hat S(t)\\) 标准误的这种表达式是保守的，因为获得的标准误往往会大于应有的值。因此，建议一般使用 Greenwood 估计。示例 2.5  (停用宫内节育器的时间) 表 2.4 给出了例 1.1 中关于停用宫内节育器时间数据的生存函数估计的标准误以及该函数相应真值的 95% 置信限。在此表中，位于范围 (0, 1) 之外的置信限已替换为 0 或 1.\n从该表中我们可以看出，一般来说，生存函数估计的标准误随着停止时间的增加而增加。这是因为晚期生存函数是基于较少个体来估计的。图 2.6 给出了生存函数估计图，其中 95% 置信限显示为虚线。需要注意的是，图 2.6 中所示生存函数的置信限仅对给定时间有效。需要不同的方法来生成置信带 (confidence bands)，使得生存函数对于所有 \\(t\\) 值以给定概率（例如 0.95）包含在带中。这些置信带通常会比由逐点置信限形成的带更宽。不再赘述细节，但本章最后一节会给出这些方法的参考文献。还要注意，这些区间的宽度远大于生存函数的 Kaplan-Meier 和 Nelson-Aalen 估计之间的差异，如表 2.2 和 2.3 所示。基于生命表和生存函数 Nelson-Aalen 估计的置信限可通过类似计算获得。","code":""},{"path":"chap2.html","id":"sec2-3","chapter":"第 2 章 一些非参数程序","heading":"2.3 估计风险函数","text":"单个生存数据样本也可使用风险函数进行总结，该函数显示了瞬时死亡风险与时间之间的依赖关系。有多种方法可以估计该函数，本节将描述其中的两种方法。","code":""},{"path":"chap2.html","id":"sec2-3-1","chapter":"第 2 章 一些非参数程序","heading":"2.3.1 风险函数的生命表估计","text":"假设生存时间已被划分成一系列 \\(m\\) 个区间，就像在构建生存函数生命表估计时那样。在每个区间内，单位时间内平均死亡风险合适的估计是该区间内死亡人数除以该区间内平均生存时间。后者是区间内平均风险人数的乘积，再乘以区间的长度。设第 \\(j\\) 个时间区间内的死亡人数为 \\(d_j,j=1,2,\\cdots,m\\)，并假设 \\(n^\\prime_j\\) 是该时间区间内面临死亡风险的平均人数，其中 \\(n^\\prime_j\\) 由式 (2.2) 给出。假设第 \\(j\\) 个时间区间内死亡率恒定，则该时间区间内的平均生存时间为 \\((n^\\prime_j-d_j/2)\\tau_j\\)，其中 \\(\\tau_j\\) 是第 \\(j\\) 个时间区间的长度。第 \\(j\\) 个时间区间内风险函数的生命表估计由下式给出\\[\\begin{aligned}h^*(t)&=\\frac{d_j}{(n_j^\\prime-d_j/2)\\tau_j}\\end{aligned}\\]其中 \\(t'_{j-1}\\leqslant t<t'_j,j=1,2,\\ldots,m\\)，因此 \\(h^*(t)\\) 是阶跃函数。Gehan (1969) 表明该估计的渐近标准误为\\[\\begin{aligned}\\text{se}\\left\\{h^*(t)\\right\\}&=\\frac{h^*(t)\\surd\\{1-[h^*(t)\\tau_j/2]^2\\}}{\\surd(d_j)}\\end{aligned}\\]\\(m\\) 个时间区间中每个时间区间内相应真实风险的置信区间可以按照 2.2.3 节中描述的方式获得。示例 2.6  (多发性骨髓瘤患者的生存) 表 2.1 给出了示例 1.3 中 48 名多发性骨髓瘤患者生存时间数据生存函数的生命表估计。使用与示例 2.2 中相同的时间区间，表 2.5 中给出了风险函数生命表估计的计算结果。\n风险函数估计如图 2.7 所示，为阶跃函数。一般的模式是，在确诊后的头两年内，风险大致保持不变，之后风险会下降，然后逐渐增加。然而，在解释这一估计时需要谨慎，因为确诊两年后很少有人死亡。","code":""},{"path":"chap2.html","id":"sec2-3-2","chapter":"第 2 章 一些非参数程序","heading":"2.3.2 Kaplan-Meier 型估计","text":"对于未分组的生存数据，估计风险函数的一种自然方法是，将给定死亡时间的死亡人数与该时间点处于风险的人数之比作为风险函数的估计。如果假设相邻死亡时间之间的风险函数是恒定的，那么可进一步通过将风险值除以时间区间的长度来找到单位时间的风险。因此，如果在第 \\(j\\) 个死亡时间 \\(t_{(j)}\\) 有 \\(d_j\\) 人死亡，\\(j=1,2,...,r\\)，且在时间 \\(t_{(j)}\\) 处于风险的人数为 \\(n_j\\)，那么区间 \\([t_j,t_{(j+1)})\\) 内的风险函数的估计为：\\[\\begin{equation}\n\\hat{h}(t)=\\frac{d_j}{n_j\\tau_j}\n\\tag{2.13}\n\\end{equation}\\]其中 \\(t_j\\le t<t_{(j+1)},\\tau_j=t_{(j+1)}-t_j\\)。请注意，无法使用式 (2.13) 来估计以最终死亡时间为起点的区间的风险，因为该区间是开的 (open-ended)。式 (2.13) 中的估计称为 Kaplan-Meier 型估计，因为从中得出的生存函数估计为 Kaplan-Meier 估计。为了证明这一点，请注意，由于 \\(\\hat{h}(t),t_{(j)}\\leqslant t<t_{(j+1)}\\) 是对第 \\(j\\) 个区间中每单位时间的死亡风险的估计，因此该区间中的死亡概率为 \\(\\hat{h}(t)\\tau_j\\)，即 \\(d_j/n_j\\)。因此，该区间中相应生存概率的估计为 \\(1−(d_j/n_j)\\)，生存函数估计如式 (2.4) 所示。可以根据 \\(d_j\\) 的方差得到 \\(\\hat h(t)\\) 的近似标准误，根据 2.2.1 节，可以假设 \\(d_j\\) 服从参数为 \\(n_j,p_j\\) 的二项分布，其中 \\(p_j\\) 是长度为 \\(\\tau\\) 的区间内的死亡概率。因此 \\(\\text{var}\\left(d_j\\right)=n_jp_j\\left(1-p_j\\right)\\)，使用 \\(d_j/n_j\\) 估计 \\(p_j\\)，从而给出\\[\\text{se}\\left\\{\\hat{h}(t)\\right\\}=\\hat{h}(t)\\sqrt{\\frac{n_j-d_j}{n_jd_j}}\\]然而当 \\(d_j\\) 很小时，使用该标准误构建的置信区间太宽，实际无法使用。示例 2.7  (停用宫内节育器的时间) 再次考虑示例 1.1 中给出的 18 名妇女停用宫内节育器的时间数据。表 2.2 给出了这些数据的生存函数的 Kaplan-Meier 估计，表 2.6 给出了根据式 (2.13) 计算的风险函数的相应 Kaplan-Meier 型估计。还给出了 \\(\\hat h(t)\\) 的近似标准误。\n图 2.8 显示了风险函数估计图。从这个图像来看，有一些证据表明，宫内节育器使用的时间越长，停用的风险就越大，但情况并不十分清楚。风险函数估计在不同时间的近似标准误对解释该图几乎没有帮助。在实践中，通过这种方式获得的风险函数估计往往会相当不规则。因此，可以对风险函数图进行“平滑” (smoothed) 处理，以便更清楚地看到任何模式。有多种方法可以平滑风险函数，这些方法会得到在 \\(t\\) 邻域内的死亡时间点上估计风险函数 \\(\\hat h(t)\\) 的加权平均值。例如，基于 \\(r\\) 个有序的死亡时间 \\(t_{(1)}, t_{(2)},...,t_{(r)}\\)，在时间 \\(t_{(j)}\\) 有 \\(d_j\\) 人死亡以及 \\(n_j\\) 人处于风险中，可以通过以下方式找到基于核函数平滑的风险函数估计：\\[h^\\dagger(t)=b^{-1}\\sum_{j=1}^r0.75\\left\\{1-\\left(\\frac{t-t_{(j)}}{b}\\right)^2\\right\\}\\frac{d_j}{n_j}\\]其中 \\(b\\) 的值需要选择。函数 \\(h^\\dagger (t)\\) 定义在从 \\(b\\) 到 \\(t_{(r)}−b\\) 区间所有的 \\(t\\) 值上，其中 \\(t_{(r)}\\) 是最大的死亡时间。对于这个区间内的任何 \\(t\\) 值，区间 \\((t−b,t+b)\\) 内的死亡时间都会对该加权平均值有所贡献。参数 \\(b\\) 称为带宽 (bandwidth)，其值控制着图形的形状；\\(b\\) 的值越大，平滑程度就越高。有公式可以导出“最优”的 \\(b\\) 值，但这些公式往往相当繁琐。有关详情可以在本章最后一节提供的参考文献中找到。在本书中，我们提倡使用建模方法分析生存数据，因此，后续章节将考虑基于模型的风险函数估计。","code":""},{"path":"chap2.html","id":"sec2-3-3","chapter":"第 2 章 一些非参数程序","heading":"2.3.3 估计累积风险函数","text":"如第 1 章 1.4.3 节所述，根据在给定时间内发生的预期事件数对累积风险函数进行解释，该函数在识别生存数据模型方面很重要，这将在 4.4 节和 5.2 节中看到。此外，由于累积风险函数的导数是风险函数本身，因此累积风险函数斜率提供了有关潜在风险函数形状的信息。例如，在某个时间区间内的线性累积风险函数表明，风险在该时间区间内是恒定的。现在描述可用于估计该函数的方法。时间 \\(t\\) 的累积风险 \\(H(t)\\) 在式 (1.7) 中定义为风险函数的积分，但使用式 (1.8) 来求解更为简便。根据这一结果，我们有 \\(H(t) = -\\log S(t)\\)，其中 \\(S(t)\\) 表示生存函数，即在时间 \\(t\\) 仍然生存的概率。现在使用式 (2.4)\\[\\begin{aligned}\\hat{H}(t)&=-\\sum_{j=1}^k\\log\\left(\\frac{n_j-d_j}{n_j}\\right)\\end{aligned}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r\\) 且 \\(t_{(1)},t_{(2)},\\ldots,t_{(r)}\\) 为 \\(t\\) 个有序的死亡时间且 \\(t_{(r+1)}=\\infty\\)。若使用风险函数的 Nelson-Aalen 估计，则累积风险函数估计 \\(\\tilde{H}(t)=-\\log\\tilde{S}(t)\\) 由下式给出\\[\\begin{aligned}\\tilde{H}(t)=\\sum_{j=1}^k\\frac{d_j}{n_j}\\end{aligned}\\]这是从第一个时间区间到第 \\(k\\) 个时间区间的死亡概率估计的累积和，\\(k=1,2,\\ldots r\\)。 因此，这个量作为累积风险的估计是直观的。如果数据中最长的生存时间是右删失的，则生存函数的 Kaplan-Meier 估计在该时间之后为 0，并且无法确定 \\(\\hat{H}(t)=-\\operatorname{log}\\hat{S}(t)\\) 的值。然而，当使用 Nelson-Aalen 估计 \\(\\tilde H(t)\\) 时，可以在最晚的事件时间估计累积风险函数。对累积风险函数的估计也可以推导出相应风险函数的估计，因为将估计的累积风险函数相邻值之差除以时间区间长度后，就能得到风险估计。具体来说，Nelson-Aalen 累积风险估计相邻值之差可以直接推导出 2.3.2 节中风险函数的估计。","code":""},{"path":"chap2.html","id":"sec2-4","chapter":"第 2 章 一些非参数程序","heading":"2.4 估计生存时间的中位数和百分位数","text":"由于生存时间的分布往往呈正偏态，因此中位数是分布位置首选的总结性度量。一旦估计了生存函数，就可以直接获得中位生存时间的估计。这是所研究总体中 50% 的个体预期生存的时间，由值 \\(t{(50)}\\) 给出，即 \\(S\\{t(50)\\} = 0.5\\)。因为 \\(S(t)\\) 的非参数估计是阶跃函数，所以通常无法得到使生存函数恰好等于 0.5 的生存时间估计。相反，中位生存时间估计 \\(\\hat t (50)\\) 定义为生存函数估计小于 0.5 的最小观测生存时间。在数学形式上\\[\\begin{aligned}\\hat{t}(50)=\\min\\{t_i\\mid\\hat{S}(t_i)<0.5\\}\\end{aligned}\\]其中 \\(t_i\\) 是第 \\(\\) 个个体的生存时间，\\(=1,2,\\ldots,n\\)。由于生存函数估计只在死亡时发生变化，这相当于定义\\[\\begin{aligned}\\hat{t}(50)=\\min\\{t_{(j)}\\mid\\hat{S}(t_{(j)})<0.5\\}\\end{aligned}\\]其中 \\(t_{(j)}\\) 为第 \\(j\\) 个死亡时间，\\(j=1,2,\\ldots,r\\)。在特定情况下，当生存函数估计在 \\(t_{(j)}\\) 到 \\(t_{(j+1)}\\) 的区间内的值恰好等于 0.5 时，中位数取该区间的中点，即 \\((t_{(j)} + t_{(j+1)})/2\\)。当不存在删失生存时间时，中位生存时间估计将是样本中超过 50% 的个体能够生存的最短时间。示例 2.8  (停用宫内节育器的时间) 表 2.2 中给出了示例 1.1 中关于停用宫内节育器时间数据生存函数的 Kaplan-Meier 估计。这些数据的生存函数估计，\\(\\hat S(t)\\)，示于图 2.4 中。根据生存函数估计，停用概率估计小于 0.5 的最小停用时间为 93 周。因此，这是该研究中停用宫内节育器的中位时间估计。可以使用与上述描述类似的方法来估计生存时间分布的其他百分位数。生存时间分布的第 \\(p\\) 个百分位数定义为值 \\(t(p)\\)，使得对于 0 到 100 之间的任何 \\(p\\) 值有 \\(F\\{t(p)\\} = p/100\\)。就生存函数而言，\\(t(p)\\) 是使得 \\(S\\{t(p)\\} = 1 − (p/100)\\) 的值，因此第 10 和第 90 百分位数由下式给出：\\[\\begin{aligned}S\\{t(10)\\}=0.9,\\quad S\\{t(90)\\}=0.1\\end{aligned}\\]利用生存函数估计，第 \\(p\\) 个百分位数的估计是最小的观测生存时间 \\(\\hat t (p)\\)，其满足 \\(\\hat S\\{\\hat t(p)\\} < 1 − (p/100)\\)。有时，对于所有的 \\(t\\) 值，生存函数估计都大于 0.5，此时无法估计中位生存时间，因此自然会用生存时间分布的其他百分位数或特定时间点的生存概率估计来总结数据。生存数据样本离散 (dispersion) 的估计并未广泛使用，但若需要这样的估计，则可以计算半四分位距 (semi-interquartile range, SIQR)。这定义为生存时间分布的第 75 百分位数和第 25 百分位数之差的一半。即\\[\\begin{aligned}SIQR=\\frac{1}{2}\\left\\{t(75)-t(25)\\right\\}\\end{aligned}\\]其中 \\(t(25)\\) 和 \\(t(75)\\) 是生存时间分布的第 25 个和第 75 个百分位数。这两个百分位数也分别称为第一个和第三个四分位数。相应的基于样本的 \\(SIQR\\) 估计为 \\(\\{\\hat{t}(75)-\\hat{t}(25)\\}/2\\)。与方差一样，\\(SIQR\\) 值越大，生存时间分布离散程度越大。示例 2.9  (停用宫内节育器的时间) 根据表 2.2 中给出的示例 1.1 数据生存函数的 Kaplan-Meier 估计，停止时间分布的第 25 和第 75 百分位数分别为 36 周和 107 周。因此，分布的 \\(SIQR\\) 估计为 35.5 周。","code":""},{"path":"chap2.html","id":"sec2-5","chapter":"第 2 章 一些非参数程序","heading":"2.5 中位数和百分位数的置信区间","text":"一旦获得百分位数估计的方差，就可以得到生存时间分布的中位数和其他百分位数的近似置信区间。百分位数近似方差的表达式可以通过直接应用式 (2.8) 中随机变量函数方差的一般结果来导出。使用这个结果\\[\\begin{equation}\n\\mathrm{var}\\left[\\hat{S}\\{t(p)\\}\\right]=\\left(\\frac{\\mathrm{d}\\hat{S}\\{t(p)\\}}{\\mathrm{d}t(p)}\\right)^2\\mathrm{var}\\left\\{t(p)\\right\\}\n\\tag{2.14}\n\\end{equation}\\]其中 \\(t(p)\\) 是分布的第 \\(p\\) 个百分位数，\\(\\hat{S}\\{t(p)\\}\\) 是生存函数在 \\(t(p)\\) 处的 Kaplan-Meier 估计。现在\\[-\\frac{\\mathrm{d}\\hat{S}\\{t(p)\\}}{\\mathrm{d}t(p)}=\\hat{f}\\{t(p)\\}\\]为 \\(t(p)\\) 时生存时间的概率密度函数的估计，将其代入式 (2.14) 并整理后，我们得到\\[\\mathrm{var}\\left\\{t(p)\\right\\}=\\left(\\frac1{\\hat{f}\\{t(p)\\}}\\right)^2\\mathrm{var}\\left[\\hat{S}\\{t(p)\\}\\right]\\]因此，估计的第 \\(p\\) 个百分位数 \\(\\hat t(p)\\) 的标准误由下式给出\\[\\begin{equation}\n\\mathrm{se}\\left\\{\\hat{t}(p)\\right\\}=\\frac1{\\hat{f}\\{\\hat{t}(p)\\}}\\operatorname{se}\\left[\\hat{S}\\{\\hat{t}(p)\\}\\right]\n\\tag{2.15}\n\\end{equation}\\]使用式 (2.12) 中给出的生存函数 Kaplan-Meier 估计的标准误的 Greenwood 公式，可以得到 \\(\\hat{S}\\{t(p)\\}\\) 的标准误，而 \\(\\hat t(p)\\) 的概率密度函数的估计为\\[\\hat{f}\\{\\hat{t}(p)\\}=\\frac{\\hat{S}\\{\\hat{u}(p)\\}-\\hat{S}\\{\\hat{l}(p)\\}}{\\hat{l}(p)-\\hat{u}(p)}\\]其中\\[\\begin{aligned}\\hat{u}(p)&=\\max\\left\\{t_{(j)}\\mid\\hat{S}(t_{(j)})\\geqslant1-\\frac p{100}+\\epsilon\\right\\}\\\\\\hat{l}(p)&=\\min\\left\\{t_{(j)}\\mid\\hat{S}(t_{(j)})\\leqslant1-\\frac p{100}-\\epsilon\\right\\}\\end{aligned}\\]其中 \\(j=1,2,\\ldots,r\\) 和较小的 \\(\\varepsilon\\) 值。在许多情况下，取 \\(\\varepsilon=0.05\\) 可满足要求，但如果事实证明 \\(\\hat u(p)\\) 和 \\(\\hat l(p)\\) 相等，则需要更大的 \\(\\varepsilon\\) 值。特别地，根据式 (2.15)，中位生存时间的标准误由下式给出\\[\\begin{equation}\n\\operatorname{se}\\left\\{\\hat{t}(50)\\right\\}=\\frac1{\\hat{f}\\{\\hat{t}(50)\\}}\\operatorname{se}\\left[\\hat{S}\\{\\hat{t}(50)\\}\\right]\n\\tag{2.16}\n\\end{equation}\\]其中 \\(\\hat{f}\\{\\hat{t}(50)\\}\\) 为\\[\\begin{equation}\n\\hat{f}\\{\\hat{t}(50)\\}=\\frac{\\hat{S}\\{\\hat{u}(50)\\}-\\hat{S}\\{\\hat{l}(50)\\}}{\\hat{l}(50)-\\hat{u}(50)}\n\\tag{2.17}\n\\end{equation}\\]在此表达式中，\\(\\hat u(50)\\) 是生存函数的 Kaplan-Meier 估计超过 0.55 的最大生存时间，\\(\\hat l(50)\\) 是生存函数小于等于 0.45 的最小生存时间。一旦得到第 \\(p\\) 个百分位数的标准误估计，\\(t(p)\\) 的 \\(100(1 − \\alpha)\\%\\) 置信限为\\[\\begin{aligned}\\hat{t}(p)\\pm z_{\\alpha/2}\\text{se}\\{\\hat{t}(p)\\}\\end{aligned}\\]其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上（单侧）\\(\\alpha/2\\) 分位点。此区间估计只是近似值，因为该区间包含真实百分位数的概率不会恰好为 \\(1 − \\alpha\\)。虽然有许多其他方法来构建具有优良特性的中位置信区间，但这些方法比本节考虑的区间估计更难计算。示例 2.10  (停用宫内节育器的时间) 使用示例 1.1 中给出的宫内节育器使用者停用时间的数据来说明中位停用时间置信区间的计算。根据示例 2.8，该组女性中位停用时间估计为 \\(\\hat t(50) = 93\\) 周。另外，从表 2.4 可以看出，此时生存函数的 Kaplan-Meier 估计的标准误为 \\([\\hat{S}\\{\\hat{t}(50)\\}]=0.1452\\)。为了使用式 (2.16) 获得 \\(\\hat t(50)\\) 的标准误，我们需要估计中位停止时间处的密度函数。这是从式 (2.16) 获得的。该方程中所需的量 \\(\\hat u(50),\\hat l(50)\\) 为：\\[\\begin{aligned}\\hat{u}(50)&=\\max\\{t_{(j)}\\mid\\hat{S}(t_{(j)})\\geqslant0.55\\}\\\\\\hat{l}(50)&=\\min\\{t_{(j)}\\mid\\hat{S}(t_{(j)})\\leqslant0.45\\}\\end{aligned}\\]其中 \\(t_{(j)}\\) 为第 \\(j\\) 个停用时间，\\(j=1,2,\\ldots,9\\)。使用表 2.4，\\(\\hat u(50)=75,\\hat l(50)=97\\)，因此\\[\\hat{f}\\{\\hat{t}(50)\\}=\\frac{\\hat{S}(75)-\\hat{S}(97)}{97-75}=\\frac{0.5594-0.3729}{22}=0.0085\\]那么中位数的标准误由下式给出\\[\\mathrm{se}\\left\\{\\hat{t}(50)\\right\\}=\\frac1{0.0085}\\times0.1452=17.13\\]中位停用时间的 95% 置信限为\\[93\\pm1.96\\times17.13\\]因此中位数区间估计范围为 59 到 127 天。","code":""},{"path":"chap2.html","id":"sec2-6","chapter":"第 2 章 一些非参数程序","heading":"2.6 两组生存数据的比较","text":"比较根据两组个体获得的生存时间的最简单方法是将两个生存函数的相应估计绘制在同一张图中。生成的图像可以提供非常丰富的信息，如下例所示。示例 2.11  (患乳腺癌妇女的预后) 示例 1.2 给出了乳腺癌妇女的生存时间数据，根据肿瘤切片是否被 HPA 阳性染色分组。图 2.9 显示了两组生存时间的 Kaplan-Meier 生存函数估计。注意，在该图中，Kaplan-Meier 估计延伸至每组最大删失观测的时间。该图显示，肿瘤染色阴性的女性的生存函数估计总是大于肿瘤染色阳性的女性。这意味着在任何时间 \\(t\\)，肿瘤染色阴性的女性在 \\(t\\) 后的生存概率估计都更大，这表明 HPA 染色程序的结果可能是一个有用的预后指标：那些肿瘤阳性染色的妇女的预后似乎比那些肿瘤阴性染色的妇女的预后差。对于两个生存函数估计之间的差异有两种可能的解释，如示例 2.11。一种解释是两组个体的生存时间之间存在真实的差异，所以一组人的生存经历与另一组人不同。另一种解释是，每组的生存时间之间没有真正的差异，差异只是偶然的变异导致的。我们使用了一种称为假设检验 (hypothesis test) 的程序。 由于假设检验的概念在生存数据的分析中起着核心作用，因此在以下部分中详细描述了该程序的底层逻辑。","code":""},{"path":"chap2.html","id":"sec2-6-1","chapter":"第 2 章 一些非参数程序","heading":"2.6.1 假设检验","text":"假设检验是一个程序，使我们能够评估数据集与特定假设（称为工作假设或原假设, working null hypothesis）一致的程度。原假设通常代表数据生成过程的简化视图 (simplified view)，其代表指定两组生存数据之间没有差异的假设，或者生存时间与年龄或血清胆固醇水平等解释变量之间没有关系的假设，诸如此类。原假设就是将被采用并随后采取行动的假设，除非数据表明它是站不住脚的。下一步是制定检验统计量 (test statistic)，衡量数据偏离原假设的程度。一般来说，检验统计量的构造使得统计量的值越大，与原假设的偏离就越大。因此，如果原假设是两组之间没有差异，则检验统计量的相对较大值将成为反对原假设的证据。一旦从观测数据中获得了检验统计量的值，当原假设成立时，我们计算获得与观测一样极端或比观测更极端的值的概率。该量总结了样本数据反对原假设的证据的强度，简称为概率值或 \\(P\\) 值。如果 \\(P\\) 值很大，我们会得出结论，数据很可能是在原假设成立时获得的，并且没有证据拒绝原假设。另一方面，如果 \\(P\\) 值很小，这成为反对原假设的证据；\\(P\\) 值越小，证据就越有力。为了获得假设检验的 \\(P\\) 值，当原假设为真时，检验统计量必须具有已知或至少近似已知的概率分布。这种概率分布称为检验统计量的原分布 (null distribution)。更确切地说，考虑一个检验统计量 \\(W\\)，它使得检验统计量的观测值 \\(w\\) 越大，观测数据与原假设下预期数据的偏差就越大。如果 \\(W\\) 具有连续概率分布，则 \\(P\\) 值为 \\(\\text{P}(W\\ge w)=1−F(w)\\)，其中 \\(F(w)\\) 为在原假设成立的情况下 \\(W\\) 的分布函数在 \\(w\\) 处的值。在一些应用中，最自然的检验统计量为：大的正值对应于在一个方向上偏离原假设，而小的负值对应于在相反方向上的偏离。例如，假设患有特定疾病的患者被随机分配接受标准疗法或新疗法，并记录他们的生存时间。在这种情况下，一个令人感兴趣的原假设是，两组患者的生存经历没有差异。数据与该原假设一致的程度可以通过检统计量来总结，其中正值表示新疗法优于标准疗法，而负值表示标准疗法优于新疗法。当在任何一个方向上偏离原假设都同等重要时，称原假设具有双侧备择 (two-sided alternative)，而该假设检验称为双侧检验 (two-sided test).若 \\(W\\) 是这样的检验统计量：大的正观测值或小的负观测值将拒绝原假设，则可以定义新的检验统计量，例如 \\(|W|\\) 或 \\(W^2\\)，使得只有大的新统计量的正值具有拒绝原假设的证据。例如，假设 \\(W\\) 是一个检验统计量，在原假设下服从标准正态分布。如果 \\(w\\) 是 \\(W\\) 的观测值，则适当的 \\(P\\) 值是 \\(\\text{P}(W\\leqslant-|w|)+\\text{P}(W\\geqslant|w|)\\)。或者，我们可以利用这样的结果：若 \\(W\\) 服从标准正态分布，则 \\(W^2\\) 服从自由度为 \\(1\\) 的卡方分布，记为 \\(\\chi^2_1\\)。因此，基于统计量 \\(W\\) 的双侧假设检验的 \\(P\\) 值是随机变量 \\(\\chi^2_1\\) 超过 \\(w^2\\) 的概率。因此可从标准正态分布函数或卡方分布函数得到所需的 \\(P\\) 值。当兴趣集中在特定方向的偏离上时，假设检验是单侧的 (one-sided). 例如，在比较两组患者的生存时间时，其中一组接受标准疗法，另一组接受新疗法，可能会认为新疗法不劣于标准疗法。那么，对于声称没有治疗差异的原假设，唯一相关的备择假设是新疗法优于标准疗法。如果检验统计量 \\(W\\) 的正值反映了新疗法的优效性，则 \\(P\\) 值为 \\(\\text P(W\\ge w)\\)。如果 \\(W\\) 服从标准正态分布，则该 \\(P\\) 值是相应双侧备择假设所得 \\(P\\) 值的一半。单侧假设检验只在如下情况下适用：对与单侧备择假设指定方向相反的原假设没有任何兴趣。例如，再次考虑新疗法与标准疗法的比较，并假设检验统计量的观测值为正或为负，具体取决于新疗法是优于还是劣于标准疗法。如果声称无治疗差异的原假设的备择是新疗法更优，那么检验统计量小的负值将无法成为拒绝原假设的证据。相反，可以假设这个小的负值只是偶然变异的结果。一般来说，在医学研究中很少有理由使用单侧检验，因此本书将使用双侧检验。如果 \\(P\\) 值小于某个值 \\(\\alpha\\)，我们就说假设在 \\(100\\alpha\\%\\) 显著性水平上被拒绝。检验统计量的观测值在此水平上认为是显著的。但是我们如何根据 \\(P\\) 值决定是否应该真正拒绝原假设呢？传统上，\\(0.05\\) 或 \\(0.01\\) 的 \\(P\\) 值用于决定是否应拒绝原假设，因此，例如，若 \\(P < 0.05\\)，则在 \\(5\\%\\) 显着性水平下拒绝原假设。诸如此类的指导方针并不是硬性规定，不应严格解释。例如，\\(0.046\\) 和 \\(0.056\\) 的 \\(P\\) 值之间实际上没有差异，尽管只有前者表明检验统计量的观测值在 \\(5\\%\\) 的水平上显著。更令人满意的策略是报告实际 \\(P\\) 的值，而不是报告在某个指定的显著性水平上拒绝或无法拒绝原假设。可以使用取决于 \\(P\\) 值所在范围的词汇，将此 \\(P\\) 值解释为反对原假设的证据强度的度量。因此，如果 \\(P > 0.1\\)，则表示没有证据拒绝原假设；如果 \\(0.05 < P ⩽ 0.1\\)，则有轻微证据反对原假设；如果 \\(0.01 < P ⩽ 0.05\\)，则有中等证据反对原假设；如果 \\(0.001 < P ≤ 0.01\\)，则有强有力的证据反对原假设；如果 \\(P ≤ 0.001\\)，则反对原假设的证据是压倒性的。除了引用与假设检验相关的确切 \\(P\\) 值外，另一种方法是当原假设为真时，将检验统计量的观测值与对应于特定 \\(P\\) 值的那些值进行比较。在特定显著性水平下导致拒绝原假设的检验统计量的值可以从该统计量的原分布的分位点中找到。例如，如果 \\(W\\) 是一个具有标准正态分布的检验统计量，对于双侧检验，分布的上 \\(\\alpha/2\\) 分位点（如图 2.5 所示）是检验统计量的值，其 \\(P\\) 值为 \\(\\alpha\\)。例如，检验统计量的值 1.96, 2.58 和 3.29 分别对应于 0.05, 0.01 和 0.001 的 \\(P\\) 值。因此，如果 \\(W\\) 的观测值在 1.96 和 2.58 之间，我们会声称在 0.01 的显著性水平下，结果是有意义的，但不足以拒绝原假设。\n对于常见的概率分布，例如正态分布和卡方分布，其百分位点在很多统计学入门教科书中都有表格列出，或者在 Lindley Scott (1984) 的统计表中也可以找到。用于基于计算机的生存数据统计分析的统计软件包通常会提供与假设检验相关的精确 \\(P\\) 值。请注意，当这些 \\(P\\) 值被四舍五入到小数点后三位时，应将 0.000 的 \\(P\\) 值解释为 \\(P < 0.001\\)。在决定采取行动时，例如是否拒绝两种疗法之间没有差异的假设，假设检验 \\(P\\) 值中总结的统计证据只是决策过程的一个部分。除了统计证据外，还需要考虑科学证据。例如，这可能涉及治疗效应的大小是否具有临床意义。特别是在大型试验中，当治疗效应很小并不能表明重大科学突破时，也可能会发现两种疗法之间的显著差异（例如在 \\(5\\%\\) 的水平下）。另一方面，可能有新的疗法将寿命延长两倍，但由于研究中使用的样本量较小，因此可能与标准疗法没有显著差异。与其根据假设检验程序的结果来报告发现，不如提供任何治疗差异大小的估计，并由该差异的置信区间来支持，这更具信息性。不幸的是，本章中考虑的生存数据分析的非参数方法不适用于这种方法。因此，当我们考虑生存数据的模型时，我们将在随后的章节中考虑这个主题。在两组生存时间的比较中，有许多方法可以用来量化组间差异的程度。现在将考虑三种非参数程序，即 log-rank 检验、Wilcoxon 检验和 Peto-Peto 检验。","code":""},{"path":"chap2.html","id":"sec2-6-2","chapter":"第 2 章 一些非参数程序","heading":"2.6.2 log-rank 检验","text":"为了构建 log-rank 检验，我们首先分别考虑两组生存数据中的每个死亡时间。组别记为 Group 和 Group II。假设在两组中有 \\(r\\) 个不同的死亡时间，记为 \\(t(1)<t(2)<\\cdots<t(r)\\)，并且在时间 \\(t(j)\\)，Group 中有 \\(d_{1j}\\) 个个体、Group 中有 \\(d_{2j}\\) 个个体死亡，其中 \\(j=1,2,\\ldots,r\\)。除非一组中有两个或两个以上的个体具有相同的记录死亡时间，\\(d_{1j}\\) 和 \\(d_{2j}\\) 的值要么为 0，要么为 1。进一步假设，在时间 \\(t_{(j)}\\) 之前，Group 中有 \\(n_{1j}\\) 个个体面临死亡风险，Group II 中有 \\(n_{2j}\\) 个个体面临死亡风险。因此，在时间 \\(t_{(j)}\\)，总共有 \\(d_j = d_{1j} + d_{2j}\\) 个死亡个体，而处于风险的个体总数为 \\(n_j = n_{1j} + n_{2j}\\)。表 2.7 总结了这一情况。\n现在考虑一个原假设，即两组个体的生存经历没有差异。评估这一假设有效性的一个方法是考虑在每个死亡时间点上，两组中死亡个体数量与在原假设下预期的数量之间的差异程度。然后，可以将这些差异程度的信息在每个死亡时间点上进行合并。如果表 2.7 中的边际总数被视为固定的，并且生存率与分组无关的原假设为真，则该表中的四个条目仅由 \\(d_{1j}\\) 的值决定。因此，我们可以将 \\(d_{1j}\\) 视为一个随机变量，它可以取从 \\(0\\) 到 \\(d_j\\) 和 \\(n_{1j}\\) 的最小值中的任何值。事实上，\\(d_{1j}\\) 服从超几何分布 (hypergeometric distribution)，根据该分布，与第一组死亡人数相关的随机变量取值 \\(d_{1j}\\) 的概率为\\[\\begin{equation}\n\\frac{\\left(\\begin{array}{c}d_j\\\\d_{1j}\\end{array}\\right)\\left(\\begin{array}{c}n_j-d_j\\\\n_{1j}-d_{1j}\\end{array}\\right)}{\\left(\\begin{array}{c}n_j\\\\n_{1j}\\end{array}\\right)}\n\\tag{2.18}\n\\end{equation}\\]在这个公式中，表达式\\[\\left.\\left(\\begin{array}{c}d_j\\\\d_{1j}\\end{array}\\right.\\right)\\]表示可以从 \\(d_j\\) 个时间中选择 \\(d_{1j}\\) 个时间的不同方式的数量，读作 “\\(d_j \\,C\\, d_{1j}\\)”，它的值为\\[\\left.\\left(\\begin{array}{c}d_j\\\\d_{1j}\\end{array}\\right.\\right)=\\frac{d_j!}{d_{1j}!(d_j-d_{1j})!}\\]其中 \\(d_j!\\) 读作 “\\(d_j\\) 的阶乘”，有\\[\\begin{aligned}d_j!=d_j\\times(d_j-1)\\times\\cdots\\times2\\times1\\end{aligned}\\]式 (2.18) 中的其他两项是类似的。超几何随机变量 \\(d_{1j}\\) 的均值由下式给出\\[\\begin{equation}\ne_{1j}=n_{1j}d_j/n_j\n\\tag{2.19}\n\\end{equation}\\]\\(e_{1j}\\) 是在 Group 在时间 \\(t_{(j)}\\) 死亡的个体的预期数量。该值在直观上很有吸引力，因为在原假设下在时间 \\(t_{(j)}\\) 死亡的概率不取决于个体所在的组别，其中在时间 \\(t_{(j)}\\) 死亡的概率为 \\(d_j/n_j\\)。将其乘以 \\(n_{1j}\\)，得到的 \\(e_{1j}\\) 为时间 \\(t_{(j)}\\) 时 Group 的预期死亡人数。下一步是将每个死亡时间的 2 × 2 表格中的信息组合起来，给出 \\(d_{1j}\\) 观测值与其预期值偏差的总体度量。最简单的方法是在两组中将差值 \\(d_{1j}−e_{1j}\\) 关于两组死亡时间总数 \\(r\\) 相加。得出的统计量由下式给出\\[\\begin{equation}\nU_L=\\sum_{j=1}^r(d_{1j}-e_{1j})\n\\tag{2.20}\n\\end{equation}\\]注意到这等于 \\(\\sum d_{1j}-\\sum e_{1j}\\)，也就是 Group 总死亡人数和预期死亡人数之差。此统计量的均值为 0，因为 \\(\\mathrm{E}\\left(d_{1j}\\right)=e_{1j}\\)。此外，由于死亡时间彼此独立，\\(U_L\\) 的方差就是 \\(d_{1j}\\) 的方差之和。现在，由于 \\(d_{1j}\\) 服从超几何分布，\\(d_{1j}\\) 的方差由下式给出\\[\\begin{equation}\nv_{1j}=\\frac{n_{1j}n_{2j}d_j(n_j-d_j)}{n_j^2(n_j-1)}\n\\tag{2.21}\n\\end{equation}\\]因此 \\(U_L\\) 的方差为\\[\\begin{equation}\n\\operatorname{var}\\left(U_L\\right)=\\sum_{j=1}^rv_{1j}=V_L\n\\tag{2.22}\n\\end{equation}\\]此外可以表明，当死亡时间数不太小时，\\(U_L\\) 近似服从正态分布。因此，\\(U_L/√V_L\\) 具有零均值和单位方差的正态分布，记作 \\(N(0,1)\\)。因此我们写\\[\\begin{aligned}\\frac{U_L}{\\sqrt{V_L}}\\sim N(0,1)\\end{aligned}\\]符号 “\\(\\sim\\)” 读作“分布于” (distributed ) 。标准正态随机变量的平方服从自由度为一的卡方分布，记作 \\(\\chi^2_1\\)，因此我们有\\[\\begin{equation}\n\\frac{U_L^2}{V_L}\\sim\\chi_1^2\n\\tag{2.23}\n\\end{equation}\\]这种在多个 \\(2 × 2\\) 表中组合信息的方法是由 Mantel Haenszel (1959) 提出的，称为 Mantel-Haenszel 程序。事实上，基于这一统计量的检验有各种各样的名字，包括 Mantel Cox 和 Peto Mantel Haenszel，但最为人所知的是 log-rank 检验。之所以取这个名字，是因为检验统计量可以从两组生存时间的秩中推导出来，而得到的秩检验统计量是基于生存函数 Nelson-Aalen 估计的对数。统计量 \\(W_L = U^2_L/V_L\\) 总结了两组数据中生存时间与无组间差异原假设下预期生存时间的偏离程度。该统计量的值越大，反对原假设的证据就越多。由于 W 的原分布近似为一个自由度的卡方，因此可以从卡方随机变量的分布函数获得与检验统计量相关的 \\(P\\) 值。或者，可以使用卡方分布的百分位点来确定 \\(P\\) 值所在的范围。下面的示例 2.12 给出了 log-rank 检验的说明。示例 2.12  (患乳腺癌妇女的预后) 在此示例中，我们回到有关乳腺癌妇女生存时间的数据，根据肿瘤染色呈阳性还是阴性进行分组。我们将使用 log-rank 检验来检验两组的生存经历无差异的原假设。所需的计算列于表 2.8。\n我们首先对两组女性的死亡时间进行排序；这些时间在表 2.8 的第 1 列中给出。然后计算每组在每个死亡时间下死亡的女性人数以及每个时间处于风险的人数。\\(d_{1j},n_{1j},d_{2j}\\) 和 \\(n_{2j}\\) 的值在表中第 2 至 5 列给出。第 6 列和第 7 列包含在每个死亡时间的死亡总数和处于风险的人数的总数。最后两列给出 \\(e_{1j}\\) 和 \\(v_{1j}\\) 的值，分别根据式 (2.19) 和 (2.21) 计算。将第 2 列和第 8 列中的条目相加得出 \\(d_{1j}\\) 和 \\(e_{1j}\\)，可以根据 \\(U_L = d_{1j} − e_{1j}\\) 计算 log-rank 统计量。值 \\(V_L = v_{1j}\\) 可以通过对最后一列中的条目求和来获得。我们发现 \\(U_L = 5 − 9.565 = −4.565\\) 且 \\(V_L = 5.929\\)，因此 log-rank 检验统计量的值为 \\(W_L = (−4.565)^2/5.929 = 3.515\\)。相应的 \\(P\\) 值是根据自由度为一的卡方变量大于等于 3.515 的概率来计算的，结果 0.061，记作 \\(P = 0.061\\)。该 \\(P\\) 值足够小，足以对两组女性生存函数没有差异的原假设产生怀疑。事实上，反对原假设的证据在 6% 的水平上几乎是显著的。因此，我们得出结论，这些数据确实提供了一些证据，表明乳腺癌患者的预后取决于染色程序的结果。","code":""},{"path":"chap2.html","id":"sec2-6-3","chapter":"第 2 章 一些非参数程序","heading":"2.6.3 Wilcoxon 检验","text":"Wilcoxon 检验，有时称为 Breslow 检验或 Gehan-Breslow 检验，也用于检验两组生存数据的生存函数没有差异的原假设。Wilcoxon 检验基于统计量\\[\\begin{aligned}U_W=\\sum_{j=1}^rn_j(d_{1j}-e_{1j})\\end{aligned}\\]其中，如上一节所述，\\(d_{1j}\\) 是第一组中时间 \\(t_{(j)}\\) 的死亡人数，\\(e_{1j}\\) 如式 (2.19) 定义。\\(U_W\\) 和 \\(U_L\\) 之间的区别在于，在 Wilcoxon 检验中，每个差异 \\(d_{1j} − e_{1j}\\) 的权重均为 \\(n_j\\)（时间 \\(t_{(j)}\\) 时处于风险的个体总数）。这样做的效果是，在仍然生存的个体总数较小时，即在最长生存时间时，对 \\(d_{1j}\\) 与 \\(e_{1j}\\) 之差给予较小的权重。因此，与 log-rank 统计量相比，该统计量对生存时间分布尾部的 \\(d_{1j}\\) 与 \\(e_{1j}\\) 的偏差不太敏感。Wilcoxon 统计量 \\(U_W\\) 的方差由下式给出\\[V_W=\\sum_{j=1}^rn_j^2v_{1j}\\]其中 \\(v_{1j}\\) 由式 (2.21) 给出，因此 Wilcoxon 检验统计量为\\[\\begin{aligned}W_W=U_W^2/V_W\\end{aligned}\\]当原假设为真时，它服从自由度为一的卡方分布。因此，Wilcoxon 检验进行的方式与 log-rank 检验相同。","code":""},{"path":"chap2.html","id":"sec2-6-4","chapter":"第 2 章 一些非参数程序","heading":"2.6.4 Peto-Peto 检验","text":"当两组生存时间的删失模式不同时，Wilcoxon 检验表现不佳。如果将 Wilcoxon 统计量中的权重 \\(n_j\\)（即在时间 \\(t_{(j)}\\) 时处于风险的个体总数）替换为在时间 \\(t_{(j)}\\) 时生存函数的估计，则可以缓解这个问题。由于检验统计量是在原假设下计算的，即每组的生存函数之间没有差异，因此使用的是基于两组数据的合并数据的 Kaplan-Meier 生存函数估计。以 \\(\\hat S_{KM}(t)\\) 表示该估计，则 Peto-Peto 统计量为\\[\\begin{aligned}U_P=\\sum_{j=1}^r\\hat{S}_{KM}(t_{(j)})(d_{1j}-e_{1j})\\end{aligned}\\]其中 \\(d_{1j}\\) 和 \\(e_{1j}\\) 是第一组中在时间 \\(t_{(j)}\\) 观察到的和预期的死亡人数。与 Wilcoxon 检验一样，这样做的效果是在最长生存时间（当 \\(\\hat S_{KM}(t)\\) 很小时），对 \\(d_{1j}\\) 与 \\(e_{1j}\\) 之差给予较小的权重。Peto-Peto 统计量 \\(U_P\\) 的方差由下式给出\\[V_P=\\sum_{j=1}^r\\hat{S}_{KM}(t_{(j)})^2v_{1j}\\]其中 \\(v_{1j}\\) 由式 (2.21) 给出，因此 Peto-Peto 检验统计量为\\[W_P=U_P^2/V_P\\]在声称无总体差异的原假设下，它服从自由度为一的卡方分布。Peto-Peto 检验统计量 \\(W_P\\) 通常与 Wilcoxon 检验统计量非常相近。示例 2.13  (患乳腺癌妇女的预后) 对于阳性或阴性染色的肿瘤女性的生存时间数据，Wilcoxon 统计量的值为 \\(U_W = -159\\)，统计量的方差为 \\(V_W = 6048.136\\)。卡方统计量 \\(U^2_W /V_W\\) 的值为 4.180，相应的 \\(P\\) 值为 0.041。这略小于 log-rank 检验的 \\(P\\) 值，根据该结果，我们可以声明两组之间的差异在 5% 的水平上显著。对于 Peto-Peto 检验，\\(U_P = 3.603,V_P = 3.155\\)，因此 \\(W_P = U^2_P /V_P = 4.115\\)，\\(P\\) 值 0.043 ，这与 Wilcoxon 检验发现的结果相同。","code":""},{"path":"chap2.html","id":"sec2-6-5","chapter":"第 2 章 一些非参数程序","heading":"2.6.5 log-rank 检验、Wilcoxon 检验和 Peto-Peto 检验的比较","text":"在这三种检验中，当备择假设为某一组个体在任何给定时间的死亡风险与另一组相似个体的风险成比例时，log-rank 检验更适合。这是比例风险 (proportional hazards) 假设，是许多分析生存数据方法的基础。对于偏离原假设的其他类型，Wilcoxon 检验比 log-rank 检验更适合用于比较两个生存函数。然而，当组间删失模式不同时，Peto-Peto 检验确实表现得更好，并且在其他情况下与 Wilcoxon 检验的结果非常相似。因此，当比例风险假设存疑时，Peto-Peto 检验是 log-rank 检验的首选替代方案。为了确定在给定情况下哪种检验方法更适用，我们利用以下结果：如果风险函数成比例，则两组生存数据的生存函数不会相互交叉。为了证明这一点，假设 \\(h_1(t)\\) 是 Group 中个体在时间 \\(t\\) 的死亡风险，\\(h_2(t)\\) 是 Group II 中个体在同一时间的死亡风险。如果这两个风险成比例，那么我们可以有 \\(h_1(t) = \\psi h_2(t)\\)，其中 \\(\\psi\\) 是一个不依赖于时间 \\(t\\) 的常数。对这个表达式的两边进行积分，乘以 -1 并取指数，得到\\[\\begin{equation}\n\\exp\\left\\{-\\int_0^th_1(u)\\mathrm{d}u\\right\\}=\\exp\\left\\{-\\int_0^t\\psi h_2(u)\\mathrm{d}u\\right\\}\n\\tag{2.24}\n\\end{equation}\\]根据式 (1.6)\\[S(t)=\\exp\\left\\{-\\int_0^th(u)\\mathrm{d}u\\right\\}\\]因此，如果 \\(S_1(T)\\) 和 \\(S_2(T)\\) 是两组生存数据的生存函数，则根据式 (2.24)\\[S_1(t)=\\left\\{S_2(t)\\right\\}^\\psi \\]由于生存函数的取值范围在 0 到 1 之间，这一结果表明，在任何时间 \\(t\\)，\\(S_1(t)\\) 大于还是小于 \\(S_2(t)\\) 取决于 \\(\\psi\\) 是小于还是大于 1。这意味着如果两个风险函数成比例，那么真实的生存函数不会交叉。这是比例风险的必要条件，但不是充分条件。通过绘制两组生存数据的生存函数估计图（如图 2.9 所示），可以对比例风险假设的有效性进行非正式评估。如果两个生存函数估计没有交叉，那么比例风险假设可能是合理的，log-rank 检验也是适用的。当然，即使对应的真实风险函数成比例，基于样本的生存函数估计也可能交叉，因此在解释此类图形时需要谨慎。第 4 章 4.4.1 节介绍了一种更满意的图形方法，用于评估比例风险假设的有效性。总之，应使用 log-rank 检验来检验两个生存函数相等的假设，除非生存函数估计的曲线图或先前的数据表明有充分的理由怀疑比例风险假设。示例 2.14  (患乳腺癌妇女的预后) 从图 2.9 中的两个生存函数估计的曲线图中，我们可以看到，染色阴性的女性的生存函数始终高于染色阳性的女性的生存函数。这表明比例风险假设是适当的，并且 log-rank 检验比 Wilcoxon 或 Peto-Peto 检验更合适。然而，在这个例子中，三种假设检验的结果差别很小。","code":""},{"path":"chap2.html","id":"sec2-7","chapter":"第 2 章 一些非参数程序","heading":"2.7 三组或更多组生存数据的比较","text":"log-rank, Wilcoxon 和 Peto-Peto 检验都可以扩展到能够比较三组或更多组生存数据。假设要比较 \\(g\\ge 2\\) 组生存数据的生存分布。我们定义类似于 \\(U\\) 的统计量，用于将组 \\(1,2,\\ldots,g−1\\) 的观测死亡人数与它们的期望值进行比较。例如，使用 2.6 节中的记号，log-rank 统计量的一个明显的扩展为\\[\\begin{aligned}U_{Lk}=\\sum_{j=1}^r\\left(d_{kj}-\\frac{n_{kj}d_j}{n_j}\\right)\\end{aligned}\\]其中 \\(k=1,2,\\ldots,g-1\\)。这些量以具有 \\((g−1)\\) 个分量的向量的形式表示，记作 \\(\\boldsymbol U_L\\)。我们还需要 \\(U_{LK}\\) 的方差和协方差的表达式。其中，\\(U_{LK}\\) 和 \\(U_{LK^\\prime}\\) 之间的协方差由下式给出\\[V_{Lkk'}=\\sum_{j=1}^r\\frac{n_{kj}d_j(n_j-d_j)}{n_j(n_j-1)}\\left(\\delta_{kk'}-\\frac{n_{k'j}}{n_j}\\right)\\]其中 \\(k,k'=1,2,\\ldots,g-1\\)，以及\\[\\left.\\delta_{kk^{\\prime}}=\\left\\{\\begin{array}{l}1\\mathrm{~~}k=k^{\\prime},\\\\0\\text{ otherwise.}\\end{array}\\right.\\right.\\]然后将这些项以方差-协方差阵 \\(\\boldsymbol V_L\\) 的形式组装，该矩阵是一个对称阵，其中 \\(U_{Lk}\\) 的方差位于对角线，协方差项位于非对角线。例如，在比较三组生存数据时，该矩阵为\\[\\boldsymbol{V}_L=\\begin{pmatrix}V_{L11}&V_{L12}\\\\V_{L12}&V_{L22}\\end{pmatrix}\\]其中 \\(V_{L11}\\) 和 \\(V_{L22}\\) 分别是 \\(U_{L1}\\) 和 \\(U_{L2}\\) 的方差，\\(V_{L12}\\) 是它们的协方差。类似地，Wilcoxon 统计量的方差-协方差阵是矩阵 \\(\\boldsymbol V_W\\) ，其第 \\((k, k^′)\\) 个元素为\\[V_{Wkk^{\\prime}}=\\sum_{j=1}^rn_j^2\\frac{n_{kj}d_j(n_j-d_j)}{n_j(n_j-1)}\\left(\\delta_{kk^{\\prime}}-\\frac{n_{k^{\\prime}j}}{n_j}\\right)\\]其中 \\(k,k'=1,2,\\ldots,g-1\\)。而 Peto-Peto 检验统计量的相应元素为\\[\\begin{aligned}V_{Pkk'}=\\sum_{j=1}^r\\hat{S}_{KM}(t_j)^2\\frac{n_{kj}d_j(n_j-d_j)}{n_j(n_j-1)}\\left(\\delta_{kk'}-\\frac{n_{k'j}}{n_j}\\right)\\end{aligned}\\]最后，为了检验组间无差异的原假设，我们利用检验统计量 \\(\\boldsymbol{U}_L^{\\prime}\\boldsymbol{V}_L^{-1}\\boldsymbol{U}_L\\) 在原假设为真时服从自由度为 \\(g − 1\\) 的卡方分布这一结果。其他两个检验也是如此。用于分析生存数据的统计软件通常采用这种方法，并且由于对所得卡方统计量的解释很简单，因此这里不再给出示例。","code":""},{"path":"chap2.html","id":"sec2-8","chapter":"第 2 章 一些非参数程序","heading":"2.8 分层检验","text":"在许多情况下，在考虑到记录在每个个体上的其他变量之后，需要比较两组或多组生存数据。考虑一项多中心临床试验，比较两种化疗对肺癌病人生存时间的影响。每个中心都会提供有关每个治疗组患者生存时间的信息。由此产生的数据称为按中心分层 (stratified center)。基于每个中心数据的单独的 log-rank, Wilcoxon 或 Peto-Peto 检验将提供丰富的信息，但结合了所有中心治疗差异信息的检验可以提供更精确的治疗效果的总结。当根据年龄组、性别、表现状态和所研究疾病的其他潜在风险因素等变量对患者进行分层时，在试图检验治疗差异时，也会出现类似的情况。在上述情况下，可以采用 log-rank 的分层版本或其他检验。从本质上讲，这涉及到计算每层的 \\(U\\) 和 \\(V\\) 统计量，然后将这些值跨层合并。本节将描述分层 log-rank 检验，但也可以以类似的方式获得 Wilcoxon 和 Peto-Peto 检验的分层版本。第 11 章 11.2 节描述了基于生存时间模型的等价分析。设 \\(U_{Lk}\\) 是用于比较两个治疗组的 log-rank 统计量的值，这是使用式 (2.20) 从第 \\(k\\) 层中计算得出的。此外，用 \\(V_{Lk}\\) 表示第 \\(k\\) 层的统计量的方差，这是使用式 (2.21) 计算的。那么分层 log-rank 检验基于统计量\\[\\begin{equation}\nW_S=\\frac{\\left(\\sum_{k=1}^sU_{Lk}\\right)^2}{\\sum_{k=1}^sV_{Lk}}\n\\tag{2.25}\n\\end{equation}\\]在无治疗差异的原假设下，它服从自由度为一的卡方分布。将该统计量的观测值与卡方分布的百分位点进行比较，可以检验无总体治疗差异的假设。示例 2.15  (黑色素瘤患者的生存时间) University Oklahoma Health Sciences Center 进行了一项研究，旨在比较两种免疫疗法延长黑色素瘤患者生存期的能力，黑色素瘤是一种发生于皮肤的高度恶性肿瘤。对于每位患者，在分配卡介苗 (Bacillus Calmette-Gu´erin, BCG) 疫苗或基于短棒状杆菌 (Corynebacterium parvum, C. parvum) 的疫苗之前，均通过手术切除肿瘤。各治疗组患者的生存时间根据患者年龄组进一步分类，Lee Wang (2013) 给出的数据如表 2.9 所示。\n通过首先计算 log-rank 统计量来分析这些数据，以比较两个治疗组中每个年龄组患者的生存时间。使用式 (2.20), (2.22) 和 (2.23) 得出的 \\(U,V,W\\) 统计量的值总结于表 2.10 中。分层 log-rank 检验可进行扩展以比较两个以上的治疗组。得出的公式不适合手工计算，可以使用计算机软件进行生存分析。然而，这种考虑额外变量的方法不如下一章介绍的基于建模方法的灵活，因此此处不提供更多细节。","code":""},{"path":"chap2.html","id":"sec2-9","chapter":"第 2 章 一些非参数程序","heading":"2.9 log-rank 趋势检验","text":"在许多要比较三组或更多组生存数据的应用中，这些组是以某种方式排序的。例如，这些组可以对应于治疗剂量的增加、疾病的阶段或个体的年龄组。在使用前几节中描述的 log-rank 检验对这些组进行比较时，即使各组之间的死亡风险增加或减少，也可能得不到各组之间有显著差异的结果。使用有关组别顺序信息的检验程序比标准的 log-rank 检验更易识别显著的趋势。跨 \\(g\\) 个有序组别的 log-rank 趋势检验基于统计量\\[\\begin{equation}\nU_T=\\sum_{k=1}^gw_k(d_{k.}-e_{k.})\n\\tag{2.26}\n\\end{equation}\\]其中 \\(w_k\\) 是分配给第 \\(k\\) 组的编码 (code)，\\(k=1,2,\\ldots,g\\) 以及\\[\\begin{aligned}d_{k.}=\\sum_{j=1}^{r_k}d_{kj},\\quad\\quad e_{k.}=\\sum_{j=1}^{r_k}e_{kj}\\end{aligned}\\]是第 \\(k\\) 组观察到的和预期的死亡人数，其中求和是对该组中 \\(r_k\\) 个死亡时间进行的。注意 \\(d_{k.}\\) 和 \\(e_{k.}\\) 中的点下标表示点所替换的下标的总和。编码通常认为是等距的，对应于各组之间的线性趋势。例如，如果有三组，则代码可以取 1, 2 和 3，不过 −1, 0 和 1 这组等价的选择可在一定程度上简化计算。\\(U_T\\) 的方差由下式给出\\[\\begin{equation}\nV_T=\\sum_{k=1}^g(w_k-\\bar{w})^2e_k.\n\\tag{2.27}\n\\end{equation}\\]其中 \\(\\bar w\\) 是量 \\(w_k\\) 的加权和，权重为预期死亡人数，即\\[\\bar{w}=\\frac{\\sum_{k=1}^gw_ke_{k.}}{\\sum_{k=1}^ge_{k.}}\\]统计量 \\(W_T = U^2_T /V_T\\) 在跨 \\(g\\) 组无趋势的原假设下服从自由度为一的卡方分布。示例 2.16  (黑色素瘤患者的生存时间) 将使用示例 2.15 中有关黑色素瘤患者生存时间的数据来说明 log-rank 趋势检验。出于说明目的，将仅使用分配了 BCG 疫苗的患者的数据。比较三个年龄组患者生存时间的 log-rank 统计量为 3.739。与自由度为二的卡方分布的百分位点相比，这并不显著 (\\(P = 0.154\\))。现在使用 log-rank 趋势检验来考察随年龄变化是否存在线性趋势。为此，我们将采用等间距的编码 \\(w_k\\)，其值为 -1, 0 和 1。表 2.11 总结了 log-rank 趋势检验所需的计算。\nLog-rank 趋势检验基于式 (2.26) 中的统计量，其值为\\[\\begin{aligned}U_T=(d_{3.}-e_{3.})-(d_{1.}-e_{1.})=2.5692\\end{aligned}\\]使用表 2.11 中给出的每组的预期死亡人数，编码 \\(w_k\\) 的加权平均值为\\[\\begin{aligned}\\bar{w}&=\\frac{e_{3.}-e_{1.}}{e_{1.}+e_{2.}+e_{3.}}=-0.5138\\end{aligned}\\]\\((w_k-\\bar{w})^2\\) 的三个值为 0.2364, 0.2640 和 2.2917，并且根据式 (2.27)，\\(V_T = 2.4849\\)。最后，检验统计量为\\[W_T=\\frac{U_T^2}{V_T}=2.656\\]根据自由度为一卡方分布进行判断，在 10% 水平上几乎显著 (\\(P = 0.103\\))。因此，我们得出结论，有轻微证据表明各年龄组之间存在线性趋势。下一章的 3.8.1 节描述了考察有序分类变量的各个水平是否存在趋势的另一种方法，是一种基于生存数据分析的建模方法。","code":""},{"path":"chap2.html","id":"sec2-10","chapter":"第 2 章 一些非参数程序","heading":"2.10 延伸阅读","text":"生命表是生存函数生命表估计计算的基础，广泛用于流行病学研究和人口学数据分析。更详细的信息可以在 Armitage, Berry Matthews (2002) 以及有关人口学和流行病学统计方法的书籍中找到，例如 Khmaladze (2013) 和 Woodward (2014).生存函数的乘积极限估计自 20 世纪初开始使用。Kaplan Meier (1958) 使用最大似然法得出了该估计，这就是为什么该估计以他们的名字命名。Breslow Crowley (1974) 以及 Meier (1975) 进一步探讨了生存函数 Kaplan-Meier 估计的性质。Nelson-Aalen 估计是由 Altshuler (1970), Nelson (1972) 和 Aalen (1978b) 得出的。Greenwood (1926) 首先给出了 Kaplan-Meier 估计的标准误表达式，但 Aalen Johansen (1978) 给出了另一个结果。Klein (1991) 比较了累积风险函数的 Nelson-Aalen 估计的方差表达式。尽管 2.2.3 节显示了如何使用 Greenwood 公式得到生存函数特定时间的置信区间，但需要其他程序来构建完整生存函数的置信区间。Hall Wellner (1980) 以及 Efron (1981) 展示了如何计算这些带宽。Brookmeyer Crowley (1982), Emerson (1982), Nair (1984), Simon Lee (1982) 以及 Slud, Byar Green (1984) 描述了构建中位生存时间置信区间的方法。Simon (1986) 强调了置信区间在报告临床试验结果中的重要性，并举例说明了 Slud, Byar Green (1984) 中描述的方法。Klein Moeschberger (2005) 对风险函数的核平滑估计进行了全面的综述。在许多统计文本中都涵盖了频率学派推断方法中假设检验程序的制定。例如，在非技术性医学背景下呈现相关思想的著作包括 Altman (1991) 和 Armitage, Berry Matthews (2002.Log-rank 检验源于 Mantel Haenszel (1959), Mantel (1966) 以及 Peto Peto (1972) 的工作。关于秩检验制定的细节，请参阅 Lawless (2002)。在 2.6.2 节中推导 log-rank 检验时使用的超几何分布的全面综述，参见 Johnson, Kotz Kemp (2005).Peto-Peto 检验由 Peto Peto (1972) 提出，而 Prentice Marek (1979) 给出了一个 Wilcoxon 检验表现不佳的示例。Harrington Fleming (1982) 介绍了一个用于比较两个或更多组的一系列检验。log-rank 趋势检验源于 Armitage, Berry Matthews (2002)中给出的 2 × k 列联表趋势检验，并在 Altman (1991) 中也有描述。","code":""},{"path":"chap3.html","id":"chap3","chapter":"第 3 章 Cox 回归模型","heading":"第 3 章 Cox 回归模型","text":"第 2 章描述的非参数方法在分析单一生存数据样本或比较两个或多个生存时间组时可能很有用。然而，在大多数产生生存数据的医学研究中，还会记录每个个体的补充信息。一个典型的例子是比较接受两种不同治疗的患者的生存时间的临床试验。在这类研究中，患者的年龄和性别等人口学变量、血清血红蛋白水平和心率等生理学变量的值，以及与患者生活方式相关的因素，如吸烟史和饮食习惯，都可能对患者的生存时间产生影响。因此，这些称为解释变量的值会在研究开始时被记录下来。由此产生的数据集将比第 2 章考虑的数据集更为复杂，而该章描述的方法通常将不适用。为了探索患者的生存经历与解释变量之间的关系，可以采用基于统计建模的方法。本章开发的特定模型，即 Cox 回归模型，既统一又扩展了第 2 章的非参数程序。","code":""},{"path":"chap3.html","id":"sec3-1","chapter":"第 3 章 Cox 回归模型","heading":"3.1 风险函数建模","text":"通过分析生存数据的建模方法，我们可以探讨一组患者的生存经历如何依赖于一个或多个解释变量的值，这些变量的值在起始时间对每位患者都有记录。例如，在示例 1.3 给出的多发性骨髓瘤研究中，目的是确定七个解释变量中哪些对患者的生存时间有影响。示例 1.14 涉及两种前列腺癌疗法的临床试验中患者的生存时间，主要目的是确定两个治疗组的患者是否有不同的生存经历。在这个例子中，患者的年龄和肿瘤大小等变量可能会影响生存时间，因此在评估任何治疗差异的程度时，考虑这些变量是很重要的。此外，通过建模方法，我们不仅可以了解哪些变量对生存时间有影响，还能估计这些影响的具体大小。这使得我们能够更准确地理解各因素对生存经历的贡献，并为临床决策提供有力依据。在生存分析的研究中，选择适当的模型和解释变量是关键步骤，因为它们直接影响结果的准确性和可靠性。因此，在进行分析时，我们需要仔细考虑并选择合适的模型，以确保结果的准确性和有效性。在生存数据分析中，兴趣集中在研究开始后任何时间的死亡风险或危险 (hazard risk). 因此，在生存分析中，直接对第 1 章 1.4.2 节中定义的风险函数建模。所得模型在形式上与回归分析和设计实验数据分析中遇到的线性模型有些不同，后者对平均响应或其某些函数关于某些解释变量的依赖性进行建模。然而，线性模型中使用的许多原理和程序都适用于生存数据的建模。对生存数据进行建模的原因主要有两个。建模过程的一个目标是确定哪些潜在解释变量的组合会影响风险函数的形式。具体来说，可以研究治疗对死亡风险的影响，以及其他解释变量对风险函数的影响程度。对风险函数进行建模的另一个原因是为了获得某个个体风险函数本身的估计值。其本身可能就是人们感兴趣的，此外，根据式 1.6 描述的生存函数与风险函数之间的关系，还可以得到生存函数的估计值。这反过来又能得出对诸如中位生存时间等量的估计，这些量是模型中解释变量的函数。然后，可以根据这些解释变量的特定值，为当前或未来的患者估计中位生存时间。所得估计在制定治疗方案或向患者提供预后咨询时可能特别有用。本章描述的生存数据模型基于第 2 章 2.6.5 节中介绍的比例风险假设，称为比例风险模型 (proportional hazard model). 我们首先开发模型来比较两组个体的风险函数。","code":""},{"path":"chap3.html","id":"sec3-1-1","chapter":"第 3 章 Cox 回归模型","heading":"3.1.1 用于两组比较的模型","text":"假设两组患者分别接受标准疗法或新疗法，并设 \\(h_S(t)\\) 和 \\(h_N(t)\\) 分别为接受标准疗法和新疗法的患者在时间 \\(t\\) 的死亡风险。根据这两组患者生存时间的简单模型，接受新疗法的患者在时间 \\(t\\) 的风险与接受标准疗法的患者在同一时间的风险成比例。这种比例风险模型可以表示为\\[\\begin{equation}\nh_N(t)=\\psi h_S(t)\n\\tag{3.1}\n\\end{equation}\\]其中 \\(t\\) 为任何非负值，\\(\\psi\\) 为常数。这一假设的含义是，如 2.6.5 节所示，新疗法和标准疗法中个体相应的真实生存函数不会交叉。参数 \\(\\psi\\) 的值是新疗法患者相对于标准疗法患者在任何时间的死亡风险的比值，因此 \\(\\psi\\) 称为相对风险 (relative hazard) 或风险比 (hazard ratio). 如果 \\(\\psi<1\\)，则相对于接受标准疗法的患者，接受新疗法的患者在时间 \\(t\\) 的死亡风险更小。这时，新疗法相对于标准疗法是一个改进。另一方面，如果 \\(\\psi>1\\)，则接受新疗法的患者在时间 \\(t\\) 的死亡风险更大，标准疗法更优。以另一种方式表示式 3.1 中的模型可以得到一个更容易推广的模型。假设有 \\(n\\) 个个体的生存数据，用 \\(h_i(t)\\) 表示第 \\(\\) 个个体的风险函数，其中 \\(= 1, 2,...,n\\)。同时，用 \\(h_0(t)\\) 表示接受标准疗法的个体的风险函数。那么，接受新疗法的个体的风险函数就是 \\(\\psi h_0(t)\\)。相对风险 \\(\\psi\\) 不能为负值，因此，将 \\(\\psi\\) 设为 \\(\\exp(\\beta)\\) 更为方便。这样，参数 \\(\\beta\\) 就是风险比的对数，即 \\(\\beta=\\log \\psi\\)，且 \\(\\beta\\) 在\\((−\\infty, \\infty)\\) 范围内的任何值都能得到正的 \\(\\psi\\)。请注意，当风险比 \\(\\psi>1\\)，即新疗法不如标准疗法时，\\(\\beta\\) 为正。现令 \\(X\\) 是一个指示变量，如果一个个体接受标准治疗，它的值为 0，如果一个个体接受新治疗，它的值为 1. 如果 \\(x_i\\) 是研究中第 \\(\\) 个个体的 \\(X\\) 值，\\(=1,2,\\ldots,n\\)，该个体的风险函数可以写为\\[\\begin{equation}\nh_i(t)=e^{\\beta x_i}h_0(t)\n\\tag{3.2}\n\\end{equation}\\]其中如果第 \\(\\) 个个体接受新疗法，则 \\(x_i=1\\)，否则 \\(x_i＝0\\)。这是用于比较两个治疗组的比例风险模型。","code":""},{"path":"chap3.html","id":"sec3-1-2","chapter":"第 3 章 Cox 回归模型","heading":"3.1.2 一般比例风险模型","text":"上一节中的模型现在被推广，某一特定时间的死亡风险取决于 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 的值 \\(x_1, x_2,...,x_p\\)。假设这些变量的值在研究的起始时间就已经被记录。在第 8 章中，我们会考虑将模型扩展至若干解释变量随时间变化的情况。在比例风险模型中，解释变量的值由向量 \\(\\boldsymbol x\\) 表示，即 \\(\\boldsymbol x=(x_1,x_2,\\ldots,x_p)^\\prime\\)。设 \\(h_0(t)\\) 是构成向量 \\(\\boldsymbol x\\) 的所有解释变量的值为 0 的个体的风险函数。函数 \\(h_0(t)\\) 称为基线风险函数 (baseline hazard function)。那么，第 \\(\\) 个个体的风险函数可以写为\\[h_i(t)=\\psi(\\boldsymbol{x}_i)h_0(t)\\]其中 \\(\\psi(\\boldsymbol x_i)\\) 是 \\(\\boldsymbol x_i\\) 的函数，\\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体的解释变量的值的向量，其分量为 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\)。函数 \\(\\psi(\\cdot)\\) 可以解释为解释变量向量为 \\(\\boldsymbol x_i\\) 的个体在时间 \\(t\\) 的风险与 \\(\\boldsymbol x=0\\) 的个体的风险的相对风险。同样，由于相对风险 \\(\\psi(\\boldsymbol x_i)\\) 不可能是负的，因此可以方便地将其写成 \\(\\exp(\\eta _i)\\)，其中 \\(\\eta _i\\) 是 \\(\\boldsymbol x_i\\) 中 \\(p\\) 个解释变量值的线性组合。因此\\[\\begin{aligned}\\eta_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\end{aligned}\\]即 \\(\\eta_i=\\sum_{j=1}^p\\beta_jx_{ji}\\)。用矩阵表示为 \\(\\eta_i=\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\)，其中 \\(\\boldsymbol{\\beta}=(\\beta_1,\\beta_2,\\ldots,\\beta_p)'\\) 为模型中 \\(p\\) 个解释变量的系数向量。量 \\(\\eta_i\\) 称为模型的线性部分 (linear component)，也称为第 \\(\\) 个个体的风险评分 (risk score) 或预后指数 (prognostic index)。函数 \\(\\psi(\\boldsymbol x_i)\\) 还有其他可能的形式，但选择 \\(\\psi(\\boldsymbol{x}_i)=\\exp(\\boldsymbol{\\beta}'\\boldsymbol{x}_i)\\) 能得出最常用的生存数据模型。那么，一般的比例风险模型为\\[\\begin{equation}\nh_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})h_0(t)\n\\tag{3.3}\n\\end{equation}\\]请注意，在这个比例风险模型的线性部分中没有常数项。例如，如果包括常数项 \\(\\beta_0\\)，则可以通过将 \\(h_0(t)\\) 除以 \\(\\exp (\\beta_0)\\) 来重新缩放基线风险函数，并且常数项将抵消。式 (3.3) 中的模型也可以重新表示为\\[\\log\\left\\{\\frac{h_i(t)}{h_0(t)}\\right\\}=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\]这给出了关于风险比对数的线性模型。Cox (1972) 提出了式 (3.3) 中的模型，该模型没有对基线风险函数 \\(h_0(t)\\) 的实际形式做出任何假设，因此该模型称为 Cox 回归模型或 Cox 比例风险模型。由于未对生存时间的概率分布做出特定的假设，Cox 回归模型是一个半参数模型，3.3 节将展示如何估计该模型中的 \\(\\beta\\) 系数。当然，我们往往还需要估计 \\(h_0(t)\\) 本身，我们将在 3.10 节中看到如何做到这一点。关于基线风险函数 \\(h_0(t)\\) 的形式做出特定假设的模型将在第 5 章和第 6 章中描述。","code":""},{"path":"chap3.html","id":"sec3-2","chapter":"第 3 章 Cox 回归模型","heading":"3.2 模型的线性部分","text":"风险函数可能依赖于两种类型的 variables，即 variates 和因素。variate （以下称为变量）是一种 variable，它采用的数值通常是连续的测量尺度，如年龄或收缩压。因素是另一种 variable，它取一组有限的值，这些值称为因素的水平。例如，性别是一个有两个水平的因素，肿瘤类型也可能是一个因素，其水平对应于不同的组织，如鳞状细胞、腺细胞或小细胞。我们现在考虑如何将变量、因素以及结合变量和因素的项组合到 Cox 回归模型的线性部分中。","code":""},{"path":"chap3.html","id":"sec3-2-1","chapter":"第 3 章 Cox 回归模型","heading":"3.2.1 纳入一个变量","text":"变量，无论是单独的还是组合的，都可以很容易地纳入 Cox 回归模型中。每个变量都以相应的 \\(\\beta\\) 系数出现在模型中。作为说明，请考虑风险函数取决于两个变量 \\(X_1\\) 和 \\(X_2\\) 的情况。第 \\(\\) 个个体的这些变量的值分别为 \\(x_{1i}\\) 和 \\(x_{2i}\\)，\\(n\\) 个个体中第 \\(\\) 个个体的 Cox 回归模型可写为\\[\\begin{aligned}h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i})h_0(t)\\end{aligned}\\]在这样的模型中，基线风险函数 \\(h_0(t)\\) 是模型中包含的所有变量均为 0 的个体的风险函数。","code":""},{"path":"chap3.html","id":"sec3-2-2","chapter":"第 3 章 Cox 回归模型","heading":"3.2.2 纳入一个因素","text":"假设要建立一个风险函数仅依赖于单一因素 \\(\\) 的模型，其中 \\(\\) 有 \\(\\) 个水平。那么，对于 \\(\\) 的水平为 \\(j\\) 的个体，模型需纳入 \\(\\alpha_j\\) 这个项，它代表该因素水平 \\(j\\) 的效应。\\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_a\\) 称为因素 \\(\\) 的主效应 (main effects). 根据 Cox 回归模型，\\(\\) 的水平为 \\(j\\) 的个体的风险函数为 \\(\\exp(\\alpha_j)h_0(t)\\)。现在，基线风险函数 \\(h_0(t)\\) 定义为所有解释变量值均为 0 的个体的风险。为了与这一定义保持一致，其中一个 \\(\\alpha_j\\) 必须设为零。一种方法是采用约束条件 \\(\\alpha_1 = 0\\)，这对应于将基线风险视为 \\(\\) 处于第一个水平的个体的风险。这将是后续分析中使用的约束条件。通过为每个因素定义指示变量或虚拟变量 (indicator dummy variable)，可以将包含与因素相对应的项的模型表示为解释变量的线性组合。当使用不允许直接拟合因素的计算机软件进行生存分析时，将需要这个步骤。如果因素 \\(\\) 的第一个水平设置为零，此时它成为该因素的基线水平，可以通过定义 \\(−1\\) 个指示变量 \\(X_2,X_3,\\ldots,X_a\\) 以将项 \\(\\alpha_j\\) 纳入模型。这些指示变量的取值如表 3.1 所示。\n通过包含 \\(− 1\\) 个解释变量 \\(X_2,X_3,\\ldots,X_a\\) 以及系数 \\(\\alpha_2,\\alpha_3,\\ldots,\\alpha_a\\)，可以将项 \\(\\alpha_j\\) 纳入 Cox 回归模型的线性部分中。换句话说，模型中的项 \\(\\alpha_j\\) 被替换为 \\(\\alpha_{2}x_{2}+\\alpha_{3}x_{3}+\\cdots+\\alpha_{}x_{}\\)，其中 \\(x_j\\) 是 \\(\\) 处于第 \\(j\\) 个水平的个体的 \\(X_j\\) 值，\\(j = 2, 3,...,\\)。那么有 \\(−1\\) 个参数与因素 \\(\\) 的主效应相关，并且称 \\(\\) 具有 \\(− 1\\) 个自由度。","code":""},{"path":"chap3.html","id":"sec3-2-3","chapter":"第 3 章 Cox 回归模型","heading":"3.2.3 纳入一个交互作用","text":"当模型中需要包含对应于多个因素的项时，可以像上面展示的那样，为每个因素定义一组指示变量。在这种情况下，在模型中纳入对应于两个或更多因素水平组合的个体效应的项也可能是合适的。这种效应称为交互作用 (interactions).例如，假设这两个因素是患者的性别和肿瘤分级。如果肿瘤分级对不同性别患者死亡风险的效应不同，我们可以说这两个因素之间存在交互作用。风险函数将取决于这两个因素水平的组合。一般来说，如果 \\(\\) 和 \\(B\\) 是两个因素，并且死亡风险取决于 \\(\\) 和 \\(B\\) 水平的组合，则称 \\(\\) 和 \\(B\\) 发生了交互 (interact). 如果 \\(\\) 和 \\(B\\) 分别具有 \\(\\) 和 \\(b\\) 个水平，则表示这两个因素之间交互作用的项用 \\((\\alpha\\beta)_{jk}\\) 表示，其中 \\(j = 1, 2,...,\\) 且 \\(k = 1, 2,...,b\\)。在统计建模中，只能通过将交互作用项添加到已包含相应主效应的模型中来研究交互作用的效应。如果从模型中排除 \\(\\alpha_j\\) 或 \\(\\beta_k\\)，则项 \\((\\alpha\\beta)_{jk}\\) 表示一个因素嵌套 (nested) 在另一个因素中的效应。例如，如果模型中包含 \\(\\alpha_j\\)，但不包含 \\(\\beta_k\\)，则 \\((\\alpha\\beta)_{jk}\\) 是嵌套在 \\(\\) 中的 \\(B\\) 的效应。如果 \\(\\alpha_j\\) 和 \\(\\beta_k\\) 均被排除，则项 \\((\\alpha\\beta)_{jk}\\) 表示 \\(\\) 的水平 \\(\\) 和 \\(B\\) 的水平 \\(j\\) 的组合对响应变量的效应。这意味着只有当 \\(\\alpha_j\\) 和 \\(\\beta_k\\) 同时包含在模型中时（这对应于 \\(\\) 和 \\(B\\) 的主效应），\\((\\alpha\\beta)_{jk}\\) 才能被解释为交互效应。当我们在 3.6 节中考虑模型构建策略时，我们会回到这一点。为了将项 \\((\\alpha\\beta)_{jk}\\) 包含在模型中，需要计算与主效应相关的指示变量的乘积。例如，如果 \\(\\) 和 \\(B\\) 分别有 2 个和 3 个水平，则指示变量 \\(U_2\\) 和 \\(V_2,V_3\\) 的定义如表 3.2 所示。\n令 \\(u_j\\) 和 \\(v_k\\) 分别为给定个体的 \\(U_j\\) 和 \\(V_k\\) 的值，其中 \\(j = 2, k = 2, 3\\)。然后通过在模型中包含由 \\(U_j\\) 和 \\(V_k\\) 的乘积形成的变量来拟合项 \\((\\alpha\\beta)_{jk}\\)。给定个体的乘积的相应值是 \\(u_jv_k\\)。该乘积的系数表示为 \\((\\alpha\\beta)_{jk}\\)，因此项 \\((\\alpha\\beta)_{jk}\\) 拟合为\\[(\\alpha\\beta)_{22}u_2v_2+(\\alpha\\beta)_{23}u_2v_3\\]因此，有两个与 \\(\\) 和 \\(B\\) 交互作用相关的参数。一般来说，如果 \\(\\) 和 \\(B\\) 分别具有 \\(\\) 和 \\(b\\) 个水平，则双因素交互作用 \\(AB\\) 有 \\((− 1)(b − 1)\\) 个与其相关的参数，换句话说 \\(AB\\) 有 \\((− 1)(b − 1)\\) 个自由度。此外，只要 \\(\\) 或 \\(B\\) 处于第一个水平，即 \\(j = 1\\) 或 \\(k = 1\\) 时，项 \\((\\alpha\\beta)_{jk}\\) 就等于 0.","code":""},{"path":"chap3.html","id":"sec3-2-4","chapter":"第 3 章 Cox 回归模型","heading":"3.2.4 纳入一个混合项","text":"模型中可能需要的另一种项是由因素和变量构成的混合项 (mixed term). 当模型中某个变量的系数可能因因素的不同水平而有所差异时，会使用这种类型的项。例如，考虑一个避孕试验，其中对闭经期开始的时间（即长时间没有月经出血）进行建模。闭经的风险可能与女性的体重有关，但该变量的系数可能因女性以往怀孕次数的不同水平而有所不同。变量 \\(X\\) 的系数与因素 \\(\\) 水平之间的依赖关系可以通过在 Cox 回归模型的线性部分中包含项 \\(\\alpha_jx\\) 来表示，其中 \\(x\\) 是因素 \\(\\) 处于第 \\(j\\) 水平的某个特定个体的 \\(X\\) 值，\\(j = 1, 2,...,\\)。为了包含这样的项，我们为因素 \\(\\) 定义指示变量 \\(U_j\\)，并将这些变量与每个个体的 \\(X\\) 值相乘。乘积 \\(U_jX\\) 的结果值为 \\(u_jx\\)，而模型中 \\(u_jx\\) 的系数为 \\(\\alpha_j\\)，其中 \\(j\\) 为因素 \\(\\) 水平的索引。如果使用与先前讨论中相同的指示变量定义，那么 \\(\\alpha_1\\)（即因素 \\(\\) 为第一个水平的个体的 \\(X\\) 的系数）将为零。因此，必须将变量 \\(X\\) 以及乘积同时包含在模型中，否则无法对因素 \\(\\) 第一水平的个体对 \\(X\\) 的依赖关系进行建模。一个例子可以使这一点更加清晰。假设一项研究中共有九个个体，每个个体的变量 \\(X\\) 的值以及因素 \\(\\) 的水平都已被记录。设 \\(\\) 有三个水平，其中前三个个体的 \\(\\) 处于第一水平，接下来三个个体的 \\(\\) 处于第二水平，最后三个个体的 \\(\\) 处于第三水平。为了对变量 \\(X\\) 的系数与因素 \\(\\) 的水平之间的依赖关系进行建模，我们定义了两个指示变量 \\(U_2\\) 和 \\(U_3\\)，如表 3.3 所示。然后，将形成的解释变量 \\(U_2X\\) 和 \\(U_3X\\)（在表 3.3 的最后两列中给出）与变量 \\(X\\) 一起包含在模型的线性部分中。\n设乘积 \\(U_2X\\) 和 \\(U_3X\\) 的值的系数分别为 \\(\\alpha^\\prime_2\\) 和 \\(\\alpha^\\prime_3\\)，设变量 \\(X\\) 的值在模型中的系数为 \\(\\beta\\)。那么，模型包含项 \\(\\beta x + \\alpha^\\prime_2(u_2x) + \\alpha^\\prime_3(u_3x)\\)。从表 3.3 中可以看出，对于因素 \\(\\) 第一水平的个体，\\(u_2 = 0\\) 且 \\(u_3 = 0\\)，因此这些个体的 \\(x\\) 的系数仅为 \\(\\beta\\)。对于因素 \\(\\) 第二水平的个体，\\(u_2 = 1\\) 且 \\(u_3 = 0\\)，\\(x\\) 的系数则为 \\(\\beta + \\alpha^\\prime_2\\)。类似地，在因素 \\(\\) 的第三水平，\\(u_2 = 0\\) 且 \\(u_3 = 1\\)，\\(x\\) 的系数则为 \\(\\beta + \\alpha^\\prime_3\\)。请注意，如果从模型中省略项 \\(\\beta x\\) ，个体 1, 2 和 3 的 \\(x\\) 的系数将为零，那么对于因素 \\(\\) 第一水平的个体，就没有关于风险函数和变量 \\(X\\) 之间关系的信息。通过以不同的方式定义指示变量可以避免前面段落中描述的操作。如果因素 \\(\\) 有 \\(\\) 个水平，并且希望在模型中包含项 \\(\\alpha_jx\\)，而不一定包含项 \\(\\beta x\\)，那么可以为 \\(\\) 定义指示变量 \\(Z_1, Z_2,...,Z_a\\)，其中 \\(Z_j\\) 在 \\(\\) 第 \\(j\\) 水平时为 1，否则为 0. 对应于个体的这些乘积 \\(z_1x, z_2x, ..., z_ax\\) 及其系数 \\(\\alpha_1, \\alpha_2,...,\\alpha_a\\) 一起纳入模型。这些是在 \\(\\) 每个水平下 \\(x\\) 的系数。现在，如果变量 \\(X\\) 与 \\(\\) 个形如 \\(Z_jX\\) 的乘积一起纳入模型，那么将有 \\(+1\\) 个项与 \\(\\) 个系数相对应。因此，不可能获得这些 \\(\\alpha\\) 系数的唯一估计值，并且该模型是过度参数化的 (overparameterised). 可以通过强制 \\(+1\\) 个系数中的一个为零来处理这种过度参数化问题。特别地，取 \\(\\alpha_1 = 0\\) 将相当于对指示变量进行重新定义：取 \\(Z_1\\) 为零。这将得到与已经讨论过的模型相同的公式。在我们了解了如何拟合 Cox 回归模型之后，这些思想在实际数据集分析中的应用将在 3.4 节中进行说明。","code":""},{"path":"chap3.html","id":"sec3-3","chapter":"第 3 章 Cox 回归模型","heading":"3.3 拟合 Cox 回归模型","text":"为一组生存数据拟合由式 (3.3) 定义的 Cox 回归模型，需要估计模型线性部分的解释变量 \\(X_1,X_2,...,X_p\\) 的未知系数 \\(\\beta_1,\\beta_2,...,\\beta_p\\)。同时，基线风险函数 \\(h_0(t)\\) 也可能需要进行估计。事实证明，模型的这两个部分可以分别进行估计。首先估计这些 \\(\\beta\\)，然后使用这些估计来构建基线风险函数的估计。这是一个重要的结果，因为这意味着为了对 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 对相对风险 \\(h_i(t)/h_0(t)\\) 的效应进行推断，我们不需要估计 \\(h_0(t)\\)。因此，\\(h_0(t)\\) 的估计方法将推迟到 3.10 节。Cox 回归模型中的 \\(\\beta\\) 系数是模型中的未知参数，可以使用最大似然法 (method maximum likelihood) 进行估计。为了操作这种方法，我们首先获得样本数据的似然 (likelihood). 这是观测数据的联合概率，被视为假设模型中未知参数的函数。对于 Cox 回归模型，这是模型线性部分中生存时间和未知 \\(\\beta\\) 参数的函数。\\(\\beta\\) 的估计是根据观测数据最有可能 (likely) 得到的值。因此，这些最大似然估计是使似然函数最大化的值。从计算的角度来看，最大化似然函数的对数更方便。此外，可以从对数似然函数的二阶导数获得最大似然估计的方差的近似值。这里不提供细节，但附录 包含了最大似然估计理论的相关结果的总结。假设有 \\(n\\) 个个体的可用数据，其中有 \\(r\\) 个不同的死亡时间和 \\(n−r\\) 个右删失生存时间。目前，我们假设在每个死亡时间只有一个人死亡，因此数据中不存在结 (ties). 结的处理将在 3.3.2 节中进行讨论。\\(r\\) 个有序死亡时间表示为 \\(t_{(1)}<t_{(2)}<\\cdots<t_{(r)}\\)，因此 \\(t_{(j)}\\) 是第 \\(j\\) 个有序死亡时间。在时间 \\(t_{(j)}\\) 处于风险的个体集合由 \\(R(t_{(j)})\\) 表示，因此 \\(R(t_{(j)})\\) 是在 \\(t_{(j)}\\) 之前的时刻活着且未删失的个体的集合。量 \\(R(t_{(j)})\\) 称为风险集 (risk set).Cox (1972) 表明，与式 (3.3) 中的模型相关的似然函数由下式给出\\[\\begin{equation}\nL(\\boldsymbol{\\beta})=\\prod_{j=1}^r\\frac{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_{(j)})}{\\sum_{l\\R(t_{(j)})}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)}\n\\tag{3.4}\n\\end{equation}\\]其中 \\(\\boldsymbol{x}_{(j)}\\) 是在第 \\(j\\) 个有序死亡时间 \\(t_{(j)}\\) 处死亡的个体的协变向量 (vector covarites). 该似然函数分母中的求和运算是对在时间 \\(t_{(j)}\\) 处于风险中的所有个体的 \\(\\exp(\\boldsymbol \\beta^\\prime \\boldsymbol x)\\) 进行的。请注意，乘积运算是对所有有死亡时间记录的个体进行的。生存时间删失的个体对对数似然函数的分子没有贡献，但它们参与了发生在删失之前的死亡时间风险集的求和运算。所得似然函数不是真正的似然，因为它没有直接使用实际的删失和未删失的生存时间。因此，它称为偏似然函数 (partial likelihood function). 式 (3.4) 中的似然函数仅取决于死亡时间的排序，因为这决定了每个死亡时间的风险集。因此，关于解释变量对风险函数效应的推断仅取决于生存时间的秩次。现在假设数据由 \\(n\\) 个生存时间组成，用 \\(t_1, t_2,...,t_n\\) 来表示，\\(\\delta_i\\) 是一个事件指示符，如果第 \\(\\) 个生存时间 \\(t_i, = 1, 2,...,n\\) 是右删失的，则 \\(\\delta_i\\) 为 0，否则为 1。式 (3.4) 中的偏似然函数可以表示为以下形式\\[\\begin{equation}\n\\prod_{=1}^n\\left\\{\\frac{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)}{\\sum_{l\\R(t_i)}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)}\\right\\}^{\\delta_i}\n\\tag{3.5}\n\\end{equation}\\]其中 \\(R(t_{(j)})\\) 是在时间 \\(t_i\\) 处的风险集。根据式 (3.5) ，相应的偏对数似然函数 (partial log-likelihood function) 由下式给出\\[\\begin{equation}\n\\log L(\\boldsymbol{\\beta})=\\sum_{=1}^n\\delta_i\\left\\{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i-\\log\\sum_{l\\R(t_i)}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)\\right\\}\n\\tag{3.6}\n\\end{equation}\\]Cox 回归模型中 \\(\\boldsymbol \\beta\\) 参数的最大似然估计可以通过使用数值方法最大化此对数似然函数来得到。这种最大化通常是使用下面 3.3.3 节描述的 Newton-Raphson 程序来完成的。幸运的是，大多数用于生存分析的统计软件都可以拟合 Cox 回归模型。通常软件还会给出拟合模型中参数估计的标准误。3.3.1 节给出了使用式 (3.4) 作为似然函数的理由以及似然函数结构的进一步细节。然后，3.3.2 节讨论了绑定生存时间的处理，3.3.3 节概述了 Newton-Raphson 程序。这三个部分可以省略而不失阅读的连贯性。","code":""},{"path":"chap3.html","id":"sec3-3-1","chapter":"第 3 章 Cox 回归模型","heading":"3.3.1 模型的似然函数","text":"在 Cox 回归模型中，第 \\((=1,2,\\ldots,n)\\) 个个体在时间 \\(t\\) 的死亡风险为\\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\end{aligned}\\]其中 \\(\\boldsymbol \\beta\\) 是 \\(p\\) 个解释变量系数的向量，其值为 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\)。第 \\(\\) 个个体的 \\(h_0(t)\\) 是未指定形式的基线风险函数。构建该模型的似然函数的思想是，连续死亡时间之间的区间并不提供关于解释变量对死亡风险效应的信息。这是因为基线风险函数具有任意形式，因此可以想象，在没有死亡的那些时间区间内，\\(h_0(t)\\) 以及 \\(h_i(t)\\) 都是零。这反过来意味着这些区间不提供有关 \\(\\beta\\) 参数值的任何信息。因此，我们考虑第 \\(\\) 个个体在某个时间 \\(t_{(j)}\\) 死亡的概率，前提是 \\(t_{(j)}\\) 是 \\(r\\) 个死亡时间 \\(t_{(1)},t_{(2)},\\ldots,t_{(r)}\\) 中的一个。如果将在 \\(t_{(j)}\\) 时死亡的个体的解释变量值表示为 \\(\\boldsymbol x_{(j)}\\)，则该概率为\\[\\begin{equation}\n\\text{P}(\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }t_{(j)}\\mid t_{(j)}\\text{ 发生一个死亡})\n\\tag{3.7}\n\\end{equation}\\]而在事件 \\(B\\) 已发生的条件下，事件 \\(\\) 发生的概率由下式给出\\[\\begin{aligned}\\mathrm{P}(\\mid B)=\\mathrm{P}(\\text{ }B)/\\mathrm{P}(B)\\end{aligned}\\]因此式 (3.7) 成为\\[\\begin{equation}\n\\frac{\\mathrm{P}(\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }t_{(j)})}{\\mathrm{P}(t_{(j)}\\text{ 发生一个死亡})}\n\\tag{3.8}\n\\end{equation}\\]假设死亡时间彼此独立，因此该表达式的分母是在时间 \\(t_{(j)}\\) 时所有有死亡风险的个体的死亡概率之和。如果这些个体由 \\(l\\) 索引，其中 \\(R(t_{(j)})\\) 表示在时间 \\(t_{(j)}\\) 处于风险的个体集，则式 (3.8) 变为\\[\\begin{equation}\n\\frac{\\mathrm{P}\\left(\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }t_{(j)}\\right)}{\\sum_{l\\R(t_{(j)})}\\mathrm{P}\\left(\\text{个体 }l\\text{ 死于 }t_{(j)}\\right)}\n\\tag{3.9}\n\\end{equation}\\]现在以区间 \\((t_{(j)},t_{(j)}+\\delta t)\\) 中的死亡概率代替式 (3.9) 中时间 \\(t_{(j)}\\) 处的死亡概率，再将分子和分母同时除以 \\(\\delta t\\)，我们得到\\[\\frac{\\mathrm{P}\\left(\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }(t_{(j)},t_{(j)}+\\delta t)\\right)\\big/\\delta t}{\\sum_{l\\R(t_{(j)})}\\mathrm{P}\\left(\\text{个体 }l\\text{ 死于 }(t_{(j)},t_{(j)}+\\delta t)\\right)\\big/\\delta t}\\]当 \\(\\delta t\\) 趋近于 0 时，这个表达式的极限值就是式 (3.8) 中概率的比值。根据式 (1.3) ，这个极限也是时间 \\(t_{(j)}\\) 时相应死亡风险的比值，即\\[\\frac{\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }t_{(j)}\\text{ 的风险}}{\\sum_{l\\R(t_{(j)})}\\{\\text{个体 }l\\text{ 死于 }t_{(j)}\\text{ 的风险}\\}}\\]如果在 \\(t_{(j)}\\) 死亡是第 \\(\\) 个个体，则该表达式分子中的风险函数可以写成 \\(h_i(t_{(j)})\\)。同样，分母是在时间 \\(t_{(j)}\\) 时所有有死亡风险的个体的死亡风险的总和。这是在时间 \\(t_{(j)}\\) 的风险集 \\(R(t_{(j)})\\) 中的所有个体的 \\(h_l(t_{(j)})\\) 的总和。因此，式 (3.7) 中的条件概率变为\\[\\frac{h_i(t_{(j)})}{\\sum_{l\\R(t_{(j)})}h_l(t_{(j)})}\\]在使用式 (3.8) 时，分子和分母中的基线风险函数被抵消，剩下\\[\\frac{\\exp(\\boldsymbol{\\beta'x}_{(j)})}{\\sum_{l\\R(t_{(j)})}\\exp(\\boldsymbol{\\beta'x}_l)}\\]最后，取这些条件概率关于 \\(r\\) 个死亡时间的乘积，得到式 (3.4) 中的偏似然函数。为了进一步阐明偏似然的结构，考虑由五个个体构成的生存数据样本，编号从 1 到 5. 生存数据如图 3.1 所示。个体 2 和 5 的生存时间是右删失的，并且三个有序的死亡时间表示为 \\(t_{(1)}<t_{(2)}<t_{(3)}\\)。那么，\\(t_{(1)}\\) 是个体 3 的死亡时间，\\(t_{(2)}\\) 是个体 1 的死亡时间并且 \\(t_{(1)}\\) 是个体 4 的死亡时间。\n在三个有序死亡时间中，在每个死亡时间下的风险集由在每个死亡时间之前活着且未删失的个体组成。因此，风险集 \\(R(t_{(1)})\\) 由所有 5 个个体组成，风险集 \\(R(t_{(2)})\\) 由个体 1, 2 和 4 组成，而风险集 \\(R(t_{(3)})\\) 仅包括个体 4. 现在记 \\(\\psi()=\\exp(\\boldsymbol{\\beta'x}_i),=1,2,\\ldots,5\\)，其中 \\(\\boldsymbol{x}_i\\) 为第 \\(\\) 个个体的解释变量。时间 \\(t_{(1)},t_{(2)}\\) 和 \\(t_{(3)}\\) 处的偏似然函数的分子分别为 \\(\\psi(3),\\psi(2)\\) 和 \\(\\psi(4)\\)，因为个体 3, 1 和 4 分别死于在这三个有序的死亡时间。跨这三个死亡时间的偏似然函数为\\[\\begin{aligned}\\frac{\\psi(3)}{\\psi(1)+\\psi(2)+\\psi(3)+\\psi(4)+\\psi(5)}\\times\\frac{\\psi(1)}{\\psi(1)+\\psi(2)+\\psi(4)}\\times\\frac{\\psi(4)}{\\psi(4)}\\end{aligned}\\]结果表明，在最大似然估计中使用的标准结果无需修改即可直接应用于最大偏似然估计。具体来说，附录 中给出的 \\(\\beta\\) 估计的方差-协方差矩的结果可以使用，与似然比检验相关的分布结果也可以使用，这些将在 3.5 节中讨论。","code":""},{"path":"chap3.html","id":"sec3-3-2","chapter":"第 3 章 Cox 回归模型","heading":"3.3.2 结的处理","text":"生存数据的 Cox 回归模型假设风险函数是连续的，在这个假设下，生存时间结 (tied survival times) 是不可能存在的。当然，生存时间通常记录到最接近的天、月或年，因此这种四舍五入的过程可能会导致生存时间结的出现。事实上，第一章中的示例 1.2, 1.3 和 1.4 都包含了观测结 (tied observations).除了可能在某特定时间有多个死亡外，在死亡时间可能还存在一个或多个删失观测值。当在某特定时间同时存在删失和死亡时，我们假设删失发生在所有死亡之后。需要考虑如下问题：哪些个体应被纳入该死亡时间的风险集，并且使用式 (3.4) 计算似然函数时，如何处理删失观测结 (tied censored observations) 以防止带来进一步的计算困难。因此，我们需要考虑在拟合 Cox 回归模型时如何处理生存时间结。为了处理观测结，必须对式 (3.4) 中的似然函数进行某种修改。Kalbfleisch Prentice (2002) 已经给出了存在观测结时合适的似然函数。然而，该似然函数的形式非常复杂，这里不再赘述。此外，该似然函数的计算可能非常耗时，尤其是在一个或多个死亡时间存在大量结的情况时。幸运的是，似然函数有一些近似计算方法，它们在计算上比精确方法更具优势。但在给出这些近似方法之前，还需要引入一些额外的记号。设 \\(\\boldsymbol{s}_{j}\\) 为在第 \\(j\\) 个死亡时间 \\(t_{(j)}\\) 死亡的个体的 \\(p\\) 个协变向量之和，其中 \\(j = 1, 2,...,r\\)。如果在 \\(t_{(j)}\\) 有 \\(d_j\\) 个死亡事件，\\(\\boldsymbol{s}_{j}\\) 的第 \\(h\\) 个元素为 \\(s_{{h}j}=\\sum_{{k}=1}^{{d}_j}x_{{h}jk}\\)，其中 \\(x_{hjk}\\) 是死于第 \\(j\\) 个死亡时间 \\(t_{(j)}\\) 的 \\(d_j\\) 个个体中第 \\(k\\) 个个体的第 \\(h\\) 个解释变量的值，其中 \\(h = 1, 2,...,p,k = 1, 2,...,d_j,j = 1, 2,...,r\\)。似然函数最简单的近似是由 Breslow (1974) 提出的近似似然函数\\[\\begin{equation}\n\\prod_{j=1}^r\\frac{\\exp(\\boldsymbol{\\beta's}_j)}{\\left\\{\\sum_{l\\R(t_{(j)})}\\exp(\\boldsymbol{\\beta'x}_l)\\right\\}^{d_j}}\n\\tag{3.10}\n\\end{equation}\\]在这个近似中，我们认为在时间 \\(t_{(j)}\\) 发生的 \\(d_j\\) 个死亡是不同的且按顺序发生的。然后，将所有可能的死亡序列的概率求和，以得到式 (3.10) 中的似然函数。Peto (1972) 也提出了类似的近似方法，区别只在一个比例常数。该似然函数计算起来相当直接，当任何一个死亡时间的观测结数量不是太大时，它是一个充分的近似。出于这些原因，这种方法通常是用于生存分析统计软件处理结的默认程序，会在本书中给出的示例中使用。Efron (1977) 提出\\[\\begin{equation}\n\\prod_{j=1}^r\\frac{\\exp(\\boldsymbol{\\beta}^{\\prime}s_j)}{\\prod_{k=1}^{d_j}\\left[\\sum_{l\\R(t_{(j)})}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)-(k-1)d_j^{-1}\\sum_{l\\D(t_{(j)})}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)\\right]}\n\\tag{3.11}\n\\end{equation}\\]作为 Cox 回归模型的近似似然函数，其中 \\(D(t_{(j)})\\) 是在时间 \\(t_{(j)}\\) 死亡的所有个体的集合。这比 Breslow 的近似更接近于合适的似然函数，尽管这两种近似在实践中往往给出相似的结果。Cox (1972) 建议如下近似\\[\\begin{equation}\n\\prod_{j=1}^r\\frac{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{s}_j)}{\\sum_{l\\R(t_{(j)};d_j)}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{s}_l)}\n\\tag{3.12}\n\\end{equation}\\]其中 \\(R(t_{(j)};d_j)\\) 表示从 \\(R(t_{(j)})\\) 抽取的一组 \\(d_j\\) 个个体，其中 \\(R(t_{(j)})\\) 为 \\(t_{(j)}\\) 处的风险集。分母中的求和运算是对风险集中所有可能的含 \\(d_j\\) 个个体的集合进行的，其中的抽样是无放回的。式 (3.12) 中的近似基于时间尺度是离散的这一情况的模型，因此在这个模型下，允许存在观测结。现在，根据第 1 章 1.4.2 节，解释变量向量为 \\(\\boldsymbol x_i\\) 的个体的风险函数, \\(h_i(t)\\) 是单位时间区间 \\((t, t + 1)\\) 内的死亡概率，前提是以生存到了时间 \\(t\\)。式 (3.3) 的 Cox 回归模型的离散版本为\\[\\frac{h_i(t)}{1-h_i(t)}=\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)\\frac{h_0(t)}{1-h_0(t)}\\]其似然函数如式 (3.12) 所示。事实上，在离散时间区间长度趋于零的极限下，该模型趋于式 (3.3) 的 Cox 回归模型。当没有结时，即在每个死亡时间有 \\(d_j = 1\\) 时，式 (3.10), (3.11) 和 (3.12) 中的近似都简化为式 (3.4) 中的似然函数。","code":""},{"path":"chap3.html","id":"sec3-3-3","chapter":"第 3 章 Cox 回归模型","heading":"3.3.3 Newton-Raphson 程序","text":"含删失生存数据的模型通常通过使用 Newton-Raphson 程序来最大化偏似然函数来拟合，本节概述了该程序。令 \\(\\boldsymbol{u}(\\boldsymbol{\\beta})\\) 为式 (3.6) 中对数似然函数关于 \\(\\boldsymbol \\beta\\) 参数的一阶导数，为 \\(p × 1\\) 向量。这个量称为有效得分向量 (vector efficient scores). 此外，设 \\(\\boldsymbol{}(\\boldsymbol{\\beta})\\) 是对数似然二阶导数负数的 \\(p × p\\) 矩阵，则 \\(\\boldsymbol{}(\\boldsymbol{\\beta})\\) 的第 \\((j,k)\\) 元素为\\[-\\frac{\\partial^2\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j\\partial\\beta_k}\\]矩阵 \\(\\boldsymbol{}(\\boldsymbol{\\beta})\\) 称为观测信息矩阵 (observed information matrix).根据 Newton-Raphson 程序，第 \\((s + 1)\\) 轮迭代的 \\(\\boldsymbol\\beta\\) 参数向量估计 \\(\\hat {\\boldsymbol \\beta}_{s+1}\\) 为\\[\\hat{\\boldsymbol{\\beta}}_{s+1}=\\hat{\\boldsymbol{\\beta}}_s+\\boldsymbol{}^{-1}(\\hat{\\boldsymbol{\\beta}}_s)\\boldsymbol{u}(\\hat{\\boldsymbol{\\beta}}_s)\\]其中 \\(s=0,1,2,\\ldots\\)。\\(\\boldsymbol{u}(\\hat{\\boldsymbol{\\beta}}_s)\\) 为有效得分向量，\\(\\boldsymbol{}^{-1}(\\hat{\\boldsymbol{\\beta}}_{s})\\) 为信息矩阵的逆，这两个量都在 \\(\\hat {\\boldsymbol \\beta}_{s}\\) 处计算。该程序可以以 \\(\\hat {\\boldsymbol \\beta}_{0}=\\boldsymbol 0\\) 开始。当对数似然函数的变化足够小时，或者当参数估计的最大相对变化足够小时，该程序终止。当迭代程序收敛时，参数估计的方差-协方差阵可以通过信息矩阵的逆来近似，在 \\(\\hat {\\boldsymbol \\beta}\\) 处计算，即 \\(\\boldsymbol{}^{-1}(\\hat{\\boldsymbol{\\beta}})\\)。该矩阵对角元的平方根就是 \\(\\beta_{1},\\beta_{2},\\ldots,\\beta_{p}\\) 估计的标准误。","code":""},{"path":"chap3.html","id":"sec3-4","chapter":"第 3 章 Cox 回归模型","heading":"3.4 置信区间和假设检验","text":"当使用统计软件拟合 Cox 回归模型时，提供的参数估计值通常附带其标准误。这些标准误可用于获取未知 \\(\\beta\\) 参数的近似置信区间。具体来说，参数 \\(\\beta\\) 的 \\(100(1 − \\alpha)\\%\\) 置信区间是上下限为 \\(\\hat{\\beta}\\pm z_{\\alpha/2}\\operatorname{se}\\left(\\hat{\\beta}\\right)\\) 的区间，其中 \\(\\hat{\\beta}\\) 是 \\({\\beta}\\) 的估计，\\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。如果 \\({\\beta}\\) 的 \\(100(1 − \\alpha)\\%\\) 置信区间不包括零，则这是 \\({\\beta}\\) 的值不为零的证据。更具体地说，可以通过计算统计量 \\(\\hat{\\beta}/\\operatorname{se}{(\\hat{\\beta})}\\) 的值来检验声称 \\(\\beta = 0\\) 的原假设。然后将该统计量的观测值与标准正态分布的百分位点进行比较，以获得相应的 \\(P\\) 值。等价地，该统计量的平方可以与自由度为一的卡方分布的百分位点进行比较。这一程序有时称为 Wald 检验，该检验的 \\(P\\) 值通常与计算机输出中的参数估计及其标准误一起给出。当试图解释给定参数 \\(\\beta_j\\) 的 \\(P\\) 值时，重要的是要认识到正在检验的假设是在模型中其他所有项都存在的情况下的 \\(\\beta_j = 0\\)。例如，假设一个模型包含三个解释变量 \\(X_1,X_2,X_3\\)，并且它们的真实系数是 \\(\\beta_1,\\beta_2,\\beta_3\\)。然后使用检验统计量 \\(\\hat{\\beta}_2/\\text{ se }(\\hat{\\beta}_2)\\) 来检验在存在 \\(\\beta_1\\) 和 \\(\\beta_3\\) 的情况下 \\(\\beta_2=0\\) 的原假设。如果没有证据拒绝这一假设，我们将得出结论，在存在 \\(X_1\\) 和 \\(X_3\\) 的情况下，模型不需要 \\(X_2\\) 的存在。一般来说，Cox 回归模型中各个 \\(\\beta\\) 的单独估计并不是相互独立的。这意味着检验模型中关于 \\(\\beta\\) 参数的单独假设的结果可能不容易解释。例如，再次考虑有三个解释变量 \\(X_1,X_2,X_3\\) 的情况。如果与它们的标准误相比，\\(\\hat \\beta_1\\) 和 \\(\\hat \\beta_2\\) 未发现与零有显著差异，我们不能得出模型中只需要包含 \\(X_3\\) 的结论。这是因为，例如，当 \\(X_2\\) 从模型中排除时，\\(X_1\\) 的系数可能会发生变化，反之亦然。如果 \\(X_1\\) 和 \\(X_2\\) 存在相关性，这种情况肯定会发生。由于难以解释模型中解释变量系数的检验结果，因此需要使用替代方法来比较不同的 Cox 回归模型。事实证明，3.5 节中描述的方法比 Wald 检验更令人满意。因此，应谨慎对待基于计算机的生存数据分析中给出的 Wald 检验结果。","code":""},{"path":"chap3.html","id":"sec3-4-1","chapter":"第 3 章 Cox 回归模型","heading":"3.4.1 风险比的标准误和置信区间","text":"我们已经看到，在存在两组生存数据的情况下，Cox 回归模型中的参数 \\(\\beta\\) 是一组个体在时间 \\(t\\) 相对于另一组个体的死亡风险比的对数。风险比本身是 \\(\\psi=e^{\\beta}\\)。风险比的相应估计为 \\(\\hat{\\psi}=\\exp(\\hat{\\beta})\\)，并且使用第 2 章式 (2.8) 给出的结果，可以从 \\(\\hat \\beta\\) 的标准误中获得 \\(\\hat \\psi\\) 的标准误。根据这一结果，作为 \\(\\hat \\beta\\) 的函数，\\(\\hat \\psi\\) 的近似方差为\\[\\left\\{\\exp(\\hat{\\beta})\\right\\}^2\\mathrm{~var~}(\\hat{\\beta})\\]也就是 \\(\\hat{\\psi}^2\\text{ var }(\\hat{\\beta})\\)，则 \\(\\hat{\\psi}\\) 的标准误为\\[\\begin{equation}\n\\text{se }(\\hat{\\psi})=\\hat{\\psi}\\text{ se }(\\hat{\\beta})\n\\tag{3.13}\n\\end{equation}\\]一般来说，真实风险比的置信区间比风险比估计的标准误更具信息性。真实风险比 \\(\\psi\\) 的 \\(100(1 − \\alpha)\\%\\) 置信区间可以通过对 \\(\\beta\\) 的置信限进行指数运算来找到。以这种方式获得的区间估计优于使用 \\(\\hat{\\psi}\\pm z_{\\alpha/2}\\operatorname{se}\\left(\\hat{\\psi}\\right)\\) 获得的估计。这是因为风险比估计的对数的分布比风险比本身的分布更接近正态分布。下面的示例 3.1 说明了风险比置信区间的构造。3.9 节给出了 Cox 回归模型线性部分中参数解释的更详细信息。","code":""},{"path":"chap3.html","id":"sec3-4-2","chapter":"第 3 章 Cox 回归模型","heading":"3.4.2 两个示例","text":"在本节中，我们将用第 1 章中介绍的两个示例的数据拟合一个 Cox 回归模型。示例 3.1  (患乳腺癌妇女的预后) 在示例 1.2 中给出了按肿瘤切片是否呈阳性染色分类的乳腺癌患者生存时间数据。指示染色结果的变量可视为具有两个水平的因素。根据 3.2.2 节中的论述，这个因素可以通过使用指示变量 \\(X\\) 来表示染色结果，其中 \\(X = 0\\) 对应于阴性染色，\\(X = 1\\) 对应于阳性染色。在 Cox 回归模型下，对于指示变量值为 \\(x_i\\) 的第 \\(\\) 名女性，她在时间 \\(t\\) 的死亡风险是\\[h_i(t)=e^{\\beta x_i}h_0(t)\\]其中 \\(x_i\\) 为 0 或 1. 基线风险函数 \\(h_0(t)\\) 是肿瘤染色阴性的女性的风险函数。这本质上是 3.1.1 节中考虑的模型，并由式 (3.2) 给出。在肿瘤染色呈阳性的女性群体中，有两人在第 26 个月时死亡。使用似然函数的 Breslow 近似来处理这个结。该模型是通过找到使式 (3.10) 中的似然函数最大化的 \\(\\beta\\) 值，即 \\(\\hat \\beta\\)，来拟合的。\\(\\beta\\) 的最大似然估计值是 \\(\\hat \\beta=0.908\\)。该估计的标准误也可以从用于拟合 Cox 回归模型的统计软件中获得，结果是 \\(\\text{se}\\left(\\hat{\\beta}\\right)=0.501\\)。量 \\(e^\\beta\\) 是 \\(X = 1\\) 的女性与 \\(X = 0\\) 的女性的风险函数之比，因此 \\(\\beta\\) 是阳性染色女性相对于阴性染色女性在任意时间 \\(t\\) 的死亡风险比的对数。这个风险比的估计是 \\(e^0.908 = 2.48\\)。由于这个值大于 1，我们得出结论，肿瘤呈阳性染色的女性在任何给定时间的死亡风险将高于肿瘤呈阴性染色的女性。因此，阳性染色的乳腺癌患者的预后较差。使用式 (3.13) 中的结果，可以从 \\(\\beta\\) 的标准误中找到风险比的标准误。由于相对风险估计为 \\(\\hat{\\psi}=\\exp(\\hat{\\beta})=2.480\\)，并且 \\(\\hat \\beta\\) 的标准误为 0.501，因此 \\(\\hat{\\psi}\\) 的标准误由下式给出\\[\\mathrm{se}\\left(\\hat{\\psi}\\right)=2.480\\times0.501=1.242\\]我们可以进一步为这个风险比构造一个置信区间。第一步是为风险比的对数 \\(\\beta\\) 获得一个置信区间。例如，\\(\\beta\\) 的 95% 置信区间为 \\(\\hat{\\beta}-1.96\\text{se}(\\hat{\\beta})\\) 到 \\(\\hat{\\beta}+1.96\\text{se}(\\hat{\\beta})\\)，即从 −0.074 到 1.890 的区间。对这些置信限进行指数运算，得到风险比本身的 95% 置信区间为 \\((0.93, 6.62)\\)。请注意，这个区间几乎不包含 1，有证据表明两组女性的生存经历不同。示例 3.2  (多发性骨髓瘤患者的生存率) 在示例 1.3 中给出了 48 名患有多发性骨髓瘤的患者的生存时间数据。数据中还包含了为每位患者记录的七个其他变量的值。为方便起见，描述患者性别的变量的值已被重新定义，其中男性为 0 ，女性为 1。患者的性别和与 Bence-Jones 蛋白出现情况相关的变量是具有两个水平的因素，这些项通过使用指示变量 Sex 和 Protein 进行拟合。建模过程中使用的变量如下\\(Age\\)：患者的年龄\\(Sex\\)：患者的性别（0 = 男性，1 = 女性）\\(Bun\\)：血尿素氮\\(Ca\\)：血清钙\\(Hb\\)：血清血红蛋白\\(Pcells\\)：浆细胞百分比\\(Protein\\)：Bence Jones 蛋白（0 = 不存在，1 = 存在）第 \\(\\) 个个体的 Cox 回归模型为\\[\\begin{aligned}h_i(t)=\\exp&(\\beta_1Age_i+\\beta_2Sex_i+\\beta_3Bun_i+\\beta_4Ca_i+\\beta_5Hb_i+\\beta_6Pcells_i\\\\&+\\beta_7Protein_i)h_0(t)\\end{aligned}\\]其中解释变量下标 \\(\\) 表示该变量对于第 \\(\\) 个个体的值。基线风险函数是指这七个变量的值都为 0 的个体的风险函数，即，该函数对应于一个年龄为 0 的男性，其 Bun, Ca, Hb 和 Pcells 的值都为 0，并且没有 Bence-Jones 蛋白。鉴于该函数在解释上的明显困难，通过减去平均患者 (average patient) 的值来重新定义 Age, Bun, Ca, Hb 和 Pcells 变量可能更为合理。例如，如果我们用 Age - 60 代替 Age，那么基线风险就会对应于一个 60 岁的男性。这个程序也避免了引入一个描述年龄与研究中患者年龄范围相差较大的个体的风险函数。尽管这使基线风险函数具有更自然的解释，但不会影响关于解释变量对死亡风险影响的推断。因此，在这个例子中，我们使用未转换的变量。在拟合模型后，解释变量的系数及其标准误的估计如表 3.4 所示。\n我们从表 3.4 中看到，一些估计接近于零。事实上，如果为七个变量的系数单独计算 95% 置信区间，则只有 Bun 和 Hb 的置信区间不包含零。这表明风险函数并不依赖于所有七个解释变量。我们不能由此推断 Bun 和 Hb 是有意义的变量，因为拟合模型中七个解释变量的系数估计并不是相互独立的。这意味着如果七个解释变量中的一个从模型中排除，剩余六个变量的系数可能与表 3.4 中的系数不同。例如，如果排除 Bun，剩余的六个解释变量 Age, Sex, Ca, Hb, Pcells 和 Protein 的系数估计分别为 -0.009, -0.301, -0.036, -0.140, -0.001 和 -0.420. 与表 3.4 中的值进行比较，这六个变量的系数估计都存在差异，尽管差异不是很大。一般来说，为了确定风险函数依赖于七个解释变量中的哪些，需要拟合许多不同的模型，并对结果进行比较。本章后续部分将讨论比较不同模型拟合优度的方法以及模型构建的策略。","code":""},{"path":"chap3.html","id":"sec3-5","chapter":"第 3 章 Cox 回归模型","heading":"3.5 比较替代模型","text":"在分析生存数据的建模方法中，会建立一个模型来描述风险函数关于一个或多个解释变量的依赖关系。在建模过程中，会拟合包含不同项集的线性部分的 Cox 回归模型，并对它们进行比较。以一个具体例子来说，考虑有两组生存时间的情况，这两组分别对应接受新疗法和接受标准疗法的个体。在没有治疗差异的模型下的共同风险函数可以表示为 \\(h0_(t)\\)。这个模型是式 (3.3) 中一般比例风险模型的特例，其中模型的线性部分没有解释变量。因此，这个模型称为零模型 (null model).现在，设 \\(X\\) 为一个指示变量，对于接受标准治疗的个体，其取值为 0，否则取值为 1. 在比例风险模型下，对于 \\(X\\) 取值为 \\(x\\) 的个体，其风险函数为 \\(e^{\\beta x}h_0(t)\\)。因此，接受标准疗法和新疗法的个体的风险函数分别为 \\(h_0(t)\\) 和 \\(e^\\beta h_0(t)\\)。这个模型与零模型的区别在于，后者的线性部分包含了额外的项 \\(\\beta x\\)。由于 \\(\\beta=0\\) 对应于没有治疗效果，因此可以通过比较这两个 Cox 回归模型对生存数据的拟合情况，来研究治疗差异的程度。更一般地，假设对于特定的数据集，我们考虑了两个模型，即模型 (1) 和模型 (2). 其中，模型 (1) 包含模型 (2) 中的一部分项。那么模型 (1) 称为以参数方式嵌套 (parametrically nested) 在模型 (2) 内。具体来说，假设在模型 (1) 中拟合了 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\)，因此该模型的风险函数可以写为\\[\\exp\\{\\beta_1x_1+\\beta_2x_2+\\cdots+\\beta_px_p\\}h_0(t)\\]还假设在模型 (2) 中拟合了 \\(p+q\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p,X_{p+1},\\ldots,X_{p+q}\\)，该模型的风险函数为\\[\\exp\\{\\beta_1x_1+\\cdots+\\beta_px_p+\\beta_{p+1}x_{p+1}+\\cdots+\\beta_{p+q}x_{p+q}\\}h_0(t)\\]模型 (2) 包含 \\(q\\) 个额外的解释变量 \\(x_{p+1},x_{p+2},\\ldots,x_{p+q}\\)。由于模型 (2) 比模型 (1) 具有更多的项，因此模型 (2) 一定对观测数据拟合得更好。因此，统计问题是要确定模型 (2) 中额外的个 \\(q\\) 项是否显著提高了模型的解式释能力。如果不是，它们可能被省略，并认为模型 (1) 是充分的。在 3.2 节的例子中，我们了解到当存在多个可能对问题有意义的解释变量时，每个项的效应不能独立于其他效应进行研究。因此，任何给定项的效应都取决于当前模型中包含的其他项。例如，在模型 (1) 中，任何 \\(p\\) 个解释变量对风险函数的效应都取决于已拟合的 \\(p-1\\) 个变量，而认为 \\(X_p\\) 的效应是经剩余的 \\(p-1\\) 个变量调整的 (adjusted). 具体来说，\\(X_p\\) 的效应经 \\(X_1,X_2,\\ldots,X_{p-1}\\) 的调整，但我们也会说 \\(X_p\\) 的效应消除了或考虑了 (eliminating allowing ) \\(X_1,X_2,\\ldots,X_{p-1}\\) 的效应。类似地，当 \\(q\\) 个变量 \\(X_{p+1},X_{p+2},\\ldots,X_{p+q}\\) 加入到模型 (1) 中时，认为这些变量对风险函数的效应是经已拟合的 \\(p\\) 个变量 \\(X_1,X_2,\\ldots,X_p\\) 的调整的。","code":""},{"path":"chap3.html","id":"sec3-5-1","chapter":"第 3 章 Cox 回归模型","heading":"3.5.1 \\(-2\\log\\hat{L}\\) 统计量","text":"为比较为同一组生存数据拟合的不同模型，我们需要一个能够衡量特定模型对数据拟合程度的统计量。由于似然函数总结了数据中关于给定模型中未知参数的信息，因此一个合适的总结统计量是似然函数在其最大似然估计处的值。这得到了假设模型下的最大化似然，或在 Cox 回归模型的情况下是最大化偏似然。这个统计量可以通过将式 (3.4) 中的 \\(\\beta\\) 替换为模型下的最大似然估计来计算。对于给定的一组数据，最大似然值越大，模型与数据之间的一致程度就越好。出于后续讨论的原因，在比较不同模型时，使用负二倍对数最大似然更为方便。如果给定模型的最大似然值用 \\(\\hat L\\) 表示，那么模型与数据之间一致程度的总结度量就是 \\(-2\\log\\hat L\\)。根据 3.3.1 节，\\(\\hat L\\) 实际上是一系列条件概率的乘积，因此这个统计量将小于 1. 因此，\\(-2\\log\\hat L\\) 总是正的，对于给定的数据集，\\(-2\\log\\hat L\\) 的值越小，模型就越好。统计量 \\(-2\\log\\hat L\\) 不能单独用作衡量模型充分性的指标。原因在于 \\(\\hat L\\) 以及由此得到的 \\(-2\\log\\hat L\\) 的值，取决于数据集中的观测数量。因此，如果在对一组数据拟合模型后，又获得了其他数据，且这些新数据适用于使用原始数据建立的模型。那么扩充后的数据集的 \\(-2\\log\\hat L\\) 值将与原始数据的值不同。因此，\\(-2\\log\\hat L\\) 的值仅在比较为相同数据集拟合的不同模型时才有用。","code":""},{"path":"chap3.html","id":"sec3-5-2","chapter":"第 3 章 Cox 回归模型","heading":"3.5.2 比较嵌套模型","text":"再次考虑之前定义的模型 (1) 和模型 (2)，其中模型 (1) 包含 \\(p\\) 个解释变量，模型 (2) 包含额外的 \\(q\\) 个解释变量。将每个模型的最大化偏似然函数值分别表示为 \\(\\hat L(1)\\)和 \\(\\hat L(2)\\) 表示，然后，可以基于模型的 \\(-2\\operatorname{log}\\hat{L}\\) 之差来比较这两个模型。具体来说，\\(-2\\log\\hat{L}(1)\\) 和 \\(-2\\log\\hat{L}(1)\\) 之间的较大差异将得出模型 (2) 中的 \\(q\\) 个变量（这是在模型 (1) 的基础上附加的 \\(q\\) 个变量）确实提高了模型拟合优度的结论。自然地，当项添加到模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 的值的变化量将取决于哪些项已包括在内。具体来说，\\(-2\\log\\hat{L}(1)\\) 和 \\(-2\\log\\hat{L}(1)\\) 值之差，即，\\(-2\\log\\hat{L}(1)+2\\log\\hat{L}(2)\\)，反映了将变量 \\(X_{p+1},X_{p+2},\\ldots,X_{p +q}\\) 添加到已包含 \\(X_1,X_2,\\ldots,X_p\\) 的模型中的组合效应。这称为经 \\(X_1,X_2,\\ldots,X_p\\) 的调整后，因拟合 \\(X_{p+1},X_{p+2},\\ldots,X_{p +q}\\) 而导致的 \\(-2\\operatorname{log}\\hat{L}\\) 值的变化\n。统计量 \\(-2\\log\\hat{L}(1)+2\\log\\hat{L}(2)\\) 可写为\\[-2\\log\\{\\hat{L}(1)/\\hat{L}(2)\\}\\]这就是对数似然比统计量 (log-likelihood ratio statistic)，用于检验声称模型 (2) 中 \\(q\\) 个参数 \\(\\beta_{p+1},\\beta_{p+2},\\ldots,\\beta_{p+q}\\) 全部为零的原假设。根据似然比检验理论的相关结果（见附录 ），在附加变量系数为零的原假设下，该统计量服从渐近卡方分布。该卡方分布的自由度等于两个模型下拟合的独立 \\(\\beta\\) 参数数量之差。因此，为比较模型 (1) 和模型 (2) 的 \\(-2\\operatorname{log}\\hat{L}\\) 值，我们利用以下事实：在 \\(\\beta_{p+1},\\beta_{p+2},\\ldots,\\beta_{p+q}\\) 全部为零的原假设下，统计量 \\(-2\\log\\hat{L}(1)+2\\log\\hat{L}(2)\\) 服从自由度为 \\(q\\) 的卡方分布。如果统计量的观测值不是很大，那么将判定这两个模型同等适用。在其他条件相同的情况下，将优先选用更简单的模型，即包含更少项的模型。另一方面，如果两个模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值差异显著，我们会认为需要这些附加的项，并会采用更复杂的模型。两个嵌套模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值之差有一个与之相关的自由度数量，但 \\(-2\\operatorname{log}\\hat{L}\\) 统计量本身却没有。这是因为特定模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值并不服从卡方分布。有时，\\(-2\\operatorname{log}\\hat{L}\\) 称为偏差 (deviance). 然而这是不恰当的，因为与广义线性模型中的偏差不同，\\(-2\\operatorname{log}\\hat{L}\\) 并不衡量与数据完美拟合的模型之间的偏差。示例 3.3  (患乳腺癌妇女的预后) 再次考虑示例 1.2 中关于乳腺癌患者生存时间的数据。在拟合不包含解释变量的 Cox 回归模型，即零模型时，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 173.968. 与示例 3.1 类似，指示变量 \\(X\\) 将用于表示染色程序的结果，因此，对于肿瘤呈阴性染色的女性，\\(X\\) 的值为 0，否则为 1。 当变量 \\(X\\) 包含在模型的线性部分时，\\(-2\\operatorname{log}\\hat{L}\\) 的值减小为 170.096. 替代模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值可以方便地以表格形式总结，如表 3.5 所示。\n零模型与包含 \\(X\\) 的模型之间的 \\(-2\\operatorname{log}\\hat{L}\\) 值之差可用于评估两组女性风险函数之间的差异是否显著。由于一个模型比另一个模型多一个 \\(\\beta\\) 参数，因此 \\(-2\\operatorname{log}\\hat{L}\\) 值之差服从自由度为一的卡方分布。这两个 \\(-2\\operatorname{log}\\hat{L}\\) 值的差值为 \\(173.968-170.096 = 3.872\\)，这在 5% 的水平上刚刚显著（\\(P = 0.049\\)）。因此，我们可以得出结论，有证据表明两组女性的风险函数在 5% 的水平上存在显著差异。在示例 2.12 中，我们使用 log-rank 检验研究了两组女性生存时间差异的程度。该检验的卡方值为 3.515（\\(P = 0.061\\)）。这个值与我们之前得到的 3.872（\\(P = 0.049\\)）相差不大。这两个相似 \\(P\\) 值意味着，关于数据为无组别差异的原假设提供证据的程度，得出的结论基本上是一样的。从实际的角度来看，一个结果在 5% 的水平上刚好显著，而另一个结果在该水平上并不完全显著，这一点并不重要。尽管本例中使用的基于模型的方法在操作上不同于 log-rank 检验，但这两个程序实际上是密切相关的，这种关系将在 3.14 节中进行更详细的探讨。示例 3.4  (肾癌的治疗) 在 University Oklahoma Health Sciences Center 进行的一项研究中，获得了 36 名肾脏恶性肿瘤患者的生存时间数据。这些患者都接受了化疗和免疫疗法的联合治疗，但一些患者还接受了肾切除术（手术切除肾脏）。令人感兴趣的是，患者的生存时间是否取决于诊断时的年龄以及是否接受了肾切除术。研究中获得的数据如下：Lee Wang (2013) 给出了研究中获得的数据，但在本例中，患者的年龄根据患者是否小于 60 岁、60 岁至 70 岁或大于 70 岁进行了分类。表 3.6 给出了患者的生存时间（以月为单位）。\n在这个示例中，有一个名为年龄组的因素，包含三个水平 (<60, 60-70, >70)，以及一个与是否进行肾切除术相关的因素。根据风险函数是否与这两个因素中的一个或两个有关，有多种可能的模型，分别记作模型 (1) 至模型 (5). 在模型 (1) 下，死亡的风险既不受这两个因素中任何一个的影响，对于研究中所有 36 个个体来说也是相同的。在模型 (2) 和 (3) 中，风险只取决于年龄组或是否进行肾切除术。在模型 (4) 中，风险取决于这两个因素，其中肾切除术对风险的效应独立于患者的年龄组。模型 (5) 考虑了年龄组和肾切除术之间的交互作用，因此在该模型下，肾切除术对死亡风险的效应取决于患者的年龄组。假设第 \\(j\\) 个年龄组的效应用 \\(\\alpha_j,j=1,2,3\\) 表示，而肾切除术状态的效应用 \\(\\nu_k,k=1,2\\) 表示。那么，可以将项 \\(\\alpha_j\\) 和 \\(\\nu_k\\) 包含在 Cox 模型的风险函数 \\(h_i(t)\\) 中，这是研究中第 \\(\\) 个个体的风险函数。五种可能的模型如下模型 (1)：\\(h_{}(t) =h_0(t)\\)模型 (2)：\\(h_i(t) =\\exp\\{\\alpha_j\\}h_0(t)\\)模型 (3)：\\(h_{}(t) =\\exp\\{\\nu_k\\}h_0(t\\)模型 (4)：\\(h_{}(t) =\\exp\\{\\alpha_j+\\nu_k\\}h_0(t)\\)模型 (5)：\\(h_i(t) =\\exp\\{\\alpha_{j}+\\nu_{k}+(\\alpha\\nu)_{jk}\\}h_{0}(t)\\)为拟合项 \\(\\alpha_j\\)，定义了两个指示变量 \\(A_2\\) 和 \\(A_3\\)，其值如表 3.7 所示。\n通过定义变量 \\(N\\) 来拟合项 \\(\\nu_k\\)，当没有进行肾切除术时，变量 \\(N=1\\)，当进行了肾切除术时 \\(N=0\\)。通过选择这一指示变量，基线风险函数将对应于未进行肾切除术的最年轻年龄组的个体。通过在模型中包含变量 \\(A_2\\) 和 \\(A_3\\) 来拟合包含项 \\(\\alpha_j\\) 的模型，而项 \\(\\nu_k\\) 则通过包含 \\(N\\) 来拟合。通过在模型中包含乘积 \\(A_2N=A_2×N\\) 和 \\(A_3N=A_3×N\\) 来拟合交互作用。拟合的解释变量以及所考虑的五个模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值如表 3.8 所示。当用于建模生存数据的计算机软件允许在模型中包含因素而无需定义适当的指示变量时，可以直接获得表 3.8 中的 \\(-2\\operatorname{log}\\hat{L}\\) 值。比较这些不同模型的第一步是确定肾切除术状态和年龄组之间是否存在交互作用。为此，将模型 (4) 与模型 (5) 进行比较。在包含年龄组和肾切除术状态主效应的模型中加入交互项后，\\(-2\\operatorname{log}\\hat{L}\\) 值减少了 \\(165.508 - 162.479 = 3.029\\)，这对应于 2 个自由度。这并不显著（\\(P = 0.220\\)），因此我们得出结论，年龄组与是否进行肾切除术之间不存在交互作用。我们现在确定风险函数是否与年龄组和肾切除状态这两个因素存在相关性，有三种可能，与两个都不相关，与其中一个相关，与两个都相关。在包含 \\(\\nu_k\\) 的模型中包含项 \\(\\alpha_j\\)，\\(-2\\operatorname{log}\\hat{L}\\) 值的变化在 2 个自由度上为 \\(170.247 − 165.508 = 4.739\\)。这在 10% 的水平下显著 (\\(P=0.094\\))，因此有一些证据表明包含 \\(\\nu_k\\) 的模型也需要包含 \\(\\alpha_j\\)。当 \\(\\nu_k\\) 添加到包含 \\(\\alpha_j\\) 的模型时，\\(-2\\operatorname{log}\\hat{L}\\) 的变化在 1 个自由度上为 \\(172.172 − 165.508 = 6.664\\)，在 1% 水平上显著 (\\(P = 0.010\\))。将这两个结果放在一起，项 \\(\\alpha_j\\) 可能会向包含 \\(\\nu_k\\) 的模型添加一些信息，并且包含 \\(\\alpha_j\\) 的模型中肯定需要包含 \\(\\nu_k\\)。这意味着这两项都是必需的，因此风险函数取决于患者的年龄组以及是否进行了肾切除术。在结束这个例子之前，让我们考虑五个模型比较的其他可能结果，以及这些结果将如何影响我们选择最合适的模型的结论。如果在模型中除了与肾切除术状态相关的项 \\(\\nu_k\\) 外，还需要与年龄组相关的项 \\(\\alpha_j\\)，但在存在 \\(\\alpha_j\\) 的情况下，\\(\\nu_k\\) 并不需要，那么只包含 \\(\\alpha_j\\) 的模型 (2) 可能是最合适的。为了确保确实需要 \\(\\alpha_j\\)，我们还需要将模型 (2) 与零模型（模型 (1)）进行比较。类似地，如果除了与年龄组相关的项 \\(\\alpha_j\\) 外，还需要与肾切除术状态相关的项 \\(\\nu_k\\)，但在存在 \\(\\nu_k\\) 的情况下，\\(\\alpha_j\\) 并不需要，那么只包含 \\(\\nu_k\\) 的模型 (3) 可能是令人满意的。我们还需要通过将模型 (2) 与模型 (1) 进行比较来检验 \\(\\nu_k\\) 的显著性。如果在另一个因素存在的情况下，与年龄组和肾切除术状态相关的项都不需要，那么最多只需要一个变量。为了确定这两个变量中哪一个是必要的，我们会将模型 (2) 与模型 (1) 以及模型 (3) 与模型 (1) 进行比较。如果这两个结果在统计上都是显著的，我们将采用相比零模型，\\(-2\\operatorname{log}\\hat{L}\\) 值减少得最多的模型。如果模型 (2) 和模型 (3) 都不优于模型 (1)，我们将得出结论：年龄组和肾切除术状态都不会对风险函数产生影响。分析生存数据的建模方法还有两个进一步的步骤。首先，我们需要严格检查模型对观测数据的拟合度，以确保拟合的 Cox 回归模型确实合适。其次，我们需要解释所选模型中参数估计的含义，以便量化解释变量对风险函数的效应。3.9 节将讨论拟合模型中参数的解释，而第 4 章将考虑评估拟合模型充分性的方法。但首先，我们来讨论模型选择的可能策略。","code":""},{"path":"chap3.html","id":"sec3-6","chapter":"第 3 章 Cox 回归模型","heading":"3.6 模型选择策略","text":"模型选择过程的第一步是确定一组有可能包含在 Cox 回归模型线性部分中的解释变量。该集合将包含已为每个个体记录的变量和因素，但也可能需要与因素之间或变量与因素之间的交互作用相对应的额外项。一旦确定了一组潜在的解释变量，就需要确定用于风险函数建模的变量组合。在实践中，风险函数不会依赖于唯一的变量组合。相反，可能存在许多同样好的模型，而不是单一的“最佳”模型。因此，需要考虑多种可能的模型。模型选择策略在一定程度上取决于研究目的。在某些应用中，已经获得了关于多个变量的信息，目的可能是确定哪些变量对风险函数有影响，就像多发性骨髓瘤的示例 1.3 那样。在其他情况下，可能存在一个或多个主要关注的变量，例如对应于治疗效应的项。建模过程的目的是评估这些变量对风险函数的效应，就像前列腺癌的示例 1.4 那样。由于已记录的其他变量也可能影响治疗效应的大小，因此需要在建模过程中考虑这些变量。统计建模的一个重要原则是，当模型中包含与两个因素之间交互作用相对应的项时，还应包含相应的低阶项。该规则称为层次原则 (hierarchical principle)，这意味着不应拟合两个因素之间的交互作用，除非存在相应的主效应。不遵循层次原则的模型很难解释。","code":""},{"path":"chap3.html","id":"sec3-6-1","chapter":"第 3 章 Cox 回归模型","heading":"3.6.1 变量选择程序","text":"我们首先考虑所有解释变量处于平等地位的情况，目的是确定风险函数所依赖的变量子集。当潜在的解释变量（包括交互作用、非线性项等）的数量不太大时，在适当考虑层次原则的情况下，拟合所有可能的项组合可能是可行的。可以通过检查在向模型中添加项或从模型中删除项时 \\(-2\\operatorname{log}\\hat{L}\\) 值的变化来比较嵌套模型。也可以根据 Akaike’s Information criterion (AIC) 对一些可能的模型进行比较，这些模型不一定需要嵌套，其公式为\\[\\begin{equation}\nAIC=-2\\operatorname{log}\\hat{L}+2q\n\\tag{3.14}\n\\end{equation}\\]其中 \\(q\\) 是模型中未知参数 \\(\\beta\\) 的数量。该统计量值越小，模型越好，但与 \\(-2\\operatorname{log}\\hat{L}\\) 统计量不同，当向模型中添加不必要的项时，AIC 的值往往会增加。AIC 统计量的一个替代方案是 Bayesian Information Criterion (BIC)，由下式给出\\[BIC=-2\\log\\hat{L}+q\\log d\\]其中 \\(q\\) 是模型中未知参数 \\(\\beta\\) 的数量，\\(d\\) 是数据集中未删失观测值的数量。BIC 统计量也称为 Schwarz Bayesian Criterion (SBC). BIC 是 \\(-2\\operatorname{log}\\hat{L}\\) 统计量的调整，它考虑了拟合模型中未知参数的数量和模型已拟合的观测值的数量。与 AIC 统计量一样，BIC 的值越小，模型更好。当然，一些项可能会以特定模型中项的替代项被识别出来，从而得到多个同等适用的子集。关于哪个子集最为合适的决定，不能仅仅基于统计依据。当模型选择没有主题依据时，从一系列候选模型中初步考虑选择的模型，可能是使得 \\(-2\\operatorname{log}\\hat{L},AIC\\) 或 \\(BIC\\) 的值最小的那个模型。然后使用第 4 章描述的模型检验方法以确认该模型确实适合数据，这一点很重要。在某些应用中，可能会记录多个变量的信息，所有这些变量都与同一总体特征相关。例如，身高、体重、身体质量指数（体重/身高²）、头围、臂长等等，都与个体的尺寸有关。考虑到这些变量之间的内在关系，关于这些个体生存时间的模型可能不需要包含所有变量。因此，应确定需在模型中包含这组变量中的哪些，尽管具体选择哪些变量可能并不重要。当变量数量相对较大时，拟合所有可能的模型的计算成本可能会很高。具体来说，如果有 \\(p\\) 个潜在解释变量，则有 \\(2^p\\) 种可能的项的组合，因此，如果 \\(p > 10\\)，则解释变量的可能组合有一千多种。在这种情况下，许多软件包中提供的用于变量选择的自动程序似乎是一个有吸引力的前景。这些程序基于前向选择 (forward selection)、后向消除 (backward elimination) ，或两者的组合，称为逐步程序 (stepwise procedure).在前向选择中，一次将一个变量添加到模型中。在该过程的每个阶段，添加的变量是在包含该变量时使 \\(-2\\operatorname{log}\\hat{L}\\) 值减小最多的变量。当模型中包含的下一个候选变量不会使 \\(-2\\operatorname{log}\\hat{L}\\) 的值减少超过预先指定的量时，该过程结束。这称为停机准则 (stopping rule). 当将变量添加到模型中时，此规则通常以 \\(-2\\operatorname{log}\\hat{L}\\) 值差异的显著性水平来表示，因此当下一候选项在预先指定的水平上不再显著时，选择过程结束。在向后消除中，首先拟合包含所考虑变量数量最多的模型。然后一次排除一个变量。在每一阶段，排除的变量是使 \\(-2\\operatorname{log}\\hat{L}\\) 的值增加其排除的最小量的变量。当下一个要排除的候选项将 \\(-2\\operatorname{log}\\hat{L}\\) 的值增加超过预先指定的量时，该过程结束。逐步程序的操作方式与正向选择相同。但是，可以考虑在后续阶段排除模型中包含的变量。因此，在向模型添加变量后，该过程将检查是否可以删除以前包含的任何变量。这些决定同样是根据预先指定的停机准则做出的。这些自动程序有许多缺点。通常，它们会导致识别一个特定的子集，而不是一组同样好的子集。这些程序找到的子集通常取决于所使用的变量选择程序，即是前向选择、后向消除还是逐步过程，并且通常倾向于不考虑分层原则。它们还依赖于用来确定一个项是否应该包含在模型中或排除在外的停机准则。由于所有这些原因，这些自动程序在模型选择中起着有限的作用，并且绝对不应该不加批判地使用。建议采用以下模型选择的一般策略，而不是使用自动变量选择程序。第一步是一次拟合包含一个变量的模型。然后将这些模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值与零模型的值进行比较，以确定哪些变量本身显著减小了该统计量的值。然后将第一步中看起来很重要的变量组合起来并拟合模型。在某些变量存在的情况下，其他变量可能就不再重要了。因此，当这些变量从模型中省略时，如果不显著增加 \\(-2\\operatorname{log}\\hat{L}\\) 的值，那么它们现在就可以被丢弃。因此，我们计算当每个变量单独从集合中省略时，\\(-2\\operatorname{log}\\hat{L}\\) 值的变化。只有那些（在省略后）导致 \\(-2\\operatorname{log}\\hat{L}\\) 值显著增加的变量才会被保留在模型中。一旦一个变量被丢弃，就应该依次检查省略每个剩余变量的影响。那些在单独考虑时不重要的变量（因此在第二步中没有被考虑），可能在其他变量的存在下变得重要。因此，这些变量将逐一添加到第二步的模型中，任何能显著减小 \\(-2\\operatorname{log}\\hat{L}\\) 的变量都将保留在模型中。这一过程可能会导致第二步确定的模型中的项不再具有显著性。最后进行一次检查，以确保模型中的任何一项都不能被省略，否则会导致 \\(-2\\operatorname{log}\\hat{L}\\) 的值显著增加，并且确保未包括的任何一项都不会显著减小 \\(-2\\operatorname{log}\\hat{L}\\) 的值。在使用这种选择程序时，应避免刻板地应用特定的显著性水平。为了指导是否包含或省略某个项的决策，显著性水平不应设置得太小，否则会导致选择的变量太少；一般建议将显著性水平设置为 15%.在某些应用中，可能需要考虑将少量交互项和其他高阶项（如某些变量的幂）纳入模型。在确保根据层次原则必需的所有项都包含在模型中之后，这些项将添加到上述第三步确定的模型中。如果任何高阶项能显著减小 \\(-2\\operatorname{log}\\hat{L}\\) 的值，那么该项将包含在模型中。现通过一个示例说明这种模型选择策略。示例 3.5  (多发性骨髓瘤患者的生存率) 在示例 3.2 中，对多发性骨髓瘤患者生存时间数据的分析表明，Cox 回归模型中并非所有七个解释变量（Age、Sex、Bun、Ca、Hb、Pcells 和 Protein）都是必需的。我们现在确定这些变量中最合适的子集。在本例中，我们将不考虑原始变量的变换以及它们之间的交互作用。我们还进一步假设在模型中包含特定变量没有医学依据。表 3.9 给出了将要考虑的所有模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值的总结。第一步是拟合零模型和分别包含七个解释变量的模型。在这些变量中，Bun 导致 \\(-2\\operatorname{log}\\hat{L}\\) 的减小量最大，它将统计量的值从 215.940 减小为 207.453. 与具有 1 个自由度的卡方分布的百分位点相比，8.487 的减小在 1% 的水平上是显著的（\\(P = 0.004\\)）。将 Hb 添加到零模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 的减小量为 4.872，这在 5% 的水平上也是显著的（\\(P = 0.027\\)）。最后一个本身具有一定解释能力的变量是 Protein，它导致 \\(-2\\operatorname{log}\\hat{L}\\) 的减小量在 15% 的水平上几乎显著（\\(P = 0.152\\)）。尽管这个 \\(P\\) 值相对较高，但我们暂时会考虑将其纳入模型中。下一步是拟合包含 Bun, Hb 和 Protein 的模型，该模型得到的 \\(-2\\operatorname{log}\\hat{L}\\) 的值为 200.503。从该模型中依次省略这三个变量中每个变量的影响如表 3.9 所示。具体来说，当省略 Bun 时，\\(-2\\operatorname{log}\\hat{L}\\) 的增加量为 9.326，当省略 Hb 时增加量为 3.138，当省略 Protein 时增加量为 2.435. 这些 \\(-2\\operatorname{log}\\hat{L}\\) 值的变化都可以与具有 1 个自由度的卡方分布的百分位点进行比较。由于在 Hb 和 Bun 存在的情况下，Protein 似乎不是模型所必需的，因此不再考虑将其纳入模型中。\n如果从包含 Hb 和 Bun 这两个变量的模型中排除排除其中一个，则 \\(-2\\operatorname{log}\\hat{L}\\) 的增加值分别为 4.515 和 8.130. 这两个增量在 5% 的水平上都显著，因此在不显著增加 \\(-2\\operatorname{log}\\hat{L}\\) 统计值的情况下，Hb 和 Bun 都不能从模型中排除。最后，我们考察是否应将变量 Age、Sex、Ca 和 Pcells 中的任何一个包含在包含 Bun 和 Hb 的模型中。表 3.9 显示，当添加这四个变量中的任何一个时，\\(-2\\operatorname{log}\\hat{L}\\) 的减小量都小于 0.5，因此不需要将它们包含在模型中。因此我们得出结论，最令人满意的模型是包含 Bun 和 Hb 的模型。我们现在转向具有首要意义的变量的研究，比如治疗效应。此时，我们将按照以下方式进行。首先选择重要的预后变量，忽略治疗效应。当变量的数量不是非常大时，可以拟合包含所有可能变量组合的模型。或者可以遵循之前的步骤 1 至 4 中描述的类似步骤来进行变量选择过程。然后将治疗效应纳入模型中。如此一来，因每个治疗组中预后变量分布的差异而导致的两组之间的任何差异都不会归因于治疗。如果无法排除在治疗和其他解释变量之间存在交互作用，那么在解释治疗效应之前，必须考虑这些交互作用。此外，拟合仅包含治疗效应的模型通常会很有趣。这使得能够评估预后变量对治疗效应大小的影响。在讨论模型选择策略时，我们强调了使用统计标准来指导选择过程。此外，还必须充分考虑应用领域。具体来说，在某些主题领域包含特定的变量组合可能是不合适的。另一方面，即使某些变量在为特定数据集建模时看似不需要，但从模型中省略它们可能并不明智。实际上，在模型构建中总是需要考虑非统计因素。示例 3.6  (前列腺癌两种疗法的比较) 在示例 1.4 中，关于 38 名前列腺癌患者生存时间的数据，有四个预后变量可能对生存时间产生影响。这些变量包括患者的年龄 (Age) 、血清血红蛋白水平 (Hb) 、肿瘤大小 (Size) 和 Gleason 指数 (Index). 在 Cox 回归模型中拟合了这些变量的所有可能组合，并计算了 \\(-2\\operatorname{log}\\hat{L}\\) 的值。这些值以及利用 \\(AIC=-2\\operatorname{log}\\hat{L}+2q\\) 得到的 Akaike 信息准则的值以及利用 \\(BIC = -2\\operatorname{log}\\hat{L} + q\\log(6)\\) 得到的贝叶斯信息准则的值一起显示在表 3.10 中，其中 \\(q\\) 是为包含 6 个死亡时间的数据集拟合的模型中项的个数。\n单独考虑时，最重要的两个解释变量是 Size 和 Index. 通过比较从包含这两个变量的模型中分别省略它们时 \\(-2\\operatorname{log}\\hat{L}\\) 值的变化，我们推断出 Cox 回归模型中需要这两个变量。当在包含 Size 和 Index 的模型中添加 Age 和 Shb 时，\\(-2\\operatorname{log}\\hat{L}\\) 的值仅略有减小。因此我们得出结论，只有 Size 和 Index 是重要的预后变量。从表 3.10 中 Akaike 信息准则的值来看，具有 Size 和 Index 的模型得出的统计量最小，证明这是所尝试的模型中最合适的模型。另请注意，没有其他解释变量组合能得出相似的 AIC 统计量的值，这表明在模型中使用 Size 和 Index 没有明显的替代方案。贝叶斯信息准则的值也能得出相同的结论。我们现在考虑治疗效应。设 Treat 为一个变量，对于分配到安慰剂组的个体，其值为 0；对于分配到己烯雌酚组的个体，其值为 1. 当将 Treat 添加到包含 Size 和 Index 的模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 的值减小为 22.572. 此减小量 0.961 在 1 个自由度上并不显著（\\(P = 0.327\\)）。这表明没有治疗效应，但首先我们应该检查模型中两个解释变量的系数是否依赖于治疗。为此，我们形成乘积 Tsize = Treat × Size 和 Tindex = Treat × Index，并将它们添加到包含 Size、Index 和 Treat 的模型中。当将 Tsize 和 Tindex 添加到模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 分别减小为 20.829 和 20.792. 在添加这两个混合项后，\\(-2\\operatorname{log}\\hat{L}\\) 变为 19.705. 将这些项添加到模型后，\\(-2\\operatorname{log}\\hat{L}\\) 的减小并不显著，因此没有证据表明治疗效应依赖于 Size 和 Index. 这意味着我们对治疗效应大小的原始解释是有效的，并且基于这些数据，使用己烯雌酚进行治疗似乎并不影响死亡风险。这种治疗效应大小的估计将在示例 3.12 中进一步考虑。在结束这个例子之前，我们注意到，当 Tsize 或 Tindex 添加到模型中时，它们的系数估计和 Treat 的系数估计都会变大。这些标准误估计也很大。具体来说，在包含 Size, Index, Treat 和 Tsize 的模型中，Treat 的系数估计为 -11.28，标准误为 18.50. 对于包含 Size, Index, Treat 和 Tindex 的模型，Treat 和 Tindex 的系数分别为 -161.52 和 14.66，而这些的标准误估计分别为 18476 和 1680！这是过拟合 (overfitting) 的证据。在过拟合模型中，一些 \\(\\beta\\) 系数的估计将高度依赖于实际数据。这些变量值的一个非常微小的变化，可能会对相应系数的估计产生很大影响。这就是这类估计具有较大标准误的原因。在这个例子中，由于数据集中事件数量较少（38 名患者中只有 6 人死亡），因此发生了过拟合。相比数据所能证明的模型，过拟合的模型是更复杂的模型，它无法提供数据的有用总结。这也是在前列腺癌死亡风险的模型中不包含混合项的另一个原因。","code":""},{"path":"chap3.html","id":"sec3-7","chapter":"第 3 章 Cox 回归模型","heading":"3.7 使用 lasso 进行变量选择","text":"变量选择的一个特别有用的辅助工具是 Least Absolute Shrinkage Selection\nOperator，简称为 lasso. 使用 lasso 的效果是将模型中解释变量的系数向零收缩，并在这一过程中，一些估计值将自动设置为正好是零。在 lasso 程序中系数变为零的解释变量是那些解释能力很小或没有解释能力，或者与其他变量高度相关的变量。然后，选择纳入模型中的变量是具有非零系数的变量。这种收缩还提高了模型的预测能力，因为收缩后的参数估计对样本数据的变化不太敏感，因此更稳定。","code":""},{"path":"chap3.html","id":"sec3-7-1","chapter":"第 3 章 Cox 回归模型","heading":"3.7.1 Cox 回归中的 lasso","text":"考虑一个包含 \\(p\\) 个解释变量的 Cox 回归模型，其中第 \\(\\) 个（共 \\(n\\) 个）个体在时间 \\(t\\) 发生事件的风险函数为 \\(h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\)，其中 \\(\\boldsymbol{\\beta'x}_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\)，\\(h_0(t)\\) 是基线风险函数。在 lasso 过程中，该模型中的 \\(\\beta\\) 参数是通过最大化式 (3.5) 中的偏似然函数来估计的，同时限制其绝对值的和小于等于某个值 \\(s\\)。用 \\(R(t_{{}})\\) 表示在时间 \\(t_i\\)（第 \\(\\) 个个体的观测生存时间）处于事件风险的个体集合，令 \\(\\delta_i\\) 为事件指示符，当 \\(t_i\\) 为删失生存时间时，其值为 0，否则为 1. 具有 \\(p\\) 个解释变量的模型的偏似然函数为\\[\\begin{equation}\nL(\\boldsymbol{\\beta})=\\prod_{=1}^n\\left\\{\\frac{\\exp(\\boldsymbol{\\beta'x}_i)}{\\sum_{l\\R(t_i)}\\exp(\\boldsymbol{\\beta'x}_l)}\\right\\}^{\\delta_i}\n\\tag{3.15}\n\\end{equation}\\]其根据约束 \\(\\sum_{j=1}^p|\\beta_j|\\leqslant s\\) 来最大化。量 \\(\\sum_{j=1}^p|\\beta_j|\\) 称为向量 \\(\\boldsymbol \\beta\\) 的 L1 范数，常记作 \\(||\\boldsymbol \\beta||_1\\)。使约束偏似然函数 (constrained likelihood function) 最大化的估计 \\(\\hat{\\boldsymbol \\beta}\\) 也是使下式最大化的值\\[\\begin{equation}\nL_\\lambda(\\boldsymbol{\\beta})=L(\\boldsymbol{\\beta})-\\lambda\\sum_{j=1}^{p}|\\beta_j|\n\\tag{3.16}\n\\end{equation}\\]其中 \\(\\lambda\\) 称为 lasso 参数。式 (3.16) 中的似然函数称为惩罚 (penalized) 似然，因为对极端的 \\(\\beta\\) 值施加了惩罚。由此产生的估计将更接近于零，并且比拟合 Cox 模型的标准估计具有更高的精度，但代价是在估计中引入一定程度的偏差。为了了解这种收缩 (shrinkage) 的影响，对 lasso 参数的一系列值，计算了可能包含在最终模型中的所有解释变量的系数估计。这些估计关于 \\(\\lambda\\) 的曲线图，称为 lasso 轨迹，提供了估计对 \\(\\lambda\\) 值依赖性的总结。当 \\(\\lambda\\) 较小时，模型中只有少数变量的系数为零，解释变量的数量不会减少太多。另一方面，较大的 \\(\\lambda\\) 值会导致太多变量被排除在外，模型可能不会令人满意。虽然 lasso 轨迹是一种图形辅助工具，可用于识别建模过程中合适 \\(\\lambda\\) 值，这通常还需要通过其他技术来确定 lasso 参数的最优值。这个值可以是最大化式 (3.16) 中惩罚似然函数 \\(L_\\lambda(\\boldsymbol\\beta)\\) 的值，或者等价地，是最小化 \\(-2\\log L_\\lambda(\\boldsymbol\\beta)\\) 的 \\(\\lambda\\) 值。然而，通常更倾向于使用其他方法来确定 \\(\\lambda\\) 的最优值，例如交叉验证 (cross-validation) 法。在这种方法中，\\(\\lambda\\) 的最优值是使交叉验证偏对数似然函数 (cross-validated partial log-likelihood function) 最大化的值。为定义这一点，设 \\(\\hat{\\boldsymbol{\\beta}}_{(-)}(\\lambda)\\) 是在省略第 \\(\\) 个个体的数据后，最大化式 (3.16) 中的惩罚偏似然函数的参数估计向量，其中 \\(= 1, 2,...,n\\)，对于给定的 lasso 参数 \\(\\lambda\\) 值。设 \\(\\log L(\\boldsymbol{\\beta})\\) 为式 (3.15) 中定义的偏似然函数的对数， \\(L_{(-)}(\\boldsymbol{\\beta})\\) 是在排除第 \\(\\) 个个体的数据后的偏对数似然。那么，交叉验证偏对数似然函数为\\[\\begin{aligned}\\log\\hat{L}_{CV}(\\lambda)=\\sum_{=1}^n\\left\\{\\log L[\\hat{\\boldsymbol{\\beta}}_{(-)}(\\lambda)]-\\log L_{(-)}[\\hat{\\boldsymbol{\\beta}}_{(-)}(\\lambda)]\\right\\}\\end{aligned}\\]选择最大化该函数的 \\(\\lambda\\) 值作为 lasso 参数的最优值。选择包含在模型中的变量是在该 \\(\\lambda\\) 值处具有非零系数的变量。使用 lasso 程序后，通常不会显示参数估计的标准误或这些估计的函数（例如风险比）。其原因之一是它们难以计算，但主要原因是参数估计将偏向于零。因此，标准误意义不大，并且往往会低估估计的精度。如果需要标准误，则可以使用 lasso 程序来确定应包含在模型中的变量，即在 lasso 参数的最佳值处具有非零系数的变量。然后拟合包含这些变量的标准 Cox 回归模型，但如此就失去了 lasso 的优势。","code":""},{"path":"chap3.html","id":"sec3-7-2","chapter":"第 3 章 Cox 回归模型","heading":"3.7.2 数据准备","text":"在使用 lasso 程序之前，解释变量必须具有相似的测量尺度。若情况并非如此，则首先需要标准化每个解释变量：将每个解释变量减去其样本均值并除以其标准差，从而得到均值为 0 和方差为 1 的标准化变量。lasso 程序也可以应用于分类变量，但需要首先对与该因素相关的指示变量进行标准化。这种方法意味着一个因素不会被视为单一实体，lasso 程序可能会导致相关的指示变量子集被设置为零。lasso 程序识别的变量将取决于如何对相应的指示变量进行编码。例如，如 3.2 节所示，如果具有 \\(m\\) 个水平的因素有相应的 \\(m - 1\\) 个指示变量，这些指示变量在因素第一水平时都是 0，则这些指示变量将测量每个因素水平相对于第一水平的效应。这可用于识别与基线水平没有差异的水平，但不适用于因素水平是有序的情况。在这种情况下，一种反映因素水平差异的编码方法，即前向差分编码 (forward difference coding) 将更有用。在 lasso 程序中被设置为零的系数，将对应于与具有非零系数的相邻水平具有相似效应的水平。为了说明这种编码，假设有序分类变量 \\(\\) 有四个水平，该因素可以用表 3.11 中定义的三个指示变量 \\(A_1,A_2,A_3\\) 表示。\n当这三个变量以系数 \\(α_1,α_2,α_3\\) 的形式包含在一个模型中时，\\(\\) 第一水平的效应是 \\((3α_1 + 2α_2 + α_3)/4\\)，第二水平的效应是 \\((−α_1 + 2α_2 + α_3)/4\\)。因此，\\(A_1\\) 的系数 \\(α_1\\) 代表 \\(\\) 第一水平和第二水平之间的差异。类似地，\\(A_2\\) 的系数代表 \\(\\) 第二水平和第三水平之间的差异，而 \\(A_3\\) 的系数代表 \\(\\) 第三水平和第四水平之间的差异。在一般情况下，对于具有 \\(m\\) 个水平的因素 \\(\\)，\\(m - 1\\) 个指示变量是这样的：\\(A_1\\) 的值为 \\((m-1)/m, -1/m, -1/m,..., -1/m\\)；\\(A_2\\) 的值为 \\((m-2)/m, (m-2)/m, -2/m, -2/m,..., -2/m\\)；\\(A_3\\) 的值为 \\((m-3)/m, (m-3)/m, (m-3)/m, -3/m,..., -3/m\\)；以此类推，直到 \\(A_{m-1}\\) 的值为 \\(1/m, 1/m,..., 1/m, -(m-1)/m\\)。分类变量也可以通过 group lasso 进行处理，它允许一组变量被完全包含或排除，但这里不会给出更多细节。示例 3.7  (多发性骨髓瘤患者的生存率) 以第 1 章示例 1.3 中首次给出的 48 名多发性骨髓瘤患者的生存时间数据来说明 lasso 程序在变量选择中的使用。七个潜在的解释变量包括五个连续变量（Age、Bun、Ca、Hb、Pcells）和两个二元变量（Sex、Protein）。所有七个变量的测量尺度都有较大差异，因此它们首先被标准化为均值为 0 和标准差为 1. 例如，48 个年龄的均值为 62.90，标准差为 6.96，因此标准化值为 (Age − 62.90)/6.96.为了应用 lasso 程序，通过在 \\(\\lambda\\) 的值范围内最大化式 (3.16) 中的惩罚似然函数来获得七个 \\(\\beta\\) 系数的估计。图 3.2 显示了每个变量的系数相对于 \\(\\lambda\\) 的结果轨迹。在该图中，所呈现的系数是原始变量的系数：使约束似然函数最大化的标准化解释变量的系数估计除以该变量的标准差。\\(\\lambda=0\\) 时的估计是包含所有七个解释变量的 Cox 回归模型的参数估计。随着 \\(\\lambda\\) 的增加，这些估计逐渐接近于零，但速度有所不同。当 \\(\\lambda=0.5\\) 时，Ca 的系数估计为零，而当 \\(\\lambda=0.75\\) 时，Pcells 的系数估计为零。\\(\\lambda=2.5\\) 时，Age 和 Sex 的系数估计均为零。该图还说明了 lasso 的另一个性质，即 lasso 轨迹是由许多直线段组成的，因此它是分段线性的 (piecewise linear).为了确定 \\(\\lambda\\) 的最佳值，针对一系列 \\(\\lambda\\) 值计算交叉验证偏对数似然 \\(\\log\\hat{L}_{CV}(\\lambda)\\)，并确定使该似然函数最大化的值。交叉验证偏对数似然为 lasso 参数 \\(\\lambda\\) 的函数，如图 3.3 所示。\n当 \\(\\lambda=3.90\\) 时，该函数达到最大值，在该 \\(\\lambda\\) 值下，有三个变量具有非零系数：Hb, Bun 和 Protein. 因此，lasso 程序产生了一个包含这三个变量的模型。在本例中，图 3.3 中所示的交叉验证偏对数似然函数在其最大值附近非常平坦，即在\\(\\lambda\\) 值处于 3 和 5 之间时函数值非常相似。此外，根据图 3.2，对于 3 和 5 之间的任何 \\(\\lambda\\) 值，将选择相同的变量纳入模型，尽管系数估计会有所不同。在 \\(λ=3.90\\) 的模型中，Hb, Bun 和 Protein 系数分别为 −0.080, 0.015 和 −0.330. 具有这三个变量的 Cox 模型的相应估计值分别为 -0.110, 0.020 和 -0.617. 请注意，lasso 程序中模型的系数估计都比 Cox 模型中的相应估计更接近于零，这表明了收缩效应。在 Cox 模型中，Protein 系数与零没有显著差异（\\(P=0.13\\)），尽管 lasso 程序表明该变量应保留在模型中。最后，人们可能希望将 Protein 纳入模型，以免错过任何内容。","code":""},{"path":"chap3.html","id":"sec3-8","chapter":"第 3 章 Cox 回归模型","heading":"3.8 非线性项","text":"当要对一个取值范围广泛的解释变量与风险函数之间的依赖关系进行建模时，我们应考虑将该变量以线性项的形式纳入 Cox 回归模型是否适合。如果有理由不假设变量是线性的，那么我们需要考虑如何对非线性关系进行建模。","code":""},{"path":"chap3.html","id":"sec3-8-1","chapter":"第 3 章 Cox 回归模型","heading":"3.8.1 非线性检验","text":"检查是否需要非线性项的一种直接方法是向模型添加二次项或三次项，并考察 \\(-2\\operatorname{log}\\hat{L}\\) 统计量值因此的减小值。如果包含这些项会显著减小该统计量的值，我们就会得出存在非线性的结论。那么可以将多项式项纳入模型。然而在许多情况下，解释变量中的非线性不能通过在 Cox 回归模型中包含多项式项来充分表示。因此，建议一般使用以下程序。为了确定变量是否表现出非线性，首先将可能的非线性变量的值分为四类或五类，其中每类包含大致相等数量的观测值。然后定义一个因素，其水平对应于该分组。例如，反映肿瘤大小的变量可以拟合为一个因素，其水平对应于非常小、小、中和大。更具体地说，设 \\(\\) 是一个由连续变量形成的具有 \\(m\\) 个水平的因素，设 \\(X\\) 是一个变量，当 \\(\\) 处于水平 \\(j\\) 时，\\(X\\) 取值为 \\(j\\)，其中 \\(j = 1, 2,...,m\\)。原始变量的线性关系对应于 \\(\\) 水平之间存在线性趋势。这种线性趋势可以通过单独拟合 \\(X\\) 来建模。现在，拟合 \\(m-1\\)个项 \\(X, X^2,...,X^{(m-1)}\\) 相当于在模型中将 \\(\\) 作为因素进行拟合，使用如 3.2.2 节中的指示变量。因此，包含 \\(X\\) 的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值与包含 \\(\\) 的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值之间的差异，是衡量 \\(\\) 水平之间非线性的指标。如果这个差异不显著，我们可以得出不存在非线性的结论，并且将拟合原始变量。另一方面，如果有非线性的证据，则可以从与 \\(\\) 对应的指示变量的系数中进一步研究这种非线性的实际形式。绘制这些系数的图可能有助于确定因素 \\(\\) 水平之间这种趋势的性质。示例 3.8  (多发性骨髓瘤患者的生存率) 在示例 3.5 中，我们发现包含解释变量 Bun 和 Hb 的 Cox 回归模型似乎适用于多发性骨髓瘤患者生存时间的数据。我们现在考虑血清血红蛋白水平 (Hb) 是否存在非线性证据，并检查包含 Bun 和 Hb 的模型中是否需要二次项。当向该模型添加 Hb2 项时，\\(-2\\operatorname{log}\\hat{L}\\) 的值从 202.938 减小为 202.917. 在 1 个自由度上减小 0.021 显然并不显著，这表明在 Hb 中使用线性项就足够了。检查非线性程度的另一种方法是使用一个因素为 Hb 对风险函数的效应进行建模。假设定义了一个具有四个水平的因素，其中水平 1 对应于小于等于 7 的 Hb 值，水平 2 对应于 7 到 10 之间的值，水平 3 对应于 10 到 13 之间的值，水平 4 对应于大于 13 的值。这种水平的选择大致对应于 Hb 分布的四分位数。可以通过定义三个指示变量 Hb2, Hb3 和 Hb4 来拟合该因素，这三个指示变量的值如表 3.12 所示。\n当拟合包含 Bun, Hb2, Hb3 和 Hb4 的模型时，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 200.417. 将指示变量 Hb2, Hb3 和 Hb4 添加到仅包含 Bun 的模型后，该统计量在 3 个自由度上的变化为 7.036，在 10% 的水平上显著（\\(P = 0.071\\)）。然而，很难确定各因素水平之间的任何模式。与血红蛋白水平相对应的因素水平的线性趋势可以通过拟合变量 \\(X\\) 来建模，变量 \\(X\\) 根据因素水平取值 1, 2, 3, 4. 当拟合包含 Bun 和 \\(X\\) 的模型时，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 203.891，在 2 个自由度上，由于任何非线性导致的 \\(-2\\operatorname{log}\\hat{L}\\) 的值变化为 \\(203.891-200.417=3.474\\)。与具有 2 个自由度的卡方分布的百分位点相比，这并不显著（\\(P=0.176\\)）。因此我们得出结论，血红蛋白水平对这组患者死亡风险的效应可以通过使用线性项 Hb 进行充分建模。","code":""},{"path":"chap3.html","id":"sec3-8-2","chapter":"第 3 章 Cox 回归模型","heading":"3.8.2 非线性建模","text":"如果使用 3.8.1 节中描述的程序检测出非线性，则可能会在建模过程中使用与变量对应的系数。然而，这意味着连续变量被阶跃函数所取代。从主题的角度来看，这样的一个固有连续变量被如此表示通常无法令人信服。此外，该过程需要选择分类边界，而分类过程会导致信息丢失。通常也不建议使用多项式项来表示解释变量中的非线性行为。这是因为低阶多项式，例如二次或三次表达式，可能不适合数据，而高阶多项式通常不能很好地拟合解释变量范围的极值。此外，具有极限值或渐近线的变量不能使用多项式表达式进行充分建模。一个简单而灵活的解决方案是使用包含相同变量的不同幂次的模型，这些幂次可能是分数，称为分数多项式 (fractional polynomials).","code":""},{"path":"chap3.html","id":"sec3-8-3","chapter":"第 3 章 Cox 回归模型","heading":"3.8.3 分数多项式","text":"一个关于变量 \\(X\\) 的 \\(m\\) 阶分数多项式包含 \\(X\\) 的 \\(m\\) 个不同的幂次。将表达式 \\(\\beta_1X^{p_1}+\\beta_2X^{p_2}+\\cdots+\\beta_mX^{p_m}\\) 纳入模型，其中每个幂次 \\(p_j(j=1,2,\\ldots,m)\\) 都是集合 \\(\\{−2, −1, −0.5, 0, 0.5, 1, 2, 3\\}\\) 中的一个值，\\(X^0\\) 被视为 \\(\\log X\\)。将 \\(X\\) 的 0 次幂表示为 \\(\\log X\\) 称为 \\(X\\) 的 Box-Tidwell 变换。仅使用变量的两个不同幂次即可实现解释变量对死亡风险效应建模的极大灵活性，因此 \\(m\\) 通常取 1 或 2. 当 m = 2 时，我们可以不失一般性地取 \\(p_1 < p_2\\)，因为具有幂次 \\(p_1,p_2\\) 的模型与具有幂次 \\(p_2,p_1\\) 的模型是相同的，并且具有 \\(p_1 = p_2\\) 的模型与 \\(m = 1\\) 对于的模型是等价的。当 \\(m = 1\\) 时，将拟合具有 8 个可能幂次的模型，在考虑其他变量的存在下，具有最小 \\(-2\\operatorname{log}\\hat{L}\\) 值的模型是最佳拟合模型。当 \\(m = 2\\) 时，在集合中的 8 个幂次有 28 种可能的组合（这不包括变量以相同幂出现两次的 8 种情况），最合适的组合将是使得 \\(-2\\operatorname{log}\\hat{L}\\) 最小化的组合。在比较不同阶数的非嵌套模型时，例如一个具有两个幂次的模型和一个仅有一个幂次的模型，且两个模型没有共同的幂次，可以使用 AIC 或 BIC 统计量。示例 3.9  (多发性骨髓瘤患者的生存率) 在这个例子中，我们调查了关于多发性骨髓瘤患者生存时间的数据集中，血清血红蛋白水平是否存在非线性的证据。除了变量 Bun 外，还拟合了 Hb 的 1 阶和 2 阶分数多项式。因此，Hb 以幂次 \\(p_1\\) 的单个项和以幂次为 \\(p_1 < p_2\\) 的两个项纳入模型，其中 \\(p_1\\) 和 \\(p_2\\) 取自值集 \\(\\{−2, −1, −0.5, 0, 0.5, 1, 2, 3\\}\\)，且 Hb 的 0 次幂视为 \\(\\log Hb\\)。如下 Cox 回归模型\\[\\begin{aligned}h_i(t)&=\\exp(\\beta_1Hb_i^{p_1}+\\beta_2Bun_i)h_0(t),\\\\h_i(t)&=\\exp(\\beta_1Hb_i^{p_1}+\\beta_2Hb_i^{p_2}+\\beta_3Bun_i)h_0(t)\\end{aligned}\\]的 \\(-2\\operatorname{log}\\hat{L}\\) 的值展示在表 3.13 中。\n根据这张表，只具有一个 Hb 幂次的最佳模型 (\\(m = 1\\))，是包含 Hb 线性项或二次项的模型，其中仅包含 Hb 线性项的模型最简单。当拟合具有两个 Hb 幂次的模型时，\\(p_1 = −2,p_2 = −1\\) 和 \\(p_1 = −2,p_2 = −0.5\\) 的模型得到的 \\(-2\\operatorname{log}\\hat{L}\\) 的值最小，但这两种模型相对于仅有一个 Hb 幂次的模型并没有显著改进。如果要向仅包含 Hb 的模型中添加另一个 Hb 的幂次，我们会添加 Hb−2，但同样没有必要这样做，因为具有两个 Hb 幂次的模型相对于仅包含 Hb 的模型并没有显著改进。我们得出结论，Hb 的线性项就足够了，这证实了示例 3.8 中分析的结果。","code":""},{"path":"cox-回归模型.html","id":"cox-回归模型","chapter":"►Cox 回归模型","heading":"►Cox 回归模型","text":"","code":""},{"path":"cox-回归模型.html","id":"sec3-9","chapter":"►Cox 回归模型","heading":"3.9 参数估计的解释","text":"当 Cox 回归模型用于生存数据分析时，模型中解释变量的系数可以解释为死亡风险与基线风险之比的对数。这意味着，可以很容易地从拟合模型中找到该风险比的估计值和相应的置信区间。以下各节描述了 Cox 回归模型中不同类型的项对应的参数解释。","code":""},{"path":"cox-回归模型.html","id":"sec3-9-1","chapter":"►Cox 回归模型","heading":"3.9.1 具有一个变量的模型","text":"假设 Cox 回归模型包含单个连续变量 \\(X\\)，则第 \\(\\) 个个体（\\(X\\) 的值为 \\(x_i\\)）的风险函数为\\[h_{\\boldsymbol{}}(t)=e^{\\boldsymbol{\\beta}x_{\\boldsymbol{}}}h_{\\boldsymbol{0}}(t)\\]该模型中 \\(x_i\\) 的系数可以解释为风险比的对数。具体来说，考虑在 \\(X\\) 上的记录值为 \\(x + 1\\) 的个体的死亡风险，与记录值为 \\(x\\) 的个体的死亡风险的之比。即\\[\\begin{aligned}\\frac{\\exp\\{\\beta(x+1)\\}}{\\exp(\\beta x)}=e^{\\beta}\\end{aligned}\\]因此拟合的 Cox 回归模型中的 \\(\\hat \\beta\\) 是当 \\(X\\) 的值增加 1 个单位时对数风险比估计的变化。使用类似的论点，当变量 \\(X\\) 的值增加 \\(r\\) 个单位时，对数风险比估计的变化为 \\(r \\hat \\beta\\)，相应的风险比估计为 \\(\\exp(r \\hat \\beta)\\)。对数风险比估计的标准误将为 \\(r\\, \\text{se}\\,(\\hat \\beta)\\)，从中可以得出真实风险比的置信区间。上述论证表明，当连续变量 \\(X\\) 包含在 Cox 回归模型中时，\\(X\\) 的值改变 \\(r\\) 个单位前后的风险比并不依赖于 \\(X\\) 的实际值。例如，如果 \\(X\\) 指的是个体的年龄，那么 70 岁的个体相对于 65 岁的个体的风险比与 20 岁的个体相对于 15 岁的个体的风险比是相同的。这一特征是直接将 \\(X\\) 作为 Cox 回归模型中的线性项进行拟合的直接结果。如果对线性假设存疑，可以使用 3.8.1 节中描述的程序进行检查。然后可以在建模过程中使用 \\(X\\) 的分数多项式或 \\(X\\) 的非线性变换。","code":""},{"path":"cox-回归模型.html","id":"sec3-9-2","chapter":"►Cox 回归模型","heading":"3.9.2 具有一个因素的模型","text":"当个体属于 \\(m(m\\ge 2)\\) 组中的一组，这对应于解释变量的类别时，这些组可以通过因素的水平进行索引。在 Cox 回归模型下，第 \\(j(j=1,2,\\ldots,m)\\) 组中个体的风险函数为\\[\\begin{aligned}h_j(t)=\\exp(\\gamma_j)h_0(t)\\end{aligned}\\]其中 \\(\\gamma_j\\) 是因素的第 \\(j\\) 个水平的效应，\\(h_0(t)\\) 是基线风险函数。该模型过度参数化了，因此，如 3.2.2 节所示，我们取 \\(\\gamma_1=0\\)。基线风险函数对应于第一组中的个体在时间 \\(t\\) 的死亡风险。第 \\(j(j\\ge 2)\\) 组中的个体在时间 \\(t\\) 的风险比相对于第一组中的个体的风险比为 \\(\\exp(\\gamma_j)\\)。因此，参数 \\(\\gamma_j\\) 是该相对风险的对数，即\\[\\begin{aligned}\\gamma_j=\\log\\{h_j(t)/h_0(t)\\}\\end{aligned}\\]可以通过定义 \\(m-1\\) 个指示变量 \\(X_2,X_3,...,X_m\\)（如 3.2.2 节所示）来拟合包含 \\(\\gamma_j(j = 1,2,...,m)\\) 且 \\(\\gamma_1 = 0\\) 的模型。拟合该模型会得出估计值 \\(\\hat\\gamma_2,\\hat\\gamma_3,\\ldots,\\hat\\gamma_m\\) 及其标准误。那么，，第 j 组的个体相对于第 1 组的个体的相对风险比的对数估计值为 \\(\\hat\\gamma_j\\)。真实对数风险比的 \\(100(1 − \\alpha)\\%\\) 置信区间是从 \\(\\hat{\\gamma}_j-z_{{\\alpha}/2}\\text{se}\\left(\\hat{\\gamma}_j\\right)\\) 到 \\(\\hat{\\gamma}_j+z_{{\\alpha}/2}\\text{se}\\left(\\hat{\\gamma}_j\\right)\\) 的区间，其中 \\(z_{{\\alpha}/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位数。通过对这些置信限进行指数运算，可以得到风险比本身的相应置信区间。示例 3.10  (肾癌的治疗) 表 3.6 给出了肾癌患者的生存时间数据。在本例中，我们将只考虑表 3.6 第 4 - 6 列中所示的那些接受过肾切除术的患者的数据。这组患者的生存时间是根据他们的年龄组进行分类的。如果第 \\(j\\) 个年龄组的效应用 \\(\\alpha_j\\) 表示，\\(j=1,2,3\\)，则第 \\(j\\) 个年龄段患者在时间 \\(t\\) 的风险的 Cox 回归模型如下\\[\\begin{aligned}h_j(t)=\\exp(\\alpha_j)h_0(t)\\end{aligned}\\]该模型可以通过定义两个指示变量 \\(A_2\\) 和 \\(A_3\\) 来拟合，其中，如果患者年龄在 60 岁到 70 岁之间，\\(A_2\\) 为 1，如果患者超过 70 岁，\\(A_3\\) 为 1，如示例 3.4 所示。这对应于 \\(\\alpha_1=0\\)。零模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值为 128.901，当添加项 \\(\\alpha_j\\) 时，该统计量的值减小为 122.501。在 2 个自由度上减小了 6.400. 在 5% 水平上显著 (\\(P = 0.041\\))，因此我们得出结论，风险函数确实取决于患者所处的年龄组。指示变量 \\(A_2\\) 和 \\(A_3\\) 的系数分别是 \\(\\alpha_2\\) 和 \\(\\alpha_3\\) 的估计，见表 3.14. 由于使用了约束 \\(\\alpha_1 = 0\\)，因此 \\(\\hat\\alpha_1 = 0\\)。\n60 - 70 岁患者相对于 60 岁以下患者的风险比为 \\(e^{-0.065}=0.94\\)，而 70 岁以上患者相对于 60 岁以下患者的风险比为 \\(e^{1.824}=6.20\\)。这些结果表明，在任何给定时间，70 岁以上患者的死亡风险最大，但其他两个年龄组患者的风险函数几乎没有差异。表 3.14 中参数估计的标准误可用于获得真实风险比的置信区间。对于年龄在 60 - 70 岁之间的患者，相对于年龄在 60 岁以下的患者，其对数风险比的 95% 置信区间是 \\(−0.065 ± (1.96 × 0.498)\\)，即区间 \\((−1.041, 0.912)\\)。对于风险比本身，相应的 95% 置信区间是 \\((0.35, 2.49)\\)。该置信区间包含 1，这表明年龄在 60 - 70 岁之间的个体的风险函数与年龄小于 60 岁的患者相似。同样地，年龄在 70 岁以上的患者相对于年龄在 60 岁以下的患者，其风险比的 95% 置信区间为 \\((1.63, 23.59)\\)。该区间不包含 1，因此，在任何给定时间，年龄超过 70 岁的个体的死亡风险显著高于年龄在 60 岁以下的患者。在某些应用中，可能需要计算除第一个水平以外的其他因素水平的风险比。在这种情况下，可以重新定义该因素的水平以及相关的指示变量，使该因素的某个其他水平对应于所需的基线水平，然后重新拟合模型。虽然这比较困难，但也可以直接从以原始因素的第一个水平为基线时获得的估计值中直接找到所需的估计值。因素水平 \\(j\\) 和 \\(j^\\prime\\) 的个体的风险函数分别为 \\(\\exp(\\alpha_j)h_0(t)\\) 和 \\(\\exp(\\alpha_{j^\\prime})h_0(t)\\)，因此水平 \\(j\\) 的个体相对于水平 \\(j^\\prime\\) 的个体的风险比为 \\(\\exp(\\alpha_j-\\alpha_{j'})\\)。对数风险比为 \\(\\alpha_j-\\alpha_{j'}\\)，其估计为 \\(\\hat\\alpha_j-\\hat\\alpha_{j'}\\)。为了获得该估计的标准误，我们使用差值 \\(\\hat\\alpha_j-\\hat\\alpha_{j'}\\) 方差的如下结果\\[\\begin{aligned}\\text{var}\\left(\\hat{\\alpha}_j-\\hat{\\alpha}_{j'}\\right)&=\\text{ var}\\left(\\hat{\\alpha}_j\\right)+\\text{ var}\\left(\\hat{\\alpha}_{j'}\\right)-2\\text{ cov}\\left(\\hat{\\alpha}_j,\\hat{\\alpha}_{j'}\\right)\\end{aligned}\\]鉴于此，需要估计 \\(\\hat\\alpha_j\\) 和 \\(\\hat\\alpha_{j'}\\) 之间的协方差以及它们的方差估计来计算 \\(\\hat\\alpha_j-\\hat\\alpha_{j'}\\) 的标准误。计算如示例 3.11 所示。示例 3.11  (肾癌的治疗) 再次考虑示例 3.4 中的数据子集，这对应于那些接受过肾切除术的患者。假设需要估计 70 岁以上个体相对于 60 - 70 岁个体的风险比。使用表 3.14 中的估计，对数风险比估计为 \\(\\hat{\\alpha}_3-\\hat{\\alpha}_2=1.824+0.065=1.889\\)，因此风险比估计为 \\(e^{1.889}=6.61\\)。这表明，70 岁以上的人在任何时间的死亡风险是 60 - 70 岁的人的 6.5 倍以上。\\(\\hat{\\alpha}_3-\\hat{\\alpha}_2\\) 的方差为\\[\\begin{aligned}\\operatorname{var}\\left(\\hat{\\alpha}_3\\right)+\\operatorname{var}\\left(\\hat{\\alpha}_2\\right)-2\\operatorname{cov}\\left(\\hat{\\alpha}_3,\\hat{\\alpha}_2\\right)\\end{aligned}\\]参数估计的方差-协方差阵给出了所需的方差和协方差。该矩阵可以从用于拟合 Cox 回归模型的统计软件中获得，为\\[\\begin{array}{cc}A_2\\\\A_3\\\\\\,\\end{array}\\begin{array}{cc}0.2484&0.0832\\\\0.0832&0.4649\\\\A_2&A_3\\end{array}\\]其中 \\(\\text{var}\\left(\\hat{\\alpha}_2\\right)=0.2484,\\text{var}\\left(\\hat{\\alpha}_3\\right)=0.4649\\) 以及 \\(\\mathrm{cov}\\left(\\hat{\\alpha}_2,\\hat{\\alpha}_3\\right)=0.0832\\)。当然，方差只是表 3.14 中标准误的平方。那么\\[\\begin{aligned}\\text{var}\\left(\\hat{\\alpha}_3-\\hat{\\alpha}_2\\right)=0.4649+0.2484-(2\\times0.0832)=0.5469\\end{aligned}\\]因此 \\(\\hat{\\alpha}_3-\\hat{\\alpha}_2\\) 的标准误为 0.740。因此，对数风险比的 95% 置信区间为 \\((0.440, 3.338)\\)，风险比本身的 95% 置信区间为 \\((1.55, 28.18)\\)。获取年龄大于 70 岁的个体相对于年龄在 60 - 70 岁之间的个体的风险比估计及其估计的标准误的一种更简单的方法，是重新定义与年龄组相关的因素的水平。假设数据现在是这样安排的：因素的第一水平对应于 60 - 70 岁的患者，第二水平对应于年龄大于 70 岁的患者，第三水平对应于年龄小于 60 岁的患者。选择指示变量使得重新定义的因素的第一水平的效应等于零，从而得到表 3.15 中定义的变量 \\(B_2\\) 和 \\(B_3\\)。现在，所需对数风险比估计就是 \\(B_2\\) 的系数估计，而其标准误可以直接从标准计算机输出中读取。指示变量系数的解释方式在很大程度上取决于它们所使用的编码。这意味着，当使用能够直接拟合因素的统计软件包来拟合 Cox 回归模型时，必须了解软件包中使用的指示变量是如何定义的。为进一步说明，假设个体属于 \\(m\\) 个组中的一个，并且用于 \\(m − 1\\) 个指示变量 \\(X_2, X_3,...,X_m\\) 的编码使得 \\(\\) 的主效应之和 \\(\\sum_{j=1}^m\\alpha_j\\) 等于 0。具有 \\(m\\) 个水平的因素 \\(\\) 对应的指示变量值如表 3.16 所示。\n通过选择指示变量，包含该因素的 Cox 回归模型可以表示为以下形式\\[\\begin{aligned}h_j(t)=\\exp(\\alpha_2x_2+\\alpha_3x_3+\\cdots+\\alpha_mx_m)h_0(t)\\end{aligned}\\]其中 \\(x_j\\) 是因素 \\(\\) 处于第 \\(j\\) 水平的个体的 \\(X_j\\) 值，\\(j = 2, 3,...,m\\)。处于因素第一水平的个体在给定时间的死亡风险为\\[\\begin{aligned}\\exp\\{-(\\alpha_2+\\alpha_3+\\cdots+\\alpha_m)\\}h_0(t)\\end{aligned}\\]而对于第 \\(j\\) 水平因素的个体，其风险比为 \\(\\exp(\\alpha_j)h_0(t)\\)，其中 \\(j \\ge 2\\)。组 \\(j\\) 中的个体的风险比相对于第一组中的个体的风险比为\\[\\begin{aligned}\\exp(\\alpha_j+\\alpha_2+\\alpha_3+\\cdots+\\alpha_m)\\end{aligned}\\]例如，如果 \\(m = 4\\) 且 \\(j = 3\\)，则风险比为 \\(\\exp(\\alpha_2+2\\alpha_3+\\alpha_4)\\)，相应对数风险比估计的方差为\\[\\begin{aligned}\\operatorname{var}\\left(\\hat{\\alpha}_2\\right)+4\\operatorname{var}\\left(\\hat{\\alpha}_3\\right)+\\operatorname{var}\\left(\\hat{\\alpha}_4\\right)+4\\operatorname{cov}\\left(\\hat{\\alpha}_2,\\hat{\\alpha}_3\\right)\\\\+4\\operatorname{cov}\\left(\\hat{\\alpha}_3,\\hat{\\alpha}_4\\right)+2\\operatorname{cov}\\left(\\hat{\\alpha}_2,\\hat{\\alpha}_4\\right)\\end{aligned}\\]该表达式中的每一项都可以在拟合 Cox 回归模型后从参数估计的方差-协方差阵中找到，并获得风险比的置信区间。然而，指示变量的这种特殊编码使拟合模型各个参数估计的解释变得更加复杂。在前面的部分中，我们仅考虑了包含单个项的 Cox 回归模型参数估计的解释。更一般地，拟合模型将包含与多个变量、因素或两者的组合相对应的项。通过对与模型中的因素相对应的指示变量进行适当的编码，参数估计可以再次解释为风险比的对数。当一个模型包含一个以上的变量时，与特定效应相关的参数估计被认为是经模型中其他变量调整的 (adjusted)，因此这些估计是经模型其他项调整的对数风险比。因此，考虑模型中包含的其他变量，Cox 回归模型可用于估计风险比。当拟合因素之间的交互作用，或涉及因素和变量的混合项时，特定因素的对数风险比估计将因任何因素的水平或与之交互的任何变量的值而异。在这种情况下研究感兴趣因素的风险比估计时，需要明确任何此类因素水平或变量的值。我们不会详细介绍在拟合具有不同项的组合的模型后如何估计风险比的代数细节，而是将通过两个例子来说明一般方法。第一个例子涉及因素和变量，而第二个例子包括两个因素之间的交互作用。示例 3.12  (前列腺癌两种疗法的比较) 在示例 3.6 中，发现在前列腺癌患者的生存研究中最重要的预后变量是肿瘤大小 (Size) 和肿瘤分期的 Greason index (Index). 代表治疗效应的指示变量 Treat 也包含在 Cox 回归模型中，因为研究的目的是量化治疗效应。第 \\(\\) 个个体的模型可以表示为以下形式\\[\\begin{aligned}h_i(t)=\\exp\\{\\beta_1Size_i+\\beta_2Index_i+\\beta_3Treat_i\\}h_0(t)\\end{aligned}\\]其中 \\(=1,2,\\ldots,38\\)。该模型的 \\(\\beta\\) 系数估计及其标准误如表 3.17 所示。\n对于接受 DES 治疗 (Treat = 1) 的个体，与接受安慰剂 (Treat = 0) 的个体相比，在 Size 和 Index 值相同的情况下，其对数风险比估计为 \\(\\hat{\\beta}_3=-1.113\\)。因此，风险比估计为 \\(e^{-1.113}=0.329\\)。这个风险比的值不受 Size 和 Index 实际值的影响。然而，由于这两个解释变量被纳入了模型，因此估计的风险比已经针对这些变量进行了调整。作为比较，如果拟合仅包含 Treat 的模型，则 Treat 的系数估计为 -1.978. 相对于使用安慰剂的个体，使用 DES 的个体的风险比估计（未经 Size 和 Index 调整）现在为 \\(e^{-1.978}=0.14\\)。这表明，除非适当考虑肿瘤大小和肿瘤分级指数的影响，否则会高估治疗效应。现在考虑某接受特定治疗的个体，在变量 Index 值一定且肿瘤大小一定的情况下，与接受相同治疗、Index 值相同但肿瘤大小小一个单位的个体相比的风险比。该风险比为 \\(e^{0.083}=1.09\\)。因为这个值大于 1，我们可以得出结论，在其他条件相同的情况下，肿瘤越大，在任何给定时间的死亡风险就越大。类似地，某接受特定治疗且 Size 值一定的个体，与接受相同治疗、Size 值相同但 Index 值小一个单位的个体相比的风险比为 \\(e^{0.710}=2.03\\)。这也意味着，Gleason 指数的值越大，在任何给定时间的死亡风险就越大。具体来说，Index 值增加一个单位会使死亡风险加倍。示例 3.12  (肾癌的治疗) 再次考虑表 3.6 中给出的肾癌治疗后生存时间的完整数据集。在示例 3.4 中，发现最合适的 Cox 回归模型包含对应于年龄组的项 \\(\\alpha_j, j = 1, 2, 3\\)，以及对应于是否进行肾切除术的项 \\(\\nu_k, k = 1, 2\\)。出于说明目的，在本示例中，我们将考虑还包含这两个因素之间交互作用的模型，尽管该模型并不显著。在此模型下，第 \\(j\\) 个年龄组和第 \\(k\\) 个肾切除状态水平的个体的风险函数为\\[\\begin{equation}\nh(t)=\\exp\\{\\alpha_j+\\nu_k+(\\alpha\\nu)_{jk}\\}h_0(t)\n\\tag{3.17}\n\\end{equation}\\]其中 \\((\\alpha\\nu)_{jk}\\) 为交互作用项。考虑第 \\(j(j = 1, 2, 3)\\) 个年龄组、第 \\(k(k = 1, 2)\\) 个肾切除状态水平的患者相对于第一个年龄组、接受肾切除术的患者在时间 \\(t\\) 的死亡风险比\\[\\begin{aligned}\\exp\\{\\alpha_j+\\nu_k+(\\alpha\\nu)_{jk}\\}\\\\\\exp\\{\\alpha_1+\\nu_1+(\\alpha\\nu)_{11}\\}\\end{aligned}\\]如示例 3.4 所示，式 (3.17) 中的模型是通过在模型中包含指示变量 \\(A_2,A_3\\) 和 \\(N\\) 以及乘积 \\(A_2N\\) 和 \\(A_3N\\) 来拟合的。这些变量的系数估计分别为 \\(\\alpha_2,\\alpha_3,\\nu_2,(\\alpha\\nu)_{22}\\) 和 \\((\\alpha\\nu)_{32}\\)。根据所使用的指示变量的编码，估计值 \\(\\hat{\\alpha}_{2},\\hat{\\alpha}_{3},\\hat{\\nu}_{2},\\widehat{\\left(\\alpha\\nu\\right)}_{22}\\) 和 \\(\\widehat{\\left(\\alpha\\nu\\right)}_{32}\\) 均为零。第 \\(j(j = 1, 2, 3)\\) 个年龄组、第 \\(k(k = 1, 2)\\) 个肾切除状态水平的患者相对于第一个年龄组、接受肾切除术的患者的死亡风险比估计，为\\[\\exp\\{\\hat{\\alpha}_j+\\hat{\\nu}_k+\\widehat{(\\alpha\\nu)}_{jk}\\}\\]非零参数估计值为 \\(\\hat{\\alpha}_2=0.005,\\hat{\\alpha}_3=0.065,\\hat{\\nu}_2=-1.943,\\widehat{(\\alpha\\nu)}_{22}=-0.051\\) 和 \\(\\widehat{\\left(\\alpha\\nu\\right)_{32}}=2.003\\)，风险比估计总结于表 3.18 中。\n在表 3.18 中，包含了风险比估计为 1.000 的因素水平组合，这强调了风险是相对于第一年龄组中没有接受过肾切除手术的个体而言的。该表显示，与其他年龄组的个体以及未接受肾切除手术的个体相比，年龄小于等于 70 岁且接受过肾切除手术的个体死亡风险要小得多。可以使用 3.9.2 节中描述的方法找到相应真实风险比的置信区间。作为进一步说明，将获得接受过肾切除术的第二年龄组中的个体相对于第一年龄组中的个体的风险比的置信区间。对数风险比估计现在为 \\(\\hat{\\alpha}_2+\\widehat{(\\alpha\\nu)}_{22}\\)，因此风险比估计为 0.955。该估计的方差由下式给出\\[\\begin{aligned}\\operatorname{var}\\left(\\hat{\\alpha}_2\\right)+\\operatorname{var}\\left\\{\\widehat{\\left(\\alpha\\nu\\right)}_{22}\\right\\}+2\\operatorname{cov}\\left\\{\\hat{\\alpha}_2,\\widehat{\\left(\\alpha\\nu\\right)}_{22}\\right\\}\\end{aligned}\\]根据式 (3.17) 拟合模型，从其参数估计的方差-协方差阵可得，\\(\\operatorname{var}\\left(\\hat{\\alpha}_2\\right)=0.697,\\operatorname{var}\\left\\{\\widehat{\\left(\\alpha\\nu\\right)}_{22}\\right\\}=0.942\\)，协方差项为 \\(\\mathrm{cov}\\left\\{\\hat{\\alpha}_2,\\widehat{(\\alpha\\nu)}_{22}\\right\\}=-0.695\\)。因此，对数风险比估计的方差为 0.248，因此真实对数风险比的 95% 置信区间范围为 -0.532 到 0.441. 真实风险比的相应置信区间为 \\((0.59, 1.55)\\)。该区间包含 1，因此风险比 0.955 在 5% 水平下与 1 没有显著差异。表 3.18 中风险比的置信区间可以用类似的方式得出。","code":""},{"path":"cox-回归模型.html","id":"sec3-10","chapter":"►Cox 回归模型","heading":"3.10 估计风险函数和生存函数","text":"到目前为止，在本章中，我们只考虑了 Cox 回归模型中线性部分的 \\(\\beta\\) 参数的估计。正如我们所见，为了推断模型中解释变量对风险函数的影响，我们只需要进行这些步骤。一旦确定了适用于一组生存数据的合适模型，就可以估计风险函数和相应的生存函数。然后，这些估计值可用于总结研究中个体的生存经历。假设 Cox 回归模型的线性部分包含 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\)，并且这些变量的估计系数为 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\)。研究中 \\(n\\) 个个体的第 \\(\\) 个风险函数估计由下式给出\\[\\begin{equation}\n\\hat{h}_i(t)=\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol x_i)\\hat{h}_0(t)\n\\tag{3.18}\n\\end{equation}\\]其中 \\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体的解释变量的值向量，\\(= 1, 2,...,n\\)，\\(\\hat {\\boldsymbol \\beta}\\) 是系数向量的估计，\\(\\hat h_0(t)\\) 是基线风险函数估计。使用该方程，一旦得到 \\(h_0(t)\\) 的估计，就可以得到个体风险函数估计。然后可以使用风险、累积风险和生存函数之间的关系来给出累积风险函数和生存函数的估计。Kalbfleisch Prentice (1973) 使用基于最大似然法的方法得出了基线风险函数的估计。假设有 \\(r\\) 个不同的死亡时间，按升序排列时，为 \\(t_{(1)}<t_{(2)}<\\cdots<t_{(j)}\\)，并且在时间 \\(t\\) 有 \\(d_j\\) 个人死亡，\\(n_j\\) 个人处于风险之中。时间 \\(t_{(j)}\\) 处的基线风险函数估计由下式给出\\[\\begin{equation}\n\\hat{h}_0(t_{(j)})=1-\\hat{\\xi_j}\n\\tag{3.19}\n\\end{equation}\\]其中 \\(j=1,2,\\ldots,r\\)。\\(\\widehat{\\xi}_j\\) 为下式的解\\[\\begin{equation}\n\\sum_{l\\D(t_{(j)})}\\frac{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}{1-\\hat{\\xi}_j^{\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol x_l)}}=\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)\n\\tag{3.20}\n\\end{equation}\\]在式 (3.20) 中，\\(D(t_{(j)})\\) 是在第 \\(j\\) 个有序死亡时间 \\(t_{(j)}\\) 处死亡的所有 \\(d_j\\) 个个体的集合，以及如 3.3 节所示，\\(R(t_{(j)})\\) 是在时间 \\(t_{(j)}\\) 处于风险中的所有 \\(n_j\\) 个个体的集合。那些 \\(\\beta\\) 的估计构成了向量 \\(\\hat{\\boldsymbol \\beta}\\)，就是那些使式 (3.4) 中的似然函数达到最大化的值。\\(h_0(t)\\) 的估计的推导相当复杂，此处不再赘述。在没有死亡时间结的情况下，即对于 \\(j=1,2,\\ldots,r\\) 有 \\(d_j=1\\)，式 (3.20) 的左侧将成为单个项（直接省去求和号）。那么可以求解该方程，得到\\[\\begin{equation}\n\\hat{\\xi_j}=\\left(1-\\frac{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_{(j)})}{\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}\\right)^{\\exp(-\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_{(j)})}\n\\end{equation}\\]其中 \\(\\boldsymbol{x}_{(j)}\\) 是在时间 \\(t_{(j)}\\) 死亡的个体的解释变量向量。当存在观测结时，即当一个或多个 \\(d_j>1\\) 时，式 (3.20) 左侧的求和是一系列分数之和，其中，在分母中出现了 \\(\\widehat{\\xi}_{j}\\)，并具有不同的幂次。则式 (3.20) 无法显式求解，需要迭代计算。我们现在假设相邻死亡时间之间的死亡风险是恒定的。然后，通过将式 (3.19) 中的风险估计除以时间区间长度，从而得到该区间内基线风险函数的合适估计，这是一个阶跃函数\\[\\begin{equation}\n\\hat{h}_0(t)=\\frac{1-\\hat{\\xi}_j}{t_{(j+1)}-t_{(j)}}\n\\tag{3.21}\n\\end{equation}\\]其中 \\(t_{(j)}\\leqslant t<t_{(j+1)},j=1,2,\\ldots,r-1\\)，且对于 \\(t<t_{(1)}\\) 有 \\(\\hat{h}_0(t)=0\\)。量 \\(\\hat{\\xi}_j\\) 可视为个体在 \\(t_{(j)}\\) 到 \\(t_{(j+1)}\\) 区间内生存概率的估计。那么基线生存函数可估计为\\[\\begin{equation}\n\\hat{S}_0(t)=\\prod_{j=1}^k\\hat{\\xi}_j\n\\tag{3.22}\n\\end{equation}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r-1\\)，该估计也为阶跃函数。且对于 \\(t<t_{(1)}\\)，基线生存函数的估计为 1；对于 \\(t\\geqslant t_{(r)}\\)，估计为 0，除非有大于 \\(t_{(r)}\\) 的删失生存时间，如果是这种情况，则在最大删失时间之前可以将 \\(\\hat{S}_0(t)\\) 取为 \\(\\hat{S}_0(t_{(r)})\\)，但在该时间之后生存函数估计是未定义的。根据式 (1.8)，基线累积风险函数为 \\(H_0(t)=-\\log S_0(t)\\)，该函数的估计为\\[\\begin{equation}\n\\hat{H}_0(t)=-\\log\\hat{S}_0(t)=-\\sum_{j=1}^k\\log\\hat{\\xi}_j\n\\tag{3.23}\n\\end{equation}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r-1\\)，且对于 \\(t<t_{(1)}\\) 有 \\(\\hat{H}_0(t)=0\\)。式 (3.21), (3.22) 和 (3.23) 中的基线风险函数、生存函数和累积风险函数的估计可用于得到具有解释变量向量 \\(\\boldsymbol{x}_{}\\) 的个体的相应估计。具体来说，根据式 (3.18) ，通过 \\(\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol x_i)\\hat{h}_0(t)\\) 来估计风险函数。接下来，对式 (3.18) 两边进行积分，我们得到\\[\\begin{equation}\n\\int_0^t\\hat{h}_i(u)\\mathrm{d}u=\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i)\\int_0^t\\hat{h}_0(u)\\mathrm{d}u\n\\tag{3.24}\n\\end{equation}\\]因此第 \\(\\) 个个体的累积风险函数估计为\\[\\begin{equation}\n\\hat{H}_{\\boldsymbol{}}(t)=\\operatorname{exp}(\\hat{\\boldsymbol \\beta}'\\boldsymbol x_{{}})\\hat{H}_{0}(t)\n\\tag{3.25}\n\\end{equation}\\]将式 (3.24) 的两边乘以 −1 后进行指数运算，并利用式 (1.6)，我们得到第 \\(\\) 个个体的生存函数估计\\[\\begin{equation}\n\\hat{S}_i(t)=\\left\\{\\hat{S}_0(t)\\right\\}^{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i)}\n\\tag{3.26}\n\\end{equation}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r-1\\)。请注意，一旦获得了生存函数估计 \\(\\hat{S}_i(t)\\)，累积风险函数的估计就简单地是 \\(-\\operatorname{log}\\hat{S}_{{}}(t)\\)。","code":""},{"path":"cox-回归模型.html","id":"sec3-10-1","chapter":"►Cox 回归模型","heading":"3.10.1 无协变量的特例","text":"当不存在协变量时，因此我们只有一个生存时间样本，式 (3.20) 变为\\[\\begin{aligned}\\frac{d_j}{1-\\hat{\\xi}_j}&=n_j\\end{aligned}\\]其中\\[\\hat{\\xi_j}=\\frac{n_j-d_j}{n_j}\\]那么，在时间 \\(t_{(j)}\\) 处的基线风险函数估计为 \\(1-\\hat{\\xi}_j\\)，也就是 \\(d_j/n_j\\)。式 (3.22) 中生存函数的相应估计为 \\(\\prod_{j=1}^k\\hat{\\xi}_j\\)，即\\[\\prod_{j=1}^k\\left(\\frac{n_j-d_j}{n_j}\\right)\\]这正是之前在式 (2.4) 中给出的生存函数的 Kaplan-Meier 估计。这表明，式 (3.26) 给出的生存函数估计将 Kaplan-Meier 估计推广到风险函数取决于解释变量的情况。此外，式 (3.21) 中的风险函数估计简化为 \\(d_j/\\{n_j(t_{(j+1)}-t_{(j)})\\}\\)，这是第 2 章式 (2.13) 中给出的风险函数估计。","code":""},{"path":"cox-回归模型.html","id":"sec3-10-2","chapter":"►Cox 回归模型","heading":"3.10.2 基线函数估计的一些近似","text":"当存在生存时间结时，只能通过使用迭代方法求解式 (3.20) 来得到的基线风险估计。但可以通过使用式 (3.20) 左侧求和的近似来绕过这种迭代过程。在式 (3.20) 左侧分母中的项\\[\\hat{\\xi}_j^{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}\\]可写为\\[\\exp\\left\\{e^{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l}\\log\\hat{\\xi}_j\\right\\}\\]取指数展开中的前两项，得到\\[\\exp\\left\\{e^{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l}\\log\\hat{\\xi}_j\\right\\}\\approx1+e^{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l}\\log\\hat{\\xi}_j\\]将使用该近似在时间 \\(t_{\\left(j\\right)}\\) 处获得的基线风险估计记作 \\(1-\\tilde{\\xi}_j\\)，并在式 (3.20) 中用 \\(1+e^{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l}\\log\\widetilde{\\xi}_{j}\\) 替换 \\(\\hat{\\xi}_j^{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}\\)，我们发现 \\(\\tilde{\\xi}_j\\) 满足\\[-\\sum_{l\\D(t_{(j)})}\\frac1{\\log\\tilde{\\xi}_j}=\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)\\]因此\\[\\begin{aligned}\\frac{-d_j}{\\log\\widetilde{\\xi_j}}&=\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)\\end{aligned}\\]由于 \\(d_j\\) 是第 \\(j\\) 个有序死亡时间 \\(t_{(j)}\\) 处的死亡人数，因此\\[\\begin{equation}\n\\tilde{\\xi}_j=\\exp\\left(\\frac{-d_j}{\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta'x}}_l)}\\right)\n\\tag{3.27}\n\\end{equation}\\]根据式 (3.22) ，基于 \\(\\tilde{\\xi}_j\\) 的值，生存函数的估计为\\[\\begin{equation}\n\\tilde{S}_0(t)=\\prod_{j=1}^k\\exp\\left(\\frac{-d_j}{\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}\\right)\n\\tag{3.28}\n\\end{equation}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r-1\\)。根据该定义，与式 (3.22) 中的估计不同，当最长生存时间未删失时，生存函数估计不一定为 0. 根据 \\(\\tilde{S}_0(t)\\) 得出的基线累积风险函数的估计为\\[\\begin{equation}\n\\tilde{H}_0(t)=-\\log\\tilde{S}_0(t)=\\sum_{j=1}^k\\frac{d_j}{\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol x_l)}\n\\tag{3.29}\n\\end{equation}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r-1\\)。该估计通常称为基线累积风险函数的 Nelson-Aalen 估计或 Breslow 估计。当不存在协变量时，由于 \\(n_j\\) 是在时间 \\(t_{(j)}\\) 处于风险的个体数量，式 (3.28) 中的基线生存函数估计变为\\[\\begin{equation}\n\\prod_{j=1}^k\\exp(-d_j/n_j)\n\\tag{3.30}\n\\end{equation}\\]这是第 2 章式 (2.5) 中给出的生存函数的 Nelson-Aalen 估计，基线累积风险函数的相应估计为 \\(\\sum_{j=1}^kd_j/n_j\\) ，如第 2 章 2.3.3 节所示。注意到表达式\\[\\frac{-d_j}{\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)}\\]是式 (3.27) 的指数部分，该值往往很小，除非在特定死亡时间有大量的结。取此指数展开的前两项，将这个关于 \\(\\xi_j\\) 的新的近似记为 \\(\\xi_j^*\\)，得到\\[\\xi_j^*=1-\\frac{d_j}{\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)}\\]利用式 (3.21)，从 \\(t_{(j)}\\) 到 \\(t_{(j+1)}\\) 的区间的基线风险函数估计由下式给出\\[\\begin{equation}\nh_0^*(t)=\\frac{d_j}{(t_{(j+1)}-t_{(j)})\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)}\n\\tag{3.31}\n\\end{equation}\\]其中 \\(t_{(j)}\\leqslant t<t_{(j+1)},j=1,2,\\ldots,r-1\\)。使用 \\(\\xi_{j}^{*}\\) 替换式 (3.22) 中的 \\(\\xi_{j}\\)，相应的基线生存函数估计为\\[\\begin{aligned}S_0^*(t)=\\prod_{j=1}^k\\left(1-\\frac{d_j}{\\sum_{l\\R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)}\\right)\\end{aligned}\\]以及，基线累积风险函数估计的进一步近似为 \\(H^*_0(t)=-\\log S_0^*(t)\\)。请注意，式 (3.29) 中在时间 \\(t\\) 处 的累积风险函数可以表示为\\[\\begin{aligned}\\tilde{H}_0(t)=\\sum_{j=1}^k(t_{(j+1)}-t_{(j)})h_0^*(t)\\end{aligned}\\]其中 \\(h^*_0(t)\\) 由式 (3.31) 给出。因此，式 (3.29) 中基线累积风险函数估计的连续值之差提供了在时间 \\(t_{(1)},t_{(2)},\\ldots,t_{(r)}\\) 处的基线风险函数的近似，这很容易计算。在无协变量的特例中，估计 \\(h_0^*(t),S_0^*(t)\\) 和 \\(H_0^*(t)\\) 与 3.10.1 节中给出的相同。类似于式 (3.25) 和 (3.26) 的方程可用于估计解释变量向量为 \\(\\boldsymbol x_i\\) 的个体的累积风险和生存函数。在实践中，使用 \\(\\tilde{S}_0(t)\\) 或 \\(S_0^*(t)\\) 代替 \\(\\hat{S}_0(t)\\) 通常在计算上是有利的。当生存时间结的数量很小时，三种估计往往非常相似。此外，由于估计通常用作生存数据的描述性总结，因此估计之间的微小差异不太可能具有实际意义。示例 3.13  (肾癌的治疗) 在示例 3.4 中，利用 Cox 回归模型拟合了高肾瘤患者的生存时间数据。研究发现，风险函数取决于患者的年龄组，以及是否进行了肾切除术。第 \\(\\) 名患者的风险函数估计为\\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{0.013A_{2i}+1.342A_{3i}-1.412N_i\\}\\hat{h}_0(t)\\end{aligned}\\]其中，如果患者年龄在 60 - 70 岁之间，则 \\(A_{2i}\\) 为 1，否则为 0；如果患者年龄超过 70 岁，则 \\(A_{3i}\\) 为 1，否则为 0，并且如果患者进行了肾切除术，则 \\(N_i\\) 为 1，反之为 0. 因此基线风险函数估计是年龄小于 60 且未进行肾切除术的个体在时间 \\(t\\) 时死亡的风险估计。分别使用式 (3.19), (3.23) 和 (3.22) 得到的基线风险函数估计 \\(\\hat{h}_0(t)\\)、累积风险函数估计 \\(\\hat{H}_0(t)\\) 和 生存函数估计 \\(\\hat{S}_0(t)\\)，列于表 3.19 中。\n根据该表，我们可以看出，基线风险函数估计的总体趋势是随着时间的推移而增加。根据基线风险函数估计的计算方式，该估计仅适用于研究中患者的死亡时间。然而，如果假设在每个时间区间内存在恒定的风险，通过将估计的风险除以相应的时间区间长度，可以得到每单位时间的死亡风险。这得到了式 (3.21) 中的估计。该风险函数如图 3.4 所示。\n该图显示，在研究期间，每单位时间的死亡风险大致恒定。表 3.19 还显示，正如预期的那样，\\(\\hat{H}_{0}(t)\\) 的连续观测之差与 \\(\\hat{h}_{0}(t)\\) 非常相似。我们现在考虑中位生存时间估计，其定义为生存函数估计小于 0.5 的最小观测生存时间。根据表 3.19，年龄在 60 岁以下且未进行肾切除术的患者的中位生存时间估计为 12 个月。通过将基线生存函数估计的指定合适的幂，可以使用式 (3.26) 获得其他年龄组患者以及接受过肾切除术患者的生存函数估计。因此，第 \\(\\) 个个体的生存函数估计由下式给出\\[\\hat{S}_i(t)=\\left\\{\\hat{S}_0(t)\\right\\}^{\\exp\\{0.013A_{2i}+1.342A_{3i}-1.412N_i\\}}\\]对于一个年龄小于 60 岁、接受过肾切除术的个体，有 \\(A_2=0,A_3=0\\) 以及 \\(N_=1\\)，因此该个体的生存函数估计成为\\[\\left\\{\\hat{S}_0(t)\\right\\}^{\\exp\\{-1.412\\}}\\]该函数与同一年龄组但未接受肾切除术个体的基线生存函数估计一起绘制在图 3.5 中。此图表明，接受肾切除术的患者相比未接受肾切除术的患者，在任何给定时间的生存概率都更大，从而证实肾切除术能够改善肾癌患者的预后。\n请注意，由于假设了比例风险，图 3.5 中的两个生存函数估计不会交叉。此外，那些接受过肾切除的患者的生存函数估计高于那些没有接受过肾切除的患者。这是接受过手术的人相对于未接受手术的人风险比估计小于 1 的直接结果。此类患者的中位生存时间估计可以从生存函数估计的表格或图 3.5 中获得。我们发现，年龄小于 60 岁、接受肾切除术的患者的中位生存时间估计为 36 个月。可以使用类似的方法估计生存时间分布的其他百分位数。以类似的方式，可以比较不同年龄组患者的生存函数，无论是否接受过肾切除术。例如，对于接受过肾切除术的患者，三个年龄组患者的生存函数估计分别为 \\(\\{\\hat{S}_0(t)\\}^{\\exp\\{-1.412\\}},~\\{\\hat{S}_0(t)\\}^{\\exp\\{-1.412+0.013\\}}\\) 和 \\(\\{\\hat{S}_0(t)\\}^{\\exp\\{-1.412+1.342\\}}\\)。这些生存函数估计如图 3.6 所示，它清楚地表明 70 岁以上的患者的预后比其他两个年龄组的患者更差。","code":""},{"path":"cox-回归模型.html","id":"sec3-11","chapter":"►Cox 回归模型","heading":"3.11 风险调整的生存函数","text":"一旦拟合了 Cox 回归模型，就可以获得每个个体的生存函数估计。接下来可能会关注拟合的生存函数与未经调整的 Kaplan-Meier 估计的生存函数有何差异。这样就可以确定风险调整的影响。为此，通过在每个事件时间点上对个体生存函数估计进行平均来获得风险调整的生存函数 (risk-adjusted survival function).正式地说，假设 Cox 回归模型拟合了 \\(n\\) 个个体的生存数据，其中第 \\((=1,2,\\ldots,n)\\) 个个体在时间 \\(t\\) 的死亡风险为\\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\end{aligned}\\]其中 \\(\\boldsymbol\\beta'\\boldsymbol{x}_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\)。\\(x_{1i},x_{2i},\\ldots,x_{pi}\\) 为每个个体的 \\(p\\) 个解释变量的值，\\(h_0(t)\\) 为基线风险函数。第 \\(\\) 个个体相应的生存函数为\\[S_i(t)=\\{S_0(t)\\}^{\\exp(\\boldsymbol{\\beta'x_i})}\\]模型拟合过程会得出 \\(p\\) 个 \\(\\beta\\) 参数 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 以及基线生存函数 \\(\\hat{S}_0(t)\\) 的估计。然后，在给定时间 \\(t\\) 处的平均生存函数 (average survivor function) 为\\[\\begin{equation}\n\\hat{S}(t)=\\frac{1}{n}\\sum_{=1}^n\\hat{S}_i(t)\n\\tag{3.32}\n\\end{equation}\\]其中\\[\\hat{S_i}(t)=\\left\\{\\hat{S_0}(t)\\right\\}^{\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol x_i)}\\]为第 \\(\\) 个个体的生存函数估计。那么可以根据 \\(\\hat{S_i}(t)\\) 获得生存率（生存时间分布中位数和其他百分位数）的风险调整估计。示例 3.14  (多发性骨髓瘤患者的生存率) 在示例 3.5 中，发现包含解释变量 Hb 和 Bun 的 Cox 回归模型适合对示例 1.3 中介绍的多发性骨髓瘤患者生存时间数据进行建模。第 \\(\\) 个患者 \\(= 1, 2,..., 48\\) 的生存函数估计为\\[\\hat{S_i}(t)=\\left\\{\\hat{S_0}(t)\\right\\}^{\\exp(\\hat{\\eta_i})}\\]其中风险评分 \\(\\hat{\\eta}_{{}}\\) 为 \\(\\hat{\\eta}_i=-0.134Hb_i+0.019Bun_i\\)。那么可以在数据集中的每个事件时间获取 48 名患者的生存函数估计。对每个事件时间的 48 名患者的估计进行平均，得出风险调整的生存函数。图 3.7 绘制了该函数以及生存函数未经调整的 Kaplan-Meier 估计。这两种生存函数估计非常接近，因此在本例中，风险调整过程对生存率或中位生存时间的估计几乎没有影响。","code":""},{"path":"cox-回归模型.html","id":"sec3-11-1","chapter":"►Cox 回归模型","heading":"3.11.1 分组风险调整的生存函数","text":"在许多情况下，对个体的某些特定组别进行风险调整以调整这些分组之间因解释变量值的不同而产生的差异，并估计调整的生存函数是有意义的。例如，考虑一项关于采用两种不同治疗方案的无病生存 (disease-free survival) 的研究。若这项研究是以随机对照试验的方式进行，那么很可能各治疗组之间解释变量的值会均衡分配。这时，可以使用未经调整的 Kaplan-Meier 方法对每个组别估计生存函数，辅以未经调整和经过调整的治疗效应的风险比，从而充分总结数据。然而，如果数据来源于观察性研究，在该研究中，解释变量的值在两个治疗组之间不一定均衡分布。在这种情况下，对两个组别未经调整的生存函数估计可能会产生误导。此时，在得出关于治疗效应的结论之前，需要先进行风险调整过程，以便考虑到两个组别内个体特征之间不均衡的情况。如果可以假设治疗组之间的差异与时间无关，则可以将组别效应添加到生存模型中，并利用式 (3.32) 计算每个治疗组中个体的风险调整的生存函数。然而，在许多应用中，例如在第 11 章中要考虑的比较机构之间的生存率时，不能做出这种假设。此时，就需要将 Cox 回归模型扩展：每组具有不同的基线风险函数。假设在一项比较 \\(g\\) 组个体生存率的研究中，已拟合了一个包含有意义的解释变量的 Cox 回归模型，但不包含组别效应。那么在第 \\(j(j=1,2,\\ldots,g)\\) 组中，第 \\((=1,2,\\ldots,n_j)\\) 个个体在时间 \\(t\\) 处的死亡风险模型可表示为\\[\\begin{aligned}h_{ij}(t)=\\exp(\\boldsymbol{\\beta'x}_{ij})h_{0j}(t)\\end{aligned}\\]其中 \\(\\boldsymbol{\\beta'x_{ij}}=\\beta_1x_{1ij}+\\beta_2x_{2ij}+\\cdots+\\beta_px_{pij}\\)。\\(x_{1{}j},x_{2{}j},\\ldots,x_{{pi}j}\\) 为对每个个体测量的 \\(p\\) 个解释变量的值。\\(h_{0j}(t)\\) 是第 \\(j\\) 组的基线风险函数。在该模型中，\\(p\\) 个解释变量的系数，\\(\\beta_1,\\beta_2,\\ldots,\\beta_p\\) 在 \\(g\\) 个组中是恒定的，但每组的基线风险函数不同。这是一个分层 Cox 回归模型 (stratified Cox regression model)，其中 \\(g\\) 个组定义了单独的分层。这些模型将在第 11 章中进行更详细的讨论。在拟合分层模型时，第 \\(j\\) 组中第 \\(\\) 名患者的相应生存函数估计为\\[\\hat{S}_{{}{j}}(t)=\\left\\{\\hat{S}_{{0}{j}}(t)\\right\\}^{\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_{ij})}\\]其中，\\(\\hat{S}_{0j}(t)\\) 是第 \\(j\\) 组中个体的基线生存函数估计。如果假定各组对风险函数的效应呈比例关系，则将拟合一个公共基线风险，并在模型中包含组别效应。那么 \\(h_{0{j}}(t)\\) 被 \\(\\exp(g_j)h_0(t)\\) 代替，其中 \\(g_j\\) 是第 \\(j\\) 组的效应。一般来说，通过使用分层模型，允许组别效应随时间变化的限制较少。在分层模型中，可以通过对各组别内的个体在每个事件时间点上的生存函数估计值进行平均，从而求得每个组别的风险调整的生存函数。因此，在时间 \\(t\\) 处的平均风险调整生存函数为\\[\\hat{S}_j(t)=\\frac1{n_j}\\sum_{=1}^{n_j}\\hat{S}_{ij}(t)\\]这对应于第 \\(j\\) 组中的个体。另一种方法是对每个组中个体的每个解释变量的值进行平均，然后使用这些值来估计特定于组的生存函数。令 \\({\\bar{\\boldsymbol{x}}}_j\\) 为第 \\(j\\) 组中个体的 \\(p\\) 个变量的平均值向量，则组 \\(j\\) 中“平均个体”的相应生存函数估计为\\[\\tilde{S}_j(t)=\\left\\{\\hat{S}_{0j}(t)\\right\\}^{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\bar{\\boldsymbol{x}}_j)}\\]尽管这种方法被广泛应用，但它也受到了广泛的批评。对于分类变量而言，对其值进行平均并不恰当。例如，假设与糖尿病有无相关的某个变量有两个水平，分别编码为 1 和 0，且数据中有 10% 的个体患有糖尿病。将指示变量的平均值设为 0.1，在糖尿病状态以该值定义时，并不能得到生存函数有意义的解读。另外，即使对于连续型解释变量，在一个组别内部的解释变量平均值集合可能并不对应于真实组合的值，而且平均个体的生存函数可能与各个个体生存函数的模式大相径庭。示例 3.15  (前列腺癌两种疗法的比较) 考虑示例 1.4 中关于两个治疗组 38 名前列腺癌患者生存时间的数据。在示例 3.6 中，发现解释变量 Size 和 Index 会影响死亡风险，因此现在拟合包含这两个变量的分层 Cox 回归模型。对于 \\(j = 1\\)（安慰剂）和 \\(2\\)（DES），第 \\(j\\) 个治疗组中第 \\(\\) 个患者的生存函数估计为\\[\\hat{S}_{{}{j}}(t)=\\left\\{\\hat{S}_{0{j}}(t)\\right\\}^{\\exp(\\hat{\\eta}_{{}{j}})}\\]其中\\[\\begin{aligned}\\hat{\\eta}_{ij}=0.0673Size_{ij}+0.6532Index_{ij}\\end{aligned}\\]\\(\\hat{S}_{0{j}}(t)\\) 是第 \\(j\\) 个治疗组的基线生存函数估计。对每组患者在每个事件时间的生存函数估计进行平均，得到风险调整的生存函数，如图 3.8 所示。该图还显示了每组生存函数未经调整的 Kaplan-Meier 估计。\n该图显示了风险调整过程如何缩小治疗差异。当然，通过将 DES 组相对于安慰剂组的未调整的风险比 (0.14) 与根据肿瘤大小和 Gleason 指数调整的相应值 (0.33) 进行比较（这两个值见示例 3.12），也能看出这一点，但这种分析假设了两种疗法的风险成比例。","code":""},{"path":"cox-回归模型.html","id":"sec3-12","chapter":"►Cox 回归模型","heading":"3.12 一致性，预测能力和解释的变异","text":"已经提出了许多指标用于：度量生存时间和基于模型的预测之间的一致性、解释变量在多大程度上解释了生存数据中的变异。这些指标量化了拟合模型的预测能力。在本节中，我们将介绍其中一些最有用的指标。","code":""},{"path":"cox-回归模型.html","id":"sec3-12-1","chapter":"►Cox 回归模型","heading":"3.12.1 一致性的度量","text":"生存时间与预测的生存时间的排序之间的一致性 (agreement concordance)，通过区分生存时间较长和较短的个体，总结了拟合的模型区分个体的能力。一致性度量值介于 0 和 1 之间，分别对应于完全不一致和完全一致。当模型没有预测能力时，一致性度量值约为 0.5；而具有合理预测能力的模型往往具有大于 0.7 的值。Harrell, Lee Mark (1996) 描述的 \\(c\\) 统计量是一种特殊的一致性度量。该统计量是对以下概率的估计：对于任何两个个体，生存时间较短者是死亡风险较大者。要计算此统计量，请考虑所有可能的这样的生存时间对 (pairs)：要么两个个体均已死亡，要么其一的生存时间小于另一个的删失生存时间。这样的对子不包括在内：两个个体的生存时间都删失，或者其一的生存时间大于另一个的删失生存时间。如果在两个个体均已死亡的对子中，基于模型的预测生存时间对于实际生存更久的个体而言更长，则称这两个个体是一致的 (concordant).在比例风险模型中，预测生存时间最长的个体将会是：在给定时间下死亡风险较低、在给定时间下生存函数估计较高，或风险评分较低的个体。对于其一死亡且另一人的生存时间在其之后删失的对子，具有删失时间的个体生存时间超过了另一名成员，因此可以确定这种配对的两个成员是否一致。\\(c\\) 统计量是通过将一致的配对数除以所考虑的所有可能的配对数来获得的。对于只有一名个体死亡且另一名个体的删失生存时间大于此死亡时间的对子，具有删失生存时间的个体比另一名个体生存时间更长，因此可以判断这样的对子中的两名成员是否一致。通过将一致的对子数除以所有可能的对子数，可以得到 \\(c\\) 统计量。由于两名个体都删失或其中一名个体的删失生存时间小于另一名个体死亡时间的对子不会对 \\(c\\) 统计量做出贡献，因此 \\(c\\) 统计量会受到删失模式的影响。Gönen Heller (2005) 提出了一个统计量克服了这一重大缺陷。他们对一致性的度量是在任何两个个体中，其一的生存时间超过另一人生存时间的概率的估计，条件是生存时间较长的个体的风险评分较低。为了获得该统计量，令 \\(\\hat{\\eta}_i=\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 为第 \\(\\) 个个体的风险评分。如果风险评分较低的个体具有较长的生存时间，则一对生存时间 \\((T_i,T_j)\\) 是一致的。则一致性概率为 \\(K=\\mathrm{P}(T_i>T_j\\mid\\eta_i\\leqslant\\eta_j)\\)，并且该一致性概率的估计值 \\(\\hat K\\) 是模型预测值的 Gönen Heller 度量。该估计由下式给出\\[\\hat{K}=\\frac{2}{n(n-1)}\\mathop{\\sum\\sum}\\limits_{< j}\\left\\{\\frac{\\{(\\hat{\\eta}_j-\\hat{\\eta}_i)<0\\}}{1+\\exp(\\hat{\\eta}_j-\\hat{\\eta}_i)}+\\frac{\\{(\\hat{\\eta}_i-\\hat{\\eta}_j)<0\\}}{1+\\exp(\\hat{\\eta}_i-\\hat{\\eta}_j)}\\right\\} \\]其中指示函数 \\((\\cdot)\\) 满足：若 \\(X < 0\\)，则 \\(\\{X < 0\\} = 1\\)，否则为 0. 另外，还可以得到 \\(\\hat K\\) 的标准误，从而评估 \\(\\hat K\\) 的精度，这里不再赘述。","code":""},{"path":"cox-回归模型.html","id":"sec3-12-2","chapter":"►Cox 回归模型","heading":"3.12.2 预测能力","text":"评估模型根据风险评分值对个体或群体进行区分的能力的一个度量指标是 Royston Sauerbrei (2004) 提出的 \\(D\\) 统计量。该统计量还总结了模型的预测能力，并且与风险评分的方差紧密相关。为了得到该统计量，首先按照从小到大的顺序排列根据 Cox 回归模型得到的风险评分值 \\(\\hat{\\eta_i}=\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\)，如此一来，第 \\(\\) 个有序值便是 \\(\\hat{\\eta}_{()}=\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_{()}\\)，其中 \\(\\hat{\\eta}_{(1)}<\\hat{\\eta}_{(2)}<\\cdots<\\hat{\\eta}_{(n)}\\)。然后，将这些有序值中的第 \\(\\) 个值与量 \\(z_{()}\\) 关联起来，该量是对样本量为 \\(n\\) 的观测值在标准正态分布中第 \\(\\) 个顺序统计量期望的一种近似。该量通常称为正态得分 (normal score)，使用最广泛的得分公式为 \\(z_{()}=\\Phi^{-1}\\{(-3/8)/(n+1/4)\\}\\)，其中 \\(\\Phi^{-1}(\\cdot)\\) 是标准正态分布函数的逆。然后，一个包含由标准化正态得分 \\(z_{()}/√(8/π)\\) 形成的变量的 Cox 回归模型用于拟合生存数据。所得该变量的系数估计就是 \\(D\\) 统计量，同时拟合模型还会给出 \\(D\\) 的标准误。","code":""},{"path":"cox-回归模型.html","id":"sec3-12-3","chapter":"►Cox 回归模型","heading":"3.12.3 Cox 回归模型解释的变异","text":"在线性回归分析中，解释变量所占的响应变量变异的比例广泛用于总结模型的解释能力。该统计量通常用 \\(R^2\\) 表示。对于具有 \\(p\\) 个解释变量的一般线性模型 (general linear model)，响应变量 \\(Y\\) 的第 \\((=1,2,\\ldots,n)\\) 个值为\\[\\begin{equation}\ny_i=\\beta_0+\\beta_1x_{1i}+\\cdots+\\beta_px_{pi}+\\epsilon_i\n\\tag{3.33}\n\\end{equation}\\]其中 \\(\\beta_0\\) 为常数，\\(\\beta_1,\\beta_2,\\ldots,\\beta_p\\)为 \\(p\\) 个解释变量 \\(x_{ji},j=1,2,\\ldots,p\\) 的系数，以及 \\(\\epsilon\\) 为残差或误差项。拟合该模型时，\\(R^2\\) 统计量定义为\\[\\begin{aligned}R^2&=\\frac{\\text{模型平方和}}{\\text{总平方和}} = \\frac{\\text{模型平方和}}{\\text{模型平方和}+\\text{残差平方和}}\\end{aligned}\\]在此式中，由模型解释的响应变量的变异总结在模型平方和 (Model Sum Squares, Model SS) \\(\\sum_{{}}(\\hat{y}_i-\\bar{y})^2\\) 中，该式表示模型平方和占数据总变异的比例，而数据总变异由总平方和 (Total Sum Squares, Total SS) \\(\\sum_{{}}(y_{{}}-\\bar{y})^2\\) 表示，其中 \\(\\bar{y}=n^{-1}\\sum_iy_i\\) 且 \\(\\hat y_i\\) 是第 \\(\\) 个由下式给出的拟合值\\[\\begin{equation}\n\\hat{y}_i=\\hat{\\beta}_0+\\hat{\\beta}_1x_{1i}+\\cdots+\\hat{\\beta}_px_{pi}\n\\tag{3.34}\n\\end{equation}\\]总平方和可分解为模型平方和与残差平方和 \\(\\sum_{{}}(y_{{}}-\\hat{y_{}})^{2}\\)，后者表示无法解释的变异。\\(R^2\\) 的值越大，模型所能解释的响应变量变异的比例就越大。一般线性模型的 \\(R^2\\) 统计量也可表示为以下形式\\[\\begin{equation}\nR^2=\\frac{\\hat{V}_M}{\\hat{V}_M+s^2}\n\\tag{3.35}\n\\end{equation}\\]其中 \\(\\hat{V}_M=\\text{模型平方和}/(n-1)\\) 为由模型解释的数据变异的估计，是式 (3.34) 中 \\(n\\) 个拟合值 \\(\\hat y_i\\) 的样本方差。此外，\\(s^2\\) 是残差变异的估计，其中 \\(s^2 = 残差平方和/(n − 1)\\)，而不是除数为 \\(n − p − 1\\) 的通常的无偏估计。量 \\(\\hat{V}_{M}\\) 也可用矩阵形式表示为 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{S}\\hat{\\boldsymbol{\\beta}}\\)，其中 \\(\\hat{\\boldsymbol{\\beta}}\\) 是拟合的回归模型中 \\(p\\) 个解释变量的系数估计向量，\\(\\boldsymbol S\\) 是解释变量的方差-协方差阵。\\(p\\) 个解释变量的样本方差 \\((n-1)^{-1}\\sum_i(x_{ij}-\\bar{x}_j)^2\\) 组成了该矩阵的对角元，其样本协方差 \\((n-1)^{-1}\\sum_i(x_{ij}-\\bar{x}_j)(x_{ij'}-\\bar{x}_{j'})\\) 组成了该矩阵的非对角元，其中 \\(=1,2,\\ldots,n\\)，\\(j,j^\\prime=1,2,\\ldots,p,j\\ne j^\\prime\\) 且 \\(\\bar x_j\\) 为第 \\(j\\) 个变量的样本均值。在生存数据的分析中，已经提出了大量的度量方法，用于度量由 Cox 回归模型解释的数据变异的比例。然而，基于大量模拟研究的综述表明，有三种特定的统计量具有理想的性质。它们的取值都在 0 到 1 之间，在很大程度上与删失的程度无关，并且不受生存数据尺度的影响，随着解释变量数量的增加，它们的值也会增加。这些将在下一节描述。","code":""},{"path":"cox-回归模型.html","id":"sec3-12-4","chapter":"►Cox 回归模型","heading":"3.12.4 解释的变异的度量","text":"考虑用于第 \\(\\) 个个体在时间 \\(t\\) 的死亡风险的 Cox 回归模型 \\(h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\)，其中 \\(x_i\\) 是 \\(p\\) 个解释变量的值向量，\\(\\boldsymbol\\beta\\) 是其未知系数的向量，\\(h_0(t)\\) 是基线风险函数。Kent O’Quigley (1988) 提出了关于 \\(R^2\\) 型统计量的最早建议之一，在形式上与式 (3.35) 中用于线性回归分析的 \\(R^2\\) 统计量相似。此统计量定义为\\[\\begin{equation}\nR_P^2=\\frac{\\hat V_P}{\\hat V_P+\\pi^2/6}\n\\tag{3.36}\n\\end{equation}\\]其中 \\(\\hat{V}_P=\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{S}\\hat{\\boldsymbol{\\beta}}\\) 为风险评分 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 在 \\(n\\) 个个体间的变异的估计。\\(\\hat{\\boldsymbol{\\beta}}\\) 为拟合的 Cox 回归模型的参数估计向量，\\(\\boldsymbol{S}\\) 为解释变量的方差-协方差阵。量 \\(\\hat{V}_P\\) 最简便的计算方法是根据拟合的 Cox 回归模型中得到的 \\(n\\) 个风险评分的样本方差。将 \\(π^2/6\\) 包含在式 (3.36) 中以代替式 (3.35) 中的 \\(s^2\\) 的原因将在后面的第 5 章 5.14 节中解释。Royston Sauerbrei (2004) 提出的 \\(R^2_D\\) 统计量也是基于对个体间风险评分变异的估计，并与他们的 \\(D\\) 统计量密切相关，后者是第 3.12.2 节中定义的预测能力的度量。为了获得这一统计量，对 \\(D\\) 值进行缩放得到 \\(D_0=D/\\sqrt{(8/\\pi)}\\)。由 Cox 回归模型解释的变异的 \\(R^2_D\\) 度量为\\[\\begin{equation}\nR_D^2=\\frac{D_0^2}{D_0^2+\\pi^2/6}\n\\tag{3.37}\n\\end{equation}\\]这形似 \\(R_P^2\\) 统计量。事实上，\\(D^2_0\\) 也可视为风险评分值之间变异的估计。如果要直接获得 \\(R^2_D\\)，则可以在 Cox 回归模型中使用 3.12.2 节中的未缩放的正态分数 \\(z_{()}\\)，所得回归系数即为式 (3.37) 中的 \\(D_0\\)。Kent O’Quigley (1988) 提出的另一个统计量基于感兴趣的模型与无解释变量的模型之间的“距离”。后一个模型称为零模型，因此每个个体的风险函数只是基线风险 \\(h_{0}(t)\\)。该统计量为\\[\\begin{aligned}R_W^2=1-\\exp(-\\tilde{W})\\end{aligned}\\]其中距离的度量 \\(\\tilde W\\) 是似然比统计量期望值的估计，该期望值定义为 \\(W=-2\\mathrm{E}\\,\\{\\log L(0)-\\log L(\\hat{\\boldsymbol{\\beta}})\\}\\)，用于比较拟合模型的最大对数似然 \\(\\operatorname{log}L(\\hat{\\boldsymbol{\\beta}})\\) 与零模型的最大对数似然 \\(\\log L(0)\\)。\\(\\tilde W\\) 由下式给出\\[\\begin{aligned}\\tilde{W}&=2\\left[(1-\\tilde{\\omega})\\Psi(1)+\\log\\Gamma(\\tilde{\\omega})+\\log\\left\\{n^{-1}\\sum_{=1}^n\\exp(-\\tilde{\\omega}z_i)\\right\\}\\right]\\end{aligned}\\]其中 \\(z_i=\\hat{\\boldsymbol{\\beta}}^{\\prime}(\\boldsymbol{x}_i-\\boldsymbol{\\bar{x}})\\)，\\(\\hat{\\boldsymbol{\\beta}}\\) 为拟合的 Cox 回归模型中的参数估计向量，\\(\\bar {\\boldsymbol x}\\) 是 \\(p\\) 个解释变量的平均值向量，\\(\\Gamma(\\tilde{\\omega})=\\int_0^\\infty u^{\\tilde{\\omega}-1}e^{-u}\\mathrm{d}u\\) 为 gamma 函数。此外，\\(\\tilde \\omega\\) 是满足如下非线性方程的 \\(\\omega\\) 的值\\[\\begin{aligned}\\Psi(1)-\\Psi(\\omega)+\\sum_{=1}^n\\frac{\\exp(-\\omega z_i)}{\\sum_{l=1}^n\\exp(-\\omega z_l)}z_i&=0\\end{aligned}\\]其中 \\(\\Psi(\\omega)\\) 为 digamma 函数，定义为如下的级数展开\\[\\begin{aligned}\\Psi(\\omega)&=-\\lambda+\\sum_{j=0}^\\infty\\frac{\\omega-1}{(1+j)(\\omega+j)}\\end{aligned}\\]使得 \\(\\Psi(1)=-\\lambda\\)，其中 \\(\\lambda=0.577216\\) 为欧拉常数。这是一个计算起来非常复杂的统计量，但由于它表现良好，因此被包括在这里，并且可以使用几个用于生存分析的软件包来获得。","code":""},{"path":"cox-回归模型.html","id":"sec3-12-5","chapter":"►Cox 回归模型","heading":"3.12.5 模型验证","text":"3.12.1 节至 3.12.4 节所描述的方法总结了 Cox 回归模型的预测能力，以及拟合模型对一组生存数据变异的解释程度。然而，如果同一组数据既用于构建模型又用于验证模型，那么这些方法可能会导致对模型能力过于乐观的评估。因此，最佳的做法是使用未参与建模过程的数据来确定预测能力和解释变异的指标。如果有来自其他地区或国家的独立数据集可用，则应将这些数据用于验证过程。这一过程称为外部验证 (external validation).在许多情况下，外部验证是不可能的。那么可以使用基于将数据随机划分为建模数据集和验证数据集的数据分割程序。首先根据建模数据集确定模型，并使用剩余数据进行验证，此为内部验证 (internal validation). 根据数据集的大小，最多可以留出 50% 的数据用于验证，但对于较小的数据集，这一比例可能在 20% 至 40% 之间。无论如何，验证数据集应包含足够数量的事件，一般建议至少需要 100 个事件。示例 3.16  (多发性骨髓瘤患者的生存率) 在本示例中，将对示例 1.3 中所示的多发性骨髓瘤患者生存时间数据的预测能力和解释的变异的各种度量进行比较。在示例 3.5 中，最令人满意的 Cox 回归模型包含解释变量 Hb（血清血红蛋白）和 Bun（血尿素氮）。对于模型和数据之间的一致性，用 \\(c\\) 统计量总结，选定模型为 0.67 (se = 0.053)，全模型为 0.71 (se = 0.048). 关于 Gönen Heller 的一致性度量，对于所选模型为 0.67 (se = 0.041)，对于全模型为 0.68 (se = 0.040). 在这个例子中，由于只有相对较少的删失，大部分生存时间对可用于 \\(c\\) 统计量的计算，因此两个模型区分能力 (discriminatory power) 的度量非常接近。同时，所选模型和全模型在这两种统计量上的数值差异也非常小，进一步证实了所选模型的预测能力与全模型相当。然而，Gönen Heller 统计量的值为 0.67，表明该模型在区分本研究中个体的生存时间方面并不是特别好。拟合模型的 \\(D\\) 统计量为 1.008 (se = 0.351). 该统计量的值约为其标准误的三倍，表明拟合模型实现了一定的预后分离。全模型该统计量值仅稍大一些，为 1.236 (se = 0.346)，这表明额外变量对提高模型质量几乎没有作用。现在转向解释的变异的度量，表 3.20 中显示了包含 Hb 和 Bun 的选定模型以及包含 Age, Sex, Bun, Ca, Hb, Pcells 和 Protein 的全模型的各种统计量。\n针对这两种模型，三个不同解释的变异的度量大体上具有相似的值。基于这些统计量，我们得出结论：大约 30% 的生存时间变异可由血清血红蛋白和血液尿素氮水平解释。相应地，模型未能解释的变异比例约为 70%，这表明模型还有很大的改进空间。例如，可能需要测量并纳入更多的解释变量以改进模型。","code":""},{"path":"cox-回归模型.html","id":"sec3-13","chapter":"►Cox 回归模型","heading":"3.13 时依 ROC 曲线","text":"3.12.1 节中描述的一致性度量提供了对拟合模型中生存时间与风险评分之间关联的总体评估。然而，模型对短期生存的预测能力不一定与长期生存的预测能力相同，因此需要时依度量 (time-dependent measures). 受试者工作特征 (Receiver operating characteristic, ROC) 曲线广泛用于总结拟合的 logistic 回归模型中的预测准确性。因此，本节首先简要总结它们在这种情况下的使用，然后再开发可用于生存数据的时依版本。","code":""},{"path":"cox-回归模型.html","id":"sec3-13-1","chapter":"►Cox 回归模型","heading":"3.13.1 灵敏度和特异度","text":"在利用诊断程序结果区分患某种疾病的人群与未患病人群时，可能出现两种类型的错误。首先，检测程序可能导致实际患病的人被误判为未患病。其次，未患病的人可能被误判为患病。对于临床准确 (clinically accurate) 的诊断测试程序，这两种错误发生的概率将会很小。正确识别出患病个体的概率称为测试的灵敏度 (sensitivity)，而正确识别出未患病个体的概率称为特异度 (specificity). 灵敏度有时也称为真阳性率 (true positive rate)，而 (1 - 特异度)，即未患病个体被误判为患病的概率，称为假阳性率 (false positive rate). 这些概念通过以下示例加以阐明。示例 3.17  (侧流装置检测 COVID-19 的性能) 本示例使用用于识别 COVID-19 感染的 Innova 侧流装置 (lateral flow device, LFD) 的性能数据。这些数据来自 Wolf, Hulmes Hopkins (2021) 报告的一项上市后监测研究，该研究由 Public Health England 和 Oxford University 在 2020 年 11 月至 2021 年 1 月期间进行。共有 8223 名个体根据他们在逆转录聚合酶链反应 (RT-PCR) 测试（这是诊断 COVID-19 的最优测试或“金标准”测试）中是否获得阳性结果进行分类，还根据使用 LFD 的测试（更快、更便宜）是否给出阳性结果对这些人进行了分类，总结数据显示在表 3.21 中。\n根据该表，LFD 测试的灵敏度为 339/677，即 50.1%。特异度为 7525/7546，即 99.7%，假阳性率为 0.3%，极低。根据这些总结数据，LFD 设备在正确识别 COVID-19 感染方面的效率仅为约 50%，但在识别某人是否无病方面的效率接近 100%。","code":""},{"path":"cox-回归模型.html","id":"sec3-13-2","chapter":"►Cox 回归模型","heading":"3.13.2 疾病概率建模","text":"个体是否患有某种特定疾病或症状，或者在未来患该疾病的风险，通常可以通过使用生物标志物 (biological marker biomarker) 来评估疾病的存在或进展。许多生物标志物广泛应用于筛查或诊断程序的一部分被，例如血清胆红素水平作为肝脏疾病的指标、前列腺特异性抗原 (prostate-specific antigen, PSA) 水平用于前列腺癌筛查、血糖水平作为糖尿病的标志物。这些生物标志物可以精确测量，并且是在连续测量尺度上的观察值，其中更高的生物标志物值表明存在疾病的可能性更大。诊断测试的结果基于标志物值是否超过阈值，若超过，则将个体归类为患有该疾病。当生物标志物用作诊断辅助时，可以使用线性 logistic 模型总结疾病概率对生物标志物值的依赖性。在此过程中，响应变量是二元的，表示个体是否患有相关疾病，如果个体没有疾病，则记录值为 0，否则记录为 1. 将 \\(n\\) 个个体中的第 \\(\\) 个个体的疾病概率写作 \\(p_i\\)，\\(p_i\\) 的线性 logistic 模型为\\[\\begin{equation}\n\\text{logit }(p_i)=\\log\\left(\\frac{p_i}{1-p_i}\\right)=\\beta_0+\\beta_1x_i\n\\tag{3.38}\n\\end{equation}\\]其中 \\(x_i\\) 是第 \\(\\) 个个体的生物标志物的值。为二元响应变量拟合该模型会得到模型的参数估计 \\(\\hat{\\beta}_0,\\hat{\\beta}_1\\)。那么，基于模型的对第 \\(\\) 个个体患有该疾病的概率的 logisic 变换估计为 \\(\\hat{\\beta}_0+\\hat{\\beta}_1x_i\\)，并且第 \\(\\) 个个体患病的相应概率估计 \\(\\hat p_i\\) 由下式给出\\[\\begin{aligned}\\hat{p}_i=\\frac{\\exp(\\hat{\\beta}_0+\\hat{\\beta}_1x_i)}{1+\\exp(\\hat{\\beta}_0+\\hat{\\beta}_1x_i)}\\end{aligned}\\]对于具有不同 \\(x_i\\) 值的患病和无病个体，这些疾病概率估计会有所不同。对于基于二元疾病标志物的诊断测试，例如示例 3.18 中侧流测试的结果，式 (3.38) 中的 \\(x_i\\) 值将为 0 或 1，分别对应于阴性或阳性侧流测试结果。那么，拟合的概率将等于具有阳性测试结果的患病和无病个体的比例，从而直接估计测试的灵敏度和特异度。当使用如血清胆红素水平这样的具有连续值的生物标志物时，需要设定一个阈值 \\(x_i\\)，以便根据测试结果判断个体是否患病。在诊断测试中选用的阈值应参考该生物标志物在不同阈值下的灵敏度和特异度。理想测试的阈值将使灵敏度和特异度值都很低，但实践中往往需要在这两者之间做出一定的权衡。例如，在类似于示例 3.18 的情况下，如果不误诊患病的人是非常重要的，可能就需要牺牲一定的特异度来换取较高的灵敏度。疾病风险的度量可以基于个体的特征，而不是使用单一的生物标志物。其中包括人口统计学变量，如年龄和性别、健康的临床指标和生物标志物。然后将其他解释变量包含在式 (3.38) 中的模型中。模型的线性部分变为 \\(\\boldsymbol{\\beta'x}_i=\\beta_0+\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_kx_{ki}\\)，其中 \\(x_{1i},x_{2i},\\ldots,x_{ki}\\) 是 \\(k\\) 个变量的值，包括任何生物标志物。拟合模型 \\(\\log\\{p_i/(1-p_i)\\}=\\boldsymbol{\\beta'x}_i\\) 得到对第 \\(\\) 个个体的疾病概率的估计 \\(\\hat p_i\\) 和他们风险评分的估计 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\)。同样，为了确定个体是否患有某种疾病，也需要设定疾病概率或风险评分的阈值。随后，可以根据生物标志物值或风险评分在各阈值处的估计，来评估基于这些值的诊断程序的灵敏度和特异度。","code":""},{"path":"cox-回归模型.html","id":"sec3-13-3","chapter":"►Cox 回归模型","heading":"3.13.3 ROC 曲线","text":"一旦针对一系列阈值估计了生物标志物或风险评分的灵敏度和特异度，绘制灵敏度与 (1 - 特异度) 在不同的阈值处的图形就形成了一个有用的图形总结。这就是所谓的受试者工作特征曲线 (Receiver Operating Characteristic Curve) 或 ROC 曲线，这个名字最初由二战期间的无线电工程师创造。ROC 曲线总结了诊断测试、生物标志物或风险评分区分患病个体与非患病个体的能力。当比较不同的阈值时，该曲线对于展示灵敏度和特异度之间的权衡特别有用。最优阈值应具有 100% 的灵敏度和特异度，这对应于完美的真阳性率和假阳性率，在 ROC 曲线上表现为左上角的一个点。相反，若灵敏度与 (1 - 特异度) 之间呈现直线关系，则表明该测试具有相等的真阳性率和假阳性率，即不具备预测能力。图 3.9 展示了几个理想化的 ROC 曲线。\n在该图中，直线代表一个不具备区分能力的模型。这条线上方的曲线是可能的生物标志物或风险评分的 ROC 曲线，其区分患有和不患有疾病个体的能力越来越强。一个用于 ROC 曲线的整体总结指标是曲线下面积 (area curve, AUC)，它可以用来比较不同模型对疾病概率的预测能力。ROC 曲线下面积衡量的是二元响应变量与基于模型拟合概率之间的符合程度。AUC值越大，说明测试在区分患者与非患者方面的效果越好。AUC 值始终介于 0 到 1 之间，两个极值对应于预测总是错误或正确的模型。值 0.5 对应于没有区分能力的模型。ROC 曲线提供了一种公认的方法，用于总结模型在依赖生物标志物或风险评分值来预测个体患病概率方面的预测能力。然而，如今 ROC 曲线的应用远远超出了诊断测试范畴，因为它们提供了一种方便的方式来总结二元响应变量观测值与拟合值之间的一致性。","code":""},{"path":"cox-回归模型.html","id":"sec3-13-4","chapter":"►Cox 回归模型","heading":"3.13.4 时依 ROC 曲线","text":"生物标志物区分可能发展出特定疾病的个体和不会发展出这种疾病的个体的能力，是一个重要的考虑因素。在结局是事件发生时间的情况下，例如特定疾病的发生或死亡，诊断测试的灵敏度和特异度可能会在个体接受随访的时间段内发生变化。那么 ROC 曲线是时依的 (time-dependent)，需要在随访期的特定时间进行估计。还必须考虑到疾病发生或死亡等事件的时间删失的可能性。时依结局的灵敏度和特异度的估计可以通过以下方式获得。令 \\(T\\) 为与事件发生时间（例如疾病或死亡的发生）相关的变量，令 \\(D(t)\\) 为个体在时间 \\(t\\) 时的状态，其中如果 \\(T <t\\) 则 \\(D(t) = 0\\)，如果 \\(T \\ge t\\)，则 \\(D(t) = 1\\)。将变量 \\(D(t)\\) 称为疾病状态，其中 \\(D(t) = 0\\) 表示在时间 \\(t\\) 时无病的个体。然而，\\(D(t)\\) 也可以表示一个个体是否已经发展出某种特征，或者在时间 \\(t\\) 是生或死。与生物标志物或风险评分相关的变量由 \\(X\\) 表示，其中较大的 \\(X\\) 值更能指示疾病的存在。用 \\(c\\) 值作为生物标志物或风险评分的阈值，诊断测试在时间 \\(t\\) 的灵敏度是在时间 \\(t\\) 时对于患有疾病的个体，\\(X>c\\) 的概率，即\\[\\begin{aligned}\\text{sens}(t,c)=\\text{P}(X>c\\mid D(t)=1)\\end{aligned}\\]类似地，灵敏度为\\[\\begin{aligned}\\operatorname{spec}(t,c)&=\\operatorname{P}(X\\leqslant c\\mid D(t)=0)\\end{aligned}\\]这两个概率可以使用条件概率的结论来计算，根据条件概率，以事件 \\(B\\) 为条件，事件 \\(\\) 的概率为\\[\\begin{equation}\n\\mathrm{P}(\\mid B)=\\frac{\\mathrm{P}(B\\mid )\\mathrm{P}()}{\\mathrm{P}(B)}\n\\tag{3.39}\n\\end{equation}\\]这个结果称为贝叶斯定理 (Bayes’ theorem)，它是 16 章中描述的生存数据分析的贝叶斯方法（在该章的 16.1 节中推导）的基础。利用式 (3.39)，可以写出诊断程序的灵敏度\\[\\begin{aligned}\\mathrm{P}(X>c\\mid D(t)=1)&=\\frac{\\mathrm{P}(D(t)=1\\mid X>c)\\mathrm{P}(X>c)}{\\mathrm{P}(D(t)=1)}\\end{aligned}\\]概率 \\(\\mathrm{P}(D(t)=1|X>c)\\) 和 \\(\\mathrm{P}(D(t)=1)\\) 可以从关于 \\(T\\) 的生存函数 \\(S(t)=\\operatorname{P}(T\\geqslant t)\\) 中获得。那么灵敏度就是\\[\\begin{equation}\n\\frac{\\{1-S(t\\mid X>c)\\}\\text{P}(X>c)}{1-S(t)}\n\\tag{3.40}\n\\end{equation}\\]其中 \\(S(t\\mid X>c)\\) 是那些 \\(X>c\\) 的个体的生存函数。同理，特异度为\\[\\begin{equation}\n\\frac{S(t\\mid X\\leqslant c)\\text{P}(X\\leqslant c)}{S(t)}\n\\tag{3.41}\n\\end{equation}\\]灵敏度和特异度可以使用生存函数的 Kaplan-Meier 估计 \\(\\hat S(t)\\) 来估计，该生存函数是根据这些个体可能删失的事件时间以及其中 \\(X>c\\) 或 \\(X\\le c\\) 的子集来获得的。此外，\\(\\mathrm{P}(X\\leqslant c)\\) 可以根据标志物值小于等于 \\(c\\) 的个体比例 \\(\\hat{p}_X(c)\\) 进行估计，\\(P(X>c)\\) 则是通过 \\(1−\\hat{p}_X(c)\\) 来估计的。所得灵敏度和特异度的估计为\\[\\begin{align}\n&\\widehat{\\text{sens}}(t,c)=\\frac{\\{1-\\hat{S}(t\\mid X>c)\\}\\{1-\\hat{p}_X(c)\\}}{1-\\hat{S}(t)}\n\\tag{3.42}\\\\\n&\\widehat{\\text{spec}}(t,c)=\\frac{\\hat{S}(t\\mid X\\leqslant c)\\hat{p}_X(c)}{\\hat{S}(t)}\n\\tag{3.43}\n\\end{align}\\]这些估计现在可用于构建选定疾病或死亡时间值的时依 ROC 曲线。时依 ROC 曲线下面积提供了模型在给定时间区分患病个体和无病个体总体能力的总结。该面积值越大，模型的预后性能越好。该统计量可用于识别模型预测能力最大化的时间点，并基于不同的生物标志物或风险评分的不同形式来比较模型。示例 3.18  (前列腺癌两种疗法的比较) 对于第一章示例 1.3 中首次提到的关于诊断为多发性骨髓瘤患者生存时间的研究，第三章示例 3.5 发现有意义的解释变量为血清血红蛋白水平 (Hb) 和血尿素氮 (Bun). 风险评分将作为标志物变量 \\(X\\)，用于式 (3.42) 和 (3.43)，其中第 \\(\\) 个个体的分数值为 \\(-0.1336~Hb_i+0.0186~Bun_i\\)。可以为 48 名患者计算该值，用作生物标志物变量 \\(X\\)。将评估标志物在 6 个月、12 个月、18 个月和 24 个月时的预测能力，将阈值 \\(c\\) 设为 48 个风险评分值。然后，针对这 48 名患者的集合，以及每个给定的阈值 \\(c\\) 下风险评分大于 \\(c\\) 或小于等于 \\(c\\) 的患者子集，确定其生存函数的 Kaplan-Meier 估计。随后，根据式 (3.42) 和 (3.43) 计算灵敏度和特异度估计，从而得出所选时间点的时依 ROC 曲线。这些曲线以及 灵敏度与 (1 - 特异度) 的等值线一起展示在图 3.10 中。\n该图显示，风险评分的预测能力随时间推移而减弱，因为 ROC 曲线估计越来越接近“灵敏度 = (1 - 特异度)”的线。风险评分对诊断后 6 个月死亡的预测最佳。ROC 曲线下面积证实了这一点：在 6 个月、12 个月、18 个月和 24 个月时分别为 0.793、0.730、0.686 和 0.600.基于生存函数的 Kaplan-Meier 估计的时依 ROC 曲线存在两个问题。首先，通过式 (3.42) 和 (3.43) 估计出的灵敏度与 (1 - 特异度) 并不一定是标志物值的单调递减函数，这一点可以在图 3.10 中观察到。其次，对于 \\(X>c\\) 条件下生存函数的 Kaplan-Meier 估计，假设了删失与 \\(X\\) 无关。如果患者随访的严格程度受到标志物值的影响，该假设可能就不成立了。因此，在实践中经常使用基于估计 \\(X\\) 和 \\(T\\) 的联合分布的替代程序。令 \\(x_i\\) 表示生存时间为 \\(t_i\\) 的第 \\(\\) 个个体的生物标志物值，并令 \\(\\delta_i\\) 为删失指示符，使得如果 \\(t_i\\) 是事件时间，则 \\(\\delta_i=1\\)，否则为 \\(0\\). 联合概率 \\(S(t, c) = \\mathrm{P}(T > t, X > c)\\) 可估计为\\[\\begin{aligned}\\hat{S}_\\omega(t,c)&=n^{-1}\\sum_{=1}^n\\hat{S}_\\omega(t\\mid X=x_i)(x_i>c)\\end{aligned}\\]其中指示函数 \\((\\cdot)\\) 满足：如果 \\(x_i > c\\)，则 \\((x_i > c) = 1\\)，否则为 \\(0\\). \\(\\hat{S}_{{\\omega}}(t|X=x_{{}})\\) 是条件生存函数的平滑估计，取决于平滑参数 \\(\\omega\\)。合适的平滑估计是加权 Kaplan-Meier 估计，其中\\[\\begin{equation}\n\\hat{S}_\\omega(t\\mid X=x_i)=\\prod_s\\left\\{1-\\frac{\\sum_jK_\\omega(x_i,x_j)(t_j=s)\\delta_j}{\\sum_jK_\\omega(x_i,x_j)(t_j\\geqslant s)}\\right\\}\n\\tag{3.44}\n\\end{equation}\\]该乘积是对所有小于等于 \\(t\\) 的唯一事件时间计算得到的。在此表达式中，\\(K_{\\boldsymbol{\\omega}}(x_{},x_{j})\\) 是最近邻核平滑函数 (nearest-neighbour kernel smoothing function)，它给予相近的标志物变量值 \\(x_i,x_j\\) 更大的权重。该函数由下式给出\\[\\left.K_\\omega(x_i,x_j)=\\left\\{\\begin{array}{ll}1&\\text{ }|\\hat{p}_X(x_i)-\\hat{p}_X(x_j)|<\\omega,\\\\0&\\text{ otherwise.}\\end{array}\\right.\\right.\\]其中 \\(p_X(x)=\\text{P}(X\\leqslant x)\\)，\\(\\hat p_X(x)\\) 是其估计，因此，\\(\\hat p_X(x)\\) 是 \\(X\\) 值小于等于 \\(x_i\\) 的比例。此外，\\(0<2\\omega<1\\)，这意味着标志物值在近邻 (near neighbour) 中的比例为 \\(2\\omega\\)，其中 \\(\\omega\\) 必须小于 0.5. 事实上，为了确保估计 \\(\\hat{S}_{\\omega}(t,c)\\) 的一致性，\\(\\omega\\) 必须小于 \\(n^{-1/3}\\)。\\(\\omega\\) 的值越大，平滑度就越大，通常使用 0.05.然后利用 \\(S(t\\mid X>c)\\text{P}(X>c)=S(t,c),S(t\\mid X\\leqslant c)\\text{P}(X\\leqslant c)=\\text{P}(T>t,X\\leqslant c)\\) 以及 \\(\\text{P}(T>t\\mid X\\leqslant c)=S(t)-S(t,c)\\) 这一结果，灵敏度和特异度可以根据式 (3.40) 和 (3.41) 得到，即\\[\\begin{align}\n&\\widehat{\\operatorname{sens}}(t,c)=\\frac{1-\\hat{p}_X(c)-\\hat{S}_\\omega(t,c)}{1-\\hat{S}_\\omega(t,-\\infty)}\\tag{3.45}\\\\\n&\\widehat{\\operatorname{spec}}(t,c)=1-\\frac{\\hat{S}_\\omega(t,c)}{\\hat{S}_\\omega(t,-\\infty)}\\tag{3.46}\n\\end{align}\\]其中 \\(\\hat{S}_\\omega(t,-\\infty)=\\hat{S}_\\omega(t)=n^{-1}\\sum_i\\hat{S}_\\omega(t\\mid X=x_i)\\)。现在可以使用式 (3.45) 和 (3.46) 构建时依 ROC 曲线。示例 3.19  (多发性骨髓瘤患者的生存率) 在示例 3.19 中，Kaplan-Meier 方法用于获得多发性骨髓瘤生存数据的时依 ROC 曲线。现在说明最近邻估计方法。使用由式 (3.44) 给出的生存函数的平滑加权 Kaplan-Meier 估计，取 \\(\\omega = 0.05\\)，所得的时依 ROC 曲线估计见图 3.11.\n在该图中，灵敏度和 (1 - 特异度) 严格递增，但这些曲线与图 3.10 所示的曲线没有实质性差异。相应的曲线下面积为 0.753, 0.683, 0.690 和 0.609. 这些面积略小于图 3.10 中时依 ROC 曲线的面积，但风险评分仍然对 6 个月内死亡的预测是最佳的。尽管时依 ROC 曲线的使用是在诊断测试背景下开发的，但它们提供了一种有用的方法来总结不同时间范围内事件时间与拟合模型之间的一致性。","code":""},{"path":"cox-回归模型.html","id":"sec3-14","chapter":"►Cox 回归模型","heading":"3.14 比例风险建模和 log-rank 检验","text":"Cox 回归模型可用于检验两组生存时间的风险函数之间无差异的原假设，如示例 3.3 所示。因此在这种情况下，这种建模方法为 log-rank 检验提供了一种替代方法。然而，这两个程序之间有着密切的联系，本节将对此进行更详细的探讨。使用 2.6.2 节中使用的符号（总结于表 2.7 中），两个组将分别标记为 Group 和 Group II. 两组在第 \\(j\\) 个有序死亡时间 \\(t_{(j)}, j = 1, 2,...,r\\) 处死亡的个体数量分别用 \\(d_{1j}\\) 和 \\(d_{2j}\\) 表示。类似地，在时间 \\(t_{(j)}\\) 时两组处于风险的个体数量，即在此时间之前存活且未删失的数量，分别表示为 \\(n_{1j}\\) 和 \\(n_{2j}\\)。现在令 \\(X\\) 为一指示变量，当个体处于 Group 时，该变量为 1；当个体处于 Group II 时，该变量为 0. 第 \\(\\) 个个体的 Cox 回归模型可写为\\[h_i(t)=e^{\\boldsymbol{\\beta}x_i}h_0(t)\\]其中 \\(x_i\\) 是第 \\(\\) 个个体的 \\(X\\) 值，\\(＝1,2,\\ldots,n\\)。当不存在观测结时，即当 \\(d_j=d_{1j}+d_{2j}=1\\) 时，可以通过最大化式 (3.4) 中的似然函数来拟合该模型。以 \\(x_{(j)}\\) 表示死于 \\(t_{(j)}\\) 的个体的 \\(X\\) 值。由于在时间 \\(t_{(j)}\\) 的风险集 \\(R(t_{(j)})\\) 中有 \\(n_j＝n_{1j}+n_{2j}\\) 个个体，似然函数为\\[\\begin{equation}\nL(\\beta)=\\prod_{j=1}^{r}\\frac{\\exp(\\beta x_{(j)})}{\\sum_{l=1}^{n_{j}}\\exp(\\beta x_{l})}\n\\tag{3.47}\n\\end{equation}\\]相应的对数似然函数为\\[\\begin{equation}\n\\log L(\\beta)=\\sum_{j=1}^r\\beta x_{(j)}-\\sum_{j=1}^r\\log\\left\\{\\sum_{l=1}^{n_j}\\exp(\\beta x_l)\\right\\}\n\\end{equation}\\]由于 Group II 中的个体的 \\(x_{(j)}\\) 为 0，因此该表达式中的第一个求和运算是关于 Group 的死亡时间进行的，因此简单地为 \\(d_{1}\\beta\\)，其中 \\(d_1=\\sum_{j=1}^rd_{1j}\\) 是 Group 中的死亡总数。此外，\\[\\begin{aligned}\\sum_{l=1}^{n_j}\\exp(\\beta x_l)&=n_{1j}e^\\beta+n_{2j}\\end{aligned}\\]因此\\[\\begin{equation}\n\\log L(\\beta)=d_1\\beta-\\sum_{j=1}^r\\log\\left\\{n_{1j}e^\\beta+n_{2j}\\right\\}\\tag{3.48}\n\\end{equation}\\]可以通过针对 \\(\\beta\\) 最大化该表达式来找到 \\(\\beta\\) 的最大似然估计，这需要非线性优化算法。那么，声称 \\(\\beta=0\\) 的原假设可以通过比较 \\(-2\\log L(\\hat{\\beta})\\) 和 \\(-2\\log L(0)\\) 的值来检验。后者其实简单地为 \\(2\\sum_{j=1}^r\\log n_j\\)。可以通过对声称 \\(\\beta=0\\) 的原假设进行得分检验 (score test) 来避免计算 \\(\\hat\\beta\\)。该检验程序在附录 中有概述，它基于检验统计量 \\(u^2(0)/(0)\\)，其中\\[\\begin{aligned}u(\\beta)&=\\frac{\\partial\\log L(\\beta)}{\\partial\\beta}\\end{aligned}\\]为有效得分，且\\[\\begin{aligned}(\\beta)=-\\frac{\\partial^2\\log L(\\beta)}{\\partial\\beta^2}\\end{aligned}\\]是 Fisher（观测）信息函数。在 \\(\\beta = 0\\) 的原假设下，\\(u^2(0)/(0)\\) 服从自由度为一的卡方分布。现在，根据式 (3.48)，有\\[\\begin{aligned}\\frac{\\partial\\log L(\\beta)}{\\partial\\beta}=\\sum_{j=1}^r\\left(d_{1j}-\\frac{n_{1j}e^\\beta}{n_{1j}e^\\beta+n_{2j}}\\right)\\end{aligned}\\]以及\\[\\begin{gathered}\n\\begin{aligned}\\frac{\\partial^2\\log L(\\beta)}{\\partial\\beta^2}\\end{aligned} \\begin{aligned}=-\\sum_{j=1}^r\\frac{(n_{1j}e^\\beta+n_{2j})n_{1j}e^\\beta-(n_{1j}e^\\beta)^2}{(n_{1j}e^\\beta+n_{2j})^2}\\end{aligned} \\\\\n=-\\sum_{j=1}^r\\frac{n_{1{j}}n_{2{j}}e^\\beta}{(n_{1{j}}e^\\beta+n_{2{j}})^2}\n\\end{gathered}\\]因此，在 \\(\\beta = 0\\) 处计算的有效得分和信息函数为\\[\\begin{aligned}u(0)=\\sum_{j=1}^r\\left(d_{1j}-\\frac{n_{1j}}{n_{1j}+n_{2j}}\\right)\\end{aligned}\\]和\\[\\begin{aligned}(0)&=\\sum_{j=1}^r\\frac{n_{1j}n_{2j}}{(n_{1j}+n_{2j})^2}\\end{aligned}\\]这些恰好是第 2 章的式 (2.20) 和 (2.22) 中给出的 \\(U_L\\) 和 \\(V_L\\) 的表达式，适用于没有生存时间结的特殊情况，即，对于 \\(j=1,2,\\ldots,r\\) 有 \\(d_j = 1\\)。当存在观测结时，式 (3.47) 中的似然函数需替换为能够处理结的函数。具体来说，如果使用式 (3.12) 中的似然函数，则有效得分函数和信息函数恰好是式 (2.20) 和 (2.22) 中给出的那些函数。因此，当存在生存时间结时，log-rank 检验对应于使用 Cox (1972) 提出的离散比例风险模型 (discrete proportional hazards model) 的得分检验。在实践中，比较两个模型（含与不含治疗效应项）的 \\(-2\\log\\hat{L}\\) 统计量所得的 \\(P\\) 值，与该得分检验给出的 \\(P\\) 值通常没有太大差异。这一点在讨论示例 3.3 时已注意到这一点。当然，使用 Cox 回归模型分析这类数据的一个优点是，它可以直接得到风险比的估计。","code":""},{"path":"cox-回归模型.html","id":"sec3-15","chapter":"►Cox 回归模型","heading":"3.15 延伸阅读","text":"Draper Smith (1998) 以及 Montgomery, Peck Vining (2021) 对线性回归分析中的统计建模进行了全面介绍。McCullagh Nelder (1989) 在其关于广义线性模型百科全书式的综述中包含了关于生存数据模型的章节。Cox (1972) 提出了生存数据的比例风险模型，其中未指定基线风险函数。该文引入了偏似然的概念，随后 Cox (1975) 对其进行了更详细的研究。另见 Kalbfleisch Prentice (1972) 以及 Breslow (1972) 关于 Cox (1972) 的讨论所作的贡献。Therneau Grambsch (2000) 对该模型及其扩展进行了详细的回顾。Christensen (1987), Elashoff (1983) 和 Tibshirani (1982) 为医学研究人员介绍了 Cox 回归模型。较近的论述可见第 1 章 1.6 节引用的教科书。特别是，Hosmer, Lemeshow May (2008) 对模型发展和基于模型的参数估计的解释进行了仔细的讨论。Kalbfleisch Prentice (2002) 以及 Lawless (2002) 对生存数据中的结进行了细致的处理；另见 Breslow (1972) 和 Peto (1972). 在 3.10 节中用 \\(\\hat S_0(t)\\) 表示的基线生存函数，其估计由 Kalbfleisch Prentice (1973) 引入，在 Kalbfleich Prentise (2002) 中也进行了描述。估计 \\(S_{0}^{*}(t)\\) 由 Breslow (1972, 1974) 提出，但它使用了不同于 3.10.2 节的论点。有关线性回归分析的书籍中讨论了模型制定和模型选择策略。 Harrell (2015) 解决了模型构建中的许多实际问题，并使用大量涉及生存数据的案例研究说明了该过程。另请参见 Chatfield (1995) 的第 5 章以及 Cox Snell (1981) 的第 4 章。 Miller (2002) 描述了一系列用于识别线性回归模型中合适的变量子集的程序。Akaike (1974) 提出了后来称为 Akaike 信息准则的概念。它广泛用于时间序列分析，并在有关该主题的书籍中进行了描述，例如 Chatfield Xing (2019). Volinsky Raftery (2000) 描述了 BIC 统计量在生存数据建模中的使用。 Nelder (1977) 以及 McCullagh Nelder (1989) 的第 3 章充分讨论了层次原则。Lasso 首先由 Tibshirani (1996) 提出，Tibshirani (1997) 展示了如何将该方法用于 Cox 模型中的变量选择。Goeman (2010) 描述了一种计算 lasso 估计的有效算法。该算法现已在 R 包 penalized 中实现，用于拟合惩罚 Cox 回归模型；参见 Goeman, Meijer Chaturvedi (2022). Efron et al. (2004) 建立了 lasso 的分段线性性质，Yuan Lin (2006) 引入了 group lasso 来处理分类变量。Royston Altman (1994) 描述了分数多项式在回归建模中的使用；另见 Sauerbrei Royston (1999). Box Tidwell (1962) 引入了在分数多项式背景下的 Box-Tidwell 变换。Nieto Coresh (1996) 回顾了调整的生存函数的计算方法，Zahl (1997) 在对该文的评论中概述了一些相关方法。Zhang et al. (2007) 也描述了该方法，他们给出了一个 SAS 宏来实现该方法。Neuberger et al. (1986) 使用基于解释变量平均值的方法来总结肝移植项目的观测数据，随后 Thomsen, Keiding Altman (1991) 引用了该方法。已经提出了相当多的解释的变异的度量，并有几篇综述对这些方法的性质进行了比较和对比。其中最为详尽的综述来自 Schemper Stare (1996), Hielscher et al. (2010) 以及 Choodari-Oskooei, Royston Parmar (2012) 的两篇连续论文。本章中描述的 \\(R^2\\) 度量是由 Kent O’Quigley (1988) 以及 Royston Sauerbrei (2004) 引入的。Royston (2006) 还描述了这些度量与其他解释的变异的度量之间的联系。Heinzl (2000) 给出了用于计算 Kent O’Quigley 的 \\(R^2_W\\) 统计量的 SAS 宏。Harrell 的 \\(c\\) 统计量在 Harrell, Lee Mark (1996) 中有所描述，而 Gönen Heller (2005) 则介绍了一种更受欢迎的一致性度量。Stare, Perme Henderson (2011) 提出的另一种解释的变异的度量可用于比例风险模型，其优势在于适用于后面章节中介绍的一些其他模型。该统计量基于解释观测值排序的变异，且可在 R 软件中计算。Heagerty, Lumley Pepe (2000) 是有关时依 ROC 曲线的关键论文，他们给出了 3.13 节中描述的两种估计该曲线的方法。 Akritas (1994) 提供了最近邻平滑方法。 Kamarudin, Cox Kolamunnage-Dona (2017) 全面回顾了许多估计时依 ROC 曲线的方法。Collett (2003) 详细描述了 logistic 回归模型，评估诊断测试和时依预测能力的教程包括 Pepe, Leisenring Rutter (1999) 以及 Pepe, Longton Janes (2009).本章未讨论的一个问题是如何处理解释变量的缺失值。基于全条件定义 (fully conditional specification) 的多重插补 (multiple imputation) 法，也称为链式方程多重插补 (multiple imputation chained equations)，是处理这一常见问题广泛使用的技术。多重插补过程涉及为每个具有缺失值的解释变量生成多组插补值。然后为待插补数据集拟合给定模型，将所得参数估计进行组合，以得到总体估计，其标准误考虑了插补值的不确定性。软件开发的进步意味着这种技术现在可以与常用的软件包结合使用，包括 SAS, Stata 和 R. White, Royston Wood (2011) 的教程描述了该方法、其局限性和可能的危险，另附一个全面的参考列表。","code":""},{"path":"chap4.html","id":"chap4","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"第 4 章 Cox 回归模型的模型检查","text":"为一组观察到的生存数据拟合模型后，需要评估模型的充分性 (adequacy). 事实上，使用诊断程序进行模型检查是建模过程的重要组成部分。在某些情况下，仔细检查观察到的数据集可能会识别出某些特征，例如生存时间异常长或短的个体。然而，对数据的目视检查可能不会很有启发，除非只有一两个解释变量。删失使情况变得更加复杂，因为即使在最简单的情况下，删失生存时间的出现也使得判断模型充分性的各个方面变得困难。因此，应通过诊断程序来补充数据的目视检查，以检测拟合模型的不足之处。一旦模型被拟合，就需要研究拟合的许多方面。例如，模型必须包括研究中测量的一组适当的解释变量，我们需要检查是否使用了这些变量的正确函数形式。确定观察到的生存时间比预期的要长，或者其解释变量对特定风险比有不当影响的个体可能很重要。此外，可能需要一些方法来考察比例风险假设。许多模型检查程序都是基于称为残差 (residuals) 的量。这些值可以为研究中的每个个体计算，其特征是，当拟合模型令人满意时，他们的表现是已知的，至少是近似的。已经提出了用于 Cox 回归模型的多种残差，本章从对其中一些残差的回顾开始。随后的章节将讨论残差在评估模型充分性特定方面的使用。","code":""},{"path":"chap4.html","id":"sec4-1","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.1 Cox 回归模型的残差","text":"在本节中，我们将假设有 \\(n\\) 个个体的生存时间，其中有 \\(r\\) 个死亡时间，其余的 \\(n−r\\) 个是右删失的。我们进一步假设已为这些生存时间拟合了 Cox 回归模型，并且模型的线性部分包含 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\)。因此，第 \\(\\) 个个体 \\(= 1, 2,...,n\\) 的风险函数拟合为\\[\\hat{h}_i(t)=\\exp(\\hat{\\boldsymbol{\\beta}}'x_i)\\hat{h}_0(t)\\]其中 \\(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i=\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi}\\) 为相应个体的风险评分值，\\(\\hat{h}_0(t)\\) 为基线风险函数估计。","code":""},{"path":"chap4.html","id":"sec4-1-1","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.1.1 Cox-Snell 残差","text":"在生存数据分析中最广泛使用的残差是 Cox-Snell 残差，之所以这么称，是因为它是 Cox Snell (1968) 给出的残差一般定义中的一个特例。第 \\(\\) 个个体的 Cox-Snell 残差，\\(=1,2,\\ldots,n\\)，为\\[\\begin{equation}\nr_{Ci}=\\exp(\\hat{\\boldsymbol{\\beta}}'x_i)\\hat{H}_0(t_i)\n\\tag{4.1}\n\\end{equation}\\]其中 \\(\\hat{H}_0(t_i)\\) 是基线累积风险函数在时间 \\(t_i\\) （观察到的该个体的生存时间） 处的估计。在实践中，通常使用式 (3.29) 中给出的 Nelson-Aalen 估计。请注意，根据式 (3.25)，Cox-Snell 残差 \\(r_{Ci}\\) 是 \\(\\hat{H}_{{}}(t_{{}})=-\\operatorname{log}\\hat{S}_{{}}(t_{{}})\\) 的值，其中 \\(\\hat{H}_{{}}(t_{{}})\\) 和 \\(\\hat{S}_{{}}(t_{{}})\\) 是第 \\(\\) 个个体的累积风险函数和生存函数在 \\(t_i\\) 处的估计值。该残差可以根据数理统计中关于随机变量函数分布的一般结果中导出。根据该结果，如果 \\(T\\) 是与个体生存时间相关的随机变量，\\(S{(t)}\\) 是相应的生存函数，无论 \\(S{(t)}\\) 的形式如何，随机变量 \\(Y = − \\log S{(T)}\\) 服从均值为一的指数分布。下一段概述了这一结果的证明，可以省略而不失阅读的连续性。根据一般结果，若 \\(f_X(x)\\) 是随机变量 \\(X\\) 的概率密度函数，则随机变量 \\(Y=g(X)\\) 的密度由下式给出\\[f_Y(y)=f_X\\{g^{-1}(y)\\}\\Big/\\left|\\frac{\\mathrm{d}y}{\\mathrm{d}x}\\right|\\]其中 \\(f_X\\{g^{-1}(y)\\}\\) 为用 \\(y\\) 表示的 \\(X\\) 的密度。使用该结果，随机变量 \\(Y=-\\log S(T)\\) 的概率密度函数为\\[\\begin{equation}\nf_Y(y)=f_T\\left\\{S^{-1}(e^{-y})\\right\\}\\Big/\\left|\\frac{\\mathrm{d}y}{\\mathrm{d}t}\\right|\n\\tag{4.2}\n\\end{equation}\\]其中 \\(f_{T}(t)\\) 是 \\(T\\) 的概率密度函数。现在\\[\\begin{aligned}\\frac{\\mathrm{d}y}{\\mathrm{d}t}&=\\frac{\\mathrm{d}\\{-\\log S(t)\\}}{\\mathrm{d}t}=\\frac{f_T(t)}{S(t)}\\end{aligned}\\]当该函数的绝对值用 \\(y\\) 表示时，导数变为\\[\\frac{f_T\\left\\{S^{-1}(e^{-y})\\right\\}}{S\\left\\{S^{-1}(e^{-y})\\right\\}}=\\frac{f_T\\left\\{S^{-1}(e^{-y})\\right\\}}{e^{-y}}\\]最后，代入式 (4.2) 中的导数，我们发现\\[f_Y(y)=e^{-y}\\]论证的下一个关键步骤如下。如果拟合观测数据的模型令人满意，则基于模型对第 \\(\\) 个个体在 \\(t_i\\)（该个体的生存时间）处的生存函数估计将接近相应的真实值 \\(S_i(t_i)\\)。这表明，如果拟合了正确的模型，则值 \\(\\hat{S}_{{}}(t_{{}})\\) 将具有与 \\({S}_{{}}(t_{{}})\\) 类似的性质。那么，生存函数估计的对数的负数为 \\(-\\operatorname{log}\\hat{S_{}}(t_{}),=1,2,\\ldots,n\\) 应表现为单位指数分布的 \\(n\\) 个观测。这些估计值是 Cox-Snell 残差。如果个体生存时间是右删失的，则残差的相应值也是右删失。因此，残差将是单位指数分布的删失样本，对这一假设的检验提供了对模型充分性的检验，我们将在 4.2.1 节回到这一点。Cox-Snell 残差 \\(r_{Ci}\\) 的性质与线性回归分析中使用的残差非常不同。具体来说，它们不关于零对称分布，并且它们不可能是负的。此外，由于 Cox-Snell 残差在拟合适当的模型时被假设为具有指数分布，因此它们的分布是高度偏斜的，并且第 \\(\\) 个残差的均值和方差都为 1.","code":""},{"path":"chap4.html","id":"sec4-1-2","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.1.2 修正的 Cox-Snell 残差","text":"不能将删失观测得到的残差与未删失观测得到的残差同等对待。因此，我们可能会设法修正 Cox-Snell 残差，以便明确考虑删失。假设第 \\(\\) 个生存时间是一个删失观测 \\(t^*_i\\)，并且设 \\(t_i\\) 是满足 \\(t_i>t^*_i\\) 的实际但未知的生存时间。在该个体删失生存时间计算的 Cox-Snell 残差为\\[\\begin{aligned}r_{Ci}=\\hat{H}_i(t_i^*)=-\\log\\hat{S}_i(t_i^*)\\end{aligned}\\]其中 \\(\\hat{H}_{{}}(t_{{}}^*)\\) 和 \\(\\hat{S}_{{}}(t_{{}}^*)\\) 分别为第 \\(\\) 个个体的累积风险函数和生存函数在删失生存时间 \\(t_i^*\\) 处的估计值。如果拟合的模型是正确的，则可任务 \\(r_{Ci}\\) 服从单位指数分布。该分布的累积风险函数随时间线性增加，因此第 \\(\\) 个个体的生存时间 \\(t_i\\) 值越大，该个体的 Cox-Snell 残差值就越大。因此，第 \\(\\) 个个体在实际（未知）生存时间的残差 \\(\\hat{H}_{\\boldsymbol{}}(t_{\\boldsymbol{}})\\) ，将大于在删失生存时间计算的残差。考虑到这一点，可以通过添加正的常数 \\(\\Delta\\) 来修正 Cox-Snell 残差，该常数可称为超额残差 (excess residual). 因此，修正的 Cox-Snell 残差形如\\[\\left.r'_{Ci}=\\left\\{\\begin{array}{ll}r_{Ci}&\\text{对于未删失观测},\\\\r_{Ci}+\\Delta&\\text{对于删失观测},\\end{array}\\right.\\right.\\]其中 \\(r'_{Ci}\\) 是第 \\(\\) 个观测的 Cox-Snell 残差，由式 4.1 定义。现在需要确定合适的 \\(\\Delta\\) 值。为此，我们利用指数分布的无记忆性 (lack memory property).为了证明这一性质，假设随机变量 \\(T\\) 服从均值为 \\(\\lambda−1\\) 的指数分布，并考虑 \\(T\\) 超过 \\(t_0+t_1,t_1 \\ge 0\\) 的概率，条件是 \\(T\\) 至少为 \\(t_0\\)。根据 3.3.1 节中给出的条件概率的标准结果，该概率为\\[\\begin{aligned}\\mathrm{P}(T\\geqslant t_0+t_1\\mid T\\geqslant t_0)&=\\frac{\\mathrm{P}(T\\geqslant t_0+t_1\\text{ }T\\geqslant t_0)}{\\mathrm{P}(T\\geqslant t_0)}\\end{aligned}\\]该表达式的分子简单地为 \\(\\mathrm{P}(T\\geqslant t_0+t_1)\\)，因此所需概率是生存时间超过 \\(t_0+t_1\\) 的概率与超过 \\(t_0\\) 的概率之比，即 \\(S(t_0+t_1)/S(t_0)\\)。指数分布的生存函数由 \\(S(t)=e^{-\\lambda t}\\) 给出，如第 5 章式 (5.2) 所示，因此\\[\\begin{aligned}\\mathrm{P}(T\\geqslant t_0+t_1\\mid T\\geqslant t_0)&=\\frac{\\exp\\{-\\lambda(t_0+t_1)\\}}{\\exp(-\\lambda t_0)}=e^{-\\lambda t_1}\\end{aligned}\\]它是指数随机变量在时间 \\(t_1\\) 的生存函数，即 \\(\\mathrm{P}(T\\geqslant t_{1})\\)。这一结果意味着，在生存到时间 \\(t_0\\) 的条件下，超过 \\(t_0\\) 的超额生存时间也具有指数分布，均值为 \\(\\lambda^{−1}\\)。换言之，生存时间超过 \\(t_0\\) 的概率不受个体已经生存到时间 \\(t_0\\) 这一信息的影响。根据该结果，由于 \\(r'_{Ci}\\) 具有单位指数分布，因此超额残差 \\(\\Delta\\) 也将具有单位指数分布。因此，\\(\\Delta\\) 的期望值是 1，提示 \\(\\Delta\\) 可视为 1，这得出了修正的 Cox-Snell 残差，为\\[\\begin{align}\n\\left.r'_{Ci}=\\left\\{\\begin{array}{ll}r_{Ci}&\\text{对于未删失观测},\\\\r_{Ci}+1&\\text{对于删失观测},\\end{array}\\right.\\right.\n\\tag{4.3}\n\\end{align}\\]第 \\(\\) 个修正的 Cox-Snell 残差可通过引入事件指示符 \\(\\delta_i\\) 以另一种形式表示，如果第 \\(\\) 个个体的观测生存时间删失，则 \\(\\delta_i\\) 取 0，如果未删失则取 1. 那么根据式 (4.3)，修正的 Cox-Snell 残差由下式给出\\[\\begin{align}\nr'_{Ci}=1-\\delta_i+r_{Ci}\n\\tag{4.4}\n\\end{align}\\]注意，根据这种类型残差的定义，对于删失观测 \\(r'_{Ci}\\) 必须大于 1. 此外，对于未修正的残差，\\(r'_{Ci}\\) 可以取零到无穷大之间的任何值，并且它们具有偏斜分布。Crowley Hu (1977) 根据经验性证据发现，为删失观测的 Cox-Snell 残差添加 1 会使残差过度膨胀。因此，他们建议使用超额残差的中位数而不是平均值。对于单位指数分布，生存函数为 \\(S(t)=e^{-t}\\)，中位数 \\(t(50)\\) 满足 \\(e^{-t(50)}=0.5\\)，因此 \\(t(50)=\\log2=0.693\\)。因此，修正的 Cox-Snell 残差的第二个版本为\\[\\begin{align}\n\\left.r''_{Ci}=\\left\\{\\begin{array}{ll}r_{Ci}&\\text{对于未删失观测},\\\\r_{Ci}+0.693&\\text{对于删失观测},\\end{array}\\right.\\right.\n\\tag{4.5}\n\\end{align}\\]然而，如果删失观测的比例不太大，则来自式 (4.3) 和 式 (4.5) 的修正残差集不会有太大差异。","code":""},{"path":"chap4.html","id":"sec4-1-3","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.1.3 鞅残差","text":"式 (4.4) 定义的修正残差 \\(r'_{Ci}\\) 对于未删失观测具有单位均值。因此，这些残差可以通过重新定义 (relocate) \\(r'_{Ci}\\) 来改进，使得在未删失观测时它们的均值为零。此外，如果将所得值乘以 \\(−1\\)，则可获得残差\\[\\begin{align}\nr_{Mi}=\\delta_i-r_{Ci}\n\\tag{4.6}\n\\end{align}\\]这些残差称为鞅残差 (martingale residuals)，因为它们也可以使用所谓的鞅法 (martingale methods) 导出，稍后将在第 13 章 13.1 节中提及。在这一推导中，\\(r_{Ci}\\) 基于累积风险函数的 Nelson-Aalen 估计。鞅残差取值在 \\(-∞\\) 和 \\(1\\) 之间，删失观测的残差为负，其中 \\(\\delta_i=0\\)。还可以证明，这些残差之和为零，并且在大样本中，鞅残差彼此不相关，并且期望为零。在这方面，它们的性质类似于线性回归分析中的残差。观察鞅残差另一种方式为，式 (4.6) 中的 \\(r_{Mi}\\) 是区间 \\((0,t_i)\\) 内第 \\(\\) 个个体的死亡数与基于拟合模型的相应估计期望数之差。要理解这一点，请注意，如果生存时间 \\(t_i\\) 未删失，观察到的死亡数就是 1，如果删失了则为 0，也就是 \\(\\delta_i\\)。式 (4.6) 中的第二项是 \\(H_i(t_i)\\) 的估计值，即第 \\(\\) 个个体在区间 \\((0,t_i)\\) 内的累积死亡风险。根据第 1 章 1.4.3 节，这可以解释为该区间内预期的死亡数。这体现了鞅残差和其他数据分析领域的残差之间的另一个相似之处。","code":""},{"path":"chap4.html","id":"sec4-1-4","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.1.4 偏差残差","text":"尽管鞅残差与其他情况（例如线性回归分析）中遇到的残差具有许多相同的性质，但即使拟合模型正确，它们也不会关于零对称分布。这种偏性使得残差图难以解释。Therneau, Grambsch Fleming (1990) 引入的偏差残差 (deviance residuals) 则更接近于关于零对称分布，其定义为\\[\\begin{align}r_{Di}=\\operatorname{sgn}(r_{Mi})\\left[-2\\left\\{r_{Mi}+\\delta_i\\log(\\delta_i-r_{Mi})\\right\\}\\right]^{\\frac{1}{2}}\n\\tag{4.7}\n\\end{align}\\]其中 \\(r_{Mi}\\) 是第 \\(\\) 个个体的鞅残差，函数 \\(\\operatorname{sgn}(\\cdot)\\) 是符号函数 (sign function)：如果其参数为正，则取值 \\(+1\\)，如果参数为负，则取值 \\(−1\\)。因此，\\(\\operatorname{sgn}(r_{Mi})\\) 确保偏差残差与鞅残差具有相同的符号。这些残差的原始动机是它们是偏差 (deviance) 的组成部分。偏差是一种统计量，用于总结当前感兴趣的模型的拟合程度以及与数据完美拟合的模型的拟合程度之间偏差。后者称为饱和模型或全模型 (saturated full model)，是允许每个个体的 \\(\\beta\\) 系数不同的模型。偏差统计量由下式给出\\[D=-2\\left\\{\\log\\hat{L}_c-\\log\\hat{L}_f\\right\\}\\]其中 \\(\\hat{L}_c\\) 是当前模型的最大偏似然，\\(\\hat{L}_f\\) 是全模型的最大偏似然。偏差值越小，模型越好。偏差可视为将正态数据建模中使用的残差平方和推广到非正态数据的分析，在广义线性建模中具有突出的特征。请注意，两模型的偏差之差与第 3 章中介绍的统计量 \\(-2\\log\\hat{L}\\) 值之差相同。偏差残差满足 \\(D=\\sum r_{D{}}^2\\)，因此，与相对较大的偏差残差对应的观测是那些没有被模型很好地拟合的观测。观察偏差残差的另一种方式为，当拟合的模型合适时，它们是通过变换得到的鞅残差，其值关于零对称。为了理解这一点，首先回顾一下，鞅残差 \\(r_{Mi}\\) 可以取在区间 \\((−∞, 1)\\) 内的任何值。对于 \\(r_{Mi}\\) 的较小负值，式 (4.7) 中方括号内的项主要由 \\(r_{Mi}\\) 决定。对该量取平方根的作用是将残差拉近到零。因此，范围在 \\((−∞, 1)\\) 内的鞅残差会向零收缩。现考虑区间 \\((0, 1)\\) 内的鞅残差。式 (4.7) 中的项 \\(\\delta_i\\log(\\delta_i-r_{Mi})\\) 仅在未删失观测中才非零，且其值为 \\(\\log(1-r_{Mi})\\)。随着 \\(r_{M }\\) 接近 1，\\(1−r_{M }\\) 接近 0，\\(\\log(1-r_{Mi})\\) 会取较小的负值。此时，式 (4.7) 中方括号内主要由这个对数项决定，因此当鞅残差达到其上限 \\(1\\) 时，偏差残差会向 \\(+∞\\) 延展。最后需要注意的一点是，当拟合了适当的模型时，可以预期这些残差在零附近对称分布，但它们的总和不一定为零。","code":""},{"path":"chap4.html","id":"sec4-1-5","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.1.5 Schoenfeld 残差","text":"4.1.1 节至第 4.1.4 节中描述的残差的两个缺点是，它们在很大程度上取决于观察到的生存时间，并且需要对累积风险函数进行估计。Schoenfeld (1982) 提出的残差克服了这两个缺点。这些残差最初被称为部分残差 (partial residuals)（原因在后续给出），但现在通常称为 Schoenfeld 残差。该残差与之前考虑的残差在一个重要方面不同：每个个体不是只有一个残差值，而是一组值，每个值对应于拟合的 Cox 回归模型中包含的每个解释变量。模型中的第 \\(j\\) 个解释变量 \\(X_j\\) 的第 \\(\\) 个 Schoenfeld 残差由下式给出\\[\\begin{align}\nr_{Sji}=\\delta_i\\{x_{ji}-\\hat{}_{ji}\\}\n\\tag{4.8}\n\\end{align}\\]其中 \\(x_{ji}\\) 是第 \\(j\\) 个解释变量的值，\\(j=1,2,\\ldots,p\\)，对于研究中的第 \\(\\) 个个体\\[\\begin{align}\n\\hat{}_{ji}=\\frac{\\sum_{l\\R(t_i)}x_{jl}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)}{\\sum_{l\\R(t_i)}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)}\n\\tag{4.9}\n\\end{align}\\]\\(R(t_{{}})\\) 为时间 \\(t_i\\) 的风险集。请注意，这些残差的非零值只出现在未删失观测中。此外，如果生存时间样本中的最大观测未删失，则根据式 (4.9)，该观测的 \\(\\hat{}_{j\\textit{}}\\) 的值将等于 \\(x_{ji}\\)，因此 \\(r_{Sji}=0\\)。为了区分真正为零的残差与从删失观测中获得的残差，后者通常表示为缺失值。对于解释变量 \\(X_j\\)，第 \\(\\) 个 Schoenfeld 残差是偏对数似然函数关于 \\(\\beta_j\\) 的一阶导数的第 \\(\\) 个分量的估计，根据式 (3.6)，其由下式给出：\\[\\begin{align}\n\\frac{\\partial\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j}&=\\sum_{=1}^n\\delta_i\\{x_{ji}-a_{ji}\\}\n\\tag{4.10}\n\\end{align}\\]其中\\[\\begin{align}\na_{ji}=\\frac{\\sum_{l}x_{jl}\\exp(\\boldsymbol{\\beta'x_l})}{\\sum_{l}\\exp(\\boldsymbol{\\beta'x_l})}\n\\tag{4.11}\n\\end{align}\\]该求和中的第 \\(\\) 项在 \\(\\hat{\\boldsymbol\\beta}\\) 处计算，是 \\(X_j\\) 的 Schoenfeld 残差，如式 (4.8) 所示。由于 \\(\\beta\\) 的估计满足\\[\\left.\\frac{\\partial\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j}\\right|_{\\boldsymbol{\\hat{\\beta}}}=0\\]因此 Schoenfeld 残差之和必须为零。这些残差还具有这样的性质：在大样本中，\\(r_{Sji}\\) 的期望值为零，并且它们彼此不相关。事实证明，Grambsch Therneau (1994) 提出的 Schoenfeld 残差的缩放 (scaled) 版本在检测与假设模型的偏差方面更有效。令第 \\(\\) 个个体的 Schoenfeld 残差向量表示为 \\(\\boldsymbol{r}_{Si}=(r_{S1i},r_{S2i},\\ldots,r_{Spi}){'}\\)。缩放或加权的 Schoenfeld 残差 \\(r_{Sji}^{*}\\) 为如下向量的分量\\[\\begin{aligned}\\boldsymbol{r}_{S{}}^*=d\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{r}_{S{}}\\end{aligned}\\]其中 \\(d\\) 是 \\(n\\) 个个体中的死亡人数，\\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\) 是拟合的 Cox 回归模型中参数估计的方差协方差阵。因此，这些缩放 Schoenfeld 残差的计算非常简单。","code":""},{"path":"chap4.html","id":"sec4-1-6","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.1.6 得分残差","text":"还有另一种类型的残差在模型检查的某些方面很有用，它与 Schoenfeld 残差一样，是从偏对数似然函数关于参数 \\(\\beta_j\\) 的的一阶导数获得的，\\(j = 1, 2,\\ldots,p\\)。然而，式 (4.10) 中的导数现在以完全不同的形式表示，即\\[\\begin{align}\n\\frac{\\partial\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j}=\\sum_{=1}^n\\left\\{\\delta_i(x_{ji}-a_{ji})+\\exp(\\boldsymbol{\\beta}'\\boldsymbol{x}_i)\\sum_{t_r\\leqslant t_i}\\frac{(a_{jr}-x_{ji})\\delta_r}{\\sum_{l\\R(t_r)}\\exp(\\boldsymbol{\\beta}'\\boldsymbol{x}_l)}\\right\\}\n\\tag{4.12}\n\\end{align}\\]其中 \\(x_{ji}\\) 是第 \\(j\\) 个解释变量的第 \\(\\) 个值，\\(\\delta_i\\) 是事件指示：对于删失观测为 0，否则为 1. \\(a_{ji}\\) 由式 (4.11) 给出，\\(R(t_{{r}})\\) 为在时间 \\(t_r\\) 处的风险集。在该公式中，第 \\(\\) 个观测对导数的贡献仅取决于时间 \\(t_i\\) 之前的信息。换句话说，如果研究实际上在时间 \\(t_i\\) 结束，导数的第 \\(\\) 个分量不会受影响。那么残差就是导数的 \\(n\\) 个分量的估计值。根据附录 ，偏对数似然函数关于 \\(\\beta_j\\) 的一阶导数是 \\(\\beta_j\\) 的有效得分 (efficient score)，记为 \\(u(\\beta_j)\\)。因此，这些残差称为得分残差 (score residuals)，用 \\(r_{Uji}\\) 表示。根据式 (4.12)，模型中第 \\(j\\) 个解释变量 \\(X_j\\) 的第 \\((=1,2,\\ldots,n)\\) 个得分残差由下式给出：\\[\\begin{aligned}r_{Uji}&=\\delta_i(x_{ji}-\\hat{}_{ji})+\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i)\\sum_{t_r\\leqslant t_i}\\frac{(\\hat{}_{jr}-x_{ji})\\delta_r}{\\sum_{l\\R(t_r)}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)}\\end{aligned}\\]使用式 (4.8) 后，上式可以写为以下形式：\\[\\begin{align}\nr_{Uji}=r_{Sji}+\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i)\\sum_{t_r\\leqslant t_i}\\frac{(\\hat{}_{jr}-x_{ji})\\delta_r}{\\sum_{l\\R(t_r)}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l)}\n\\tag{4.13}\n\\end{align}\\]这表明得分残差是 Schoenfeld 残差的修改。与 Schoenfeld 残差一样，得分残差的总和为零，但观测删失时，得分残差不一定为零。本节定义了许多残差。我们用一个示例来说明这些不同类型的残差的计算，并显示它们之间的相似性和差异。这个示例将在本章的许多说明中使用，主要是因为相对较少的观测使得残差值和其他诊断值可以很容易地制成表格。然而，本章的方法通常在较大的数据集中提供更多信息。示例 4.1  (透析患者的感染) 在治疗某些肾脏疾病时，可以使用透析来清除血液中的废物。透析患者可能出现的一个问题是在导管插入的部位发生感染。如果发生任何此类感染，必须取出导管并清除感染。在 McGilchrist Aisbett (1991) 描述的一项调查感染发生率的研究中，记录了一组肾病患者从插入导管到感染的时间。有时因感染之外的原因必须拔除导管，从而产生右删失观察结果。此示例中的数据涉及 13 名患有在该论文中编码为 3 型的肾病患者。表 4.1 给出了从插入导管到第一次发生感染后拔除导管的天数，以及指示个体感染状态的变量值。如果因感染之外的原因拔除导管，则该变量取值为 0，否则取值为 1. 数据集还包括每个患者的年龄（以年为单位）以及表示性别的变量 （1 = 男性，2 = 女性）。\n当对这些数据拟合 Cox 回归模型时，第 \\(\\) 个患者 \\(= 1, 2,..., 13\\) 的风险函数估计为\\[\\begin{align}\n\\hat{h}_i(t)=\\exp\\left\\{0.030Age_i-2.711Sex_i\\right\\}\\hat{h}_0(t)\n\\tag{4.14}\n\\end{align}\\]其中 \\(Age_i\\) 和 \\(Sex_i\\) 表示第 \\(\\) 个患者的年龄和性别。变量 Sex 当然很重要，因为当将 Sex 添加到仅包含 Age 的模型中时，在 \\(-2\\log\\hat{L}\\) 统计量在一个自由度上的减小了 6.445. 这种变化非常显著（\\(P=0.011\\)）。另一方面，没有统计证据表明在需模型中包括变量 Age，将 Age 添加到包含 Sex 的模型中后 \\(-2\\log\\hat{L}\\) 统计量在一个自由度上的变化为 1.320（\\(P=0.251\\)）。但是从临床角度来看，感染的风险很可能取决于年龄。因此，这两个变量都将保留在模型中。式 (4.14) 中模型的不同类型的残差值如表 4.2 所示。在此表中，\\(r_{Ci},r_{Mi}\\) 和 \\(r_{Di}\\) 分别是 Cox-Snell 残差、鞅残差和偏差残差。\\({r_{S1i}}\\) 和 \\({r_{S2i}}\\) 分别是变量 Age 和 Sex 的 Schoenfeld 残差值，\\(r_{S1i}^{*}\\) 和 \\(r_{S2i}^{*}\\) 是相应的缩放 Schoenfeld 残差，\\(r_{U1i},r_{U2i}\\) 为得分残差。该表中的值是使用式 (3.29) 中给出的基线累积风险函数的 Nelson-Aalen 估计来计算的。如果使用式 (3.23) 中的估计 \\(\\hat H_0(t)\\)，则除 Schoenfeld 残差之外的所有残差都将获得不同的值。此外，由于生存函数的相应估计在最长拔除时间处为零，这对应 13 号患者，因此不会为该患者定义 Cox-Snell、鞅和偏差残差的值，并且鞅残差将不再为零。\n在此数据集中，只有一个删失观测，即针对 6 号患者的观测。除 6 号患者之外的所有患者，修正的 Cox-Snell 残差将与 Cox-Snell 残差相同。对于该患者，修正残差的两种形式的值为 \\(r'_{C6}=1.265\\) 和 \\(r''_{C6}= 0.958\\)。此外，对于具有删失拔出时间的患者，Schoenfeld 是未定义的，对于拔出导管时间最长的患者，Schoenfeld 残差为零。表 4.2 清楚地显示了 Cox-Snell 残差和鞅残差的偏度，因为 Cox-Snell 残差以 1 为中心，而鞅残差和偏差残差以 0 为中心。另请注意，鞅、Schoenfeld 和得分残差之和为零，并且它们理应如此。表 4.2 中残差的一个不寻常的特征是与 Sex 对应的 Schoenfeld 残差值有大量的 0. 其原因是，对于大于 30 天的感染时间，变量性别的值总是等于 2. 这意味着，对于大于 30 天的生存时间，式 (4.9) 中的 Schoenfeld 残差等于 2，因此式 (4.8) 中定义的 Schoenfeld 残差为 0.我们现在考虑如何使用拟合 Cox 回归模型后获得的残差来阐明拟合模型在多大程度上提供了对观测数据的适当描述，然后我们将更详细地研究示例 4.1 中得到的残差。","code":""},{"path":"chap4.html","id":"sec4-2","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.2 模型拟合的评估","text":"许多基于残差的图形可以作为评估拟合模型充分性的图形。不幸的是，许多类似于线性回归分析中使用的残差图的图形程序并未被证明是非常有用的。这是因为，即使已拟合了正确的模型，残差与观测生存时间或这些时间的秩次之间的图形也往往会呈现出明确的模式。传统上，残差图基于 Cox-Snell 残差或 4.1.2 节中描述的其调整版本。下一节将回顾这些残差的使用，然后描述如何使用其他类型的残差来对模型拟合进行图形评估。","code":""},{"path":"chap4.html","id":"sec4-2-1","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.2.1 基于 Cox-Snell 残差的图形","text":"在 4.1.1 节中，如果拟合的模型是正确的，Cox-Snell 残差将显示为具有单位均值的指数分布。因此，它们均值和方差都为 1，并且不对称地分布在均值附近。这意味着，简单的残差图，如残差关于观测的图形，称为索引图 (index plots)，不会是对称的。残差也与生存时间相关 (correlated)，因此这些残差与生存时间或这些时间的秩次的图形也是无用的。这些残差的一个特定图形可用于评估模型的整体拟合，从而评估残差是否为来自单位指数分布的合理样本。该图形基于以下事实：如果随机变量 \\(T\\) 服从单位均值的指数分布，则 \\(T\\) 的生存函数为 \\(e^{−t}\\) ；请参见第 5 章 5.1.1 节。因此，累积风险函数 \\(H(t) = − \\log S(t)\\) 关于 \\(t\\) 的图形，称为累积风险图 (cumulative hazard plot)，将给出一条通过原点、单位斜率的直线。该结果可用于检验残差是否具有单位指数分布。在计算 Cox-Snell 残差 \\(r_{Ci}\\) 之后，可以得到这些值的生存函数的 Kaplan-Meier 估计。该估计的计算方式与生存时间的 生存函数的 Kaplan-Meier 估计类似，只不过现在所依据的数据是残差 \\(r_{Ci}\\)。从删失生存时间获得的残差也视为删失的。用 \\(\\hat{S}(r_{Ci})\\) 表示估计值，绘制 \\(\\hat{H}(r_{Ci})=-\\operatorname{log}\\hat{S}(r_{Ci})\\) 关于 \\(r_{Ci}\\) 的图形。这给出了残差的累积风险图。一条具有单位斜率和零截距的直线将表明拟合的生存模型是令人满意的。另一方面，如果图形系统性地偏离直线，或者得到的直线斜率不近似为 1 或截距不近似为 0，这可能意味着模型需要以某种方式进行修改。等价地，也可以使用残差的对数累积风险图 (log-cumulative hazard plot)，即 \\(\\hat{H}(r_{Ci})=-\\operatorname{log}\\hat{S}(r_{Ci})\\) 关于 \\(\\log r_{Ci}\\) 的图形。关于该图形详细的讨论见 4.4.1 节。示例 4.2  (透析患者的感染) 再次考虑有关肾病患者感染发生时间的数据，如示例 4.1 所述。在这个例子中，我们首先检查 Cox-Snell 残差是否为单位指数分布的合理样本。为此，首先获得 Cox-Snell 残差的生存函数的 Kaplan-Meier 估计 \\(\\hat{S}(r_{C{}})\\)。然后绘制残差的累积风险函数 \\(\\hat{H}(r_{Ci})=-\\log\\hat{S}(r_{C\\boldsymbol{}})\\) 关于相应残差的图形，得到残差的累积风险图。表 4.3 总结了该计算的具体情况，图 4.1 显示了累积风险图形。6 号患者的残差没有相应的 \\(\\hat{S}(r_{C{6}}),\\hat{H}(r_{C6})\\) 的值，因为该观测是删失的。\n该数据集中的观测相对较少，因此很难解释残差的图形。然而，图 4.1 中的散点相当接近一条通过原点的直线，这条直线的斜率约为 1. 这可能表明，为表 4.1 中给出的数据拟合的模型是令人满意的。从表面上看，这一程序似乎有一些优点，但 Cox-Snell 残差的累积风险图在实践中并没有被证明是非常有用的。有人认为，在前面的一节中，由于值 \\(-\\log S(t_i)\\) 具有单位指数分布，因此当拟合模型是正确的时，Cox-Snell 残差作为这些量的估计，应该近似服从单位指数分布。然后在解释残差的累积风险图时使用这一结果。不幸的是，这种近似不是很可靠，尤其是在小样本中。这是因为在计算 \\(r_{Ci}\\) 时需要估计 \\(\\beta\\) 以及基线累积风险函数 \\(H_0(t)\\)。由于使用了估计值，因此残差的实际分布并不一定是单位指数分布，而且其确切分布是未知的。事实上，Lagakos (1981) 的研究表明，当 \\(n=3\\) 时，Cox-Snell 残差的分布与单位指数分布相去甚远。在其他情况下，即使已知拟合的模型不正确，也可能得到一条直线图。事实上，实践经验表明，在 Cox-Snell 残差的累积风险图中，不太可能看到除单位斜率的直线以外的其他图形，除非拟合的模型存在严重错误。在零模型——即不包含解释变量的模型——的特殊情况下，累积风险图恰好是一条单位斜率和零截距的直线，虽然应将一些解释变量纳入模型中。其原因是，当不包括协变量时，第 \\(\\) 个个体的 Cox-Snell 残差减小为 \\(-\\log\\hat{S}_0(t_i)\\)。根据第 3 章的式 (3.30)，在不存在结的情况下，在第 \\(k(k=1,2,\\ldots,r-1)\\) 个未删失生存时间，该值约为 \\(\\sum_{j=1}^k1/n_j\\)，其中 \\(n_j\\) 是在时间 \\(t_j\\) 处于风险中的人数。该总和简单地为 \\(\\sum_{j=1}^{k}1/(n-j+1)\\)，这是单位指数分布中样本大小为 \\(n\\) 的样本中第 \\(k\\) 个顺序统计量 (order statistic) 的期望。鉴于 Cox-Snell 残差在评估模型充分性方面的局限性，下一节将介绍实用的基于其他类型残差的诊断程序。","code":""},{"path":"chap4.html","id":"sec4-2-2","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.2.2 基于鞅残差和偏差残差的图形","text":"4.1.3 节中介绍的鞅残差可解释为第 \\(\\) 个个体在时间区间 \\((0,t_i)\\) 内的观测死亡数与预期死亡数之差。因此，这些残差突出显示了根据假设模型死亡过早或寿命过长的个体。较小的负残差将对应于生存时间较长的个体，但协变量值表明他们应该更早死亡。另一方面，当个体的生存时间出乎意料地短时，将获得接近于 1 的残差，即鞅残差的上限。鞅残差的索引图将突出显示模型未能很好拟合生存时间的个体。此类观测可称为离群值 (outliers). 残差绝对值异常大的个体的数据需要进一步检查。这些残差与生存时间、生存时间的秩次或解释变量的图形，可以指示是否存在模型拟合不佳的特定时间或解释变量的值。由于偏差残差比鞅残差的分布更对称，因此基于这些残差的图形往往更容易解释。因此，偏差残差的索引图也可用于识别生存时间拟合不佳的个体。在拟合的 Cox 回归模型中，第 \\(\\) 个个体在任何时间的死亡风险通过函数 \\(\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i)\\) 取决于该个体的解释变量 \\(\\boldsymbol x_i\\) 的值。这意味着 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 具有较小负值的个体的死亡风险低于平均值，具有较大正值的个体的风险高于平均值。量 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 是第 3 章 3.1 节中介绍的风险评分，提供了关于个体是否可能生存较短时间或较长时间的信息。通过协调生存时间与其风险评分值不一致的个体的信息，可以获得关于模型拟合不佳的观测特征的有用信息。在这种情况下，绘制偏差残差关于风险评分的图形是一种特别有用的诊断方法。示例 4.3  (透析患者的感染) 再次考虑肾病患者感染时间的数据。从表 4.2 中给出的鞅和偏差残差值中，我们看到患者 2 具有最大的正残差，这表明该患者移除导管的时间比基于拟合模型的预期更短。该表还显示，这两种类型的残差对观测的排序不相同。例如，患者 12 有第二小的负鞅残差，而患者 6 有第二小的负偏差残差。然而，正如本示例所示，具有最极端鞅残差和偏差残差的观测往往是相同的。图 4.2 展示了鞅残差和偏差残差的索引图。\n这些图非常相似，但偏差残差的分布更加对称。这些图还显示，没有患者的残差绝对值异常地大。图 4.3 给出了偏差残差与风险评分的关系图，这些风险评分根据 \\(0.030Age_i-2.711Sex_i\\) 计算得出，其中 \\(= 1, 2,..., 13\\)。\n该图显示偏差残差最大的患者风险评分较低。这表明这些患者早期拔除导管的风险相对较低，但拔除时间比预期的要早。","code":""},{"path":"chap4.html","id":"sec4-2-3","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.2.3 检查协变量的函数形式","text":"尽管第 3 章中描述的基于模型的生存数据分析方法确定了风险函数所依赖的一组特定协变量，但检查这些变量是否采用了正确的函数形式非常重要。通过使用变量的变换值而不是原始值，可能会很好地改善模型的拟合。例如，通过使用个体基线年龄的非线性函数或血清胆红素等生化变量的对数，可能会得到拟合效果更好的模型。类似地，有的解释变量（如血清胆固醇水平）只有超过某个阈值时才开始对生存产生影响，在此之后，死亡风险可能会随着该变量的值的增加而增加。评估模型充分性的一种直接方法基于零模型（即不包含协变量的模型）的鞅残差。然后绘制这些残差关于模型中每个协变量值的图形。Therneau, Grambsch Fleming (1990) 已经证明，该图形应该显示协变量所需的函数形式。具体来说，直线图表明需要线性项。作为该方法的扩展，如果可以假设某些协变量的函数形式是已知的，则可以从仅包含这些协变量的 Cox 回归模型中计算鞅残差。然后，绘制得到的鞅残差关于需要确定其函数形式的协变量的图形。以这种方式获得的图形通常相当“嘈杂” (noisy)，通过叠加为散点拟合的平滑曲线，将有助于其解释。有许多常用的平滑器 (smoothers)，包括平滑样条 (smoothing splines). 然而，使用最广泛的平滑器是局部加权散点平滑 (locally weighted scatterplot smoothing, LOWESS) 和局部估计散点平滑 (locally estimated scatterplot smoothing, LOESS)法，它们由 Cleveland (1979) 引入并在许多软件包中都有实现。即使使用了平滑器，在图形中观察到非线性模式时，也很难分辨出特定的函数形式。如果提出了特定的变换，比如对数变换，可以对协变量进行这样的变换，并绘制零模型的鞅残差关于变换变量的图形。如果出现一条直线，则可以确认这就是适当的变换。示例 4.4  (透析患者的感染) 在此示例中，我们说明了如何使用鞅残差来评估年龄效应在示例 4.1 数据的 Cox 回归模型中是否呈线性。首先，获得零模型的鞅残差，并绘制残差关于患者年龄相应值的图形，如图 4.4 所示。关于该图形，数据太少以至于不能多做评价，但平滑曲线表明，对于年龄，除了作为线性项，没有其他合适的选择。事实上，年龄效应并不显著，因此平滑曲线大致呈水平状也就不足为奇了。以另一个示例结束本节。示例 4.5  (多发性骨髓瘤患者的生存率) 在本例中，我们回到示例 1.3 中描述的 48 例多发性骨髓瘤患者的生存时间数据。示例 3.5 已发现，包含解释变量 Hb （血清血红蛋白）和 Bun （血尿素氮）的 Cox 回归模型是适用于该风险函数的模型。我们现在对残差进行分析，以研究该拟合模型的充分性。首先，Cox-Snell 残差的累积风险图如图 4.5 所示。由该图中绘制的点所形成的线相当直，具有单位斜率和零截距。根据该图，没有理由怀疑拟合模型的充分性。然而，如 4.2.1 节所述，该图对拟合模型的偏差不是很敏感。\n为进一步评估模型的拟合，绘制偏差残差关于其相应的风险评分的图形，如图 4.6 所示。该图显示患者 41 和 38 具有最大的偏差残差值，但这些值与其他一些患者的残差值相差不大。具有三个最大风险评分的患者的残差接近于零，这表明这些观测与模型非常吻合。同样，没有理由怀疑拟合模型的有效性。\n为研究变量 Hb 和 Bun 是否使用了正确的函数形式，计算了零模型的鞅残差，并绘制其关于这些变量值的图形。如图 4.7 和 4.8 所示，其中叠加了平滑曲线以帮助解释。这些图证实了模型中需要这两个变量的线性项。请注意，图 4.7 中 Hb 图形的斜率为负，对应于拟合模型中 Hb 的负系数，而图 4.8 中 Bun 图形的斜率为正。\n在该数据集中，Bun 的值在 6 到 172 之间，其值在 48 名受试者中呈正偏态分布。为了防止该变量的极值对 Bun 系数产生不当影响，在建模过程中可能会使用该变量的对数。尽管图 4.8 中没有提出该建议，但出于说明目的，我们将使用此类图形来研究包含 log Bun 而不是 Bun 的模型是否可以接受。图 4.9 显示了零模型鞅残差关于 log Bun 值的图形。\n该图的平滑曲线确实表明，使用 log Bun 的线性项是不合适的。事实上，如果决定在模型中使用 log Bun，图 4.9 表明可能需要 log Bun 的二次项。事实上，将此二次项添加到包含 Hb 和 log Bun 的模型中会导致 \\(-2\\operatorname{log}\\hat{L}\\) 的值显著减小，但此统计量的结果值 201.458 仅略小于包含 Hb 和 Bun 的模型的相应值 (202.938). 本分析证实，模型应包含与血红蛋白和血尿素氮水平相应变量的线性项。","code":""},{"path":"chap4.html","id":"sec4-3","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.3 识别有影响的观测","text":"在评估模型充分性时，重要的是确定任何特定观察是否会对拟合模型所做的推断产生不当影响。对基于模型的推断确实有影响 (effect) 的观测被认为是有影响的 (influential).作为一个例子，考虑一项生存研究，其中将新疗法与标准疗法进行比较。在这样的比较中，重要的是确定新疗法的死亡风险相对于标准疗法的死亡风险是否受到任何个体的显著影响。具体来说，当某个个体的数据从数据集中删除时，相对风险可能会大幅增加或减少。如果发生这种情况，来自该个体的数据将需要接受特别的审查。生存分析得出的结论通常是对相对风险和中位生存时间等量的估计来确定的，这取决于拟合的 Cox 回归模型中 \\(\\boldsymbol \\beta\\) 参数的估计。因此，检查每个观测对这些估计的影响特别重要。我们可以通过依次省略研究中每个个体的数据记录来检查拟合模型中的估计参数受影响的程度来做到这一点。在某些情况下，参数子集的估计可能具有特殊重要性，例如与治疗效应相关的参数。那么关于影响的研究可能仅限于这些参数。在许多情况下，每个观测对风险函数估计的影响都是令人感兴趣的，因此，识别出对模型完整参数估计集产生影响的观测就显得尤为重要。以下各节将讨论这两个方面的影响。与分析其他类型数据时使用的模型（例如一般线性模型）相比，从一组生存数据中删除一个观察的影响并不容易研究。这主要是因为 Cox 回归模型的对数似然函数不能表示为一系列项的和，其中每项是每个观测对对数似然函数的贡献。相反，删除一个观测会影响风险集中以 \\(\\exp(\\boldsymbol{\\beta'x})\\) 形式进行求和的量。这意味着影响诊断非常难以推导，因此本章以下各节仅给出相关结果。本章最后一节包含与这些推导相关的文献。","code":""},{"path":"chap4.html","id":"sec4-3-1","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.3.1 观测对单个参数估计的影响","text":"假设我们想要确定在拟合的 Cox 回归模型中，是否有任何特定的观测对第 \\(j(j=1,2,\\ldots,p)\\) 个参数估计 \\(\\hat{\\beta}_j\\) 产生不利影响。一种方法是使用数据集中的所有 \\(n\\) 个观测来拟合模型，然后依次省略每个观测来拟合相同的模型。然后可以确定省略每个观测对参数估计的实际影响。该程序计算成本很高，除非观测数量不大，因此我们使用一种近似方法来计算当省略第 \\(\\) 个观测时 \\(\\hat{\\beta}_j\\) 的变化量，其中 \\(=1,2,\\ldots,n\\)。假设省略第 \\(\\) 个观测时第 \\(j\\) 个参数估计值为 \\(\\hat{\\beta}_{{j}()}\\)。Cain Lange (1984) 表明，\\(\\hat{\\beta}_{{j}}-\\hat{\\beta}_{{j}(\\boldsymbol{})}\\) 的近似值基于得分残差（在 4.1.6 节中描述）。设 \\(\\boldsymbol{r}_{U{}}\\) 表示第 \\(\\) 个观测的得分残差向量，因此 \\(\\boldsymbol{r}_{Ui}^{\\prime}=(r_{U1i},r_{U2i},\\ldots,r_{Upi})\\)，其中 \\(r_{Uji},j=1,2,\\ldots,p\\) 为第 \\(j\\) 个解释变量的第 \\(\\) 个得分残差，由式 (4.13) 给出。\\(\\hat{\\beta}_j-\\hat{\\beta}_{j()}\\) 的近似，即省略第 \\(\\) 个观测时 \\(\\hat{\\beta}_j\\) 的变化，为如下向量的第 \\(j\\) 个分量\\[\\boldsymbol{r}_{U{}}^{\\prime}\\operatorname{var}\\left(\\hat{\\boldsymbol{\\beta}}\\right)\\]\\(\\operatorname{var}\\left(\\hat{\\boldsymbol{\\beta}}\\right)\\) 为拟合的 Cox 模型参数估计向量的方差-协方差阵。该向量第 \\(j\\) 个元素称为 delta-beta，记作 \\(\\Delta_i\\hat{\\beta}_j\\)，因此 \\(\\Delta_{}\\hat{\\beta}_{j}\\approx\\hat{\\beta}_{j}-\\hat{\\beta}_{j()}\\)。使用这种近似意味着可以在为完整数据集拟合模型后，根据可用的量 (quantities available) 来计算 \\(\\Delta_i\\hat{\\beta}_j\\) 的值。影响特定参数估计的观测，例如第 \\(j\\) 个观测，将具有这样的特性：该观测的 \\(\\Delta_i\\hat{\\beta}_j\\) 值（即这些观测的 delta-betas）的绝对值比数据集中其他观测相应的绝对值更大。那么，模型中每个解释变量的 delta-betas 的索引图将揭示是否有观测对任何特定解释变量的参数估计产生不当影响。此外，将 \\(\\Delta_i\\hat{\\beta}_j\\) 的值关于生存时间的秩次作图，可以获取生存时间与影响之间关系的信息。可以将 delta-betas 标准化，即将 \\(\\Delta_i\\hat{\\beta}_j\\) 除以 \\(\\hat{\\beta}_j\\) 的标准误，得到标准化 (standardized) delta-beta。标准化 delta-beta 可以解释为在省略第 \\(\\) 个观测后，统计量 \\(\\hat{\\beta}/\\text{ se }(\\hat{\\beta})\\) 值的变化。由于该统计量可用于评估某个参数的值是否显著不同于零（参见第 3 章 3.4 节），因此标准化 delta-beta 可用于提供：从数据集中删除第 \\(\\) 个观测如何影响参数估计的显著性的信息。同样，索引图是展示标准化 delta-betas 最有用的方式。统计量 \\(\\Delta_i\\hat{\\beta}_j\\) 是省略第 \\(\\) 个观测后参数估计实际变化的近似值。这种近似通常是足够的，因为对参数估计有影响的观测将被突出显示。然而，省略任何特定观测对基于模型的推断的实际影响仍需进一步研究。特定情况下实际 delta-betas 与近似 delta-betas 之间的一致性在示例 4.6 中加以说明。示例 4.6  (透析患者的感染) 在本例中，我们再次回到透析后感染时间的数据。为了研究 13 例患者的数据对拟合的 Cox 回归模型线性部分中变量 Age 和 Sex 的系数估计的影响，得到了近似的未标准化的 \\(\\Delta_{}\\hat{\\beta}_{1}\\) 和 \\(\\Delta_{}\\hat{\\beta}_{2}\\)，如表 4.4 所示。\n对于 Age，最大的 delta-beta 出现在 13 号患者身上，但也有其他相近的 delta-betas 值。省略该患者数据后参数估计的实际变化为 0.0195，因此相对于基线风险省略该观测降低了感染风险。在整个数据集中，Age 参数估计的标准误为 0.026，因此，当删除一个观测时，该估计的最大变化量约为标准误的四分之三。当省略患者 13 的数据时，Age 效应变得不那么显著，但这种差异不太可能具有实际重要性。对于 Sex，有两个较大的 delta-beta，它们非常接近，对应于来自患者 2 和 4 的观测。当依次省略每个观测时，参数估计的实际变化分别为 0.820 和 0.818，因此近似的 delta-betas 低估了实际变化。完整数据集中的 Sex 估计系数的标准误为 1.096，因此删除观测时估计的变化也小于一个标准误。删除这两个观测中的任何一个都会增加男性相对于女性的风险，从而性别效应的显著性略有增加。近似的 delta-betas 可以与实际值进行比较。在本例中，虽然参数估计 的实际变化有被近似值低估的趋势，但总体而言一致性相当好。实际值和近似值之间的最大差异，对于 Age 为 0.010，这出现在 9 号患者身上；对于 Sex 为 0.276，这出现在 2 号患者身上。这些差异大约是每个参数估计的标准误的四分之一。","code":""},{"path":"chap4.html","id":"sec4-3-2","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.3.2 观测对参数估计集的影响","text":"拟合模型的结构可能对数据集中的一个或多个观测特别敏感。可以使用诊断来检测此类观察结果，该诊断旨在突出显示影响风险评分中完整参数估计集的观测。因此，这些诊断反映了个体观测对风险评分的影响，并提供了 delta-beta 所提供信息之外的信息。具体来说，从数据集中删除给定观测可能不会对任何特定参数估计产生很大影响，因此不会从 delta-beta 统计量的研究中揭示出来。然而，参数估计集的变化可能会导致风险函数估计的形式或基于拟合模型的总结统计量在删除该观测时发生显著变化。用于评估观测对参数估计集影响的统计还具有一个优势：每个观测都有一个诊断值。这使得它们比 delta-betas 等诊断更容易使用。已经提出了许多用于评估每个观测对参数估计集影响的诊断方法。本节将描述其中两个，但本章的结论部分将提供其他的参考文献。评估每个观测对模型整体拟合影响的一种方法为：当依次忽略每个观测时，检查在拟合的模型中 \\(-2\\operatorname{log}\\hat{L}\\) （负二倍最大偏对数似然）的变化量。将为所有 \\(n\\) 个观测拟合的模型的最大对数似然值记作 \\(\\log L(\\hat{\\boldsymbol{\\beta}})\\)，当在从拟合中省略第 \\(\\) 个观测后计算参数估计时，\\(n\\) 个观测的最大对数似然值记作 \\(\\log L(\\hat{\\boldsymbol{\\beta}}_{()})\\)。诊断 (diagnostic)\\[2\\left\\{\\log L(\\hat{\\boldsymbol{\\beta}})-\\log L(\\hat{\\boldsymbol{\\beta}}_{()})\\right\\}\\]可用于影响研究。Pettitt Bin Daud (1989) 表明该似然位移 (likelihood displacement) 的近似为\\[\\begin{align}\nLD_{{}}=\\boldsymbol{r}'_{U{}}\\operatorname{var}\\left(\\hat{\\boldsymbol{\\beta}}\\right){\\boldsymbol r}_{U{}}\n\\tag{4.15}\n\\end{align}\\]其中 \\({\\boldsymbol r}_{U{}}\\) 是第 \\(\\) 个观测的得分残差的 \\(p×1\\) 向量，\\(=1,2,\\ldots,n\\)，其第 \\(j\\) 个分量在式 (4.13) 中给出，并且 \\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\) 是参数估计向量 \\(\\hat{\\boldsymbol{\\beta}}\\) 的方差-协方差阵。因此，该统计量的值可以直接从用于计算模型中每个解释变量的 delta-betas 的项中获得。索引图，或似然位移关于生存时间的秩次的图形，提供了诊断值的直观总结。诊断值相对较大的观测是有影响的。但其关于解释变量的图形不推荐使用，因为正如 Pettitt Bin Daud (1989) 所证明的那样，即使拟合模型正确，这些图形也可能具有确定的模式。另一个可用于评估每个观测对参数估计集的影响的诊断基于 \\(n × n\\) 对称矩阵\\[\\begin{align}\n\\boldsymbol{B}=\\boldsymbol{U}\\mathrm{~var~}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{U}'\n\\tag{4.16}\n\\end{align}\\]其中 \\(\\boldsymbol{U}\\) 是得分残差的 \\(n×p\\) 矩阵，行由 \\(\\boldsymbol{r}_{U{}}^{\\prime}\\) 组成，\\(= 1,2,\\ldots,n\\)。\n因此，\\(\\boldsymbol B\\) 的对角元为 \\(LD_{}\\)。根据线性代数的论证，与矩阵 \\(\\boldsymbol{B}\\) 最大特征值相关的 \\(n×1\\) 维特征向量的元素绝对值，在通过将每个分量除以该特征向量所有分量平方和的平方根，从而将该向量标准化为单位长度后，可以度量模型对数据集中 \\(n\\) 个观测拟合的敏感度。将该特征向量记作 \\(\\boldsymbol{l}_{\\mathrm{max}}\\)，其第 \\(\\)个元素即为第 \\(\\) 个观测对参数估计集影响的度量。该诊断的符号无关紧要，因此一般建议使用基于其绝对值 \\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 的图形。将 \\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 的第 \\(\\) 个元素表示为 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\)，其中 \\(= 1, 2,...,n\\)，这些值的索引图、关于生存时间的秩次的图形以及关于模型中的解释变量的图形，都可用于影响的评估。标准化为单位长度意味着值 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 的平方和必为 1.0. 特征向量元素的平方在平方和总和 (1) 中占很大比例的观测将是最具影响力的观测。因此，该特征向量的较大元素将对应于对似然函数值影响最大的观测。最后要注意的一点是，与其他诊断不同，如果拟合模型正确，\\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 值关于解释变量的图形将不会具有确定的模式。这意味着 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 关于解释变量的图形可用于评估是否存在模型不能很好拟合的变量值的特定范围。示例 4.7  (透析患者的感染) 示例 4.1 中首次给出的数据将用于阐明诊断的使用，该诊断旨在揭示影响参数估计集的观测。表 4.5 给出了近似似然位移（依据式 (4.15)）以及 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 的值。\n对最大对数似然函数值影响最大的观测对应于患者 2 和患者 4. 对于患者 13，似然位移诊断值也相当大。这意味着从数据集中删除这三个患者中的任何一个，参数估计集都会受到最大影响。\\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 的第四个元素 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_4\\)，其绝对值是最大的，也表明省略 4 号患者的数据对参数估计集具有最大的影响。与患者 2 和 13 对应的元素相比其他观测也较大，这表明这些患者的数据也有影响。\\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 第 2, 4 和 13 个元素的平方和为 0.70，而元素平方和的总和为 1.00，因此患者 2, 4 和 13 占 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 变异的近四分之三。注意，对示例 4.6 中的 delta-betas 的分析表明，患者 2 和 4 的观测对 Sex 的参数估计影响最大，而患者 13 的观测则对 Age 的参数估计影响更大。总之，患者 2, 4 和 13 的观测对风险函数的形式影响最大。依次省略其一，可以得到风险函数中线性部分的估计：省略患者 2： \\(0.031Age_{{}}-3.530Sex_{{}}\\)省略患者 4： \\(0.045Age_{{}}-3.529Sex_{{}}\\)省略患者 13：\\(0.011Age_{{}}-2.234Sex_{{}}\\)作为比较，整个数据集的线性部分为\\[\\begin{aligned}0.030Age_i-2.711Sex_i\\end{aligned}\\]为了说明风险比估计的变化幅度，请考虑 50 岁患者相对于 40 岁患者在时间 \\(t\\) 感染的相对风险。对于完整数据集，这是 \\(e^{0.304} = 1.355\\)。当省略患者 2 和 4 时，该值分别增加为 1.365 和 1.564；当省略患者 13 时，该值减小为 1.114. 因此，从数据集中删除这些患者对风险函数的影响并不特别明显。同理，在完整数据集中，男性患者 (Sex = 1) 相对于女性患者 (Sex = 2) 在时间 \\(t\\) 感染的风险为 \\(e^{2.711}\\)，即 15.041. 当依次省略观测 2, 4 和 13 时，男性相对于女性的风险比分别为 34.138, 34.097 和 9.334. 省略这三名患者中任何一个的数据都会对风险比估计产生很大影响。然而，在解释这一结果时需要谨慎。由于数据集中的男性非常少，风险比估计是不精确的。事实上，当省略患者 13 的数据时，风险比的 95% 置信区间为 0.012 到 82.96!","code":""},{"path":"chap4.html","id":"sec4-3-3","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.3.3 有影响观测的处理","text":"若发现观测有强影响，很难就应该如何处理这些观测提供任何坚定的建议。这很大程度上取决于研究的科学背景。如果可能，应检查有影响观测的来源。转录和记录分类数据和数值数据时经常出现错误。如果发现任何错误，则需要更正数据并重复分析。如果发现生存时间或其他解释变量的观测不切实际，并且无法校正，则在重新分析之前应从数据集中删除相应的观测。在许多情况下，无法确认与有影响的观测对应的数据是否有效。当然，在这种情况下，不应直接删除有影响的观测。最恰当的做法是确定这些观测对分析得出的推断产生的实际影响。例如，如果使用中位生存时间来总结生存数据，或者使用相对风险来总结治疗效应，那么可以对比包含和不包含有影响观测的这些统计量的值。如果结果之间的差异小到没有实际意义，则可以保留存疑的观测。相反，如果删除有影响观测的影响大到具有实际意义，则需要报告基于完整数据集和简化数据集的分析结果。随后，与参与研究的科学家进行协商，其结果将是决定未来行动方向的关键要素。示例 4.8  (多发性骨髓瘤患者的生存率) 现在研究个体观测对为示例 1.3 的数据拟合的 Cox 回归模型参数估计的影响。图 4.10 和 4.11 显示了 Hb 和 Bun 的近似非标准化 delta-betas 关于生存时间的秩次的图形。\n根据图 4.10，没有一个观测的 Hb 的 delta-beta 与其他观测不同。然而，图 4.11 显示，生存时间最短的两个观测的 Bun 的 delta-beta 与其他观测差别较大。他们对应于患者 32 和 38 （在表 1.3 中给出的数据中）。 患者 32 的生存时间仅为一个月，具有 Bun 的第二大值。从数据集中删除此观测会降低 Bun 的参数估计。患者 38 在进入试验后也只生存了一个月，但 Bun 值对于生存这么短时间的其他患者来说相当低。如果省略该患者数据，则模型中 Bun 的系数会增加。为了确定影响参数估计集的观测，图 4.12 显示了诊断 \\(\\boldsymbol{l}_{\\mathrm{max}}\\) 的元素的绝对值关于生存时间秩次的图形。\n具有最大 \\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 的观测对应于患者 13. 对于一个生存了 65 个月之久的患者来说，该患者的 Hb 值异常低，Bun 值有点高。如果从数据集中省略该观测，Bun 的系数保持不变，但 Hb 的系数从 −0.134 减小为 −0.157. Hb 对死亡风险的影响更显著一点。但总之，患者 13 的记录对风险函数估计的形式几乎没有影响。","code":""},{"path":"chap4.html","id":"sec4-4","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.4 检验比例风险假设","text":"到目前为止，本章我们主要讨论如何检查生存模型线性部分的充分性。使用 Cox 回归模型时做出的一个关键假设是比例风险。如果风险比与时间无关，则称风险是成比例的。如果模型中存在一个或多个解释变量的系数随时间变化，或者存在时依解释变量，则将违反比例风险假设。因此，在考虑到已知或预期独立于时间的解释变量的影响后，我们需要可用于检测特定协变量是否存在某种形式的时依性的技术。本节首先描述了一个可在模型拟合之前使用的直观图形，然后描述了如何使用从拟合模型导出的诊断和检验统计量来考察比例风险假设。","code":""},{"path":"chap4.html","id":"sec4-4-1","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.4.1 对数累积风险图","text":"在 Cox 回归模型中，第 \\(\\) 个个体在任何时间 \\(t\\) 的死亡风险由下式给出\\[\\begin{align}\nh_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\n\\tag{4.17}\n\\end{align}\\]其中，\\(\\boldsymbol x_i\\) 是该个体解释变量的值向量，\\(\\boldsymbol \\beta\\) 是相应的系数向量，\\(h_0(t)\\) 是基线风险函数。将该式两边关于 \\(t\\) 积分得到\\[\\begin{aligned}\\int_0^th_i(u)\\mathrm{d}u&=\\exp(\\boldsymbol{\\beta'x}_i)\\int_0^th_0(u)\\mathrm{d}u\\end{aligned}\\]因此，使用式 (1.7)\\[\\begin{aligned}H_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)H_0(t)\\end{aligned}\\]其中 \\(H_i(t),H_0(t)\\) 为累积风险函数。对上式两边取对数\\[\\begin{aligned}\\log H_{{}}(t)=\\boldsymbol{\\beta'x}_{\\boldsymbol{}}+\\log H_{0}(t)\\end{aligned}\\]由此可知，对数累积风险函数的差异不取决于时间。这意味着，如果绘制具有不同解释变量值的个体的对数累积风险函数关于时间的图形，则如果式 (4.17) 中的比例风险模型有效，则该曲线将是平行的。这为评估比例风险假设的有效性提供了广泛使用的诊断基础。事实证明，在参数建模中，将对数累积风险函数关于 \\(t\\) 的对数而不是 \\(t\\) 本身进行绘图是一种有用的诊断，因此通常使用这种形式的图形；有关使用该对数累积风险图形的更多详细信息，请参见第 5 章 5.2 节。要使用此图，首先根据一个或多个因素的水平对生存数据进行分组。如果要在此分析中使用连续变量，则首先需要以某种方式对它们的值进行分组以得到分类变量。然后获得每组数据的生存函数的 Kaplan-Meier 估计。对数累积风险图，即对数累积风险函数估计关于对数生存时间的图形，如果不同组之间的风险成比例，则将产生平行曲线。该方法信息丰富。并且当因素数量较少且每个水平上的观测数量合理时易于操作。然而，对于晚期生存时间，图形基于较少观测数据，而在结构更复杂的数据集中，需要采用不同的方法。示例 4.9  (多发性骨髓瘤患者的生存率) 我们再次使用 48 名多发性骨髓瘤患者的生存时间数据来说明对数累积风险图。具体来说，我们将研究变量 Hb （血清血红蛋白）的比例风险假设是否有效。因为这是一个连续变量，我们首先需要对 Hb 的值进行分类。这将以与第 3 章示例 3.8 中相同的方式完成，其中用 Hb 值定义四个组，\\(Hb\\leqslant7,7<Hb\\leqslant10,10<Hb\\leqslant13\\) 以及 \\(Hb>13\\)。然后根据患者的血清血红蛋白水平对患者进行分组，并获得四组患者的生存函数的 Kaplan-Meier 估计。根据该估计，使用第 1 章式 (1.8) 中的关系式 \\(\\tilde{\\hat{H}}(t)=-\\operatorname{log}\\hat{S}(t)\\) 得到对数累积风险估计，并关于 \\(\\log t\\) 绘制图形。由此产生的对数累积风险图如图 4.13 所示。\n该图表明 \\(Hb\\leqslant7,7<Hb\\leqslant10\\) 和 \\(Hb>13\\) 的图大致平行。\\(10 < Hb \\leqslant 13\\) 的图与其他图不一致，但这种印象是由该组患者中生存时间最长的患者相对较大的累积风险估计造成的。该图没有考虑另一个变量 Bun 的值，第三组 Hb 中个体的生存时间可能受到其 Bun 值的影响。总体而言，几乎没有理由怀疑比例风险假设。","code":""},{"path":"chap4.html","id":"sec4-4-2","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.4.2 使用 Schoenfeld 残差","text":"4.1.5 节中定义的 Schoenfeld 残差在拟合 Cox 回归模型后评估比例风险假设时特别有用。Grambsch Therneau (1994) 表明，模型中第 \\(j(j=1,2,\\ldots,p)\\) 个解释变量第 \\((=1,2,\\ldots,n)\\) 个缩放 Schoenfeld 残差 \\(r_{Sji}^{*}\\) 的期望，为\\[\\begin{align}\n\\operatorname{E}\\left(r_{Sji}^*\\right)\\approx\\beta_j(t_i)-\\hat{\\beta}_j\n\\tag{4.18}\n\\end{align}\\]其中 \\(\\beta_j(t)\\) 为 \\(X_j\\) 的时变 (time-varying) 系数，\\(\\beta_j(t_i)\\) 为该系数在第 \\(\\) 个个体生存时间 \\(t_i\\) 的值，\\(\\hat{\\beta}_j\\) 为拟合的 Cox 回归模型中 \\({\\beta}_j\\) 的估计。请注意，这些残差仅在事件时间有定义。式 (4.18) 表明 \\(r_{S{j}}^{*}+\\hat{\\beta}_{j}\\) 的值（或等价的缩放 Schoenfeld 残差 \\(r_{Sji}^{*}\\)）关于观测生存时间的图形应该给出有关 \\(X_j\\) 时依系数 \\(\\beta_j(t)\\) 的形式的信息。特别的，水平线表明 \\(X_j\\) 的系数是常数，并且满足比例风险假设。可以在该图上叠加一条平滑曲线以帮助解释，如 4.2.3 节所述的鞅残差关于解释变量值的图形。示例 4.10  (透析患者的感染) 示例 4.1 中首次给出的透析患者导管拔除时间的数据现在用于说明缩放 Schoenfeld 残差在评估非比例风险中的用途。表 4.2 给出了变量 Age 和 Sex 的缩放 Schoenfeld 残差，将这些值关于拔除时间作图得出图形 4.14. 平滑曲线与水平线的偏差很小，在这两张图中都没有任何非比例风险的迹象。","code":""},{"path":"chap4.html","id":"sec4-4-3","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.4.3 非比例风险的检验","text":"4.4.2 节中描述的评估比例风险假设的图形方法可得到正式的检验程序。根据式 (4.18) 给出的结果，对于第 \\(j(j=1,2,\\ldots,p)\\) 个解释变量 \\(X_j\\)，第 \\((=1,2,\\ldots,n)\\) 个缩放 Schoenfeld 残差的期望值取决于 \\(\\beta_{j}(t_{{}})\\)，即 \\(X_j\\) 的时变系数在时间 \\(t_i\\) 处的值。那么，比例风险假设的检验可基于 \\(\\operatorname{E}\\left(r_{Sji}^*\\right)\\) 与某时间函数之间是否存在线性关系的检验。如果有证据表明 \\(\\operatorname{E}\\left(r_{Sji}^*\\right)\\) 是时依的，则将拒绝比例风险假设。对于特定的解释变量 \\(X_j\\)，\\(X_j\\) 的系数对时间的线性依赖性可以通过取 \\(\\beta_j(t_i)=\\beta_j+\\nu_j(t_i-\\bar{t})\\) 来表示，其中 \\(\\nu_j\\) 是未知的回归系数。这得到了一个线性回归模型，其中 \\(\\operatorname{E}(r_{Sji}^*)=\\nu_j(t_i-\\bar{t})\\)，关于斜率 \\(\\nu_j\\) 是否为零的检验将得到关于 \\(X_j\\) 的系数是否时依的检验，因此得到风险是否关于 \\(X_j\\) 成比例的检验。令 \\(\\tau_i,\\tau_2,\\ldots,\\tau_d\\) 为数据集中所有 \\(n\\) 个个体观察到的 \\(d\\) 个死亡时间，Grambsch Therneau (1994) 表明，适当的检验统计量为\\[\\begin{align}\n\\frac{\\{\\sum_{=1}^d(\\tau_i-\\bar{\\tau})r_{Sji}^*\\}^2}{d\\operatorname{var}(\\hat{\\beta_j})\\sum_{=1}^d(\\tau_i-\\bar{\\tau})^2}\n\\tag{4.19}\n\\end{align}\\]其中 \\(\\bar{\\tau}=d^{-1}\\sum_{=1}^d\\tau_i\\) 是观测死亡时间的样本均值。在斜率为零的原假设下，该统计量服从自由度为一的卡方分布，并且式 (4.19) 的显著的大值将拒绝第 \\(j\\) 个解释变量的比例风险假设。通过聚合式 (4.19) 中的各个检验统计量，可以获得 Cox 回归模型中包含的所有 p 个解释变量的比例风险假设的总体或全局 (overall global) 检验。统计量\\[\\begin{align}\n\\frac{(\\boldsymbol{\\tau}-\\bar{\\tau})^{\\prime}\\boldsymbol{S}\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{S'}(\\boldsymbol{\\tau}-\\bar{\\tau})}{\\sum_{=1}^d(\\tau_i-\\bar{\\tau})^2/d}\n\\tag{4.20}\n\\end{align}\\]其中 \\(\\boldsymbol{\\tau}=(\\tau_1,\\tau_2,\\ldots,\\tau_d)'\\) 是由 \\(d\\) 个事件时间形成的向量，\\(\\boldsymbol S\\) 为 \\(d × p\\) 矩阵，其列是第 \\(j\\) 个解释变量的（未缩放）Schoenfeld 残差，即 \\(\\boldsymbol S\\) 的第 \\(j\\) 列为 \\((r_{Sj1},r_{Sj2},\\ldots,r_{Sjd})'\\)，\\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\) 为拟合的 Cox 回归模型中解释变量系数估计的方差-协方差阵。式 (4.20) 中的检验统计量，在所有 \\(p\\) 个解释变量的比例风险假设为真时，服从自由度为 \\(p\\) 的卡方分布。该检验称为比例风险的 Grambsch Therneau 检验，有时更神秘地称为 zph 检验。式 (4.19) 和 (4.20) 中的检验统计量可以通过用死亡时间 \\(\\tau_i(=1,2,\\ldots,d)\\) 的变换值替换以适应其他时间尺度。例如，使用死亡时间的对数，而不是时间本身，将允许在对数尺度上评估 \\(X_j\\) 系数的线性度。\\(\\tau_i\\) 也可以用死亡时间的秩次或在每个事件时间下生存函数的 Kaplan-Meier 估计来代替。4.4.2 节中讨论的缩放 Schoenfeld 残差关于时间的图形可能表明这些选项中哪一个是最合适的。示例 4.11  (透析患者的感染) 我们现在使用透析患者导管移除时间的数据来说明比例风险检验。在拟合的 Cox 回归模型中，变量 Age 和 Sex 的系数估计的方差分别为 0.000688 和 1.20099，12 个事件时间的平方和为 393418.92，式 (4.19) 的分子由表 4.2 中的缩放 Schoenfeld 残差计算得出。Age 和 Sex 的检验统计量分别为 0.811 (\\(P=0.368\\)) 和 0.224 (\\(P=0.636\\)). 在这两种情况下，都没有证据反对比例风险假设，正如示例 4.10 中的图形分析所预期的那样。需要进行矩阵乘法才能获得式 (4.20) 中比例风险全局检验的分子，这得到 26578.805，由此 Grambsch Therneau 检验统计量为 0.811，服从自由度为二的卡方分布。\\(P\\) 值为 0.667. 同样，没有理由怀疑比例风险假设的有效性。","code":""},{"path":"chap4.html","id":"sec4-4-4","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.4.4 添加时依变量","text":"可以通过向 Cox 回归模型添加时依变量来研究偏离比例风险的具体形式。第 8 章给出了在生存数据建模中使用时依变量的完整细节，但在本节中，该程序是在特定的背景中描述的。考虑一项生存研究，将患者分配为两组，对应于标准疗法和新疗法。那么，人们的兴趣可能集中在一个治疗组在时间 \\(t\\) 时的死亡风险相对于另一组的比是否独立于生存时间。那么，研究中第 \\(\\) 个个体的风险函数的比例风险模型是\\[\\begin{align}\nh_{\\boldsymbol{}}(t)=\\exp(\\beta_{1}x_{1{}})h_{{0}}(t)\n\\tag{4.21}\n\\end{align}\\]其中 \\(x_{1i}\\) 是指示变量 \\(X_1\\) 的值，该值对于标准疗法为 0 而对于新疗法为 1. 相对于标准疗法，接受新疗法的患者在任何时候的相对死亡风险为 \\(e^{\\beta _1}\\)，与生存时间无关。现在定义一个时依解释变量 \\(X_2\\)，其中 \\(X_2=X_1t\\). 如果将该变量添加到式 (4.21) 中的模型中，则第 \\(\\) 个个体在时间 \\(t\\) 的死亡风险变为\\[\\begin{align}\nh_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i})h_0(t)\n\\tag{4.22}\n\\end{align}\\]其中 \\(x_{2{}}=x_{1{}}t\\) 为个体 \\(\\) 的 \\(X_1t\\) 的值。因为在新疗法下 \\(X_2=t\\) 而在标准疗法下 \\(X_2=0\\)，则时间 \\(t\\) 处的相对风险现在为\\[\\begin{align}\n\\exp(\\beta_1+\\beta_2t)\n\\tag{4.23}\n\\end{align}\\]该风险比取决于 \\(t\\)，并且式 (4.22) 中的模型不再是比例风险模型。具体来说，如果 \\(\\beta_2<0\\)，相对风险会随着时间的推移而降低。这意味着，相对于标准疗法，新疗法的死亡风险会随着时间的推移而降低。如果 \\(\\beta_1<0\\)，随着时间的推移，新疗法的优越性变得更加明显。另一方面，如果 \\(\\beta_2>0\\)，新疗法死亡的相对风险随着时间的增加而增加，反映出新疗法的死亡风险相对于标准疗法是增加的。在 \\(\\beta_2=0\\) 的特殊情况下，相对风险为恒定的 \\(e^{\\beta_1}\\)。这意味着对假设 \\(\\beta_2=0\\) 的检验是对比例风险假设的检验。这种情况如图 4.15 所示。\n为帮助计算和解释式 (4.22) 模型的参数，可根据与某个时间 \\(t_0\\) 的偏差来定义变量 \\(X_2\\)。那么，\\(\\beta_1\\) 和 \\(\\beta_2\\) 的估计往往不那么高度相关，并且最大化适当似然函数的数值算法将更加稳定。如果将 \\(X_2\\) 取为 \\(X_2=X_1(t−t_0)\\)，则对于新疗法，\\(X_2=t-t_0\\)，对于标准疗法，\\(X_2=0\\)。相对风险现在变成\\[\\begin{aligned}\\exp\\{\\beta_1+\\beta_2(t-t_0)\\}\\end{aligned}\\]在式 (4.22) 的模型中，当 \\(x_{2i}=x_{1i}(t−t-0)\\) 时，量 \\(e^{\\beta_1}\\) 是在时间 \\(t_0\\) 时，接受新疗法的个体相对于接受标准疗法的个体的死亡风险。在实际应用中，通常会对 \\(t_0\\) 的值进行选择，以便为相对风险适用的时间提供一个方便的解释。例如，将 \\(t_0\\) 取为平均或中位生存时间意味着 \\(\\exp(\\hat{\\beta}_1)\\) 是此时的相对死亡风险估计。可以使用类似的模型来检测连续变量的系数是否具有时依系数。假设 \\(X\\) 是这样一个变量，我们希望检查是否有任何证据表明 \\(X\\) 的系数与时间线性相关。为此，将项 \\(Xt\\) 添加到包含 \\(X\\) 的模型中。第 \\(\\) 个个体在时间 \\(t\\) 的死亡风险为\\[\\begin{aligned}h_i(t)=\\exp(\\beta_1x_i+\\beta_2x_it)h_0(t)\\end{aligned}\\]其中 \\(x_i\\) 是该个体的 \\(X\\) 值。\\(X = x_i + 1\\) 的个体相对于 \\(X = x_i\\) 的个体，在时间 \\(t\\) 的死亡风险为 \\(\\exp(\\beta_1+\\beta_2t)\\)，如式 (4.23) 所示。本节中考虑的时依变量具有与时间线性相关的系数。当系数是时间的非线性函数时，也可以使用类似的方法。例如，在式 (4.22) 中使用的时依变量 \\(X_2\\) 的定义中，可以使用 \\(\\log t\\) 代替 \\(t\\)。在这个模型版本中，对假设 \\(\\beta_2 = 0\\) 的检验是对比例风险的检验，其中备择假设是风险比依赖时间的对数。当生存时间的数值很大时，例如当长期研究中的生存以天为单位时，在时依变量的定义中使用 \\(\\log t\\) 也很有帮助。然后，可能存在与计算式 (4.22) 中 \\(\\exp(\\beta_2x_{2{}})\\) 的值相关的计算问题，这些问题可以通过在 \\(X_2\\) 的定义中使用 \\(\\log t\\) 代替 \\(t\\) 来解决。在包含时依变量 \\(X_2\\) 的模型的拟合中，不能将 \\(X_2\\) 以与其他解释变量相同的方式进行处理 。其原因是，该变量在不同的死亡时间具有不同的值，使得式 (3.4) 中偏似然函数分母的计算更加复杂。关于拟合过程的全部细节将推迟到第 8 章。然而，关于时依变量对风险函数影响的推断可以像其他变量一样进行评估。具体来说，可以将 \\(-2\\log\\hat{L}\\) 统计量的变化与卡方分布的百分位点进行比较，以检验变量的显著性。因此，这是对比例风险的正式检验。示例 4.12  (透析患者的感染) 现在利用示例 4.10 和 4.11 中使用的导管拔除时间数据以说明如何使用时依变量来检验比例风险假设。我们首先拟合仅包含 Age 和 Sex 的 Cox 回归模型，得到 \\(-2\\log\\hat{L}\\) 的值为 34.468. 我们现在定义这些变量与时间的乘积，即 \\(Tage=Age\\times t\\) 和 \\(Tsex=Sex\\times t\\)。然后将这些变量添加到模型中。请注意，我们不能简单地根据患者生存时间来形成这些乘积，因为模型拟合过程需要针对不同的\\(t\\) 值来计算这些值；详见第 8 章。当变量 Tage 添加到包含 Age 和 Sex 的模型中时，\\(-2\\log\\hat{L}\\) 的值减小为 32.006，但在 5% 的水平上这种减小并不显著（\\(P=0.117\\)）。当将 Tsex 添加到包含 Age 和 Sex 的模型中时，\\(-2\\log\\hat{L}\\) 的减小仅为 0.364（\\(P=0.546\\)）。这一分析证实，没有理由怀疑 Age 和 Sex 变量的比例风险假设。","code":""},{"path":"chap4.html","id":"sec4-5","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.5 建议","text":"本章介绍了各种诊断方法。哪些应作为常规使用，而哪些在需在对模型充分性进行更全面的评估时使用呢？在评估模型的整体拟合度方面，偏差残差关于风险评分的图形提供了模型未很好拟合的观测的信息，以及它们与解释变量值集的关系。该诊断通常比 Cox-Snell 残差的累积或对数累积风险图提供更多信息。残差关于生存时间、生存时间的秩次或解释变量的图形也可能有用。残差图可辅以影响诊断。当从模型中得出的推断集中于一个或两个特定参数时，这些参数的 delta-beta 统计量将是最有意义的。那么，绘制这些值关于生存时间的秩次的图形会很有用。为了研究是否有观测对参数估计集或风险评分有影响，基于 \\(\\boldsymbol{l}_{\\mathrm{max}}\\) 元素绝对值的诊断可能是最合适的。绘制这些值关于生存时间的秩次的图形将是有意义的，但关于特定解释变量的图形也可能具有启发性。可以通过对数累积风险图对比例风险假设的有效性进行初步评估。然而，基于标准化 Schoenfeld 残差的图形以及与之相关的非比例的检验更有帮助。Grambsch Therneau 检验可用于比例风险假设的总体检验。一旦确定了合适的模型，并从模型检查过程中获得了令人满意的结果，模型构建过程的最后阶段就是与主题专家一起批判性地审查模型。这可能会导致对模型的进一步修订，以确保它可作为生存数据的适当总结。","code":""},{"path":"chap4.html","id":"sec4-6","chapter":"第 4 章 Cox 回归模型的模型检查","heading":"4.6 延伸阅读","text":"Draper Smith (1998) 以及 Montgomery, Peck Vining (2021) 包含了线性模型中模型检查的一般介绍。Cook Weisberg (1982) 对许多情况下的残差和影响诊断的理论进行了更详细的说明。Atkinson (1985) 从实际角度描述了线性模型中的模型检查，McCullagh Nelder (1989) 以及 Aitkin et al. (1989) 在广义线性模型的背景下讨论了这个主题。许多致力于生存数据分析的教科书，例如 Cox Oakes (1984), Hosmer, Lemeshow May (2008), Lawless (2002) 以及 Kalbfleisch Prentice (2002) 的教科书，都包含有关残差使用的章节。Hinkley, Reid Snell (1991) 以及 Hastie Tibshirani (1990) 还简要讨论了评估符合生存数据的模型的充分性的方法。关于残差在检验生存模型的充分性方面的早期文章包括 Kay (1977), Crowley Hu (1977). 这些论文包括对 Cox-Snell 残差的讨论，这是基于 Cox Snell (1968) 给出的残差的一般定义. Crowley Storer (1983) 根据经验表明，残差的累积风险图在识别拟合模型的不充分方面不是特别好。另见Crowley Storer (1983) 以了解这些方法的实际应用。Kay (1984) Day (1985) 在 20 世纪 80 年代中期对生存分析中的诊断程序进行了回顾。Barlow Prentice (1988) 提出了鞅残差。Lagakos (1981) 提出了基本相同的残差，Therneau, Grambsch Fleming (1990) 以及 Henderson Milner (1991) 讨论了它们的使用。Therneau, Grambsch Fleming (1990) 也引入了偏差残差。Cox 模型的 Schoenfeld 残差是由 Schoenfield (1982) 提出的。在基于计数过程理论的生存分析中，Fleming Harrington (2005) 以及 Therneau Grambsch (2000) 展示了如何使用不同类型的残差，并给出了详细的实例。Nardiand Schemper (1999) 引入的另外两种残差特别适用于检测异常生存时间。许多作者已经研究了 Cox 回归模型的影响诊断，但主要的论文有 Cain Lange (1984), Reid Crépeau (1985), Storer Crowley (1985), Pettitt Bin Daud (1989) 以及 Weissfeld (1990) 。Pettitt Bin Daud (1990) 展示了如何通过平滑 Schoenfeld 残差来检验 Cox 比例风险模型中的时依性。LOWESS 平滑器由 Cleveland (1979) 引入。Cox (1979) 和 Arjas (1988) 提出了一些本章未提及的其他评估生存模型的方法。Gray (1990) 描述了在评估 Cox 模型的拟合时使用累积风险函数的平滑估计。Lin, Wei Ying (2003) 描述了基于鞅残差的累积和，这是用于检验 Cox 回归模型充分性的图形和数值方法。本章介绍的大多数诊断程序都依赖于对特定统计量的表格或图形表示的非正式评估。除了这些程序之外，还有可用于评估模型的拟合优度的各种显著性检验。实例包括 Schoenfeld (1980), Andersen (1982), Nagelkerke, Oosting Hart (1984), Ciampi Etezadi Amoli (1985), Moreau, O’Quigley Mesbah (1985), Gill Schumacher (1987), O’Quigley Pesione (1989), Quantin et al. (1996), Grønnesby Borgan (1996) 以及 Verweij, van Houwelingen Stijnen (1998) 的方法。Lin Wei (1991) 以及 Quantin et al. (1996) 对 Cox 回归模型的一些拟合优度检验进行了综述。这些检验中的许多都涉及相当复杂的统计量，而且这些程序在用于生存分析的计算机软件中并不广泛。May Hosmer (1998) 提出了一种更简单的方法来评估模型的整体拟合。","code":""},{"path":"chap5.html","id":"chap5","chapter":"第 5 章 参数回归模型","heading":"第 5 章 参数回归模型","text":"当 Cox 回归模型用于生存数据分析时，不需要假设生存时间特定形式的概率分布。因此，风险函数不局限于特定的函数形式，该模型具有灵活性和广泛的适用性。另一方面，如果特定概率分布的假设对于数据是有效的，基于这种假设的推断将更加精确。具体来说，相对风险和中位生存时间等量的估计往往比没有分布假设的情况下具有更小的标准误。假设生存时间具有特定概率分布的模型称为参数模型 (parametric models)，是本章的主题。在生存数据分析中起核心作用的概率分布是 Weibull 分布，由 W. Weibull 于 1951 年在工业可靠性测试中引入。事实上，就像正态分布在线性模型中的核心地位一样，Weibull 分布是生存数据参数分析的核心。因此，5.5 节至 5.7 节对基于 Weibull 分布的模型进行了详细讨论。尽管比例风险模型在生存数据分析中具有广泛的应用，但能与该模型一起使用的生存时间概率分布却相对较少。此外，现有的分布，主要是 Weibull 分布和 Gompertz 分布，会导致风险函数随着时间的推移而增加或减少。一个涵盖更广泛生存时间分布的模型是加速失效时间模型 (accelerated failure time model)，这在 5.10 节至 5.13 节中描述。在比例风险假设不成立的情况下，基于该系列的模型可能是富有成效的。同样，加速失效时间模型中的生存时间分布可以采用 Weibull 分布，也可以使用其他一些概率分布。因此，本章首先对可能用于参数模型的生存数据分布进行简要概述。另一个生存模型系列，称为比例几率模型 (proportional odds model)，在某些情况下可能很有用。该模型在 5.15 节中描述。","code":""},{"path":"chap5.html","id":"sec5-1","chapter":"第 5 章 参数回归模型","heading":"5.1 风险函数的模型","text":"一旦根据概率密度函数指定了生存时间分布的模型，就可以从以下关系式中获得相应的生存函数和风险函数\\[\\begin{aligned}S(t)&=1-\\int_0^tf(u)\\mathrm{d}u\\end{aligned}\\]以及\\[\\begin{aligned}h(t)=\\frac{f(t)}{S(t)}=-\\frac{\\mathrm{d}}{\\mathrm{d}t}\\{\\log S(t)\\}\\end{aligned}\\]其中 \\(f(t)\\) 是生存时间的概率密度函数。这些关系在 1.4 节推导过。另一种方法是为风险函数指定一种函数形式，然后可根据以下式子确定生存函数和概率密度函数\\[\\begin{align}\nS(t)=\\exp\\left\\{-H(t)\\right\\}\n\\tag{5.1}\n\\end{align}\\]以及\\[\\begin{aligned}f(t)=h(t)S(t)=-\\frac{\\mathrm{d}S(t)}{\\mathrm{d}t}\\end{aligned}\\]其中\\[\\begin{aligned}H(t)&=\\int_0^th(u)\\mathrm{d}u\\end{aligned}\\]为累积风险函数。","code":""},{"path":"chap5.html","id":"sec5-1-1","chapter":"第 5 章 参数回归模型","heading":"5.1.1 指数分布","text":"风险函数最简单的模型是假设它随着时间的推移保持不变。因此，无论经过多长时间，研究开始后任何时间的死亡风险都是相同的。在该模型下，风险函数可写为\\[\\begin{aligned}h(t)=\\lambda\\end{aligned}\\]其中 \\(0\\le t<\\infty\\)。参数 \\(\\lambda\\) 是一个正的常数，可以通过为观测生存数据拟合模型来估计。由式 (5.1) 可知，相应的生存函数为\\[\\begin{align}\nS(t)&=\\exp\\left\\{-\\int_0^t\\lambda\\mathrm{d}u\\right\\}\\\\\n&=e^{-\\lambda t}\n\\tag{5.2}\n\\end{align}\\]因此生存时间隐含的概率密度函数是\\[\\begin{align}\nf(t)=\\lambda e^{-\\lambda t}\n\\tag{5.3}\n\\end{align}\\]其中 \\(0\\le t<\\infty\\)。这是均值为 \\(\\lambda^{-1}\\) 的指数分布随机变量 \\(T\\) 的概率密度函数。有时可以方便地写成 \\(\\mu = \\lambda^{-1}\\)，从而风险函数为 \\(\\mu^{−1}\\)，生存时间分布的均值为 \\(\\mu\\)。然而，本书通常会使用前一个风险函数指定。指数分布的中位数 \\(t(50)\\) 满足 \\(S\\{t(50)\\}＝0.5\\)，即\\[\\exp\\{-\\lambda t(50)\\}=0.5\\]从而\\[\\begin{aligned}t(50)=\\frac1\\lambda\\log2\\end{aligned}\\]更一般地说，生存时间分布的第 \\(p\\) 个百分位数是值 \\(t(p)\\)，满足 \\(S\\{t(p)\\}=1−(p/100)\\)，使用式 (5.2)，这是\\[\\begin{aligned}t(p)&=\\frac{1}{\\lambda}\\log\\left(\\frac{100}{100-p}\\right)\\end{aligned}\\]图 5.1 给出了三个 \\(\\lambda\\) 值（即 1.0, 0.1 和 0.01）的风险函数图，相应的概率密度函数如图 5.2 所示。对于这些 \\(\\lambda\\) 值，相应指数分布的均值分别为 1, 10 和 100，中位生存时间分别为 0.69, 6.93 和69.31.","code":""},{"path":"chap5.html","id":"sec5-1-2","chapter":"第 5 章 参数回归模型","heading":"5.1.2 Weibull 分布","text":"在实践中，恒定风险函数的假设（或等价的，指数分布生存时间的假设）很少是成立的。风险函数的一种更通用的形式是\\[\\begin{align}\nh(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\n\\tag{5.4}\n\\end{align}\\]其中 \\(0\\le t<\\infty\\)，这是一个具有双参数 \\(\\lambda,\\gamma\\) 的函数，参数均大于零。在 \\(\\gamma=1\\) 的特殊情况下，风险函数取恒定值 \\(\\lambda\\)，生存时间呈指数分布。对于 \\(\\gamma\\) 的其他值，风险函数单调增加或减少，即不改变方向。风险函数的形状主要取决于 \\(\\gamma\\) 的值，因此 \\(\\gamma\\) 被称为形状参数 (shape parameter)，而参数 \\(\\lambda\\) 是一个尺度参数 (scale parameter). 图 5.3 展示了不同 \\(\\gamma\\) 值的风险函数。\n对于这种特定的风险函数，生存函数由下式给出\\[\\begin{align}\nS(t)=\\exp\\left\\{-\\int_0^t\\lambda\\gamma u^{\\gamma-1}\\mathrm{d}u\\right\\}=\\exp(-\\lambda t^\\gamma)\n\\tag{5.5}\n\\end{align}\\]相应的概率密度函数为\\[\\begin{aligned}f(t)=\\lambda\\gamma t^{\\gamma-1}\\exp(-\\lambda t^{\\gamma})\\end{aligned}\\]其中 \\(0\\le t<\\infty\\)，这是尺度参数为 \\(\\lambda\\)、形状参数为 \\(\\gamma\\) 的 Weibull 分布随机变量的密度。该分布表示为 \\(W(\\lambda, \\gamma)\\)。该分布的右尾比左尾长，因此该分布呈正偏态。服从 \\(W(\\lambda, \\gamma)\\) 分布的随机变量 \\(T\\) 的均值或期望为\\[\\begin{aligned}\\operatorname{E}\\left(T\\right)=\\lambda^{-1/\\gamma}\\Gamma(\\gamma^{-1}+1)\\end{aligned}\\]其中 \\(\\Gamma(c)\\) 是由如下积分定义的 gamma 函数\\[\\begin{align}\n\\Gamma(x)&=\\int_0^\\infty u^{x-1}e^{-u}\\mathrm{d}u\n\\tag{5.6}\n\\end{align}\\]该积分的值为 \\((x-1)!\\)，因此对于 \\(x\\) 的整数值，该积分易于计算。该函数也为 \\(x\\) 的非整数值有定义，可在许多软件包中计算。由于 Weibull 分布是偏态的，因此对分布位置的更合适且更容易处理的总结是中位生存时间。这是值 \\(t(50)\\)，满足 \\(S\\{t(50)\\} = 0.5\\)，即\\[\\exp\\left\\{-\\lambda[t(50)]^{\\gamma}\\right\\}=0.5\\]以及\\[t(50)=\\left\\{\\frac{1}{\\lambda}\\log2\\right\\}^{1/\\gamma}\\]更一般地，Weibull 分布第 \\(p\\) 个百分位 \\(t(p)\\) 满足\\[\\begin{align}\nt(p)=\\left\\{\\frac{1}{\\lambda}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\gamma}\n\\tag{5.7}\n\\end{align}\\]因此，Weibull 分布的中位数和其他百分位数比分布的均值更容易计算。中位数为 20、形状参数 \\(\\gamma = 0.5, 1.5\\) 和 \\(3.0\\) 的 Weibull 分布的风险函数和相应概率密度函数分别如图 5.4 和 5.5 所示。这三个 Weibull 分布的尺度参数 \\(\\lambda\\) 的相应值分别为 0.15, 0.0078 和 0.000087.\n由于 Weibull 风险函数可以根据形状参数 \\(\\gamma\\) 采取多种形式，并且可以轻松获得适当的总结总统计量，因此该分布广泛应用于生存数据的参数分析。","code":""},{"path":"chap5.html","id":"sec5-1-3","chapter":"第 5 章 参数回归模型","heading":"5.1.3 log-logistic 分布","text":"Weibull 风险函数的一个局限性为：它是时间的单调函数。但是，可能会出现风险函数改变方向的情况。例如，心脏移植后，患者在移植后的头十天左右，在身体适应新器官的同时，死亡风险越来越大的。随着患者的康复，这种风险会随着时间的推移而减小。在这种情况下，单峰 (unimodal) 风险函数可能是合适的。单峰风险的一种特殊形式是函数\\[\\begin{align}\nh(t)=\\frac{e^\\theta\\kappa t^{\\kappa-1}}{1+e^\\theta t^\\kappa}\n\\tag{5.8}\n\\end{align}\\]其中 \\(0\\leqslant t<\\infty,\\kappa>0\\)。若 \\(\\kappa>1\\)，风险函数单调递减，但若 \\(\\kappa\\le1\\)，风险是单峰的。对应于式 (5.8) 风险函数的生存函数由下式给出\\[\\begin{align}\nS(t)=\\left\\{1+e^\\theta t^\\kappa\\right\\}^{-1}\n\\tag{5.9}\n\\end{align}\\]概率密度函数为\\[\\begin{aligned}f(t)&=\\frac{e^\\theta\\kappa t^{\\kappa-1}}{(1+e^\\theta t^\\kappa)^2}\\end{aligned}\\]这是 log-logistic 分布随机变量 \\(T\\) 的密度，参数为 \\(\\theta,\\kappa\\)。该分布之所以如此称，是因为变量 \\(\\log T\\) 服从 logistic 分布，这是一种对称分布，其概率密度函数与正态分布的概率密度函数非常相似。log-logistic 分布的第 \\(p\\) 个百分位数为\\[t(p)=\\left(\\frac{pe^{-\\theta}}{100-p}\\right)^{1/\\kappa}\\]所以分布的中位数为\\[\\begin{aligned}t(50)=e^{\\large-\\theta/\\kappa}\\end{aligned}\\]中位数为 20 且 \\(\\kappa=0.5, 2.0\\) 和 \\(5.0\\) 的 log-logistic 分布的风险函数如图 5.6 所示。这些分布对应的 \\(θ\\) 值分别为 −1.5, −6.0 和 −15.0.","code":""},{"path":"chap5.html","id":"sec5-1-4","chapter":"第 5 章 参数回归模型","heading":"5.1.4 log-normal 分布","text":"log-normal 分布对应的随机变量也取正值，因此可以用作生存数据的模型。如果 \\(\\log T\\) 服从均值为 \\(\\mu\\)、方差为 \\(\\sigma^2\\) 的正态分布，则称随机变量 \\(T\\) 服从参数为 \\(\\mu\\) 和 \\(\\sigma\\) 的 log-normal 分布。\\(T\\) 的概率密度函数由下式给出\\[\\begin{aligned}f(t)=\\frac{1}{\\sigma\\surd(2\\pi)}t^{-1}\\exp\\left\\{-(\\log t-\\mu)^2/2\\sigma^2\\right\\}\\end{aligned}\\]其中 \\(0\\leqslant t<\\infty,\\sigma>0\\)，从中可以得到生存函数和风险函数。log-normal 分布的生存函数为\\[\\begin{align}\nS(t)=1-\\Phi\\left(\\frac{\\log t-\\mu}\\sigma\\right)\n\\tag{5.10}\n\\end{align}\\]其中 \\(\\Phi(\\cdot)\\) 为标准正态分布函数，由下式给出\\[\\begin{aligned}\\Phi(z)&=\\frac{1}{\\surd(2\\pi)}\\int_{-\\infty}^{z}\\exp\\left(-u^2/2\\right)\\mathrm{d}u\\end{aligned}\\]该分布的第 \\(p\\) 个百分位数为\\[t(p)=\\exp\\left\\{\\sigma\\Phi^{-1}(p/100)+\\mu\\right\\}\\]其中 \\(\\Phi^{-1}(p/100)\\) 为标准正态分布的第 \\(p\\) 个百分位数，有时也称为 \\(p/100\\) 的 probit. 特别是，在这种分布下的中位生存时间简单地为 \\(t(50)=e^{\\mu}\\)。风险函数可以根据关系式 \\(h(t)=f(t)/S(t)\\) 得到。当 \\(t=0\\) 时，此函数为 0，在 \\(t\\) 趋于无穷大的过程中，该函数增大到最大值，然后减小为 0. 生存函数和风险函数只能用积分表示，这一事实限制了该模型的实用性。此外，考虑到正态分布和 logistic 分布的相似性，log-normal 模型往往与 log-logistic 模型非常相似。","code":""},{"path":"chap5.html","id":"sec5-1-5","chapter":"第 5 章 参数回归模型","heading":"5.1.5 Gompertz 分布","text":"Gompertz 分布由 Gompertz 作为人类死亡率的模型于 1825 年引入，现在用于人口学和生物科学。该分布的风险函数由下式给出\\[h(t)=\\lambda e^{\\theta t}\\]其中 \\(0\\leqslant t<\\infty\\) 以及 \\(\\lambda>0\\)。在 \\(\\theta = 0\\) 的特殊情况下，风险函数具有恒定值 \\(\\lambda\\)，并且生存时间服从指数分布。参数 \\(\\theta\\) 决定了风险函数的形状，正值导致风险函数随时间递增。风险函数也可以表示为 \\(h(t)=\\exp(\\alpha+\\theta t)\\)，这表明其对数风险函数关于 \\(t\\) 是线性的。另一方面，根据式 (5.4) ，Weibull 对数风险函数关于 \\(\\log t\\) 呈线性。与 Weibull 风险函数类似，Gompertz 风险函数单调增加或减少。Gompertz 分布的生存函数由下式给出\\[S(t)=\\exp\\left\\{\\frac{\\lambda}{\\theta}(1-e^{\\theta t})\\right\\}\\]相应的密度函数为\\[f(t)=\\lambda e^{\\theta t}\\exp\\left\\{\\frac\\lambda\\theta(1-e^{\\theta t})\\right\\}\\]第 \\(p\\) 个百分位数满足\\[\\begin{aligned}t(p)=\\frac{1}{\\theta}\\log\\left\\{1-\\frac{\\theta}{\\lambda}\\log\\left(\\frac{100-p}{100}\\right)\\right\\}\\end{aligned}\\]中位生存时间为\\[\\begin{aligned}t(50)=\\frac{1}{\\theta}\\log\\left\\{1+\\frac{\\theta}{\\lambda}\\log2\\right\\}\\end{aligned}\\]图 5.7 显示了中位数为 \\(20\\) 且 \\(\\theta = −0.2, 0.02\\) 和 \\(0.05\\) 的分布的 Gompertz 风险函数图。对应的 \\(\\lambda\\) 值为 0.141, 0.028 和 0.020.","code":""},{"path":"chap5.html","id":"sec5-1-6","chapter":"第 5 章 参数回归模型","heading":"5.1.6 gamma 分布","text":"均值为 \\(\\rho/\\lambda\\) 且方差为 \\(\\rho/\\lambda^2\\) 的 gamma 分布的概率密度函数为\\[\\begin{align}\nf(t)=\\frac{\\lambda^\\rho t^{\\rho-1}e^{-\\lambda t}}{\\Gamma(\\rho)}\n\\tag{5.11}\n\\end{align}\\]其中 \\(0\\leqslant t<\\infty,\\lambda>0\\) 以及 \\(\\rho>0\\)。如同 log-normal 分布，gamma 分布的生存函数只能表示为积分，写作\\[S(t)=1-\\Gamma_{\\lambda t}(\\rho)\\]其中 \\(\\Gamma_{\\lambda t}(\\rho)\\) 为不完全 gamma 函数，由下式给出\\[\\begin{aligned}\\Gamma_{\\lambda t}(\\rho)&=\\frac{1}{\\Gamma(\\rho)}\\int_{0}^{\\lambda t}u^{\\rho-1}e^{-u}\\mathrm{d}u\\end{aligned}\\]gamma 分布的风险函数为 \\(h(t) = f(t)/S(t)\\)。如果 \\(\\rho > 1\\)，则该风险函数单调增加；如果 \\(ρ < 1\\)，则该风险函数单调减少，并且当 \\(t\\) 趋于 \\(\\infty\\) 时趋于 \\(\\lambda\\)。当 \\(\\rho = 1\\) 时，gamma 分布简化为 5.1.1 节中描述的指数分布，因此该分布与 Weibull 分布一样，都以指数分布为特例。事实上，gamma 分布与 Weibull 分布非常相似，并且基于模型的推断通常非常相似。gamma 分布的推广实际上比 gamma 分布本身更有用，因为它以 Weibull 和 log-normal 分布为特例。因此，这样的模型称为广义 gamma 分布，可用于区分生存数据的替代参数模型。广义 gamma 分布的概率密度函数是式 (5.11) 中 gamma 密度的扩展，包括一个额外参数 \\(\\theta>0\\)，定义为\\[\\begin{aligned}f(t)=\\frac{\\theta\\lambda^{\\rho\\theta}t^{\\rho\\theta-1}\\exp\\{-(\\lambda t)^\\theta\\}}{\\Gamma(\\rho)}\\end{aligned}\\]其中 \\(0\\leqslant t<\\infty\\)。该分布的生存函数也由不完全 gamma 函数定义，并由下式给出\\[\\begin{aligned}S(t)=1-\\Gamma_{(\\lambda t)^\\theta}(\\rho)\\end{aligned}\\]然后根据 \\(h(t)=f(t)/S(t)\\) 得到风险函数。这种分布导致风险函数的形状范围很广，由形状参数 \\(\\theta\\) 决定。当 \\(\\rho=1\\) 时，分布变为 Weibull；当 \\(\\theta=1\\) 时，为 gamma；当 \\(\\rho\\rightarrow\\infty\\) 时成为 lognormal。","code":""},{"path":"chap5.html","id":"sec5-1-7","chapter":"第 5 章 参数回归模型","heading":"5.1.7 逆高斯分布","text":"逆高斯分布 (inverse gaussian distribution) 是一个灵活的模型，具有一些重要的理论性质。具有均值 \\(\\mu\\) 和尺度参数 \\(\\lambda\\) 的分布的概率密度函数由下式给出\\[\\begin{aligned}f(t)=\\left(\\frac{\\lambda}{2\\pi t^3}\\right)^{\\frac{1}{2}}\\exp\\left\\{\\frac{\\lambda(t-\\mu^2)}{2\\mu^2t}\\right\\}\\end{aligned}\\]其中 \\(0\\leqslant t<\\infty\\) 以及 \\(\\lambda>0\\)。相应的生存函数为\\[\\begin{aligned}S(t)=\\Phi\\left\\{\\left(1-t\\mu^{-1}\\right)\\surd\\left(\\lambda t^{-1}\\right)\\right\\}-\\exp(2\\lambda/\\mu)\\Phi\\left\\{-\\left(1+t\\mu^{-1}\\right)\\surd\\left(\\lambda t^{-1}\\right)\\right\\}\\end{aligned}\\]然后根据 \\(h(t)=f(t)/S(t)\\) 得到风险函数。然而，如此复杂的生存函数形式使这种分布难以处理。","code":""},{"path":"chap5.html","id":"sec5-1-8","chapter":"第 5 章 参数回归模型","heading":"5.1.8 一些其他分布","text":"尽管已详细考虑了生存数据的许多分布，但还有其他分布在特定情况下可能有用。当死亡风险预计在短期内随着时间的推移而增加或减少，然后变为常数时，服从一般指数曲线 (general exponential curve) 或 Mitscherlich 曲线的风险函数可能是合适的。那么我们将风险函数设为\\[\\begin{aligned}h(t)=\\theta-\\beta e^{-\\gamma t}\\end{aligned}\\]其中 \\(\\theta>0,\\beta>0\\) 以及 \\(\\gamma>0\\)。这本质上是 5.1.5 节中定义的 Gompertz 风险函数，但带有一个额外常数。该函数的总体形状如图 5.8 所示。当 \\(t=0\\) 时，该函数的值为 \\(\\theta-\\beta\\)，并递增至接近 \\(\\theta\\) 的水平渐近线。类似地，函数\\[\\begin{aligned}h(t)=\\theta+\\beta e^{-\\gamma t}\\end{aligned}\\]其中 \\(\\theta>0,\\beta>0\\) 以及 \\(\\gamma>0\\) 可用于为这样的风险进行建模：从 \\(\\theta + \\beta\\) 递减至接近 \\(\\theta\\) 的水平渐近线。\n使用式 (1.6) 可以求出相应的生存函数，由此可以得到概率密度函数。与该风险函数指定相对应的概率分布称为 Gompertz-Makeham 分布。为了对关于最小值对称地先减少后增加的风险函数进行建模，二次风险函数可能是合适的。因此，如果对于下式，\\(\\theta,\\beta\\) 和 \\(\\gamma\\) 给出了所需的风险形状\\[\\begin{aligned}h(t)=\\theta+\\beta t+\\gamma t^2\\end{aligned}\\]并确保 \\(h(t)\\ge 0\\)，可以获得生存函数和概率密度函数的显式表达。另一种形式的风险函数是“浴缸” (bathtub) 风险，它会先减小到一个最小值，然后再增加。模型\\[\\begin{aligned}h(t)&=\\alpha t+\\frac{\\beta}{1+\\gamma t}\\end{aligned}\\]提供了这种形式的风险的直接表达，并且可以找到生存函数和密度函数的相应表达式。","code":""},{"path":"chap5.html","id":"sec5-2","chapter":"第 5 章 参数回归模型","heading":"5.2 评估参数模型的适用性","text":"在根据假设的风险函数参数形式拟合模型之前，应对该假设的有效性进行初步研究。一种方法是使用 2.3 节中概述的方法来估计风险函数。如果风险函数随着时间的推移是较为恒定的，这将表明指数分布可能是数据的合适模型。另一方面，如果风险函数随着生存时间的增加而单调增加或减少，则表明应使用基于 Weibull 分布的模型。评估生存时间的特定分布是否合理的一种富有信息的方法是将数据的生存函数与所选模型的生存函数进行比较。如果假设的模型是合适的，通过转换生存函数将产生一条直线图形。假设有单个生存数据样本，并且考虑了生存时间的 Weibull 分布。由于具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布的生存函数为\\[\\begin{aligned}S(t)=\\exp\\left\\{-\\lambda t^{\\gamma}\\right\\}\\end{aligned}\\]取其对数，乘以负一，然后再取对数，得到\\[\\begin{align}\n\\log\\left\\{-\\log S(t)\\right\\}=\\log\\lambda+\\gamma\\log t\n\\tag{5.12}\n\\end{align}\\]现在，我们用生存函数的 Kaplan-Meier 估计 \\(\\hat S(t)\\) 代替式 (5.12) 中的 \\(S(t)\\)。如果 Weibull 假设成立，则 \\(\\hat S(t)\\) 将“接近” \\(S(t)\\)，并且 \\(\\log\\{-\\log\\hat{S}(t)\\}\\) 关于 \\(\\log t\\) 的图形将给出一条近似的直线。根据式 (1.8)，累积风险函数 \\(H(t)=− \\log S(t)\\)，因此 \\(\\log\\{-\\log S(t)\\}\\) 是对数累积风险。\\(\\log\\{-\\log\\hat{S}(t)\\}\\) 关于 \\(\\log t\\) 的图形是对数累积风险图，这在第 4 章 4.4.1 节介绍过。示例 5.1  (停用宫内节育器的时间) 在示例 2.3 中，获得了关于停用宫内节育器时间数据的生存函数的 Kaplan-Meier 估计 \\(\\hat S(t)\\)。这些数据的对数累积风险图，即 \\(\\log\\{-\\log\\hat{S}(t)\\}\\) 关于 \\(\\log t\\) 的图，如图 5.9 所示。\n该图表明对数累积风险与 \\(\\log t\\) 之间存在直线关系，证实 Weibull 分布是停用时间的合适模型。从图中可以看出，直线的截距约为 -6.0，斜率约为 1.25. 因此， Weibull 分布参数的近似估计为 \\(\\lambda^* = \\exp(−6.0) = 0.002\\) 和 \\(\\gamma^* = 1.25\\). Weibull 分布形状参数 \\(\\gamma\\) 的估计非常接近于 1，这表明停用时间可以使用指数分布建模。可用类似的程序评估 log-logistic 分布的适用性，使用生存函数的变换来生成直线图。根据式 (5.9)，生存超过时间 \\(t\\) 的几率 (odds) 为\\[\\begin{aligned}\\frac{S(t)}{1-S(t)}&=e^{-\\theta}t^{-\\kappa}\\end{aligned}\\]因此生存超过 \\(t\\) 的对数几率 (log-odds) 可以表示为\\[\\begin{aligned}\\log\\left\\{\\frac{S(t)}{1-S(t)}\\right\\}&=-\\theta-\\kappa\\log t\\end{aligned}\\]如果使用 Kaplan-Meier 估计来估计数据的生存函数，并绘制生存超过 \\(t\\) 的对数几率关于 \\(\\log t\\) 的图形，如果生存时间的 log-logistic 模型合适，将获得直线图。log-logistic 分布的参数 \\(\\theta\\) 和 \\(\\kappa\\) 的估计可以从直线图的截距和斜率获得。其他参数模型的适用性可以按照类似的思路进行研究。例如，根据式 (5.10) 给出的 log-normal 分布的生存函数，\\[\\begin{aligned}\\Phi^{-1}\\{1-S(t)\\}&=\\frac{\\log t-\\mu}{\\sigma}\\end{aligned}\\]因此如果 log-normal 模型是合适的，\\(\\Phi^{-1}\\{1-S(t)\\}\\) 关于 \\(\\log t\\) 的图形将给出一条直线。该线的斜率和截距分别提供了 \\(\\sigma^{−1}\\) 和 \\(−\\mu/\\sigma\\) 的估计。示例 5.2  (停用宫内节育器的时间) 在示例 5.1 中，使用对数累积风险图来评估 Weibull 分布对示例 1.1 给出的宫内节育器停用时间数据的拟合度。我们现在考虑 log-logistic 分布是否合适。图 5.10 显示了宫内节育器停用时间数据的 \\(\\log\\{\\hat{S}(t)/[1-\\hat{S}(t)]\\}\\) 关于 \\(\\log t\\) 的图形。\n根据该图，时间 \\(t\\) 后停用宫内节育器的对数几率估计与 \\(\\log t\\) 之间有合理的直线关系。这表明可以使用 log-logistic 模型对观测数据进行建模。请注意，图 5.9 和 5.10 图中偏离线性的程度几乎没有差异。这意味着 Weibull 分布和 log-logistic 分布可能都令人满意，即使在这两种分布下风险函数估计可能非常不同。事实上，当只有相对较少数量个体的生存数据时，如本例所示，通常在数据的替代分布模型之间几乎没有选择余地。然后采用最方便的模型。使用图形方法获得的生存时间概率分布中未知参数的非正式估计也可以用于估计这些参数的函数，例如分布的中位数。然而，这并不能度量所估量的精度。下一节将开发一种更正式的方法：为生存数据拟合参数模型。","code":""},{"path":"chap5.html","id":"sec5-3","chapter":"第 5 章 参数回归模型","heading":"5.3 为单样本拟合参数模型","text":"可以使用第 3 章 3.3 节概述的最大似然方法为观测生存数据集拟合参数模型。首先考虑无删失观测情况，我们有 \\(n\\) 个个体的实际观测生存时间。若与生存时间相关的随机变量的概率密度函数为 \\(f(t)\\)，\\(n\\) 个观测 \\(t_1,t_2,\\ldots,t_n\\) 的似然简单地为乘积\\[\\prod_{=1}^nf(t_i)\\]该似然是概率密度函数中未知参数的函数，这些参数的最大似然估计是使似然函数达到最大值的那些值。在实践中，使用对数似然函数通常更方便。使对数似然达到最大的未知参数值当然与使似然函数本身达到最大的值相同。我们现在考虑一种更常见的情况，其中生存数据包包含若干个删失生存时间。具体来说，假设 \\(r\\) 个个体在时间 \\(t_1, t_2,...,t_r\\) 处死亡，剩余 \\(n − r\\) 个个体的生存时间 \\(t_1^*,t_2^*,\\ldots,t_{n-r}^*\\) 为右删失的。\\(r\\) 个死亡时间为总体似然函数贡献了以下形式的项\\[\\prod_{j=1}^rf(t_j)\\]当然，我们不能忽视 \\(n − r\\) 个个体的生存经历的信息，这些个体的删失生存时间已被记录。如果在时间 \\(t^*\\) 处生存时间删失，那么我们知道个体的生命至少为 \\(t^*\\)，并且该事件的概率为 \\(\\mathrm{P}(T\\geqslant t^*)\\)，即 \\(S(t^*)\\)。因此，每个删失观测为似然函数贡献了一个如此形式的项。因此，总似然函数为\\[\\begin{align}\n\\prod_{j=1}^rf(t_j)\\prod_{l=1}^{n-r}S(t_l^*)\n\\tag{5.13}\n\\end{align}\\]其中第一个乘积运算关于 \\(r\\) 个死亡时间进行，第二个乘积运算关于 \\(n−r\\) 个删失生存时间进行。或者以另一种方式，假设数据被视为 \\(n\\) 对观测值，其中第 \\(\\) 个个体的观测对是 \\((t_i, \\delta_i),= 1, 2,...,n\\)。在这种表示中，\\(\\delta_i\\) 是一个指示变量，当生存时间 \\(t_i\\) 删失时，\\(δ_i=0\\)；当 \\(t_i\\) 是未删失的生存时间时，\\(δ_i=1\\)。似然函数可以写为\\[\\begin{align}\n\\prod_{=1}^n\\left\\{f(t_i)\\right\\}^{\\delta_i}\\left\\{S(t_i)\\right\\}^{1\\boldsymbol{-}\\delta_i}\n\\tag{5.14}\n\\end{align}\\]该函数等价于式 (5.13) 中的函数，然后可以关于密度函数和生存函数中的未知参数来最大化。可以通过将式 (5.14) 写为以下形式来获得该似然函数的另一种表达\\[\\prod_{=1}^n\\left\\{\\frac{f(t_i)}{S(t_i)}\\right\\}^{\\delta_i}S(t_i)\\]因此，根据第 1 章的式 (1.4)，这成为\\[\\begin{align}\n\\prod_{{}=1}^{{n}}\\left\\{h(t_i)\\right\\}^{{\\delta}_i}S(t_i)\n\\tag{5.15}\n\\end{align}\\]当概率密度函数具有复杂的形式（通常如此）时，如此形式的似然函数特别有用。然后通过最大化对数似然函数的来得到该似然函数中未知参数的估计。","code":""},{"path":"chap5.html","id":"sec5-3-1","chapter":"第 5 章 参数回归模型","heading":"5.3.1 随机删失数据的似然函数","text":"本节给出了式 (5.14) 中似然函数更仔细的推导，它涉及第 1 章 1.2.1 节中提到的独立删失假设。假设 \\(n\\) 个个体样本的生存数据是事件时间和右删失观测的混合。用 \\(t_i\\) 表示第 \\(\\) 个个体的观测时间，\\(\\delta_i\\) 为相应的事件指示，\\(=1,2,\\ldots,n\\)。 如果 \\(t_i\\) 是事件时间，则 \\(\\delta_i=1\\)，如果时间是删失的，则 \\(\\delta_i=0\\)。与第 \\(\\) 个个体的事件时间相关的随机变量将由 \\(T_i\\) 表示。假设删失时间为随机的，用 \\(C_i\\) 表示与删失时间相关的变量。那么，值 \\(t_i\\) 是随机变量 \\(Y_i=\\min(T_i,C_i)\\) 的观测值。\\(T_i\\) 的密度函数和生存函数分别用 \\(f_{T_i}(t)\\) 和 \\(S_{T_i}(t)\\) 表示。此外，用 \\(f_{C_i}(t)\\)和 \\(S_{C_i}(t)\\) 表示与删失时间 \\(C_i\\) 相关的随机变量的密度和生存函数。现在，我们分别考虑删失和未删失观测对 \\((Y_i,\\delta_i)\\) 的概率分布。首先考虑删失观测，因此 \\(\\delta_i=0\\)。\\(Y_i\\) 和 \\(\\delta_i\\) 的联合分布为\\[\\begin{aligned}\\mathrm{P}(Y_i=t,\\delta_i=0)=\\mathrm{P}(C_i=t,T_i\\geqslant t)\\end{aligned}\\]该联合概率是连续分量和离散分量的混合，但为了简化表示，例如，将 \\(P(T_i=t)\\) 理解为 \\(T_i\\) 的概率密度函数。现在假设事件时间 \\(T_i\\) 的分布与删失时间 \\(C_i\\) 的分布独立。那么\\[\\begin{aligned}\n\\begin{aligned}\\mathrm{P}(C_i=t,T_i\\geqslant t)\\end{aligned}& \\begin{aligned}=\\text{ P}(C_i=t)\\text{ P}(T_i\\geqslant t)\\end{aligned}  \\\\\n&=\\left.f_{C_i}(t)S_{T_i}(t)\\right.\n\\end{aligned}\\]因此\\[\\begin{aligned}\\mathrm{P}(Y_i=t,\\delta_i=0)=f_{C_i}(t)S_{T_i}(t)\\end{aligned}\\]类似地，对于未删失观测\\[\\begin{aligned}\n\\mathrm{P}(Y_i=t,\\delta_i=1)& \\begin{aligned}=\\text{ P}(T_i=t,C_i\\geqslant t)\\end{aligned}  \\\\\n&=\\text{ P}(T_i=t)\\text{ P}(C_i\\geqslant t) \\\\\n&=\\left.f_{T_i}(t)S_{C_i}(t)\\right.\n\\end{aligned}\\]再次假设 \\(C_i\\) 与 \\(T_i\\) 的分布是独立的。把这两个结果放在一起，\\(n\\) 个观测 \\(t_1,t_2,\\ldots,t_n\\) 的联合概率或似然为\\[\\begin{aligned}\\prod_{=1}^n\\{f_{T_i}(t_i)S_{C_i}(t_i)\\}^{\\delta_i}\\{f_{C_i}(t_i)S_{T_i}(t_i)\\}^{1{-}\\delta_i}\\end{aligned}\\]可写为\\[\\begin{aligned}\\prod_{=1}^nf_{C_i}(t_i)^{1-\\delta_i}S_{C_i}(t_i)^{\\delta_i}\\times\\prod_{=1}^nf_{T_i}(t_i)^{\\delta_i}S_{T_i}(t_i)^{1-\\delta_i}\\end{aligned}\\]在独立删失假设下，该表达式中的第一个乘积项将不涉及任何与生存时间分布相关的参数，因此可以视为常数。观测数据的似然与下式成比例\\[\\prod_{=1}^nf_{T_i}(t_i)^{\\delta_i}S_{T_i}(t_i)^{1\\boldsymbol{-}\\delta_i}\\]这是式 (5.14)。还可以证明，当研究具有固定的持续时间时，从而到研究结束时没有经历过事件的个体被删失，可以获得相同的似然函数。此处不给出具体细节，但可参阅 Klein Moeschberger (2005) 或 Lawless (2002).","code":""},{"path":"chap5.html","id":"sec5-4","chapter":"第 5 章 参数回归模型","heading":"5.4 拟合指数和 Weibull 模型","text":"我们现在考虑为单个生存数据样本拟合指数分布和 Weibull 分布。","code":""},{"path":"chap5.html","id":"sec5-4-1","chapter":"第 5 章 参数回归模型","heading":"5.4.1 拟合指数分布","text":"假设 \\(n\\) 个个体的生存时间 \\(t_1, t_2,...,t_n\\) 呈均值为 \\(\\lambda^{-1}\\) 的指数分布。进一步假设 \\(r\\) 个个体的生存时间未删失，其余 \\(n − r\\) 个是右删失的。对于指数分布\\[\\begin{aligned}f(t)=\\lambda e^{-\\lambda t},\\quad\\quad S(t)=e^{-\\lambda t}\\end{aligned}\\]代入式 (5.14)，\\(n\\) 个观测的似然函数由下式给出\\[\\begin{aligned}L(\\lambda)&=\\prod_{=1}^n\\left(\\lambda e^{-\\lambda t_i}\\right)^{\\delta_i}\\left(e^{-\\lambda t_i}\\right)^{1-\\delta_i}\\end{aligned}\\]其中，如果第 \\(\\) 个个体的生存时间删失，则 \\(\\delta_i=0\\)，否则为 1. 经过一些简化后，\\[\\begin{align}\nL(\\lambda)&=\\prod_{=1}^n\\lambda^{\\delta_i}e^{-\\lambda t_i}\n\\tag{5.16}\n\\end{align}\\]相应的对数似然函数为\\[\\begin{aligned}\\log L(\\lambda)=\\sum_{=1}^n\\delta_i\\log\\lambda-\\lambda\\sum_{=1}^nt_i\\end{aligned}\\]由于数据包含 \\(r\\) 次死亡，则 \\(\\sum_{=1}^n\\delta_i=r\\)，对数似然函数成为\\[\\begin{aligned}\\log L(\\lambda)&=r\\log\\lambda-\\lambda\\sum_{=1}^nt_i\\end{aligned}\\]现在我们需要确定使对数似然函数达到最大值的 \\(\\hat\\lambda\\)。将其关于 \\(\\lambda\\) 微分，得到\\[\\begin{aligned}\\frac{\\mathrm{d}\\log L(\\lambda)}{\\mathrm{d}\\lambda}&=\\frac{r}{\\lambda}-\\sum_{=1}^{n}t_i\\end{aligned}\\]并令导数等于零，得到 \\(\\lambda\\) 的最大似然估计\\[\\begin{align}\n\\hat{\\lambda}=r/\\sum_{=1}^nt_i\n\\tag{5.17}\n\\end{align}\\]指数分布的均值为 \\(\\mu = \\lambda^{−1}\\)，因此 \\(\\mu\\) 的最大似然估计为\\[\\hat{\\mu}=\\hat{\\lambda}^{-1}=\\frac1r\\sum_{=1}^nt_i\\]\\(\\mu\\) 的估计是数据集中 \\(n\\) 个个体的总生存时间除以观测死亡人数。因此，该估计具有直观的吸引力，可以作为删失生存数据中平均寿命的估计。使用附录 给出的最大似然估计理论的结果，可以从对数似然函数的二阶导数中获得标准误。\\(\\log L(\\lambda)\\) 的二阶导数给出\\[\\begin{aligned}\\frac{\\mathrm{d}^2\\log L(\\lambda)}{\\mathrm{d}\\lambda^2}&=-\\frac r{\\lambda^2}\\end{aligned}\\]因此，\\(\\hat \\lambda\\) 的渐近方差为\\[\\begin{aligned}\\operatorname{var}\\left(\\hat{\\lambda}\\right)=\\left\\{-\\operatorname{E}\\left(\\frac{\\mathrm{d}^2\\log L(\\lambda)}{\\mathrm{d}\\lambda^2}\\right)\\right\\}^{-1}=\\frac{\\lambda^2}r\\end{aligned}\\]因此，\\(\\hat \\lambda\\) 的标准误为：\\[\\begin{align}\n\\text{se }(\\hat{\\lambda})=\\hat{\\lambda}/√r\n\\tag{5.18}\n\\end{align}\\]该结果可用于获得平均生存时间的置信区间。具体来说，\\(\\lambda\\) 的 \\(100(1−\\alpha)\\%\\) 置信区间的上下限为：\\(\\hat{\\lambda}\\pm z_{\\alpha/2}\\text{se}(\\hat{\\lambda})\\)，其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。在呈现生存分析的结果时，生存函数和风险函数的估计，以及生存时间分布的中位数和其他百分位数是有用的。一旦得到 \\(\\lambda\\) 的估计，就可以使用 5.1.1 节中给出的结果来估计所有这些函数。具体来说是，在假设的指数分布下，风险函数估计为 \\(\\hat{h}(t)=\\hat{\\lambda}\\)，而生存函数估计为 \\(\\hat{S}(t)=\\exp(-\\hat{\\lambda}t)\\)。此外，第 \\(p\\) 个百分位数估计为\\[\\begin{align}\n\\hat{t}(p)&=\\frac{1}{\\hat{\\lambda}}\\log\\left(\\frac{100}{100-p}\\right)\n\\tag{5.19}\n\\end{align}\\]中位生存时间估计为\\[\\begin{align}\n\\hat{t}(50)=\\hat{\\lambda}^{-1}\\log2\n\\tag{5.20}\n\\end{align}\\]使用第 2 章式 (2.8) 给出的随机变量函数近似方差的结果，可以得到生存时间分布第 \\(p\\) 个百分位数估计的标准误。根据该结果，对 \\(\\hat \\lambda\\) 的函数 \\(g(\\hat{\\lambda})\\) 的方差的近似为\\[\\begin{align}\n\\text{var}\\left\\{g(\\hat{\\lambda})\\right\\}\\approx\\left\\{\\frac{\\text{d}g(\\hat{\\lambda})}{\\text{d}\\hat{\\lambda}}\\right\\}^2\\text{ var}\\left(\\hat{\\lambda}\\right)\n\\tag{5.21}\n\\end{align}\\]使用该结果，第 \\(p\\) 个百分位数估计的近似方差为\\[\\begin{aligned}\\operatorname{var}\\left\\{\\hat{t}(p)\\right\\}&\\approx\\left\\{-\\frac{1}{\\hat{\\lambda}^2}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^2\\operatorname{var}\\left(\\hat{\\lambda}\\right)\\end{aligned}\\]开平方得到\\[\\begin{aligned}\\text{se}\\left\\{\\hat{t}(p)\\right\\}&=\\frac{1}{\\hat{\\lambda}^{2}}\\log\\left(\\frac{100}{100-p}\\right)\\text{ se}\\left(\\hat{\\lambda}\\right)\\end{aligned}\\]代入式 (5.18) 中的 \\(\\text{se}\\left(\\hat{\\lambda}\\right)\\) 和式 (5.19) 中的 \\(\\widehat{t}(p)\\)，得到\\[\\begin{align}\n\\text{se }\\{\\hat{t}(p)\\}=\\hat{t}(p)/√r\n\\tag{5.22}\n\\end{align}\\]特别地，中位生存时间估计的标准误为\\[\\begin{align}\n\\text{se}\\left\\{\\hat{t}(50)\\right\\}=\\hat{t}(50)/√r\n\\tag{5.23}\n\\end{align}\\]真实百分位数的置信区间最好通过对对数百分位数的置信限进行指数运算来获得。该程序确保百分位数的置信限非负。再次利用式 (5.21) 的结果，\\(\\log\\hat{t}(p)\\) 的标准误由下式给出\\[\\begin{aligned}\\text{se}\\left\\{\\log\\hat{t}(p)\\right\\}=\\hat{t}(p)^{-1}\\text{ se}\\left\\{\\hat{t}(p)\\right\\}\\end{aligned}\\]然后带入式 (5.22) 中的 \\(\\mathrm{se}\\left\\{\\hat{t}(p)\\right\\}\\)，该标准误成为\\[\\begin{aligned}\\text{se}\\left\\{\\log\\hat{t}(p)\\right\\}=1/√r\\end{aligned}\\]使用此结果，第 \\(p\\) 个百分位数的 \\(100(1 − \\alpha)\\%\\) 置信限为 \\(\\exp\\{\\log\\hat{t}(p)\\pm z_{\\alpha/2}/√r\\}\\)，即 \\(\\hat{t}(p)\\exp\\{\\pm z_{\\alpha/2}/√r\\}\\)，其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。示例 5.3  (停用宫内节育器的时间) 在此示例中，假设停用风险恒定，对示例 1.1 中关于 18 名女性宫内节育器停用时间数据进行了分析。使用指数分布拟合停用时间。对于这些数据，观测的和右删失的停用时间总和为 1046 天，未删失时间数为 9. 因此，使用式 (5.17)，\\(\\hat{\\lambda}=9/1046=0.0086\\)，根据式 (5.18)，标准误为 \\(\\text{se}\\left(\\hat{\\lambda}\\right)=0.0086/\\sqrt{9}=0.0029\\)。因此，风险函数估计为 \\(\\hat{h}(t)=0.0086,t>0\\)，生存函数估计为 \\(\\hat{S}(t)=\\exp(-0.0086t)\\)。风险函数估计和生存函数估计分别如图 5.11 和 5.12 所示。\n停用时间分布的中位数和其他百分位数的估计可以从图 5.12 中找到，但更准确的估计可以从式 (5.20) 中获得。具体来说，使用式 (5.17)，中位停用时间为 81 天，根据式 (5.19)，停用时间分布的第 90 个百分位的估计值为 \\(\\hat t(90) = \\log 10/0.0086 = 267.61\\) 。这意味着，假设停用宫内节育器的风险与时间无关，则 90% 的女性停用宫内节育器的时间将小于 268 天。根据式 (5.23)，停用时间估计的标准误为 \\(80.56/√9\\)，即 26.85 天。真实中位停用时间的 95% 置信区间的上下限为\\[80.56\\exp\\{\\pm1.96/√9\\}\\]所以区间是 42 天到 155 天。其他百分位数的置信区间可以以类似的方式计算。","code":""},{"path":"chap5.html","id":"sec5-4-2","chapter":"第 5 章 参数回归模型","heading":"5.4.2 拟合 Weibull 分布","text":"现在将 \\(n\\) 个个体的生存时间视为来自具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布的删失样本。假设 \\(n\\) 个个体中有 \\(r\\) 次死亡，\\(n−r\\) 个右删失生存时间。我们可以再次使用式 (5.14) 来获得样本数据的似然。 \\(W(\\lambda,\\gamma)\\) 分布的概率密度、生存和风险函数由下式给出\\[\\begin{aligned}f(t)=\\lambda\\gamma t^{\\gamma-1}\\exp(-\\lambda t^\\gamma),\\quad S(t)=\\exp(-\\lambda t^\\gamma),\\quad h(t)=\\lambda\\gamma t^{\\gamma-1}\\end{aligned}\\]因此，根据式 (5.14)，\\(n\\) 个生存时间的似然为\\[\\begin{aligned}\\prod_{=1}^n\\left\\{\\lambda\\gamma t_i^{\\gamma-1}\\exp(-\\lambda t_i^\\gamma)\\right\\}^{\\delta_i}\\left\\{\\exp(-\\lambda t_i^\\gamma)\\right\\}^{1-\\delta_i}\\end{aligned}\\]其中，若第 \\(\\) 个生存时间删失，则 \\(\\delta_i\\) 为 0，否则为 1。等价地，根据式 (5.15)，似然函数为\\[\\prod_{=1}^n\\left\\{\\lambda\\gamma t_i^{\\gamma-1}\\right\\}^{\\delta_i}\\exp(-\\lambda t_i^\\gamma)\\]这被视为 Weibull 分布中未知参数 \\(\\lambda\\) 和 \\(\\gamma\\) 的函数，因此可以写为 \\(L(\\lambda,\\gamma)\\)。相应的对数似然函数为\\[\\begin{aligned}\\log L(\\lambda,\\gamma)=\\sum_{=1}^n\\delta_i\\log(\\lambda\\gamma)+(\\gamma-1)\\sum_{=1}^n\\delta_i\\log t_i-\\lambda\\sum_{=1}^nt_i^\\gamma\\end{aligned}\\]注意到 \\(\\sum_{=1}^n\\delta_i=r\\)，对数似然函数成为\\[\\begin{aligned}\\log L(\\lambda,\\gamma)=r\\log(\\lambda\\gamma)+(\\gamma-1)\\sum_{=1}^n\\delta_i\\log t_i-\\lambda\\sum_{=1}^nt_i^\\gamma\\end{aligned}\\]\\(\\lambda\\) 和 \\(\\gamma\\) 的最大似然估计是通过将该函数关于 \\(\\lambda\\) 和 \\(\\gamma\\) 微分，将导数设为零得出的。所得方程为\\[\\begin{align}\n\\frac r{\\hat{\\lambda}}-\\sum_{=1}^nt_i^{\\hat{\\gamma}}=0\n\\tag{5.24}\n\\end{align}\\]以及\\[\\begin{align}\n\\frac{r}{\\hat{\\gamma}}+\\sum_{=1}^n\\delta_i\\log t_i-\\hat{\\lambda}\\sum_{=1}^nt_i^{\\hat{\\gamma}}\\log t_i&=0\n\\tag{5.25}\n\\end{align}\\]根据式 (5.24)，\\[\\begin{align}\n\\hat{\\lambda}=r/\\sum_{=1}^nt_i^{\\hat{\\gamma}}\n\\tag{5.26}\n\\end{align}\\]代入式 (5.25) 中的 \\(\\hat\\lambda\\)，我们得到方程\\[\\begin{align}\n\\frac{r}{\\hat{\\gamma}}+\\sum_{=1}^n\\delta_i\\log t_i-\\frac{r}{\\sum_it_i^{\\hat{\\gamma}}}\\sum_{=1}^nt_i^{\\hat{\\gamma}}\\log t_i=0\n\\tag{5.27}\n\\end{align}\\]这是 \\(\\hat\\gamma\\) 的非线性方程，只能使用迭代程序进行数值求解。一旦找到满足式 (5.27) 的估计 \\(\\hat\\gamma\\)，就可以使用式 (5.26) 来获得 \\(\\hat\\lambda\\)。在实践中，使用数值方法（例如 Newton-Raphson 程序）来同时得到最大化似然函数的 \\(\\hat\\gamma\\) 和 \\(\\hat\\gamma\\) 的值。该过程在第 3 章 3.3.3 节中描述，与 Cox 回归模型的拟合有关。在该节中，注意到 Newton-Raphson 程序的一个重要副产品是参数估计的方差-协方差阵的近似，从中可以获得它们的标准误。一旦从 Weibull 分布对观测数据的拟合中找到了参数 \\(\\lambda\\) 和 \\(\\gamma\\) 的估计，就可以使用式 (5.7) 来估计生存时间分布的百分位数。该分布的第 \\(p\\) 个百分位数估计为\\[\\begin{align}\n\\hat{t}(p)=\\left\\{\\frac{1}{\\hat{\\lambda}}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\hat{\\gamma}}\n\\tag{5.28}\n\\end{align}\\]中位生存时间估计为\\[\\begin{align}\n\\hat{t}(50)=\\left\\{\\frac{1}{\\hat{\\lambda}}\\log2\\right\\}^{1/\\hat{\\gamma}}\n\\tag{5.29}\n\\end{align}\\]5.4.3 节导出了 Weibull 分布百分位数标准误的表达式以及相应的置信区间。","code":""},{"path":"chap5.html","id":"sec5-4-3","chapter":"第 5 章 参数回归模型","heading":"5.4.3 Weibull 分布百分位数的标准误","text":"具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布的第 \\(p\\) 个百分位数估计的标准误 \\(\\hat{t}(p)\\) 最容易从 \\(\\log\\hat t(p)\\) 的方差中得到。现在，根据式 (5.28)\\[\\begin{aligned}\\log\\hat{t}(p)=\\frac1{\\hat{\\gamma}}\\log\\left\\{\\hat{\\lambda}^{-1}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}\\end{aligned}\\]因此\\[\\begin{aligned}\\log\\hat{t}(p)=\\frac{1}{\\hat{\\gamma}}\\left\\{c_p-\\log\\hat{\\lambda}\\right\\}\\end{aligned}\\]其中\\[\\begin{aligned}c_p=\\log\\log\\left(\\frac{100}{100-p}\\right)\\end{aligned}\\]这是两个参数估计 \\(\\hat\\lambda,\\hat\\gamma\\) 的函数。为获取 \\(\\log\\hat{t}(p)\\) 的方差，我们利用两个参数估计函数 \\(g(\\hat{\\theta}_1,\\hat{\\theta}_2)\\) 的近似方差的一般结果\\[\\begin{align}\n\\left(\\frac{\\partial g}{\\partial\\hat{\\theta}_1}\\right)^2\\operatorname{var}\\left(\\hat{\\theta}_1\\right)+\\left(\\frac{\\partial g}{\\partial\\hat{\\theta}_2}\\right)^2\\operatorname{var}(\\hat{\\theta}_2)+2\\left(\\frac{\\partial g}{\\partial\\hat{\\theta}_1}\\frac{\\partial g}{\\partial\\hat{\\theta}_2}\\right)\\operatorname{cov}\\left(\\hat{\\theta}_1,\\hat{\\theta}_2\\right)\n\\tag{5.30}\n\\end{align}\\]这是第 2 章式 2.8 中关于单个随机变量函数的近似方差结果的推广。使用式 (5.30)\\[\\begin{aligned}\\text{var }\\left\\{\\log\\hat{t}(p)\\right\\}\\approx&\\,\\left(\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\lambda}}\\right)^2\\text{var}\\left(\\hat{\\lambda}\\right)+\\left(\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\gamma}}\\right)^2\\text{var}\\left(\\hat{\\gamma}\\right)\\\\&+2\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\lambda}}\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\gamma}}\\text{cov}\\left(\\hat{\\lambda},\\hat{\\gamma}\\right)\\end{aligned}\\]现在，\\(\\log\\hat{t}(p)\\) 关于 \\(\\hat\\lambda,\\hat\\gamma\\) 的导数为\\[\\begin{aligned}\\frac{\\partial\\log\\hat t(p)}{\\partial\\hat\\lambda}&=-\\frac{1}{\\hat\\lambda\\hat\\gamma}\\\\\\frac{\\partial\\log\\hat t(p)}{\\partial\\hat\\gamma}&=-\\frac{c_p-\\log\\hat\\lambda}{\\hat\\gamma^2}\\end{aligned}\\]因此 \\(\\log\\hat{t}(p)\\) 的近似方差为\\[\\begin{align}\n\\frac1{\\hat{\\lambda}^2\\hat{\\gamma}^2}\\operatorname{var}\\left(\\hat{\\lambda}\\right)+\\frac{\\left(c_p-\\log\\hat{\\lambda}\\right)^2}{\\hat{\\gamma}^4}\\operatorname{var}\\left(\\hat{\\gamma}\\right)+\\frac{2\\left(c_p-\\log\\hat{\\lambda}\\right)}{\\hat{\\lambda}\\hat{\\gamma}^3}\\operatorname{cov}\\left(\\hat{\\lambda},\\hat{\\gamma}\\right)\n\\tag{5.31}\n\\end{align}\\]\\(\\hat{t}(p)\\) 本身的方差根据第 2 章式 2.8 的结果中得到，即\\[\\begin{align}\n\\text{var}\\left\\{\\hat{t}(p)\\right\\}&\\approx\\hat{t}(p)^2\\text{var}\\left\\{\\log\\hat{t}(p)\\right\\}\n\\tag{5.32}\n\\end{align}\\]使用式 (5.31)\\[\\begin{aligned}\\mathrm{var}\\left\\{\\hat{t}(p)\\right\\}\\approx&\\,\\frac{\\hat{t}(p)^2}{\\hat{\\lambda}^2\\hat{\\gamma}^4}\\left\\{\\hat{\\gamma}^2\\operatorname{var}(\\hat{\\lambda})+\\hat{\\lambda}^2\\left(c_p-\\log\\hat{\\lambda}\\right)^2\\operatorname{var}(\\hat{\\gamma})\\right.\\\\&+\\left.2\\hat{\\lambda}\\hat{\\gamma}\\left(c_p-\\log\\hat{\\lambda}\\right)\\text{ cov}\\left(\\hat{\\lambda},\\hat{\\gamma}\\right)\\right\\}\n\\end{aligned}\\]\\(\\hat{t}(p)\\) 的标准误是该式的平方根，由下式给出\\[\\begin{align}\n\\mathrm{se}\\left\\{\\hat{t}(p)\\right\\}\\approx&\\,\\frac{\\hat{t}(p)}{\\hat{\\lambda}\\hat{\\gamma}^2}\\left\\{\\hat{\\gamma}^2\\operatorname{var}(\\hat{\\lambda})+\\hat{\\lambda}^2\\left(c_p-\\log\\hat{\\lambda}\\right)^2\\operatorname{var}(\\hat{\\gamma})\\right.\\\\&+\\left.2\\hat{\\lambda}\\hat{\\gamma}\\left(c_p-\\log\\hat{\\lambda}\\right)\\text{ cov}\\left(\\hat{\\lambda},\\hat{\\gamma}\\right)\\right\\}^{\\frac12}\n\\tag{5.33}\n\\end{align}\\]注意，对于指数分布的特殊情况，其中形状参数 \\(\\gamma=1\\)，根据式 (5.33) ，第 \\(p\\)个百分位数估计的标准误为\\[\\frac{\\widehat{t}(p)}{\\widehat{\\lambda}}\\text{ se }(\\hat{\\lambda})\\]现在使用式 (5.18)\\[\\begin{aligned}\\text{se }(\\hat{\\lambda})=\\hat{\\lambda}/\\sqrt{r}\\end{aligned}\\]其中 \\(r\\) 是数据集中的死亡数，因此\\[\\begin{aligned}\\text{se}\\left\\{\\hat{t}(p)\\right\\}=\\hat{t}(p)/√r\\end{aligned}\\]如式 (5.22) 中所示。根据 \\(\\operatorname{log}t(p)\\) 的相应置信限，可以找到 Weibull 分布第 \\(p\\) 个百分位的 \\(100(1−\\alpha)\\%\\) 置信区间。上下限为\\[\\begin{aligned}\\log\\hat{t}(p)\\pm z_{\\alpha/2}\\text{se}\\{\\log\\hat{t}(p)\\}\\end{aligned}\\]其中 \\(\\text{se}\\left\\{\\log\\hat{t}(p)\\right\\}\\) 根据式 (5.32)，为\\[\\begin{align}\n\\text{se}\\left\\{\\log\\hat{t}(p)\\right\\}&=\\frac{1}{\\hat{t}(p)}\\text{ se}\\left\\{\\hat{t}(p)\\right\\}\n\\tag{5.34}\n\\end{align}\\]\\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。第 \\(p\\) 个百分位数 \\(t(p)\\) 对应的 \\(100(1−\\alpha)\\%\\) 置信区间为 \\(\\hat{t}(p)\\exp\\left[\\pm z_{\\alpha/2}\\text{ se}\\{\\log\\hat{t}(p)\\}\\right]\\)。示例 5.4  (停用宫内节育器的时间) 在示例 5.1 中，发现指数分布为 18 名宫内节育器使用者的停用时间数据提供了令人满意的模型。为了进行比较，为该数据拟合 Weibull 分布。使用计算机软件对该分布进行拟合，从结果输出中，发现分布的尺度参数估计为 \\(\\hat{\\lambda}=0.000454\\) ，而形状参数估计为 \\(\\hat{\\gamma}=1.676\\)。这些估计的标准误分别为 \\(\\text{se}(\\hat{\\lambda})=0.000965\\) 和 \\(\\text{se}\\left(\\hat{\\gamma}\\right)=0.460\\)。值得注意的是，形状参数 \\(\\gamma\\) 的近似置信限 \\(\\hat{\\gamma}\\pm1.96\\text{se}\\left(\\hat{\\gamma}\\right)\\) 包括 1，这表明指数分布将为停用时间提供一个满意的模型。通过将这些估计代入式 (5.4) 和 (5.5)，可以获得风险函数和生存函数的估计，其中\\[\\hat{h}(t)=\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}\\boldsymbol{-}1}\\]以及\\[\\hat{S}(t)=\\exp\\left(-\\hat{\\lambda}t^{\\boldsymbol{\\hat{\\gamma}}}\\right)\\]这两个函数如图 5.13 和 5.14 所示。\n尽管停用时间的百分位数可以从图 5.14 中的生存函数估计中读取，但使用式 (5.28) 可以更好地估计它们。在 Weibull 分布下，可以使用式 (5.29) 估计中位停用时间，并由下式给出\\[\\hat{t}(50)=\\left\\{\\frac{1}{0.000454}\\log2\\right\\}^{1/1.676}=79.27\\]作为检查，请注意这与图 5.14 中 \\(\\hat{S}(t)=0.5\\) 对应的停用时间值完全一致。经过大量算术后，根据式 (5.33) 中得到该估计的标准误为\\[\\begin{aligned}\\text{se}\\left\\{\\hat{t}(50)\\right\\}=15.795\\end{aligned}\\]为了获得中位停用时间的 95% 置信区间，需要 \\(\\log \\widehat{t}(50)\\) 的标准误。根据式 (5.34)，\\[\\begin{aligned}\\text{se}\\left\\{\\log\\hat{t}(50)\\right\\}=\\frac{15.795}{79.272}=0.199\\end{aligned}\\]因此，所需的对数中位停用时间置信限为 \\(\\log 79.272\\pm 1.96\\times 0.199\\)，即 \\((3.982, 4.763)\\)。通过对这些限值求指数得出的真实中位停用时间的相应区间估计为 \\((53.64, 117.15)\\)。这意味着 54 天到 117 天的区间有 95% 的可能性包含中位停用时间的真实值。由于数据集中实际停用次数较少，因此该区间相当宽。将这些结果与示例 5.3 中发现的结果进行比较十分有趣，后者使用指数分布对停用时间进行建模。两模型的中位生存时间估计非常相似，指数模型为 80.6 天，Weibull 模型为 79.3 天。然而，当生存时间假设为指数分布时，中位生存时间估计的标准误为 26.8 天，在 Weibull 模型下仅为 15.8 天。因此，当假设停用时间具有 Weibull 分布时，可以更精确地估计中位数。停用时间分布的其他百分位数及其标准误和置信区间，可以以类似的方式得到。例如，第 90 个百分位（即研究中 10% 的受试者继续使用宫内节育器的时间）为 162.23 天，真实百分位数的 95% 置信限为 95.41 至 275.84 天。请注意，此置信区间的宽度大于中位停用时间的宽度，这反映出中位数的估计比其他百分位更精确。","code":""},{"path":"chap5.html","id":"sec5-5","chapter":"第 5 章 参数回归模型","heading":"5.5 用于两组比较的 Weibull 模型","text":"我们在 3.1 节中看到，比较两组生存时间的一个方便的通用模型是比例风险模型。在这里，这两组记为 Group 和 Group II，\\(X\\) 是一个指示变量，如果一个个体在 Group 则取值为 0，如果一个个体在 Group II 则取值为 1. 在比例风险模型下，第 \\(\\) 个个体在时间 \\(t\\) 的死亡风险由下式给出\\[\\begin{align}\nh_i(t)=e^{\\boldsymbol{\\beta}x_i}h_0(t)\n\\tag{5.35}\n\\end{align}\\]因此，Group 个体在时间 \\(t\\) 的风险为 \\(h_0(t)\\)，Group II 个体的风险为 \\(\\psi h_{0}(t)\\)，其中 \\(\\psi=\\exp(\\beta)\\)。量 \\(\\beta\\) 是 Group II 个体的风险与 Group 个体风险之比的对数。我们现在将做出额外的假设，即 Group 个体的生存时间具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布。使用式 (5.35)，该组个体的风险函数为 \\(h_0(t)\\)，其中 \\(h_0(t)=\\lambda\\gamma t^{\\gamma-1}\\)。现在，同样根据式 (5.35)，Group II 的风险函数为 \\(\\psi h_0(t)\\)，即 \\(\\psi\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\)。这是具有尺度参数 \\(\\psi\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布的风险函数。因此，我们得出的结果是，如果 Group 个体的生存时间具有形状参数为 \\(\\gamma\\) 的 Weibull 分布，并且 Group II 个体的死亡风险与 Group 个体的死亡风险在时间 \\(t\\) 成比例，Group II 的生存时间也将服从形状参数为 \\(\\gamma\\) 的 Weibull 分布。称 Weibull 分布具有比例风险性 (proportional hazards property). 这一性质是 Weibull 分布在生存数据分析中如此重要的另一个原因。","code":""},{"path":"chap5.html","id":"sec5-5-1","chapter":"第 5 章 参数回归模型","heading":"5.5.1 探索性分析","text":"当生存时间的单个样本具有 Weibull 分布 \\(W(\\lambda, \\gamma)\\) 时，5.2 节中描述的对数累积风险图将给出一条截距为 \\(\\log\\lambda\\) 以及斜率为 \\(\\gamma\\) 的直线。因此，如果 Group II 的生存时间具有 \\(W(\\psi\\lambda, \\gamma)\\) 分布，正如在式 (5.35) 中的比例风险模型下一样，对数累积风险图将给出一条直线，斜率也为 \\(\\gamma\\)，但截距为 \\(\\log \\psi + \\log \\lambda\\)。 如果在两组中绘制对数累积风险函数估计关于对数生存时间的图形，若得到平行直线，则意味着比例风险模型以及 Weibull 生存时间的假设是成立的。两条线的垂直间隔提供了相对风险的对数 \\(\\beta=\\log \\psi\\) 的估计。如果对数累积风险图中的两条线基本上是直的，但不平行，则意味着两组中的形状参数 \\(\\gamma\\) 不同，并且风险不再成比例。如果线不是特别直，则 Weibull 模型可能不合适。然而，如果曲线可认为是平行的，这将意味着比例风险模型是有效的，那么第 3 章中讨论的 Cox 回归模型可能更令人满意。示例 5.5  (患乳腺癌妇女的预后) 在本例中，我们研究 Weibull 比例风险模型是否适用于示例 1.2 中乳腺癌症患者生存时间的数据。这些数据根据肿瘤是阳性染色还是阴性染色进行了分类。各组女性生存函数的 Kaplan-Meier 估计如图 2.9 所示。根据这些估计，可以估计对数累积风险，并绘制关于 \\(\\log t\\) 的图形。由此产生的对数累积风险图如图 5.15 所示。\n在该图中，对应于两个染色组的线相当直。这意味着每组女性生存时间的 Weibull 分布假设是非常合理的。而且，两条线的斜率非常相似，这意味着比例风险模型是有效的。两条线的垂直间隔提供了对数相对风险的估计。根据图 5.15，两条直线之间的垂直距离约为 1.0，因此粗略地估计风险比为 \\(e^{1.0} = 2.72\\)。与阴性染色组相比，阳性染色组中的女性在任何时候的死亡风险似乎是阴性组的近三倍。在后续的示例 5.6 和示例 5.7 中，为该数据拟合指数模型和 Weibull 模型，可以获得更准确的相对风险估计。","code":""},{"path":"chap5.html","id":"sec5-5-2","chapter":"第 5 章 参数回归模型","heading":"5.5.2 拟合模型","text":"式 (5.35) 中的比例风险模型可以使用最大似然法进行拟合。为了说明这一程序，我们考虑每组生存时间呈指数分布的情况。假设 Group 中的 \\(n_1\\) 个个体的观测结果可以表示为 \\((t_{i1},\\delta_{i1}),=1,2,\\ldots,n_1\\)，如果该组中第 \\(\\) 个个体的生存时间删失，则 \\(\\delta_{i1}=0\\)，如果该时间是死亡时间，则 \\(\\delta_{'1}=1\\)。类似地，设 \\((t_{'2},\\delta_{'2}),'=1,2,\\ldots,n_2\\) 是来自 Group II 中的 \\(n_2\\) 个个体的观测结果。对于 Group 中的个体，风险函数取为 \\(\\lambda\\)，概率密度函数和生存函数由下式给出\\[\\begin{aligned}f(t_{i1})=\\lambda e^{-\\lambda t_{i1}},\\quad\\quad S(t_{i1})=e^{-\\lambda t_{i1}}\\end{aligned}\\]而对于 Group II，风险函数为 \\(\\psi\\lambda\\)，概率密度函数和生存函数为\\[\\begin{aligned}f(t_{'2})=\\psi\\lambda e^{-\\psi\\lambda t_{'2}},\\quad\\quad S(t_{'2})=e^{-\\psi\\lambda t_{'2}}\\end{aligned}\\]使用式 (5.14)，\\(n_1+n_2\\) 个观测的似然 \\(L(\\psi,\\lambda)\\) 为\\[\\begin{aligned}\\prod_{=1}^{n_1}\\left\\{\\lambda e^{-\\lambda t_{i1}}\\right\\}^{\\delta_{i1}}\\left\\{e^{-\\lambda t_{i1}}\\right\\}^{1-\\delta_{i1}}\\prod_{'=1}^{n_2}\\left\\{\\psi\\lambda e^{-\\psi\\lambda t_{'2}}\\right\\}^{\\delta_{'2}}\\left\\{e^{-\\psi\\lambda t_{'2}}\\right\\}^{1-\\delta_{'2}}\\end{aligned}\\]可简化为\\[\\begin{aligned}\\prod_{=1}^{n_1}\\lambda^{\\delta_{i1}}e^{-\\lambda t_{i1}}\\prod_{'=1}^{n_2}(\\psi\\lambda)^{\\delta_{'2}}e^{-\\psi\\lambda t_{'2}}\\end{aligned}\\]如果两组的实际死亡数分别为 \\(r_1\\) 和 \\(r_2\\)，那么 \\(r_1=\\sum_i\\delta_{{}1}\\) 以及 \\(r_2=\\sum_i\\delta_{{}2}\\)，对数似然函数为\\[\\begin{aligned}\n\\operatorname{log} L(\\psi,\\lambda)=r_{1}\\operatorname{log}\\lambda-\\lambda\\sum_{=1}^{n_1} t_{i1}+r_{2}\\operatorname{log}(\\psi\\lambda)-\\psi\\lambda\\sum_{'=1}^{n_2} t_{^{\\prime}2}  \\\\\n\\end{aligned}\\]现在将 Group 和 Group II 中个体的总的已知生存时间分别记作 \\(T_1,T_2\\)。那么，\\(T_1,T_2\\) 是每组中未删失和删失生存时间的总和，因此对数似然函数变为\\[\\begin{aligned}\\log L(\\psi,\\lambda)=(r_1+r_2)\\log\\lambda+r_2\\log\\psi-\\lambda(T_1+\\psi T_2)\\end{aligned}\\]为了获得该函数为最大值的参数估计，关于 \\(\\psi\\) 和 \\(\\lambda\\) 微分，并将导数设为零。由此得到的方程组为\\[\\begin{align}\n\\frac{r_2}{\\hat\\psi}-\\hat\\lambda T_2&=0\\tag{5.36}\\\\\\frac{r_1+r_2}{\\hat\\lambda}-(T_1+\\hat\\psi T_2)&=0\\tag{5.37}\n\\end{align}\\]根据式 (5.36)\\[\\hat{\\lambda}=\\frac{r_2}{\\hat{\\psi}T_2}\\]并代入式 (5.37) 中的 \\(\\hat\\lambda\\)，我们得到\\[\\begin{align}\n\\hat{\\psi}=\\frac{r_2T_1}{r_1T_2}\n\\tag{5.38}\n\\end{align}\\]那么，根据式 (5.36)\\[\\begin{aligned}\\hat{\\lambda}&=r_1/T_1\\end{aligned}\\]这两个估计都有直观的理由。\\(\\hat \\lambda\\) 的估计是 Group 个体平均生存时间的倒数，而相对风险估计 \\(\\hat \\psi\\) 为两组个体的平均生存时间之比。参数估计的渐近方差-协方差阵是信息矩阵的逆矩阵，其元素是从对数似然函数的二阶导数中得到的；见附录 。我们有\\[\\begin{aligned}\\frac{\\mathrm{d}^2\\log L(\\psi,\\lambda)}{\\mathrm{d}\\psi^2}&=-\\frac{r_2}{\\psi^2},\\quad\\frac{\\mathrm{d}^2\\log L(\\psi,\\lambda)}{\\mathrm{d}\\lambda^2}=-\\frac{r_1+r_2}{\\lambda^2},\\quad\\frac{\\mathrm{d}^2\\log L(\\psi,\\lambda)}{\\mathrm{d}\\lambda\\mathrm{d}\\psi}=-T_2\\end{aligned}\\]并且信息矩阵是由这些偏导数期望值的负数组成的矩阵。唯一需要得到期望的二阶导数是关于 \\(\\lambda\\) 和 \\(\\psi\\) 的导数，这需要 \\(\\text{E}(T_2)\\)。当生存时间具有指数分布时，这很简单，但具有 Weibull 分布生存时间的预期值较难计算，如 5.1.2 节所示。由于这个原因，通常通过使用负二阶偏导数的观测作为信息矩阵的近似。因此，观测信息矩阵为\\[\\left.\\boldsymbol{}(\\psi,\\lambda)=\\left(\\begin{array}{cc}r_2/\\psi^2&T_2\\\\T_2&(r_1+r_2)/\\lambda^2\\end{array}\\right.\\right)\\]该矩阵的逆为\\[\\left.\\frac1{(r_1+r_2)r_2-T_2^2\\psi^2\\lambda^2}\\left(\\begin{array}{cc}(r_1+r_2)\\psi^2&-T_2\\psi^2\\lambda^2\\\\-T_2\\psi^2\\lambda^2&r_2\\lambda^2\\end{array}\\right.\\right)\\]\\(\\hat\\psi\\) 和 \\(\\hat \\lambda\\) 的标准误是通过将该矩阵中的 \\(\\psi\\) 和 \\(\\lambda\\) 替换为 \\(\\hat\\psi\\) 和 \\(\\hat \\lambda\\) 并取平方根来求出的。因此，\\(\\hat\\psi\\) 的标准误由下式给出\\[\\begin{aligned}\\text{se}\\left(\\hat{\\psi}\\right)&=\\sqrt{\\frac{(r_1+r_2)\\hat{\\psi}^2}{(r_1+r_2)r_2-T_2^2\\hat{\\psi}^2\\hat{\\lambda}^2}}\\end{aligned}\\]带入表达式分母中的 \\(\\hat\\psi\\) 和 \\(\\hat \\lambda\\) 后，该标准误简化为\\[\\begin{align}\n\\hat{\\psi}\\sqrt{\\frac{r_1+r_2}{r_1r_2}}\n\\tag{5.39}\n\\end{align}\\]类似地，\\(\\hat \\lambda\\) 的标准误为\\[\\text{se }(\\hat{\\lambda})=\\hat{\\lambda}/√r_1\\]这些标准误估计不能直接用于 \\(\\psi\\) 和 \\(\\lambda\\) 的置信区间的构建。原因是这两个参数的值都必须是正的，它们的估计往往具有偏态分布。这意味着，在构建置信区间时使用的正态性假设是不合理的。\\(\\psi\\) 和 \\(\\lambda\\) 估计的对数分布更有可能是对称的，因此使用参数估计的对数的标准误可以找到参数对数的置信限。然后对所得的置信限进行指数运算，以给出参数本身的区间估计。参数估计的对数的标准误可以使用式 (5.21) 中给出的一般结果来找到。因此，\\(\\log \\hat \\psi\\) 的近似方差为\\[\\begin{aligned}\\operatorname{var}\\left(\\log\\hat{\\psi}\\right)&\\approx\\hat{\\psi}^{-2}\\operatorname{var}\\left(\\hat{\\psi}\\right)\\end{aligned}\\]因此 \\(\\log \\hat \\psi\\) 的标准误为\\[\\begin{align}\n\\text{se}(\\log\\hat{\\psi})\\approx\\hat{\\psi}^{-1}\\text{se}(\\hat{\\psi})=\\sqrt{\\frac{r_1+r_2}{r_1r_2}}\n\\tag{5.40}\n\\end{align}\\]相对风险对数的 \\(100(1−\\alpha)\\%\\) 置信区间的上下限为 \\(\\operatorname{log}\\hat{\\psi}\\pm z_{\\alpha/2}\\operatorname{se}\\left(\\operatorname{log}\\hat{\\psi}\\right)\\)，通过对 \\(\\log \\psi\\) 的这些限进行指数运算，可以得到风险比 \\(\\psi\\) 的置信限。如果需要，可以以类似的方式得到 \\(\\lambda\\) 的置信区间。示例 5.6  (患乳腺癌妇女的预后) 现在使用癌症患者生存时间数据说明本节的理论结果。假设每组女性的生存时间呈指数分布，因此，在任何时候，阴性染色组女性的死亡风险为恒定值 \\(\\lambda\\)，而阳性染色组女性为 \\(\\psi\\lambda\\)，其中 \\(\\psi\\) 为风险比。根据第 1 章表 1.2 给出的数据，阴性染色组和阳性染色组的死亡数分别为 \\(r_1=5\\) 和 \\(r_2=21\\)。此外，各组的总生存时间分别为 \\(T_1=1652\\)和 \\(T_2=2679\\) 个月。使用式 (5.38)，相对于阴性染色组，阳性染色组女性的死亡风险估计为\\[\\begin{aligned}\\hat{\\psi}=\\frac{21\\times1652}{5\\times2679}=2.59\\end{aligned}\\]因此，阳性染色组的女性在任何特定时间的死亡风险约为阴性染色组的 2.5 倍。这与示例 5.5 中使用的图形程序中 \\(\\psi\\) 的估计 2.72 一致。接下来，使用式 (5.39)，风险比估计的标准误由下式给出\\[\\begin{aligned}\\text{se}\\left(\\hat{\\psi}\\right)=2.59\\sqrt{\\frac{5+21}{5\\times21}}=1.289\\end{aligned}\\]为了获得真实相对风险的 95% 置信区间，需要 \\(\\log \\hat\\psi\\) 的标准误。使用式 (5.40)，得到 \\(\\text{se }(\\log\\hat{\\psi})=0.498\\)，因此 \\(\\log{\\psi}\\) 的 95% 置信限为 \\(\\log(2.59)\\pm1.96\\text{se}(\\log\\hat{\\psi})\\)，即 \\((0.98,6.87)\\)。对数相对风险的置信区间为 \\((−0.024,1.927)\\) ，相对风险本身的区间估计为 \\(\\log(2.59)\\pm1.96\\text{se}(\\log\\hat{\\psi})\\)，即 \\((0.98,6.87)\\)。该区间仅刚刚包括 1，表明肿瘤阳性染色的女性预后比肿瘤阴性染色的女性差。该结果与示例 2.12 中的 log-rank 检验的结果一致，其中在检验无组间差异的假设时获得的 \\(P\\) 值为 0.061.在实践中，我们使用计算机软件来拟合两组生存数据的参数模型，并假设比例风险。当拟合式 (5.35) 中的模型时，可以从输出结果中获得 \\(\\beta,\\lambda\\) 和 \\(\\gamma\\) 的估计及其标准误。然后可能需要进行进一步的计算，以获得相对风险的估计以及该估计值的标准误。具体来说，风险比估计可以通过 \\(\\hat{\\psi}=\\exp(\\hat{\\beta})\\) 获得，并且可以根据下式得到 \\(\\mathrm{se}\\left(\\hat{\\psi}\\right)\\)\\[\\operatorname{se}\\left(\\hat{\\psi}\\right)=\\exp(\\hat{\\beta})\\operatorname{se}\\left(\\hat{\\beta}\\right)\\]这是式 (5.21) 得出的结果。两组生存时间分布的中位数和其他百分位数可以根据 \\(\\hat\\psi\\) 和 \\(\\hat\\lambda\\) 的值来估计。例如，根据式 (5.28)，Group 第 \\(p\\) 个百分位数估计为\\[\\hat{t}(p)=\\left\\{\\frac{1}{\\hat{\\lambda}}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\hat{\\gamma}}\\]对于 Group II 则为\\[\\hat{t}(p)=\\left\\{\\frac{1}{\\hat{\\psi}\\hat{\\lambda}}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\hat{\\gamma}}\\]一旦得出模型中参数估计的方差和协变量，就可以使用类似于式 (5.33) 中的表达式来获得每组百分位数估计的标准误。将不会给出每组生存时间分布百分位数标准误的具体结果。相反，可以使用式 (5.33) 中给出的拟合 Weibull 模型后第 \\(p\\) 个百分位数的标准误的一般表达式。示例 5.7  (患乳腺癌妇女的预后) 在示例 5.5 中，发现 Weibull 比例风险模型适用于两组乳腺癌患者的生存时间数据。在此模型下，在时间 \\(t\\) 时，对于肿瘤染色呈阴性的患者，死亡风险为 \\(\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\)，对于肿瘤染色呈阳性的患者，死亡风险为 \\(\\psi\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\)。拟合的 Weibull 分布的形状参数估计为 \\(\\hat\\gamma = 0.937\\)。Group 女性的尺度参数估计为 \\(\\hat\\lambda = 0.00414\\)，Group II 女性的尺度参数估计为 \\(\\hat\\lambda\\hat\\psi = 0.0105\\)。该 Weibull 模型下的风险比估计为 \\(\\hat \\psi = 2.55\\)，这与例 5.6 中假设生存时间呈指数分布获得的值相差不大。将 \\(\\hat\\gamma = 0.937\\) 和 \\(\\hat\\lambda = 0.00414\\) 代入式 (5.29)，得出 Group 女性的中位生存时间为 235.89. Group II 女性的中位生存时间估计可通过将 \\(\\hat\\gamma = 0.937\\) 和 \\(\\hat\\lambda = 0.0105\\) 代入该方程得出，并给出中位生存时间估计为 87.0. 肿瘤呈阳性染色的女性中位生存时间约为肿瘤呈阴性染色的女性的三分之一。使用式 (5.33) 中给出的中位生存时间标准误的一般结果，通过取 \\(p = 50,\\hat\\gamma = 0.937\\) 并依次取 \\(\\hat\\lambda = 0.00414\\) 和 \\(0.0105\\) 来找到两个中位的标准误。结果分别为 114.126 和 20.550.如 5.4.3 节中所述，每组女性的真实中位生存时间的 95% 置信限最好通过使用中位对数来获得。\\(\\log\\hat{t}(50)\\) 的标准误可使用式 (5.34) 求得，其中\\[\\begin{aligned}\\text{se}\\left\\{\\log\\hat{t}(50)\\right\\}=\\frac{1}{\\hat{t}(50)}\\text{se}\\left\\{\\hat{t}(50)\\right\\}\\end{aligned}\\]然后对 \\(\\log t(50)\\) 的置信限进行指数运算以给出 \\(t(50)\\) 本身的相应置信限。在本示例中，两组女性的真实中位生存时间的 95% 置信区间分别为 \\((91.4, 608.9)\\) 和 \\((54.8, 138.3)\\)。请注意，阳性染色患者的中位生存时间的置信区间比阴性染色女性的中位生存时间的置信区间窄得多。这是因为肿瘤呈阴性染色的女性未删失生存时间相对较少。","code":""},{"path":"chap5.html","id":"sec5-6","chapter":"第 5 章 参数回归模型","heading":"5.6 Weibull 比例风险模型","text":"式 (5.35) 中用于比较两组生存数据的模型可以很容易地推广为形似 3.1.2 节中描述的 Cox 回归模型的模型。假设为 \\(n\\) 个个体记录了 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 的值 \\(x_1, x_2,...,x_p\\)。在比例风险模型下，第 \\((=1,2,\\ldots,n)\\) 个个体在 \\(t\\) 时刻的死亡风险为\\[\\begin{align}\nh_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})h_0(t)\n\\tag{5.41}\n\\end{align}\\]尽管该模型形似式 (3.3) 中给出的模型，但有一个根本的区别：基线风险函数 \\(h_0(t)\\) 的指定。在 Cox 回归模型中，\\(h_0(t)\\) 的形式是未指定的，函数的形状本质上由实际数据决定。在本节考虑的模型中，假设生存时间具有 Weibull 分布，这对 \\(h_0(t)\\) 施加了特定的参数形式。考虑一个个体，其在式 (5.41) 模型中的 \\(p\\) 个解释变量的值均为零。该个体的风险函数是 \\(h_0(t)\\)。如果该个体的生存时间服从尺度参数为 \\(\\lambda\\) 和形状参数为 \\(\\gamma\\) 的 Weibull 分布，那么风险函数为\\[h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma-}1}\\]使用式 (5.41)，研究中第 \\(\\) 个个体的风险函数由下式给出\\[\\begin{align}\nh_{\\boldsymbol{}}(t)=\\exp(\\boldsymbol{\\beta'x}_{{}})\\lambda\\gamma t^{\\gamma-1}\n\\tag{5.42}\n\\end{align}\\]其中 \\(\\boldsymbol{\\beta'x}_{{}}\\) 代表 \\(\\beta_{1}x_{1i}+\\beta_{2}x_{2i}+\\cdots+\\beta_{p}x_{pi}\\)。从该风险函数的形式可以看出，研究中第 \\(\\) 个个体的生存时间服从尺度参数为 \\(\\lambda\\exp(\\boldsymbol{\\beta'x_i})\\) 和形状参数为 \\(\\gamma\\) 的 Weibull 分布。这也是 Weibull 分布比例风险性的体现。该结果表明，模型中解释变量的作用是改变分布的尺度参数，而形状参数保持不变。使用式 (1.6) 得到与式 (5.42) 中给出的风险函数相对应的生存函数，结果是\\[\\begin{align}\nS_i(t)=\\exp\\left\\{-\\exp(\\boldsymbol{\\beta'x}_i)\\lambda t^\\gamma\\right\\}\n\\tag{5.43}\n\\end{align}\\]","code":""},{"path":"chap5.html","id":"sec5-6-1","chapter":"第 5 章 参数回归模型","heading":"5.6.1 拟合模型","text":"Weibull 比例风险模型是通过构建 \\(n\\) 个观测的似然函数来拟合的，并使该函数关于未知参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p,\\lambda\\) 和 \\(\\gamma\\) 最大化。由于每个个体的风险函数和生存函数不同，因此式 (5.15) 中的似然函数现在写为\\[\\begin{align}\n\\prod_{=1}^n\\left\\{h_i(t_i)\\right\\}^{\\delta_i}S_i(t_i)\n\\tag{5.44}\n\\end{align}\\]将对数似然函数（而不是似然本身）关于未知参数最大化。根据式 (5.44)，对数似然为\\[\\begin{aligned}\\sum_{=1}^n[\\delta_i\\log h_i(t_i)+\\log S_i(t_i)]\\end{aligned}\\]将式 (5.42) 和 (5.43) 中的 \\(h_i(t_i)\\) 和 \\(S_i(t_i)\\) 代入后，对数似然变为\\[\\begin{aligned}\\sum_{=1}^n\\left[\\delta_i\\{\\boldsymbol{\\beta'x}_i+\\log(\\lambda\\gamma)+(\\gamma-1)\\log t_i\\}-\\lambda\\exp(\\boldsymbol{\\beta'x}_i)t^\\gamma\\right]\\end{aligned}\\]可以写成\\[\\begin{align}\n\\sum_{=1}^n\\left[\\delta_i\\{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i+\\log(\\lambda\\gamma)+\\gamma\\log t_i\\}-\\lambda\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)t^\\gamma\\right]-\\sum_{=1}^n\\delta_i\\log t_i\n\\tag{5.45}\n\\end{align}\\]该表达式中的最后一项 \\(-\\sum_{=1}^n\\delta_i\\log t_i\\) 不涉及任何未知参数，并且可以从似然中省略。所得对数似然函数为\\[\\begin{align}\n\\sum_{=1}^n\\left[\\delta_i\\{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i+\\log(\\lambda\\gamma)+\\gamma\\log t_i\\}-\\lambda\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)t^\\gamma\\right]\n\\tag{5.46}\n\\end{align}\\]它与根据式 (5.45) 中给出的完全对数似然获得的值相差 \\(\\sum_{=1}^n\\delta_i\\log t_i\\)。当使用计算机软件拟合 Weibull 比例风险模型时，对数似然通常根据式 (5.46) 计算。该表达式也将用于本书给出的示例中。拟合参数比例风险模型的计算机输出通常包括参数估计的标准误，从中可以得到相对风险的置信区间以及生存时间分布的中位数和其他参数。\n具体而言，假设式 (5.42) 模型中参数估计为 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p,\\hat{\\lambda}\\) 和 \\(\\hat\\gamma\\)，则研究中第 \\(\\) 个个体（其在模型中解释变量的值为 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\)）的生存函数估计为\\[\\begin{aligned}\\hat{S}_i(t)=\\exp\\left\\{-\\exp(\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi})\\hat{\\lambda}t^{\\hat{\\gamma}}\\right\\}\\end{aligned}\\]相应的风险函数估计为\\[\\begin{aligned}\\hat{h}_i(t)&=\\exp(\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi})\\hat{\\lambda}\\hat{\\gamma}t^{\\boldsymbol{\\gamma}-1}\\end{aligned}\\]这两个函数都是时间 \\(t\\) 的连续函数，对于模型中解释变量具有特定值的个体，该函数可以估计，并关于 \\(t\\) 绘制图形。将式 (5.28) 中的结果推广到尺度参数为 \\(\\lambda\\exp(\\boldsymbol{\\beta'x_i})\\) 的 Weibull 分布的情况，解释变量向量为 \\(\\boldsymbol x_i\\) 的个体生存时间分布的第 \\(p\\) 个百分位数估计为\\[\\begin{align}\n\\hat{t}(p)=\\left\\{\\frac{1}{\\hat{\\lambda}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol x_i)}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\hat{\\gamma}}\n\\tag{5.47}\n\\end{align}\\]因此，该个体中位生存时间估计为\\[\\begin{align}\n\\hat{t}(50)=\\left\\{\\frac{\\log2}{\\hat{\\lambda}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i)}\\right\\}^{1/\\hat{\\gamma}}\n\\tag{5.48}\n\\end{align}\\]\\(\\hat t(p)\\) 的标准误和 \\(t(p)\\) 的相应区间估计在 5.6.2 节中推导。","code":""},{"path":"chap5.html","id":"sec5-6-2","chapter":"第 5 章 参数回归模型","heading":"5.6.2 Weibull 模型百分位数的标准误","text":"如 5.4.3 节所述，Weibull 比例风险模型生存时间分布的第 \\(p\\) 个百分位数估计的标准误 \\(\\hat{t}(p)\\)，如式 (5.47) 所示，是根据 \\(\\log \\hat t(p)\\) 的方差中得出的。记\\[\\begin{aligned}c_p=\\log\\log\\left(\\frac{100}{100-p}\\right)\\end{aligned}\\]我们根据式 (5.47) 得到\\[\\begin{align}\n\\log\\hat{t}(p)=\\frac1{\\hat{\\gamma}}\\left(c_p-\\log\\hat{\\lambda}-\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i\\right)\n\\tag{5.49}\n\\end{align}\\]这是 \\(p + 2\\) 个参数估计 \\(\\hat{\\lambda},\\hat{\\gamma}\\) 和 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 的函数，该函数的近似方差可以通过式 (5.30) 中结果的进一步推广来求出，这种推广最好用矩阵形式表示。假设 \\(\\hat{\\boldsymbol \\theta}\\) 是由 \\(k\\) 个参数估计 \\(\\hat{\\theta}_1,\\hat{\\theta}_2,\\ldots,\\hat{\\theta}_k\\) 构成的向量，\\(g(\\hat{\\boldsymbol \\theta})\\) 是这 \\(k\\) 个估计的函数，则 \\(g(\\hat{\\boldsymbol \\theta})\\) 的近似方差由下式给出：\\[\\begin{align}\n\\operatorname{var}\\left\\{g(\\hat{\\boldsymbol{\\theta}})\\right\\}\\approx\\boldsymbol{d}(\\hat{\\boldsymbol{\\theta}})'\\operatorname{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\boldsymbol{d}(\\hat{\\boldsymbol{\\theta}})\n\\tag{5.50}\n\\end{align}\\]其中 \\(\\operatorname{var}(\\hat{\\boldsymbol{\\theta}})\\) 为 \\(\\hat{\\boldsymbol \\theta}\\) 中的估计的 \\(k\\times k\\) 方差-协方差阵，\\(\\boldsymbol{d}(\\hat{\\boldsymbol{\\theta}})\\) 为具有 \\(k\\) 个分量的向量，其中第 \\(\\) 个元素为\\[\\left.\\frac{\\partial g(\\hat{\\boldsymbol{\\theta}})}{\\partial\\hat{\\theta}_i}\\right|_{\\hat{\\boldsymbol{\\theta}}}\\]其中 \\(=1,2,\\ldots,k\\)。我们现在将 \\(\\boldsymbol V\\) 记作 \\(\\hat{\\lambda},\\hat{\\gamma}\\) 和 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 的 \\((p +2) \\times (p + 2)\\) 的方差-协方差矩阵。接下来，根据式 (5.49)，\\(\\log \\hat t(p)\\) 关于这些参数估计的导数为：\\[\\begin{aligned}\n&\\begin{aligned}\\frac{\\partial\\log\\widehat{t}(p)}{\\partial\\hat{\\lambda}}\\end{aligned} =-\\frac1{\\hat{\\lambda}\\hat{\\gamma}}  \\\\\n&\\begin{aligned}\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\gamma}}\\end{aligned} =-\\frac{c_p-\\log\\hat{\\lambda}-\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i}{\\hat{\\gamma}^2}  \\\\\n&\\begin{aligned}\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\beta}_j}\\end{aligned} =-\\frac{x_{ji}}{\\hat{\\gamma}}\n\\end{aligned}\\]其中 \\(j=1,2,\\ldots,p\\)，\\(x_{ji}\\) 为 \\(\\boldsymbol x_i\\) 的第 \\(j\\) 个分量。式 (5.50) 中的向量 \\(\\boldsymbol{d}(\\hat{\\boldsymbol{\\theta}})\\) 可表示为 \\(-\\hat{\\gamma}^{-1}\\boldsymbol{d}_0\\)，其中 \\(\\boldsymbol{d}_0\\) 的分量为 \\(\\hat{\\lambda}^{-1},\\hat{\\gamma}^{-1}\\{c_p-\\log\\hat{\\lambda}-\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i\\}\\) 以及 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\)。那么 \\(\\log \\hat t(p)\\) 的标准误为\\[\\begin{align}\n\\text{se }\\left\\{\\log\\hat{t}(p)\\right\\}=\\hat{\\gamma}^{-1}√\\left(\\boldsymbol{d'}_0\\boldsymbol{Vd}_0\\right)\n\\tag{5.51}\n\\end{align}\\]其中 \\(\\hat t(p)\\) 本身的标准误由下式获得：\\[\\begin{align}\n\\text{se}\\left\\{\\hat{t}(p)\\right\\}=\\hat{t}(p)\\text{ se }\\left\\{\\log\\hat{t}(p)\\right\\}\n\\tag{5.52}\n\\end{align}\\]请注意，对于不包含解释变量的零模型，式 (5.52) 中的标准误 \\(\\hat t(p)\\) 简化为式 (5.53) 中的结果。\\(\\log t(p)\\) 的置信限可根据 \\(\\log \\hat t(p)\\) 的标准误求出，如式 (5.51) 所示，\\(t(p)\\) 的置信区间可通过对这些置信限进行指数运算得到。","code":""},{"path":"chap5.html","id":"sec5-6-3","chapter":"第 5 章 参数回归模型","heading":"5.6.3 模型的对数线性形式","text":"大多数用于拟合 Weibull 比例风险模型的计算机软件使用的模型形式与 5.6 节中所述的不同。其原因将在 5.11 节中给出，但目前我们观察到式 (5.52) 中的风险函数可表示为\\[\\begin{align}\nh_i(t)&=\\frac{1}{\\sigma t}\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\n\\end{align}\\]式 (5.43) 相应的生存函数为\\[\\begin{aligned}S_i(t)=\\exp\\left\\{-\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\right\\}\\end{aligned}\\]在这些式子中，\\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_p\\) 是模型中 \\(p\\) 个解释变量的系数，其中对于第 \\(\\) 个个体，解释变量的值为 \\(x_{1{}},x_{2{}},\\ldots,x_{{pi}}\\)，且 \\(\\mu,\\sigma\\) 为未知参数。模型这两种表示之间的对应关系满足\\[\\begin{align}\n\\lambda=\\exp(-\\mu/\\sigma),\\quad\\gamma=\\sigma^{-1},\\quad\\beta_j=-\\alpha_j/\\sigma\n\\tag{5.53}\n\\end{align}\\]其中 \\(j=1,2,\\ldots,p\\)，\\(\\mu,\\sigma\\) 分别称为截距和尺度参数。一般来说，使用模型的对数线性形式 (log-linear form) 来估计风险函数、生存函数、生存时间分布的百分位数以及它们的标准误会更直接，相关的表达式将在后面 5.12 节中的式 (5.66), (5.67) 和 (5.69) 给出。这种模型的表示使得在比例风险模型中很难获得对数风险比 \\(\\beta\\) 的置信区间，因为输出中只给出了 \\(\\alpha\\) 的估计的标准误。具体来说，在拟合 Weibull 比例风险模型时，输出通常提供 \\(\\alpha=-\\sigma\\beta\\) 的估计 \\(\\hat{\\alpha}\\) 和 \\(\\hat\\alpha\\) 的标准误。\\(\\beta\\) 的相应估计很容易根据 \\(\\hat{\\beta}=-\\hat{\\alpha}/\\hat{\\sigma}\\) 得到，但 \\(\\hat\\beta\\) 的标准误计算起来比较复杂。为获得 \\(\\hat\\beta\\) 的标准误，我们可以使用 5.4.3 节式 (5.30) 给出的结果。使用这个结果，函数\\[g(\\hat{\\alpha},\\hat{\\sigma})=-\\frac{\\hat{\\alpha}}{\\hat{\\sigma}}\\]的方差的近似为\\[\\begin{align}\n\\left(\\frac{\\partial g}{\\partial\\hat{\\alpha}}\\right)^2\\operatorname{var}\\left(\\hat{\\alpha}\\right)+\\left(\\frac{\\partial g}{\\partial\\hat{\\sigma}}\\right)^2\\operatorname{var}\\left(\\hat{\\sigma}\\right)+2\\left(\\frac{\\partial g}{\\partial\\hat{\\alpha}}\\frac{\\partial g}{\\partial\\hat{\\sigma}}\\right)\\operatorname{cov}\\left(\\hat{\\alpha},\\hat{\\sigma}\\right)\n\\tag{5.54}\n\\end{align}\\]\\(g\\big(\\hat{\\alpha},\\hat{\\sigma}\\big)\\) 关于 \\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 的导数由下式给出\\[\\begin{aligned}\\frac{\\partial g}{\\partial\\hat{\\alpha}}=-\\frac{1}{\\hat{\\sigma}},\\quad\\frac{\\partial g}{\\partial\\hat{\\sigma}}=\\frac{\\hat{\\alpha}}{\\hat{\\sigma}^2}\\end{aligned}\\]因此使用式 (5.54)\\[\\begin{aligned}\\operatorname{var}\\left(-\\frac{\\hat{\\alpha}}{\\hat{\\sigma}}\\right)&\\approx\\left(-\\frac{1}{\\hat{\\sigma}}\\right)^2\\operatorname{var}\\left(\\hat{\\alpha}\\right)+\\left(\\frac{\\hat{\\alpha}}{\\hat{\\sigma}^2}\\right)^2\\operatorname{var}\\left(\\hat{\\sigma}\\right)+2\\left(-\\frac{1}{\\hat{\\sigma}}\\right)\\left(\\frac{\\hat{\\alpha}}{\\hat{\\sigma}^2}\\right)\\operatorname{cov}\\left(\\hat{\\alpha},\\hat{\\sigma}\\right)\\end{aligned}\\]经代数计算后，近似方差变为\\[\\begin{align}\n\\frac1{\\hat{\\sigma}^4}\\left\\{\\hat{\\sigma}^2\\operatorname{var}\\left(\\hat{\\alpha}\\right)+\\hat{\\alpha}^2\\operatorname{var}\\left(\\hat{\\sigma}\\right)-2\\hat{\\alpha}\\hat{\\sigma}\\operatorname{cov}\\left(\\hat{\\alpha},\\hat{\\sigma}\\right)\\right\\}\n\\tag{5.55}\n\\end{align}\\]该函数的平方根就是 \\(\\hat \\beta\\) 的标准误。示例 5.8  (患乳腺癌妇女的预后) 现在使用两组乳腺癌患者的生存时间数据来说明对数风险比标准误的计算。在此示例中，使用 Weibull 比例风险模型的对数线性形式拟合的计算机输出来说明风险比的估计以及估计的标准误的计算。在拟合包含治疗效应（用变量 \\(X\\) 表示，对于阴性染色的女性，\\(X = 0\\)，对于阳性染色，\\(X = 1\\)）的模型时，我们发现 \\(X\\) 的系数估计为 \\(\\hat \\alpha = -0.9967\\)。此外，\\(\\mu\\) 和 \\(\\sigma\\) 的估计分别为 \\(\\hat\\mu = 5.8544\\) 和 \\(\\hat\\sigma = 1.0668\\)。阳性染色女性 (\\(X = 1\\)) 相对于阴性染色女性 (\\(X = 0\\)) 的对数风险比估计为\\[\\begin{aligned}\\hat{\\beta}&=-\\frac{-0.9967}{1.0668}=0.9343\\end{aligned}\\]相应的风险比 \\(\\operatorname{exp}(\\hat{\\beta})=2.55\\)，如示例 5.7 所示。\\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 的标准误通常包含在标准计算机输出中，分别为 0.5441 和 0.1786. 因此，\\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 的方差估计分别为 0.2960 和 0.0319. \\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 之间的协方差通常也可以从计算机软件中找到，尽管它通常不是默认输出的一部分。发现其值为 -0.0213.将 \\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 及其方差和协方差代入表达式 (5.55)，我们得到\\[\\begin{aligned}\\text{var }(\\hat{\\beta})\\approx0.2498\\end{aligned}\\]因此 \\(\\hat\\beta\\) 的标准误为 \\(\\text{se}\\left(\\hat{\\beta}\\right)=0.4998\\)。这可以用于构建相应真实风险比的置信区间。","code":""},{"path":"chap5.html","id":"sec5-6-4","chapter":"第 5 章 参数回归模型","heading":"5.6.4 探索性分析","text":"当我们面对单个生存数据样本时，或者当组别数量较少且每组中有相当多的个体时，用于评估数据是否可以通过 Weibull 分布建模，以及比例风险假设是否有效的图形程序（如 5.2 节和 5.5.1 节所述）非常有效。但是，在死亡数较少且组数相对较多时，可能无法估计每组的生存函数，从而估计对数累积风险函数。例如，考虑表 3.6 给出的肾癌患者的生存时间数据。在这里，根据年龄组和是否进行了肾切除术对个体进行分类，可得到年龄组和肾切除术状态的六种组合。为检验各组生存时间的 Weibull 分布假设，以及各组之间的比例风险假设，需要为每组绘制对数累积风险图。每个年龄组中未进行肾切除术的患者数量都很小，因此无法准确估计这些组的生存函数。如果研究中有更多的人死亡且未进行肾切除术，就有可能可以绘制对数累积风险图。如果该图具有六条平行直线，Weibull 比例风险模型可能是令人满意的。当模型包含连续变量时，首先需要对它们的值进行分组，然后才能获得对数累积风险图。这也可能导致某些组中的个体数量不足，无法估计对数累积风险函数。构建对数累积风险图时，除了使用每种因素水平的组合外，唯一的替代方案就是忽略一些因素。然而，由此产生的图形可能非常具有误导性。例如，若按照 \\(\\) 的水平分组（忽略 \\(B\\)），或者按照 \\(B\\) 的水平分组（忽略 \\(\\)），所得对数累积风险图可能并不会让人怀疑 Weibull 假设或比例风险假设。然而，如果在 \\(\\) 和 \\(B\\) 水平的每个组合下绘制对数累积风险图，该图可能不会显示四条平行线。同理，当忽略 \\(\\) 或 \\(B\\) 时，得到的对数累积风险图可能并不会显示一系列平行的直线，但为 \\(\\) 和 \\(B\\) 的所有组合绘图时，可能会出现平行线。通过以下示例说明这一特性。示例 5.9  (数值说明) 假设将若干个体按照 \\(\\)，\\(B\\) 两因素的水平进行分类，各有两个水平，其生存时间如表 5.1 所示。\n图 5.16 所示的对数累积风险图是根据 \\(\\) 的两个水平分类绘制的，忽略了因素 \\(B\\) 的水平。而图 5.17 则是根据 \\(B\\) 的水平绘制，忽略 \\(\\) 的水平。\n根据图 5.16，没有理由怀疑 \\(\\) 的两个水平上的生存时间的 Weibull 分布假设，并且比例风险的假设显然是站得住脚的。然而，图 5.17 显示的交叉线却强烈表明，当个体根据 \\(B\\) 的水平进行分类时，风险不成比例。当根据 \\(\\) 和 \\(B\\) 的水平对 37 个生存时间进行分类时，出现了不同的情况。基于这四组的对数累积风险图如图 5.18 所示。这四条平行线表明，各组之间比例风险假设的有效性是毋庸置疑的。\n在这个例子中，\\(B\\) （忽略 \\(\\)）的对数累积风险图之所以具有误导性，是因为 \\(\\) 和 \\(B\\) 之间存在交互作用。查看数据后可发现，平均而言，对于 \\(B=1\\) 和 \\(B=2\\) 患者之间生存时间的差异，\\(=2\\) 时的差异大于 \\(=1\\) 的差异。即使对数累积风险图没有理由怀疑 Weibull 比例风险模型的假设，也需要使用 7 章描述的方法来检查拟合模型的有效性。当无法使用对数累积风险图来探索 Weibull 分布是否为生存时间提供了合理的模型时，第 3 章描述的基于 Cox 回归模型的程序可能会有所帮助，即，使用 3.10 节中描述的程序拟合包含所有有意义的解释变量的 Cox 回归模型，并估计基线风险函数。该函数的图形可以表明 Weibull 分布的假设是否成立。具体来说，如果 Cox 模型中估计的基线风险函数递增或递减，则 Weibull 模型可以提供比 Cox 回归模型更简明的基线风险函数的总结。由于拟合的 Cox 模型的基线风险函数估计可能有些不规则，因此将拟合的 Cox 回归模型所得的基线累积风险函数估计或基线生存函数与 Weibull 模型所得的相应函数估计进行比较可能会更有成效。","code":""},{"path":"chap5.html","id":"sec5-7","chapter":"第 5 章 参数回归模型","heading":"5.7 比较替代的 Weibull 比例风险模型","text":"为了确定 Weibull 比例风险模型中应包括哪些解释变量，需要对替代模型进行比较。不同 Weibull 模型之间的比较可以使用类似于 3.5 节中描述的针对 Cox 回归模型的方法。假设一个模型包含另一个模型的解释变量的子集，因此这两个模型是嵌套的。那么可以根据统计量 \\(-2 \\log \\hat{L}\\) 来比较两个模型，其中 \\(\\hat L\\) 是拟合模型下似然函数的最大值。对于包含 \\(p\\) 个解释变量的模型，样本似然是 \\(p + 2\\) 个未知参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p,\\lambda\\) 和 \\(\\gamma\\) 的函数。似然函数的最大值就是似然函数取这些参数的估计 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p,\\hat{\\lambda}\\) 和 \\(\\hat \\gamma\\) 时的函数值。更具体地说，假设模型 (1) 包含 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\)，另一个模型 (2) 包含额外 \\(q\\) 个解释变量 \\(X_{p+1},X_{p+2},\\ldots,X_{p+q}\\)。在这两个模型下第 \\(\\) 个个体的风险函数估计为：模型 (1)：\\(h_i(t)=\\exp\\{\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi}\\}\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}-1}\\)模型 (2)：\\(h_i(t)=\\exp\\{\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_{p+q}x_{p+q,}\\}\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}-1}\\)其中 \\(x_{1i},x_{2i},\\ldots,x_{p+q,}\\) 为第 \\(\\) 个个体 \\(p+q\\) 个解释变量的值。模型 (1) 和模型 (2) 下的最大似然值分别用 \\(\\hat L_1\\) 和 \\(\\hat L_2\\) 表示。\\(-2\\log\\hat{L}_1\\) 与 \\(-2\\log\\hat{L}\\) 值之差，\\(-2\\{\\log\\hat{L}_1-\\log\\hat{L}_2\\}\\)，在声称额外 \\(q\\) 个变量的系数均为零的原假设下，服从自由度为 \\(q\\) 的近似卡方分布。如果与卡方分布的百分位点相比，该差非常大，我们将推断模型中除了已包含的 \\(p\\) 个项之外还需要额外的 \\(q\\) 个项。由于在比较模型时使用了 \\(-2\\log\\hat{L}\\) 的值之差，因此在具体计算 \\(-2\\log\\hat{L}_2\\) 的值时使用的最大对数似然是基于式 (5.45) 还是 (5.46) 并不重要。第 3.5 - 3.8 节中描述的建模过程同样适用于基于 Weibull 比例风险模型的模型，此处不再重复。然而，将使用两个示例说明变量选择策略。示例 5.10  (肾癌的治疗) 第 3 章示例 3.4 介绍了 36 名患者的生存时间数据，这些患者根据年龄组和是否接受肾切除术进行了分类。在该示例中，使用 Cox 比例风险模型对数据进行了分析。在这里，使用 Weibull 比例风险模型进行分析。与示例 3.4 一样，第 \\(j\\) 个年龄组的效应表示为 \\(\\alpha_j\\)，与是否进行肾切除术相关的效应表示为 \\(\\nu_k\\)。第 \\(\\) 个个体的风险函数 \\(h_i(t)\\) 有五个可能的模型，如下所示：模型 (1)：\\(h_{{}}(t) =h_0(t)\\)模型 (2)：\\(h_{{}}(t) =\\exp\\{\\alpha_j\\}h_0(t)\\)模型 (3)：\\(h_{{}}(t) =\\exp\\{\\nu_k\\}h_0(t)\\)模型 (4)：\\(h_{{}}(t) =\\exp\\{\\alpha_j+\\nu_k\\}h_0(t)\\)模型 (5)：\\(h_{}(t)=\\exp\\{\\alpha_j+\\nu_k+(\\alpha\\nu)_{jk}\\}h_0(t)\\)在这些模型中，\\(h_0(t)=\\lambda\\gamma t^{{\\gamma}-1}\\) 为基线风险函数，\\(\\lambda\\) 和 \\(\\gamma\\) 必须与模型的线性部分一起估计。这五个模型的解释在示例 3.4 中给出，可以通过构建与年龄组和肾切除状态对应的指示变量来拟合，如示例 3.4 所示，或使用允许直接拟合因素的软件。为数据拟合 Weibull 比例风险模型后，可得到 \\(-2\\log\\hat{L}\\) 的值。表 5.2 给出了五个感兴趣的模型。\n表 5.2 和本书其他示例中的 \\(-2\\log\\hat{L}\\) 统计量的值是使用式 (5.46) 中的对数似然计算的。因此，这些值可能与某些计算机软件包给出的值相差 \\(2\\sum_{=1}^n\\delta_i\\log t_i\\)，在本例中其值为 136.3733.为模型 (4) 添加交互作用项后，\\(-2\\log\\hat{L}\\) 的值在两个自由度上减小了 4.69. 这种检查下在 10% 的水平上是显著的 (\\(P = 0.096\\))，因此存在一些证明表明年龄组和肾切除状态之间存在交互作用。作为比较，请注意，在示例 3.4 中拟合 Cox 回归模型时，交互作用并不显著 (\\(P = 0.220\\))。通过检查模型下的风险比，可以更详细地研究交互作用。在模型 (5) 下，第 \\(\\) 个个体的风险函数估计为\\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{\\hat{\\alpha}_j+\\hat{\\nu}_k+\\widehat{(\\alpha\\nu)}_{jk}\\}\\hat{h}_0(t)\\end{aligned}\\]其中\\[\\begin{aligned}\\hat{h}_0(t)=\\hat{\\lambda}\\hat{\\gamma}t^{\\boldsymbol{\\gamma}-1}\\end{aligned}\\]为基线风险函数估计。由于基线风险函数相互抵消，第 \\(j(j = 1, 2, 3)\\) 个年龄组以及第 \\(k(k=1,2)\\) 个肾切除状态水平中的个体，相对于最年轻年龄组以及没有接受过肾切除术的个体，风险比的对数为\\[\\begin{align}\n\\hat{\\alpha}_j+\\hat{\\nu}_k+\\widehat{(\\alpha\\nu)}_{jk}-\\hat{\\alpha}_1-\\hat{\\nu}_1-\\widehat{(\\alpha\\nu)}_{11}\n\\tag{5.56}\n\\end{align}\\]如示例 3.4 所示，可以通过定义年龄组的指示变量 \\(A_2\\) 和 \\(A_3\\) 以及肾切除状态的指示变量 \\(N\\) 来拟合数据。在该示例中，\\(A_2\\) 对于第二年龄组中的个体来说是 1，否则为 0；\\(A_3\\) 对于第三年龄组中的个体来说是 1，否则为 0；如果已经进行了肾切除术，则 \\(N\\) 是 1，否则为 0. 因此，拟合项 \\(\\alpha_j\\) 对应于拟合变量 \\(A_2\\) 和 \\(A_3\\)，拟合项 \\(\\nu_k\\) 对应于拟合 \\(N\\)，拟合交互项 \\((\\alpha\\nu)_{jk}\\) 对应于拟合乘积 \\(A_2N = A_2 × N\\) 和 \\(A_3N = A_3 × N\\)。为了拟合模型 (5)，需在模型中包含五个变量 \\(A_2,A_3,N,A_2N,A_3N\\)。通过这种指示变量的选择，当 \\(j\\) 或 \\(k\\) 为 1 时，\\(\\hat{\\alpha}_1=0,\\hat{\\nu}_1=0\\) 以及 \\(\\widehat{\\left(\\alpha\\nu\\right)}_{{j}k}=0\\)。其他的 \\(\\hat{\\alpha}_j,\\hat{\\nu}_k\\) 和 \\(\\widehat{\\left(\\alpha\\nu\\right)}_{jk}\\) 的值是 \\(A_2,A_3,N,A_2N,A_3N\\) 的系数，如表 5.3 所示。\n许多计算机软件包隐式地 (internally) 设置指示变量，因此可以直接从输出中获得表 5.3 中的估计。然而，此处重复先前给出的警告，当使用软件包来拟合因素时，如果要正确解释输出结果，则必须知道用于定义指示变量的编码。当使用上面指定的指示变量时，式 (5.56) 中给出的风险比对数简化为\\[\\hat{\\alpha}_j+\\hat{\\nu}_k+\\widehat{(\\alpha\\nu)}_{jk}\\]其中 \\(j=1,2,3,k=1,2\\)。表 5.4 给出了相对于基线风险的个体风险。基线风险对应于未接受肾切除术的最年轻年龄组中的个体，因此这些个体的风险比为 1.\n该表有助于解释年龄组和肾切除状态之间的交互作用，因为肾切除术的效应对于三个年龄组中的每个个体是不同的。对于两个最小年龄组的患者，肾切除术大大降低了任何特定时间的死亡风险。但对 70 岁以上的患者，进行肾切除术对死亡风险没有太大影响。我们还发现，对于那些未进行肾切除术的患者，年龄对死亡风险影响不大。可以通过类似的方式得到中位生存时间估计。使用式 (5.48)，第 \\(j(j=1,2,3)\\) 个年龄组和第 \\(k(k=1,2)\\) 个肾切除状态的患者的中位生存时间估计为\\[\\hat t(50)=\\left\\{\\frac{\\log2}{\\hat\\lambda\\exp\\{\\hat\\alpha_j+\\hat\\nu_k+\\widehat{(\\alpha\\nu)}_{jk}\\}}\\right\\}^{1/\\hat\\gamma}\\]当对数据拟合包含交互项的模型时，基线风险函数的参数估计为 \\(\\hat\\lambda=0.0188\\) 和 \\(\\hat\\gamma=1.5538\\)。表 5.5 给出了每个年龄组和肾切除状态组合的个体的中位生存时间估计（以月为单位）。\n该表显示，肾切除术可使 70 岁以下患者的中位生存时间延长四倍以上。 70 岁以上患者的中位生存时间受肾切除术影响不大。我们以一个警告来结束这个例子。对于年龄组和肾切除状态的某些组合，特别是未进行肾切除术的个体，风险比和中位生存时间是基于少量的生存时间进行估计的。因此，这类量的标准误估计将会很大（此处未给出）。示例 5.11  (卵巢癌患者的化疗) 卵巢癌患者术后可能会接受一个疗程的化疗。在一项关于两种不同形式化疗的研究中，Edmunson et al. (1979) 比较了单独使用环磷酰胺和环磷酰胺联用阿霉素的抗肿瘤作用。该试验涉及 26 名女性，她们体内仅残留少量肿瘤，且所有直径大于 2 厘米的肿瘤均已经手术切除。术后，根据残留病灶是否完全切除或部分切除，对患者进行分类。在试验开始时还记录了患者的年龄及其表现状态。反应变量为随机接受两种化疗方案之一后的生存天数。数据集中的变量如下：\\(Time\\)：生存时间天数\\(Status\\)：事件指示（0 = 删失，1 = 非删失）\\(Treat\\)：治疗（1 = 单独，2 = 联合）\\(Age\\)：患者年龄\\(Rdisease\\)：残留病灶的程度（1 = 不完全，2 = 完全）\\(Perf\\)：表现状态（1 = 良好，2 = 糟糕）表 5.6 列出了从 Therneau (1986) 获取的数据。\n在对这些数据进行建模时，因素 Treat, RDisease 和 Perf 各有两个水平，并将作为变量进行拟合，这些变量采用表 5.6 中给出的值。当然，这意味着基线风险函数不能直接解释，因为不可能存在这些变量的值都为零的个体。从计算和解释的角度来看，重新定义 (relocate) 变量 Age, Rdisease, Perf 和 Treat 的值更方便。如果使用变量 Age − 50 来代替 Age，并将 Rdisease, Perf 和 Treat 减去 1，则基线风险对应于 50 岁、有不完全残留病灶、表现良好且分配到环磷酰胺组的个体的风险。但是，在本例中将使用原始变量。我们首先确定哪些预后因素与患者的生存时间相关。表 5.7 给出了为该数据拟合一系列模型的统计量 \\(-2\\operatorname{log}\\hat{L}\\) 的值。\n当拟合仅包含 Age, Rdisease 和 Perf 之一的 Weibull 模型时，我们发现 Age 和 Rdisease 都会导致 \\(-2\\operatorname{log}\\hat{L}\\) 的值减小，且在 5% 的水平上显著。在拟合 Age 后，变量 Rdisease 和 Perf 分别进一步将 \\(-2\\operatorname{log}\\hat{L}\\) 减小了 1.903 和 0.048，这两个变量在 10% 的水平上都不显著。此外，当将 Age 添加到已包含 Rdisease 的模型中时，在 1 个自由度上，\\(-2\\operatorname{log}\\hat{L}\\) 的减小量为 13.719，这是非常显著的（\\(P<0.001\\)）。这使我们得出结论：Age 是唯一需要纳入模型的预后变量。现在为模型添加与治疗效应相关的项。在 1 个自由度上，\\(-2\\operatorname{log}\\hat{L}\\) 的值减小了 2.440，不足以使其在 10% 的水平上显著（\\(P=0.118\\)）。因此，只有非常微弱的证据表明两种化疗对死亡风险的效应存在差异。相比之下，当单独的 Treat 被添加到零模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 的值从 59.534 减小为 58.355。与 1 个自由度的卡方分布的百分点相比，1.179 的减小当然并不显著。因此，忽略 Age 会低估治疗效应的大小。为了探讨治疗差异是否随着年龄的增长而一致，为模型添加以 Age 和 Treat 的乘积形成的交互作用项。此时，\\(-2\\operatorname{log}\\hat{L}\\) 仅减小 1.419. 这种减小远未达到显著性，因此没有必要在模型中包括交互作用项。变量 Treat 将保留在模型中，因为兴趣集中在治疗效应的大小上。那么第 \\(\\) 个个体在时间 \\(t\\) 时死亡风险的拟合模型为\\[\\begin{aligned}\\hat{h}_i(t)&=\\exp\\{0.144\\,Age_i-1.023\\,Treat_i\\}\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}-1}\\end{aligned}\\]其中 \\(\\hat{\\lambda}=5.645\\times10^{-9}\\) 以及 \\(\\hat{\\gamma}=1.822\\)。在该模型中，\\(Treat=1\\) 表示单独治疗，\\(Treat=2\\) 表示联合治疗。因此，相对于联合治疗的患者，接受单独治疗的患者的风险的估计为\\[\\begin{aligned}\\hat{\\psi}&=\\exp\\{(-1.023\\times1)-(-1.023\\times2)\\}=2.78\\end{aligned}\\]这意味着接受单独治疗的患者在任何特定时间死亡的可能性是接受联合治疗的患者的近三倍。以这种方式表达，联合化疗治疗的益处似乎是巨大的。从这一表述来看，联合治疗的好处似乎相当大。然而，考虑到这些数据本身固有的变异，这种相对风险仅在 12% 的水平上显著大于 1（\\(P=0.118\\)）。可以根据下式估计给定年龄的患者接受给定治疗的中位生存时间\\[\\hat t(50)=\\left\\{\\frac{\\log2}{\\hat\\lambda\\exp(0.144\\,Age-1.023\\,Treat)}\\right\\}^{1/\\hat\\gamma}\\]例如，一名 60 岁（Age = 60）的女性单独服用环磷酰胺（Treat = 1），中位生存时间估计为 423 天。然而，同龄但接受联合治疗的患者的中位生存时间估计为 741 天，几乎是接受单一治疗患者的两倍。这些估计的置信区间可以使用示例 5.7 中说明的方法得到。","code":""},{"path":"chap5.html","id":"sec5-8","chapter":"第 5 章 参数回归模型","heading":"5.8 Gompertz 比例风险模型","text":"尽管 Weibull 模型是使用最广泛的参数比例风险模型，但 Gompertz 模型已在人口学和生物科学中得到应用。很容易看出 Gompertz 分布具有 5.5.1 节中描述的比例风险性，因为如果我们取 \\(h_0(t)=\\lambda e^{\\theta t}\\)，则 \\(\\psi h_0(t)\\) 也是一个 Gompertz 风险函数，参数为 \\(\\psi\\lambda\\) 和 \\(\\theta\\)。第 \\(\\) 个个体在时间 \\(t\\) 的死亡风险用一般 Gompertz 比例风险模型可表示为\\[\\begin{aligned}h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})\\lambda e^{\\theta t}\\end{aligned}\\]其中 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\) 为第 \\(\\) 个个体 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 的值，\\(=1,2,\\ldots,n\\)，以及 \\(\\beta,\\lambda\\) 和 \\(\\theta\\) 是未知参数。该模型可以通过最大化式 (5.14) 或 (5.15) 中给出的似然函数来拟合。\\(\\beta\\) 系数可解释为对数风险比，使用 5.7 节中描述的方法来比较替代模型。不涉及新的原则。示例 5.12  (卵巢癌患者的化疗) 在关于卵巢癌患者生存时间的示例 5.11 中，拟合了包含变量 Age 和 Treat 的 Weibull 比例风险模型。为进行比较，现在拟合包含这两个变量的 Gompertz 比例风险模型。在此模型下，第 \\(\\) 个患者的拟合风险函数为\\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{0.122Age_i-0.848Treat_i\\}\\hat{\\lambda}\\exp(\\hat{\\theta}t)\\end{aligned}\\]其中 \\(\\hat{\\lambda}=1.706\\times10^{-6}\\) 以及 \\(\\hat{\\theta}=0.00138\\)。将 Treat 添加到仅包含 Age 的 Gompertz 比例风险模型后，\\(-2\\operatorname{log}\\hat{L}\\) 值的变化现在为 1.686 (\\(P = 0.184\\))。因此，与 Weibull 模型相比，该模型下治疗效应的风险比现在为 \\(\\exp(0.848) = 2.34\\)，更小且不那么显著。","code":""},{"path":"chap5.html","id":"sec5-9","chapter":"第 5 章 参数回归模型","heading":"5.9 模型选择","text":"生存数据比例风险模型的一大吸引力在于，不必对生存时间采用特定的概率分布。然而，当 Weibull 分布适用于的观测生存数据时，比例风险模型的参数版本为数据建模提供了更合适的基础。5.5.1 节中描述的基于对数累积风险函数的诊断图可能会揭示 Weibull 生存时间的假设是否合理，但正如已经指出的那样，在存在影响生存时间的解释变量的情况下，这种技术往往提供很少的信息。在这种情况下，为了帮助在 Cox 和 Weibull 比例风险模型之间进行选择，拟合 Cox 回归模型并检查基线风险函数的形状是有用的。拟合的 Weibull 基线累积风险函数或拟合的基线生存函数也可以与 Cox 回归模型的相应估计进行比较，如 5.6.4 节所述。第 7 章将讨论的残差分析可用于研究一个模型是否比另一个模型拟合得更好。然而只有在特殊情况下，模型检查诊断才能提供令人信服的证据，以证明其中一个或另一个更容易被接受。一般来说，除非样本数据包含大量死亡时间，否则很难区分 Cox 和 Weibull 比例风险模型。当两模型拟合优度相差无几时，可以比较两模型线性部分的 \\(\\beta\\) 参数估计的标准误。如果 Weibull 模型的标准误明显小于 Cox 模型的标准误，那么基于效能 (efficiency) 的考虑，应优先选择 Weibull 模型。另一方面，如果这些标准误相似，鉴于 Cox 模型的假设限制性较少，Cox 模型可能是首选模型。","code":""},{"path":"参数回归模型.html","id":"参数回归模型","chapter":"►参数回归模型","heading":"►参数回归模型","text":"","code":""},{"path":"参数回归模型.html","id":"sec5-10","chapter":"►参数回归模型","heading":"5.10 用于两组比较的加速失效时间模型","text":"加速失效时间模型 (accelerated failure time model) 是一种通用的生存数据模型，其中假设在个体上测量的解释变量会在时间尺度上起乘性作用 (act multiplicatively)，从而影响个体在时间轴上前进的速率。这意味着模型可以从疾病进展速度的角度来解释，这种解释具有直观的吸引力。在 5.11 节介绍模型的一般形式之前，先详细描述用于比较两组患者生存时间的加速失效时间模型。假设患者随机接受两种疗法之一，标准疗法 S 或新疗法 N. 在加速失效时间模型下，接受新疗法的个体的生存时间视为接受标准疗法的个体的生存时间的倍数。因此，新疗法的效应是“加速”或“减慢”时间的流逝。在此假设下，接受新疗法的个体在时间 \\(t\\) 后生存的概率就是接受标准疗法的个体在时间 \\(t/\\phi\\) 后生存的概率，其中 \\(\\phi\\) 是未知的正的常数。现在令 \\(S_S(t)\\) 和 \\(S_N(t)\\) 是两个治疗组中个体的生存函数。那么，对于生存时间 \\(t\\) 的任何值，加速失效时间模型指定\\[\\begin{aligned}S_N(t)=S_S(t/\\phi)\\end{aligned}\\]对该模型的一种解释是，接受新疗法的个体的寿命是该个体在标准疗法下的寿命的 \\(\\phi\\) 倍。因此，参数 \\(\\phi\\) 反映了新疗法对生存时间的影响，称为时间比 (time ratio).当关注的终点是患者的死亡时，与接受标准疗法的患者相比，\\(ϕ<1\\) 对应于接受新疗法的患者死亡时间的加速。因此，从延长寿命的角度来看，标准疗法会更合适。另一方面，当终点是从某种疾病状态恢复时，当新疗法的效应是加快恢复时间时，会得到 \\(\\phi<1\\)。此时，新疗法将优于标准疗法。量 \\(\\phi^{-1}\\) 是时间比的倒数，是新疗法生存时间相对于标准疗法生存时间的加速或减速的因子，称为加速因子 (acceleration factor).时间比或加速因子也可用新疗法和标准疗法的患者中位生存时间 \\(t_N (50)\\) 和 \\(t_S(50)\\) 来解释。这些值满足 \\(S_N\\{t_N(50)\\}=S_S\\{t_S(50)\\}=0.5\\)。现在，在加速失效时间模型下，\\(S_N\\{t_N(50)\\}=S_S\\{t_N(50)/\\phi\\}\\)，因此可以得出 \\(t_N (50) = \\phi t_S(50)\\)。换句话说，在加速失效时间模型下，接受新疗法的患者的中位生存时间是接受标准疗法的患者的 \\(\\phi\\) 倍。事实上，同样的论证可用于生存时间分布的任何百分位数。这意味着接受新疗法的患者的生存时间分布的第 \\(p\\) 个百分位数 \\(t_N (p)\\) 满足 \\(t_N (p) = \\phi t_S(p)\\)，其中 \\(t_S(p)\\) 是标准疗法的第 \\(p\\) 个百分位数。该模型的这种解释对临床医生特别有吸引力。根据式 (1.4) 中给出的生存函数、概率密度函数和风险函数之间的关系，两个治疗组中个体的密度和风险函数的关系为\\[\\begin{aligned}f_N(t)=\\phi^{-1}f_S(t/\\phi)\\end{aligned}\\]以及\\[\\begin{aligned}h_N(t)=\\phi^{-1}h_S(t/\\phi)\\end{aligned}\\]现在，让 \\(X\\) 是一个指示变量，对于接受标准疗法的个体，它的值为 0，而对于接受新疗法的个体，它的值为 1. 第 \\(\\) 个个体的风险函数可以表示为\\[\\begin{align}\nh_i(t)=\\phi^{-x_i}h_0(t/\\phi^{x_i})\n\\tag{5.57}\n\\end{align}\\]其中 \\(x_i\\) 是研究中第 \\(\\) 个个体的 \\(X\\) 值。将 \\(x_i=0\\) 代入此表达式，可以看出函数 \\(h_0(t)\\) 是接受标准疗法的个体的风险函数。这再次被称为基线风险函数。接受新治疗个体的风险函数则为 \\(\\phi^{-1}h_0(t/\\phi)\\)。参数 \\(\\phi\\) 必须为非负，因此可以方便地设置 \\(\\phi = e^\\alpha\\)。式 (5.57) 中的加速失效时间模型则变为\\[\\begin{align}\nh_{{}}(t)=e^{{-}\\alpha x_{{}}}h_{{0}}(t/e^{\\alpha x_{{}}})\n\\tag{5.58}\n\\end{align}\\]因此，新疗法中个体的风险函数现在为 \\(e^{\\large-\\alpha}h_0(t/e^{\\large\\alpha})\\)。","code":""},{"path":"参数回归模型.html","id":"sec5-10-1","chapter":"►参数回归模型","heading":"5.10.1 与比例风险模型的比较","text":"为了说明比例风险模型和加速失效时间模型之间的差异，再次假设要对两组（例如 Group 和 Group II）中的个体的生存时间进行建模。进一步假设对于 Group 中的个体，风险函数由下式给出\\[\\left.h_0(t)=\\left\\{\\begin{array}{l}0.5\\text{ }t\\leqslant1\\\\1.0\\text{ }t>1\\end{array}\\right.\\right.\\]其中时间以月为单位。这种类型的风险函数源自分段指数模型 (piecewise exponential model)，因为在每个时间段内的恒定风险意味着生存时间呈指数分布，但两个时间段的均值不同。该模型提供了一种表示可变 (variable) 风险函数的简单方法，并可能适用于存在短期风险恒定但在阈值时间后风险突然增加的情况。现在让 \\(h_P (t)\\) 和 \\(h_A(t)\\) 分别表示比例风险模型和加速失效时间模型下 Group II 个体的风险函数。因此，我们可以写处两个风险函数\\[\\begin{aligned}h_P(t)=\\psi h_0(t)\\end{aligned}\\]以及\\[\\begin{aligned}h_A(t)=\\phi^{-1}h_0(t/\\phi)\\end{aligned}\\]两种模型下 Group II 个体对应的生存函数分别为\\[S_P(t)=\\left[S_0(t)\\right]^\\psi \\]以及\\[\\begin{aligned}S_A(t)=S_0(t/\\phi)\\end{aligned}\\]使用 \\(S(t)=\\exp\\{-\\int_0^th(u)\\mathrm{d}u\\}\\) 这一结果，基线生存函数为\\[\\left.S_0(t)=\\left\\{\\begin{array}{ll}e^{-0.5t}&\\text{}t\\leqslant1\\\\e^{-0.5-(t-1)}&\\text{}t>1\\end{array}\\right.\\right.\\]由于如果 \\(t\\le 1\\) 则 \\(S_0(t)\\geqslant0.61\\)，因此中位数 \\(t\\) 出现在生存函数的第二部分，即满足 \\(\\exp\\{-0.5-(t-1)\\}=0.5\\)。因此，Group 患者的中位生存时间为 1.19 个月。为了说明比例风险模型和加速失效时间模型下的风险函数之间的差异，请考虑 \\(\\psi=\\phi^{-1}=2.0\\) 的特殊情况。在比例风险模型下，Group II 个体的中位生存时间为 0.69 个月，在加速失效时间模型下为 0.60 个月。两种模型下两组的风险函数如图 5.19 所示，相应的生存函数如图 5.20 所示。\n在加速失效时间模型中，Group II 个体的风险从 1.0 增加到 2.0 的时间比比例风险模型更早发生。在加速失效时间模型下，生存函数的“拐点”也发生得更早。","code":""},{"path":"参数回归模型.html","id":"sec5-10-2","chapter":"►参数回归模型","heading":"5.10.2 百分位-百分位图","text":"百分位-百分位图 (percentile-percentile plot)，也称为分位数-分位数图 (quantile-quantile plot) 或 Q-Q 图，提供了一种用于评估两组生存数据的加速失效时间模型有效性的探索性方法。回想一下，分布的第 \\(p\\) 个百分位数是值 \\(t(p)\\)，\\(p\\) 的取值区间为 \\((0, 100)\\)。因此，第 \\(p\\) 个百分位数满足\\[\\begin{aligned}t(p)&=S^{-1}\\left(\\frac{100-p}{100}\\right)\\end{aligned}\\]现在令 \\(t_0(p)\\) 和 \\(t_1(p)\\) 为根据两组生存数据的生存函数估计的第 \\(p\\) 个百分位数。\\(p\\) 的值可以取为 10, 20,…, 90，只要每组的观测数不是太少。因此，两组的百分位数可以表示为\\[\\begin{aligned}t_0(p)=S_0^{-1}\\left(\\frac{100-p}{100}\\right),\\quad t_1(p)=S_1^{-1}\\left(\\frac{100-p}{100}\\right)\\end{aligned}\\]其中 \\(S_0(t)\\) 和 \\(S_1(t)\\) 为两组的生存函数。对于任何给定的 \\(p\\) 值，有\\[\\begin{align}\nS_1\\{t_1(p)\\}=S_0\\{t_0(p)\\}\n\\tag{5.59}\n\\end{align}\\]在加速失效时间模型下，\\(S_1(t) = S_0(t/\\phi)\\)，因此第二组的第 \\(p\\) 个百分位数 \\(t_1(p)\\) 满足\\[\\begin{aligned}S_1\\{t_1(p)\\}=S_0\\{t_1(p)/\\phi\\}\\end{aligned}\\]使用式 (5.59)\\[\\begin{aligned}S_0\\left\\{t_0(p)\\right\\}=S_0\\left\\{t_1(p)/\\phi\\right\\}\\end{aligned}\\]因此\\[\\begin{aligned}t_0(p)=\\phi^{-1}t_1(p)\\end{aligned}\\]现在令 \\(\\hat{t}_0(p),\\hat{t}_1(p)\\) 表示两组的百分位数估计，因此\\[\\begin{aligned}\\hat{t}_0(p)=\\hat{S}_0^{-1}\\left(\\frac{100-p}{100}\\right),\\quad\\hat{t}_1(p)=\\hat{S}_1^{-1}\\left(\\frac{100-p}{100}\\right)\\end{aligned}\\]如果加速失效时间模型合适，对于适当选择的 \\(p\\) 值，\\(\\hat{t}_0(p)\\) 关于 \\(\\hat{t}_1(p)\\) 的图形应给出一条穿过原点的直线。这条线的斜率将是加速因子 \\(\\phi^{−1}\\) 的估计。因此，该图可用于对加速失效时间模型的充分性 (adequacy) 进行探索性评估。从这个意义上说，它类似于对数累积风险图，后者在 4.4.1 节中用于检查比例风险模型的有效性。示例 5.13  (患乳腺癌妇女的预后) 在本例中，最初在第 1 章示例 1.2 给出的阴性或阳性乳腺癌女性的生存时间数据用于说明百分位图。每组生存时间分布的百分位数可以通过各自生存函数的 Kaplan-Meier 估计来估计。这些数据列在表 5.8 中。\n相对较少的死亡次数，以及这两组女性数据的删失模式，意味着并非所有的百分位数都可以估计。因此，百分位图将只有四对点，如图 5.21 所示。这些点落在一条相当直的线上，这表明加速失效时间模型并非不合适。然而，鉴于图中的点数有限，必须谨慎对待这一结论。\n图 5.21 中各点之间的直线的斜率大约为 3，这是加速因子的粗略估计。对此的解释是，与肿瘤呈阴性染色的妇女相比，肿瘤呈阳性染色的妇女的疾病进展加速了三倍。等价地，时间比约为三分之一，因此肿瘤呈阳性染色的女性的寿命约为肿瘤染色呈阴性的女性的三分之一。我们还可以说，肿瘤呈阳性染色的女性的中位生存时间估计约为肿瘤呈阴性染色的女性的三分之一。","code":""},{"path":"参数回归模型.html","id":"sec5-11","chapter":"►参数回归模型","heading":"5.11 一般加速失效时间模型","text":"式 (5.58) 中的加速失效时间模型可以推广到研究中每个个体的 \\(p\\) 个解释变量的值已被记录的情况。根据一般加速失效时间模型 (general accelerated failure time model)，第 \\(\\) 个个体在时刻 \\(t\\) 的风险函数 \\(h_i(t)\\) 为\\[\\begin{align}\nh_i(t)=e^{-\\eta_i}h_0(t/e^{\\eta_i})\n\\tag{5.60}\n\\end{align}\\]其中\\[\\begin{aligned}\\eta_i=\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\end{aligned}\\]为模型的线性部分，其中 \\(x_{ji}\\) 是第 \\((=1,2,\\ldots,n)\\) 个个体第 \\(j\\) 个解释变量 \\(X_j(j=1,2,\\ldots,p)\\) 的值。与比例风险模型一样，基线风险函数 \\(h_0(t)\\) 是 \\(p\\) 个解释变量值全为零的个体在时间 \\(t\\) 的死亡风险。该基线风险是这些个体的生存时间的假定概率分布的风险函数。第 \\(\\) 个个体对应的生存函数为\\[\\begin{aligned}S_i(t)=S_0\\{t/\\exp(\\eta_i)\\}\\end{aligned}\\]其中 \\(S_0(t)\\) 是基线生存函数。参数加速失效时间模型在后文中统一采用模型的对数线性表示。这种表示表明，生存数据的加速失效时间模型与回归分析中使用的一般线性模型密切相关。此外，大多数计算机软件包都采用这种形式的模型来进行加速失效时间建模。","code":""},{"path":"参数回归模型.html","id":"sec5-11-2","chapter":"►参数回归模型","heading":"5.11.1 加速失效时间模型的对数线性形式","text":"考虑随机变量 \\(T_i\\) 的对数线性模型，该模型与生存研究中第 \\(\\) 个个体的寿命相关，模型为\\[\\begin{align}\n\\log T_i=\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i\n\\tag{5.61}\n\\end{align}\\]在此模型中，\\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_p\\) 是 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 值的未知系数，其中第 \\(\\) 个个体的值为 \\(x_{1i}, x_{2i},...,x_{pi}\\)，\\(\\mu,\\sigma\\) 是另外两个参数，分别称为截距和尺度参数。量 \\(\\epsilon_i\\) 是一个随机变量，用于对 \\(\\log T_i\\) 值与模型线性部分的偏差进行建模，并假设 \\(\\epsilon_i\\) 服从特定的概率分布。在该模型的表述中，\\(\\alpha\\) 参数反映了每个解释变量对生存时间的效应；正值表明生存时间随解释变量值的增加而增加，反之亦然。为了阐明模型的这种表示与式 (5.60) 中的表示之间的关系，考虑 \\(T_i\\) 的生存函数，其中 \\(T_i\\) 是与第 \\(\\) 个个体的生存时间相关的随机变量，使用式 (5.61)，这由下式给出\\[\\begin{align}\nS_i(t)=\\mathrm{P}(T_i\\geqslant t)=\\mathrm{P}\\left\\{\\exp(\\mu+\\boldsymbol{\\alpha'x}_i+\\sigma\\epsilon_i)\\geqslant t\\right\\}\n\\tag{5.62}\n\\end{align}\\]其中 \\(\\boldsymbol{\\alpha}'\\boldsymbol{x}_i=\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\)。现在，根据式 (5.62)，\\(S_i(t)\\) 可写为如下形式\\[\\begin{aligned}S_i(t)&=\\text{P}\\left\\{\\exp(\\mu+\\sigma\\epsilon_i)\\geqslant t/\\exp(\\boldsymbol{\\alpha'x}_i)\\right\\}\\end{aligned}\\]以及基线生存函数 \\(S_0(t)\\)，即 \\(\\boldsymbol x=\\boldsymbol 0\\) 的个体的生存函数，为\\[S_0(t)=\\text{P }\\{\\exp(\\mu+\\sigma\\epsilon_i)\\geqslant t\\}\\]那么有\\[\\begin{align}\nS_i(t)=S_0\\{t/\\exp(\\boldsymbol{\\alpha'x}_i)\\}\n\\tag{5.63}\n\\end{align}\\]这是加速失效时间模型中第 \\(\\) 个个体生存函数的一般形式。使用第 1 章的式 (1.5) 可获得风险函数之间的对应关系。具体来说，对式 (5.63) 两边取对数，乘以 −1，并对 \\(t\\) 进行微分，得到\\[\\begin{aligned}h_i(t)=\\exp(-\\boldsymbol{\\alpha'x}_i)h_0\\{t/\\exp(\\boldsymbol{\\alpha'x}_i)\\}\\end{aligned}\\]这就是式 (5.60) 中的模型，其中 \\(\\eta_i=\\boldsymbol{\\alpha'x}_i\\)。第 \\(\\) 个个体的生存时间分布的第 \\(p\\) 个百分位数满足\\[S_i\\{t_i(p)\\}=\\frac{100-p}{100}\\]并根据式 (5.63)\\[\\begin{aligned}S_i\\{t_i(p)\\}&=S_0\\{t_i(p)/(\\exp(\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi})\\}\\end{aligned}\\]用 \\(t_0(p)\\) 表示基线生存函数 \\(S_0(t)\\) 的第 \\(p\\) 个百分位数，这样 \\(t_0(p)\\) 就是所有解释变量都取值为零的个体的第 \\(p\\) 个百分位数。\\[\\begin{aligned}t_i(p)=\\exp(\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi})t_0(p)\\end{aligned}\\]这证实了系数 \\(\\alpha\\) 可以根据解释变量对生存时间分布百分位数的效应来解释。在加速失效时间模型中，第 \\(\\) 个个体的时间比为 \\(\\exp(\\boldsymbol{\\alpha'x}_i)\\)。根据式 (5.61)，单个解释变量 \\(X_j(j = 1, 2,...,p)\\) 的值增加一个单位，会导致 \\(\\log T_i\\) 增加 \\(\\alpha_j\\)。这意味着生存时间增加了 \\(\\exp(\\alpha_j)\\) 倍。因此，对数线性加速失效时间模型中解释变量系数的指数 (exponentiated coefficients) 可以直接解释为时间比。模型的对数线性公式也可给出第 \\(\\) 个个体生存函数的一般形式，即\\[\\begin{aligned}S_i(t)=\\mathrm{P}(T_i\\geqslant t)=\\mathrm{P}(\\log T_i\\geqslant\\log t)\\end{aligned}\\]根据式 (5.61)\\[\\begin{align}\nS_{}(t) x&=\\mathrm{P}(\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i\\geqslant\\log t)\\\\\n&=\\mathrm{P}\\left(\\epsilon_i\\geqslant\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}\\sigma\\right)\n\\tag{5.64}\n\\end{align}\\]如果我们现在将式 (5.61) 的对数线性模型中的随机变量 \\(\\epsilon_i\\) 的生存函数写为 \\(S_{\\epsilon_i} (\\epsilon)\\)，则根据式 (5.64)，第 \\(\\) 个个体的生存函数可以表示为\\[\\begin{align}\nS_i(t)&=S_{\\epsilon_i}\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\n\\tag{5.65}\n\\end{align}\\]该结果显示了如何从 \\(\\epsilon_i\\) 分布的生存函数中找到 \\(T_i\\) 的生存函数，反之亦然。结果还表明，可以从 \\(\\epsilon_i\\) 的许多概率分布中导出加速失效时间模型，尽管有些分布比其他分布更容易处理。下一节将描述一些特定的加速失效时间模型。","code":""},{"path":"参数回归模型.html","id":"sec5-12","chapter":"►参数回归模型","heading":"5.12 参数加速失效时间模型","text":"加速失效时间模型的对数线性公式中 \\(\\epsilon_i\\) 分布的特定选择（如 5.11 节所述）将得到与第 \\(\\) 个个体生存时间相关的随机变量的分布。然而，式 (5.61) 中模型的表示所得模型的参数化与 5.1 节中给出的模型不同。基于生存时间的 Weibull, log-logistic 和 log-normal 分布的参数加速失效时间模型在实践中最常用，因此对这些模型进行详细描述。","code":""},{"path":"参数回归模型.html","id":"sec5-12-1","chapter":"►参数回归模型","heading":"5.12.1 Weibull 加速失效时间模型","text":"假设生存时间具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布，写作 \\(W(\\lambda, \\gamma)\\)，因此基线风险函数为\\[\\begin{aligned}h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\end{aligned}\\]那么第 \\(\\) 个个体的风险函数由式 (5.60) 给出\\[\\begin{aligned}h_i(t)=e^{-\\eta_i}\\lambda\\gamma(e^{-\\eta_i}t)^{\\gamma-1}=(e^{-\\eta_i})^\\gamma\\lambda\\gamma t^{\\gamma-1}\\end{aligned}\\]使得该个体的生存时间服从 \\(W(\\lambda e^{-\\gamma\\eta_i},\\gamma)\\) 分布。因此，Weibull 分布具有加速失效时间性 (accelerated failure time property). 事实上，它是唯一具有比例风险和加速失效时间性的概率分布。由于 Weibull 分布同时具有比例风险性和加速失效时间性，因此两模型的参数之间存在直接的对应关系。如果基线风险是 \\(W(\\lambda,\\gamma)\\) 分布的风险函数，则在式 (5.41) 中的一般比例风险模型下的生存时间具有 \\(W(\\lambda\\exp(\\boldsymbol{\\beta'x}_i),\\gamma)\\) 的分布，而加速失效时间模型下的生存时间具有 \\(W(\\lambda\\exp(-\\gamma\\boldsymbol{\\alpha'x}_i),\\gamma)\\) 的分布。因此，将加速失效时间模型线性部分的解释变量系数乘以 \\(-\\gamma\\) 时，我们得到了比例风险模型中相应的系数 \\(\\beta\\)。在对两组进行比较的特殊情况下，加速失效时间模型下 \\(\\phi=e^{\\alpha}\\) 的时间比对应于比例风险模型中 \\(\\phi^{-\\gamma}=e^{-\\gamma\\alpha}\\) 的风险比。对于式 (5.61) 中模型的对数线性表示，如果 \\(T_i\\) 具有 Weibull 分布，则 \\(\\epsilon_i\\) 实际上具有一种称为 Gumbel 分布的极值分布 (extreme value distribution)。这是一个不对称分布，均值为 0.5772（欧拉常数），方差为 \\(\\pi^2/6\\)。Gumbel 分布的生存函数为\\[\\begin{aligned}S_{\\epsilon_i}(\\epsilon)=\\exp(-e^{\\epsilon})\\end{aligned}\\]其中 \\(-\\infty<\\epsilon<\\infty\\)。该分布的累计风险和风险函数分别为 \\(H_{{\\epsilon_i}}(\\epsilon)=e^{{\\epsilon}}\\) 和 \\(h_{{\\epsilon}_i}(\\epsilon)=e^\\epsilon\\)。为了证明随机变量 \\(T_i=\\exp(\\mu+\\boldsymbol{\\alpha'x}_i+\\sigma\\epsilon_i)\\) 具有 Weibull 分布，根据式 (5.65)，\\(T_i\\) 的生存函数为\\[\\begin{align}\nS_i(t)=\\exp\\left\\{-\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\right\\}\n\\tag{5.66}\n\\end{align}\\]这可以表示为如下形式\\[\\begin{aligned}S_i(t)=\\exp\\left(-\\lambda_it^{1/\\sigma}\\right)\\end{aligned}\\]其中\\[\\begin{aligned}\\lambda_i=\\exp\\left\\{-(\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi})/\\sigma\\right\\}\\end{aligned}\\]根据式 (5.5)，它是具有尺度参数 \\(\\lambda_i\\) 和形状参数 \\(\\sigma^{−1}\\) 的 Weibull 分布的生存函数。因此，式 (5.66) 是 5.6 节中描述的 Weibull 模型生存函数的加速失效时间表示。Weibull 加速失效时间模型的累积风险函数可以直接从式 (5.66) 中的生存函数中找到，并由下式给出\\[\\begin{aligned}H_i(t)=-\\log S_i(t)=\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}\\sigma\\right)\\end{aligned}\\]也可以表示为 \\(\\lambda_it^{1/\\sigma}\\)，相应的风险函数由下式给出\\[\\begin{align}\nh_i(t)&=\\frac{1}{\\sigma t}\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\n\\tag{5.67}\n\\end{align}\\]或 \\(h_{{}}(t)=\\lambda_{{}}\\sigma^{-1}t^{\\sigma^{-1}-1}\\)现在，我们将这种形式的模型与 Weibull 比例风险模型的形式进行协调。根据式 (5.43)，第 \\(\\) 个个体的生存函数为\\[\\begin{align}\nS_i(t)=\\exp\\left\\{-\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})\\lambda t^\\gamma\\right\\}\n\\tag{5.68}\n\\end{align}\\]其中 \\(\\lambda\\) 和 \\(\\gamma\\) 是 Weibull 基线风险函数的参数。式 (5.68) 可以写成以下形式\\[\\begin{align}\nS_i(t)=\\exp\\left\\{-\\exp(\\gamma\\log t+\\log\\lambda+\\boldsymbol{\\beta'x}_i)\\right\\}\n\n\\end{align}\\]这表明式 (5.66) 和式 (5.68) 之间存在直接对应关系，即\\[\\begin{aligned}\\lambda=\\exp(-\\mu/\\sigma),\\quad\\gamma=\\sigma^{-1},\\quad\\beta_j=-\\alpha_j/\\sigma\\end{aligned}\\]其中 \\(j=1,2,\\ldots,p\\)。在这种形式的模型中，第 \\(\\) 个个体生存时间分布的第 \\(p\\) 个百分位数为 \\(t_i(p)\\)，其中 \\(S_i\\{t_i(p)\\}=1-(p/100)\\)，\\(S_i(t)\\) 由式 (5.66) 给出。经直接的代数计算后得到，对该个体，有\\[\\begin{align}\nt_i(p)&=\\exp\\left[\\sigma\\log\\left\\{-\\log\\left(\\frac{100-p}{100}\\right)\\right\\}+\\mu+\\boldsymbol{\\alpha}'\\boldsymbol{x}_i\\right]\n\\tag{5.69}\n\\end{align}\\]","code":""},{"path":"参数回归模型.html","id":"sec5-12-2","chapter":"►参数回归模型","heading":"5.12.2 log-logistic 加速失效时间模型","text":"现在假设生存时间具有 log-logistic 分布。如果式 (5.60) 中的一般加速失效时间模型中的基线风险函数是从参数为 \\(\\theta,\\kappa\\) 的 log-logistic 分布中导出的，则该函数由下式给出\\[\\begin{aligned}h_0(t)=\\frac{e^\\theta\\kappa t^{\\kappa-1}}{1+e^\\theta t^\\kappa}\\end{aligned}\\]在加速失效时间模型下，第 \\(\\) 个个体在时间 \\(t\\) 的死亡风险为\\[\\begin{aligned}h_i(t)=e^{-\\eta_i}h_0(e^{-\\eta_i}t)\\end{aligned}\\]其中 \\(\\eta_i=\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\) 是第 \\(\\) 个个体 \\(p\\) 个解释变量值的线性组合。因此\\[\\begin{aligned}h_i(t)&=\\frac{e^{-\\eta_i}e^\\theta\\kappa(e^{-\\eta_i}t)^{\\kappa-1}}{1+e^\\theta(e^{-\\eta_i}t)^\\kappa}\\end{aligned}\\]即\\[\\begin{aligned}h_i(t)=\\frac{e^{\\theta-\\kappa\\eta_i}\\kappa t^{\\kappa-1}}{1+e^{\\theta-\\kappa\\eta_i}t^\\kappa}\\end{aligned}\\]那么，第 \\(\\) 个个体的生存时间也具有 log-logistic 分布，参数为 \\(\\theta-\\kappa\\eta_i\\) 和 \\(\\kappa\\)。因此，log-logistic 分布也具有加速失效时间性。然而，这种分布不具有比例风险性。式 (5.61) 中加速失效时间模型的对数线性形式也提供了 log-logistic 分布的表示。现在假设在这个公式中，\\(\\epsilon_i\\) 服从均值为零、方差为 \\(\\pi^2/3\\) 的 logistic 分布，因此 \\(\\epsilon_i\\) 的生存函数为\\[S_{\\epsilon_i}(\\epsilon)=\\frac1{1+e^\\epsilon}\\]使用式 (5.65)，\\(T_i\\) 的生存函数为\\[\\begin{align}\nS_i(t)&=\\left\\{1+\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\right\\}^{-1}\n\\tag{5.70}\n\\end{align}\\]根据式 (5.9)，当 \\(T_i\\) 具有参数为 \\(\\theta-\\kappa\\eta_{{}},\\kappa\\) 的 logistic 分布时，其中 \\(\\eta_{}=\\alpha_{1}x_{1i}+\\alpha_{2}x_{2i}+\\cdots+\\alpha_{p}x_{pi}\\)，\\(T_i\\) 的生存函数为\\[\\begin{aligned}S_i(t)&=\\frac{1}{1+e^{\\theta-\\kappa\\eta_i}t^\\kappa}\\end{aligned}\\]通过将该式与式 (5.70) 中生存函数的表达式进行比较，我们发现参数 \\(\\theta\\) 和 \\(\\kappa\\) 可以用 \\(\\mu\\) 和 \\(\\sigma\\) 表示，即\\[\\begin{aligned}\\theta=-\\mu/\\sigma,\\quad\\kappa=\\sigma^{-1}\\end{aligned}\\]这表明具有 log-logistic 生存时间的加速失效时间模型也可以用对数线性模型来表示。这是计算机软件通常采用的模型形式，因此基于计算机的参数估计通常是 \\(\\mu\\) 和 \\(\\sigma\\) 的估计，而不是 \\(\\theta\\) 和 \\(\\kappa\\) 的估计。使用 \\(H_i(t)=-\\log S_i(t)\\) 得到累积风险函数，微分后得到风险函数\\[\\begin{align}\nh_i(t)&=\\frac{1}{\\sigma t}\\left\\{1+\\exp\\left[-\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\right]\\right\\}^{-1}\n\\tag{5.71}\n\\end{align}\\]时间比或中位生存时间等量的估计可以直接从 \\(\\mu,\\sigma\\) 和 \\(\\alpha\\) 的估计中获得。例如，第 \\(\\) 个个体的时间比为 \\(\\exp(\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi})\\)，根据式 (5.70)，生存时间分布的第 \\(p\\) 个百分位数为\\[\\begin{aligned}t_i(p)&=\\exp\\left\\{\\sigma\\log\\left(\\frac{p}{100-p}\\right)+\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\right\\}\\end{aligned}\\]中位生存时间简单地为\\[\\begin{align}\nt_i(50)&=\\exp\\left\\{\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\right\\}\n\\tag{5.72}\n\\end{align}\\]因此可以直接从模型的参数估计中获得中位数的估计。","code":""},{"path":"参数回归模型.html","id":"log-normal-加速失效时间模型","chapter":"►参数回归模型","heading":"5.12.3 log-normal 加速失效时间模型","text":"如果假设生存时间具有 log-normal 分布，则基线生存函数由下式给出\\[S_0(t)=1-\\Phi\\left(\\frac{\\log t-\\mu}\\sigma\\right)\\]其中 \\(\\mu\\) 和 \\(\\sigma\\) 是两个未知参数。在加速失效时间模型下，第 \\(\\) 个个体的生存函数为\\[\\begin{aligned}S_i(t)=S_0(e^{-\\eta_i}t)\\end{aligned}\\]其中 \\(\\eta_i=\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\) 为第 \\(\\) 个个体 \\(p\\) 个解释变量值的线性组合。因此\\[\\begin{align}\nS_i(t)=1-\\Phi\\left(\\frac{\\log t-\\eta_i-\\mu}\\sigma\\right)\n\\tag{5.73}\n\\end{align}\\]这是个体 \\(\\) 的生存函数，其生存时间具有参数 \\(\\mu + \\eta_i\\) 和 \\(\\sigma\\) 的 log-normal 分布。因此，log-normal 分布具有加速失效时间性。在模型的对数线性公式中，如果 \\(\\log T_i\\) 服从正态分布，则与第 \\(\\) 个个体生存时间相关的随机变量服从 log-normal 分布。因此，我们取式 (5.61) 中的 \\(\\epsilon_i\\) 服从标准正态分布，因此 \\(\\epsilon_i\\) 的生存函数为\\[\\begin{aligned}S_{\\epsilon_i}(\\epsilon)=1-\\Phi(\\epsilon)\\end{aligned}\\]那么，式 (5.65) 可直接导出式 (5.73)，并且 \\(T_i\\) 分布的第 \\(p\\) 个百分位可通过令 \\(S_i\\{t_i(p)\\}\\) 等于 \\(1 − (p/100)\\) 得出，从而得出\\[\\begin{aligned}t_i(p)&=\\exp\\left\\{\\sigma\\Phi^{-1}(p/100)+\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\right\\}\\end{aligned}\\]特别地，\\(t(50)=\\operatorname{exp}(\\mu+\\boldsymbol{\\alpha'x}_i)\\) 是第 \\(\\) 个个体的中位生存时间。风险函数也可根据式 (5.73) 中的生存函数中得出，但它的形式比较复杂。","code":""},{"path":"参数回归模型.html","id":"sec5-13","chapter":"►参数回归模型","heading":"5.13 拟合并比较加速失效时间模型","text":"使用最大似然法拟合加速失效时间模型。似然函数最好从模型的对数线性表示中导出，然后使用迭代方法获得估计值。\\(n\\) 个观测生存时间 \\(t_1,t_2,\\ldots,t_n\\) 的似然由式 (5.14) 给出，即\\[\\begin{aligned}L(\\boldsymbol{\\alpha},\\mu,\\sigma)&=\\prod_{=1}^n\\left\\{f_i(t_i)\\right\\}^{\\delta_i}\\left\\{S_i(t_i)\\right\\}^{1\\boldsymbol{-}\\delta_i}\\end{aligned}\\]其中 \\(f_{}(t_{})\\) 和 \\(S_{{}}(t_{{}})\\) 为第 \\(\\) 个个体在 \\(t_i\\) 处的密度函数和生存函数，以及 \\(\\delta_i\\) 是第 \\(\\) 个观测的事件指示符，若第 \\(\\) 个观测为事件则 \\(\\delta_i=1\\)，若为删失则为 0. 现在，根据式 (5.65)\\[\\begin{aligned}S_i(t_i)=S_{\\epsilon_i}(z_i)\\end{aligned}\\]其中 \\(z_i=(\\log t_i-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi})/\\sigma\\)，将上式关于 \\(t\\) 的微分给出\\[f_i(t_i)=\\frac{1}{\\sigma t_i}f_{\\epsilon_i}(z_i)\\]那么，似然函数可以用 \\(\\epsilon_i\\) 的生存函数和密度函数来表示\\[\\begin{aligned}L(\\boldsymbol{\\alpha},\\mu,\\sigma)&=\\prod_{=1}^n(\\sigma t_i)^{-\\delta_i}\\left\\{f_{\\epsilon_i}\\left(z_i\\right)\\right\\}^{\\delta_i}\\left\\{S_{\\epsilon_i}\\left(z_i\\right)\\right\\}^{1-\\delta_i}\\end{aligned}\\]那么对数似然为\\[\\begin{align}\n\\log L(\\boldsymbol{\\alpha},\\mu,\\sigma)=\\sum_{=1}^n\\left\\{-\\delta_i\\log\\sigma-\\delta_i\\log t_i+\\delta_i\\log f_{\\epsilon_i}(z_i)+(1-\\delta_i)\\log S_{\\epsilon_i}(z_i)\\right\\}\n\\tag{5.74}\n\\end{align}\\]\\(p + 2\\) 个未知参数 \\(\\mu,\\sigma\\) 和 \\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_p\\) 的最大似然估计是通过使用 3.3.3 节中描述的 Newton-Raphson 程序最大化该函数来找到的。请注意，式 (5.74) 中对数似然函数的表达式包含项 \\(-\\sum_{=1}^n\\delta_i\\log t_i\\) ，不涉及任何未知参数。因此，该项可以从对数似然函数中省略，如 5.6.1 节中 Weibull 比例风险模型中所述。事实上，大多数计算机软件给出的用于加速失效时间建模的对数似然值不包括 \\(-\\sum_{=1}^n\\delta_i\\log t_i\\) 的值。拟合模型后，可以计算统计量 \\(-2\\operatorname{log}\\hat{L}\\) 的值，并将其用于嵌套模型之间的比较，就像之前在比例风险模型中做的一样。具体来说，为了比较两个嵌套模型，计算两个模型的统计量 \\(-2\\operatorname{log}\\hat{L}\\) 值之差，并与卡方分布的百分位点进行比较，其自由度等于模型线性部分中包含的 \\(\\alpha\\) 参数的数量。一旦确定了合适的模型，就可以获得并绘制生存函数和风险函数的估计。拟合的模型可以根据解释变量影响的时间比或加速因子的估计，或根据生存时间分布的中位数和其他百分位数来解释。示例 5.14  (患乳腺癌妇女的预后) 在此示例中，为患乳腺癌妇女生存时间数据拟合加速失效时间模型。首先考虑 Weibull 加速失效时间模型。与第 \\(\\) 个女性生存时间 \\(T_i\\) 相关的随机变量的对数线性模型如下：\\[\\begin{aligned}\\log T_i=\\mu+\\alpha x_i+\\sigma\\epsilon_i\\end{aligned}\\]其中 \\(\\epsilon_i\\) 具有 Gumbel 分布，\\(\\mu,\\sigma\\) 和 \\(\\alpha\\) 是未知参数，\\(x_i\\) 是与染色相关的解释变量 \\(X\\) 的值，使得如果第 \\(\\) 个女性的肿瘤呈阴性染色，则 \\(x_i = 0\\)，如果肿瘤染色呈阳性，则 \\(x_i = 1\\)。拟合该模型后，我们得到 \\(\\hat{\\mu}=5.854,\\hat{\\sigma}=1.067\\) 以及 \\(\\hat\\alpha = -0.997\\)。对于染色呈阳性的女性，时间比 \\(e^{\\alpha x_i}\\) 的估计为 \\(e^{\\large-0.997}=0.37\\)。因此，肿瘤染色呈阳性的女性的死亡时间约为肿瘤染色呈阴性的女性的三分之一。等价地，在该模型下，阳性染色可将死亡时间加快约 2.7 倍。这与示例 5.13 中发现的百分位-百分位图的斜率估计一致。第 \\(\\) 个女性的生存函数估计由式 (5.66) 给出\\[\\hat{S_i}(t)=\\exp\\left\\{-\\exp\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}x_i}{\\hat{\\sigma}}\\right)\\right\\}\\]并且对于 \\(x_i\\) 的两个值，可以绘制生存函数关于 \\(t\\) 的图形。使用式 (5.69)，在 Weibull 加速失效时间模型下，第 \\(\\) 名女性的中位生存时间为\\[\\begin{aligned}t_i(50)=\\exp\\left\\{\\sigma\\log(\\log2)+\\mu+\\alpha x_i\\right\\}\\end{aligned}\\]阴性染色 (\\(x_i = 0\\)) 的女性的中位生存时间估计为 236 天，而阳性染色 (\\(x_i = 1\\)) 的女性的中位生存时间估计为 87 天，正如示例 5.7 所示。注意两个中位数的比值为 0.37，这是时间比。因此，肿瘤呈阳性染色的女性的中位生存时间约为肿瘤呈阴性染色的女性的三分之一。第 \\(\\) 个女性的风险函数估计由式 (5.67) 给出：\\[\\begin{aligned}\\hat{h}_i(t)=\\hat{\\sigma}^{-1}t^{\\hat{\\sigma}^{-1}-1}\\exp\\left(\\frac{-\\hat{\\mu}-\\hat{\\alpha}x_i}{\\hat{\\sigma}}\\right)\\end{aligned}\\]即\\[\\begin{aligned}\\hat{h}_i(t)&=0.937t^{-0.063}\\exp(-5.488+0.934x_i)\\end{aligned}\\]图 5.22 显示了两组妇女的这一函数图。\n在 5.6 节给出的 Weibull 模型的比例风险表示中，第 \\(\\) 名女性在时间 \\(t\\) 的死亡风险为\\[h_{\\boldsymbol{}}(t)=e^{\\boldsymbol{\\beta}x_{\\boldsymbol{}}}h_{\\boldsymbol{0}}(t)\\]若第 \\(\\) 位女性的肿瘤染色呈阴性，\\(x_i\\) 的值为零，若肿瘤染色呈阳性，则为一。对于 Weibull 分布，基线风险函数为\\[\\begin{aligned}h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\end{aligned}\\]这是肿瘤染色呈阴性的女性的风险函数，因此\\[\\begin{aligned}h_i(t)=e^{\\beta x_i}\\lambda\\gamma t^{\\gamma-1}\\end{aligned}\\]参数 \\(\\lambda,\\gamma\\) 和 \\(\\beta\\) 的相应估计为 \\(\\hat \\lambda=\\exp(-\\hat{\\mu}/\\hat{\\sigma})=0.00414,\\hat{\\gamma}=1/\\hat{\\sigma}=0.937\\) 以及 \\(\\hat{\\beta}=-\\hat{\\alpha}/\\hat{\\sigma}=0.997\\)。Weibull 加速失效时间模型与 Weibull 比例风险模型之间的对应关系意味着后者模型下的风险比为 \\(e^{-\\alpha/\\sigma}=e^{\\beta}\\)，估计为 2.55。这与示例 5.7 中的值一致。我们现在为相同数据集拟合 log-logistic 加速失效时间模型。根据模型的对数线性形式现在得到 \\(\\hat\\mu = 5.461,\\hat \\sigma = 0.805\\) 和 \\(\\hat\\alpha = −1.149\\)。时间比为 \\(e^\\alpha\\)，估计值为 \\(0.32\\)。这略小于 Weibull 加速失效时间模型下的结果。根据式 (5.72)，该模型下第 \\(\\) 名女性的中位生存时间由下式给出\\[\\exp(\\mu+\\alpha x_i)\\]其中阴性染色女性的中位生存时间估计为 235 天，阳性染色女性的中位生存时间估计为 75 天，这些值与 Weibull 加速失效时间模型所得值非常接近。根据式 (5.71)，第 \\(\\) 名女性的风险函数估计为\\[\\begin{aligned}\\hat{h}_i(t)=\\frac{1}{\\hat{\\sigma}t}\\left\\{1+\\exp\\left[-\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}x_i}{\\hat{\\sigma}}\\right)\\right]\\right\\}^{-1}\\end{aligned}\\]这是\\[\\hat{h}_i(t)=1.243t^{-1}\\left\\{1+t^{-1.243}\\exp\\left(6.787-1.428x_i\\right)\\right\\}^{-1}\\]图 5.23 显示了两组妇女的这一函数图。这可以与图 5.22 进行比较。\n在这两种模型下，阴性染色者的风险函数非常相似。然而，log-logistic 模型下阳性染色者的风险函数与 Weibull 模型下的风险函数不同。拟合的 Weibull 和 log-logistic 模型的 \\(-2\\operatorname{log}\\hat{L}\\) 统计量的值分别为 121.77 和 118.495. 在此基础上，log-logistic 模型提供了稍好的拟合。第 7 章讨论的残差分析可能有助于在这两个模型之间进行选择，尽管对于这个小数据集，这样的分析不太可能提供非常丰富的信息。最后，根据 5.1.3 节给出的模型参数化，基线风险函数为\\[\\begin{aligned}h_0(t)=\\frac{e^\\theta\\kappa t^{\\kappa-1}}{1+e^\\theta t^\\kappa}\\end{aligned}\\]因此研究中第 \\(\\) 个女性的风险函数是\\[\\begin{aligned}h_i(t)=\\frac{e^{\\theta-\\kappa\\alpha x_i}\\kappa t^{\\kappa-1}}{1+e^{\\theta-\\kappa\\alpha x_i}t^\\kappa}\\end{aligned}\\]\\(\\theta,\\kappa\\) 的相应估计为 \\(\\hat\\theta=-\\hat\\mu/\\hat\\sigma=-6.787,\\hat{\\kappa}=1/\\hat{\\sigma}=1.243\\)。示例 5.15  (前列腺癌两种疗法的比较) 使用 log-logistic 加速失效时间模型进一步说明生存数据建模，这里考虑比较前列腺癌两种疗法的临床试验数据。这些数据首先在示例 1.4 中给出，并在示例 3.6 和 3.12 中使用 Cox 回归模型进行了分析。为了确定在 log-logistic 加速失效时间模型线性部分中应包含的项，可以再次遵循示例 3.6 中描述的程序。表 5.9 显示了具有四个预后变量（Age、Shb、Size 和 Index）所有组合的拟合模型的 \\(-2\\log\\hat{L}\\) 统计量的值。\n正如示例 3.6，模型中需要变量 Size 和 Index. 当省略这两个变量中的任何一个时，\\(-2\\log\\hat{L}\\) 值的相应增量是显著的，当 Age 或 Shb 添加到模型中时，\\(-2\\log\\hat{L}\\) 都不会显著减小。当在包含 Size 和 Index 的模型中加入与治疗效应对应的项 Treat 时，\\(-2\\log\\hat{L}\\) 减小为 21.245. 将该 1.867 的减小量与自由度为一的卡方分布的百分位点相比时，在 10% 的水平上并不显著 (\\(P=0.172\\))。也没有证据表明 Treat 与预后变量 Size 和 Index 之间有任何交互作用，因此结论为：治疗效应在统计学上不显著。治疗效应的大小可以用时间比或加速因子来评估。根据模型的对数线性形式，与第 \\(\\) 个患者的生存时间 \\(T_i\\) 相关的随机变量为：\\[\\begin{aligned}\\log T_i=\\mu+\\alpha_1\\textit{Size}_i+\\alpha_2\\textit{Inde}x_i+\\alpha_3\\textit{Treat}_i+\\sigma\\epsilon_i\\end{aligned}\\]其中 \\(\\epsilon_i\\) 具有 logistic 分布，\\(Size_i\\) 和 \\(Index_i\\) 是第 \\(\\) 个个体的肿瘤大小和 Gleason 指数的值，如果第 \\(\\) 个个体在安慰剂组，则 \\(Treat_i\\) 为零，如果在治疗组，则为一。该模型中未知参数的最大似然估计为\n\\(\\hat{\\mu}=7.661,\\hat{\\sigma}=0.338,\\hat{\\alpha}_1=-0.029,\\hat{\\alpha}_2=-0.293\\) 和 \\(\\hat{\\alpha}_3=0.573\\)。\\(\\alpha\\) 的值表明，肿瘤大小和肿瘤指数越大，生存时间往往越短，而接受活性治疗的个体生存时间往往越长。使用式 (5.70)，第 \\(\\) 个患者拟合的生存函数为\\[\\begin{aligned}\\hat{S}_i(t)=\\left[1+\\exp\\left\\{\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}_1\\textit{Size}_i-\\hat{\\alpha}_2\\textit{Index}_i-\\hat{\\alpha}_3\\textit{Treat}_i}{\\hat{\\sigma}}\\right\\}\\right]^{-1}\\end{aligned}\\]可以写成以下形式\\[\\hat{S_i}(t)=\\left\\{1+t^{1/\\hat{\\sigma}}\\exp\\left(\\hat{\\zeta_i}\\right)\\right\\}^{-1}\\]其中\\[\\begin{aligned}\\hat{\\zeta}_i&=\\frac{1}{\\hat{\\sigma}}\\left\\{-\\hat{\\mu}-\\hat{\\alpha}_1\\textit{Size}_i-\\hat{\\alpha}_2\\textit{Inde}x_i-\\hat{\\alpha}_3\\textit{Treat}_i\\right\\}\\end{aligned}\\]也就是\\[\\begin{aligned}\\hat{\\zeta}_i&=-22.645+0.085\\textit{ Size}_i+0.865\\text{ }Index_i-1.693\\textit{ Treat}_i\\end{aligned}\\]对累积风险函数估计 \\(\\hat{H_{}}(t)=-\\operatorname{log}\\hat{S_{}}(t)\\) 关于 \\(t\\) 微分，可以得到相应的风险函数估计。这给出了\\[\\hat{h}_i(t)=\\frac1{\\hat{\\sigma}t}\\left\\{1+t^{-1/\\hat{\\sigma}}\\exp\\left(-\\hat{\\zeta}_i\\right)\\right\\}^{-1}\\]也可直接从式 (5.71) 给出的风险函数获得该结果。治疗组中的个体相对于对照组中的个体的时间比估计为 \\(e^{0.573}=1.77\\)。对这一结果的解释是，考虑到肿瘤的大小和指数后，己烯雌酚治疗的效应是使生存时间几乎翻倍。这种效应可能具有临床重要性，尽管它在统计上并不显著。然而，在接受这种解释之前，应使用适当的诊断来检查拟合模型的充分性。通过对时间比对数的置信限求指数来找到时间比的置信区间。在此示例中，治疗效应时间比对数是风险函数模型中 \\(Treat\\) 的系数估计 -0.573，该标准误估计为 0.473. 因此，时间比的 95% 置信限为 \\(\\exp\\{0.573\\pm1.96\\times0.473\\}\\)，所求区间为 0.70 到 4.48. 请注意，此区间估计包括 1，这与之前发现的非显著治疗效应一致。最后，根据 5.1.3 节的模型的参数化，第 \\((=1,2,\\ldots,38)\\) 个患者的拟合风险函数为\\[\\hat{h}_i(t)=e^{\\boldsymbol{-}\\hat{\\eta}_i}\\hat{h}_0(e^{\\boldsymbol{-}\\hat{\\eta}_i}t)\\]其中\\[\\begin{aligned}\\hat{\\eta_i}=-0.029\\text{ }Size_i-0.293\\text{ }Index_i+0.573\\text{ }Treat_i\\end{aligned}\\]并且根据式 (5.8)\\[\\begin{aligned}\\hat{h}_0(t)=\\frac{e^{{\\hat{\\theta}}}\\hat{\\kappa}t^{{\\hat{\\kappa}}-1}}{1+e^{\\hat{\\theta}}t^{\\hat{\\kappa}}}\\end{aligned}\\]这种形式的基线风险函数估计 \\(\\hat{h}_0(t)\\) 的参数估计为 \\(\\hat{\\theta}=-22.644\\) 和 \\(\\hat{\\kappa}=2.956\\)，该函数的图形如图 5.24 所示。\n该图表明基线风险随着时间的推移而增加。与拟合的 Weibull 模型的基线风险函数的比较（也在图中）表明，在 log-logistic 模型下，基线风险函数估计不会增加得那么快。","code":""},{"path":"参数回归模型.html","id":"sec5-14","chapter":"►参数回归模型","heading":"5.14 参数模型中解释的变异的度量","text":"Cox 回归模型中解释的变异的度量在第 3 章 3.12 节中进行了描述。本节将描述与参数加速失效时间模型中解释的变异的一般度量方法。根据式 (5.61)，该模型有\\[\\begin{aligned}Y_i=\\log T_i=\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i\\end{aligned}\\]其形式类似于第 3 章式 (3.33) 中的一般线性模型。然而，一般线性模型中的项 \\(\\epsilon_i\\) 被 \\(\\sigma\\epsilon_i\\) 取代，其中 \\(\\sigma\\) 是加速失效时间模型中的尺度参数，而 \\(\\epsilon_i\\) 的分布取决于生存时间的假定分布。类似于式 (3.35) 中 \\(R^2\\) 的统计量为\\[\\begin{align}\nR_{P}^{2}=\\frac{\\hat{V}_{P}}{\\hat{V}_{P}+\\hat{\\sigma}^{2}\\operatorname{var}\\left(\\epsilon_{}\\right)}\n\\tag{5.75}\n\\end{align}\\]其中，如第 3 章 3.12.4 节所述，\\(\\hat{V}_P\\) 是拟合的加速失效时间模型中风险评分的样本方差，而 \\(\\hat{\\sigma}^{2}\\) 是尺度参数估计。在 Weibull 分布的特殊情况下，\\(\\operatorname{var}\\left(\\epsilon_i\\right)=\\pi^2/6\\)，这来自 5.12.1 节。通过取 \\(\\sigma=1\\)，这种解释的变异的度量也可用于 Cox 比例风险模型，这是第 3 章式 (3.35) 中的 \\(R^2_P\\) 统计量。当为具有 log-logistic 分布的生存时间拟合加速失效时间模型，式 (5.75) 中 \\(\\mathrm{var}\\left(\\epsilon_{\\boldsymbol{}}\\right)=\\pi^{2}/3\\)，而对于 log-normal 生存时间 \\(\\mathrm{var}\\left(\\epsilon_{}\\right)=1\\)。\\(R^2_D\\) 统计量（在第 3 章的 3.12.4 节中描述）可以以类似的方式适用于参数生存模型。得到\\[\\begin{aligned}R_D^2&=\\frac{D_0^2}{D_0^2+\\hat{\\sigma}^2\\operatorname{var}\\left(\\epsilon_i\\right)}\\end{aligned}\\]其中 \\(D_0\\) 是仅包含此项的 Cox 回归模型中正态得分变量的系数。示例 5.16  (多发性骨髓瘤患者的生存率) 为了说明如何使用生存数据 Weibull 模型的解释的变异的度量，考虑多发性骨髓瘤患者生存时间数据，示例 3.17 中给出了拟合 Cox 回归模型的三个 \\(R^2\\) 统计量。对于包含变量 Hb 和 Bun 的 Weibull 模型，\\(R^2_P = 0.25\\) 且 \\(R^2_D = 0.23\\)。对于包含所有 7 个变量的模型，\\(R^2_P = 0.30\\) 以及 \\(R^2_D = 0.34\\)。这些值与拟合相应的 Cox 回归模型得到的值非常相似，因此 Cox 和 Weibull 模型具有相似的解释力。","code":""},{"path":"参数回归模型.html","id":"sec5-14-1","chapter":"►参数回归模型","heading":"5.14.1 参数模型的预测能力","text":"第 3 章 3.13.4 节描述了在评估 Cox 回归模型预测能力时使用的时依 ROC. 事实上，一旦估计了风险评分，这项技术就可以用于任何生存数据模型。不涉及新的原则。","code":""},{"path":"参数回归模型.html","id":"sec5-15","chapter":"►参数回归模型","heading":"5.15 比例几率模型","text":"在一般比例几率模型 (general proportional odds model) 中，个体生存超过时间 \\(t\\) 的几率 (odds) 表示为\\[\\begin{align}\n\\frac{S_i(t)}{1-S_i(t)}&=e^{\\eta_i}\\frac{S_0(t)}{1-S_0(t)}\n\\tag{5.76}\n\\end{align}\\]其中\\[\\begin{aligned}\\eta_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\end{aligned}\\]为在第 \\(\\) 个个体上测量的 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 值的线性组合，基线生存函数 \\(S_0(t)\\)，是解释变量都取零值的个体的生存函数。在该模型中，解释变量对生存超过 \\(t\\) 的几率起乘性作用。因此，相对于解释变量全部为零的个体，第 \\(\\) 个个体生存超过 \\(t\\) 的几率之比的对数就是 \\(\\eta_i\\)。因此，该模型是对数几率比 (log-odds ratio) 的线性模型。现在考虑有两个组别的研究的特殊情况，在该研究中，个体接受标准治疗或新治疗。如果一个个体接受标准治疗，则让指示变量 \\(X\\) 取零，如果接受新治疗，则取一。则第 \\(\\) 个个体生存超过时间 \\(t\\) 的几率为\\[\\begin{aligned}\\frac{S_i(t)}{1-S_i(t)}&=e^{\\beta x_i}\\frac{S_0(t)}{1-S_0(t)}\\end{aligned}\\]其中 \\(x_i\\) 是第 \\((=1,2,\\ldots,n)\\) 个个体的 \\(X\\) 值。因此，如果 \\(S_N (t)\\) 和 \\(S_S(t)\\) 分别是新治疗和标准治疗个体的生存函数，则\\[\\begin{aligned}\\frac{S_N(t)}{1-S_N(t)}&=e^\\beta\\frac{S_S(t)}{1-S_S(t)}\\end{aligned}\\]对数几率比就是 \\(\\beta\\)。因此，模型线性部分的参数具有直接的解释。对于比例风险模型，可以获得基线风险函数的非参数估计。通过从数据中估计模型线性部分的 \\(\\beta\\) 参数以及基线生存函数来拟合模型。比例几率模型的全参数版本可以通过使用生存时间的特定概率分布来导出。下面 5.15.1 节描述了一种这样的模型。比例几率模型的一个特别重要的性质涉及第 \\(\\) 个个体的风险函数与基线风险的比值 \\(h_{{}}(t)/h_{0}(t)\\)。可以证明，在时间 \\(t = 0\\) 时该比值为 \\(e^{-\\eta_i}\\) 而在 \\(t = \\infty\\) 时该比值收敛为 \\(1\\)。为了证明这一点，式 (5.76) 中的模型可以改写为\\[S_i(t)=S_0(t)\\left\\{e^{-\\eta_i}+(1-e^{-\\eta_i})S_0(t)\\right\\}^{-1}\\]取对数得到\\[\\begin{align}\n\\log S_i(t)=\\log S_0(t)-\\log\\left\\{e^{-\\eta_i}+(1-e^{-\\eta_i})S_0(t)\\right\\}\n\\tag{5.77}\n\\end{align}\\]使用式 (1.5) 的一般结果，风险函数为：\\[\\begin{aligned}h_i(t)=-\\frac{\\mathrm{d}}{\\mathrm{d}t}\\log S_{{}}(t)\\end{aligned}\\]因此将式 (5.77) 的两边关于 \\(t\\) 微分\\[\\begin{aligned}h_i(t)&=h_0(t)-\\frac{(1-e^{-\\eta_i})f_0(t)}{e^{-\\eta_i}+(1-e^{-\\eta_i})S_0(t)}\\end{aligned}\\]其中 \\(f_0(t)\\) 是基线概率密度函数。再改写该式，得到\\[\\begin{align}\nh_i(t)&=h_0(t)-\\frac{f_0(t)}{(e^{\\eta_i}-1)^{-1}+S_0(t)}\n\\tag{5.78}\n\\end{align}\\]根据式 (1.4) 中，我们还得到 \\(h_0(t)=f_0(t)/S_0(t)\\)，并将 \\(f_0(t)\\) 代入式 (5.78)，得到\\[h_i(t)=h_0(t)\\left\\{1-\\frac{S_0(t)}{(e^{\\eta_i}-1)^{-1}+S_0(t)}\\right\\}\\]最后再改写，风险比由下式给出：\\[\\begin{aligned}\\frac{h_i(t)}{h_0(t)}&=\\{1+(e^{\\eta_i}-1)S_0(t)\\}^{-1}\\end{aligned}\\]当 \\(t\\) 从 \\(0\\) 增加到 \\(\\infty\\) 时，基线生存函数从 \\(1\\) 单调减小到 \\(0\\)。当 \\(S_0(t)= 1\\) 时，风险比为 \\(e^{-\\eta_i}\\)，当 \\(t\\) 增加到 \\(\\infty\\) 时，风险比收敛为 \\(1\\)。在实际应用中，两组或多组患者的风险函数通常随时间收敛。例如，在临床试验对患者进行的随访研究中，治疗对生存率的影响，或疾病的初始阶段可能会逐渐消失。同样，在将患有某种疾病的患者组与无疾病个体的对照组进行比较的研究中，有效的疗法会使每组的生存经历随时间变得更加相似。这表明比例几率模型收敛风险函数的性质，可能是相当有价值的。然而，这个通用模型在实践中没有得到广泛应用的原因有两个。其一，计算机软件一般不能用于拟合基线生存函数形式未指定的比例几率模型。其二，该模型可能得到与含时依变量的 Cox 回归模型相似的结果，该时依协变量能产生非比例风险，4.4.3 节提及了这种为非比例风险生存数据建模的特殊方法，这将在第 8 章进行全面考虑。","code":""},{"path":"参数回归模型.html","id":"sec5-15-1","chapter":"►参数回归模型","heading":"5.15.1 log-logistic 比例几率模型","text":"若假设个体的生存时间具有 log-logistic 分布，则基线生存函数为\\[\\left.S_0(t)=\\left\\{\\begin{matrix}1+e^\\theta t^\\kappa\\end{matrix}\\right.\\right\\}^{-1}\\]其中 \\(\\theta\\) 和 \\(\\kappa\\) 为未知参数。生存超过时间 \\(t\\) 的基线几率由下式给出\\[\\begin{aligned}\\frac{S_0(t)}{1-S_0(t)}&=e^{\\large-\\theta}t^{\\large-\\kappa}\\end{aligned}\\]因此，第 \\(\\) 个个体生存超过时间 \\(t\\) 的几率为\\[\\begin{aligned}\\frac{S_i(t)}{1-S_i(t)}&=e^{\\eta_i-\\theta}t^{-\\kappa}\\end{aligned}\\]因此，第 \\(\\) 个个体的生存时间具有参数为 \\(\\theta-\\eta_i\\) 和 \\(\\kappa\\) 的 log-logistic 分布。因此，log-logistic 分布具有比例几率性 (proportional odds property)，该分布是与比例几率模型结合使用的自然分布。事实上，这是唯一同时具有加速失效时间性和比例几率性的分布。该结果还意味着，式 (5.76) 中比例几率模型线性部分中的 \\(β\\) 系数估计可以通过将式 (5.70) 的 log-logistic 加速失效时间模型中的 \\(\\alpha\\) 系数乘以 \\(\\hat{\\kappa}=\\hat{\\sigma}^{-1}\\)，其中 \\(\\hat\\sigma\\) 是参数 \\(\\sigma\\) 的估计。那么可以根据加速失效时间模型获得比例几率模型解释变量的系数，反之亦然。因此，基于比例几率模型的生存分析结果可以用时间比、加速因子或生存超过一定时间的几率比来解释，以更方便的为准。如其他生存数据模型一样，可以使用最大似然法拟合比例几率模型。然后，可以在统计量 \\(-2 \\log \\hat{L}\\) 的基础上对替代模型进行比较。在具有两个组别的研究中，可以很容易地对模型的适用性进行初步检查。第 \\(\\) 个个体生存超过时间 \\(t\\) 的对数几率为\\[\\begin{aligned}\\log\\left\\{\\frac{S_i(t)}{1-S_i(t)}\\right\\}&=\\beta x_i-\\theta-\\kappa\\log t\\end{aligned}\\]其中 \\(x_i\\) 是一个指示变量的值，如果一个个体在一个组中，则该值为零，如果在另一组中，那么该值为一。然后为每组中的个体获得生存函数的 Kaplan-Meier 估计，并绘制生存超过时间 \\(t\\) 的对数几率估计 \\(\\log\\left\\{\\hat{S}_i(t)/[1-\\hat{S}_i(t)]\\right\\}\\) 关于 \\(\\log t\\) 的图形。如果图中显示了两条平行的直线，则表明 log-logistic 模型是合适的。如果线是直的但不平行，这表明模型中的参数 \\(\\kappa\\) 在两个治疗组中不相同。若显示了平行的曲线，则表明尽管比例几率假设是有效的，但生存时间不能视为具有 log-logistic 分布。示例 5.17  (患乳腺癌妇女的预后) 在本示例中，为了说明比例几率模型的使用，为乳腺癌症患者生存时间数据拟合该模型。为评估比例几率模型的适用性，计算了肿瘤呈阴性和阳性染色的女性的生存函数的 Kaplan-Meier 估计。对于这两组女性，估计了生存超过时间 \\(t\\) 的对数几率，并绘制其关于 \\(\\log t\\) 的图形，如图 5.25 所示。这些线是相当直且平行的，因此我们继续使用 log-logistic 比例几率模型来总结这些数据。\n可以使用用于拟合 log-logistic 加速失效时间模型的软件来拟合该模型。在示例 5.14 中为癌症患者生存数据拟合了前者模型。比例几率模型中 \\(\\kappa\\) 和 \\(\\theta\\) 的估计分别为 1.243 和 −6.787，与加速失效时间模型中的估计相同。然而，比例几率模型线性部分中 \\(\\beta\\) 的估计为 \\(\\hat{\\beta}=-1.149\\times1.243=-1.428\\)。这是相对于阴性染色女性，阳性染色女性生存超过时间 \\(t\\) 的几率比的对数的估计。相应的几率比为 \\(e^{-1.428}=0.24\\)。因此，相比肿瘤染色呈阳性的女性，肿瘤染色呈阴性的女性生存超过 \\(t\\) 的几率大约是其四倍。","code":""},{"path":"参数回归模型.html","id":"sec5-16","chapter":"►参数回归模型","heading":"5.16 治愈率建模","text":"在生存分析中，通常假设如果随访时间足够长，所有个体最终都会经历兴趣终点。如果终点是因任何原因的死亡，情况必然如此。然而，在一些研究中，相当一部分人可能在研究结束之前没有经历终点。这可能是因为治疗有效地治愈了患者。例如，在癌症试验中，兴趣可能集中在两种疗法的比较上，其中终点是死于特定类型的癌症。如果治疗有效，在相对较长的随访期内，将会有许多患者免死于癌症。这可能导致删失观测的比例比通常遇到的更大，这种情况有时称为重删失 (heavy censoring). 然而，严格来说，在随访期间未死亡个体的时间是删失的，而那些被治愈的个体不会死于所研究的疾病。已被治愈的个体，或更一般地说，那些无法再经历所研究事件的个体，最终会因某种原因而失效 (fail)，但可能会存活很长一段时间。在这种情况下，根据一组个体估计的生存函数将倾向于在某个正值处趋于平稳。那么可以假设总体由个体混合而成：易受终点影响的人，和那些不易受终点影响的人。后者对应于治愈的个体，长期生存的比例称为治愈分数 (cured fraction). 然后可以采用生存分析的标准方法，以便对治愈概率与事件发生时间同时建模。事件发生时间的模型可以扩展为包含治愈分数 \\(\\pi\\)，即治愈概率。在全参数模型中，生存函数变为\\[\\begin{align}\nS(t)=(1-\\pi)S_n(t)+\\pi\n\\tag{5.79}\n\\end{align}\\]其中 \\(S_n(t)\\) 是未治愈个体的生存函数。在式 (5.79) 中，\\(S(t)\\) 是由治愈和未治愈个体组成的群体的总体生存函数，该模型称为参数混合模型 (parametric mixture model). 当 \\(t \\rightarrow \\infty\\) 时，未治愈个体的生存函数趋于零，因此，根据式 (5.79)，\\(S(t)\\) 趋于 \\(\\pi\\)，即治愈概率 (probability cure). 整个群体对应的风险函数为\\[\\begin{align}\nh(t)&=-\\frac{\\text{d}\\log S(t)}{\\text{d}t}=\\frac{f_n(t)}{S_n(t)+\\pi/(1-\\pi)}\n\\tag{5.80}\n\\end{align}\\]其中\\[\\begin{aligned}f_n(t)=-\\frac{\\mathrm{d}}{\\mathrm{d}t}S_n(t)\\end{aligned}\\]是未治愈个体的密度函数。如果对未治愈个体的生存时间假定一个比例风险模型，则该个体在时间 \\(t\\) 时的死亡风险为\\[h_{{n}{}}(t)=\\exp(\\boldsymbol{\\beta'x}_{\\boldsymbol{}})h_{{n}0}(t)\\]其中 \\(\\boldsymbol{\\beta'x}_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\) 为在该个体上测量的 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 值的线性组合。\\(h_{n0}(t)\\) 为未治愈个体的基线风险函数。那么未治愈个体的生存函数为\\[S_{ni}(t)=[S_{n0}(t)]^{\\exp(\\boldsymbol{\\beta'x}_i)}\\]其中 \\(S_{n0}(t)=\\exp\\{-\\int_0^th_{n0}(u)\\mathrm{d}u\\}\\) 为其基线生存函数。此外，治愈概率可能取决于许多解释变量（尤其是与治疗组相关的变量），表示为 \\(Z_1,Z_2,\\ldots,Z_p\\)。然后，可以通过对治愈分数进行 logistic 变换，使其成为变量值 \\(z_{1i},z_{2i},\\ldots,z_{pi}\\) 的线性组合，来为第 \\(\\) 个个体的治愈概率关于这些变量的依赖性进行建模。那么\\[\\begin{aligned}\\text{logit }(\\pi_i)=\\log\\left(\\frac{\\pi_i}{1-\\pi_i}\\right)=\\phi_0+\\boldsymbol{\\phi'z}_i\\end{aligned}\\]其中 \\(=1,2,\\ldots,n,\\boldsymbol{\\phi'z}_i=\\phi_0+\\phi_1z_{1i}+\\phi_2z_{2i}+\\cdots+\\phi_pz_{pi}\\)。\\(\\phi_0,\\phi_1,\\ldots,\\phi_p\\) 为未知参数。那么治愈概率为\\[\\begin{aligned}\\pi_i=\\{1+\\exp(-\\boldsymbol{\\phi'z}_i)\\}^{-1}\\end{aligned}\\]未治愈个体的生存模型和治愈概率模型可能会出现相同的解释变量。此外，与生存模型不同，治愈概率模型通常包含一个常数项 \\(\\phi_0\\)，这是在模型中没有其他解释变量时，共同治愈概率 (common cure probability) 的 logistic 变换。现假设未治愈个体的生存时间可以使用 Weibull 分布进行建模，基线风险函数为 \\(h_{\\boldsymbol{n}0}(t)=\\lambda\\gamma t^{{\\gamma}-1}\\)。未治愈个体的风险函数为\\[\\begin{align}\nh_{ni}(t)=\\exp(\\boldsymbol{\\beta'x}_i)\\lambda\\gamma t^{\\gamma-1}\n\\tag{5.81}\n\\end{align}\\]相应的生存函数为\\[\\begin{align}\nS_{ni}(t)=[\\exp(-\\lambda t^\\gamma)]^{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)}=\\exp\\{-e^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}\\lambda t^\\gamma\\}\n\\tag{5.82}\n\\end{align}\\]如同本章描述的其他模型，可以使用最大似然法拟合包含治愈分数的模型。假设数据由 \\(n\\) 个生存时间 \\(t_1,t_2,\\ldots,t_n\\) 组成，并且 \\(δ_i\\) 是第 \\(\\) 个个体的事件指示符，因此如果第 \\(\\) 个个体死亡，则 \\(δ_i=1\\)，否则为 0. 根据式 (5.44)，似然函数为\\[L(\\boldsymbol{\\beta},\\boldsymbol{\\phi},\\lambda,\\gamma)=\\prod_{=1}^n\\left\\{h_i(t_i)\\right\\}^{\\delta_i}S_i(t_i)\\]这里，通过将式 (5.81) 和 (5.82) 中的 \\(h_{ni}(t_i)\\) 和 \\(S_{ni}(t_i)\\) 代入式 (5.79) 和 (5.80) 从而得到 \\(h_i(t_i)\\) 和 \\(S_i(t_i)\\)。然后可以使用计算机软件来最大化相应对数似然函数 \\(\\log L(\\boldsymbol{\\beta},\\boldsymbol{\\phi},\\lambda,\\gamma)\\) 以进行数值优化。这一过程得到未知参数 \\(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{\\phi}},\\hat{\\lambda},\\hat{{\\gamma}}\\) 的估计及其标准误。此外，在治愈概率模型或未治愈个体的生存模型中具有不同解释变量的模型，可以以通常的方式使用统计量 \\(-2\\log L(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{\\phi}},\\hat{\\lambda},\\hat{\\gamma})\\) 的值进行模型比较。可以对该模型进行许多扩展。例如，可以使用加速失效时间模型来代替未治愈个体的比例风险模型。","code":""},{"path":"参数回归模型.html","id":"sec5-17","chapter":"►参数回归模型","heading":"5.17 协变量调整的影响","text":"作为本章的结尾，以一个示例来说明生存数据参数模型开发过程中可能遇到的一个重要特征。在线性回归分析中，向模型添加协变量的一个效果是减小残差均方，从而提高基于模型的估计（如治疗效应）的精度。经解释变量调整的治疗效应估计，相比未调整的，具有更小的标准误。然而在生存数据建模中，包含有意义的 (relevant) 解释变量通常对参数估计的标准误影响甚微。事实上在调整协变量后，治疗效应估计的标准误甚至会更大。本质上，这是因为在是否包含协变量的两个模型中，治疗效应的解释不同，这一观点来自 Ford, Norrie Ahmadi (1995). 尽管如此，将有意义的解释变量纳入模型，并检查拟合模型是否合适，以确保获得治疗效应的准确估计，仍然是非常重要的。为了更详细地说明这一点，假设 \\(t_i\\) 是随机变量 \\(T_i\\) 的观测值，它与第 \\((=1,2,\\ldots,n)\\) 个个体的生存时间相关。我们将考虑这样的情况：有两个治疗组，每组有 \\(n/2\\) 个个体，有一个可用于每个个体的解释变量。这两个解释变量标记为 \\(X_1,X_2\\)，其中 \\(X_1\\) 表示治疗效应，取值为 0 或 1. 第 \\(\\) 个个体的 \\(X_1,X_2\\) 的值分别表示为 \\(x_{1i},x_{2i}\\)，并且我们写 \\(z_{ji}=x_{ji}-\\bar{x}_{j}\\)，其中 \\(\\bar x_j\\) 是解释变量 \\(X_j\\) 的样本均值，\\(j=1,2\\)。将采用比例风险模型来计算第 \\(\\) 个个体在时间 \\(t\\) 时的死亡风险关于 \\(z_{1i},z_{2i}\\) 值的依赖性，其中基线风险是恒定值 \\(\\lambda\\)。因此，风险函数可表示为\\[\\begin{align}\nh_i(t)=\\lambda\\exp(\\beta_1z_{1{}}+\\beta_2z_{2{}})\n\\tag{5.83}\n\\end{align}\\]在此模型下，生存时间服从均值为 \\(\\{\\lambda\\exp(\\beta_1z_{1i}+\\beta_2z_{2i})\\}^{-1}\\) 指数分布，使用 5.12.1 节给出的结果，该模型也可用加速失效时间形式表示为\\[\\begin{align}\n\\log T_i=\\mu-\\beta_1z_{1i}-\\beta_2z_{2i}+\\epsilon_i\n\\tag{5.84}\n\\end{align}\\]其中 \\(\\mu=-\\operatorname{log}\\lambda\\) 并且 \\(\\epsilon_i\\) 具有 Gumbel 分布，即 \\(\\log \\epsilon_i\\) 具有单位指数分布。式 (5.83) 或 (5.84) 所示的模型将称为模型 (1).使用附录 中给出的最大似然估计结果，可证明模型 (1) 中治疗效应估计 \\(\\hat{\\beta}_{1}\\) 的近似方差为\\[\\begin{aligned}\\text{var }(\\hat{\\beta}_1)&=\\frac{1}{[1-\\{\\text{ corr }(z_1,z_2)\\}^2]\\sum_{=1}^nz_{1i}^2}\\end{aligned}\\]其中 \\(\\mathrm{corr}\\left(z_1,z_2\\right)\\) 是 \\(z_{1i}\\) 和 \\(z_{2i}\\) 值之间的样本相关系数。由于 \\(z_{1i}\\) 要么为 -0.5 要么为 0.5，并且两组个体数相等，则 \\(\\sum_{{}=1}^nz_{1{}}^2=n/4\\)，所以\\[\\begin{align}\n\\text{var }(\\hat{\\beta}_1)&=\\frac{4}{n[1-\\{\\text{ corr }(z_1,z_2)\\}^2]}\n\\tag{5.85}\n\\end{align}\\]现在考虑只包括与治疗效应相关的变量 \\(X_1\\) 的模型，因此\\[\\begin{align}\nh_i(t)=\\lambda\\exp(\\beta_1z_{1{}})\n\\tag{5.86}\n\\end{align}\\]或等价地\\[\\begin{align}\n\\log T_i=\\mu-\\beta_1z_{1i}+\\epsilon_i\n\\tag{5.87}\n\\end{align}\\]其中 \\(\\log \\epsilon_i\\) 也具有单位指数分布。式 (5.86) 或 (5.87) 描述的模型称为模型 (2). 在该模型中，\\(\\hat \\beta_1\\) 的近似方差为 \\(\\text{var }(\\hat{\\beta}_1)=4n^{{-}1}\\)。由于式 (5.85) 中的项 \\(1-\\{\\text{ corr }(z_1,z_2)\\}^2\\) 始终小于等于 1，因此模型 (1) 中 \\(\\hat \\beta_1\\) 的方差大于等于模型 (2) 中 \\(\\hat \\beta_1\\) 的方差。因此，在模型 (1) 中添加解释变量 \\(X_2\\) 并不能减小治疗效应估计的方差。究其原因，在于模型 (1) 和模型 (2) 不能同时对同一数据集有效。如果模型 (1) 是正确的，但实际拟合了模型 (2)，则式 (5.87) 中的残差项不是 \\(\\epsilon_i\\)，而是 \\(\\epsilon_i−\\beta_2 z_{2i}\\)。类似地，模型 (2) 是正确的，但实际拟合了模型 (1)，我们不能假设式 (5.84) 中的 \\(\\log \\epsilon_i\\) 具有单位指数分布。此外，由于模型中包含冗余参数 \\(\\beta_2\\)，反而降低了参数 \\(\\beta_1\\) 估计的精度。Ford, Norrie Ahmadi (1995) 的论文中给出了更详细的分析和模拟研究，这些研究证实了一个普遍的观点：在生存数据模型中包含解释变量不能预期增加治疗效应估计的精度。","code":""},{"path":"参数回归模型.html","id":"sec5-18","chapter":"►参数回归模型","heading":"5.18 延伸阅读","text":"Johnson, Kotz Balakrishnan (1994) 给出了指数分布、Weibull 分布和其他连续分布的性质。Chhikara Folks (1989) 对逆高斯分布进行了详细的研究。Gaver Acar (1979) 讨论了二次风险函数的使用，Hjorth (1980) 提出了浴缸风险函数。Barnett (1999), Cox Hinkley (1974) 对最大似然估计理论进行了深入的讨论，Hinkley, Reid Snell (1991) 对主要结果进行了有用的总结。Everitt (1987) 和 Thisted (1988) 描述了用于获得最大似然估计的数值方法，特别是 Newton-Raphson 程序；另请参见第 3 章 3.3.3 节的说明。Byar (1982) 提供了 Cox 和 Weibull 比例风险模型的比较。Cox Oakes (1984) 表明，Weibull 分布是唯一同时具有比例风险性和加速失效时间性的分布。他们还证明，log-logistic 分布是唯一具有加速失效时间性和比例几率性的分布。另一种具有比例风险性的分布是 Pareto 分布。该模型在实践中很少使用，可参阅 Davis Feldstein (1979) 了解更多详细信息。许多关于生存分析的主要教科书都包含对生存数据的对数线性模型的描述；特别是 Cox Oakes (1984), Kalbfleisch Prentice (2002), Klein Moeschberger (2005) 和 Lawless (2002).Wei (1992) 引入了加速失效时间模型的非参数版本，它不需要指定生存数据的概率分布。该文以及 Fisher (1992) 的讨论，包含了是否应更广泛地在生存数据分析中使用加速失效时间模型的评论。Crowder et al. (1991) 描述了加速失效时间和比例几率模型在可靠性数据分析中的应用。Bennett (1983a) 引入了生存数据的一般比例几率模型，Bennett (1983b) 描述了 log-logistic 比例几率模型。该模型由 Yang Prentice (1999) 进一步发展。定义并比较 Weibull 模型解释的变异的度量的论文包括 Kent O’Quigley (1988) 以及 Royston Sauerbrei (2004) 的论文，详见第 3 章。Chan, Xu Chambers (2018) 研究了式 (5.75)中关于解释的变异的度量 \\(R^2_P\\) 在不同加速失效时间模型中的性能。对生存数据进行建模的一种更通用的方法是使用一系列生存时间分布，其中以 Weibull 和 log-logistic 作为特殊情况。那么可以在似然框架内做出替代分布之间的选择。具体来说，指数分布, Weibull 分布, log-logistic 分布, log-normal 分布和 gamma 分布是 Kalbfleisch Prentice (2002) 描述的广义 F 分布的特例。然而，这种方法只会在分析死亡数相对较多的数据集时富有信息。RamlauHansen (1983) 以及 Klein Moeschberger (2005) 的文章中描述了基于核平滑的风险函数的估计。许多作者描述了包含治愈分数的参数混合模型及其对半参数模型的扩展，如 Fareway (1982), Kuk Chen (1992), Taylor (1995), Sy Taylor (2000) 以及 Peng Dear (2000).","code":""},{"path":"chap6.html","id":"chap6","chapter":"第 6 章 灵活的参数模型","heading":"第 6 章 灵活的参数模型","text":"第 5 章描述的生存分析参数模型的基线风险函数仅依赖于少量未知参数，因此捕获基线风险潜在形式的能力有限。相比之下，Cox 回归模型的主要优点通常被认为是基线风险函数的灵活性，因为它可以适应任何特定数据集所需的模式。Cox 模型的这一优势常常被夸大了。由于 Cox 模型中的基线风险函数是根据数据估计的，以给出在每个事件时间都有跳跃的阶跃函数，因此它的表现可能非常不稳定，如第 3 章的示例 3.14. 此外，个体的生存函数估计在事件时间之间是恒定的，因此可能无法估计精确时间处的生存率。此外，无法估计超过数据集最远事件时间的生存率。灵活的参数模型弥补了 Cox 半参数模型和全参数模型之间的差距，当标准参数模型不能令人满意地描述潜在的基线风险或生存函数时，该模型可能具有很大的价值。","code":""},{"path":"chap6.html","id":"sec6-1","chapter":"第 6 章 灵活的参数模型","heading":"6.1 分段指数模型","text":"在 Cox 回归模型中，第 \\(\\) 个个体的风险函数为\\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\end{aligned}\\]其中 \\(\\boldsymbol x_i\\) 是 \\(p\\) 个解释变量的值向量，\\(\\boldsymbol \\beta\\) 是它们的系数向量，\\(h_0(t)\\) 是基线风险函数。通过最大化不依赖于 \\(h_0(t)\\) 的偏似然函数来拟合模型，这得到了 \\(\\boldsymbol \\beta\\) 的估计。随后，可以通过随事件时间变化的阶跃函数来估计风险、累积风险和生存函数。我们现在考虑该模型的一个版本：基线风险函数通过使用每个事件时间区间的参数进行显式建模。假设 \\(n\\) 个个体的生存时间由 \\(r\\) 个有序事件时间 \\(t_{(1)}<t_{(2)}<\\cdots<t_{(r)}\\) 和 \\(n − r\\) 个右删失时间组成。在相邻事件时间之间基线风险恒定的模型中，我们可以设\\[\\begin{align}\nh_0(t)=\\lambda_j\n\\tag{6.1}\n\\end{align}\\]其中 \\(t_{(j-1)}\\leqslant t<t_{(j)},\\lambda_j>0,j=1,2,\\ldots,r\\) 且 \\(t_{(0)}=0\\)。因为 \\(\\lambda_j>0\\)，该模型通常通过设 \\(\\lambda_j=\\exp(\\phi_j)\\) 并将 \\(\\phi\\) 视为基线风险中的未知参数来进行参数化。式 (6.1) 中的风险函数在每个时间区间内是分段常数，因此对应于在每个时间区间内拟合单个指数模型。因此，该模型称为分段指数模型 (piecewise exponential model). 风险函数变化的时间点是 \\(t_{(1)},t_{(2)},\\ldots,t_{(r-1)}\\)，这些点称为分割点或结 (cut points knots).为估计该模型的未知参数，我们可以使用最大似然法，如第 3 章 3.3 节所述。全参数模型 (fully parametric model) 的似然函数为\\[\\begin{align}\n\\prod_{=1}^n\\left\\{h_i(t_i)\\right\\}^{\\delta_i}S_i(t_i)\n\\tag{6.2}\n\\end{align}\\]这首次在第 4 章的式 (5.15) 中给出，其中 \\(h_i(t_i)\\) 和 \\(S_i(t_i)\\) 是第 \\(\\) 个个体在时间 \\(t_i\\) 的风险和生存函数，\\(=1,2,\\ldots,n\\)，\\(\\delta_i\\) 是事件指示符。在式 (6.1) 中对基线风险函数进行积分后，累积基线风险为\\[\\begin{align}\nH_0(t)=\\sum_{j=1}^r\\lambda_j\\Delta_j(t)\n\\tag{6.3}\n\\end{align}\\]其中\\[\\left.\\Delta_j(t)=\\left\\{\\begin{array}{ll}0&t<t_{(j-1)},\\\\t-t_{(j-1)}&t_{(j-1)}\\leqslant t<t_{(j)},\\\\t_{(j)}-t_{(j-1)}&t\\geqslant t_{(j)}\\end{array}\\right.\\right.\\]该累积风险函数由每个区间内的直线段组成。第 \\(\\) 个个体的相应累积风险函数为 \\(H_{{}}(t)=\\operatorname{exp}(\\boldsymbol{\\beta'x}_{{}})H_{0}(t)\\)，然后可以使用第 1 章的式 (1.6) 中给出的关系式 \\(S_{{}}(t)=\\operatorname{exp}\\{-H_{}(t)\\}\\) 来得到生存函数。原则上，基线风险函数的未知参数 \\(\\lambda_1,\\lambda_2,\\ldots,\\lambda_r\\) 可以通过最大化式 (6.2) 中似然函数的对数与 \\(\\beta\\) 一起估计。当数据中的每个区间都有一个单独的参数 \\(\\lambda\\)，试图最大化该对数似然函数时可能会出现实质性的数值问题，尤其是有较多的事件时间时。然而，现在可以使用快速有效的算法来完成计算。这些算法主要是为处理区间删失数据而开发的（如第 9 章所述），但由于右删失是区间删失的特殊情况，因此这里可以使用相同的算法。即便如此，这些方法对计算的要求仍然很高。此外，基于信息矩阵、在附录 中描述的构建估计的标准误的通常方法是不稳定的，因此通常使用模拟方法。被称为 bootstrapping 的模拟过程涉及从数据集中有放回地抽取 \\(n\\) 个观测值，并为该样本估计未知参数。该过程会重复很多次，可能是 500 或更多次，根据各个 bootstrap 估计来计算每个估计的样本标准差。然后使用这些标准差来总结参数估计的精度。除了计算困难之外，为每个区间提供一个单独的参数并不能真正有效地总结潜在的风险。在构建分段恒定基线风险时，采用更少的时间区间是优选的且更简单的。实际区间数将取决于数据集的大小，但通常不需要超过 10 个区间。另一个问题是将区间的端点定位于何处。一种常用的方法是将研究的时间段划分为这些区间：每个区间包含相似数量的事件时间。或者，也可以选择这样一种方式来划分时间区间：风险变化较快时，时间区间较窄；风险变化较慢时，时间区间较宽。合理选择区间边界应能为任何基线风险提供合理的近似值。下面的示例说明了分段指数模型的使用。示例 6.1  (肾癌的治疗) 第 3 章示例 3.4 中描述了一项涉及 36 名肾癌患者生存时间数据的研究。拟合了包括年龄组和肾切除术状态的 Cox 回归模型，并在示例 3.14 中给出了风险函数的估计。肾切除术状态的风险比为 \\(\\exp(−1.412)=0.244\\)，60 - 70 岁人群和 70 岁以上人群相对于 60 岁以下人群的风险比分别为 \\(\\exp(0.013)=1.013\\) 和 \\(\\exp(1.342)=3.825\\)。在 23 个有序事件时间之间拟合具有恒定风险的分段指数模型时，所得肾切除状态和年龄组的风险比分别为 0.215, 1.124 和 4.518，这与根据 Cox 回归模型获得的风险比非常相似。基线风险函数中 \\(\\lambda\\) 参数的估计与第 3 章表 3.19 给出的值大致相似，尽管两组估计都非常不精确。拟合的分段指数模型的风险函数如图 6.1 所示。这与 Cox 模型的模式类似，如第 3 章图 3.4 所示。\n估计的基线风险函数有 22 个不同的参数，对于这种规模的数据集来说，它被严重地过度参数化了。为了说明，还拟合了仅具有五个区间的分段指数模型，其中以时间 12, 26, 56 和 84 个月为划分定义了区间。 这四个分割点或结，介于最短事件时间 5 个月和最长事件时间 115 个月之间，大致对应于事件时间的五分位数。肾切除术状态和年龄组的风险比现在分别为 0.236, 1.179 和 4.944，这与具有 22 个区间的模型所得结果非常相似。可以使用第 3 章式 (3.14) 中定义的 AIC 统计量来比较这两个分段指数模型。具有 22 个区间的模型的未知参数数量 \\(q\\) 为 22+3=25，该模型的 AIC 值为 298.70. 对于具有五个区间的模型，参数数量为 8，AIC 值为 283.48. 因此，应优选更简单的模型。请注意，拟合的 Cox 回归模型的 AIC 统计量是基于最大偏似然值构建的，因此不能与基于完全似然值的分段指数模型的 AIC 值进行比较。图 6.1 表明每个区间内的五个单独的风险非常相似，因此基线风险实际上可能是恒定的。那么数据将呈指数分布，拟合该模型后得到的恒定基线风险为 0.058. 相应的 AIC 统计量值为 298.76，因此该模型无法像具有五个区间的更复杂的分段模型一样拟合这些数据。在拟合的 Cox 回归模型中，很难识别出基线风险函数估计的模式，因为每个事件时间的风险是由该时间的事件数量和风险数量确定的。潜在的风险函数是阶梯式的可能性很小，因此需要对该函数进行平滑估计，这可以通过对累积基线风险估计应用平滑过程来实现，然后进行数值微分从而给出风险函数本身的平滑估计。尽管该估计在描述性分析中很有用，但使用拟合曲线来估计（或验证）拟合模型的生存率并不简单，更令人满意的方法是使用基于平滑参数函数的风险模型，并且这些将在随后的部分中描述。","code":""},{"path":"chap6.html","id":"sec6-2","chapter":"第 6 章 灵活的参数模型","heading":"6.2 使用样条函数建模","text":"样条函数 (spline functions) 在生物医学研究中广泛应用，以为时间的非线性函数建模。它们是通过将时间尺度划分为若干个区间，并在每个区间内拟合生存时间 \\(t\\) 的多项式函数来构建的。这样做的目的是使函数在区间边界处（结, knot）能够平滑连接。定义区间的结的集合称为结序列 (knot sequence). 在最简单的情况下，我们取 \\(t\\) 的最小值和最大值，并将时间范围分为两半。那么在 \\(t\\) 的极值处会有两个边界结 (boundary knots)，以及在它们之间有一个内部结 (internal knot). 增加内部结的数量会得到更复杂的曲线。样条函数的阶定义为构成它的多项式函数的阶。通常使用三次样条函数 (spline functions degree three)，也称为立方样条 (cubic splines)，因为它们是简单性和灵活性的折衷。它们还易于计算，数值稳定，并产生平滑的曲线，因此我们将重点关注这些函数。为了说明样条函数，假设 \\(t\\) 的取值范围是从 \\(t_{\\text{min}}\\) 到 \\(t_{\\text{max}}\\)，并在 \\(t=t_1\\) 的点上指定了一个内部结。那么，可为 \\(t_{\\min}\\leqslant t\\leqslant t_1\\) 和 \\(t_1\\leqslant t\\leqslant t_{\\max}\\) 定义 \\(t\\) 的三次表达式。然后，约束这两个三次表达式在内部结 \\(t_1\\) 处平滑连接，从而得到一个立方样条。现考虑一个在变量 \\(t\\) 取值范围内定义的立方样条函数，其中 \\(m\\) 个内部结定义在 \\(t_1,t_2,\\ldots,t_m\\) 处，且 \\(t\\) 的最小值和最大值分别为边界结 \\(t_{\\text{min}}\\) 和 \\(t_{\\text{max}}\\)。那么将有 \\(m+1\\) 个区间，并在这些区间上拟合三次表达式。每个单独的三次函数，称为基函数 (basis function)，被约束：在内部结处平滑地连接相邻函数。所需的基函数数量随着内部结数量的增加而增加，这些基函数的线性组合就是样条函数。在模型拟合过程中，对构成样条函数的基函数的未知系数进行估计。样条函数有许多不同类型，但我们只关注那些最常用于生存数据建模的函数上。","code":""},{"path":"chap6.html","id":"sec6-2-1","chapter":"第 6 章 灵活的参数模型","heading":"6.2.1 B 样条","text":"具有 \\(m\\) 个内部结的 \\(k\\) 阶 B 样条函数由 \\(m + k + 1\\) 个基函数（每个基函数都为 \\(k\\) 阶）构造而成。这些基函数的任何线性组合都会产生一条平滑曲线，可用于对 \\(t\\) 的特定函数进行建模，例如风险函数或生存函数。\\(t\\) 的 B 样条函数由下式给出\\[\\begin{align}\nB(t)=\\sum_{j=1}^{m+k+1}\\alpha_jB_{j,k}(t),\\quad t_{\\min}\\leqslant t\\leqslant t_{\\max}\n\\tag{6.4}\n\\end{align}\\]其中 \\(B_{j,k}(t)\\) 为 \\(k\\) 阶基函数，系数为 \\(\\alpha_j,j=1,2,\\ldots,m+k+1\\)。当式 (6.4) 中的 \\(k = 3\\)，得到一个立方样条函数\\[\\begin{align}\nB(t)=\\sum_{j=1}^{m+4}\\alpha_jB_{j,3}(t),\\quad t_{\\min}\\leqslant t\\leqslant t_{\\max}\n\\tag{6.5}\n\\end{align}\\]其具有 \\(m + 4\\) 个三阶基函数 \\(B_{j,3}(t)\\)。通过为观测数据拟合该函数来估计该函数中的 \\(m + 4\\) 个未知 \\(\\alpha\\) 参数。立方样条的第 \\(j\\) 个基函数 \\(B_{j,3}(t)\\) 是通过递归关系 (recurrence relationship) 来定义的。但首先，为了让递归关系得到完全定义，需在结序列中添加三个下边界结和三个上边界结。那么完全结序列 (full knot sequence) 为\\[t_{\\min},t_{\\min},t_{\\min},t_{\\min},t_{1},t_{2},\\ldots,t_{m},t_{\\max},t_{\\max},t_{\\max},t_{\\max}\\]这些 \\(m+8\\) 个扩展后的结现在表示为 \\(\\tau_{1},\\tau_{2},\\ldots,\\tau_{m+8}\\)。对于该序列中的每个结，使用递归关系来获得 B 样条基函数 \\(B_{j,3}(t)\\)。首先，令\\[\\left.B_{j,0}(t)=\\left\\{\\begin{array}{ll}1&&\\text{}\\tau_j\\leqslant t<\\tau_{j+1},\\\\0&&\\text{otherwise},\\end{array}\\right.\\right.\\]以给出第 \\(j\\) 个零阶基函数。然后，利用递归关系得到 1, 2 和 3 阶基函数\\[\\begin{align}\nB_{j,k+1}(t)=\\omega_{j,k+1}(t)B_{j,k}(t)+\\{1-\\omega_{j+1,k+1}(t)\\}B_{j+1,k}(t)\n\\tag{6.6}\n\\end{align}\\]其中\\[\\left.\\omega_{j,k}(t)=\\left\\{\\begin{array}{ll}(t-\\tau_j)/(\\tau_{j+k}-\\tau_j)&\\quad\\text{}\\tau_{j+k}\\neq\\tau_j\\\\0&\\quad\\text{otherwise},\\end{array}\\right.\\right.\\]\\(j=1,2,\\ldots,m+4\\)。通过在式 (6.6) 中依次设 \\(k = 0, 1, 2\\)，该递归过程得到 \\(m + 4\\) 个三阶 B 样条基函数 \\(B_{j,3}(t),j=1,2,\\ldots,m+4\\)。将这些函数代入式 (6.5) 中，我们就得到了可拟合观测数据的三次 B 样条函数。该递归参数如示例 6.2 所示。示例 6.2  (一个样条函数的说明) 为了说明构建 B 样条的过程，假设数据集包含范围为 0 到 10 个单位的生存时间。此外，假设时间 \\(t\\) 的三次 B 样条函数仅用一个内部结来构造，即在式 (6.5) 中 \\(m=1\\)。将该结置于时间尺度的中点 \\(t = 5\\)。边界结置于 0 和 10 处，重复边界结以给出扩展的结序列 \\((0,0,0,0,5,10,10,10,10)\\)。样条函数将有五个基函数 \\(B_{j,3}(t)\\)，使用式 (6.6) 中的递归关系，通过取 \\(k = 0,1,2\\) 和 \\(j = 1,2,\\ldots,5\\) 来构造。经过大量代数运算，得到如下的基函数\\[\n\\left.\n\\begin{aligned}\nB_{1,3}(t)&=\\left\\{\\begin{array}{ll}(-t^3+15t^2-75t+125)/125&\\quad\\quad\\:\\:\\:\\:\\:0\\leqslant t<5\\\\0&\\quad\\quad\\:\\:\\:\\:\\:5\\leqslant t<10\\end{array}\\right.\\\\\nB_{2,3}(t)&=\\left\\{\\begin{array}{ll}t(7t^2-90t+300)/500&\\quad\\:\\:\\:\\:\\:0\\leqslant t<5\\\\(-t^3+30t^2-300t+1000)/500&\\quad\\:\\:\\:\\:\\:5\\leqslant t<10\\end{array}\\right.\\\\\nB_{3,3}(t)&=\\left\\{\\begin{array}{ll}t^2(-2t+15)/250&\\quad\\quad\\,\\,\\,\\,\\:0\\leqslant t<5\\\\(2t^3-45t^2+300t-500)/250&\\quad\\quad\\,\\,\\,\\,\\:5\\leqslant t<10\\end{array}\\right.\\\\\nB_{4,3}(t)&=\\left\\{\\begin{array}{ll}t^3/500&\\,\\quad0\\leqslant t<5\\\\(-7t^3+120t^2-600t+1000)/500&\\quad\\,5\\leqslant t<10\\end{array}\\right.\\\\\nB_{5,3}(t)&=\\left\\{\\begin{array}{ll}0&\\quad\\quad\\quad\\quad0\\leqslant t<5\\\\(t^3-15t^2+75t-125)/125&\\quad\\quad\\quad\\quad5\\leqslant t<10\\end{array}\\right.\n\\end{aligned}\\right.\n\\]每个基函数都是定义在范围 \\((0,10)\\) 内的 \\(t\\) 的三次表达式，在内部结的位置有光滑的连接，这些基函数在图 6.2 中以虚线表示，该图显示了三次表达式在内部结 \\(t = 5\\) 两侧如何光滑相连。\n现假设使用样条函数 \\(B(t)=\\sum_{j=1}^5\\alpha_jB_{j,3}(t)\\) 对 \\(t\\) 的函数进行建模，样条基函数的五个系数 \\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_5\\) 的估计分别为 0.8, -0.3, 1.2, 0.5 和 0.4. 所得的拟合函数如图 6.2 中的实线所示。该图所示的 B 样条函数先减小后增大，在 \\(t = 6\\) 左右到达峰值，然后缓慢减小。该图还说明了基函数值的线性组合如何产生平滑的样条函数。不同的 \\(\\alpha\\) 系数值的集合将得到不同的样条曲线。以这种方式构造的样条函数可用于表示各种函数形式，并且在对基线风险函数或其对数进行建模时特别有用。","code":""},{"path":"chap6.html","id":"sec6-2-2","chapter":"第 6 章 灵活的参数模型","heading":"6.2.2 限制性立方样条","text":"多项式样条，如 B 样条，在生存时间 \\(t\\) 的观测值范围极值处（即边界结附近）可能会表现得不稳定。此外，B 样条函数在这些边界结之外是未定义的。这限制了模型在观测值范围之外预测的有效性。这可以通过使用限制性或自然 (restricted nature) 立方样条来解决：使用 \\(m\\) 个内部结将 \\(t\\) 值的范围再次划分为 \\(m+1\\) 个区间，并在每个区间内拟合一个三次表达式，同时在结处平滑连接。此外，当 \\(t<k_{\\min}\\) 和 \\(t>k_{\\max}\\) 时，假设 \\(t\\) 有一个线性项。这得到了比 B 样条模型更简单的表示，因为对于给定数量的内部结，所需基函数的数量减少了。图 6.3 显示了一个限制性立方样条，其边界结位于 \\(k_\\min\\) 和 \\(k_\\max\\)，内部结位于 \\(k_1\\)。\n当有 \\(m\\) 个内部结时，限制性立方样条具有 \\(m\\) 个基函数，记为 \\(\\nu_1(t),\\nu_2(t),\\ldots,\\nu_m(t)\\)。此限制性立方样条为\\[\\begin{align}\n\\gamma_0+\\gamma_1t+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(t)\n\\tag{6.7}\n\\end{align}\\]在该表达式中，第 \\(j\\) 个基函数 \\(\\nu_j(t)\\) 由下式给出\\[\\begin{align}\n\\nu_j(t)=(t-k_j)_+^3-\\lambda_j(t-k_{\\min})_+^3-(1-\\lambda_j)(t-k_{\\max})_+^3\n\\tag{6.8}\n\\end{align}\\]其中 \\(k_j\\) 是第 \\(j\\) 个内部结，\\(j = 1,2,\\ldots,m\\)\\[\\begin{align}\n\\lambda_j=\\frac{k_{\\max}-k_j}{k_{\\max}-k_{\\min}}\n\\tag{6.9}\n\\end{align}\\]以及对于 \\(\\) 的任意值 \\((t-)_+^3=\\max\\{0,(t-)^3\\}\\)，即 \\((t-)_+^3\\) 为 \\(0\\) 和 \\((t-)^3\\) 中的较大者。该样条函数有 \\(m + 2\\) 个未知的 \\(\\gamma\\) 参数，通过为观测数据拟合样条函数来估计。在 \\(m = 0\\) 的特殊情况下，即没有内部结的情况下，得到的限制性立方样条只是 \\(t\\) 的线性函数 \\(\\gamma_0+\\gamma_1t\\)。示例 6.3  (一个样条函数的说明) 在示例 6.2 中，为由范围在 0 到 10 个单位的生存时间 \\(t\\) 组成的数据构造了一个 B 样条函数，其中在 \\(t = 5\\) 处有一个内部结。本实例得到了相应的限制性立方样条函数的表达式。边界结分别为 \\(k_\\min = 0\\) 和 \\(k_\\max = 10\\)，内部结位于 \\(k_1 = 5\\) 处。具有一个内部结的限制性立方样条只有一个基函数，根据式 (6.8)，这由下式给出：\\[\\begin{aligned}\\nu_1(t)=(t-5)_+^3-\\lambda_1(t-0)_+^3-(1-\\lambda_1)(t-10)_+^3\\end{aligned}\\]其中根据式 (6.9)\\[\\begin{aligned}\\lambda_1=(10-5)/(10-0)=0.5\\end{aligned}\\]因此当 \\(t\\leqslant10\\) 时，基函数为\\[\\begin{aligned}\\nu_1(t)=(t-5)_+^3-0.5t^3-0.5(t-10)_+^3\\end{aligned}\\]因此\\[\\left.\\nu_1(t)=\\left\\{\\begin{array}{ll}-0.5t^3&\\quad0\\leqslant t<5\\\\(t-5)^3-0.5t^3&\\quad5\\leqslant t<10\\end{array}\\right.\\right.\\]对于 \\(t>10\\)\\[\\begin{aligned}\\nu_1(t)=(t-5)^3-0.5t^3-0.5(t-10)^3\\end{aligned}\\]它可化简为 \\(\\nu_1(t)=375-75t\\)，因此 \\(\\nu_1(t)\\)，即限制性样条函数，对于上边界结之外的 \\(t\\) 是线性的。对于式 (6.7) 中的 \\(\\gamma_{0},\\gamma_{1}\\) 和 \\(\\gamma_2\\) 的任何值，限制性立方样条函数为 \\(\\gamma_0+\\gamma_1t+\\gamma_2\\nu_1(t)\\)，它在 \\(t > 10\\) 时是线性的，在 \\(0 \\leqslant t < 5\\) 和 \\(5 \\leqslant t < 10\\) 时是三次表达式。与 B 样条函数不同，限制性立方样条函数为所有 \\(t\\) 值都有定义，而不仅仅是边界结之间的值。此处描述的样条函数可用于对风险或累积风险函数建模，并为生存数据生成极其灵活的参数模型。","code":""},{"path":"chap6.html","id":"sec6-2-3","chapter":"第 6 章 灵活的参数模型","heading":"6.2.3 结数和位置","text":"无论使用什么样条函数，结数和位置都会对拟合函数的形式产生一些影响。尽管一些作者建议使用自动或数据驱动的程序来确定结的放置位置，但也有其他人对此提出警告，因为它们可能会受到数据集局部特征的过度影响，在构造参数估计的标准误时很难考虑到这一点。相反，通常建议边界结是数据集中观测事件时间的最小值和最大值，内部结则按照未删失事件时间分布的百分位数进行等距分布。具体来说，一个内部结应位于观测生存时间的未删失值的中位数，两个内部结应分别位于 33% 和 67% 的百分位数，三个内部结应位于四分位数，以此类推。在实际应用中，通常不需要超过 4 或 5 个结。为了确定要使用的结数，我们首先从两个边界结开始。然后拟合一个具有一个内部结的模型，并将其与没有内部结的模型进行比较。接下来，拟合一个具有两个内部结的模型，并将其与具有一个内部结的模型进行比较，以此类推。由于结的位置会随着其数量的增加而改变，例如从一个内部结到两个内部结，其位置从事件时间分布的中位数变为分布的 33% 和 67% 的百分位数，因此具有不同结数的模型并不一定是嵌套的。这意味着 \\(−2 \\log \\hat L\\) 统计量通常不能用于确定增加结数是否能显著提高模型的拟合度。相反，可以使用第 3 章 3.6.1 节中介绍的 AIC 统计量。AIC 统计量为 \\(−2 \\log \\hat L + 2q\\)，其中 \\(q\\) 是拟合模型中未知参数的总数，包括与样条函数相关的参数。例如，当在包含 \\(p\\) 个解释变量的生存时间模型中使用具有 \\(m\\) 个内部结的限制性立方样条模型时，样条函数中将有 \\(p\\) 个 \\(\\beta\\) 参数和 \\(m + 2\\) 个 \\(\\gamma\\) 系数，因此 \\(q=p+m+2\\)。AIC 统计量最小的模型通常是最合适的，因此增加结数直到 AIC 统计量无法进一步减小。也可以使用 BIC 统计量以类似的方式比较模型，该统计量也在第 3 章的 3.6.1 节中定义。","code":""},{"path":"chap6.html","id":"sec6-3","chapter":"第 6 章 灵活的参数模型","heading":"6.3 风险函数的灵活模型","text":"基线风险函数的样条模型为参数建模提供了一种灵活的方法。考虑一个比例风险模型，其中第 \\(\\) 个个体在时间 \\(t\\) 发生事件的风险为\\[h_i(t)=\\exp(\\eta_i)h_0(t)\\]以及 \\(\\eta_i=\\boldsymbol \\beta'\\boldsymbol x_i\\)，其中 \\(\\boldsymbol\\beta\\) 是 \\(p\\) 个解释变量的系数。为了确保拟合的风险函数始终非负，模型是根据基线风险函数的对数构建的。如果将具有 \\(m\\) 个内部结的时间的三次 B 样条函数用于对数基线风险 \\(\\log h_0(t)\\)，那么使用的式 (6.5) 中样条函数\\[\\begin{aligned}\\log h_0(t)=\\sum_{j=1}^{m+4}\\alpha_jB_{j,3}(t)\\end{aligned}\\]第 \\(\\) 个个体对数风险函数的样条模型为\\[\\begin{align}\n\\log h_i(t)=\\eta_i+\\sum_{j=1}^{m+4}\\alpha_jB_{j,3}(t)\n\\tag{6.10}\n\\end{align}\\]该模型可以通过最大化观测数据的似然函数来拟合，如式 (6.2) 所示。为此，可以通过首先对基线风险函数进行积分来获得累积基线风险 \\(H_0(t)\\)，然后得到生存函数 \\(S_i(t)\\)。这必须以数值方式完成，因为使用的是对数风险尺度上的 B 样条曲线。那么 \\(S_i(t) = \\exp\\{−e^{\\eta_i}H_0(t)\\}\\)。如 6.2.3 节所述，通过用不断增加的结数来拟合模型，以实现建模程序。对于每个模型，使用诸如 AIC 或 BIC 统计量之类的模型充分性的度量来识别具有这些最小统计量值的模型。该模型的一个重要特例是使用零阶 B 样条基函数，即式 (6.4) 中的 \\(k = 0\\)。此时，有 \\(m + 1\\) 个样条基函数 \\(B_{j,0}(t)\\)，对于 \\(t_j\\leqslant t<t_{j+1},j=1,2,\\ldots,m+1\\) 它们为 1，其中 \\(t_1=t_{\\min},t_{m+2}=t_\\max\\)，否则为 0. 那么，B 样条函数在 \\(m+1\\) 个时间区间中的每个时间区间中是恒定的。风险函数的相应模型为\\[h_0(t)=\\exp\\left\\{\\sum_{j=1}^{m+1}\\alpha_jB_{j,0}(t)\\right\\}\\]因此在第 \\(j(j=1,2,\\ldots,m+1)\\) 个时间区间中 \\(h_0(t)=\\exp(\\alpha_j)\\)。这是 6.1 节描述的分段指数模型的另一种形式，并且当结数和位置为事件时间数及其位置时，该模型就是 Cox 回归模型。示例 6.4  (肾癌的治疗) 在示例 6.1 中，为肾癌患者数据拟合了分段指数风险函数，现在我们考虑使用式 (6.10) 中的模型，用基于样条函数的参数模型对基线风险进行建模，拟合包含年龄组和肾切除状态的比例风险模型，其中对数基线风险函数是三次 B 样条函数。在拟合模型时，如果模型中的内部结书不断增加，位于事件时间的百分位数，我们发现，对于具有两个内部结的模型，AIC 统计量的值最小。拟合的基线风险函数是六个基函数的线性组合的指数，由下式给出\\[\\begin{aligned}\\hat{h}_0(t)=\\exp\\{\\hat{\\alpha}_1B_{1,3}(t)+\\hat{\\alpha}_2B_{2,3}(t)+\\cdots+\\hat{\\alpha}_6B_{6,3}(t)\\}\\end{aligned}\\]其中函数 \\(B_{j,3}(t),j=1,2,\\ldots,6\\) 为 \\(t\\) 的三次表达式。这得到了一个相当复杂的关于 \\(t\\) 的函数，如图 6.4 所示。\n该图中的基线风险函数估计在 10 天和 40 天左右达到峰值，此后下降。在图 6.1 的分段指数回归模型的基线风险函数图中，这两个峰值也隐约可见。对于该模型，肾切除状态的风险比为 0.250，60 - 70 岁和 70 岁以上患者相对于 60 岁以下患者的风险比分别为 0.962 和 3.974。这些与示例 6.1 中拟合的分段指数模型发现的结果非常相似，因此基线风险函数估计的精确形式对估计风险比几乎没有影响。然而，具有两个内部结的 B 样条模型的 AIC 统计量值为 292.83，该值大于示例 6.1 中拟合的具有四个内部结的分段指数模型的相应值。因此，基于样条的风险函数不能改进拟合。","code":""},{"path":"chap6.html","id":"sec6-4","chapter":"第 6 章 灵活的参数模型","heading":"6.4 对数累积风险函数的灵活模型","text":"当使用样条模型对风险函数进行建模时，在最短和最长事件时间附近总是存在异常表现的风险。为对数累积风险或生存函数开发的模型不太容易受到这种影响。对数累积风险函数的灵活模型通常基于 6.2.2 节中描述的限制性立方样条，并且在没有内部结的特定情况下模型简化为 Weibull 模型。为了看出这一点，第 \\(\\) 个个体在时间 \\(t\\) 的 Weibull 风险函数为\\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\end{aligned}\\]其中 \\(\\boldsymbol x_i\\) 是 \\(p\\) 个解释变量的值向量，系数为 \\(\\boldsymbol \\beta\\)，基线风险函数为 \\(h_0(t)=\\lambda\\gamma t^{\\gamma-1}\\)。参数 \\(\\lambda\\) 和 \\(\\gamma\\) 确定了基线 Weibull 分布的尺度和形状。对应的累积风险函数为\\[H_i(t)=\\int_0^th_i(u)\\mathrm{d}u=\\exp(\\eta_i)\\lambda t^\\gamma \\]其中 \\(\\eta_i=\\boldsymbol\\beta'\\boldsymbol x_i\\)，对数累积风险函数为\\[\\log H_i(t)=\\eta_i+\\log\\lambda+\\gamma\\log t\\]设 \\(\\gamma_{0}=\\operatorname{log}\\lambda,\\gamma_{1}=\\gamma\\) 以及 \\(y=\\log t\\)，Weibull 模型的对数累积风险函数可以写成\\[\\log H_i(t)=\\eta_i+\\gamma_0+\\gamma_1y\\]该式表明，对数累积风险函数关于 \\(y = \\log t\\) 呈线性。根据式 (6.7)，具有 \\(m\\) 个内部结的对数基线累积风险的限制性立方样条模型可用 \\(y = \\log t\\) 表示为\\[\\begin{align}\n\\operatorname{log}H_{0}(t)=\\gamma_{0}+\\gamma_{1}y+\\sum_{j=1}^{m}\\gamma_{j+1}\\nu_{j}(y)\n\\tag{6.11}\n\\end{align}\\]在此式中，对于 \\(k_j\\) 处的第 \\(j(j = 1, 2,...,m)\\) 个内部结，\\[\\begin{align}\n\\nu_j(y)=(y-k_j)_+^3-\\lambda_j(y-k_{\\min})_+^3-(1-\\lambda_j)(y-k_{\\max})_+^3\n\\tag{6.12}\n\\end{align}\\]\\(k_\\min,k_\\max\\) 为边界结，\\((y-)_+^3=\\max\\{0,(y-)^3\\}\\) 以及\\[\\lambda_j=\\frac{k_{\\max}-k_j}{k_{\\max}-k_{\\min}}\\]第 \\(j\\) 个基函数 \\(\\nu_j (y)\\) 可以详细表示为\\[\\left.\\nu_j(y)=\\begin{cases}0&y<k_{\\min},\\\\-\\lambda_j(y-k_{\\min})^3&k_{\\min}\\leqslant y\\leqslant k_j,\\\\(y-k_j)^3-\\lambda_j(y-k_{\\min})^3&k_j\\leqslant y\\leqslant k_{\\max},\\\\(y-k_j)^3-\\lambda_j(y-k_{\\min})^3-(1-\\lambda_j)(y-k_{\\max})^3&y>k_{\\max}\\end{cases}\\right.\\]当 \\(y>k_\\max\\) 时，\\(\\nu_j (y)\\) 的表达式简化为\\[(k_\\mathrm{max}-k_j)(k_\\mathrm{min}-k_j)(3y-k_\\mathrm{min}-k_j-k_\\mathrm{max})\\]这证实了当 \\(y>k_\\max\\) 时基函数是 \\(y\\) 的线性函数，对于在 \\(k_\\min\\) 和 \\(k_\\max\\) 之间的 \\(y\\) 值的基函数是 \\(y\\) 的三次函数。比例风险模型中第 \\(\\) 个个体的累积风险函数为\\[\\begin{aligned}H_i(t)=\\int_0^t\\exp(\\eta_i)h_0(u)\\mathrm{d}u=\\exp(\\eta_i)H_0(t)\\end{aligned}\\]因此 \\(\\log H_i(t)\\) 的限制性立方样条模型由下式给出\\[\\begin{align}\n\\log H_i(t)=\\eta_i+\\gamma_0+\\gamma_1y+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(y)\n\\tag{6.13}\n\\end{align}\\]其中，当为观测数据拟合模型时，\\(\\gamma\\) 参数与 \\(\\beta\\) 参数一起估计。式 (6.13) 定义的模型首先由 Royston Parmar (2002) 提出，通常称为 Royston Parmar 模型。对数累积风险函数的这种扩展参数形式意味着该模型下的生存时间不再具有 Weibull 分布，也不再具有任何其他可识别的分布，尽管该模型仍然假设解释变量之间存在比例风险。式 (6.13) 中的模型也可以用生存函数 \\(S_i(t)\\) 来表示，使用 \\(S_i(t)=\\exp\\{-H_i(t)\\}\\) 这一结果给出\\[\\begin{align}\nS_i(t)=\\exp\\{-\\exp[\\eta_i+\\gamma_0+\\gamma_1y+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(y)]\\}\n\\tag{6.14}\n\\end{align}\\]等价地\\[S_i(t)=\\{S_0(t)\\}^{\\exp(\\eta_i)}\\]其中 \\(S_0(t)=\\exp\\{-H_0(t)\\}\\) 为基线生存函数，\\(H_0(t)\\) 根据式 (6.11) 得出。在对数累积风险尺度上使用样条的一个优势在于，可以很容易地获得相应的生存函数。风险函数的模型 \\(h_i(t)=\\exp(\\eta_i)h_0(t)\\) 也可以根据基线风险函数 \\(h_0(t)\\) 的相应参数模型得到。对 \\(\\log H_0(t)\\)关于 \\(t\\) 求导，给出\\[\\frac{\\operatorname{d}\\log H_0(t)}{\\operatorname{d}t}=\\frac1{H_0(t)}\\frac{\\operatorname{d}H_0(t)}{\\operatorname{d}t}=\\frac1{H_0(t)}h_0(t)\\]因此基线风险函数为\\[h_0(t)=H_0(t)\\frac{\\operatorname{d}\\log H_0(t)}{\\operatorname{d}t}\\]式 (6.11) 中的 \\(\\log H_0(t)\\) 关于 \\(t\\) 的导数为\\[\\frac{\\operatorname{d}\\log H_0(t)}{\\operatorname{d}t}=\\frac{\\operatorname{d}\\log H_0(t)}{\\operatorname{d}y}\\frac{\\operatorname{d}y}{\\operatorname{d}t}=\\{\\gamma_1+\\gamma_2\\nu_1^{\\prime}(y)+\\cdots+\\gamma_{m+1}\\nu_m^{\\prime}(y)\\}t^{-1}\\]其中\\[\\nu_j^{\\prime}(y)=\\begin{cases}0&y\\leqslant k_{\\min},\\\\-3\\lambda_j(y-k_{\\min})^2&k_{\\min}\\leqslant y\\leqslant k_j,\\\\3(y-k_j)^2-3\\lambda_j(y-k_{\\min})^2&k_j\\leqslant y\\leqslant k_{\\max},\\\\3(y-k_j)^2-3\\lambda_j(y-k_{\\min})^2-3(1-\\lambda_j)(y-k_{\\max})^2&y\\geqslant k_{\\max}\\end{cases}\\]是 \\(\\nu_j(y)\\) 关于 \\(y=\\log t,j=1,2,\\ldots,m\\) 的一阶导数。因此，\\[\\begin{align}\nh_i(t)=e^{\\eta_i}h_0(t)=e^{\\eta_i}\\left\\{\\gamma_1+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j^{\\prime}(y)\\right\\}t^{-1}H_0(t)\n\\tag{6.15}\n\\end{align}\\]其中 \\(H_0(t)\\) 为全参数比例风险模型，由式 (6.11) 给出，其中基线风险是 \\(t=e^y\\) 的光滑函数，具有 \\(m+2\\) 个未知参数 \\(\\gamma_0,\\gamma_1,\\ldots,\\gamma_{m+1}\\)。式 (6.13) 中的对数累积风险函数模型可用最大似然法进行拟合。似然函数是式 (6.2) 中的函数，并且在式 (6.14) 和 (6.15) 中给出了第 \\(\\) 个个体在时间 \\(t_i\\) 处的生存函数和风险函数 \\(S_i(t_i),h_i(t_i)\\)。该似然函数的对数可以使用标准优化程序来最大化，这得到了拟合的生存和风险函数，它们是生存时间 \\(t\\) 的平滑函数。拟合过程还得到参数估计及其标准误，还有它们的函数，例如在任何给定时间的风险和生存函数的估计。使用这些参数模型的经验表明，结数几乎不受协变量调整的影响。这意味着变量选择过程可以基于标准 Weibull 或 Cox 模型。一旦确定了 Royston Parmar 模型中包含的解释变量，就可以拟合包含这些变量的限制性三次样条模型。同样，随着内部结数不断增加，首选模型是具有最小 AIC 或 BIC 统计量值的模型。示例 6.5  (乳腺癌患者的无复发生存) German Breast Cancer Study Group 在大量医院进行了一项针对乳腺癌的队列研究，目的是比较三个周期与六个周期的化疗效果，并调查额外激素治疗（每日服用 30mg 他莫昔芬 (tamoxifen) ，持续两年）的影响。研究中的患者均为经组织学证实为非转移性、淋巴结阳性的原发性乳腺癌患者，且已接受乳房切除术治疗。感兴趣的响应变量是无复发生存期 (recurrence-free survival)，即从研究入组到癌症复发或死亡的时间。早期的数据分析表明，无复发生存期不受化疗周期数的影响，因此本例中仅包含与患者是否接受他莫昔芬相关的因素。除了这一治疗因素外，还提供了患者年龄、绝经状态、肿瘤大小和分级、阳性淋巴结数、孕酮和雌激素受体状态的数据。Schumacher et al. (1994) 给出了这项研究的背景信息。本例中的数据涉及来自 41 个中心和 686 名患者的完整数据，并包含在 Sauerbrei Royston (1999) 中。该数据集中的变量如下：\\(Id\\)：患者编号\\(Treat\\)：激素治疗（0 = 无他莫昔芬，1 = 他莫昔芬）\\(Age\\)：患者年龄\\(Men\\)：绝经状态（1 = 绝经前，2 = 绝经后）\\(Size\\)：肿瘤大小（mm）\\(Grade\\)：肿瘤分级（1, 2, 3）\\(Nodes\\)：阳性淋巴结数\\(Prog\\)：孕酮受体状态（毫飞摩尔，femtomole = 10-15 mol）\\(Oest\\)：雌激素受体状态（毫飞摩尔，femtomole = 10-15 mol）\\(Time\\)：无复发生存时间（天）\\(Status\\)：事件指示符（0 = 删失，1 = 复发或死亡）这项研究共 686 名患者，其中 20 名患者的数据显示在表 6.1 中。在分析这些数据时，我们可能感兴趣的是在调整其他解释变量后的治疗效应，并估计两个治疗组调整的风险函数。\n作为分析这些数据的第一步，使用按治疗组分层的对数累积风险图来研究 Weibull 模型的适用性。虽然其他解释变量的存在阻碍了对只有一个因素的此类曲线图的解释，但两个处理组的对数累计风险图（图 6.5）并没有显示两条直线。因此，生存时间服从 Weibull 分布的假设是不合适的。然而，图中两条曲线的垂直间隔似乎是恒定的，这表明关于治疗效应的比例风险假设是有效的。\n在这一阶段，可以使用变量选择过程来确定除了治疗因素（Treat）外，还需要哪些其他解释因素（如 Age, Men, Size, Grade, Nodes, Prog 和 Oest）纳入模型，但在这个例子中，我们将把它们全部包括在内。然后拟合具有不断增加的内部结的 Royston Parmar 模型。表 6.2 给出了拟合模型的 AIC 统计量，其中零结点的模型为标准 Weibull 模型。在拟合具有一个内部结的限制性立方样条时，AIC 统计量的值大幅减小，这表明该模型相对于标准 Weibull 模型有了实质性的改进。在添加第二个和第三个结时，AIC 统计量进一步减小，但减小的幅度远小于添加第一个结时。在添加第四个内部结时，AIC 统计量增加。这一分析表明，最好的拟合模型有三个结，尽管这与只有一个结的模型相比并没有明显的改善。该模型最简单的表示方式是以第 \\(\\) 个患者的对数累积风险函数估计来表示，由下式给出\\[\\begin{aligned}\\log\\hat{H}_i(t)=&\\,\\hat{\\beta}_1Treat_i+\\hat{\\beta}_2Age_i+\\hat{\\beta}_3Men_i+\\hat{\\beta}_4Size_i+\\hat{\\beta}_5Grade_i\\\\&+\\hat{\\beta}_6Nodes_i+\\hat{\\beta}_7Prog_i+\\hat{\\beta}_8Oest_i+\\log\\hat{H}_0(t)\\end{aligned}\\]其中\\[\\log\\hat{H}_0(t)=\\hat{\\gamma}_0+\\hat{\\gamma}_1y+\\hat{\\gamma}_2\\nu_1(y)+\\hat{\\gamma}_3\\nu_2(y)+\\hat{\\gamma}_4\\nu_3(y)\\]是具有三个内部结的模型的基线累积风险函数，\\(y=\\log t\\) 以及函数 \\(\\nu_1(y),\\nu_2(y),\\nu_3(y)\\) 在式 (6.12) 中定义。\nRoyston Parmar 模型拟合的直观总结如图 6.6 所示。该图展示了在拟合包含 8 个解释变量的 Cox 回归模型时调整的基线生存函数，显示为阶跃函数。此外，还展示了 Weibull 模型调整的基线生存函数，以及具有一个和三个内部结的模型的调整的基线生存函数。该图证实了 Cox 模型中的风险调整的基线生存函数无法很好地用 Weibull 模型来拟合。具有一个结的 Royston Parmar 模型更紧密地追踪了 Cox 基线生存函数估计，而具有三个结的模型在远期生存时间提供了更好的性能。\n具有三个结的 Royston Parmar 模型的参数估计及其标准误如表 6.3 所示。该表还显示了拟合的 Cox 模型中的 \\(\\beta\\) 参数估计及其标准误。两个模型的估计及其标准误差非常相似。在两种模型下，服用他莫昔芬的患者与未服用他莫昔芬的患者相比，调整的风险比均为 0.71，因此服用他莫昔芬的患者癌症复发或死亡的风险较低。\nRoyston Parmar 模型的优点是提供基线风险的参数估计。对于 Weibull 模型以及具有一个和三个结的 Royston Parmar 样条模型，针对八个解释变量进行调整后的拟合基线风险函数如图 6.7 所示。 Royston Parmar 模型表明潜在的风险函数是单峰的，因此 Weibull 模型拟合不佳也就不足为奇了。","code":""},{"path":"chap6.html","id":"sec6-5","chapter":"第 6 章 灵活的参数模型","heading":"6.5 灵活的比例几率模型","text":"基于三次样条的参数模型也可以与第 5 章 5.15 节中描述的比例几率模型结合使用。关于生存超过时间 \\(t\\) 的几率的一般比例几率模型 (general proportional odds model) \\(S_i(t)/\\{1-S_i(t)\\}\\) 满足\\[\\frac{S_i(t)}{1-S_i(t)}=\\exp\\{\\boldsymbol{\\beta}'\\boldsymbol{x}_i\\}\\frac{S_0(t)}{1-S_0(t)}\\]其中 \\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体的解释变量的值向量，\\(S_0(t)\\) 是基线生存函数，即解释变量全部取零值的个体的生存函数。如果假设生存时间采用参数为 \\(\\theta,\\kappa\\) 的 log-logistic 模型（如 5.15.1 节所示），则根据生存超过时间 \\(t\\) 的对数几率为，根据式 (5.9)，\\(S(t)=\\left\\{1+e^\\theta t^\\kappa\\right\\}^{-1}\\)。令 \\(S_0(t)\\) 为基线生存函数，其满足\\[\\log\\left(\\frac{S_0(t)}{1-S_0(t)}\\right)=-\\theta-\\kappa\\log t=\\gamma_0+\\gamma_1y\\]其中 \\(\\gamma_0=-\\theta,\\gamma_1=-\\kappa\\)，模型关于 \\(y = \\log t\\) 呈线性。通过纳入非线性项来扩展该模型，以给出具有 \\(m\\) 个内部结的限制性立方样条，并使用与式 (6.13) 中相同的符号，我们得到\\[\\log\\left(\\frac{S_0(t)}{1-S_0(t)}\\right)=\\gamma_0+\\gamma_1y+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(y)\\]这类似于式 (6.11) 中对数累积基线风险函数的表达式。包含样条项的比例几率模型可以表示为\\[\\begin{aligned}\\log\\left(\\frac{S_i(t)}{1-S_i(t)}\\right)&=\\eta_i+\\gamma_0+\\gamma_1y+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(y)\\end{aligned}\\]其中 \\(\\eta_i=\\boldsymbol{\\beta}'\\boldsymbol{x}_i\\)。这种灵活的比例几率模型的使用方式与灵活的比例风险模型相同，特别适合风险函数为单峰的情况。该模型还可以用时间 \\(t\\) 之前发生事件的几率 \\(\\log[F(t)/\\{1-F(t)\\}]\\) 来表示，其实这就是 \\(-\\log[S(t)/\\{1-S(t)\\}]\\)，得到的参数估计仅在符号上有所不同。该模型使用最大似然法进行拟合，并得出生存函数的估计。然后可以直接获得相应风险和累积风险函数的估计。示例 6.6  (乳腺癌患者的无复发生存) 示例 6.5 中确定的单峰风险函数表明，log-logistic 模型可能更适于拟合乳腺癌女性的无复发生存时间。表 6.4 给出了生存超过时间 \\(t\\) 的对数几率模型的 AIC 统计量值，该模型具有灵活的基线生存函数，其中零结模型是标准的比例几率模型。如示例 6.5 所示，除了治疗因素 Treat 之外，模型中还包括解释变量 Age, Men, Size, Grade, Nodes, Prog 和 Oest. 请注意，对于具有 1, 2 和 3 个结的模型，AIC 统计量的值表现有些不稳定，添加第四个结时统计量的值会略有增加。当所拟合的模型几乎无法区分时，就会出现如此现象，并且由于这些模型结数增加但位置不同，因此并非所有模型都是嵌套的。在这种情况下，包含三个结的生存超过时间 \\(t\\) 的对数几率模型提供了最好的拟合，尽管该模型的拟合非常类似于只有一个结的模型。此外，由于表 6.4 中的 AIC 统计量小于表 6.2 中相应比例风险模型的 AIC 统计量，因此选择比例几率模型。\n对于三结点模型，与处理效应相关的参数估计为 0.5287. 服用他莫昔芬的患者生存超过时间 \\(t\\) 的几率与未服用他莫昔芬的患者的几率之比为 \\(\\exp(0.5287)=1.7\\)，因此服用他莫昔芬的患者生存超过任何给定时间的几率是未接受该治疗的患者的 1.7%. 这一结果与示例 6.5 中给出的治疗效应的相应风险比完全一致。","code":""},{"path":"chap6.html","id":"sec6-6","chapter":"第 6 章 灵活的参数模型","heading":"6.6 延伸阅读","text":"分段指数模型由 Breslow (1974) 提出，并指出它等价于每次死亡时间之间风险恒定的 Cox 回归模型。Friedman (1982) 更详细地描述了该模型，而 Lawless (2002) 提供了数学处理较少的描述。用于拟合分段指数模型的有效数值优化方法包括 Dempster, Laird 和 Rubin (1977) 描述的期望最大化 (expectation-maximisation, EM) 算法、Groeneboom Wellner (1992) 描述的 Iterative Convex Minorant (ICM) 算法以及由 Wellner Zahn (1997) 描述的 EM 和 ICM 算法的结合。de Boor (2001) 详细介绍了样条函数，而 Racine (2021) 和 Perperoglou et al. (2019) 提供了回归模型中样条函数的易于理解的概述。Durrleman Simon (1989) 以及 Sleeper Harrington (1989) 描述了三次样条在回归模型中的使用。Eilers Marx (1996) 包含了 B 样条的概述，Rosenberg (1995) 描述了基线风险函数的加性 B 样条模型。Royston Parmar (2002) 描述了基于限制性立方样条的比例风险和比例几率模型的灵活参数模型。 Royston Lambert (2011) 对该模型及其在 Stata 中的实现进行了全面介绍。","code":""},{"path":"chap7.html","id":"chap7","chapter":"第 7 章 参数模型的模型检查","heading":"第 7 章 参数模型的模型检查","text":"评估模型充分性的诊断程序对于参数模型与 Cox 回归模型一样重要。基于残差的程序尤为重要，因此，本章首先定义了参数模型的残差，其中一些残差来源于第 4 章描述的 Cox 回归模型。接着，对假设为 Weibull 分布，log-logistic 分布和 lognormal 分布的模型对数据的适用性，提供了图形程序的总结。随后，考虑其他检验参数回归模型拟合度的方法，以及检测有影响的观测的方法。最后总结了如何在拟合 Weibull 比例风险模型后检验比例风险假设。","code":""},{"path":"chap7.html","id":"sec7-1","chapter":"第 7 章 参数模型的模型检查","heading":"7.1 参数模型的残差","text":"假设 \\(T_i\\) 是与第 \\(\\) 个个体生存时间相关的随机变量，\\(=1,2,\\ldots,n\\)，并且 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\) 是该个体的 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 的值。为 \\(T_i\\) 假定加速失效时间模型，我们有\\[\\begin{aligned}\\log T_i=\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i\\end{aligned}\\]其中 \\(\\epsilon_i\\) 是一个随机变量，其概率分布取决于 \\(T_i\\) 采用的分布，并且 \\(\\mu,\\sigma\\) 和 \\(\\alpha_j,j=1,2,\\ldots,p\\) 是未知参数。如果第 \\(\\) 个个体的观测生存时间删失，相应的残差也将删失，使这些量的解释变得复杂。","code":""},{"path":"chap7.html","id":"sec7-1-1","chapter":"第 7 章 参数模型的模型检查","heading":"7.1.1 标准化残差","text":"加速失效时间建模中采用的残差的自然形式是标准化残差 (standardized residual)，定义为\\[\\begin{align}\nr_{Si}=\\left\\{\\log t_{}-\\hat{\\mu}-\\hat{\\alpha}_{1}x_{1i}-\\hat{\\alpha}_{2}x_{2i}-\\cdots-\\hat{\\alpha}_{p}x_{pi}\\right\\}/\\hat{\\sigma}\n\\tag{7.1}\n\\end{align}\\]其中 \\(t_i\\) 是第 \\(\\) 个个体的观测生存时间， \\(\\hat{\\mu},\\hat{\\sigma},\\hat{\\alpha}_j\\) 是拟合的加速失效时间模型的参数估计，\\(j=1,2,\\ldots,p\\)。这个残差具有“观测值-拟合值”的形式，如果模型是正确的，则预期它具有与加速失效时间模型中的 \\(\\epsilon_i\\) 相同的分布。例如，如果 \\(T_i\\) 采用 Weibull 分布，如果拟合模型是正确的，则预期 \\(r_{Si}\\) 的表现就好像它们是来自 Gumbel 分布的删失样本。残差的生存函数估计将类似于 \\(\\epsilon_i\\) 的生存函数，即 \\(S_{\\epsilon_i}(\\epsilon)\\)。使用第 4 章 4.1.1 节中的一般结果，\\(− \\log S_{\\epsilon_i}(\\epsilon)\\) 具有单位指数分布，因此如果拟合模型是合适的，则 \\(− \\log S_{\\epsilon_i}(\\epsilon)\\) 将具有近似单位指数分布。这为可用于评估模型充分性的诊断图提供了基础，如第 7.2.4 节所述。","code":""},{"path":"chap7.html","id":"sec7-1-2","chapter":"第 7 章 参数模型的模型检查","heading":"7.1.2 Cox-Snell 残差","text":"第 4 章 4.1.1 节中为 Cox 回归模型定义的 Cox-Snell 残差本质上是第 \\(\\) 个观测在相应事件时间 \\(t_i\\) 时的累积风险函数的估计。类似形式的残差也可用于评估参数模型的充分性。主要区别在于，现在生存函数和风险函数是参数函数，取决于生存时间采用的分布。参数模型的 Cox-Snell 残差定义为\\[\\begin{align}\nr_{C{}}=\\hat{H}_{{}}(t_{{}})=-\\log\\hat{S}_{{}}(t_{{}})\n\\tag{7.2}\n\\end{align}\\]其中 \\(\\hat H_i(t_i),\\hat Si (t_i)\\) 分别为 \\(t_i\\) 处的累积风险函数和生存函数估计。使用第 5 章的式 (5.65) 拟合加速失效时间模型，第 \\(\\) 个个体的生存函数估计为\\[\\begin{align}\n\\hat{S}_i(t)&=S_{\\epsilon_i}\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}_1x_{1i}-\\hat{\\alpha}_2x_{2i}-\\cdots-\\hat{\\alpha}_px_{pi}}{\\hat{\\sigma}}\\right)\n\\tag{7.3}\n\\end{align}\\]其中 \\(S_{\\epsilon_i}(\\epsilon)\\) 是加速失效时间模型中 \\(\\epsilon_i\\) 的生存函数，\\(\\hat \\alpha_j\\) 是 \\(x_{ji}\\) 的系数估计，\\(j = 1, 2,...,p\\)，\\(\\hat{\\mu},\\hat{\\sigma}\\) 是 \\({\\mu},{\\sigma}\\) 的估计。第 5 章 5.12 节描述了一些常用的 \\(T_i\\) 分布的 \\(S_{\\epsilon_i}(\\epsilon)\\) 形式。与 Cox 回归模型的情况一样，当拟合了正确的模型时，Cox-Snell 残差可视为具有单位指数分布，且删失观测得到删失残差；详细信息请参见 4.1.1 节。式 (7.2) 中的 Cox-Snell 残差也与式 (7.1) 中的标准化残差非常密切相关，因为从式 (7.3) 中，我们可看出 \\(r_{Ci}=-\\log S_{\\epsilon_{}}\\left(r_{Si}\\right)\\)。因此，评估标准化残差是否具有特定分布相当于评估相应的 Cox-Snell 残差是否具有单位指数分布。","code":""},{"path":"chap7.html","id":"sec7-1-3","chapter":"第 7 章 参数模型的模型检查","heading":"7.1.3 鞅残差","text":"鞅残差度量了在区间 \\((0, t_i)\\) 内的实际观测死亡数（0 或 1）与模型预测值之间的差异。对具有异常大的鞅残差的观测，模型拟合效果不佳。类似于第 4 章式 (4.6) 中为 Cox 回归模型定义的鞅残差 (martingale residuals)\\[\\begin{align}\nr_{Mi}=\\delta_i-r_{Ci}\n\\tag{7.4}\n\\end{align}\\]其中，\\(\\delta_i\\) 是第 \\(\\) 个观测的事件指示符，若该观测是事件则 \\(\\delta_i=1\\)，若为删失则为 \\(\\delta_i=0\\)；\\(r_{Ci}\\) 是式 (7.2) 中给出的 Cox-Snell 残差。由于 7.2.1 节给出的原因，参数加速失效时间模型的鞅残差之和为零，但并非关于零对称分布。严格来说，将这些残差称为鞅残差是不合适的，因为它们的推导是基于鞅方法的，不能延伸到加速失效时间模型。然而，为了语义上的方便，我们将仍将式 (7.4) 中的量称为鞅残差。","code":""},{"path":"chap7.html","id":"sec7-1-4","chapter":"第 7 章 参数模型的模型检查","heading":"7.1.4 偏差残差","text":"偏差残差 (deviance residuals) 在第 4 章式 (4.7) 中首次提出，可看作是使鞅残差在零附近对称分布的一种尝试，定义为\\[\\begin{align}\nr_{Di}=\\operatorname{sgn}(r_{Mi})\\left[-2\\left\\{r_{Mi}+\\delta_i\\log(\\delta_i-r_{Mi})\\right\\}\\right]^{\\frac{1}{2}}\n\\tag{7.5}\n\\end{align}\\]由此定义得到的残差偏差通常与可比的 Cox 回归模型的残差相似。然而，式 (7.5) 中的 \\(r_{Di}\\) 值通常与式 (7.1) 中的标准化残差 \\(r_{Si}\\) 具有相反的符号。这是因为参数加速失效时间模型基于生存时间的对数，而不是风险函数。因此，将加速失效时间模型的偏差残差定义为值 \\(-r_{Di}\\) 更为合适，该在一些生存分析软件包中使用。还需要注意的是，式 (7.5) 中的偏差残差不是拟合的参数模型偏差的组成部分，但为方便起见，仍将其称为偏差残差。","code":""},{"path":"chap7.html","id":"sec7-1-5","chapter":"第 7 章 参数模型的模型检查","heading":"7.1.5 得分残差","text":"与 Cox 回归模型中的得分残差或 Schoenfeld 残差类似，得分残差 (score residuals) 可以针对任何参数模型进行定义。得分残差是对数似然函数关于未知参数 \\(\\mu,\\sigma\\) 和 \\(\\alpha_j(j=1,2,\\ldots,p)\\) 的导数的组成部分，并在这些参数的最大似然估计值 \\(\\hat{\\mu},\\hat{\\sigma}\\) 和 \\(\\hat \\alpha_j\\) 处进行求值。根据第 5 章的式 (5.74) ，\\(n\\) 个观测的对数似然函数为\\[\\begin{aligned}\\log L(\\boldsymbol{\\alpha},\\mu,\\sigma)&=\\sum_{=1}^n\\left\\{-\\delta_i\\log(\\sigma t_i)+\\delta_i\\log f_{\\epsilon_i}(z_i)+(1-\\delta_i)\\log S_{\\epsilon_i}(z_i)\\right\\}\\end{aligned}\\]其中 \\(z_i=(\\log t_i-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi})/\\sigma,f_{\\epsilon_i}(\\epsilon)\\) 和 \\(S_{\\epsilon_i}(\\epsilon)\\) 分别为 \\(\\epsilon_i\\) 的密度和生存函数，\\(\\delta_i\\) 为事件指示符。对该对数似然函数关于参数 \\(\\mu,\\sigma\\) 和 \\(\\alpha_j(j=1,2,\\ldots,p)\\) 进行微分，得到导数\\[\\begin{aligned}\n&\\begin{aligned}\\frac{\\partial\\log L}{\\partial\\mu}\\end{aligned} \\begin{aligned}=\\sigma^{-1}\\sum_{=1}^ng(z_i),\\end{aligned}  \\\\\n&\\begin{aligned}\\frac{\\partial\\log L}{\\partial\\sigma}\\end{aligned} =\\left.\\sigma^{-1}\\sum_{=1}^n\\left\\{z_ig(z_i)-\\delta_i\\right\\},\\right.  \\\\\n&\\begin{aligned}\\frac{\\partial\\log L}{\\partial\\alpha_j}\\end{aligned} =\\sigma^{-1}\\sum_{=1}^nx_{ji}g(z_i)\n\\end{aligned}\\]其中函数 \\(g(z_i)\\) 为\\[\\begin{align}\ng(z_i)=\\frac{(1-\\delta_i)f_{\\epsilon_i}(z_i)}{S_{\\epsilon_i}\\left(z_i\\right)}-\\frac{\\delta_if_{\\epsilon_i}^{\\prime}\\left(z_i\\right)}{f_{\\epsilon_i}\\left(z_i\\right)}\n\\tag{7.6}\n\\end{align}\\]其中 \\(f'_{{}}(z_{{}})\\) 为 \\(f_{{}}\\left(z_{{}}\\right)\\) 关于 \\(z_i\\) 的导数。那么，每个导数在未知参数最大似然估计处的值，其第 \\(\\) 个分量就是相应项的残差得分。因此，根据式 (7.1) 中的标准化残差的定义，\\(\\mu\\) 的第 \\(\\) 个得分残差为\\[\\hat{\\sigma}^{-1}g(r_{S{}})\\]尺度参数 \\(\\sigma\\) 的第 \\(\\) 个得分残差为\\[\\hat{\\sigma}^{-1}\\left\\{r_{Si}\\left.g(r_{Si})-\\delta_i\\right\\}\\right.\\]模型中的第 \\(j\\) 个解释变量 \\(X_j\\) 的第 \\(\\) 个得分残差为\\[r_{U{j}}=\\hat{\\sigma}^{{-}1}x_{{j}{}}g(r_{S{}})\\]其中，\\(X_j\\) 的得分残差是最重要的，在 4.1.6 节中表示为 \\(r_{U{j}}\\)。这些残差的特定表达式将在后续部分针对一些特定的参数模型给出。由于得分残差的和是对数似然函数在其最大值处的导数，因此这些残差之和必为零。","code":""},{"path":"chap7.html","id":"sec7-2","chapter":"第 7 章 参数模型的模型检查","heading":"7.2 特定参数模型的残差","text":"在本节中，描述了基于 Weibull, log-logistic 和 log-normal 分布的生存时间参数模型的残差形式。","code":""},{"path":"chap7.html","id":"sec7-2-1","chapter":"第 7 章 参数模型的模型检查","heading":"7.2.1 Weibull 分布","text":"7.1 节中描述的残差可以与 Weibull 模型的比例风险或加速失效时间的表示法结合使用。我们从第 5 章中描述的比例风险模型开始，根据该模型，第 \\(\\) 个个体在时间 \\(t\\) 时的死亡风险为\\[\\begin{aligned}h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})h_0(t)\\end{aligned}\\]其中 \\(h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\) 为基线风险函数。累积风险函数的相应估计为\\[\\begin{aligned}\\hat{H}_i(t)&=\\exp(\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi})\\hat{\\lambda}t\\hat{\\gamma}\\end{aligned}\\]它们是如式 (7.2) 定义的 Cox-Snell 残差。在模型的加速失效时间版本中，\\(\\epsilon_i\\) 具有 Gumbel 分布，其生存函数为\\[\\begin{align}\nS_{\\epsilon_{}}(\\epsilon)=\\operatorname{exp}(-e^{\\epsilon})\n\\tag{7.7}\n\\end{align}\\]标准化残差如式 (7.1) 所示，如果拟合了适当的模型，则预期这些残差将表现为来自 Gumbel 分布的可能删失样本。这相当于评估 Cox-Snell 残差（定义如下）是否具有单位指数分布。根据式 (7.7)，Cox-Snell 残差 \\(r_{Ci}=-\\log S_{\\epsilon_{}}\\left(r_{Si}\\right)\\) 是标准化残差的指数，即 \\(r_{Ci}=\\exp(r_{Si})\\)。使用式 (7.4) 和 (7.5)，这些残差将立即得到 Weibull 模型的鞅残差和偏差残差。Weibull 模型的得分残差可从 7.1.5 节的一般结果中得出。这里，根据式 (7.7) 中的 \\(S_{\\epsilon_i}(z_i)=\\exp(-e^{{z_i}})\\)，对 \\(S_{\\epsilon_i}(z_i)\\) 求导并乘以 -1 得到 \\(f_{\\epsilon_i}(z_i)=e^{z_i}\\exp(-e^{z_i})\\)。此外有 \\(f'_{\\epsilon_i}(z_i)=(1-e^{z_i})f_{\\epsilon_i}(z_i)\\)，将其代入式 (7.6) 后，经过一些代数计算后可得到 \\(g(z_i)=e^{z_i}-\\delta_i\\)。模型中第 \\(j\\) 个解释变量 \\(X_j\\) 的第 \\(\\) 个得分残差为\\[\\begin{aligned}r_{Uji}=\\hat{\\sigma}^{-1}x_{ji}\\left(e^{r_{Si}}-\\delta_{}\\right)\\end{aligned}\\]其中 \\(r_{Si}\\) 是第 \\(\\) 个标准化残差，\\(\\delta_i\\) 是事件指示符。我们还注意到，\\(\\mu\\) 的第 \\(\\) 个得分残差是 \\(\\hat{\\sigma}^{-1}(e^{r_{S}}-\\delta_{})\\)，即 \\(\\hat{\\sigma}^{-1}(r_{Ci}-\\delta_{})\\)。由于这些得分残差之和为零，因此式 (7.4) 中定义的鞅残差之和在 Weibull 模型中必为零。","code":""},{"path":"chap7.html","id":"sec7-2-2","chapter":"第 7 章 参数模型的模型检查","heading":"7.2.2 log-logistic 分布","text":"在 log-logistic 加速失效时间模型中，随机变量 \\(\\epsilon_i\\) 具有 logistic 分布，其生存函数为\\[\\begin{aligned}S_{\\epsilon_i}(\\epsilon)=\\left(1+e^{\\epsilon}\\right)^{-1}\\end{aligned}\\]因此，如果拟合模型正确，根据式 (7.1) 获得的标准化残差应该表现为 logistic 分布的样本。等价地，log-logistic 加速失效时间模型的 Cox-Snell 残差由下式给出\\[\\begin{aligned}r_{Ci}=-\\log S_{\\epsilon_i}(r_{Si})\\end{aligned}\\]即\\[\\begin{aligned}r_{Ci}=\\log\\left\\{1+\\exp\\left(r_{Si}\\right)\\right\\}\\end{aligned}\\]其中 \\(r_{Si}\\) 是第 \\(\\) 个标准化残差。得分残差根据 7.1.5 节一般结果得出，使用式 (7.6) 我们发现模型中第 \\(j\\) 个解释变量的第 \\(\\) 个得分残差为\\[r_{Uji}=\\hat{\\sigma}^{-1}x_{ji}\\left\\{\\frac{\\exp(r_{Si})-\\delta_i}{1+\\exp(r_{Si})}\\right\\}\\]","code":""},{"path":"chap7.html","id":"log-normal-分布","chapter":"第 7 章 参数模型的模型检查","heading":"7.2.3 log-normal 分布","text":"若假定生存时间呈 log-normal 分布，则加速失效时间模型的对数线性公式中的 \\(\\epsilon_i\\) 呈正态分布。根据式 (5.73) ，第 \\(\\) 个个体的生存函数估计为\\[\\begin{aligned}\\hat{S}_i(t)&=1-\\Phi\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}_1x_{1i}-\\hat{\\alpha}_2x_{2i}-\\cdots-\\hat{\\alpha}_px_{pi}}{\\hat{\\sigma}}\\right)\\end{aligned}\\]因此 Cox-Snell 残差变为\\[\\begin{aligned}r_{Ci}=-\\log\\left\\{1-\\Phi\\left(r_{Si}\\right)\\right\\}\\end{aligned}\\]如往常一样，\\(r_{Si}\\) 是式 (7.1) 中的第 \\(\\) 个标准化残差。同样，鞅残差和偏差残差也是从这些标准化残差中得出的，而得分残差则是根据 7.1.5 节的结果中得出的。具体来说，\\(X_j\\) 的第 \\(\\) 个得分残差是\\[r_{Uji}=\\hat{\\sigma}^{-1}\\left\\{\\frac{(1-\\delta_i)f_{\\epsilon_i}(r_{Si})}{1-\\Phi(r_{Si})}+\\delta_ir_{Si}\\right\\}\\]其中 \\(f_{\\epsilon_i}(r_{Si})\\) 是 \\(r_{Si}\\) 处的标准正态密度函数，\\(\\Phi(r_{Si})\\) 是相应的分布函数。","code":""},{"path":"chap7.html","id":"sec7-2-4","chapter":"第 7 章 参数模型的模型检查","heading":"7.2.4 残差分析","text":"在为生存数据拟合参数模型后进行残差分析时，将 Cox-Snell 残差的分布与单位指数分布进行比较是最有用的方式之一。如 7.1.1 节所述，这相当于将标准化残差的分布与加速失效时间模型的对数线性形式中的随机变量 \\(\\epsilon_i\\) 的分布进行比较。这种比较是通过绘制残差的累积风险或对数累积风险图来完成的，如第 4 章 4.2.1 节所示，其中使用 Cox 回归模型的残差说明了该图形的用途。总之，获得了 Cox-Snell 残差的生存函数的 Kaplan-Meier 估计 \\(\\hat{S}(r_{Ci})\\)，并绘制 \\(-\\log\\hat S(r_{Ci})\\) 关于 \\(r_{Ci}\\) 的图形。若得到单位斜率和零截距的直线，则表明拟合的模型是合适的。或者，若拟合的生存模型令人满意，残差的对数累积风险图，即 \\(\\log\\{-\\log\\hat{S}(r_{Ci})\\}\\) 关于 \\(\\log r_{Ci}\\) 的图形，也将呈现一条具有单位斜率和零截距的直线。在 4.2.1 节对这种图表的使用提出了许多批评。然而，对于参数模型得出的残差，这些批评没有那么大的影响。其原因在于，Cox 回归模型中使用的基线累积风险函数的非参数估计现在被参数函数的估计所取代。该函数通常仅取决于两个参数 \\(\\mu,\\sigma\\)，因此当为生存数据拟合加速失效时间模型时，需估计的参数较少。因此，当拟合了正确的模型时，参数模型的 Cox-Snell 残差更有可能通过单位指数分布来近似。其他有用的残差图包括鞅残差或偏差残差的索引图，可用于识别模型未能很好拟合的观测。鞅残差或偏差残差与生存时间、生存时间秩次或解释变量的图形，可以显示模型在特定时间或解释变量的特定值上是否拟合不佳。鞅残差或偏差残差关于加速因子估计 \\(\\operatorname{exp}(-\\hat{\\boldsymbol{\\alpha}}^{\\prime}\\boldsymbol{x}_i)\\)、时间比估计 \\(\\operatorname{exp}(\\hat{\\boldsymbol{\\alpha}}^{\\prime}\\boldsymbol{x}_i)\\) 或加速失效时间模型的线性分量估计 \\(\\hat{\\boldsymbol{\\alpha}}^{\\prime}\\boldsymbol{x}_i\\) 的图形，也提供了关于残差与个体可能的生存时间之间关系的信息。那些加速因子估计较大的个体往往生存时间较短。得分残差的索引图，或得分残差关于生存时间、生存时间的秩次的图形，可在对模型充分性进行更全面的评估时进行检查。示例 7.1  (卵巢癌患者的化疗) 第 5 章的示例 5.11 提供了卵巢癌患者生存时间的数据。使用 Weibull 比例风险模型对数据进行分析，所选模型包含与女性年龄（Age）和女性所属治疗组（Treat）对应的变量。在模型的加速失效时间表示中，第 \\(\\) 个女性的生存函数估计为\\[\\begin{aligned}\\hat{S}_i(t)&=S_{\\epsilon_i}\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}_1Age_i-\\hat{\\alpha}_2Treat_i}{\\hat{\\sigma}}\\right)\\end{aligned}\\]其中 \\(S_{\\epsilon_i}(\\epsilon)=\\exp(-e^{\\epsilon})\\)，因此\\[\\begin{aligned}\\hat{S_i}(t)&=\\exp\\left\\{-\\exp\\left(\\frac{\\log t-10.4254+0.0790Age_i-0.5615Treat_i}{0.5489}\\right)\\right\\}\\end{aligned}\\]标准化残差值为\\[\\begin{aligned}r_{Si}&=(\\log t_i-10.4254+0.0790Age_i-0.5615Treat_i)/0.5489\\end{aligned}\\]其中 \\(=1,2,\\ldots,26\\)。这些值在表 7.1 中给出，还给出了 Cox-Snell 残差的值，对于 Weibull 模型，这些值为 \\(r_{Ci}=\\exp(r_{S{}})\\)。\n图 7.1 给出了 Cox-Snell 残差的累积风险图。在此图中，绘制的点位于截距和斜率分别接近于零和一的直线上。然而也有一些证据表明存在系统性偏离直线的情况，这让人对拟合模型的充分性产生了一些担忧。\n鞅残差和偏差残差 \\(r_{Mi}\\) 和 \\(r_{Di}\\) 关于生存时间秩次的图形分别如图 7.2 和 7.3 所示。两图表均显示出，具有较长生存时间的观测往往具有较小的残差，但这些观测也是删失观测。\n图 7.4 显示了模型中的变量 Age 和 Treat 的得分残差关于生存时间秩次的图形。Age 的得分残差图显示，存在三个具有相对较大残差的观测，它们对应于表 5.6 原始数据集中的患者 14, 4 和 26. 然而，这些观测似乎并没有什么异常之处。患者 26 的 Treat 得分残差也比其他患者稍大。这表明该模型未能很好地拟合患者 14, 4 和 26 的数据。","code":""},{"path":"chap7.html","id":"sec7-3","chapter":"第 7 章 参数模型的模型检查","heading":"7.3 比较观测的和拟合的生存函数","text":"在参数建模中，生存函数估计是生存时间 \\(t\\) 的连续函数，因此可针对模型中包含的解释变量的特定值绘制该函数。当只有一个生存数据样本且没有解释变量时，拟合的生存函数可以直接与生存函数的 Kaplan-Meier 估计进行比较，如第 2 章 2.1.2 节所述。如果拟合的生存函数接近 Kaplan-Meier 估计（这是一个阶跃函数），拟合的模型是数据的合适总结。同样，假设模型包含一两个因素，这些因素根据治疗组对个体进行分类，或提供治疗组和性别之间的交叉分类。对于由模型中各因素水平的组合定义的每一组个体，可以将拟合的生存函数与相应的生存函数的 Kaplan-Meier 估计进行比较。在记录多个解释变量值的情况下，会根据拟合模型的线性部分的估计值形成个体组。对于第 \\(\\) 个个体（其在模型中解释变量的值为 \\(\\boldsymbol x_i\\)），此线性部分在比例风险模型中就是风险评分 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\)，在加速失效时间模型中则是 \\(\\hat{\\boldsymbol{\\alpha}}^{\\prime}\\boldsymbol{x}_i\\)。接下来的讨论基于风险评分进行，其中较大的正值对应较高的风险，但同样也可以基于加速失效时间模型的线性部分、加速因子值或时间比值来进行。将每个个体的风险评分值按升序排列，并将个体根据这些值分为若干组。例如，如果考虑三个组，就会有风险评分值低、中、高的个体。以这种方式形成的实际组数将取决于数据集的大小。对于较大的数据集，可能构建五个甚至七个组。具体来说，如果有五个组，那么每个组中将有 20% 的个体；风险评分值最低和最高的个体将分别处于低风险和高风险，而中间的 20% 的个体将处于中风险。下一步是比较每组中观测的和拟合的生存函数。假设 \\(\\hat{S}_{ij}(t)\\) 是第 \\(j\\) 组中第 \\(\\) 个个体基于模型的生存函数估计。然后根据下式获得每个组（或仅获得具有最小、中等和最高风险评分的组）的平均生存函数\\[\\bar{S}_j(t)=\\frac1{n_j}\\sum_{=1}^{n_j}\\hat{S}_{ij}(t)\\]其中 \\(n_j\\) 是第 \\(j\\) 组的观测数。对于一系列 \\(t\\) 值，我们会得到 \\(\\bar{S}_j(t)\\) 的值，因此，对于每个 \\(j\\) 值，将 \\(\\bar{S}_j(t)\\) 的值关于 \\(t\\) 值作图，可以得到一条平滑曲线。而对于特定组，对应的观测生存函数是该组个体生存函数的 Kaplan-Meier 估计。将这两组估计叠加在一起，可以直观地表示观测生存函数与拟合生存函数之间的一致性。此程序与 3.11.1 节中描述的用于 Cox 回归模型的程序类似。使用这种方法，通常比基于残差的图形更容易检测出与拟合模型的偏差。然而，该程序可能因使用相同的拟合模型来定义组并获得每组的生存函数估计而受到批评。如果数据集足够大，则可以根据一半数据估计生存函数，并根据另一半数据评估模型的拟合度。此外，由于该方法基于风险评分的值，事实上，有可能存在具有不同解释变量值但碰巧具有相同风险评分值的个体，该方法没有考虑到这些个体的差异。示例 7.2  (卵巢癌患者的化疗) 在本例中，我们检查 Weibull 比例风险模型对 26 名卵巢癌女性患者接受治疗后的生存时间数据的拟合情况。拟合包含变量 Age 和 Treat 的 Weibull 模型，如示例 5.11 所示，因此第 \\(\\) 个个体拟合的生存函数为\\[\\begin{align}\n\\hat{S}_i(t)=\\exp\\left\\{-e^{\\hat{\\eta}_i}\\hat{\\lambda}t^{\\hat{\\gamma}}\\right\\}\n\\tag{7.8}\n\\end{align}\\]其中 \\(\\hat{\\eta}_i=0.144\\,Age_i-1.023\\,Treat_i\\) 为风险评分，\\(=1,2,\\ldots,26\\)。这等价于示例 7.1 使用的模型的加速失效时间表示。然后将 \\(\\hat \\eta_i\\) 的值按升序排列并分为三组，如表 7.2 所示。\n下一步是通过对三组患者的生存函数估计值进行平均，来获得每组的平均生存函数（如式 (7.8) 所示），其中考虑的时间点有 \\(t = 0, 1,..., 1230\\)。三个平均生存函数如图 7.5 所示。然后计算表 7.2 中所示的三组中每个个体的生存函数的 Kaplan-Meier 估计，这也显示在图 7.5 中。\n从该图中，我们看到该模型对高危组患者的拟合很好。但对于中等风险组，观测生存函数和拟合生存函数之间的一致性不太好，因为拟合模型对生存函数的估计有点过高。事实上，该组的患者具有最大的鞅残差值，这也表明拟合模型没有充分总结这些个体的死亡时间。低风险组中只有 1 例死亡，因此模型对于这组患者的拟合情况几乎无从得知。","code":""},{"path":"chap7.html","id":"sec7-4","chapter":"第 7 章 参数模型的模型检查","heading":"7.4 识别有影响的观测","text":"与拟合 Cox 回归模型时一样，识别对特定参数估计或整组参数估计产生不当影响的观测非常重要。本节依次考虑这两个方面的影响。Weibull 比例风险模型的许多影响诊断可从模型的加速失效时间表示中导出，但它们也适用于该系列的其他模型。这些诊断是根据模型中所有 \\(p + 2\\) 个 的估计参数及其方差-协方差阵计算得出的。为了方便起见，\\(p + 2\\) 个参数的向量将用 \\(\\boldsymbol \\theta\\) 表示，因此 \\(\\boldsymbol{\\theta'}=(\\mu,\\alpha_1,\\alpha_2,\\ldots,\\alpha_p,\\sigma)\\)。向量 \\(\\hat{\\boldsymbol \\theta}'\\) 表示参数估计的相应向量。","code":""},{"path":"chap7.html","id":"sec7-4-1","chapter":"第 7 章 参数模型的模型检查","heading":"7.4.1 观测对单个参数估计的影响","text":"在省略第 \\(\\) 个观测的情况下，\\(\\boldsymbol \\theta\\) 向量的第 \\(j\\) 个分量 \\(\\boldsymbol \\theta_j\\) 估计值变化量近似为如下 \\((p + 2) × 1\\) 矢量的第 \\(j\\) 个分量\\[\\begin{align}\n\\mathrm{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\boldsymbol{u}_i\n\\tag{7.9}\n\\end{align}\\]在式 (7.9) 中，\\(\\mathrm{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\) 是 \\(\\boldsymbol \\theta\\) 参数估计的方差-协方差阵，\\(\\boldsymbol u_i\\) 是第 \\(\\) 个观测的对数似然关于 \\(\\boldsymbol \\theta\\) 中 \\(p+2\\) 个参数的一阶偏导数值的 \\((p + 2) × 1\\) 向量，在 \\(\\hat{\\boldsymbol \\theta}\\) 处求值。而 \\(\\boldsymbol u_i\\) 是一个 \\((p + 2) × 1\\) 向量，包含了第 \\(\\) 个观测的对数似然函数关于 \\(\\boldsymbol \\theta\\) 中 \\(p+2\\) 个参数的一阶偏导数在 \\(\\hat{\\boldsymbol \\theta}\\) 处的值。因此，向量 \\(\\boldsymbol u_i\\) 是第 \\(\\) 个观测的得分残差值向量，在 7.1.5 节中定义。量 \\(\\Delta_i\\hat{\\alpha}_j\\) 是式 (7.9) 中向量的第 \\(2\\) 至第 \\(p − 1\\) 个分量，但我们继续将其称为 delta-betas 而不是 delta-alphas. 这些值可以通过除以 \\(\\hat\\alpha_j\\) 的标准误来标准化，从而得到标准化的 delta-betas. 索引图或 \\(\\Delta_i\\hat{\\alpha}_j\\) 标准化或非标准化值的图形提供了这方面的影响的信息性总结。","code":""},{"path":"chap7.html","id":"sec7-4-2","chapter":"第 7 章 参数模型的模型检查","heading":"7.4.2 观测对参数估计集的影响","text":"参数生存模型中 \\(n\\) 个观测中的每一个对参数估计集的影响可以使用似然位移 (likelihood displacement) 来度量。这在第 4 章 4.3 节中结合 Cox 回归模型进行了描述，它只是为完整数据集拟合的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值与为移除第 行的数据集拟合的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值之差，\\(= 1, 2,...,n\\)。实际上该统计量为矩阵 \\(\\boldsymbol{U}\\operatorname{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\boldsymbol{U}^{\\prime}\\) 的对角元，这是最简单的计算方式，其中 \\(\\boldsymbol{U}\\) 为 \\(n \\times (p + 2)\\) 矩阵，其元素为 \\(\\partial\\log L_i/\\partial\\theta_j,j=1,2,\\ldots,p{+}2\\), 其中 \\(\\theta_j\\) 是参数向量 \\(\\boldsymbol \\theta\\) 的第 \\(j\\) 个参数估计，\\(\\mathrm{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\) 是参数估计的方差-协方差阵，\\(L_i\\) 是第 \\(\\) 个观测的似然贡献。该统计量的较大值表明相应的观测对拟合模型中的参数估计有所影响。Hall, Rogers Pregibon (1982) 提出了另外两个度量第 \\(\\) 个观测对构成向量 \\(\\boldsymbol \\theta\\) 的参数集的影响的总结指标：统计量 \\(F_i\\) 和 \\(C_i\\)。量 \\(F_i\\) 由下式给出\\[\\begin{align}\nF_i=\\frac{\\boldsymbol{u'}_i\\boldsymbol{R^{-1}}\\boldsymbol{u}_i}{(p+2)\\{1-\\boldsymbol{u'}_i\\boldsymbol{R^{-1}}\\boldsymbol{u}_i\\}}\n\\tag{7.10}\n\\end{align}\\]其中 \\((p + 2) \\times (p + 2)\\) 矩阵 \\(\\boldsymbol R\\) 为得分残差的叉乘矩阵，即 \\(\\boldsymbol R = \\sum_{=1}^n\\boldsymbol{u}_i\\boldsymbol{u}_i^{\\prime}\\)。等价地，\\(\\boldsymbol{R}=\\boldsymbol{U'U}\\)，其中 \\(\\boldsymbol{U}\\) 是 \\(n \\times (p + 2)\\) 矩阵，其第 \\(\\) 行是得分残差向量 \\(\\boldsymbol u'_i\\) 的转置。第 \\(\\) 个观测对参数估计集影响的另一个度量是统计量\\[\\begin{align}\nC_i=\\frac{\\boldsymbol{u'}_i\\mathrm{var}\\left(\\boldsymbol{\\theta}\\right)\\boldsymbol{u}_i}{\\{1-\\boldsymbol{u'}_i\\mathrm{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\boldsymbol{u}_i\\}^2}\n\\tag{7.11}\n\\end{align}\\]统计量 \\(F_i\\) 和 \\(C_i\\) 的通常具有截然不同的值。然而，在每种情况下，较大的统计量表明相应的观测是有影响的。需要通过从数据集中省略该观测并重新拟合模型来研究这些观测究竟如何影响了估计。示例 7.3  (卵巢癌患者的化疗) 我们现在继续研究卵巢癌化疗后的生存时间数据中是否存在任何有影响的观测。年龄和治疗的非标准化 delta-betas，关于生存时间的秩次制图，如图 7.6 和 7.7 所示。\n在图 7.6 中，两个观测的 Age 的 delta-betas 值相对较大，对应于原始数据集的患者 4 和 5 中。这两名女性的生存时间都很短，而且其中一名年龄相对较大，为 74 岁，另一名相对年轻，为 43 岁。图 7.7 中显示的 Treat 的 delta-betas 没有显示任何异常特征。接下来我们研究每个观测对参数估计集的影响。图 7.8 显示了似然位移统计量关于生存时间秩次的图形。\n式 (7.10) 和 (7.11) 中定义的 \\(F_i\\) 和 \\(C_i\\) 的值关于生存时间秩次的图形绘制在图 7.9 和 7.10 中。图 7.9 清晰地表明与患者 5 对应的观测是有影响的，并且应更详细地研究患者 1, 4, 14 和 26 的影响。图 7.10 强烈表明患者 5 和 26 的数据是有影响的。\n在为所有 26 名患者拟合的模型中，拟合的风险函数的线性部分为\\[0.144\\textit{ Age}_i-1.023\\textit{ Treat}_i\\]而依次省略观测 1, 4, 5, 14 和 26 后成为：省略患者 1： \\(\\text{ }0.142\\,Age_i-1.016\\,Treat_i\\)省略患者 4： \\(\\text{ }0.175\\,Age_i-1.190\\,Treat_i\\)省略患者 5： \\(\\text{ }0.177\\,Age_i-0.710\\,Treat_i\\)省略患者 14：\\(0.149\\,Age_i-1.318\\,Treat_i\\)省略患者 26：\\(0.159\\,Age_i-0.697\\,Treat_i\\)这些结果表明，省略患者 1 的数据对参数估计的影响很小。当省略患者 4 的数据时，Age 的系数估计受影响最大，而当省略患者 14 的数据时，Treat 的系数变化最大。如果省略患者 5 或 26 的数据，这两个估计都会受到相当大的影响。当为所有 26 名患者拟合模型时，接受联合治疗 (Treat = 2) 的患者相对于接受单一治疗 (Treat = 1) 的患者的风险比估计为 \\(e^{-1.023}=0.36\\)。当依次省略患者 1, 4, 5, 14 和 26 的观测时，经年龄调整的风险比估计分别为 0.36, 0.30, 0.49, 0.27 和 0.50。患者 5 和 26 的数据显然对风险比估计影响最大；在每种情况下，估计值都会增加，而治疗效应会减小。忽略患者 4 或 14 的数据会降低风险比估计，从而增加治疗效应估计。","code":""},{"path":"chap7.html","id":"sec7-5","chapter":"第 7 章 参数模型的模型检查","heading":"7.5 检验 Weibull 模型的比例风险","text":"Weibull 模型最常用作参数比例风险模型，因此检验比例风险假设是否成立非常重要。在第 4 章的 4.4.3 节展示了如何使用时依变量变量来检验 Cox 回归模型中风险的比例性。包含时依变量的参数模型更加复杂，并且由于用于拟合此类模型的软件尚未广泛使用，因此此处将不再给出有关此方法的进一步细节。在 Weibull 模型中，多组（例如 \\(g\\) 组）之间比例风险的假设对应于每组基线风险函数的形状参数 \\(\\gamma\\) 相同的假设。检验这一假设的一种方法是对每组拟合一个单独的 Weibull 模型，其中模型的线性部分在每组中都是相同的。为每组数据拟合的模型将具有不同的形状参数以及不同的尺度参数。然后，将这 \\(g\\) 个单独模型的统计量 \\(-2\\operatorname{log}\\hat{L}\\) 的值相加，这对应于每组具有不同形状参数的模型的 \\(-2\\operatorname{log}\\hat{L}\\)，记作 \\(-2\\operatorname{log}\\hat{L}_1\\)。然后，我们将这 \\(g\\) 组数据合并并拟合一个 Weibull 比例风险模型，该模型包括与组别效应相关的因素，以及该因素与模型中其他项之间的交互作用。那么，该模型对应于每组具有共同的形状参数。在模型中考虑了组别效应，使得每组有不同的尺度参数。然后，将该模型的 \\(-2\\operatorname{log}\\hat{L}\\) 的值（记作 \\(-2\\operatorname{log}\\hat{L}_0\\)）与 \\(-2\\operatorname{log}\\hat{L}_1\\) 比较。这两个统计量之差是因将 Weibull 形状参数限制为相等而导致的 \\(-2\\operatorname{log}\\hat{L}\\) 的变化，并可与自由度为 \\(g−1\\) 的卡方分布的分位点相比较。如果差值不大，则比例风险假设是合理的。示例 7.4  (卵巢癌患者的化疗) 第 5 章示例 5.11 中给了卵巢癌治疗后生存研究的数据，现用该数据说明检验两个治疗组中每个患者的 Weibull 形状参数相同这一假设的程序。第一步是为每个治疗组的数据拟合仅包含 Age 的 Weibull 比例风险模型。当为单一化疗组数据拟合该模型时，统计量 \\(-2\\operatorname{log}\\hat{L}\\) 的值为 22.851，而接受联合治疗组的模型统计量为 16.757. 两 \\(-2\\operatorname{log}\\hat{L}\\) 值之和为 39.608，这是两个治疗组具有不同形状参数且每组具有不同 Age 系数的 Weibull 模型的统计量。对于每个治疗组具有不同年龄效应、治疗效应和共同形状参数的模型，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 39.708。因此，将形状参数限制为相等时，\\(-2\\operatorname{log}\\hat{L}\\) 的变化为 0.10，与一个自由度的卡方分布相比，该变化并不显著。因此可以认为两个形状参数是相等的。第 6 章描述了比例风险模型的一些替代模型，第 11 章进一步探讨了如何处理风险不成比例的情况。","code":""},{"path":"chap7.html","id":"sec7-6","chapter":"第 7 章 参数模型的模型检查","heading":"7.6 延伸阅读","text":"与 Cox 回归模型的模型检查文献相比，关于参数生存模型中模型检查的文献相对较少。Hall, Rogers Pregibon (1982) 描述了 Weibull 比例风险模型的残差和影响的度量。Hollander Proschan (1979) 展示了如何评估一组未删失的观测样本是否来自特定的概率分布。Weissfeld Schneider (1994) 描述并展示了一些可用于生存数据参数模型的残差。Cohen Barnett (1995) 描述了如何使用模拟包络线 (simulated envelopes) 来帮助解释残差的累积风险图。Weissfeld Schneider (1990) 以及 Escobar Meeker (1992) 给出了用于参数生存建模的影响诊断方法。这些论文涉及基于局部影响 (local influence) 的观点，Cook (1986) 对此进行了一般性的探讨，Rancel Sierra (2001) 给出了综述。Ciampi Etezadi-Amoli (1985) 提出了一种根据风险函数的一般模型检验比例风险和加速失效时间假设的方法。Copas Heydari (1997) 给出了参数模型的一个有趣的应用，该模型基于假释囚犯再次犯罪的时间的数据，其中包括模型的检验。","code":""},{"path":"chap8.html","id":"chap8","chapter":"第 8 章 时依变量","heading":"第 8 章 时依变量","text":"当解释变量纳入生存数据模型时，这些变量所取的值是在研究开始时记录的那些值。例如，考虑一项研究，以比较第 1 章示例 1.4 中首次描述的两种前列腺癌治疗方法。在这里，患者的年龄、血清血红蛋白水平、肿瘤大小、Gleason 指数的值还有治疗组，都是在患者进入研究时记录的。然后评估这些变量对死亡风险的影响。在许多产生生存数据的研究中，个体在研究期间被监测。在此期间，可以定期记录某些解释变量的值。因此，在前列腺癌的例子中，可以定期记录肿瘤的大小和其他变量。如果能够考虑到这些解释变量随时间推移而变化的情况，则可以得到更令人满意的死亡风险模型。比如，在前列腺癌的研究中，比起研究起始时肿瘤大小的值，最近的大小可能更能准确地预测未来的预期寿命。值随时间变化的变量称为时依变量 (time-dependent variables)，在本章中，我们将看到如何将这些变量纳入生存数据分析所使用的模型。","code":""},{"path":"chap8.html","id":"sec8-1","chapter":"第 8 章 时依变量","heading":"8.1 时依变量的类型","text":"考虑两种类型的时依变量，它们称为内部变量 (internal variables) 和外部变量 (external variables).内部变量与研究中的特定个体相关，并且只能在患者存活时进行测量。当随着时间的推移对患者的某些特征进行重复测量时，就会产生此类数据，例子包括肺功能的测量，例如肺活量和峰值流速、白细胞计数、收缩压和血清胆固醇水平；描述患者状态变化的变量也属于此类。例如，在骨髓移植后，患者可能容易发生移植物抗宿主病 (graft versus host disease). 表示患者在任何给定时间是否遭受这种危及生命的副作用的二元解释变量是内部变量的另一个例子。在每种情况下，这些变量都反映了患者的状况，它们的值很可能与患者的生存时间有关。外部变量也是时依变量，其存在不一定要求患者存活。其中一种特定类型的外部变量是其值会按预设方式随时间变化，因此在未来任何时间点其值都可以提前得知。例如，在研究过程中以预定方式调整的药物剂量，或者在器官移植后计划更改使用的免疫抑制剂类型等。另一种类型的外部变量是完全独立于任何特定个体存在的变量，例如大气中二氧化硫的水平或空气温度。例如在有关某些类型呼吸系统疾病患者管理的研究中，这些数值的变化很可能对个体的寿命产生影响。","code":""},{"path":"chap8.html","id":"sec8-1-1","chapter":"第 8 章 时依变量","heading":"8.1.1 时依系数","text":"在时固 (time-constant) 解释变量的系数是时间的函数的情况下，也会出现时依变量。在第 3 章 3.9 节解释了 Cox 比例风险模型中解释变量的系数是对数风险比，在该模型下，风险比是恒定的。如果这种风险比实际上是时间的函数，那么时依解释变量的系数就称为时变 (time-varying) 系数。在这种情况下，对数风险比不是恒定的，因此我们不再有比例风险模型。更正式地说，假设解释变量 \\(X\\) 的系数是时间 \\(t\\) 的线性函数，因此我们可以将该项写为 \\(\\beta tX\\)。这意味着 \\(X\\) 值的单位增加对应的对数风险比是 \\(\\beta t\\)，它是时间的线性函数。回想，在第 4 章 4.4.3 节中，通过在模型中引入这种形式的项来检验比例风险假设。该项也可以写为 \\(\\beta X(t)\\)，其中 \\(X(t) = Xt\\) 是时依变量。一般来说，假设模型包含解释变量 \\(X\\)，其时变系数的形式为 \\(\\beta(t)\\)。模型中对应的项是 \\(\\beta (t)X\\)，可以表示为 \\(\\beta X(t)\\)。换句话说，涉及时变系数的项可以表示为具有恒定系数的时依变量。然而，如果 \\(\\beta(t)\\) 是一个或多个未知参数的非线性函数，例如 \\(\\beta_0 \\exp(\\beta_1t)\\)，则该项不太容易在模型中拟合。这样的变量不能直接纳入通过最大化偏似然函数进行拟合的 Cox 回归模型。要了解原因，请考虑一个包含变量 \\(X_1=X_0t\\) 的模型，其中 \\(X_0\\) 是数据集中的一个变量，\\(X_1\\) 是该变量与生存时间的乘积。如果将 \\(X_1\\) 像任何时固解释变量一样包含在模型中，\\(X_1\\) 的系数可能显著小于零。这可能被解释为：对于 \\(X_1\\) 值较高的个体，在任何时间的死亡风险较低，或者等价地说，\\(X_1\\) 值较大的个体生存时间更长。但当然，生存时间较长的个体具有更大的生存时间值，因此 \\(X_1\\) 的值也更大。因此，\\(X_1\\) 是生存的重要预测因素就不足为奇了。相反，\\(X_1\\) 应作为时依变量包含在模型中。所有这些不同类型的时依变量都可以按照下节描述的方式引入 Cox 回归模型。","code":""},{"path":"chap8.html","id":"sec8-2","chapter":"第 8 章 时依变量","heading":"8.2 时依变量的建模","text":"根据第 3 章描述的 Cox 比例风险模型，研究中第 \\(\\) 个体在 \\(t\\) 时刻的死亡风险可以写成以下形式\\[h_i(t)=\\exp\\left\\{\\sum_{j=1}^p\\beta_jx_{ji}\\right\\}h_0(t)\\]其中 \\(x_{ji}\\) 为第 \\(\\) 个个体第 \\(j\\) 个解释变量 \\(X_j\\) 的基线值，\\(j=1,2,\\ldots,p\\)，\\(\\beta_j\\) 为 \\(x_{ji}\\) 的系数，\\(h_0(t)\\) 为基线风险函数。将此模型推广到部分或全部解释变量为时依变量的情况，我们将第 \\(\\) 个个体中第 \\(j\\) 个解释变量在时间 \\(t\\) 的值写为 \\(x_{ji}(t)\\)。Cox 回归模型则变为\\[\\begin{align}\nh_i(t)=\\exp\\left\\{\\sum_{j=1}^p\\beta_jx_{ji}(t)\\right\\}h_0(t).\n\\tag{8.1}\n\\end{align}\\]在此模型中，基线风险函数 \\(h_0(t)\\) 解释为在起点处所有变量都为零且随时间保持此值的个体的风险函数。由于式 (8.1) 给出的模型中变量 \\(x_{ji}(t)\\) 的值取决于时间 \\(t\\)，因此相对风险 \\(h_i(t)/h_0(t)\\) 也是时依的。这意味着时间 \\(t\\) 的死亡风险不再与基线风险成比例，并且该模型不再是比例风险模型。为了解释该模型中的 \\(\\beta\\) 参数，请考虑两个个体，例如第 \\(r\\) 个和第 \\(s\\) 个，在时间 \\(t\\) 的风险函数之比\\[\\begin{aligned}\\frac{h_{r}(t)}{h_{s}(t)}&=\\exp\\left[\\beta_{1}\\{x_{1r}(t)-x_{1s}(t)\\}+\\cdots+\\beta_{p}\\{x_{pr}(t)-x_{ps}(t)\\}\\right]\\end{aligned}\\]因此，若这两个个体在给定时间 \\(t\\) 的第 \\(j\\) 个解释变量的值相差一个单位，同时这两个个体所有其他 \\(p−1\\) 变量具有相同的值，系数 \\(\\beta_j, j = 1, 2,...,p\\) 可以解释为这两个个体的对数风险比。","code":""},{"path":"chap8.html","id":"sec8-2-1","chapter":"第 8 章 时依变量","heading":"8.2.1 拟合含时依变量的模型","text":"当 Cox 回归模型扩展为包含时依变量时，第 3 章式 (3.6) 中的偏对数似然函数可以推广为\\[\\begin{align}\n\\sum_{=1}^n\\delta_i\\left\\{\\sum_{j=1}^p\\beta_jx_{ji}(t_i)-\\log\\sum_{l\\R(t_i)}\\exp\\left(\\sum_{j=1}^p\\beta_jx_{jl}(t_i)\\right)\\right\\}\n\\tag{8.2}\n\\end{align}\\]其中 \\(R(t_i)\\) 是在时间 \\(t_i\\) 的风险集，\\(t_i\\) 为研究中第 \\(\\) 个个体的死亡时间，\\(=1,2,\\ldots,n\\)，\\(\\delta_i\\) 是一个事件指示符，如果第 \\(\\) 个个体的生存时间删失，则为零，否则为一。那么可以将该表达式最大化，以给出 \\(\\beta\\) 参数的估计。为了在这个最大化过程中使用式 (8.1) 中的模型，模型中的变量在时间 \\(t_i\\) 的风险集中所有个体的每个死亡时间都必须具有已知值。这对于值是预先确定的外部变量来说没有问题，但对于独立于研究中个体存在的外部变量，这可能会成为一个问题，对于内部变量来说更是如此。为了说明这个问题，考虑一项针对心肌梗死患者的两种维持疗法的试验。这类患者的血清胆固醇水平很可能在患者入院接受研究时以及此后每隔一定时间测量一次。该变量是时依变量，表示为 \\(X(t)\\)。因此，任何特定患者的死亡风险，例如第 \\(\\) 个患者在时间 \\(t\\) 的风险 \\(h_i(t)\\) 更有可能受到解释变量 \\(X(t)\\) 在时间 \\(t\\) 的值的影响，而不是它在时间原点（\\(t=0\\)）的值。现在假设第 \\(\\) 个个体在时间 \\(t_i\\) 死亡，并且在时间 \\(t_i\\) 的风险集中还有另外两个个体，记作 \\(r\\) 和 \\(s\\)。我们进一步假设个体 \\(r\\) 在时间 \\(t_r\\) 死亡，其中 \\(t_r > t_i\\)，并且个体 \\(s\\) 的生存时间 \\(t_s\\) 在 \\(t_r\\) 之后的某个时间删失。这种情况如图 8.1 所示。在该图中，垂直虚线指的是测量 \\(X(t)\\) 时的患者时间 (patient time) 中的点。\n如果 \\(r\\) 和 \\(s\\) 是时间 \\(t_i\\) 的风险集中仅有的两个个体，并且 \\(X\\) 是唯一测量的解释变量，则第 \\(\\) 个个体对式 (8.2) 中的偏对数似然函数的贡献将为\\[\\beta x_i(t_i)-\\log\\sum_l\\exp\\{\\beta x_l(t_i)\\}\\]其中，\\(x_i(t_i)\\) 是第 \\(\\) 个个体 \\(X(t)\\) 在其死亡时间 \\(t_i\\) 处的值，\\(l\\) 在求和中取值 \\(,r\\) 和 \\(s\\)。因此，该表达式等于\\[\\beta x_i(t_i)-\\log\\left\\{e^{\\beta x_i(t_i)}+e^{\\beta x_r(t_i)}+e^{\\beta x_s(t_i)}\\right\\}\\]这表明，在第 \\(\\) 个个体的死亡时间 \\(t_i\\)，以及在个体 \\(r\\) 和 \\(s\\) 在时间 \\(t_i\\) 处，需要时依变量 \\(X(t)\\) 的值。此外，对于个体 \\(r\\) 和 \\(s\\)，在个体 \\(r\\) 的死亡时间 \\(t_r\\) 处，需要变量 \\(X(t)\\) 的值。对于模型中作为时间显式函数的项，例如时间与基线测量的变量或因素之间的交互作用，在任何时间获取任何个体的时依变量值并不困难。事实上，当使用具有处理时依变量功能的统计软件时，通常可以直接将这些变量纳入 Cox 模型。对于其他变量，如血清胆固醇水平，需要在非测量时间对时依变量的值进行近似估计。在包含时依变量的 Cox 回归模型中，在某个时间 \\(t\\) 死亡的风险只能取决于时依变量截至时间 \\(t\\) 的值。该模型无法预测未来！这意味着，只要在特定时间需要解释变量的值，就会使用该变量的最后记录值。当在多个时间点记录个体的变量值时，可能会倾向于使用最接近给定时间的值，或者在时间之间使用某种形式的插值。图 8.2 说明了这些可能性。\n图中的连续曲线表示时依变量在任意时刻的实际值，垂直虚线表示实际测量该变量的时间。如果需要在图中的 \\(t\\) 时刻测量该变量的值，则应使用最后记录的变量在 P 处的值，而不是 R 处的值（最接近 \\(t\\) 的值）或 Q 处的值（ P 和 R 之间的线性插值）。使用 R 或 Q 处的变量值而不是 P 处的变量值可能导致不正确的模型，因为在时间 \\(t\\) 处，R 和 Q 处的变量值是未知的。一些分类变量可能具有这样的特点：个体只能沿特定方向经过变量的各个水平。例如，个体的表现状态可能只会恶化，因此该分类变量的值可能只从“良好”变为“一般”，再从“一般”变为“差”。再如，活检后，与肿瘤存在相关的变量将取两个值中的一个，对应于“不存在”和“存在”。因此，在连续活检中，状态从“存在”变为“不存在”的可能性非常小。通过绘制每位患者的变量值与时间的关系图，可以检测到时依变量值的异常变化。这可能会导致对数据进行一定程度的编辑。例如，考虑图 8.3，它显示了特定患者在多个时间点的活检结果，即不存在 (absent) 或存在 (present) 肿瘤。在此图中，在 \\(t_A\\) 和 \\(t_B\\) 这两个时间点中至少有一个是错误的。因此，可以将时间 \\(t_A\\) 的观测更改为 “absent”，或者将时间 \\(t_B\\) 的观测更改为 “present”.\n一个完全可预测时依变量是个体的年龄，并且在进行长期研究时，年龄的增长可能具有重要意义。然而，如果将年龄以线性项纳入模型，那么偏似然函数的形式意味着年龄的变化不会出现在该似然函数中。为了说明这一点，假设变量 \\(X\\) 与研究开始时个体的年龄（以年为单位）有关，因此他们在时间 \\(t\\) 的年龄是一个时依变量 \\(X(t)=X+t\\)。如果研究开始时第 \\(\\) 个个体的年龄是 \\(x_i\\)，则根据式 (8.1)，可通过下式建模\\[\\begin{aligned}h_i(t)=\\exp\\{\\beta(x_i+t)\\}h_0(t)\\end{aligned}\\]其中 \\(h_0(t)\\) 是基线风险函数。式 (8.2)，相应的偏对数似然函数为\\[\\begin{aligned}\n&\\sum_{=1}\\delta_i\\{\\beta(x_i+t_i)-\\log\\sum_{l\\R(t_i)}\\exp{[\\beta(x_l+t_i)]}\\}, \\\\\n=&\\sum_{=1}^n\\delta_i\\{\\beta x_i+\\beta t_i-\\log\\sum_{l\\R(t_i)}\\exp(\\beta x_l+\\beta t_i)\\}, \\\\\n=&\\sum_{=1}^n\\delta_i\\{\\beta x_i-\\log\\sum_{l\\R(t_i)}\\exp(\\beta x_l)\\}.\\end{aligned}\\]这只是 Cox 回归模型的偏对数似然，该模型仅包括年龄的基线值。因此，将时间 \\(t\\) 时的实际年龄作为线性项纳入模型不会有任何收获。","code":""},{"path":"chap8.html","id":"sec8-3","chapter":"第 8 章 时依变量","heading":"8.3 时依变量的编码","text":"包含时依变量的模型可以通过最大化式 (8.2) 中的偏对数似然函数来拟合。这可以使用软件来实现，该软件能够在数据集中的不同事件时间确定任何时依变量的值，如 8.2.1 节所述。然而，一种更灵活的方法是将个体的数据以一系列时间区间的形式表示，在这些时间区间内，所有解释变量的值都是恒定的。然后，对于除最终区间之外的所有区间，将事件指示符设为 0. 最终区间的上限是个体的事件时间或删失时间，如果在该区间结束时有事件发生，则事件指示符的值设为 1，否则设为 0. 然后，与每个时间区间的下限和上限相关的变量，例如 \\(Start\\) 和 \\(Stop\\)，用于指定生存经历，变量 \\(Status\\) 用于指示在每个 \\(Stop\\) 所在时间是否发生了事件。为避免歧义，包含时间 \\(t\\) 的区间需满足 \\(Start < t \\leqslant Stop\\)，因此该区间将包含值 \\(t = Stop\\) 但不包含 \\(t = Start\\)。那么，每个时间区间的生存数据由三个值 \\((Start,Stop,Status)\\) 表示，这种数据格式称为计数过程格式 (counting process format) 或 \\((start,stop,status)\\) 格式。许多生存分析软件包可以处理以这种一般形式表示的数据。如果为这种形式的数据拟合仅包含时固解释变量的模型，则所得的偏似然函数与原始数据的偏似然函数相同。第 13 章的 13.1 节对此进行了更全面的解释，其中给出了有关计数过程格式及其在生存分析其他领域的应用的更多详细信息。示例 8.1  (计数过程格式说明) 肝病患者的血清白蛋白水平往往会随着时间的推移而下降。因此，在任何特定时间的白蛋白水平可能比研究开始时记录的值更能指示当时的死亡风险。假设在一项关于肝病诊断后生存情况的研究中，某患者的生存时间为 379 天。该患者的基线白蛋白水平为 3.8 g/dL，随后在 88 天, 172 天, 245 天和 357 天分别进行了测量。这些天的记录值分别为 3.4, 2.9, 3.0 和 2.3 g/dL，因此，在 88 天记录的值适用于从第 89 天开始到下一次测量（第 172 天）为止的这段时间。该患者的计数过程格式数据如表 8.1 所示。该患者的数据现在有 5 行。如果患者在 379 天时仍然活着，并且这是他们参与研究的最后一天，则变量 \\(Status\\) 的值将替换为 0. 对研究中的所有患者重复该过程，然后为此扩展的数据集拟合包含时依变量血清白蛋白的 Cox 回归模型。","code":""},{"path":"chap8.html","id":"sec8-4","chapter":"第 8 章 时依变量","heading":"8.4 累积风险函数和生存函数的估计","text":"在拟合了包括时依变量的 Cox 回归模型后，可以估计基线累积风险函数 \\(H_0(t)\\) 和相应的基线生存函数 \\(S_0(t)\\)。这需要对第 3 章 3.10 节中给出的结果进行调整，以应对时依变量带来的额外复杂性，其中解释变量的值需要用其特定时间的值进行更新。具体来说，式 (3.29) 中给出的基线累积风险函数的 Nelson-Aalen 估计变为\\[\\begin{align}\n\\tilde{H}_0(t)=-\\log\\tilde{S}_0(t)=\\sum_{j=1}^k\\frac{d_j}{\\sum_{l\\R(t_{(j)})}\\exp\\{\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_l(t)\\}}\n\\tag{8.3}\n\\end{align}\\]其中 \\(t_{(k)}\\leqslant t<t_{(k+1)},k=1,2,\\ldots,r-1\\)，\\(\\boldsymbol x_l(t)\\) 是第 \\(l\\) 个个体在时间 \\(t\\) 时解释变量的值向量，\\(d_j\\) 是第 \\(j\\) 个有序事件时间 \\(t_{\\left(j\\right)}\\) 的事件数，\\(j=1,2,\\ldots,r\\)。可以对 3.10 节中的其他结果进行类似的修改。通过这种修改，关于风险集的求和计算变得更加复杂，因为对于每个事件时间 \\(t_{\\left(j\\right)},j=1,2,\\ldots,r\\)，都需要在该事件时间获取风险集中所有个体每个时依变量的值。获得累积风险函数的估计后，可以使用式 (3.31) 估计相应的基线风险函数，且基线生存函数的估计为 \\(\\tilde{S}_0(t)=\\exp\\{-\\tilde{H}_0(t)\\}\\)。特定个体的生存函数更难以估计。这是因为 \\(S_i(t)\\) 可表示为基线生存函数 \\(S_0(t)\\) 的幂的这一结果不再成立（在第 3 章式 (3.26) 中给出）。相反，第 \\(\\) 个个体的生存函数是利用累积风险函数（第 1 章式 (1.7) 给出）获得的\\[\\begin{align}\nS_i(t)=\\exp\\left\\{-\\int_0^t\\exp\\left(\\sum_{j=1}^p\\beta_jx_{ji}(u)\\right)h_0(u)\\mathrm{d}u\\right\\}\n\\tag{8.4}\n\\end{align}\\]因此，该生存函数不仅取决于基线风险函数 \\(h_0(t)\\)，还取决于时依变量在 \\(0\\) 到 \\(t\\) 的区间内的值。因此，生存函数可能取决于模型中时依变量的未来值，该值通常是未知的。然而，可以通过计算个体在时间 \\(t\\) 到 \\(t+h\\) 这一时间区间内生存1的概率，来得出在某特定时间区间中生存的近似条件概率，以在时间 \\(t\\) 生存为条件。这一概率为 \\(\\mathrm{P}(T_i\\geqslant t+h\\mid T_i\\geqslant t)\\)，其中 \\(T_i\\) 是与第 \\(\\) 个个体生存时间相关的随机变量。使用第 3 章 3.3.1 节中给出的条件概率的标准结果，该概率成为 \\(\\mathrm{P}(T_i\\geqslant t+h)/\\mathrm{P}(T_i\\geqslant t)\\)，这就是生存函数在时间 \\(t+h\\) 和 \\(t\\) 的值之比，即 \\(S_i(t+h)/Si(t)\\)。现在，我们假设任何时依变量在该区间内保持恒定，因此根据式 (8.4)，近似条件概率为\\[\\begin{aligned}\nP_{{}}(t,t+h)&=\\left.\\frac{\\exp\\left\\{-\\exp\\left(\\sum_{j=1}^p\\beta_jx_{ji}(t)\\right)\\int_0^{t+h}h_0(u)\\mathrm{d}u\\right\\}}{\\exp\\left\\{-\\exp\\left(\\sum_{j=1}^p\\beta_jx_{ji}(t)\\right)\\int_0^th_0(u)\\mathrm{d}u\\right\\}}\\right.   \\\\\n&=\\exp\\left[-\\left\\{H_0(t+h)-H_0(t)\\right\\}\\exp\\left(\\sum_{j=1}^p\\beta_jx_{ji}(t)\\right)\\right]\n\\end{aligned}\\]其中 \\(H_0(t)\\) 是基线累积风险函数。在 \\((t, t + h)\\) 区间内存活2的近似条件概率估计为\\[\\begin{align}\n\\tilde{P}_i(t,t+h)&=\\exp\\left[-\\left\\{\\tilde{H}_0(t+h)-\\tilde{H}_0(t)\\right\\}\\exp\\left(\\sum_{j=1}^p\\hat{\\beta}_jx_{ji}(t)\\right)\\right]\n\\tag{8.5}\n\\end{align}\\]其中，\\(\\tilde H_0(t)\\) 是在拟合 Cox 回归模型时得到的基线累积风险函数的估计，该模型包含 \\(p\\) 个可能的时依变量，其值对于第 \\((= 1, 2,...,n)\\) 个个体为 \\(x_{ji}(t)\\)，\\(j = 1, 2,...,p\\)，而 \\(\\tilde \\beta_j\\) 是第 \\(j\\) 个时依变量的系数估计。这一结果由 Altman De Stavola (1994) 给出。区间 \\((t,t+h)\\) 中事件的条件概率的相应估计为 \\(1-\\tilde{P_i}(t,t+h)\\)，并且这些量可用于获得在宽度为 \\(h\\) 的多个连续区间中，每个区间中预期事件数的估计。将这些值与这些区间中观测事件数进行比较，可以对模型充分性进行非正式评估。","code":""},{"path":"chap8.html","id":"sec8-5","chapter":"第 8 章 时依变量","heading":"8.5 模型比较和验证","text":"包含时依变量的生存数据模型可以按照与 Cox 比例风险模型相同的方式进行比较，即使用第 3 章 3.5 节中描述的程序。具体来说，模型拟合过程会得到一个最大偏似然函数，从中可以获得统计量 \\(−2\\log \\hat L\\) 的值。然后，可以将不同嵌套模型之间该统计量的变化值与卡方分布的百分位点进行比较，后者自由度等于拟合的 \\(\\beta\\) 参数数量之差。因此，第 3 章讨论的模型构建策略同样适用于存在时依变量的情况。","code":""},{"path":"chap8.html","id":"sec8-5-1","chapter":"第 8 章 时依变量","heading":"8.5.1 治疗的比较","text":"为了考察考虑时依变量后治疗效应的大小，需要将包含时依变量和其他预后因素的模型的 \\(−2\\log \\hat L\\) 与额外包含治疗项的模型的 \\(−2\\log \\hat L\\) 值进行比较。但是，如果在此分析中未发现治疗效应，一个可能的解释是时依变量掩盖 (mask) 了治疗差异。为了明确这一点，请考虑一项研究的例子，该研究比较两种细胞毒性药物治疗白血病患者的效果。在这里，患者的生存时间可能取决于患者白细胞计数的后续值。如果治疗的效果是增加白细胞计数，那么在将白细胞计数作为时依变量纳入模型后，将不会识别出治疗差异。另一方面，如果不纳入该变量，治疗效应可能就会出现。对此的解释是，时依变量已经解释了治疗差异，从而解释了这种治疗是如何有效的。无论如何，将包含时依变量的分析结果与仅使用基线值的分析结果进行比较，将会获得很多有用的信息。","code":""},{"path":"chap8.html","id":"sec8-5-2","chapter":"第 8 章 时依变量","heading":"8.5.2 评估模型的充分性","text":"在拟合包含时依变量的模型后，可以实施第 4 章描述的许多评估模型充分性的技术。具体来说，可以改写式 (4.6) 来计算每个个体的总体鞅残差。第 \\(\\) 个个体的鞅残差现在为\\[\\begin{aligned}r_{Mi}=\\delta_i-\\exp\\{\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i(t_i)\\}\\tilde{H}_0(t_i)\\end{aligned}\\]其中，\\(\\boldsymbol{x}_i(t_i)\\) 是第 \\(\\) 个个体解释变量的值向量，它可能是时依的，在该个体的事件时间 \\(t_i\\) 处取值。此外，\\(\\boldsymbol{\\beta}\\) 是系数向量，\\(\\delta_i\\) 是事件指示符，如果 \\(t_i\\) 是事件，则取值一，否则取零，\\(\\tilde H_0(t_i)\\) 是根据式 (8.3) 获得的 \\(t_i\\) 处的基线累积风险函数估计。偏差残差也可以使用第 4 章的式 (4.7) 利用鞅残差来计算。第 4 章 4.2.2 节描述的图形通常会有所帮助。具体来说，鞅残差的索引图能识别离群观测。然而，在研究时依变量时，4.2.3 中描述的用于评估协变量函数形式的诊断图并不那么有用。这是因为对于任何一个个体，时依协变量都会有许多值，尚不清楚零模型的鞅残差应该关于什么来绘制。为了检测有影响的值，第 4 章 4.3.1 节引入的 delta-betas 提供了一种有用的方法来研究每个观测对单个参数估计的影响。在依次省略每个观测的情况下，\\(−2\\log \\hat L\\) 统计量的变化可以提供每个观测对参数估计集的影响的信息。","code":""},{"path":"chap8.html","id":"sec8-6","chapter":"第 8 章 时依变量","heading":"8.6 时依变量的一些应用","text":"时依变量的一个应用与评估比例风险假设有关。这在第 4 章 4.4.3 节中进行了详细讨论。在该应用中，将解释变量 \\(X\\) 和时间 \\(t\\) 的乘积形成的变量添加到 Cox 模型的线性部分，并检验 \\(Xt\\) 系数为零的原假设。如果发现该系数估计显著不等于零，则表明比例风险假设不成立。在许多情况下，从某些灾难性事件发生到患者接受治疗的等待时间 (waiting time) 可能与患者的生存密切相关。例如，在一项影响心肌梗死患者生存因素的研究中，从发生梗死到患者住院所经历的时间可能至关重要。一些患者可能在接受治疗前死亡，而那些在梗死后不久到达医院的患者往往比那些延迟治疗的患者预后更好。在评估其他解释变量对这些患者生存时间的影响时，考虑数据的这一方面非常重要。在一个类似的例子中，Crowley Hu (1977) 展示了如何在器官移植研究中使用时依变量。在这里，一个令人感兴趣的特征是移植对患者生存时间的影响。假设在一项关于特定类型器官移植有效性的研究中，患者在某个时间 \\(t_0\\) 被评估适合进行移植。然后他们将等待一段时间，直到找到合适的供体器官，如果患者在这段时间内存活下来，他们将在时间 \\(t_1\\) 接受移植。在这类研究中，接受移植的患者的生存时间无法与未按常规方式进行移植的患者进行比较。原因是为了接受移植，患者必须在等待移植的时间内生存下来。因此，生存到移植时间的组与未接受此类移植的组不能直接比较。同样，无法将接受移植的患者在移植后的生存时间与未接受移植的患者的生存时间进行比较。因为两个组的时间起点不同，因此它们在时间起点上不具有可比性。这意味着无法确定用于生存分析标准方法的时间起点。该问题的解决方案是引入一个时依变量 \\(X_1(t)\\)，若患者在时间 \\(t\\) 尚未接受移植，则该变量的值为零，否则为一。采用 Cox 回归模型，第 \\(\\) 个个体在 \\(t\\) 时刻的死亡风险为\\[\\begin{aligned}h_i(t)=\\exp\\{\\eta_i+\\beta_1x_{1i}(t)\\}h_0(t)\\end{aligned}\\]其中 \\(\\eta_i\\) 是时固 (time-dependent) 解释变量的线性组合，其值在第 \\(\\) 个个体的时间起点记录，\\(x_{1i}(t)\\) 是该个体 \\(X_1\\) 在时间 \\(t\\) 的值。在此模型下，对于在时间 \\(t\\) 之前未接受移植的患者，风险函数为 \\(\\exp(\\eta_i)h_0(t)\\)，之后为 \\(\\exp\\{\\eta_i+\\beta_1\\}h_0(t)\\)。移植对患者生存经历的影响则反映在 \\(\\beta_1\\) 中。具体来说，对于模型中其他解释变量值相同的两名患者，\\(e^{\\beta_1}\\) 是在时间 \\(t\\) 之前接受移植的患者的死亡风险，相对于在时间 \\(t\\) 未接受移植的患者的死亡风险。在拟合了包含和不包含时依变量 \\(X_1\\) 的模型后，可以比较 \\(−2\\log \\hat L\\) 的值。该值存在显著差异意味着移植对生存有影响。在对该模型的改进中，Cox Oakes (1984) 建议对于在时间 \\(t_1\\) 接受移植的患者，将项 \\(\\beta_1x_{1i}(t)\\) 替换为 \\(\\beta_1+\\beta_2\\exp\\{-\\beta_3(t-t_1)\\}\\)。在此模型中，移植的效应是在移植（\\(t=t_1\\)）后立即将风险增加到某个值 \\(\\exp(\\eta_i+\\beta_1)h_0(t)\\)，然后将风险以指数方式降低为 \\(\\exp(\\eta_i+\\beta_1)h_0(t)\\)，如果 \\(\\beta_1< 0\\)，则风险最终将小于初始风险 \\(\\exp(\\eta_i)h_0(t)\\)。参见图 8.4，该图显示了移植患者风险比 \\(h_i(t)/h_0(t)\\) 的行为，其中 \\(\\eta_i\\) 是模型的线性部分。尽管这是一个有吸引力的模型，但它确实有一个缺点：需要专门的软件来拟合。\n在特定解释变量快速变化的情况下，可以定义反映这种变化的新变量。然后可以探究风险对这些变量值的依赖性。例如，在肿瘤学研究中，肿瘤大小在一段时间内增加的百分比可能是比起点时肿瘤大小或该变量的时依版本更合适的预后变量。如果使用这种变量，就可以避免拟合时依变量所带来的计算负担。","code":""},{"path":"chap8.html","id":"sec8-6-1","chapter":"第 8 章 时依变量","heading":"8.6.1 一些例子","text":"本节给出了三个涉及时依变量的生存分析示例。首先，使用来自一项关于骨髓移植治疗白血病的研究数据，来说明如何将与患者状态相关的变量纳入模型，该变量的值在随访期内会发生变化。在第二个示例中，分析了第 5 章示例 5.11 中关于卵巢癌症两种化疗的比较的数据，以探讨年龄是否具有时变系数。第三个例子旨在说明如何将随访期间记录的时依解释变量的信息纳入生存时间模型。在每个患者的随访期内，定期记录某些解释变量的值的研究会产生大量数据。因此，示例 8.4 将使用仅含少数个体的人造数据来说明该方法。示例 8.2  (骨髓移植治疗白血病) 患有急性白血病的患者常常通过接受骨髓移植来治疗。这为受体提供了一组新的母体造血细胞 (parent blood-forming cells)，即干细胞 (stem cells)，进而产生健康的红细胞和白细胞。Klein Moeschberger (2005) 描述了一项多中心研究，该研究探讨了影响接受这种治疗的白血病患者预后的因素。这项研究涉及患有急性淋巴细胞白血病 () 和急性粒细胞白血病 (AML) 的患者，根据移植时的状态，AML 患者进一步分为低风险和高风险。每个患者从输血之日起的生存时间，以及与供体和受体特征有关的许多解释变量的值，以及康复过程中发生的不良事件，都已记录。骨髓移植前，患者接受环磷酰胺和白消安的联合治疗，以破坏所有异常血细胞。血小板恢复到正常水平所需的时间是患者预后的一个重要变量，因此也记录了该变量的值。本示例仅基于 St Vincent’s Hospital Sydney, Australia 的数据。以天为单位记录每位患者的观测生存时间，以及事件指示符的值，如果患者死亡，则为 1，如果患者在研究期结束时还活着，则为 0. 本例中使用的预后变量涉及疾病组、患者和骨髓供体的年龄、表示血小板计数是否恢复到正常水平 (40 × 109/L) 的指示变量以及恢复到该值的经历的时间。两名患者（7 号和 21 号）在血小板计数恢复正常之前死亡，因此对于这些患者，没有给出血小板计数恢复正常的时间。因此记录的变量如下：\\(Time\\)：生存时间（天）\\(Status\\)：事件指示符（0 = 删失，1 = 事件）\\(Group\\)：疾病组（1 = ，2 = 低风险 AML，3 = 高风险 AML）\\(Page\\)：患者年龄\\(Dage\\)：供体年龄\\(Precovery\\)：血小板恢复指示符（0 = ，1 = yes）\\(Ptime\\)：血小板恢复到正常水平的时间（天）（如果 \\(Precovery=1\\)）表 8.2 给出了本例使用的数据。\n分析这些数据旨在检查调整预后变量后，三个疾病组患者的生存时间是否存在差异。为了研究血小板恢复到正常水平所需的时间对患者生存的影响，定义了一个时依变量 \\(Plate(t)\\)。当血小板尚未恢复到正常水平时，该变量在时间 \\(t\\) 取值为零，一旦恢复到正常水平，则变为一。正式地说，\\[\\left.Plate(t)=\\left\\{\\begin{array}{ll}0&\\text{}t<\\text{血小板恢复正常的时间},\\\\1&\\text{}t\\geqslant\\text{血小板恢复正常的时间}\\end{array}\\right.\\right.\\]因此，当患者在血小板恢复之前死亡，对于所有 \\(t\\)，\\(Plate(t) = 0\\)。我们首先拟合 Cox 比例风险模型，其中包含与患者和供体年龄相关的变量 \\(Page\\) 和 \\(Dage\\) 。当这两个变量中的任何一个单独添加或在另一个变量存在的情况下添加时，\\(−2\\log \\hat L\\) 统计量的值并没有显著减小。时依变量 \\(Plate(t)\\) 现在添加到零模型中。\\(−2\\log \\hat L\\) 的值从 67.13 降低为 62.21，在一个自由度上降低了 4.92，这在 5% 的水平上是显著的（\\(P=0.026\\)）。这表明血小板恢复的时间确实会影响生存。考虑到该变量的效应后，仍然没有证据表明死亡风险取决于患者或供体的年龄。在仅包含变量 \\(Plate(t)\\) 的模型中，Plate(t) 的系数估计为 -2.696，该系数为负值的这一事实表明，对于血小板水平不正常的患者，在任何给定时间都有更大的死亡风险。任何给定时间的风险比为 \\(\\exp(-2.696)=0.067\\)，因此，如果患者在某个时间点血小板恢复正常，则其在该时间点的死亡风险大约是血小板水平未恢复正常的十五分之一。然而，相应真实风险比的 95% 置信区间为 \\((0.006, 0.751)\\)，这表明相对风险的点估计 相当不精确。为了量化疾病组对生存的效应，当将因素 \\(Group\\) 添加到包含时依变量 \\(Plate(t)\\) 的模型中时，在两个自由度上，\\(−2\\log \\hat L\\) 的变化为 6.49，这在 5% 的水平上是显著的（\\(P=0.039\\)）。与疾病组相关的参数估计表明，患者和高风险 AML 患者的死亡风险要大得多。患者相对于低风险 AML 患者的风险比为 7.97，高风险 AML 患者相对于低风险 AML 患者的风险比为 11.77.对于包含因素 \\(Group\\) 和时依变量 \\(Plate(t)\\) 的模型，表 8.3 给出了基线累积风险和生存函数估计。这些是使用式 (8.3) 中给出的基线累积风险函数估计获得的。\n在该表中，\\(\\tilde H_0(t)\\) 和 \\(\\tilde S0(t)\\) 是患有 并且血小板恢复指标 \\(Plate(t)\\) 在整个研究过程中保持零值的患者的累积风险函数和生存函数估计。该表中还给出了患有 且对于所有 \\(t\\) 值 \\(Plate(t)=1\\) 的个体的生存函数估计，表示为 \\(\\tilde S_1(t)\\)。由于在研究开始时，所有患者的 \\(Plate(t)\\) 值为零，而对于大多数患者来说，这种变化在稍后的某个时间点变为一，这两个生存函数估计说明了在任何特定时间血小板恢复的效应。例如，如果 患者的血小板在第 97 天仍未恢复到正常水平，那么他们存活超过 97 天的概率仅为 0.52. 相反，如果其他情况相同的患者此时已经血小板水平已恢复正常，他们的生存概率估计为 0.94. 血小板恢复状态在某个时间 \\(t_0\\) 从 0 变为 1 的 患者的生存函数估计也可以从表 8.3 中获得，因为对于 \\(t\\leqslant t_0\\)，这就是 \\(\\tilde S_0(t)\\)，对于 \\(t>t_0\\) 则为 \\(\\tilde S_1(t)\\)。还可以获得其他疾病组中个体的生存函数估计。在本示例中，有两名患者（患者 7 和 21）的数据对血小板恢复效应的推断产生了重大影响，他们在血小板计数达到正常水平之前死亡。因为，如果从数据集中省略了他们的观测，当时依变量纳入零模型时，时依变量不再显著（\\(P=0.755\\)）。因此，关于血小板恢复时间对生存的影响的结论受到这两名患者数据的显著影响。示例 8.3  (卵巢癌患者的化疗) 再次考虑第 5 章示例 5.11 中给出的卵巢癌患者生存数据。当为癌症患者生存时间数据拟合包含变量 \\(Age\\)（时间起点时患者的年龄）和治疗组 \\(Treat\\) 的 Cox 比例风险模型时，研究中第 \\(\\) 名（共 26 名）的风险函数估计为\\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{0.147\\text{ }Age_i-0.796\\text{ }Treat_i\\}h_0(t)\\end{aligned}\\]该模型 \\(−2\\log \\hat L\\) 统计量的值为 54.148.我们现在拟合包含 \\(Age,Treat\\) 和一个具有时变系数的 \\(Age\\) 项。这将由时依变量 \\(Tage\\) 表示，其值由 Age 和生存时间 \\(t\\) 的乘积形成，即 \\(Tage=Age\\times t\\)。由于 \\(Tage\\) 依赖于时间 \\(t\\)，该时依变量不能以与 \\(Age,Treat\\) 一样的方式进行拟合，如 8.1.1 节所解释的。当 \\(Tage\\) 添加到模型中时，拟合的风险函数变为\\[\\begin{aligned}\\hat{h}_i(t)&=\\exp\\{0.216\\text{ }Age_i-0.664\\text{ }Treat_i-0.0002\\text{ }Age_it\\}h_0(t)\\end{aligned}\\]在此模型下，给定年龄的患者在接受联合治疗（\\(Treat=2\\)）时的死亡风险，相对于单一治疗（\\(Tret=1\\)）中相同年龄的患者，为 \\(\\exp(-0.664)=0.52\\)，与使用不包含变量 \\(Tage\\) 的模型得出的 0.45 的值没有太大差异。然而，\\(a_2\\) 岁的患者相对于 \\(a_1\\) 岁患者在时间 \\(t\\) 处的对数风险比为\\[\\begin{aligned}0.216(a_2-a_1)-0.0002(a_2-a_1)t\\end{aligned}\\]因此，该模型允许年龄的对数风险比与生存时间线性相关。包含 \\(Age,Treat\\) 和 \\(Tage\\) 的模型的 \\(−2\\log \\hat L\\) 值为 53.613. 因此，在将变量 \\(Tage\\) 纳入包含 \\(Age\\) 和 \\(Treat\\) 的模型中时，\\(−2\\log \\hat L\\) 的变化为 0.53，这并不显著（\\(P=0.465\\)）。因此，我们得出结论，模型中实际上不需要时依变量 \\(Tage\\)，因此年龄效应不取决于时间。示例 8.4  (肝硬化研究数据) 尽管在这个例子中使用的数据是人造的，但提供一个背景以考虑这些数据是有用的。因此，假设有 12 名患者被招募到一项关于肝硬化治疗的研究中。患者被随机分配为接受安慰剂或一种称为 Liverol 的新疗法。六名患者被分配到 Liverol 组，六名患者被分配到安慰剂组。患者参加研究时，将记录其年龄和基线胆红素 (bilirubin) 水平。在本分析中，将使用胆红素 (µmol/l) 的自然对数值，下面总结了测量的变量\\(Time\\)：患者的生存时间（天）\\(Status\\)：事件指示符（0 = 删失，1 = 未删失）\\(Treat\\)：治疗组（0 = 安慰剂，1 = Liverol）\\(Age\\)：患者年龄\\(Lbr\\)：胆红素水平的对数这些变量的值列于表 8.4.\n患者应在开始治疗后三个月、六个月和十二个月返回诊所，此后每年返回一次。在这些时间点再次测量并记录胆红素水平。因此，可以获得有关在整个研究期间每位患者的胆红素水平如何变化的数据。表 8.5 给出了每位患者随访期内每次胆红素的对数值 log(bilirubin).\n将 log(bilirubin) 视为时依变量时，变量的值是每位患者最近一次随访时记录的值。在此计算中，假定在获取新值读数后立即更改为新值，例如对于患者 1 的 log(bilirubin) 值，当 \\(t\\leqslant 3.4\\) 时为 3.2，当 \\(47 < t \\leqslant 184\\) 为 3.8，当 \\(184 < t \\leqslant 251\\) 为 4.9，当 \\(251 < t \\leqslant 281\\) 为 5.0. 那么，给定个体的 \\(Lbr\\) 值为阶跃函数，并假定其值在任意两个时间点之间保持恒定。首先单独使用基线 log(bilirubin) 值对数据进行分析。使用 Cox 比例风险模型，拟合特定模型的 \\(−2\\log \\hat L\\) 值如表 8.6 所示。\n模型中似乎需要 \\(Age\\) 和 \\(Lbr\\)，尽管包括 \\(Age\\) 和 \\(Lbr\\) 的证据不是很有力。当 \\(Treat\\) 纳入包含 \\(Age\\) 和 \\(Lbr\\) 的模型中时，\\(−2\\log \\hat L\\) 的值在一个自由度上减小了 5.182. 这在 5% 的水平上是显著的（\\(P=0.023\\)）。\\(Treat\\) 的系数为 −3.052，表明药物 Liverol 在降低死亡风险方面是有效的。事实上，在其他条件相同的情况下，Liverol 将死亡风险降低了 0.047 倍。我们现在将 log(bilirubin) 值视为时依的。令 \\(Lbrt\\) 为由 log(bilirubin) 值形成的时依变量。表 8.7 中给出了为数据拟合 Cox 回归模型的 \\(−2\\log \\hat L\\) 值。\n从该表可以清楚地看出，风险函数取决于时依变量 \\(Lbrt\\)，考虑到这一点后，\\(Age\\) 的效应很小。因此，我们将治疗效应 \\(Treat\\) 添加到仅包含 \\(Lbert\\) 的模型中。这样做的效果是将 \\(−2\\log \\hat L\\) 从 12.050 减小为 10.676，在一个自由度上减小了 1.374. 这种减小并不显著（\\(P=0.241\\)），这得到了这样的结论：在考虑了死亡风险对 log(bilirubin) 值发展的依赖性后，没有明显的治疗效应。第 \\(\\) 个个体的风险函数估计由下式给出\\[\\begin{aligned}\\hat h_i(t)=\\exp\\{3.605\\text{ }Lbr_i(t)-1.479\\text{ }Treat_i\\}h_0(t)\\end{aligned}\\]其中 \\(Lbr_i(t)\\) 是该患者在时间 \\(t\\) 的 log(bilirubin) 值。对于接受相同治疗且 \\(Lbr\\) 值在 \\(t\\) 时相差 0.1 个单位的两个个体，在时间 \\(t\\) 时死亡风险比的估计为 \\(e^{0.3605}=1.43\\)。这意味着 log(bilirubin) 值大 0.1 个单位的个体在时间 \\(t\\) 时的死亡风险增加了近 50%.对于这两种分析结果之间的差异，一种可能的解释是治疗能改变胆红素水平的值，因此在考虑到这些值随时间的变化后，看不到治疗效应现在可以为包含时依变量 \\(Lbrt\\) 和 \\(Treat\\) 的模型估计基线累积风险函数。该函数的估计如表 8.8 所示\n该表显示，累积风险函数以非线性方式增加，这表明基线风险不是恒定的，而是随着时间的推移而增加。可以从该估计中获得相应的基线生存函数。然而，\\(Lbrt\\) 恒为 0 的模型很难解释，因此为 \\(Lbrt = 3\\) 的个体获得生存函数估计。该函数如图 8.5 所示。该图清晰地表明，服用安慰剂的患者的预后比服用 Liverol 的患者差得多。\n最后，我们说明了如何使用式 (8.5) 给出的结果来获得从时间 \\(t\\) 到时间 \\(t+360\\) 天的条件生存概率估计。使用表 8.4 和 8.5 给出的时依变量值，第 \\(\\) 名患者在时间 \\(t\\) 的预后指数 \\(\\sum_{j=1}^p\\hat{\\beta}_jx_{ji}(t)\\) 的值，\\(=1,2,\\ldots,12\\)，可以针对 \\(t=0,360,720,1080\\) 和 \\(1440\\) 来计算。对于该计算，取 log(bilirubin) 的值为上一个随访时间记录的值。然后使用表 8.8 来获得 \\(\\tilde{H}_0(t+360)-\\tilde{H}_0(t)\\) 的值，再根据式 (8.5) 获得 \\(\\tilde{P_i}(t,t+360)\\)。这里不会给出完整的结果，但作为一个例子，患者 1 和 7 在连续 360 天的时间区间内存活的近似条件概率估计如表 8.9 所示。注意，因为这些估计是以在区间开始时还活着为条件的生存概率，所以它们不一定是时间的递减函数。这些估计再次表明，若患者在一年年初还存活，相比接受安慰剂治疗，接受 Liverol 治疗的患者生存一年的概率更大。最后，\\(1-\\tilde{P_i}(t,t+h)\\) 的值是每个区间内死亡概率的近似估计，条件是患者在开始时还活着。将所有 12 名患者的这些估计相加，得出每个区间的值分别为 0.02, 2.46, 5.64, 6.53, 3.16. 这些可以与每个区间中的观测死亡人数进行比较，后者分别为 1, 2, 3, 1 和 1. 因此，该模型有高估死亡人数的趋势，但由于数据集的规模较小，因此无法对模型的预测能力进行非常可靠的评估。","code":""},{"path":"chap8.html","id":"sec8-7","chapter":"第 8 章 时依变量","heading":"8.7 纵向数据和生存数据的联合建模","text":"在给定时间发生事件的风险以及值随时间变化的解释变量之间的关联可以通过在 Cox 回归模型中纳入时依变量来评估。在建模过程中，假设这样一个变量的值在相邻的测量时间之间是恒定的，因此将作为阶跃函数来建模。这通常是不现实的，并且由此产生的模型可能很难表示时依变量对生存时间的效应。此外，与生存模型中的基线解释变量一样，时依变量假定为没有测量误差，但这也可能是不现实的。随着时间的推移，在同一个个体身上按顺序记录的数据称为纵向数据 (longitudinal data)，而纵向变量 (logitudinal variable) 是值随时间发展的变量。纵向变量在特定时间的观测可以视为潜在连续变量的即时捕捉 (snapshots). 若干解释变量对时间的纵向依赖性的模型可以与生存时间模型相结合，以给出纵向数据和生存数据的联合模型 (joint model). 联合模型可用来考察风险函数对纵向变量变化值的依赖性。示例 8.5  (主动脉瓣置换术后的生存) 左心室壁增厚，称为左心室肥大，会导致脆弱、僵硬并失去弹性，增加患心血管疾病的风险。主动脉瓣置换旨在减少这种增厚，减少肥厚程度是一个重要目标。 Lim et al. (2008) 描述的一项研究旨在调查左心室质量的长期变化，确定可能影响这些变化的因素，并评估这些变化对患者生存的影响。这项研究涉及 256 名接受了主动脉瓣置换术的患者，使用了人或猪的无支架瓣膜。对这些患者随访了 10 年，在此期间使用连续超声心动图测量来计算左心室质量指数 (left ventricular mass index, LVMI). 记录了死亡时间，在随访期结束时仍然生存的患者视为删失生存时间。对于接受第二次手术的患者，我们在该时间点进行删失处理，以确保他们在数据集中只出现一次。本例使用的数据包含在基线测量的许多变量，以及随访期间 LVMI 的纵向测量值。数据可以在 R 的 joineR 包的数据集 heart.valve 中找到，但本例将使用记录的变量的子集，如下所示。\\(Id\\)：患者编号\\(FUtime\\)：自手术之日起的总随访时间（年）\\(Stauts\\)：事件指示符（0 = 删失，1 = 死亡）\\(Time\\)：术后测量 LVMI 的时间（年）\\(LVMI\\)：标准化左心室质量指数（LVMI）\\(Age\\)：患者年龄\\(Sex\\)：患者性别（0 = 男性，1 = 女性）\\(Redo\\)：既往心脏手术（0 = 否，1 = 是）\\(Emerg\\)：手术紧急性（0 = 非急需的，1 = 紧急的）\\(DM\\)：术前糖尿病（0 = 否，1 = 是）\\(Type\\)：瓣膜类型（1 = 人体组织，2 = 猪组织）前五名患者的数据如表 8.10 所示。LVMI 和时间之间的关系可以通过绘制 LVMI 关于时间的图形来可视化，以给出每个患者的响应曲线 (response profiles). 图 8.6 显示了所有 256 名患者的响应曲线。\n很难从这个图形中看出任何总体趋势，但可能有迹象表明，随着时间的推移，该指数的值最初会下降。下一步是对 LVMI 对时间的依赖性进行建模，以总结响应曲线。","code":""},{"path":"chap8.html","id":"sec8-7-1","chapter":"第 8 章 时依变量","heading":"8.7.1 纵向建模","text":"本节描述了纵向变量测量值与时间之间关系的可能模型，以供随后在纵向数据和生存数据的联合模型中使用。必须考虑的特殊特征包括同一个体连续测量纵向变量之间的相关性、个体间任何关系形式的变异，以及纵向变量记录值中的随机测量误差。纵向变量与时间之间关系的最简单的模型是直线关系，其中斜率和截距因个体而异。那么，随着时间的推移，每个个体都有自己的预期响应曲线，并且在这些单独的曲线之间存在关于总体平均相应的变异。假设在 \\(n_i\\) 个连续时间 \\(t_{i1},t_{i2},\\ldots,t_{,n_i}\\)，获得了第 \\(\\) 个个体（共 \\(n\\) 个）的纵向变量 \\(Y\\) 的值 \\(y_{ij}\\)，\\(j = 1,2,\\ldots,n_i,= 1,2,\\ldots,n\\)，其中 \\(y_{ij}\\) 可表示为\\[\\begin{align}\ny_{ij}=\\beta_{0i}+\\beta_{1i}t_{ij}+\\epsilon_{ij}\n\\tag{8.6}\n\\end{align}\\]在该模型中，直线关系具有不同的截距 \\(\\beta_{01},\\beta_{02},\\ldots,\\beta_{0n}\\)，以及不同的斜率 \\(\\beta_{11},\\beta_{12},\\ldots,\\beta_{1n}\\)，这些对应于 \\(n\\) 个个体。式 (8.6) 中的量 \\(\\varepsilon_{ij}\\) 是一个残差项，它总结了 \\(y_{ij}\\) 与假设的直线模型的偏差，并可以表示测量误差。目前，假设每个个体的截距和斜率具有固定值，称为固定效应 (fixed effects). 在该线性回归模型中，\\(y_{ij}\\) 的期望为 \\(\\operatorname{E}\\left(y_{ij}\\right)=\\beta_{0{}}+\\beta_{1{}}t_{{j}}\\)，并且通常假设 \\(\\epsilon_{ij}\\) 独立，每个都具有均值为零和方差为 \\(\\sigma^2\\) 的正态分布。示例 8.6  (主动脉瓣置换术后的生存) 假设在示例 8.5 描述的主动脉瓣置换研究中，左心室质量指数 (LVMI) 与时间之间的关联，是使用 256 个不同的线性关系进行建模的，每个对应于一个患者。第 \\(\\) 名患者在时间 \\(t_{ij}\\) 的 LVMI 期望值为 \\(\\beta_{0i}+\\beta_{1i}t_{ij}\\)，即，斜率和截距在患者之间有变异。当至少获得了两个不同时间的数据时，该线性回归模型可以拟合每个患者不同时间的 LVMI 值的数据。图 8.7 绘制了本研究中 256 名患者的拟合关系。\n该图有时称为意大利面条图 (spaghetti plot)，表明患者的拟合直线之间存在明显差异。直线斜率因患者而异。总体线性回归模型在时间 \\(t\\) 的期望值为 \\(162.126-0.701t\\)，尽管这种关系总体呈下降趋势，表明 LVMI 随着时间的推移而下降，但斜率与零没有显著差异（\\(P=0.41\\)）。式 (8.6) 的模型一个明显的缺点是可能有大量的参数需要估计。例如，在主动脉瓣置换术的数据中，有 256 个单独的截距和 256 个单独的斜率，还有 \\(\\varepsilon_{ij}\\) 的方差。此外，该模型假定患者内观测 (observations patient) 是独立的，但事实并非如此。考虑到这一点，现假设每个个体的截距和斜率都是从可能值的总体中随机抽取的，其中该总体由一个概率分布来总结。如此模型种的截距和斜率就是随机效应 (random effects). 第 10 章描述了包含随机效应的生存数据模型，称为脆弱模型 (frailty models)，该章 10.1 节包含随机效应性质的进一步细节。现在我们假设 \\(n\\) 个个体的截距 \\(\\beta_{0i}\\) 和斜率 \\(\\beta_{1i}, = 1, 2,...,n\\) 是正态分布随机变量。然后，假定截距 \\(\\beta_{0i}\\) 是来自均值为 \\(\\beta_{0}\\) 和方差为 \\(\\sigma^2_0\\) 的正态分布的随机样本，记作 \\(N(\\beta_0, \\sigma^2_0)\\)，类似地，假定斜率 \\(\\beta_{1i}\\) 是从 \\(N(\\beta_1, \\sigma^2_1)\\) 分布中随机抽取的。截距和斜率的潜在分布可认为是独立的，尽管这个假设可以放宽。随机效应的均值 \\(\\beta_0\\) 和 \\(\\beta_1\\) 对应于所有个体的平均截距和斜率，有时称为总体值 (population values).在制定随机效应模型时，使用零均值正态分布更为方便，因此我们设 \\(\\beta_{0i}=\\beta_{0}+u_{0i}\\) 以及 \\(\\beta_{1i}=\\beta_{1}+u_{1i}\\)，其中 \\(u_{0i}\\) 和 \\(u_{1i}\\) 具有独立的正态分布，均值都为零，方差分别为 \\(\\sigma^2_0\\) 和 \\(\\sigma^2_1\\)。式 (8.6) 中的模型则变为\\[\\begin{align}\n{y_{ij}}&=(\\beta_0+u_{0i})+(\\beta_1+u_{1i})t_{ij}+\\epsilon_{ij}\\\\\n&=\\left.\\beta_0+\\beta_1t_{ij}+u_{0i}+u_{1i}t_{ij}+\\epsilon_{ij}\\right.\n\\tag{8.7}\n\\end{align}\\]通过将截距和斜率视为随机变量，对同一个体的观测将不再是独立的。要认识到这一点，请考虑第 \\(\\) 个个体在 \\(t_{ij}\\) 和 \\(t_{ij'}\\) 时刻的纵向响应变量 \\(Y\\) 值之间的协方差（其中 \\(j\\ne j'\\)），这定义为\\[\\begin{aligned}\\mathrm{cov}\\left(y_{ij},y_{ij'}\\right)=\\text{ E}\\left[\\left(y_{ij}-\\text{ E}(y_{ij})\\right)\\left(y_{ij'}-\\text{ E}(y_{ij'})\\right)\\right]\\end{aligned}\\]现在，\\(\\operatorname{E}\\left(y_{ij}\\right)=\\beta_0+\\beta_1t_{ij}\\)，因此 \\(y_{ij}-\\text{E}\\left(y_{ij}\\right)=u_{0i}+u_{1i}t_{ij}+\\epsilon_{ij}\\)，对于 \\(\\mathrm{E}\\left(y_{ij^{\\prime}}\\right)\\) 也类似，因此协方差为\\[\\begin{aligned}\\text{cov}\\left(y_{ij},y_{ij'}\\right)=\\text{E}\\left[(u_{0i}+u_{1i}t_{ij}+\\epsilon_{ij})(u_{0i}+u_{1i}t_{ij'}+\\epsilon_{ij'})\\right]\\end{aligned}\\]展开此乘积，并利用 \\(u_{0i}\\) 与 \\(u_{1i}\\) 的独立性，即 \\(\\text{cov}\\left(u_{01},u_{1i}\\right)=\\text{ E}\\left(u_{0i}u_{1i}\\right)=0\\)，我们得到\\[\\mathrm{cov}\\left(y_{ij},y_{ij'}\\right)=\\text{ E}\\left(u_{0i}^2\\right)+\\text{ E}\\left(u_{1i}^2\\right)t_{ij}t_{ij'}\\]由于 \\(\\mathrm{E}\\left(u_{0{}}\\right)=0\\) 以及 \\(\\operatorname{E}\\left(u_{1i}\\right)=0,\\operatorname{E}\\left(u_{0i}^2\\right)=\\operatorname{var}\\left(u_{0i}\\right)=\\sigma_{0}^2\\)，类似地有 \\(\\mathrm{E}\\left(u_{1i}^2\\right)=\\sigma_1^2\\)，因此协方差成为\\[\\sigma_0^2+\\sigma_1^2t_{ij}t_{ij^{\\prime}}\\]\\(y_{ij}\\) 和 \\(y_{ij'}\\) 之间的相关系数等于协方差除以下式\\[√\\{\\text{ var }(y_{ij})\\operatorname{var}(y_{ij^{\\prime}})\\}=√\\{(\\sigma_0^2+\\sigma_1^2t_{ij}^2+\\sigma_\\epsilon^2)(\\sigma_0^2+\\sigma_1^2t_{ij^{\\prime}}^2+\\sigma_\\epsilon^2)\\}\\]这意味着，具有随机截距和随机斜率的模型为个体内任何一对观测引入了相关性，该相关性取决于随机效应的方差以及两次观测的时间。此外，纵向变量的方差随着时间的推移而增加，两次测量之间的相关性随着测量时间 \\(t_{ij}\\) 和 \\(t_{ij'}\\) 之间距离的增加而减小。通常，在随机效应模型中，个体的截距和斜率之间存在某种关联。例如，具有较大纵向变量初始值的人，该变量的值可能会随着时间的推移而急剧下降。这可以通过允许式 (8.7) 模型中每个个体的随机截距和斜率具有相关性 \\(\\rho\\) 来实现，即 \\(\\mathrm{cov}\\left(u_{0i},u_{1i}\\right)=\\rho\\sigma_{0}\\sigma_{1}\\)。第 \\(\\) 个个体的随机效应向量 \\(\\boldsymbol{u}_i=(u_{0i},u_{1i})'\\) 具有均值为零、方差-协方差阵为 \\(\\boldsymbol V\\) 的二元正态分布，其中 \\(\\boldsymbol V\\) 由下式给出\\[\\left.\\boldsymbol{V}=\\left(\\begin{array}{cc}\\sigma_0^2&\\rho\\sigma_0\\sigma_1\\\\\\rho\\sigma_0\\sigma_1&\\sigma_1^2\\end{array}\\right.\\right)\\]这为纵向变量在不同时间 \\(t_{ij}\\) 和 \\(t_{ij'}\\) 下观测值间的协方差表达式添加了一个额外项，因为 \\(\\text{cov}\\left(u_{01},u_{1i}\\right)=\\text{ E}\\left(u_{0i}u_{1i}\\right)=0\\) 不再为零。式 (8.7) 中的纵向模型也可以扩展，其中纳入了作为固定效应的基线变量，即\\[\\begin{align}\ny_{ij}=\\boldsymbol{\\beta'x}_i+\\beta_0+\\beta_1t_{ij}+u_{0i}+u_{1i}t_{ij}+\\epsilon_{ij}\n\\tag{8.8}\n\\end{align}\\]其中 \\(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\) 是第 \\(\\) 个个体基线解释变量值的线性组合。这是一个一般线性混合模型 (general linear mixed model)，其中 \\(y_{ij}\\) 是从具有正态分布中观测到的，其均值为 \\(\\boldsymbol{\\beta'x}_i+\\beta_0+\\beta_1t_{ij}\\)，方差为\\[\\sigma_0^2+\\sigma_1^2t_{ij}^2+\\sigma_\\epsilon^2+2\\rho\\sigma_0\\sigma_1t_{ij}\\]此外，\\(y_{ij}\\) 本身是相关的，并且第 \\(\\) 个个体 \\(n_i\\) 个观测的值向量 \\(\\boldsymbol y_i\\) 具有多元正态分布 (multivariate normal distribution).纵向变量可以视为 \\(t\\) 的连续函数，在特定时间点对变量的值进行观测，因此可以用 \\(Y(t)\\) 表示。式 (8.7) 中关于 \\(y_{ij}\\) 的模型，即第 \\(\\) 个个体在第 \\(j\\) 个时间 \\(t_{ij}\\) 的纵向变量 \\(Y(t)\\) 观测值的模型，可以表示为潜在纵向过程的模型，其中第 \\(\\) 个个体在时间 \\(t\\) 的 \\(Y(t)\\) 观测值为 \\(y_i(t)\\)。那么可以编写 \\(y_i(t)\\) 的相应线性模型\\[\\begin{align}\ny_i(t)=m_i(t)+\\epsilon_i(t)\n\\tag{8.9}\n\\end{align}\\]其中 \\(m_i(t)=\\beta_0+\\beta_1t+u_{0i}+u_{1i}t\\) 是描述第 \\(\\) 个个体 \\(y_i(t)\\) 值轨迹的真实潜在响应曲线，而 \\(\\epsilon_{}(t)\\) 是在时间 \\(t\\) 处的随机误差项。在式 (8.9) 的模型下，纵向变量的期望值是 \\(\\beta_{0}+\\beta_{1}t\\)。在纵向和生存数据的联合模型中，真实响应曲线 \\(m_i(t)\\) 用于表示纵向变量与时间之间的关系。示例 8.7  (主动脉瓣置换术后的生存) 现在采用具有随机截距和随机斜率的线性模型对示例 8.5 的数据中的纵向变量 LVMI 与时间之间的关系进行建模。时间 \\(t\\) 处的 LVMI 将表示为 \\(Y(t)\\)，并且时间 \\(t\\) 处第 \\(\\) 个患者的指数观测值如式 (8.9) 所示。这里，\\(m_i(t)=\\beta_0+\\beta_1t+u_{0i}+u_{1i}t\\) 是指数在时间 \\(t\\) 的真值，并假定 \\(u_{0i},u_{1i}\\) 是独立的正态随机变量，均值都为零，方差分别为 \\(\\sigma_0^2,\\sigma_1^2\\)。残差项 \\(\\epsilon_{}(t)\\) 是 LVMI 的观测值与真实值之差，并且假定其具有 \\(N(0,\\sigma_\\epsilon^2)\\) 分布。拟合该模型后，\\(\\hat{\\beta}_0=164.46\\) 和 \\(\\hat{\\beta}_1=-1.66\\)，因此 LVMI 在时间 \\(t\\) 处的总体期望值为 \\(164.46−1.66 t\\)。与式 (8.6) 中的固定效应模型相比，斜率估计现在在 5% 的水平上几乎是显著的（\\(P=0.060\\)）。截距和斜率的方差估计分别为 \\(\\hat{\\sigma}_0^2=3881.91\\) 和 \\(\\hat{\\sigma}_1^2=61.39\\)，因此 \\(\\beta_0\\) 和 \\(\\beta_1\\) 的相应 95% 区间估计分别为 \\((42.34,286.58)\\) 和 \\((−17.02,13.70)\\)。因此，我们预期这些区间将包括研究中 256 名患者的大部分斜率和截距估计。在拟合具有随机效应的纵向模型后，可以估计每个个体的截距和斜率，从而获得个体响应曲线。研究中 256 名患者的 LVMI 与时间之间的线性关系如图 8.8 所示。\n与图 8.7 相比，我们发现拟合线的斜率不是很极端。拟合过程使斜率向零收缩3。这是随机效应模型的一个众所周知的特征，原因在于斜率假定为正态分布，这意味着出现极端值的可能性更小。各斜率现在更接近整体平均斜率，更极端的斜率向零收缩得更多。研究开始时测量的其他变量也可以纳入随机效应模型，如式 (8.8) 中的模型所示。当模型中包含基线变量 \\(Age, Sex, Redo, Emerg, DM\\) 和 \\(Type\\) 时，只有 \\(Sex\\) 的效应非常显著（\\(P = 0.0008\\)），女性患者的 LVMI 值显著较低。在允许随机效应模型中的截距依赖于这些基线测量值后，时间效应变得更为显著（\\(P = 0.045\\)）。","code":""},{"path":"chap8.html","id":"sec8-7-2","chapter":"第 8 章 时依变量","heading":"8.7.2 联合模型","text":"生存时间与纵向变量 \\(Y(t)\\) 之间的依赖关系可以通过将观测值 \\(y_i(t)\\) 简单地添加到 Cox 回归模型中来进行建模，该模型用于描述第 \\(\\) 个个体在时间 \\(t\\) 发生事件的风险。在该模型中，\\(Y(t)\\) 拟合为时依变量，使用了本章 8.2 节中描述的方法。然而，为了正确考虑 \\(Y(t)\\) 与时间之间的关系，需要建立一个纵向变量和生存时间的联合模型。在对纵向响应变量随时间的发展进行建模时，式 (8.9) 中的响应曲线 \\(m_i(t)\\) 用于描述第 \\(\\) 个个体的这种关系。为了形成联合模型，将 \\(m_i(t)\\) 添加到时间 \\(t\\) 发生事件的风险模型中，其系数总结了时间 \\(t\\) 的风险与 \\(m_i(t)\\) 之间的关联。可以使用风险函数的半参数或全参数模型。第 \\(\\) 个个体的风险函数 \\(h_i(t)\\) 可以建模为\\[\\begin{align}\nh_i(t)=\\exp\\{\\boldsymbol{\\beta'x}_i+\\alpha m_i(t)\\}h_0(t)\n\\tag{8.10}\n\\end{align}\\]其中 \\(\\boldsymbol x_i\\) 是系数为 \\(\\boldsymbol \\beta\\) 的基线解释变量向量，\\(h_0(t)\\) 是基线风险函数。该模型显示了在时间 \\(t\\) 发生事件的风险如何取决于 \\(m_i(t)\\) 的值，即当时响应曲线的值。在该模型中，参数 \\(\\alpha\\) 是纵向变量值与时间 \\(t\\) 处事件风险之间关联性的度量。该参数可以解释为当 \\(m_i(t)\\)（第 \\(\\) 个个体的纵向变量在时间 \\(t\\) 处的真实值）增加一个单位，在时间 \\(t\\) 发生事件的调整的对数风险比。对于式 (8.10) 中的模型，第 \\(\\) 个个体在时间 \\(t\\) 对应的生存函数为\\[\\begin{align}\nS_i(t)=\\exp\\left\\{-\\int_0^th_i(v)\\mathrm{d}v\\right\\}=\\exp\\left\\{-\\int_0^t\\exp\\{\\boldsymbol{\\beta'x}_i+\\alpha m_i(v)\\}h_0(v)\\mathrm{d}v\\right\\}\n\\tag{8.11}\n\\end{align}\\]需要利用此式来构建生存模型的似然函数。为了计算该表达式中的积分，始终需要 \\(m_i(t)\\) 直到时间 \\(t\\) 的值。式 (8.10) 中的模型可以通过最大化联合似然 (joint likelihood) 来拟合，这是通过纵向变量和生存时间的模型导出的。这使得能够同时估计联合模型两个部分中的参数。概括地说，模型纵向部分的似然是从第 \\(\\) 个个体 \\(n_i\\) 个纵向观测值 \\(\\boldsymbol y_i\\) 的联合分布中获得的。如果将相应的随机效应向量 \\(\\boldsymbol u_i\\) 视为固定的，那么 \\(\\boldsymbol y_i\\) 将具有一个多元正态分布，该分布是 \\(\\boldsymbol u_i\\) 和模型参数向量 \\(\\boldsymbol \\phi\\) 的函数。这里，\\(\\boldsymbol \\phi\\) 包括纵向模型中解释变量的系数（包括截距和与时间变量相关的项的系数），以及残差项的方差 \\(\\sigma_\\epsilon^2\\)。第 \\(\\) 个个体相应的似然函数表示为 \\(L_L(\\boldsymbol{\\phi}_L,\\boldsymbol{u}_i)\\)。根据第 5 章的式 (5.15)，第 \\(\\) 个个体生存时间 \\(t_i\\) 的似然函数为\\[h_i(t_i)^{\\delta_i}S_i(t_i)\\]其中 \\(\\delta_i\\) 是事件指示符。第 \\(\\) 个个体的风险和生存函数可以根据式 (8.10) 和 (8.11) 得出。再次将 \\(\\boldsymbol u_i\\) 视为固定的，将该似然表示为 \\(L_S(\\boldsymbol{\\phi}_S,\\boldsymbol{u}_i)\\)，其中 \\(\\boldsymbol{\\phi}_S\\) 是模型的参数向量。这包括生存模型中的解释变量系数、\\(m_i(t)\\) 的系数 \\(\\alpha\\) 以及基线风险函数中的任何未知参数。第 \\(\\) 个个体的联合似然是两个似然函数 \\(L_L(\\boldsymbol{\\phi}_L,\\boldsymbol{u}_i)\\) 和 \\(L_S(\\boldsymbol{\\phi}_S,\\boldsymbol{u}_i)\\) 的乘积。现在，\\(\\boldsymbol u_i\\) 的分量是随机量，因此，我们需要对其概率分布进行积分，对所有可能的随机效应值求平均来得到这个联合似然函数。\\(\\boldsymbol u_i\\) 的联合密度函数记作 \\(f(\\boldsymbol{u}_i;\\boldsymbol{\\phi}_U)\\)，且 \\(\\boldsymbol u_i\\) 具有多元正态分布，均值为零，方差-协方差阵取决于向量 \\(\\boldsymbol{\\phi}_U\\)，其中包含了 \\(\\boldsymbol u_i\\) 各分量的方差和协方差4。那么 \\(n\\) 个个体的集成似然函数 (integrated likelihood function) 为\\[\\begin{aligned}\\prod_{=1}^n\\int_{-\\infty}^\\infty L_L(\\boldsymbol{\\phi}_L,\\boldsymbol{u}_i)L_S(\\boldsymbol{\\phi}_S,\\boldsymbol{u}_i)f(\\boldsymbol{u}_i;\\boldsymbol{\\phi}_U)\\mathrm{d}\\boldsymbol{u}_i\\end{aligned}\\]然后，通过最大化该函数的对数来得到未知模型参数的估计，这当然只能通过数值算法来实现。估计值的标准误可从信息矩阵中找到，如附录 所述。在纵向或生存部分 (longitudinal survival components) 中具有不同解释变量集的嵌套模型可按通常方式使用 \\(-2\\log \\hat L\\) 统计量进行比较，而具有不同基线风险函数公式的非嵌套模型可使用 AIC 统计量进行比较。示例 8.8  (主动脉瓣置换术后的生存) 现在将联合模型应用示例 8.5 中的数据，该模型包含了接受心脏瓣膜置换术患者的死亡时间与左心室质量指数 (LVMI) 之间的依赖关系。最初，用于纵向变量 LVMI 的模型以及用于死亡风险的生存模型都将包含所有六个基线变量，即 \\(Age, Sex, Redo, Emerg, DM\\) 和 \\(Type\\)。LVMI 的纵向变量将通过使用指数和测量时间之间的直线关系进行建模，每个患者的随机截距和斜率可以是相关的。首先，如第 6 章 6.1 节所述，在联合模型中使用 Cox 回归模型，拟合为分段指数模型，而不是使用偏似然方法。该联合模型中的参数估计及其标准误如表 8.11 所示。\n在纵向变量模型中，对 LVMI 有显著影响的唯一基线变量是性别（\\(P < 0.001\\)）和术前糖尿病（\\(P = 0.081\\)）。平均而言，女性患者的指数值显著低于男性，且术前患有糖尿病的患者指数值更低。有轻微证据表明 LVMI 随着时间的推移而降低（\\(P = 0.136\\)）。在生存模型中，年龄每增加一岁，死亡风险就会增加 11%（\\(P < 0.001\\)），但在基线测量的其他变量均不会显著影响患者的生存。给定时间的 LVMI 真实值与当时的死亡风险之间存在显著关联（\\(P=0.001\\)），这是通过联合模型中参数 \\(\\alpha\\) 的估计来测量的。给定时间 LVMI 真实值增加 100 会导致该时间的死亡风险增加 \\(\\exp(100\\hat{\\alpha})=2.30\\)。从 \\(u_{0i}\\) 和 \\(u_{1i}\\) 的方差估计来看，即使考虑到基线变量造成的差异，截距之间也存在相当大的变异。斜率之间的变异不那么明显，并且远小于由测量误差导致的 LVMI 值的变异。在随机截距和斜率在个体内独立的模型中5，\\(-2\\log\\hat{L}\\) 统计量的值为 11094，这远大于表 8.11 中的 11069，这表明这些项确实是相关的。从表 8.11 中可以看出，随机截距和斜率之间存在负相关，其值约为 -0.6，因此最初指数值较高的患者的 LVMI 下降得更快。风险函数的 Cox 回归模型在每个事件时间本质上都有一个未知参数来描述基线风险函数。如第 6 章 6.1 节所述，通过指定分割点的数量或位置来限制分割点的数目，可以找到一个更简约的模型。为了便于说明，将拟合具有五个分割点的分段模型，结果也在表 8.11 中给出。所得参数估计及其标准误差，以及方差分量估计，与使用 Cox 回归模型对联合模型的生存部分进行建模时得到的结果非常相似。全参数模型可以以类似的方式拟合，基线风险函数的 Weibull 模型拟合结果也如表 8.11 所示。该模型参数化为比例风险模型，因此基线风险函数为 \\(\\lambda\\gamma t^{\\boldsymbol{\\gamma-}1}\\)。同样，系数估计与其他两个拟合模型所得系数估计相似，但此时风险是时间的平滑函数，而不是阶跃函数。比较三个拟合模型的 \\(-2\\log\\hat{L}\\) 和 AIC 统计量的值，我们发现 Weibull 模型的 AIC 值最小。具有五个分割点的分段指数模型具有最小的\\(-2\\log\\hat{L}\\) 值，但该模型需要六个参数来指定基线风险，而 Weibull 模型只需要两个参数，因此后者 AIC 统计量的值更小。","code":""},{"path":"chap8.html","id":"sec8-7-3","chapter":"第 8 章 时依变量","heading":"8.7.3 联合模型的一些扩展","text":"有多种方法可以扩展纵向数据和生存数据的联合模型。纵向模型线性部分中的时间变量可以建模为多项式或样条项，以便捕获总体时间趋势中的非线性行为。基线测量的一个或多个因素与纵向变量之间的交互作用也可以包括在内，以允许变量真实水平的效应在不同个体组之间变化，例如不同年龄的个体组。第 6 章描述并举例说明了基于 B 样条的对数基线风险函数和基于限制性立方样条的对数累积风险函数的灵活模型。这些模型也可用于联合模型的生存部分。在式 (8.10) 给出的联合模型中，纵向变量在时间 \\(t\\) 的真实潜在值 \\(m_i(t)\\) 具有系数 \\(\\alpha\\)。该系数总结了给定时间纵向变量值与该时间发生事件的风险之间的关联。作为一个明显的扩展，\\(\\alpha\\) 可以取决于某些基线变量的值，从而开发这样的模型：纵向响应以取决于个体基线特征的方式影响生存。在式 (8.10) 的模型中，纵向变量的当前值影响事件的当前风险。这有时是不合理的，因为纵向变量达到临界值与事件实际发生之间可能存在一段时间间隔。为了适应这种情况，可以采用时间滞后 (time lagged) 纵向变量的方法，使得时间 \\(t\\) 处事件的风险取决于较早时间 \\(t−k\\) 处变量的值。所得模型为\\[\\begin{aligned}h_i(t)=\\exp\\left\\{\\boldsymbol{\\beta'x}_i+\\alpha m_i(t-k)\\right\\}h_0(t)\\end{aligned}\\]其中当 \\(t<k\\) 时使用 \\(m_i(0)\\)。纵向变量在给定时间的轨迹的斜率也可能影响当时事件的风险。轨迹在时间 \\(t\\) 处的斜率是函数 \\(m(t)\\) 关于 \\(t\\) 的导数 \\(m'(t)\\)，并且也可纳入联合模型\\[h_i(t)=\\exp\\left\\{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i+\\alpha_1m_i(t)+\\alpha_2m_i^{\\prime}(t)\\right\\}h_0(t)\\]在该模型中，\\(\\alpha_2\\) 测量 \\(t\\) 处事件的风险与纵向变量当时真实轨迹的斜率（或变化率）之间的关联，从而考虑到纵向变量值与当时的风险之间的关联。生存过程的风险函数也可以取决于截至时间 \\(t\\) 的纵向变量的历史。这可以使用截至该时间的纵向变量轨迹下面积 (area trajectory) 来总结，该面积是纵向变量的积分。时间 \\(t\\) 处事件风险的联合模型是\\[h_i(t)=\\exp\\left\\{\\boldsymbol{\\beta'x}_i+\\alpha\\int_0^tm_i(v)\\mathrm{d}v\\right\\}h_0(t)\\]现在 \\(\\alpha\\) 度量时间 \\(t\\) 处事件的风险与该时间纵向变量轨迹下面积之间的关联强度。还有许多其他可能的扩展，但纵向数据建模的完整处理超出了本书的范围。示例 8.9  (主动脉瓣置换术后的生存) 在本例中，将使用示例 8.5 中首次给出的主动脉瓣置换术后死亡时间数据来说明纵向和生存数据联合模型的一些扩展。在示例 8.8 中，发现模型的纵向和生存部分中的许多基线变量不显著。因此，在本例中我们将以一个联合模型为基础，在该模型中，纵向响应取决于患者的性别和术前糖尿病状况，而生存部分仅取决于患者年龄。第 \\(\\) 名患者 LVMI 值在时间 \\(t\\) 处的纵向模型 \\(y_i(t)\\) 可以表示为\\[\\begin{aligned}y_i(t)=m_i(t)+\\epsilon_i(t)\\end{aligned}\\]其中 \\(m_i(t)\\) 是纵向变量在时间 \\(t\\) 的真实但不可观测的值，由下式给出\\[\\begin{align}\nm_i(t)=\\beta_0+\\beta_1t+u_{0i}+u_{1i}t+\\beta_{11}s_i+\\beta_{12}d_i\n\\tag{8.12}\n\\end{align}\\]\\(s_i\\) 和 \\(d_i\\) 是第 \\(\\) 个个体基线变量 \\(Sex\\) 和 \\(DM\\) 的值，系数分别为 \\(\\beta_{11}\\) 和 \\(\\beta_{12}\\)。此外，\\(u_{0i}\\) 是分布于 \\(N(0,\\sigma_0^2)\\) 的随机截距，\\(u_{1i}\\) 是分布于 \\(N(0,\\sigma_1^2)\\) 的随机斜率。目前，我们假设每个个体的随机截距和斜率具有相关系数 \\(\\rho=\\text{corr}\\left(u_{0i},u_{1i}\\right)\\)。时间 \\(t\\) 时死亡风险的联合模型为\\[h_i(t)=\\exp\\{\\beta_{13}a_i+\\alpha m_i(t)\\}h_0(t)\\]其中 \\(a_i\\) 是第 \\(\\) 个患者的年龄，系数为 \\(\\beta_{13}\\)，\\(m_i(t)\\) 由式 (8.12) 给出，\\(h_0(t)\\) 是基线风险函数。在本示例中，将使用灵活的生存时间参数模型，其中使用三次 B 样条对基线风险函数的对数进行建模。该模型在第 6 章 6.3 节进行了描述，根据式 (6.10)，具有 \\(m\\) 个内部结的样条函数的基线风险由下式给出：\\[\\begin{align}\n\\operatorname{log}h_0(t)=\\sum_{j=1}^{m+4}\\gamma_jB_{j,3}(t)\n\\tag{8.13}\n\\end{align}\\]其中 \\(\\gamma_j\\) 是第 \\(j\\) 个立方样条基函数 \\(B_{j,3}(t)\\) 的系数，由式 (6.6) 中的递归关系定义。该基线风险函数有 \\(m+ 4\\) 个未知 \\(\\gamma\\) 参数。在拟合基线风险函数具有不断增加的内部结数的联合模型时，在事件时间的等间距百分位数上具有 \\(m = 5\\) 个结的模型具有最小的 AIC 统计量值，为 10913. 该模型中解释变量的系数与根据基线风险函数其他公式获得的系数非常相似。拟合模型所得第 \\(\\) 名患者的 LVMI 的总体估计值为\\[\\begin{aligned}\\hat{m}_i(t)=175.09-1.41t-29.64s_i-20.93d_i+\\hat{u}_{0i}+\\hat{u}_{1i}t\\end{aligned}\\]其中 \\(\\hat{u}_{0i}\\) 和 \\(\\hat{u}_{1i}\\) 是与截距和斜率相关的个体随机效应估计。联合模型的风险函数估计为\\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{0.0857a_i+0.0051\\hat{m}_i(t)\\}\\hat{h}_0(t)\\end{aligned}\\]其中，\\(\\hat h_0(t)\\) 是式 (8.13) 中基线风险函数的估计值。如表 8.11 所示，该模型 \\(\\hat m_i(t)\\) 的系数估计与示例 8.8 中其他模型的系数估计相似。LVMI 与时间之间关系的斜率可能取决于患者的性别和术前状态。添加时间和性别之间的交互作用并不能显著提高模型的拟合度（\\(P=0.75\\)），糖尿病和时间之间的交互作用也如此（\\(P=0.37\\)）。下一步是扩展纵向变量的模型，以允许其与时间建立曲线关系。例如，时间的二次函数可以包含在模型中\\[\\begin{aligned}m_i(t)=\\beta_0+\\beta_1t+\\beta_2t^2+u_{0i}+u_{1i}t+u_{2i}t^2+\\beta_{11}s_i+\\beta_{12}d_i\\end{aligned}\\]其中时间的线性和二次效应的系数是正态分布随机变量。当存在许多随机效应时，很难估计所有的协方差项，因此我们从此处开始将随机效应视为不相关的。将 \\(m_i(t)\\) 的这个二次表达式与具有五个内部结的对数基线风险函数的 B 样条模型相结合，所得 AIC 值为 10926. 这可与具有不相关随机效应的直线模型的 AIC 统计量进行比较，后者为 10934. 时间的三次函数稍微改进了拟合，AIC 值为 10920.正如第 3 章 3.8.2 节所述，多项式函数在数据范围之外可能表现不佳，而时间样条函数可能会改进拟合。这里，在此我们将对纵向变量 LVMI 使用具有 \\(k\\) 个内部结的时间的限制性立方样条函数，如此一来，样条函数在边界结之外是线性的。限制性立方样条在第 6 章 6.2.2 节进行了描述。现在我们拟合了一个联合模型，其中基线风险的对数采用 B 样条来表示，而纵向变量 LVMI 则采用时间的限制性立方样条函数来刻画6。事实证明，通过具有四个内部结的样条曲线对时间效应进行建模并不能显著提高具有三个内部结的模型的拟合度，因此采用了后者模型。对于该模型，AIC 统计量为 10885. 这比 LVMI 是时间的三次函数模型的相应 AIC 值小得多。样条曲线模型非常灵活，但很难在代数上解释。因此，我们将以图形方式比较 LVMI 与时间之间关系的一些拟合模型。图 8.9 显示了死亡风险联合模型中时间的函数估计。\n该图涉及术前没有糖尿病的男性患者，显示了 \\(m_i(t)\\) 的总体预期值估计，例如，对于二次模型，由 \\(\\hat{m}_{{}}(t)=\\hat{\\beta}_0+\\hat{\\beta}_1t+\\hat{\\beta}_2t^2\\) 给出，对于其他模型也类似。图 8.9 还显示了拟合的限制性立方样条函数的 95% 置信带估计。虽然具有相关斜率的模型中的截距略大于具有不相关斜率的模型，但具有不相关和相关随机效应的直线模型彼此非常相似。三次纵向模型比两个直线模型和二次模型拟合得更好，并且与立方样条具有相似的模式，这是尝试过的最佳拟合模型。所有拟合模型的轨迹都包含在拟合样条函数的 95% 置信带内，因此很难区分它们。然而，从拟合的样条曲线来看，在主动脉瓣置换术后的两年内，LVMI 的值确实有所下降，但此后趋于稳定或可能增加。最后，我们将考察联合模型中给定时间的死亡风险是否取决于当时 LVMI 值纵向轨迹的斜率，或是否取决于截至那时的指数累积值。与立方样条项相比，对时间的多项式函数进行微分或积分更简单，由于三次多项式的拟合与立方样条模型的拟合没有太大区别，我们将在本图中使用该模型。第 \\(\\) 个患者在时间 \\(t\\) 处的三次轨迹的斜率由下式关于 \\(t\\) 的导数获得\\[\\begin{aligned}m_i(t)=\\beta_0+\\beta_1t+\\beta_2t^2++\\beta_3t^3+u_{0i}+u_{1i}t+u_{2i}t^2+u_{3i}t^3\\end{aligned}\\]这得到\\[\\begin{aligned}m_i'(t)=\\beta_1+2\\beta_2t+3\\beta_3t^2+u_{1i}+2u_{2i}t+3u_{3i}t^2\\end{aligned}\\]LVMI 在 \\(t\\) 处的累积效应是 \\(m_i(t)\\) 的积分，由下式给出\\[\\begin{aligned}\\int_0^tm_i(v)\\mathrm{d}v&=\\beta_0t+\\beta_1\\frac{t^2}2+\\beta_2\\frac{t^3}3+\\beta_3\\frac{t^4}4+u_{0i}t+u_{1i}\\frac{t^2}2+u_{2i}\\frac{t^3}3+u_{3i}\\frac{t^4}4\\end{aligned}\\]除了项 \\(m_i(t)\\) 之外，还将斜率纳入联合模型，得到\\[\\begin{aligned}h_i(t)=\\exp\\{\\beta_{13}a_i+\\alpha_1m_i(t)+\\alpha_2m_i'(t)\\}h_0(t)\\end{aligned}\\]拟合该模型后，我们发现 \\(\\alpha_2\\) 的估计值为 0.0018，标准误为 0.0488（\\(P=0.97\\)）。在考虑了给定时间的 LVMI 对当时死亡风险的效应后，LVMI 轨迹的斜率对死亡风险没有显著影响。为了对 LVMI 的累积效应而不是其在 \\(t\\) 时的值进行建模，联合模型需包括 \\(m_i(t)\\) 的积分，即\\[h_i(t)=\\exp\\{\\beta_{13}a_i+\\alpha\\int_0^tm_i(v)\\mathrm{d}v\\}h_0(t)\\]拟合该模型后，\\(\\hat\\alpha = 0.0008\\)，标准误为 0.0006，这并不显著（\\(P = 0.21\\)）。该模型的 AIC 统计量为 10927，这大于包含 LVMI 在时间 \\(t\\) 处的效应的三次模型的相应值 (10920). 没有证据表明给定时间的死亡风险取决于截止那时的 LVMI 的累计值。","code":""},{"path":"chap8.html","id":"sec8-8","chapter":"第 8 章 时依变量","heading":"8.8 延伸阅读","text":"Cox (1972) 提出了将时间相关变量纳入比例风险模型的可能性。在他的论文中给出了合适的偏似然函数，并在 Cox (1975) 中进行了更详细的讨论。Kalbfleisch Prentice (2002) 详细介绍了偏似然函数的构造。8.1 节中概述的时依变量的分类是由 Prentice Kalbfleisch (1979) 提出的，他们在 Kalbfleich Prentice (2002) 中对此进行了详细阐述。Andersen (1992) 回顾了生存分析中时依变量的使用，其中包括一个实例（示例 8.4 的假设研究大致基于该实例）。Therneau Grambsch (2000) 以及 Therneau (2022) 描述了在使用时依变量时的一些实际的考虑和常见的误解。Altman De Stavola (1994)讨论了在分析具有时依变量生存数据时遇到的一些实际问题。还提供了对原发性胆汁性肝硬化数据的全面分析，包括对条件生存概率的评估。参见 Christensen et al. (1986) 的进一步说明。Klein Moeschberger (2005) 给出了骨髓移植后生存情况的完整数据集（其中部分数据在示例 8.2 中使用），并在许多详细的说明性示例中使用了这些数据集。Crowley Hu (1977) 以及 Cox Oakes (1984) 在对“斯坦福心脏移植数据”的分析中提出了 8.4 节描述的与器官移植相关的模型。Crowley Hu (1977) 给出了这一著名的数据集，Cox Oakes (1984) 提供了更新。另见 Aitkin, Laird Francis (1983) 以及随后的讨论。相对而言，将时依变量纳入生存数据的全参数模型的工作做得很少。然而，Petersen (1986) 展示了如何拟合具有时依变量的参数模型。第 6 章 6.4 节描述的 Royston Parmar 模型，可以通过添加潜在时依变量与第 6 章式 (6.11) 的基线累积风险函数中样条变量 \\(\\nu_1(y),\\nu_2(y),\\ldots\\) 的交互作用，将其扩展为包含时依变量7。许多文献描述了用于纵向数据分析的混合模型，包括 Crowder Hand (1990), Diggle et al. (2002), Fitzmaurice, Laird Ware (2011), Hand Crowder (1996), Hedeker Gibbons (2006), Molenberghs Verbeke (2005), Verbeke Molenbergh (2000) 以及 Weiss (2010). Rizopoulos (2012) 是关于纵向和事件时间数据联合建模的一个关键文本，他总结了这一理论并使用 R 软件提供了许多实际说明。Elashoff, Li Li (2017) 还通过临床研究的例子介绍了建模的理论和实践。综述论文包括 Tsiatis Davidian (2004), Tseng, Hsieh Wang (2005), Mcrink, Marshall Cairns (2013) 以及 Ritchie, Kalra Diggle (2015). Henderson, Diggle Dobson (2000) 描述了用于联合建模的一类通用模型，并说明了一些特定模型，Crowther, Abrams Lambert (2012) 描述了用于联合建模的灵活参数模型。Crowther et al. (2016) 展示了如何纳入延迟进入 (delayed entry) 或左截尾 (left truncation)，并研究了错误指定纵向轨迹的后果。Long Mills (2018) 展示了联合模型在亨廷顿舞蹈症研究中的应用。","code":""},{"path":"chap9.html","id":"chap9","chapter":"第 9 章 区间删失生存数据","heading":"第 9 章 区间删失生存数据","text":"在许多响应变量为生存时间的研究中，感兴趣事件的确切时间尚不清楚。相反，事件认为是在特定的时间区间内发生的。这种形式的数据称为分组或区间删失 (grouped interval-censored) 生存数据，通常出现在存在非致命终点的研究中。例如，定期看牙医的儿童恒牙萌出的时间、连续随访之间癌症复发的时间，以及定期进行血液检查的艾滋病毒感染者发展为艾滋病的时间。事实上，大多数生存分析都是基于区间删失数据，因为生存时间通常视为最近的一天、一周或一个月。本章将描述并说明区间删失数据的总结和建模方法。","code":""},{"path":"chap9.html","id":"sec9-1","chapter":"第 9 章 区间删失生存数据","heading":"9.1 区间删失","text":"删失在事件时间数据中广泛存在，当研究的终点时间不明确时就会出现。这本书包含了许多右删失的例子，其中一些事件实际的时间比观测的要长。左删失发生的频率要低得多，此时已知事件的实际时间小于观测时间。当仅知道事件在某个时间区间内发生时，事件发生的时间称为区间删失。为了说明这些不同类型的删失，请考虑一项针对心脏病发生年龄的研究，其中招募了 60 岁以上的个体并在一段时间内定期检查。在研究结束时，有些个体可能没有患上心脏病，或者可能死于其他原因。这些个体的事件时间是右删失的。另一方面，当首次对被招募的个体进行检查时，可能会发现一些人已经患上了心脏病。那么对这些个体的事件时间是左删失的，因为人们只知道他们的心脏病是在初次筛查之前的某个时间发展得来的。在其他情况下，有些个体经过检查未发现没有心脏病，但在下一次检查时却发现了该病。对他们来说，发病时间在两次检查之间，他们的发病时间是区间删失的。右删失和左删失实际上是区间删失的特殊情况。考虑一个事件时间 \\(t\\)，它只发生在从 \\(L\\) 到 \\(U\\) 的时间区间内，其中 \\(L\\) 和 \\(U\\) 分别指下限和上限。这个区间将表示为 \\((L, U]\\)，表示 \\(t\\) 满足 \\(L<t\\leqslant U\\)。该区间在下限处是开的，在上限处是闭的，以消除事件时间所在区间的歧义。例如，如果时间以天为单位测量，并且已知事件发生在 5 到 10 天之间，则区间 \\((5,10]\\) 表示事件发生在第 5 天之后，但发生在第 10 天或之前。另一方面，发生在第 5 天或之前的事件将处于上限为 5 天的时间区间内。在这种表示法中，如果事件时间 \\(t\\) 是精确已知的，则 \\(L=U\\)。如果 \\(L=t\\) 且 \\(U=\\infty\\)，因此事件时间仅已知是超过 \\(t\\) 的，则事件时间是右删失的。右删失事件时间区间的上限也可用星号（*）表示。如果 \\(L=0\\) 且 \\(U=t\\)，则已知事件在时间 \\(t\\) 之前已经发生，因此 \\(t\\) 是左删失的。一组时间事件观测数据可能包含实际时间以及右删失、左删失和区间删失时间的混合。示例 9.1  (溃疡复发) 在一项双盲临床试验中，研究人员比较了两种治疗方案对首次治疗后溃疡复发的抑制作用。患者被随机分配接受标记为 和 B 的两种治疗方案中的一种。为患者安排了诊所以定期就诊，并在随机分配后的 6 个月和 12 个月进行内窥镜检查。内窥镜检查阳性结果表明自上次阴性结果以来溃疡已复发。因此，获得了溃疡是否在 0 至 6 个月或 6 至 12 个月的区间内复发的信息。此外，一些患者在预定就诊之间出现复发症状。这些患者在这些时候进行了内窥镜检查，以检测是否确实发生了复发。在试验入组时，除了治疗组（或 B），还记录了每位患者的年龄（以年为单位）和确诊疾病的持续时间（1 = 小于五年，2 = 大于或等于五年）。数据集中有两个与溃疡检测相关的变量，即最后一次就诊的时间（以月为单位）和当时的内窥镜检查结果（1 = 未检测到溃疡，2 = 检测到溃疡）。那些时间不等于 6 或 12 个月的人在预定就诊之间出现了症状。这项研究本身是跨国的，Whitehead (1989) 提供了全套数据。本例将使用比利时的数据，相关数据如表 9.1 所示。\n在对这项研究的数据进行建模时，疾病的持续时间由一个指示变量 \\(Duration\\) 表示，当持续时间小于五年时，该变量为零，否则为一。治疗效应由变量 \\(Treat\\) 表示，如果个体接受治疗 ，则该变量取值为零，如果接受治疗 B，则取值为一。患者的年龄反映在连续变量 \\(Age\\) 中。表 9.1 最后两列中最后一次就诊的时间和结果的数据可以转换为溃疡复发的区间删失时间。表 9.2 显示了由最近内窥镜检查的时间值和结果的各种组合产生的区间删失时间。具有无限上限的事件时间是右删失的。在以这种方式转换数据之后，它们现在是区间删失数据的形式。分析这类数据的一种方法是仅关注检测到的复发时间。然而，这些数据是两种复发的混合：预定的筛查时间检测到的复发（称为筛查检出的复发，screen-detected recurrences）、出现症状后诊断出的复发（称为区间检出的复发，interval-detected recurrences）。这使得解释分析结果变得困难。为了说明这个问题，假设本例中的两种治疗方法对复发时间具有完全相同的效果，但新的治疗方法抑制了症状。接受新治疗的患者的溃疡复发往往比接受标准治疗的患者的溃疡复发更晚被检测到。那么，在接受标准治疗的患者中，区间检测到的复发将更快地被识别出来，并且这组患者的复发时间将更短。这将表明新治疗优于标准治疗，但这是错误的结论。在某些情况下，忽略区间删失并在标准分析中使用时间区间的上限或下限可能是合理的。当时间区间相对于研究持续时间相当小时，这可能是可行的。调整区间删失数据以便进行标准分析的另一种方法是在每个观测的时间区间内插补 (imputat) 一个值。为此，可以使用区间的中点或更复杂的多重插补法 (multiple imputation methods). 然而，这些方法可能会得到有偏的推断，应优选专门为分析区间删失数据而开发的方法。","code":""},{"path":"chap9.html","id":"sec9-1-1","chapter":"第 9 章 区间删失生存数据","heading":"9.1.1 当前状态数据","text":"当只有一个观测时间，并且只能知道研究中每个个体在该时间之前是否经历过某种事件时，就出现了区间删失数据的特例。这种类型的数据称为当前状态数据 (current status data). 已经历过该事件的个体有左删失事件时间，而尚未发生该事件的个体有右删失时间。因此，所得数据集中的所有观测要么是左删失，要么是右删失。使用本章描述的分析方法，可以获得相应生存函数的估计和相关的总结统计量。此外，用于分析区间删失数据的建模方法可用于识别可能与当前状态数据中事件时间相关的因素。为了说明当前状态数据，考虑一项致癌性研究，在该研究中，实验室动物暴露于某种化学物质中，并且肿瘤发生的时间是令人感兴趣的。这些动物在暴露 30 天后被处死，随后进行检查以确定是否存在肿瘤。发现患有肿瘤的动物的左删失事件时间为30天，而没有肿瘤的动物的右删失事件时间为30天。那么可以从生存函数估计中找到肿瘤发展时间分布的百分位数。同样，在确定初潮年龄（月经开始时间）的流行病学研究中，记录了参与研究的女性是否发生月经初潮的数据。由此得出的数据可以用月经初潮年龄的中位数进行总结，并且可以评估月经初潮年龄对社会经济地位等因素的相关性。","code":""},{"path":"chap9.html","id":"sec9-2","chapter":"第 9 章 区间删失生存数据","heading":"9.2 估计生存函数","text":"我们在第 2 章看到了如何使用 Kaplan-Meier 或 Nelson-Aalen 估计来估计右删失数据的生存函数。它们是阶跃函数，其中生存函数估计在相邻事件时间之间是恒定的，并仅在事件时间处发生变化。当数据集包括区间删失事件时间时，生存函数估计也是一个阶跃函数，但该估计在特定时间区间（称为 Turnbull 区间）内是未定义的。为了确定 Turnbull 区间，需要将区间删失事件时间的所有下边界和上边界按升序排列，并根据它们是时间区间的下限还是上限分别标记为 \\(L\\) 或 \\(U\\)。然后确定以 \\(L\\) 为下限、以 \\(U\\) 为上限的区间，这些就是 Turnbull 区间，它们之间不会有其他区间删失时间的下限或上限值。示例 9.2  (人造区间删失数据) 为了说明 Turnbull 区间的构造，假设有五个个体的事件时间：一个左删失时间、一个右删失事件时间和三个区间删失时间。区间删失格式的观测结果如下：\\[\\begin{aligned}(3,6]\\quad(0,7]\\quad(4,9]\\quad(8,10]\\quad(14,\\infty]\\end{aligned}\\]这里，第二个观测的事件时间 7 是左删失的，并且该区间的下限为零。最后一个观测 14 是右删失的，该事件时间的上限为无限。则区间边界的有序值为：\\[0\\,(L)\\quad3\\,(L)\\quad4\\,(L)\\quad6\\,(U)\\quad7\\,(U)\\quad8\\,(L)\\quad9\\,(U)\\quad10\\,(U)\\quad14\\,(L)\\quad\\infty\\,(U)\\]有三个 \\(L\\) 后面跟着 \\(U\\) 的时间区间：\\((4,6],(8,9]\\) 和 \\((14,\\infty)\\)。这些是生存函数未定义的 Turnbull 区间。请注意，与 Kaplan-Meier 估计一样，对这五个观测，生存函数在超过最长事件时间 14 后是未定义的，因为这是右删失的。为了估计生存函数，假设我们有一个包含 \\(n\\) 个区间删失事件时间的样本，形式为 \\((l_i,u_i],=1,2,\\ldots,n\\)，其中第 \\(\\) 个区间包括上限 \\(u_i\\)，但不包括下限 \\(l_i\\)。如果第 \\(\\) 个观测是精确已知的，则 \\(l_i=u_i\\)，而如果它是右删失的，则 \\(u_i=\\infty\\)，如果左删失，则 \\(l_i=0\\)。对于一个精确的事件时间，有 \\(l_i=u_i\\)，对应的区间是无穷小的，此时生存函数会出现一个阶跃 (step). 当数据集中的一个区间的下限等于另一个的上限时，这种表示法还消除了识别 Turnbull 区间的任何歧义。这里，在确定 Turnbull 区间时，下限是在上限之后立即出现的时间点，因此下限位于上限之后8。生存函数估计在 Turnbull 区间之间是恒定的，并且是从概率 \\(\\theta_j\\) 推导出来的，该概率表示事件时间 \\(t\\) 位于 \\(m\\) 个 Turnbull 区间的第 \\(j\\) 个区间内，这 \\(m\\) 个区间记作 \\((a_j,b_j],j=1,2,\\ldots,m\\)。\\(\\theta_j\\) 的估计 \\(\\hat\\theta_j\\) 就是如下 \\(m\\) 个联立方程的解\\[\\begin{align}\n\\theta_j&=\\frac1n\\sum_{=1}^n\\frac{\\alpha_{ij}\\theta_j}{\\sum_{j=1}^m\\alpha_{ij}\\theta_j}\n\\tag{9.1}\n\\end{align}\\]其中，如果第 \\(j\\) 个 Turnbull 区间 \\((a_j , b_j ]\\) 包含在第 \\(\\) 个观测区间 \\((l_i, u_i], = 1, 2,...,n\\) 中，则 \\(\\alpha_{ij} = 1\\)，否则为零。9.2.1 节给出了这一结果的推导过程。区间删失事件时间样本的生存函数估计在 Turnbull 区间之间是恒定的，而在这些区间内（即生存函数值发生变化的地方）则未定义。因此，对于不在 Turnbull 区间内的 \\(t\\) 值，生存函数估计可以表示为\\[\\begin{align}\n\\hat{S}(t)=\\sum_{j:b_j>t}\\hat{\\theta}_j\n\\tag{9.2}\n\\end{align}\\]其中求和运算对于所有这样的 \\(\\hat\\theta_j\\) 进行：其 Turnbull 区间的上限超过 \\(t\\)。该估计由 Turnbull (1976) 得出的，通常称为生存函数的 Turnbull 估计。等价地，对于不在 Turnbull 区间内的 \\(t\\) 值，该估计可以写为\\[\\left.\\hat{S}(t)=\\left\\{\\begin{array}{ll}1&\\text{}t\\leqslant a_1,\\\\1-\\hat{\\theta}_1-\\hat{\\theta}_2-\\cdots-\\hat{\\theta}_j&\\text{}b_j\\leqslant t\\leqslant a_{j+1},j=1,2,\\ldots,m-1,\\\\0&\\text{}t\\geqslant b_m\\end{array}\\right.\\right.\\]","code":""},{"path":"chap9.html","id":"sec9-2-1","chapter":"第 9 章 区间删失生存数据","heading":"9.2.1 生存函数估计的推导","text":"假设我们有包含 \\(n\\) 个区间删失事件时间的样本 \\((l_i,u_i],=1,2,\\ldots,n\\)，时间 \\(t\\) 处的生存函数为 \\(S(t)\\)。由于 \\(S(l_{{}})-S(u_{{}})\\) 是第 \\(\\) 个事件时间包含在区间 \\((l_i, u_i]\\) 中的概率，则 \\(n\\) 个区间删失事件时间的似然函数为\\[\\begin{align}\nL=\\prod_{=1}^n\\left[S(l_i)-S(u_i)\\right]\n\\tag{9.3}\n\\end{align}\\]该似然可用不同的形式来表达。假设每个时间区间的下限和上限按升序排列，给出一组唯一值 \\(\\tau_0,\\tau_1,\\tau_2,\\ldots,\\tau_r\\)，它们满足\\[\\tau_0<\\tau_1<\\tau_2<\\cdots<\\tau_{r-1}<\\tau_r\\]其中 \\(\\tau_0=0,\\tau_r=\\infty\\)。令 \\(\\theta_j\\) 是事件时间发生在第 \\(j\\) 个区间 \\((\\tau_{j-1},\\tau_{j}]\\) 内的概率，从而 \\(\\theta_j=S(\\tau_{j-1})-S(\\tau_j),j=1,2,\\ldots,r\\)。此外，如果第 \\(j\\) 个区间\\((\\tau_{j-1},\\tau_{j}]\\) 包含在第 \\((=1,2,\\ldots,n)\\) 个观测区间 \\((l_{\\boldsymbol{}},u_{\\boldsymbol{}}]\\)，则令 \\(\\alpha_{ij}=1\\)，否则为 0. 那么，式 (9.3) 中的似然函数可以写为\\[L=\\prod_{=1}^n\\left\\{\\sum_{j=1}^r\\alpha_{ij}\\theta_j\\right\\}\\]在 \\(0\\leqslant\\theta_j\\leqslant1\\) 和 \\(\\sum_{j=1}^r\\theta_j=1\\) 的约束下最大化。相应的对数似然函数为\\[\\begin{aligned}\\log L=\\sum_{=1}^n\\log\\left\\{\\sum_{j=1}^r\\alpha_{ij}\\theta_j\\right\\}\\end{aligned}\\]为对其在 \\(\\sum_{j=1}^r\\theta_j=1\\) 的约束下最大化，引入了拉格朗日乘子 (Lagrange multiplier) \\(\\lambda\\)。即，为对数似然函数添加项 \\(\\lambda(\\sum_{j}\\theta_{j}-1)\\)，得到\\[\\begin{aligned}\\log L_0=\\sum_{=1}^n\\log\\left\\{\\sum_{j=1}^r\\alpha_{ij}\\theta_j\\right\\}+\\lambda\\left(\\sum_{j=1}^r\\theta_j-1\\right)\\end{aligned}\\]鉴于约束项，这不会改变对数似然函数的值。对 \\(\\log L_0\\) 关于 \\(\\theta_j\\) 微分并将导数设为零可得到\\[\\begin{aligned}\\sum_{=1}^n\\frac{\\alpha_{ij}}{\\sum_{j=1}^r\\alpha_{ij}\\theta_j}+\\lambda&=0\\end{aligned}\\]两边同时乘以 \\(\\theta_j\\) 得到\\[\\begin{align}\n\\sum_{=1}^n\\frac{\\alpha_{ij}\\theta_j}{\\sum_{j=1}^r\\alpha_{ij}\\theta_j}+\\lambda\\theta_j&=0\n\\tag{9.4}\n\\end{align}\\]对该式两边关于 \\(j\\) 求和并利用 \\(\\sum_{j=1}^r\\theta_j=1\\) 可得 \\(\\sum_{=1}^n1+\\lambda=0\\)，从而 \\(\\lambda = −n\\)，再将 \\(\\lambda\\) 带回式 (9.4)，得到\\[\\begin{aligned}\\sum_{=1}^n\\frac{\\alpha_{ij}\\theta_j}{\\sum_{j=1}^r\\alpha_{ij}\\theta_j}-n\\theta_j&=0\\end{aligned}\\]这得到了方程组\\[\\begin{aligned}\\theta_j&=\\frac{1}{n}\\sum_{=1}^n\\frac{\\alpha_{ij}\\theta_j}{\\sum_{j=1}^r\\alpha_{ij}\\theta_j}\\end{aligned}\\]事实上\\[\\frac{\\alpha_{ij}\\theta_j}{\\sum_{j=1}^r\\alpha_{ij}\\theta_j}\\]是位于区间 \\((l_i, u_i]\\) 中的事件时间 \\(t\\) 出现在第 \\(j\\) 个 Turnbull 区间内的概率，令 \\(\\theta_j\\) 等于这些值的均值可以得到相同的结果。由于 \\(\\theta_j\\) 仅在 \\(m\\) 个 Turnbull 区间中非零，因此将非零值重新记为 \\(\\theta_1,\\theta_2,\\ldots,\\theta_m\\)，因此现在 \\(\\theta_j\\) 是事件时间包含在第 \\(j(j=1,2,\\ldots,m)\\) 个 Turnbull 区间 \\((a_j,b_j]\\) 中的概率。这是式 (9.1) 的结果。该估计是从似然函数导出的，且无需指定生存时间的概率分布，因此它是非参数最大似然估计 (Non-Parametric Maximum Likelihood Estimator, NPMLE). 此外，该估计过程源于用于获得 \\(\\theta_j\\) 的最大似然估计的期望最大化 (EM) 算法。示例 9.3  (人造区间删失数据) 在本例中，使用示例 9.2 中的人造数据说明获得生存函数的 Turnbull 估计所需的计算，其中区间为\\[\\begin{aligned}(3,6]\\quad(0,7]\\quad(4,9]\\quad(8,10]\\quad(14,\\infty]\\end{aligned}\\]在示例 9.2 中，发现 Turnbull 区间为 \\((4,6],(8,9]\\) 和 \\((14,\\infty)\\)，并且生存函数估计在这三个区间之间是恒定的。表 9.3 给出了区间 \\((a_j,b_j],j=1,2,\\ldots,3\\) 的 \\(\\alpha_{ij}\\) 值，如果区间 \\((l_i,u_i]\\) 包括 \\((a_j,b_j]\\)，则 \\(\\alpha_{ij}\\) 为一，否则为零。非零 \\(\\theta\\) 值 \\(\\hat{\\theta}_1,\\hat{\\theta}_2\\) 和 \\(\\hat\\theta_3\\) 所满足的方程可以从式 (9.1) 中获得，例如\\[\\begin{aligned}\n\\widehat{\\theta}_{1}&=\\frac{1}{5}\\sum_{=1}^5\\frac{\\alpha_{i1}\\hat{\\theta}_1}{\\alpha_{i1}\\hat{\\theta}_1+\\alpha_{i2}\\hat{\\theta}_2+\\alpha_{i3}\\hat{\\theta}_3} \\\\\n&=\\left.\\frac15\\left\\{\\frac{\\hat{\\theta}_1}{\\hat{\\theta}_1}+\\frac{\\hat{\\theta}_1}{\\hat{\\theta}_1}+\\frac{\\hat{\\theta}_1}{\\hat{\\theta}_1+\\hat{\\theta}_2}\\right\\}\\right.\n\\end{aligned}\\]化简后\\[\\begin{aligned}\\hat{\\theta}_1=\\frac{1}{5}\\left(\\frac{3\\hat{\\theta}_1+2\\hat{\\theta}_2}{\\hat{\\theta}_1+\\hat{\\theta}_2}\\right)\\end{aligned}\\]类似地\\[\\hat\\theta_2=\\frac{1}{5}\\left(\\frac{\\hat\\theta_1+2\\hat\\theta_2}{\\hat\\theta_1+\\hat\\theta_2}\\right)\\]并且关于 \\(\\hat\\theta_3\\) 的表达式直接得到 \\(\\hat\\theta_3=0.2\\)。求解这些方程组后得到 \\(\\hat{\\theta}_1=0.5333,\\hat\\theta_2=0.2667\\)，并且 \\(\\hat{\\theta}_1,\\hat{\\theta}_2,\\hat{\\theta}_3\\) 满足约束：和为一。生存函数的相应估计在 \\(\\hat\\theta_j=0\\) 的区间上是恒定的，而在 \\(\\hat\\theta_j>0\\) 的区间上是未定义的。该估计可从式 (9.2) 中得出，从而得出\\[\\left.\\hat{S}(t)=\\left\\{\\begin{array}{ll}1.000&\\quad0\\leqslant t\\leqslant4\\\\0.478&\\quad6\\leqslant t\\leqslant8\\\\0.200&\\quad9\\leqslant t\\leqslant14\\end{array}\\right.\\right.\\]在 \\(t=14\\) 之后 \\(\\hat S(t)\\) 是未定义的。图 9.1 显示了人造数据生存函数的估计。\n在该图中，阴影部分为 Turnbull 区间，生存函数估计由直线连接，即使它们在这些区间内没有定义。尽管在这个简单的示例中，可以在不使用数值方法的情况下获得 \\(\\theta\\) 的估计，但这种情况很少发生。此外，支持估计过程的 EM 算法通常收敛速度很慢。因此，人们提出了替代算法，包括ICM (Iterative Convex Minorant) 算法和 EMICM 算法，EMICM 算法是 ICM 和 EM 算法的组合。此外，不能使用获得生存函数估计的标准误的常用方法。这是因为随着样本量的增加，未知 \\(\\theta\\) 参数的数量不可避免地会增加，这意味着附录 的基于似然计算标准误的方法不再适用。相反，基于 bootstrap 的重采样方案被广泛使用。第 6 章 6.1 节概述了这一过程。示例 9.4  (溃疡复发) 对于示例 9.1 中给出的溃疡复发时间数据，生存函数 \\(S(t)\\) 表示任何给定时间 \\(t\\) 后复发的概率。对于两种治疗，生存函数估计 \\(S(t)\\) 在 \\(t = 0\\) 时为 1，在 12 个月后未定义。\n对于接受治疗 的患者，对于 \\(2\\leqslant t\\leqslant 6\\)，\\(\\hat S(t)=0.842\\)，对于 \\(t = 12\\)，\\(\\hat S(t)=0.777\\)；对于接受治疗 B 的患者，对于 \\(5\\leqslant t\\leqslant 6\\)，\\(\\hat S(t)=0.917\\)，对于 \\(7\\leqslant t\\leqslant 12\\)，\\(\\hat S(t)=0.708\\)。生存函数在其他地方没有定义，如图 9.2 所示。\n这些估计相差不大，表明这两种治疗方法对溃疡复发的时间有相似的效应。通过对区间删失数据进行建模，我们将能够正式检查任何治疗差异的显著性。","code":""},{"path":"chap9.html","id":"sec9-3","chapter":"第 9 章 区间删失生存数据","heading":"9.3 半参数比例风险模型","text":"区间删失事件时间数据模型可以评估和总结因素和解释变量对事件时间的影响。与右删失数据一样，模型基于任何给定时间的死亡风险，可以是半参数或全参数的。本节描述半参数比例风险模型，其中不对事件时间的潜在分布做出假设。在比例风险模型中，第 \\(\\) 个个体（共 \\(n\\) 个）在时间 \\(t\\) 的死亡风险为\\[h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\]其中 \\(\\boldsymbol{\\beta'x}_i\\) 是第 \\(\\) 个个体解释变量值 \\(\\boldsymbol x_i\\) 的线性组合，\\(h_0(t)\\) 是基线风险函数。\\(t\\) 时刻对应的生存函数为\\[\\begin{aligned}S_i(t)=S_0(t)^{\\exp(\\boldsymbol{\\beta'x}_i)}\\end{aligned}\\]其中 \\(S_0(t)\\) 是基线风险函数，且 \\(S_0(0)=1,S_0(\\infty)=0\\)。为可能右删失的生存数据拟合 Cox 回归模型包括构建不涉及 \\(h_0(t)\\) 的偏似然函数，并最大化该函数以获得 \\(\\beta\\) 参数的估计。对于区间删失数据来说这是不可能的，并且需要根据完全似然函数同时估计 \\(\\beta\\) 和 \\(h_0(t)\\)。对于形如 \\((l_i, u_i]\\) 的 \\(n\\) 个区间删失事件时间样本，\\(= 1, 2,...,n\\)，如式 (9.3)，全似然函数为\\[\\begin{align}\nL=\\prod_{=1}^nP(l_i<T\\leqslant u_i)=\\prod_{=1}^n\\left\\{S_i(l_i)-S_i(u_i)\\right\\}\n\\tag{9.5}\n\\end{align}\\]右删失时间对该似然的贡献是 \\(S_i(l_i)\\)，左删失时间则为 \\(1 − S_i(u_i)\\)，对于未删失事件时间（\\(l_i = u_i\\)）则为 \\(f(t_{{}})=-\\mathrm{d}S_{{}}(t_{{}})/\\mathrm{d}t\\)。","code":""},{"path":"chap9.html","id":"sec9-3-1","chapter":"第 9 章 区间删失生存数据","heading":"9.3.1 半参数 Turnbull 模型","text":"一种可能的半参数模型是通过将基线生存函数作为基于 Turnbull 区间的 NPMLE 来形成。该模型称为半参数 Turnbull 模型，相邻 Turnbull 区间之间的风险、累积风险和生存函数都是恒定的。具体来说，如果一组区间删失事件时间得到 \\(m\\) 个 Turnbull 区间 \\((a_j,b_j],j=1,2,\\ldots,m\\)，则 \\(S_0(t)\\) 对于区间 \\((0,a_1],(b_1,a_2],\\ldots,(b_{m-1},a_m],(b_m,\\infty]\\) 中的 \\(t\\) 值是恒定的。第 \\(k\\) 个这样的区间中 \\(t\\) 值（在两个连续 Turnbull 区间之间的第 \\(k\\) 个区间中的 \\(t\\) 值）的基线生存函数为\\[\\begin{aligned}S_0(t)=\\zeta_k,\\quad k=1,2,\\ldots,r\\end{aligned}\\]第 \\(k\\) 个区间中相应的基线累积风险为 \\(-\\log(\\zeta_k)\\)，并且风险函数为累积风险的增量。该模型将生存函数的 NPMLE 推广到区间删失数据的回归模型，类似于右删失数据的 Cox 回归模型。根据式 (9.5)，\\(n\\) 个区间删失观测的全似然函数 \\((l_i,u_i]\\) 为\\[\\begin{align}\n\\prod_{=1}^n\\left\\{S_0(l_i)^{\\exp(\\boldsymbol{\\beta'x}_i)}-S_0(u_i)^{\\exp(\\boldsymbol{\\beta'x}_i)}\\right\\}$\n\\tag{9.6}\n\\end{align}\\]并且通过最大化该似然函数来拟合模型。对于生存函数的 NPMLE，一般采用 EMICM 算法来拟合该模型，拟合过程可在多个软件包中实现。使用 bootstrap 等模拟方法来获得参数估计的标准误，这在第 6 章 6.1 节中结合分段指数模型进行了描述。虽然右删失数据可以表示为区间删失事件时间，但拟合半参数 Turnbull 模型所得参数估计与拟合 Cox 模型所得参数估计不同。这是因为拟合过程是基于全似然函数而不是偏似然函数。一旦拟合了模型，可得式 (9.5) 对数似然函数的最大值 \\(\\log \\hat L\\)，那么量 \\(-2\\log\\hat{L}\\) 可用于以通常的方式比较替代模型。总的来说，将 \\(-2\\log\\hat{L}\\) 值之差与卡方分布的百分点进行比较，后者自由度等于替代嵌套模型之间 \\(\\beta\\) 参数数量之差。对于非嵌套模型，第 3 章 3.6.1 节中描述的 AIC 或 BIC 统计量可用于模型比较。示例 9.5  (溃疡复发) 示例 9.1 给出的溃疡复发时间数据现在用于说明为区间删失数据拟合半参数 Turnbull 模型。要拟合的模型的基线生存函数在相邻 Turnbull 区间之间保持恒定，因此第一步是确定这些区间。使用表 9.2 将区间删失观测的限按升序排列，得到三个 Turnbull 区间：\\((0,2],(6,7]\\) 和 \\((12,\\infty)\\)。这意味着基线生存函数只有两个参数，对应于时间区间 \\((0,2],(6,7]\\)。拟合包含与 \\(Age,Duration\\) 和 \\(Treat\\)（示例 9.1 中定义的年龄、持续时间和治疗）对应的变量的模型后，\\(-2\\log\\hat{L}\\) 统计量的值为 62.566. 单独拟合 \\(Treat\\) 时的相应值为 62.884. 由于 0.32 的差异相对于自由度为二的卡方分布的百分位点非常小，我们得出结论，年龄和治疗持续时间都不会影响这些患者的溃疡复发时间。实际上，零模型的 \\(-2\\log\\hat{L}\\) 为 62.982，因此没有显著的治疗效应。然而，该项将保留在模型中，以便估计效应的大小。治疗 B 的患者相对于治疗 的患者的对数风险比估计为 0.195，相应的风险比为 1.216. 对数风险比的标准误差是根据 10000 个 bootstrap 样本估计的。这涉及模拟 10000 个数据集，其中每个数据集都是通过从表 9.1 给出的数据中有放回地随机抽取 43 个观测而形成的。然后为每个数据集拟合仅包含 \\(Treat\\) 的半参数 Turnbull 模型，从而对 \\(Treat\\) 的对数风险比进行 10000 次估计。这些值的标准差是标准误的 bootstrap 估计。标准差为 1.488，因此风险比的 95% 置信区间为 \\(\\exp(0.195\\pm1.96\\times1.488)\\)，即 0.066 到 22.442 的区间。据估计，治疗 B 会使溃疡复发的风险增加 22%，但这种差异并不显著，相应的风险比区间估计包括一。表 9.4 给出了每种治疗的患者的生存函数估计。治疗 中患者的生存函数是基线生存函数估计 \\(\\hat S_0(t)\\)，并且生存函数在区间 \\((0,2],(6,7]\\) 和超过 12 个月时没有定义。生存函数的差异很小，但确实表明接受 B 治疗的患者溃疡复发的概率略有增加，尽管不显著。","code":""},{"path":"chap9.html","id":"sec9-3-2","chapter":"第 9 章 区间删失生存数据","heading":"9.3.2 区间删失数据的分段指数模型","text":"另一种半参数模型假定基线风险函数在多个连续时间区间的每一个内都是恒定的，且与 Turnbull 区间的位置无关。这得到了第 6 章 6.1 节描述的分段指数模型，对于第 \\(j(j=1,2,\\ldots,r)\\) 个时间区间 \\(t_{(j-1)}\\leqslant t<t_{(j)}\\) 中的事件时间 \\(t\\)（其中 \\(t_{(0)}=0\\)），有\\[\\begin{aligned}h_0(t)=\\lambda_j\\end{aligned}\\]对于右删失数据，可以将区间设置为每个区间内的事件时间数大致相等。然而，对于区间删失数据，由于事件时间本身未观测到，因此无法实现这一点。相反，可以选择具有类似数量的唯一边界值的区间，或者选择覆盖相似时间段的区间。根据第 6 章方程式 (6.3)，相应的基线累积风险函数为\\[\\begin{align}\nH_0(t)=\\sum_{j=1}^r\\lambda_j\\Delta_j(t)\n\\tag{9.7}\n\\end{align}\\]其中\\[\\left.\\Delta_j(t)=\\left\\{\\begin{array}{ll}0&t<t_{(j-1)}\\\\t-t_{(j-1)}&t_{(j-1)}\\leqslant t<t_{(j)}\\\\t_{(j)}-t_{(j-1)}&t\\geqslant t_{(j)}\\end{array}\\right.\\right.\\]并且基线生存函数为 \\(S_0(t)=\\exp\\{-H_0(t)\\}\\)。似然函数与式 (9.6) 中的似然函数相同，并且在 \\(h_0(t)\\) 中的 \\(\\beta\\) 和 \\(\\lambda\\) 参数上最大化。在风险函数的这个公式中，\\(\\lambda_j>0\\)，为确保这一点，它通常通过设置 \\(\\phi=\\log\\lambda\\) 来参数化。与往常一样，使用 \\(-2\\log\\hat{L}\\) 统计量来比较嵌套模型、使用 AIC 或 BIC 统计量来比较非嵌套模型。该比例风险模型可以扩展，以允许解释变量系数在所选时间区间之间不同。这两个模型 \\(-2\\log\\hat{L}\\) 值之差得到了比例风险检验。尽管可以使用第 3 章 3.3.3 节描述的 Newton-Raphson 程序为区间删失数据拟合分段指数模型，但更常用的是更高效的方法，如 EMCM 算法。然而，由于生存函数估计在 Turnbull 区间内是未定义的，因此基于与这些时间区间重叠的时间区间的估计可能不是唯一的。当区间数相对较小时，附录 中总结的似然法可得到参数估计的标准误，尽管也可以使用 bootstrap 法。示例 9.6  (溃疡复发) 在本示例中，为示例 9.1 中首次给出的溃疡复发时间的数据拟合分段指数模型。由于检测溃疡复发的内镜检查计划在初次治疗后 6 个月和 12 个月进行，因此在分段指数模型中使用时间区间 \\((0,6]\\) 和 \\((6,12]\\) 是很自然的。因此，基线风险函数对于 \\(0\\leqslant t<6\\) 为 \\(\\lambda_1\\)，对于 \\(6\\leqslant t<12\\) 为 \\(\\lambda_2\\)。使用 \\(Age,Duration\\) 和 \\(Treat\\) 这三项拟合分段指数比例风险模型后，\\(-2\\log\\hat{L}=73.889\\)，省略 \\(Age,Duration\\) 后，该量增加为 74.258. 该模型中 \\(Treat\\) 的系数估计为 0.209，因此治疗 B 相对于治疗 复发的风险为 1.232，95% 置信区间为 0.360 到 4.213. 该区间包含一，再次指出不存在显著的治疗效应。在两个区间中，基线风险函数中的参数估计分别为 \\(\\hat{\\lambda}_1=0.018\\) 和 \\(\\hat{\\lambda}_2=0.028\\)。使用式 (9.7) 可得出累积风险函数的相应估计，即\\[\\left.\\hat{H}_0(t)=\\left\\{\\begin{array}{ll}\\hat{\\lambda}_1t&\\quad0\\leqslant t<6\\\\\\hat{\\lambda}_2t+6(\\hat{\\lambda}_1-\\hat{\\lambda}_2)&\\quad6\\leqslant t<12\\\\6(\\hat{\\lambda}_1+\\hat{\\lambda}_2)&\\quad t\\geqslant12\\end{array}\\right.\\right.\\]那么基线生存函数估计为 \\(\\hat{S}_0(t)=\\exp\\{-\\hat{H}_0(t)\\}\\)。治疗 和治疗 B 患者的生存函数估计如图 9.3 所示。\n对于接受治疗 的患者，生存函数估计再次稍大，这表明该组溃疡复发的时间较长。示例 9.5 中单独使用 \\(Treat\\) 拟合的半参数模型以及本示例中的分段指数模型都具有三个未知参数，这两个模型的 AIC 统计量的值分别为 68.884 和 80.258. 因此，半参数 Turnbull 对观测数据拟合得更好。将模型扩展为在每个时间区间内具有不同的治疗效应，模型变为\\[\\left.h_i(t)=\\left\\{\\begin{array}{ll}\\exp(\\beta_1x_i)\\lambda_1&\\quad0\\leqslant t<6\\\\\\exp(\\beta_2x_i)\\lambda_2&\\quad6\\leqslant t<12\\end{array}\\right.\\right.\\]其中，若第 \\(\\) 个患者接受治疗 ，则 \\(x_i = 0\\)，否则为 \\(1\\). 拟合此模型后，\\(-2\\log\\hat{L}=71.821\\)，因此与在每个时间区间内具有不同治疗效应相关的 \\(-2\\log\\hat{L}\\) 的减小量在一个自由度上为 2.437，\\(P =0.119\\)。治疗 B 相比治疗 的风险比估计在第一个区间中为 0.415，在第二个区间中为 3.459. 尽管这种差异仅在 12% 的水平上显著，但有迹象表明，在溃疡初次治疗后 6 至 12 个月内，（相比前 6 个月）治疗效应更大。","code":""},{"path":"chap9.html","id":"sec9-4","chapter":"第 9 章 区间删失生存数据","heading":"9.4 参数模型","text":"上一节描述的半参数模型得到了对风险和生存函数的不连续估计，这在实际中是不现实的。然而，可以使用第 5 章和第 6 章描述的全参数模型来获得这些函数的平滑估计。为区间删失数据拟合这些模型也是很简单的。在全参数比例风险模型中，第 \\((=1,2,\\ldots,n)\\) 个个体的风险和生存函数为\\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t),\\quad S_i(t)=S_0(t)^{\\exp(\\boldsymbol{\\beta'x}_i)}\\end{aligned}\\]其中，\\(\\boldsymbol x_i\\) 是 \\(p\\) 个解释变量的值向量，\\(h_0(t),S_0(t)\\) 是 \\(\\boldsymbol x_i\\) 分量均为零的基线风险和生存函数。对于第 5 章 5.6 节所述的 Weibull 比例风险模型，\\(h_0(t)=\\lambda\\gamma t^{{\\gamma}-1}\\) 和 \\(S_0(t)=\\exp(-\\lambda t^\\gamma)\\)。通过最大化式 (9.6) 给出的似然函数，可以为 \\(n\\) 个区间删失事件时间 \\(l_i,u_i],=1,2,\\ldots,n\\) 拟合该模型。对于 Weibull 模型，这是\\[\\begin{align}\nL=\\prod_{=1}^n\\left\\{[\\exp(-\\lambda l_i^\\gamma)]^{\\exp(\\boldsymbol{\\beta}^\\prime\\boldsymbol{x}_i)}-[\\exp(-\\lambda u_i^\\gamma)]^{\\exp(\\boldsymbol{\\beta}^\\prime\\boldsymbol{x}_i)}\\right\\}\n\\tag{9.8}\n\\end{align}\\]并且可以使用数值方法（如第 3 章 3.3.3 节描述的 Newton-Raphson 程序）来得到 \\(\\hat{\\boldsymbol\\beta},\\hat\\lambda\\) 和 \\(\\hat\\gamma\\)。使用附录 中的结果可得到参数估计的标准误。在拟合模型下，将最大似然函数的值记作 \\(\\hat L\\)，可以使用统计量 \\(-2\\log\\hat{L}\\) 来比较替代嵌套模型。加速失效时间模型，也在第 5 章中描述，允许拟合具有许多事件时间分布的模型，包括 Weibull 模型。一般加速失效时间模型有\\[\\begin{aligned}\\log T_i=\\mu+\\alpha'\\mathbf{x}_i+\\sigma\\epsilon_i\\end{aligned}\\]其中 \\(\\epsilon_i\\) 的分布使得 \\(T_i\\) 呈 Weibull, log-logistic 或 log-normal 分布，\\(\\alpha\\) 参数是模型中解释变量的系数，\\(\\mu,\\sigma\\) 是位置和尺度参数。\\(n\\) 个区间删失事件时间的似然函数再次由式 (9.5) 给出，其中，使用式 (5.56)\\[\\begin{aligned}S_i(t)=S_{\\epsilon_i}\\left(\\frac{\\operatorname{log}t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\end{aligned}\\]\\(t\\) 取值 \\(l_i\\) 和 \\(u_i\\)。函数 \\(S_{\\epsilon_i}(\\cdot)\\) 对应于所选的事件时间分布。对于 Weibull 加速失效时间模型，\\(S_{\\epsilon_i}(\\epsilon)=\\exp(-e^{\\epsilon})\\)，所得似然函数等价于式 (9.8) 中的似然函数，其中对于 \\(j=1,2,\\ldots,p\\)\\[\\begin{aligned}\\lambda=\\exp(-\\mu/\\sigma),\\quad\\gamma=\\sigma^{-1},\\quad\\beta_j=-\\alpha_j/\\sigma\\end{aligned}\\]第 5 章 5.11 节给出了完整的详细信息。这些加速失效时间模型是通过最大化以 \\(\\boldsymbol{\\alpha},{\\mu}\\) 和 \\(\\sigma\\) 为参数的似然函数来拟合的，并使用 \\(-2\\log\\hat{L}\\) 统计量比较替代嵌套模型。AIC 统计量可用于比较非嵌套模型，例如具有不同事件时间分布的模型。参数模型的一个缺点是，在假定的分布模型中，风险和生存函数取决于相对较少的未知参数，这可能很难用区间删失数据进行验证。然而，更灵活的模型，如对数累积基线风险函数的 Royston Parmar 限制性立方样条模型，可以克服这一问题。6.4 节描述的模型的似然函数很容易使用式 (9.5) 获得，并且在拟合和比较替代的 Royston Parmar 模型时不涉及新的原理。示例 9.7  (溃疡复发) 本实例说明为溃疡复发时间的区间删失数据拟合 Weibull 比例风险模型。包含与 \\(Age,Duration\\) 和 \\(Treat\\) （对应于年龄、持续时间和治疗）对应的变量的 Weibull 模型的 \\(-2\\log\\hat{L}=74.291\\)，省略 \\(Age\\) 和 \\(Duration\\) 后，导致在两个自由度上增加 0.334. \\(-2\\log\\hat{L}\\) 的这种非显著变化意味着患者年龄和治疗持续时间对这组患者的溃疡复发时间都没有显著影响，如示例 9.5 和 9.6 所示。治疗 B 相对于治疗 的风险比为 1.251，这再次与在示例 9.5 和 9.6 的替代模型下发现的风险比非常相似。然而，这与一没有显著差异，因为当从模型中省略治疗项时，\\(-2\\log\\hat{L}\\) 统计量仅从 74.625 增加到 74.754.在模型的加速失效时间参数化中，时间比为 \\(e^{-0.258}=0.773\\)，这意味着治疗 B 将复发时间乘以 0.773. 接受治疗 B 的患者的复发时间估计约为接受治疗 的患者的 77%，因此治疗 B 有效地加快了导致溃疡复发的过程。","code":""},{"path":"chap9.html","id":"sec9-5","chapter":"第 9 章 区间删失生存数据","heading":"9.5 延伸阅读","text":"Sun (2006) 一书全面介绍了分析区间删失事件时间的统计模型和方法。Bogaerts, Komarek Lesaffre (2018) 提供了使用 R, SAS 和 BUGS 分析生存数据的实用介绍。另请参阅 Chen, Sun Peace (2013), Lindsey Ryan (1998), Lesaffre, Komárek Declerck (2005), Gómez et al. (2009) 以及 Zhang Sun (2010) 提供了有关此类数据分析方法的综述文章。Jewell van der Laan (2004) 回顾了当前状态数据的分析方法，并描述了竞争风险和多变量生存数据的扩展。Turnbull (1976) 引入了所谓的 Turnbull 区间，并描述了一种用于根据区间删失数据估计生存函数的自洽算法。EM 算法由 Dempster, Laird Rubin (1977) 描述，Groeneboom Wellner (1992) 引入了 Iterative Convex Minorant (ICM) 算法。Wellner Zahn (1997) 提出使用 EM 和 ICM 算法的组合。Wang et al. (2016) 提出使用样条函数来近似累积基线风险函数。Pan (1999) 展示了如何使用 ICM 算法来拟合比例风险模型。Zeng, Mao Lin (2016) 展示了如何使用 EM 算法来拟合具有时依变量的比例风险和比例几率半参数模型。Sun (2001) 描述了在右删失数据中获取生存函数标准误的 Greenwood 公式如何扩展到区间删失数据，并且还描述了当基于似然的方法失效时如何使用 bootstrap 方法。Goodall, Dunn Babiker (2004) 描述了三种方法，用于计算根据区间删失数据估计的非参数生存函数的逐点置信区间。许多作者已经讨论了区间删失数据的分段指数模型中分割点的位置。其中包括 Finkelstein (1986)，他建议每个区间内的预期事件数相似；Cai Betensky (2003) 描述了一种使用唯一区间端点分位数的方法。第 2 章描述了用于比较两组或多组右删失生存时间的一些非参数检验。类似于 log-rank 和 Wilcoxon 检验的检验统计量很容易构建，但数据的区间性质意味着更难获得这些程序的方差和渐近性质。Finkelstein (1986) 提出了一种得分检验，而 Sun (1996), Zhao Sun (2004) 将 log-rank 检验推广到区间删失数据。Fay (1996) 提出了比例几率模型下的一个检验，并描述了用于比较区间删失数据的生存函数的统一框架。Fay Shaw (2010) 还总结了加权 log-rank 检验（如 log-rank 检验和 Wilcoxon 检验）对区间删失数据的推广，描述了实现它们的 R 包。Huang, Lee Yu (2008) 描述了多重插补检验。Lindsey (1998) 回顾了参数模型在区间删失数据分析中的应用。Farrington (2000) 提供了与区间删失数据的比例风险模型一起使用的诊断方法的全面说明。Zhang et al. (2007) 考虑了在存在信息删失时对区间删失数据的分析。","code":""},{"path":"chap10.html","id":"chap10","chapter":"第 10 章 脆弱模型","heading":"第 10 章 脆弱模型","text":"在生存数据建模中，我们试图通过研究中记录的某些解释变量的值的不同，来解释观察到的诸如死亡等事件发生时间的变异。然而，即使考虑到这些变量的影响，他们的观测生存时间仍会有变异。有些人可能比其他人有更大的死亡风险，因此可能会更早死亡。他们可以被描述为更脆弱 (frail)，生存时间的变异可以通过个体之间这种脆弱效应 (frailty effect) 的变异性来解释。在研究中，经常会遇到个体组之间的生存时间不独立的情况。同一组个体的生存时间往往比不同组的个体更相似。那么，可以通过假定同组个体具有相同的脆弱性 (frailty) 来对这种效应进行建模。由于脆弱对一个组中所有个体来说都是共同的，因此引入了该组内个体生存时间之间一定程度的依赖性。因此，具有共享脆弱 (shared frailty) 的模型可用于对生存数据进行建模，其中预期事件时间之间存在某种关联，例如在涉及具有共同特征的个体组的研究中，或者当一个个体重复经历同一事件时。本章介绍了这些模型。","code":""},{"path":"chap10.html","id":"sec10-1","chapter":"第 10 章 脆弱模型","heading":"10.1 脆弱性的介绍","text":"研究中的个体之间几乎总是存在生存时间的变异。即使许多个体有相同的人口统计变量值，如年龄和性别，或其他解释变量相同的值，他们的生存时间通常也会不同。这些差异可能是因为影响生存的某些变量没有测量，或者个体的生存时间取决于无法测量的变量。可能有很多这样的变量，我们对这些变量的了解可能有限，以至于我们根本不知道可以解释这种变异性的变量是什么。为了说明这一点，请考虑诊断为患有危及生命的癌症的患者的生存时间。确诊后患者的生存时间取决于许多因素，包括癌症类型和肿瘤分期、患者的特征（如年龄、体重和生活方式），以及癌症的治疗方式。然而，可以发现，每个测量的解释变量都相同的患者具有不同的生存时间。个体之间的这种变异或异质性 (heterogeneity) 是会出现的，因为有些个体不如其他个体强大，无法用相对较少的已知变量来概括。事实上，我们永远无法知道所有可能对癌症患者生存产生影响的因素是什么，更不用说能够测量它们了，但我们可以在建模过程中考虑到它们。一组个体生存时间的变异可以用一些个体比其他个体更脆弱来描述。那些脆弱程度较高的个体往往死得更快。然而，个体脆弱的程度无法直接度量；如果可以的话，我们可能会尝试将其纳入生存时间模型中。相反，我们只观测脆弱效应对可观测生存时间 (observable survival times) 的影响。","code":""},{"path":"chap10.html","id":"sec10-1-1","chapter":"第 10 章 脆弱模型","heading":"10.1.1 随机效应","text":"在前几章描述的模型中，与感兴趣因素对应的效应总是假定为固定的。固定效应 (fixed effect) 的可能值不会变化，并假定它们的测量没有误差。例如，与性别相关的因素有两个不同的水平，即男性和女性，这在不同的研究中不会改变，总结两种性别之间的结果差异通常是有意义的。另一方面，随机效应 (random effect) 假定为具有从可能值总体中抽取的水平，其中实际水平代表该总体9。例如，在多中心临床试验中，可能采用的中心可认为是从更多可能的中心中抽取的。然后，我们将使用随机效应来为中心变异建模，对特定中心之间的结果进行比较的兴趣不大。随机效应假定为具有某种潜在概率分布随机变量的观测，该分布的方差用于总结其值的差异程度。这种效应通常具有许多可能的值，使用固定效应来表示它们之间的差异是不现实的，因为这会将大量未知参数引入模型。通过将它们视为随机效应，只有一个参数需要估计，即它们假定的潜在分布的方差。","code":""},{"path":"chap10.html","id":"sec10-1-2","chapter":"第 10 章 脆弱模型","heading":"10.1.2 个体脆弱性","text":"由于研究中个体的未知脆弱性本质上是从大量可能值中抽取的，因此我们将脆弱性视为随机效应。在随机效应的潜在分布方差很小的情况下，脆弱效应不会有太大差异，并且对推断的影响可以忽略不计。然而，如果脆弱性方差很大，即使考虑到其他潜在解释变量的影响，观测的个体生存时间也可能存在显着差异。当脆弱性存在时，越脆弱的人往往会更早死亡。这意味着在任何时间点观测到个体的样本生存时间时，仍然存活的个体将比从中抽取样本的相应总体更不脆弱10。由于脆弱是一种选择效应 (selection effect)，因此会对实际可观测的情况产生影响。例如，如果每个个体都有恒定的死亡风险，并且脆弱效应存在，越脆弱的个体就会更早死亡，而那些不那么脆弱的个体会生存更久。因此，观测风险函数可能会随着时间的推移而下降。例如，考虑一组经历过非致命心脏病发作的个体。对于这些个体，死亡风险通常会随着时间的推移而下降，这可能有两个原因。首先，个体可能只是适应了由心脏病发作引起的任何心脏损伤，从而使得潜在的死亡风险降低。或者，死亡风险可能是恒定的，但观测风险降低可能是由于脆弱性；风险较高的个体死亡较早，因此在任何时候，生存的个体都是那些不那么脆弱的个体。生存时间数据不能用来区分这两种可能的死亡风险明显下降的解释。同样，当考虑到脆弱效应时，风险比估计及其相关的标准误可能与忽略脆弱效应后获得的值大不相同。这一特征将在 10.3 节中说明。","code":""},{"path":"chap10.html","id":"sec10-1-3","chapter":"第 10 章 脆弱模型","heading":"10.1.3 共享脆弱性","text":"考虑个体脆弱程度的模型可用于评估未测量变量的值如何影响生存。然而，脆弱性的概念更广泛地用于许多人有共同特征的情况。例如，在多中心研究中，来自同一中心的个体的生存经历可能比来自不同中心的个体更相似。这可能是因为不同中心的临床团队不同，或者各中心的护理实践不同。同样，在动物实验中，由于遗传和环境的影响，来自同一窝的动物会比来自不同窝的动物更相似。因此，他们的生存时间是相关的，对生存时间之间的这种关联进行建模的一种方法是假定一个群体中所有个体都具有共享脆弱性 (shared frailty). 在涉及眼、耳或肾脏的配对器官研究中，记录配对中每个器官发生某些事件的时间，脆弱性可以包含在模型中，以考虑观测事件时间对之间的任何关联。因此，共享脆弱模型提供了一种在生存时间不独立时对生存数据进行建模的方法。一些研究导致个体内重复或反复出现事件时间。这类情况的例子包括对连续不良事件之间的时间，例如偏头痛或恶心的时间、牙齿填充物脱落的时间以及接受多次移植肾脏的患者移植失败的时间。在这里，个体内的事件时间可能不是独立的，为了对此建模，我们可以假定每个事件时间的脆弱性是相同的。因此，共享脆弱的概念可以扩展到个体内部重复发生事件的情况。","code":""},{"path":"chap10.html","id":"sec10-2","chapter":"第 10 章 脆弱模型","heading":"10.2 个体脆弱性建模","text":"个体生存时间之间的变异可以通过假定每个人都有自己的脆弱值来建模。假定该脆弱项对个体的死亡风险有乘性作用。那些脆弱性大于一的个体将增加事件发生的风险，而那些脆弱性小于一的人将减小事件发生的风险。考虑在某个时间 \\(t\\) 发生事件风险的比例风险模型，该模型的风险函数取决于 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 的值以及未知的基线风险函数 \\(h_0(t)\\)。第 \\(\\) 个个体的风险函数为\\[\\begin{align}\nh_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\n\\tag{10.1}\n\\end{align}\\]其中 \\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体的解释变量的值向量，\\(\\boldsymbol\\beta\\) 是其未知系数 \\(\\beta_1,\\beta_2,...,\\beta_p\\) 的向量。基线风险 \\(h_0(t)\\) 可以不指定，如 Cox 回归模型（第 3 章）或 \\(t\\) 的参数函数，如 Weibull 模型（第 5, 6 章）。我们现在引入一个乘性脆弱项 \\(z_i\\)\\[\\begin{align}\nh_i(t)=z_i\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\n\\tag{10.2}\n\\end{align}\\]脆弱项 \\(z_i\\) 不能为负，脆弱性越大，事件发生的风险就越大。若 \\(z_i=1\\) 则回到式 (10.1) 的标准模型，对应于没有脆弱效应的情况。0 和 1 之间的 \\(z_i\\) 值对应于风险小于潜在比例风险模型的风险的情况，发生于个体毅力增加时。\\(n\\) 个个体样本中 \\(z_i\\) 值的差异代表由脆弱效应导致的在任何给定时间死亡风险的变异。通常更方便的是使用脆弱效应的另一种表示，通过设 \\(z_i=\\exp(u_i)\\) 来获得。然后可以写出式 (10.2) 中的模型\\[\\begin{align}\nh_i(t)=\\exp(\\boldsymbol{\\beta'x}_i+u_i)h_0(t)\n\\tag{10.3}\n\\end{align}\\]在该模型中，\\(u_i=\\log z_i\\) 是比例风险模型线性部分中的随机效应。注意，尽管脆弱性 \\(z_i\\) 不能是负的，但 \\(u_i\\) 可以取任何值，无论正或负，并且 \\(u_i＝0\\) 对应于 \\(z_i＝1\\) 的不存在脆弱性的情况。在式 (10.3) 中，比例风险模型的线性部分已扩展为包括随机效应，并且生存时间模型的这一部分现在类似于一般和广义线性建模其他领域中使用的混合模型 (mixed models).式 (10.3) 中的 \\(u_i(=1,2,\\ldots,n)\\) 视为 \\(n\\) 个独立且同分布的随机变量 \\(U_i\\) 观测值或实现 (realisations). 其中，假定每个随机变量 \\(U_i\\) 具有共同概率分布。因此，尽管一组个体的脆弱性可能都不同，但它们来自相同的潜在概率分布。示例 10.1  (患乳腺癌妇女的预后) 第 1 章示例 1.2 中关于肿瘤呈阴性或阳性染色的两组妇女生存时间的数据表明，每组妇女的生存时间存在差异。阴性染色组的实际生存时间从 23 个月到 224 个月以上，而阳性染色组的生存时间从 5 个月到 225 个月以上。为了总结这些数据，如示例 5.6 所示，拟合了包含与阳性或阴性染色相关因素的 Weibull 比例风险模型。基线风险函数估计为：\\(\\hat{h}_0(t)=\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}-1}\\)，其中，\\(\\hat\\lambda=0.00414\\)，且 \\(\\hat\\gamma=0.937\\)。使用第 5 章式 (5.43)，第 \\((=1,2,\\ldots,45)\\) 个妇女的相应生存函数估计，由下式给出\\[\\hat{S}_i(t)=\\exp\\{-\\exp(\\hat{\\beta}x_i)\\hat{\\lambda}t^{\\hat{\\gamma}}\\}\\]其中 \\(x_i=0\\) 表示阴性染色的女性，\\(x_i=1\\) 表示阳性染色的女性。肿瘤呈阳性染色的女性与肿瘤呈阴性染色的女性的相应风险比为 2.545，95% 置信区间为 \\((0.93,6.98)\\)。拟合的 Weibull 生存函数如图 10.1 所示，叠加在生存函数的 Kaplan-Meier 估计上。Weibull 模型似乎对肿瘤阳性染色的女性的生存时间拟合得不太好。\n在此图中，数据仅总结为两条曲线。然而，脆弱性的引入将导致每个女性的生存函数估计不同，我们将在示例 10.2 中回到这一点。","code":""},{"path":"chap10.html","id":"sec10-2-1","chapter":"第 10 章 脆弱模型","heading":"10.2.1 脆弱性分布","text":"在式 (10.3) 的模型中，通常假定与随机效应相关的随机变量 \\(U_i,=1,2,\\ldots,n\\) 具有零均值和共同方差 \\(\\sigma^2_u\\) s的正态分布。如果 \\(U_i\\sim N(0,\\sigma^2_u)\\) ，则 \\(Z_i=\\exp(U_i)\\) 具有 lognormal 分布。第 5 章 5.1.4 节介绍了这种分布。由于式 (10.2) 模型中的 \\(z_i＝1\\) 对应于不存在脆弱性的情况，因此脆弱性分布最好以一为中心。通过将随机脆弱效应 \\(U_i\\) 围绕零均值分布，\\(Z_i\\) 的相应分布的中位数为一。然而，\\(Z_i\\) 的期望值是\\[\\begin{align}\n\\operatorname{E}\\left(Z_i\\right)=\\exp(\\sigma_u^2/2)\n\\tag{10.4}\n\\end{align}\\]将不等于 1.0，并且 \\(Z_i\\) 的方差由下式给出\\[\\begin{align}\n\\mathrm{var}\\left(Z_i\\right)=\\exp(\\sigma_u^2)\\{\\exp(\\sigma_u^2)-1\\}\n\\tag{10.5}\n\\end{align}\\]式 (10.4) 和 (10.5) 中的结果显示了如何从相应的正态分布随机效应的方差 \\(\\sigma^2_u\\) 中得到 lognormal 脆弱性分布的均值和方差。另一种方法是将 \\(U_i\\) 取为均值 \\(-\\sigma_u^2/2\\)、方差为 \\(\\sigma^2_u\\) 的正态分布。尽管如此一来 \\(Z_i\\) 的均值为一，但这种表示在实践中并未广泛使用。gamma 分布与 lognormal 分布非常相似，如第 5 章 5.1.6 节所述，因此这是脆弱性随机变量 \\(Z_i\\) 的另一种分布。这种脆弱性分布使用起来有时比 lognormal 模型更方便，并且可用于研究引入脆弱效应的一些后果，我们将在 10.3 节中进行研究。如果我们取 \\(Z_i\\) 具有 gamma 分布，未知参数等于 \\(\\theta\\)，对于 \\(z_i>0\\) 密度为\\[f(z_i)=\\frac{\\theta^\\theta z_i^{\\theta-1}e^{-\\theta z_i}}{\\Gamma(\\theta)},~\\theta\\geqslant0\\]则 \\(Z_i\\sim\\Gamma(\\theta,\\theta)\\)。这种脆弱性分布的均值为 1，方差为 \\(1/\\theta\\)。\\(\\theta\\) 值越大，脆弱性方差越小，当 \\(\\theta\\rightarrow \\infty\\), 脆弱性方差趋于零，对应于 \\(z_i\\) 都等于一并且不存在脆弱性的情况。对于 \\(-\\infty<u_i<\\infty\\)，\\(U_i=\\log(Z_i)\\) 的相应分布的密度\\[\\begin{align}\nf(u_i)=\\frac{\\theta^\\theta e^{\\theta u_i}\\exp(-\\theta e^{u_i})}{\\Gamma(\\theta)},\\theta\\geqslant0\n\\tag{10.6}\n\\end{align}\\]称 \\(U_i\\) 具有 exp-gamma 分布。又称为 log-gamma 分布，但这种命名法与 lognormal 分布的定义不一致。\\(U_i\\) 众数为零，但分布是不对称的，并且 \\(U_i\\) 的均值和方差用 digamma 和 trigamma 函数表示。具体地\\[\\begin{align}\n\\operatorname{E}\\left(U_i\\right)=\\Psi(\\theta)-\\log\\theta\n\\tag{10.7}\n\\end{align}\\]其中，digamma 函数 \\(\\Psi(\\theta)\\) 可从如下的级数展开中获得\\[\\begin{aligned}\\Psi(\\theta)&=-\\lambda+\\sum_{j=0}^\\infty\\frac{\\theta-1}{(1+j)(\\theta+j)}\\end{aligned}\\]这里 \\(\\lambda=0.577216\\) 为欧拉常数。此外，\\(U_i\\) 的方差是 \\(\\Psi(\\theta)\\) 的导数，记为 \\(\\Psi'(\\theta)\\)，称为 trigamma 函数。该函数也可用级数展开来获得，并且\\[\\begin{align}\n\\mathrm{var}\\left(U_i\\right)=\\Psi^{\\prime}(\\theta)=\\sum_{j=0}^{\\infty}\\frac1{(\\theta+j)^2}\n\\tag{10.8}\n\\end{align}\\]digamma 和 trigamma 函数在许多统计软件包中可作为标准函数使用。稍后将在示例 10.3 中比较脆弱性的 lognormal 分布和 gamma 分布，以及随机效应相应的正态分布和 exp-gamma 分布。","code":""},{"path":"chap10.html","id":"sec10-2-2","chapter":"第 10 章 脆弱模型","heading":"10.2.2 可观测生存函数和风险函数","text":"根据第 1 章式 (1.6) 和 (1.7)，第 \\(\\) 个个体的生存函数为\\[S_i(t)=\\exp\\left\\{-\\int_0^th_i(t)\\mathrm{~d}t\\right\\}\\]其中 \\(h_i(t)\\) 在式 (10.2) 中给出。因此\\[\\begin{align}\nS_i(t)=\\exp\\{-z_ie^{\\boldsymbol{\\beta'x}_i}H_0(t)\\}\n\\tag{10.9}\n\\end{align}\\]其中 \\(H_0(t)\\) 是基线累积风险函数。这是第 \\(\\) 个个体以脆弱性 \\(z_i\\) 为条件的生存函数，称为生存时间的条件模型 (conditional model).个体脆弱性 \\(z_i\\) 无法直接观测，因此我们观测到的是它们对个体组的整体生存函数的效应。因此，可观测生存函数是对所有可能的 \\(z_i\\) 值取平均的个体函数，即 \\(S_i(t)\\) 关于脆弱性分布的期望值11。如果相应的随机变量 \\(Z_i\\) 具有离散分布，其中只可取几个特定的脆弱值，我们将通过对不同 \\(z_i\\) 值的 \\(S_i(t)\\) 的可能值与 \\(Z_i\\) 等于 \\(z_i\\) 的概率的乘积进行求和，来得到这个期望值12。然而，我们通常假定 \\(Z_i\\) 的分布是连续的，在这种情况下，观测生存函数是通过将式 (10.9) 中的 \\(S_i(t)\\) 关于 \\(Z_i\\) 的分布进行积分而得到的。所得生存函数为\\[\\begin{align}\nS_i^*(t)&=\\int_0^\\infty S_i(t)f(z_i)\\mathrm{d}z_i=\\int_0^\\infty\\exp\\{-z_ie^{\\boldsymbol{\\beta'x}_i}H_0(t)\\}f(z_i)\\mathrm{d}z_i\n\\tag{10.10}\n\\end{align}\\]其中 \\(f(z_i)\\) 是脆弱性分布的密度函数。量 \\(S^*_i(t)\\) 是无条件或可观测生存函数 (unconditional observable survivor function)，式 (10.10) 定义了生存时间的无条件模型 (unconditional model).一旦获得了特定模型的 \\(S^*_i(t)\\)，就可以使用第 1 章式 (1.5) 中的关系式找到相应的可观测风险函数 \\(h^*_i(t)\\)，从而\\[\\begin{align}\nh_i^*(t)=-\\frac{\\mathrm{d}}{\\mathrm{dt}}\\{\\log S_i^*(t)\\}\n\\tag{10.11}\n\\end{align}\\]通常，式 (10.10) 中的积分必须通过数值计算完成，但正如我们将在下一节看到的，这可以在脆弱效应为 gamma 分布的特殊情况下解析地实现。","code":""},{"path":"chap10.html","id":"sec10-3","chapter":"第 10 章 脆弱模型","heading":"10.3 gamma 脆弱性分布","text":"gamma 分布常用于为脆弱效应建模，因为它得出了可观测生存和风险函数的闭合形式表示，如本节所示。假定研究中的每个个体都有一个不同的脆弱性值 \\(z_i\\)，并且这些是对独立且同分布随机变量 \\(Z_i\\) 的观测，\\(=1,2,\\ldots,n\\)，其中 \\(Z_i\\sim\\Gamma(\\theta,\\theta)\\)。现在，根据式 (10.10)，可观测生存函数为\\[\\begin{aligned}S_i^*(t)&=\\int_0^\\infty S_i(t)f(z_i)\\mathrm{d}z_i\\end{aligned}\\]因此\\[\\begin{aligned}S_i^*(t)&=\\int_0^\\infty\\exp\\{-z_ie^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}H_0(t)\\}\\frac{\\theta^\\theta z_i^{\\theta-1}e^{-\\theta z_i}}{\\Gamma(\\theta)}\\mathrm{d}z_i\\end{aligned}\\]经过整理，得到\\[\\frac{\\theta^\\theta[\\theta+e^{\\boldsymbol{\\beta}\\prime\\boldsymbol{x}_i}H_0(t)]^{-\\theta}}{\\Gamma(\\theta)}\\int_0^\\infty y_i^{\\theta-1}e^{-y_i}\\mathrm{~d}y_i\\]其中 \\(y_i=\\{\\theta+e^{\\boldsymbol{\\beta'x}_i}H_0(t)\\}z_i\\)。然后根据第 5 章的式 (5.6) 中 gamma 函数的定义，\\[\\int_0^\\infty y_i^{\\theta-1}e^{-y_i}\\mathrm{~d}y_i=\\Gamma(\\theta)\\]所以\\[\\begin{align}\nS_i^*(t)=\\{1+\\theta^{-1}e^{\\boldsymbol{\\beta}'\\boldsymbol{x}_i}H_0(t)\\}^{-\\theta}\n\\tag{10.12}\n\\end{align}\\]式 (10.11) 得到可观测风险函数，由下式给出\\[\\begin{align}\nh_i^*(t)=\\frac{e^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}h_0(t)}{1+\\theta^{-1}e^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}H_0(t)}\n\\tag{10.13}\n\\end{align}\\]下一节将说明引入脆弱效应的一些后果。","code":""},{"path":"chap10.html","id":"sec10-3-1","chapter":"第 10 章 脆弱模型","heading":"10.3.1 脆弱性对可观测风险函数的影响","text":"为了说明脆弱项对风险函数的影响，我们将脆弱性随机变量 \\(Z_i\\) 设为 \\(\\Gamma(\\theta,\\theta)\\) 分布。假设基线风险函数 \\(h_0(t)\\) 是一个常数 \\(\\lambda\\)，并且我们为生存时间的单个样本拟合模型，因此不存在协变量。使用式 (10.13)，可观测风险函数为\\[h^*(t)=\\frac{\\theta\\lambda}{\\theta+\\lambda t}\\]\\(t=0\\) 时其值为 \\(\\lambda\\)，之后非线性地减小为 0. 因此，脆弱效应的存在为风险函数的减小提供了另一种解释。具体来说，一个事件的总体风险实际上可能是恒定的，但研究中个体生存时间之间的异质性意味着观察到风险的减小。如果我们假定潜在的基线风险取决于时间，也会发现类似的特征。在潜在基线风险是 Weibull 的情况下，\\(h_0(t)=\\lambda\\gamma t^{\\gamma-1}\\)，并且没有协变量，得到\\[h^*(t)=\\frac{\\theta\\lambda\\gamma t^{\\gamma-1}}{\\theta+\\lambda t^\\gamma}\\]对于 \\(\\lambda=1,\\gamma=3\\) 和各种 \\(\\theta\\) 值的 Weibull 风险，\\(h^*(t)\\) 与 \\(t\\) 的关系图如图 10.2 所示。Weibull 基线风险函数的一个局限性，如第 5 章 5.1.2 节所述，是单调的。然而，如图 10.2 所示，当存在一定程度的脆弱性时，我们可能会观察到单峰风险函数。因此，观察到的单峰风险可能是脆弱效应的结果，而不是潜在基线风险的内在行为。","code":""},{"path":"chap10.html","id":"sec10-3-2","chapter":"第 10 章 脆弱模型","heading":"10.3.2 脆弱性对可观测风险比的影响","text":"假设第 \\(\\) 个个体的风险函数为\\[\\begin{aligned}h_i(t)=z_i\\exp(\\beta x_i)h_0(t)\\end{aligned}\\]其中 \\(x_i\\) 是二元协变量 \\(X\\) 的值，取值 0 或 1，\\(z_i\\) 是 \\(\\Gamma(\\theta,\\theta)\\) 随机变量的实现。根据式 (10.13)，相应的可观测风险函数为\\[h_i^*(t)=\\frac{e^{\\beta x_i}h_0(t)}{1+\\theta^{-1}e^{\\beta x_i}H_0(t)}\\]\\(X = 1\\) 相对于 \\(X = 0\\) 的可观测风险比为\\[\\begin{align}\n\\psi^*(t)=\\frac{1+\\theta^{-1}H_0(t)}{1+\\theta^{-1}e^\\beta H_0(t)}e^\\beta\n\\tag{10.14}\n\\end{align}\\]该风险比不再恒定，而是时间 \\(t\\) 的函数，因此比例风险不再适用。例如，在假定潜在基线风险为常数 \\(\\lambda\\) 的特定情况下，\\(H_0(t) = \\lambda t\\) 且风险比\\[\\frac{1+\\theta^{-1}\\lambda t}{1+\\theta^{-1}e^\\beta\\lambda t}e^\\beta \\]为 \\(t\\) 的非线性函数。为了说明可观测风险比对时间的依赖性，图 10.3 显示了 Weibull 基线风险的风险比 \\(\\psi^*(t)\\)，其中 \\(\\lambda = 1,\\gamma = 3,\\psi = e^\\beta = 3\\)，\\(\\theta\\) 取不同的值。\n当不存在脆弱性时，即当 \\(θ = \\infty\\) 时，风险比恒定为 3，但当脆弱性方差大于零时，可观测风险比会随着时间的推移而下降。风险比对时间的依赖性可用于解释任何观测风险中的非比例性。这些结果表明，在 Weibull 比例风险回归模型中包含随机效应会导致风险不成比例，并导致非单调的风险函数。尽管这是使用具有 gamma 脆弱性的 Weibull 模型进行的说明，但得出的结论更适用于一般情况。这意味着，在风险函数为单峰或风险不成比例的情况下，包括随机效应的模型提供了另一种数据建模方式。","code":""},{"path":"chap10.html","id":"sec10-4","chapter":"第 10 章 脆弱模型","heading":"10.4 拟合参数脆弱模型","text":"拟合式 (10.3) 中的模型需要估计解释变量的系数、脆弱性分布的方差和基线风险函数。完全指定 \\(h_0(t)\\) 的模型，如 Weibull 比例风险模型或加速失效时间模型，可用最大似然法进行拟合。用对子 \\((t_i,\\delta_i)\\) 表示观测生存数据，\\(=1,2,\\ldots,n\\)，其中 \\(t_i\\) 是生存时间，\\(\\delta_i\\) 是事件指示符，其取 0 值表示删失观测，取 1 值表示事件。如果式 (10.3) 中的随机效应 \\(u_i\\) 具有已知值，如第 5 章式 (5.15) 所示，似然函数将为\\[\\begin{align}\n\\prod_{=1}^n\\{h_i(t_i)\\}^{\\delta_i}S_i(t_i)\n\\tag{10.15}\n\\end{align}\\]在该表达式中，式 (10.3) 给出了第 \\(\\) 个个体的风险函数，相应的生存函数为\\[\\begin{align}\nS_i(t_i)=\\exp\\left\\{-\\exp(\\boldsymbol{\\beta'x}_i+u_i)H_0(t_i)\\right\\}\n\\tag{10.16}\n\\end{align}\\]其中 \\(H_0(t_i)\\) 是累积风险函数在时间 \\(t_i\\) 处的值。然而，\\(u_i\\) 是未知的，而是独立且同分布随机变量的实现，其密度为 \\(f(u_i)\\)。在这种情况下，我们对似然贡献关于随机效应的可能值进行积分，从而根据式 (10.15)，似然函数变为\\[\\begin{align}\n\\prod_{=1}^n\\int_{-\\infty}^\\infty\\{h_i(t_i)\\}^{\\delta_i}S_i(t_i)f(u_i)\\mathrm{~d}u_i\n\\tag{10.17}\n\\end{align}\\]或等价地，当使用脆弱项 \\(z_i\\) 时，\\[\\begin{align}\n\\prod_{=1}^n\\int_0^\\infty\\{h_i(t_i)\\}^{\\delta_i}S_i(t_i)f(z_i)\\mathrm{d}z_i\n\\tag{10.18}\n\\end{align}\\]通常需要数值方法来最大化该函数或其对数。一旦估计了全参数模型中的未知参数，就有可能获得随机效应的估计。为此，我们使用贝叶斯定理的一个版本，这将在第 16 章中以式 (16.2) 给出。根据该定理，以事件 B 为条件，事件 的概率为\\[\\begin{align}\n\\operatorname{P}(\\mid B)&=\\frac{P(B\\mid )P()}{P(B)}\n\\tag{10.19}\n\\end{align}\\]现在，将随机效应 \\(u_i\\) 视为固定的，我们将第 \\(\\) 个事件时间 \\(t_i\\) 的似然记作 \\(L(t_i\\mid u_i)\\)，结合式 (10.16) 和式 (10.15)，其为\\[\\begin{aligned}L(t_i\\mid u_i)=\\{\\exp(\\boldsymbol{\\beta'x}_i+u_i)h_0(t_i)\\}^{\\delta_i}\\exp\\{-\\exp(\\boldsymbol{\\beta'x}_i+u_i)H_0(t_i)\\}\\end{aligned}\\]这可以解释为 \\(t_i\\) 以随机效应 \\(u_i\\) 为条件的概率。接下来，随机效应特定值的概率是密度函数 \\(f(u_i)\\)。使用式 (10.19)，\\(u_i\\) 以 \\(t_i\\) 为条件的概率可以表示为\\[\\begin{align}\n\\pi(u_i\\mid t_i)&=\\frac{L(t_i\\mid u_i)f(u_i)}{p(t_i)}\n\\tag{10.20}\n\\end{align}\\]其中 \\(p(t_i)\\) 是数据的边际概率，通过对 \\(L(t_i\\mid u_i)f(u_i)\\) 关于 \\(u_i\\) 积分获得。这确保 \\(\\pi(u_i\\mid t_i)\\) 的积分为 1，从而定义了适当的概率密度函数。然后，以数据为条件，可以获得与第 \\(\\) 个随机效应相关的随机变量 \\(U_i\\) 的分布 \\(\\pi(u_i\\mid t_i)\\) 的均值或众数。最后，代入未知 \\(\\beta\\) 系数估计和脆弱性分布的方差估计，我们得到了 \\(U_i\\) 的分布的均值或众数的估计 \\(\\hat u_i\\)，这可以视为随机效应的估计。出于式 (10.19) 与贝叶斯定理的联系，\\(\\pi(u_i\\mid t_i)\\) 称为 \\(u_i\\) 的后验密度 (posterior density)，并且估计 \\(\\hat u_i\\) 称为经验贝叶斯估计 (empirical Bayes estimates). 以类似的方式，\\(U_i\\) 的后验方差可根据 \\(\\pi(u_i\\mid t_i)\\) 获得，这得到了 \\(\\hat u_i\\) 的标准误。脆弱效应及其标准误的相应估计值是根据 \\(\\hat{z}_i=\\exp(\\hat{u}_i)\\) 获得的。一旦估计出脆弱效应，可用式 (10.9) 或 (10.16) 获得生存函数的完全参数估计。然后可以根据下式得到特定个体的中位生存时间\\[\\begin{align}\n\\left\\{\\frac{\\log2}{\\hat{\\lambda}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i+\\hat{u}_i)}\\right\\}^{1/\\hat{\\gamma}}\n\\tag{10.21}\n\\end{align}\\]这是第 5 章式 (5.48) 中结果的直接改编。当脆弱效应具有 gamma 分布时，带脆弱性的参数生存模型最容易拟合，因此该特定模型的拟合过程在下一节描述。","code":""},{"path":"chap10.html","id":"sec10-4-1","chapter":"第 10 章 脆弱模型","heading":"10.4.1 gamma 脆弱性","text":"当假定脆弱性随机变量 \\(Z_i\\) 具有 gamma 分布时，可以获得式 (10.18) 中积分似然的封闭形式。为证明这一点，将风险函数、生存函数和 \\(Z_i\\) 的密度代入式 (10.18)，似然函数为\\[\\begin{aligned}\\prod_{=1}^n\\int_0^\\infty\\{z_ie^{\\boldsymbol{\\beta}'\\boldsymbol{x}_i}h_0(t_i)\\}^{\\delta_i}\\exp\\{-z_ie^{\\boldsymbol{\\beta}'\\boldsymbol{x}_i}H_0(t_i)\\}\\frac{\\theta^\\theta z_i^{\\theta-1}e^{-\\theta z_i}}{\\Gamma(\\theta)}\\mathrm{d}z_i\\end{aligned}\\]合并关于 \\(z_i\\) 的项，这成为\\[\\begin{aligned}\\prod_{=1}^n\\frac{\\theta^\\theta}{\\Gamma(\\theta)}\\{e^{\\boldsymbol{\\beta}'\\boldsymbol{x}_i}h_0(t_i)\\}^{\\delta_i}\\int_0^\\infty z_i^{\\theta+\\delta_i-1}\\exp\\{-[\\theta+e^{\\boldsymbol{\\beta}'\\boldsymbol{x}_i}H_0(t_i)]z_i\\}\\mathrm{d}z_i\\end{aligned}\\]接下来，参数为 \\(r\\) 和 \\(\\theta\\) 的 gamma 随机变量 \\(Y\\) 的密度为\\[\\begin{align}\nf(y)=\\frac{\\theta^ry^{r-1}e^{-\\theta y}}{\\Gamma(r)}\n\\tag{10.22}\n\\end{align}\\]因此\\[\\int_0^\\infty y^{r-1}e^{-\\theta y}\\mathrm{~d}y=\\frac{\\Gamma(r)}{\\theta^r}\\]从而\\[\\int_0^\\infty z_i^{\\theta+\\delta_i-1}\\exp\\{-[\\theta+e^{\\boldsymbol{\\beta'x}_i}H_0(t_i)]z_i\\}\\mathrm{~d}z_i=\\frac{\\Gamma(\\theta+\\delta_i)}{\\{\\theta+e^{\\boldsymbol{\\beta'x}_i}H_0(t_i)\\}^{\\theta+\\delta_i}}\\]因此，似然函数变为\\[\\begin{aligned}\\prod_{=1}^n\\frac{\\theta^\\theta}{\\Gamma(\\theta)}\\{e^{\\boldsymbol{\\beta}'\\boldsymbol{x}_i}h_0(t_i)\\}^{\\delta_i}\\frac{\\Gamma(\\theta+\\delta_i)}{\\{\\theta+e^{\\boldsymbol{\\beta}'\\boldsymbol{x}_i}H_0(t_i)\\}^{\\theta+\\delta_i}}\\end{aligned}\\]相应的对数似然函数为\\[\\begin{align}\n\\sum_{=1}^n&\\{\\theta\\log\\theta-\\log\\Gamma(\\theta)+\\log\\Gamma(\\theta+\\delta_i)+\\delta_i[\\boldsymbol{\\beta'x}_i+\\log h_0(t_i)]\\}\\\\&-\\sum_{=1}^n(\\theta+\\delta_i)\\log\\{\\theta+e^{\\boldsymbol{\\beta'x}_i}H_0(t_i)\\}\n\\tag{10.23}\n\\end{align}\\]现在不涉及积分，可使用标准的数值方法关于 \\(\\theta,\\beta\\) 和基线风险函数中的参数最大化该函数，以给出最大似然估计。这些估计的标准误是从相应的信息矩阵中得出的；参见附录 。然后可以利用 \\(\\theta\\) 的最大似然估计 \\(\\hat\\theta\\) 使用式 (10.8) 来得到随机效应的方差估计。当假定脆弱效应具有 gamma 分布时，为了获得脆弱效应的估计，使用 \\(z_i\\) 而不是相应的随机效应 \\(u_i\\) 更方便。当脆弱性 \\(z_i\\) 固定时，将 \\(t_i\\) 的似然写为 \\(L(t_i\\mid z_i)\\)，则式 (10.20) 的分子为 \\(L(t_i\\mid z_i)f(z_i)\\)，即\\[[z_ie^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}h_0(t_i)]^{\\delta_i}\\exp\\{-z_ie^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}H_0(t_i)\\}~\\frac{\\theta^\\theta z_i^{\\theta-1}e^{-\\theta z_i}}{\\Gamma(\\theta)}\\]忽略不涉及 \\(z_i\\) 的项，\\(Z_i\\) 的后验密度 \\(\\pi(z_i\\mid t_i)\\)，与下式成比例\\[z_i^{\\theta+\\delta_i-1}\\exp\\{-[\\theta+e^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}H_0(t_i)]z_i\\}\\]根据式 (10.22) 所示的双参数 gamma 密度函数的一般形式，可以得出 \\(Z_i\\) 的后验分布是参数为 \\(\\theta+\\delta_i\\) 和 \\(\\theta+e^{\\boldsymbol{\\beta'x}_i}H_0(t_i)\\) 的 gamma 分布。那么，由于参数为 \\(r,\\theta\\) 的 gamma 随机变量的期望值是 \\(r/\\theta\\)，因此给定数据的 \\(Z_i\\) 的期望值为\\[\\operatorname{E}\\left(Z_i\\mid t_i\\right)=\\frac{\\theta+\\delta_i}{\\theta+e^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}H_0(t_i)}\\]据此，对第 \\(\\) 个个体的脆弱效应的估计为\\[\\begin{aligned}\\hat{z}_i&=\\frac{\\hat{\\theta}+\\delta_i}{\\hat{\\theta}+e^{\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i}\\hat{H}_0(t_i)}\\end{aligned}\\]其中，\\(\\hat{H}_0(t)\\) 是基线累积风险函数估计。类似地，gamma 随机变量的方差为 \\(r/\\theta^2\\)，因此\\[\\begin{aligned}\\operatorname{var}\\left(Z_i\\mid t_i\\right)&=\\frac{\\theta+\\delta_i}{\\{\\theta+e^{\\boldsymbol{\\beta}'\\boldsymbol{x}_i}H_0(t_i)\\}^2}\\end{aligned}\\]\\(Z_i\\) 的方差估计减小为 \\(\\hat{z}_i^2/(\\hat{\\theta}+\\delta_i)\\)，因此 \\(\\hat z_i\\) 的标准误由下式给出\\[\\mathrm{se}\\left(\\hat{z}_i\\right)=\\frac{\\hat{z}_i}{\\sqrt{(\\hat{\\theta}+\\delta_i)}}\\]那么可以得出脆弱项的区间估计，并且可以将 \\(\\hat z_i\\) 与其标准误的比与标准正态分布的百分位点进行比较，以检验第 \\(\\) 个脆弱效应为零的假设，并给出 \\(P\\) 值。然而，这一系列关于随机效应的计划外假设检验的结果，以考虑重复的显著性检验，例如通过 Bonferroni 校正。使用这种校正，在解释显著性水平之前，\\(n\\) 个个体的脆弱项的 \\(P\\) 值都需要各自乘以 \\(n\\)。正如这项分析所表明的，处理 gamma 脆弱在数学上是简单的，并得到了许多量的闭合形式估计。在其他情况下，需要使用数值方法来计算给定数据的脆弱性条件分布的总结统计量。示例 10.2  (患乳腺癌妇女的预后) 当具有 gamma 分布的脆弱项包含在 Weibull 模型中，用于计算具有阴性和阳性染色肿瘤的女性的生存时间时，如示例 10.1 所示，所得风险函数为 \\(h_i(t)=z_i\\exp(\\beta x_i)\\lambda\\gamma t^{\\gamma-1}\\)，相应拟合的生存函数为\\[\\hat{S}_i(t)=\\exp\\{-\\hat{z}_i\\exp(\\hat{\\beta}x_i)\\hat{\\lambda}t^{\\hat{\\gamma}}\\}\\]脆弱性潜在 gamma 分布的方差为 \\(\\hat \\theta^{−1} = 3.40\\)，并且脆弱效应的估计遵循本节概述的方法。在脆弱性存在的情况下，\\(\\hat{\\beta}=2.298\\)，阳性染色女性与阴性染色女性的风险比为 9.95. 然而，这一估计的 95% 置信区间在 0.86 至 115.54 之间，这反映出考虑了脆弱性后，染色效应的不确定性要大得多。同样重要的是要注意，风险比估计是以脆弱性为条件的，因此指的是具有特定脆弱值的女性。\\(\\lambda,\\gamma\\) 的新的估计分别为 0.00008 和 1.9091，个体脆弱值值与观测生存时间如表 10.1 所示。请注意，生存时间最短的女性有最大的脆弱效应估计。\n生存函数的个体估计如图 10.4 所示。该图说明了脆弱效应导致的生存函数估计的变异程度，并表明肿瘤呈阳性或阴性染色的女性的估计存在一定程度的分离。\n使用式 (10.21) 计算个体的中位生存时间，阴性染色组为 55 至 372 个月，阳性染色组为 16 至 355 个月。在 32 名肿瘤呈阳性染色的女性中，有 18 名中位生存时间比阴性染色组中的任何女性都要短。这证实，一旦考虑脆弱效应，两组女性的生存时间差异就不会那么明显。根据式 (10.12)，在该模型下，肿瘤呈阴性染色的女性的可观测生存函数估计为 \\(\\{1+\\hat{\\theta}^{-1}\\hat{H}_0(t)\\}^{-\\hat{\\theta}}\\)，而阳性染色则为 \\(\\{1+\\hat{\\theta}^{-1}e^{\\hat{\\beta}}\\hat{H}_0(t)\\}^{-\\hat{\\theta}}\\)。这些函数如图 10.5 所示，叠加在生存函数的相应 Kaplan-Meier 估计上。将其与图 10.1 进行比较，我们发现，一旦考虑了脆弱性，Weibull 模型对观测生存时间就提供了更好的拟合。该图还提供了拟合模型适用性的直观确认。\n图 10.6 给出了肿瘤呈阳性染色的女性相对于肿瘤呈阴性染色的女性的可观测或无条件的风险比，该风险比由式 (10.14) 得出。该图显示了可观测风险比如何随时间变化；早期的风险要大得多，但下降得很快。这是由于脆弱性的选择效应，越脆弱的女性死得越早。阳性染色组也有更多的早期死亡，这就是观测风险比以这种方式变化的原因。","code":""},{"path":"chap10.html","id":"sec10-5","chapter":"第 10 章 脆弱模型","heading":"10.5 拟合半参数脆弱模型","text":"当基线风险函数未假定潜在的参数形式时，如 Cox 回归模型，则不能再使用前一节中描述的脆弱模型拟合程序。这是因为式 (10.15) 中的似然函数不再完全指定。目前在标准软件包中最广泛实施的方法涉及最大化两个函数之和：包含随机效应的 Cox 模型的偏对数似然函数 \\(\\log L_p(\\boldsymbol{\\beta},\\boldsymbol{u})\\) 以及随机效应的偏对数似然函数。所得对数似然函数为\\[\\begin{align}\n\\log L_p(\\boldsymbol{\\beta},\\boldsymbol{u})+\\sum_{=1}^n\\log f(u_i)\n\\tag{10.24}\n\\end{align}\\]其中 \\(\\boldsymbol\\beta\\) 为 Cox 回归模型中 \\(p\\) 个解释变量的系数向量，\\(\\boldsymbol u\\) 为 \\(n\\) 个个体的随机效应向量。将第 3 章式 (3.6) 偏对数似然中的 \\(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\) 替换为 \\(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i+u_i\\)，得到了偏对数似然\\[\\begin{align}\n\\log L_p(\\boldsymbol{\\beta},\\boldsymbol{u})=\\sum_{=1}^n\\delta_i\\left\\{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i+u_i-\\log\\sum_{l\\R(t_i)}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l+u_l)\\right\\}\n\\tag{10.25}\n\\end{align}\\]其中 \\(\\delta_i\\) 是事件指示符，\\(R(t_i)\\) 是在时间 \\(t_i\\) 有死亡风险的患者集合。随机效应 \\(u_i\\) 是脆弱随机变量 \\(U_i=\\exp(Z_i)\\) 的观测值，其中 \\(Z_i\\) 通常认为具有 lognormal 分布或 gamma 分布。","code":""},{"path":"chap10.html","id":"sec10-5-1","chapter":"第 10 章 脆弱模型","heading":"10.5.1 lognormal 脆弱效应","text":"当假定脆弱效应为 lognormal 分布时，式 (10.24) 中的随机效应 \\(u_i\\) 是随机变量 \\(N(0,\\sigma^2_u)\\) 的实现，密度为\\[f(u_i)=\\frac1{\\sigma_u\\surd(2\\pi)}\\exp\\left(-\\frac{u_i^2}{2\\sigma_u^2}\\right)\\]那么，式 (10.24) 中的对数似然函数为\\[\\begin{align}\n\\log L_p(\\boldsymbol{\\beta},\\boldsymbol{u})-n\\log\\{\\sigma_u√(2\\pi)\\}-\\frac1{2\\sigma_u^2}\\sum_{=1}^nu_i^2\n\\tag{10.26}\n\\end{align}\\]由于该对数似然仅用于估计 \\(\\boldsymbol\\beta\\) 的 \\(p\\) 个分量和 \\(\\boldsymbol u\\) 的 \\(n\\) 个分量，因此可以省略仅涉及 \\(\\sigma^2_u\\) 的项，得到\\[\\begin{align}\n\\log L_{pen}(\\boldsymbol{\\beta},\\boldsymbol{u},\\sigma_u^2)&=\\log L_p(\\boldsymbol{\\beta},\\boldsymbol{u})-\\frac{1}{2\\sigma_u^2}\\sum_{=1}^nu_i^2\n\\tag{10.27}\n\\end{align}\\]这称为惩罚偏对数似然 (penalised partial log-likelihood)，因为第二项的作用是当 \\(u_i\\) 具有更极端的值（即远离其预期值零的值）时，为偏对数似然函数施加惩罚。式 (10.27) 中的项 \\(\\sigma^2_u\\) 本质上控制了该对数似然函数两个分量的相对重要性。最大化过程迭代地进行：从 \\(\\sigma^2_u\\) 的初始估计开始，找到最大化 \\(\\log L_{pen}(\\boldsymbol{\\beta},\\boldsymbol{u},\\sigma_u^2)\\) 的 \\(\\beta\\) 和 \\(u\\) 的估计。接下来，通过对式 (10.25) 中的似然 \\(L_p(\\boldsymbol{\\beta},\\boldsymbol{u})\\) 关于随机效应 \\(u_i\\) 进行积分，得到边际似然 \\(L_m(\\boldsymbol{\\beta},\\sigma_u^2)\\)，即\\[L_m(\\boldsymbol{\\beta},\\sigma_u^2)=\\int_{-\\infty}^\\infty L_p(\\boldsymbol{\\beta},\\boldsymbol{u})f(\\boldsymbol{u})\\operatorname{d\\boldsymbol{u}}\\]Ripatti Palmgren (2000) 表明，在 \\(\\boldsymbol \\beta\\) 的估计 \\(\\hat{\\boldsymbol \\beta}\\) 处，该边际似然可通过下式得到很好的近似\\[\\begin{align}\n\\log L_m(\\hat{\\boldsymbol{\\beta}},\\sigma_u^2)=\\log L_{pen}(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{u}},\\sigma_u^2)-\\frac12\\log(\\sigma_u^{2n})-\\frac12\\log|\\boldsymbol{}_u|\n\\tag{10.28}\n\\end{align}\\]其中 \\(\\boldsymbol{}_u\\) 为随机效应的 \\(n\\times n\\) 观测信息矩阵，由 \\(\\log L_{pen}(\\boldsymbol{\\beta},\\boldsymbol{u},\\sigma_u^2)\\) 关于 \\(u_i, = 1, 2,...,n\\) 的负二阶偏导数在 \\(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{u}}\\) 处的值形成，\\(|\\boldsymbol{}_u|\\) 是该矩阵的行列式。使用 \\(\\beta\\) 的估计，式 (10.28) 中的边际对数似然关于 \\(\\sigma^2_u\\) 最大化，以给出 \\(\\sigma^2_u\\) 的修正估计。重复此过程，直到 \\(\\sigma^2_u\\) 的两个连续估计之差足够小。从该迭代过程中还获得了随机效应的估计 \\(\\hat u_i\\)，以及脆弱项 \\(\\hat{z}_i=\\exp(\\hat{u}_i)\\)。此外，随机效应方差的最大似然估计由下式给出\\[\\hat{\\sigma}_u^2=n^{-1}\\left\\{\\sum_{=1}^n\\hat{u}_i^2+\\text{ trace }(\\boldsymbol{}_u^{-1})\\right\\}\\]其中 \\(\\text{trace }(\\boldsymbol{}_u^{-1})\\) 是 \\(\\boldsymbol{}_u\\) 的逆的对角元之和。此估计的标准误为\\[\\mathrm{se}\\left(\\hat{\\sigma}_u^2\\right)=√(2\\hat{\\sigma}_u^2)\\left[n+\\frac1{\\hat{\\sigma}_u^4}\\operatorname{trace}\\left(\\boldsymbol{}_u^{-1}\\boldsymbol{}_u^{-1}\\right)-2\\frac1{\\hat{\\sigma}_u^2}\\operatorname{trace}\\left(\\boldsymbol{}_u^{-1}\\right)\\right]^{-1/2}\\]方差的最大似然估计往往是有偏的，相反，基于限制性最大似然 (restricted maximum likelihood, REML) 估计方法的估计是优选的。例如，在估计来自正态分布的单个观测样本 \\(x_1,x_2,\\ldots,x_n\\) 的方差时，方差的最大似然估计是有偏估计 \\(n^{-1}\\sum_i(x_i-\\bar{x})^2\\)，而相应的 REML 估计是通常的无偏估计 \\((n-1)^{-1}\\sum_i(x_i-\\bar{x})^2\\)。REML 估计是根据独立于 \\(\\boldsymbol\\beta\\) 的似然函数中获得的，随机脆弱项方差的 REML 估计为\\[\\tilde{\\sigma}_u^2=n^{-1}\\left\\{\\sum_{=1}^n\\tilde{u}_i^2+\\text{trace}\\left(\\tilde{\\boldsymbol{V}}_{\\large u}\\right)\\right\\}\\]其中 \\(\\tilde{\\boldsymbol{V}}_{\\large u}\\) 是 \\(\\boldsymbol u_i\\) 的 REML 估计 \\(\\tilde{\\boldsymbol u_i}\\) 的方差-协方差阵估计。该矩阵的迹就是 \\(\\boldsymbol u_i\\) 的方差估计之和。这是正态分布随机脆弱效应方差的首选估计。\\(\\tilde{\\sigma}_u\\) 的标准误可根据下式找到\\[\\begin{aligned}\\mathrm{se}\\left(\\tilde{\\sigma}_u^2\\right)&=√(2\\tilde{\\sigma}_u^2)\\left[n+\\frac{1}{\\tilde{\\sigma}_u^4}\\mathrm{trace}\\left(\\tilde{\\boldsymbol{V}}_{\\large u}\\tilde{\\boldsymbol{V}}_{\\large u}\\right)-2\\frac{1}{\\tilde{\\sigma}_u^2}\\mathrm{trace}\\left(\\tilde{\\boldsymbol{V}}_{\\large u}\\right)\\right]^{-1/2}\\end{aligned}\\]\\(\\tilde{\\sigma}_u\\) 及其标准误通常都出现在软件包的输出中，这些软件包具有拟合带 lognormal 脆弱性 Cox 回归模型的功能。对于全参数脆弱模型，可以使用未知参数的最大似然估计来估计累积基线风险函数和相应的生存函数。然而，在半参数脆弱模型中，基线风险和累积风险的估计不能扩展为考虑脆弱项，因此无法容易地获得的生存函数估计。","code":""},{"path":"chap10.html","id":"sec10-5-2","chapter":"第 10 章 脆弱模型","heading":"10.5.2 gamma 脆弱效应","text":"当假设与脆弱效应相关的随机变量具有单位均值、方差为 \\(1/\\theta\\) 的 gamma 分布时，相应的随机效应 \\(u_i\\) 具有 10.2.1 节介绍的 exp-gamma 分布。使用式 (10.6) 中的密度函数，式 (10.24) 中的对数似然函数现在为\\[\\log L_p(\\boldsymbol{\\beta},\\boldsymbol{u})+n\\theta\\log\\theta-n\\log\\Gamma(\\theta)-\\theta\\sum_{=1}^n(e^{u_i}-u_i)\\]该对数似然函数将用于估计 \\(\\boldsymbol\\beta\\) 和 \\(\\boldsymbol u\\) 的分量，因此可以省略仅涉及 \\(\\theta\\) 的项，以给出惩罚偏对数似然函数\\[\\begin{align}\n\\log L_{pen}(\\boldsymbol{\\beta},\\boldsymbol{u},\\theta)=\\log L_p(\\boldsymbol{\\beta},\\boldsymbol{u})-\\theta\\sum_{=1}^n\\{e^{u_i}-u_i\\}\n\\tag{10.29}\n\\end{align}\\]其中 \\(\\theta\\sum_{=1}^n\\{e^{u_i}-u_i\\}\\) 为惩罚项。为了获得 \\(\\boldsymbol{\\beta},\\boldsymbol{u}\\) 和 \\(\\theta\\) 的估计，首先将 \\(\\boldsymbol{\\beta}\\) 和 \\(\\boldsymbol{u}\\) 的估计设为在 \\(\\theta\\) 的初始值下使式 (10.29) 最大化的值。在 \\(\\boldsymbol{\\beta},\\boldsymbol{u}\\) 的估计 \\(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{u}}\\) 处，\\(\\theta\\) 的边际对数似然用于获得 \\(\\theta\\) 的修正估计。Therneau Grambsch (2000) 已证明\\[\\begin{align}\n\\log L_m(\\hat{\\boldsymbol{\\beta}},\\theta)=&\\,\\log L_{pen}(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{u}},\\theta)+n\\theta(1+\\log\\theta)\\\\&-\\sum_{=1}^n\\left\\{(\\theta+\\delta_i)\\log(\\theta+\\delta_i)-\\log\\left[\\frac{\\Gamma(\\theta+\\delta_i)}{\\Gamma(\\theta)}\\right]\\right\\}\n\\tag{10.30}\n\\end{align}\\]其中 \\(\\delta_i\\) 是第 \\(\\) 个个体的事件指示符。关于 \\(\\theta\\) 最大化式 (10.30) 中的 \\(\\log L_m(\\hat{\\boldsymbol{\\beta}},\\theta)\\)，得到 \\(\\hat\\theta\\)。然后将该估计与式 (10.29) 一起使用以获得 \\(\\boldsymbol{\\beta},\\boldsymbol{u}\\) 的更新估计，依此类推，直到过程收敛。尚无 \\(\\theta\\) 的估计及其标准误的封闭形式表达。当脆弱性方差 \\(1/\\theta\\) 趋于零时，式 (10.30) 中的边际对数似然变为\\[\\log L_p(\\hat{\\boldsymbol{\\beta}})-\\sum_{=1}^n\\delta_i\\]其中，\\(\\log L_p(\\hat{\\boldsymbol{\\beta}})\\) 是不存在脆弱性时 Cox 回归模型的最大偏对数似然。通过将边际对数似然率取为 \\(\\log L_m(\\theta)+\\sum_{=1}^n\\delta_i\\)，即存在脆弱性时的最大边际对数似然，可直接与不存在脆弱性的模型进行比较。这一点在 10.6 节将会看到，对于模型间的比较是非常有帮助的。","code":""},{"path":"chap10.html","id":"sec10-6","chapter":"第 10 章 脆弱模型","heading":"10.6 比较带脆弱性的模型","text":"在许多情况下，脆弱性在模型中是一个讨厌项 (nuisance term). 虽然考虑其效应很重要，但主要兴趣在于确定模型中需要哪些解释变量，并在存在脆弱性的情况下获得其效应的估计。第 5 章 5.7 节中描述的方法基于 \\(-2\\log\\hat{L}\\) 统计量的变化，可用于比较包含脆弱性的参数模型。然后可以直接实施模型选择策略，用于确定在存在脆弱性的情况下将哪些因素包含在参数模型中，随后可以推断其效应。对于 Cox 回归模型，情况更为复杂。这是因为惩罚似然的表现与通常的似然或偏似然函数不同，因为它包含不可观测的脆弱效应。相反，我们使用最大化的边际对数似然统计量，对于 lognormal，这是 \\(\\log L_m(\\hat{\\boldsymbol{\\beta}},\\hat{\\sigma}_u^2)\\)，对于 gamma 则为 \\(\\log L_m(\\hat{\\boldsymbol{\\beta}},\\hat{\\theta})\\)。该统计量通常在拟合含脆弱项的 Cox 回归模型的计算机输出中给出。可用通常的方式 \\(\\log L_m(\\hat{\\boldsymbol{\\beta}},\\hat{\\sigma}_u^2)\\) 或 \\(\\log L_m(\\hat{\\boldsymbol{\\beta}},\\hat{\\theta})\\)（或简记为 \\(-2\\log\\hat{L}_m\\) ）的值之差与卡方分布的百分位点进行比较。在 lognormal 脆弱效应的情况下，使用基于 \\(\\beta\\) 最大似然估计的边际似然，而不是基于 REML 估计的边际似然。","code":""},{"path":"chap10.html","id":"sec10-6-1","chapter":"第 10 章 脆弱模型","heading":"10.6.1 脆弱性存在的检验","text":"在参数模型中，对于给定的一组协变量，可以通过将具有和不具有脆弱效应的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 与自由度为一的分布（\\(\\chi^2_1\\)）的百分位点进行比较，以评估无脆弱效应假设。然而需注意，支撑 \\(-2\\operatorname{log}\\hat{L}\\) 值之差具有卡方分布这一结果的标准渐近理论不再有效。本质上，这是因为无脆弱效应的假设对应于检验脆弱项方差为零的假设，这是方差可以取的最小值。基于 \\(-2\\operatorname{log}\\hat{L}\\) 的变化的检验往往是保守的，并且所得差异的 \\(P\\) 值将大于应有的值。在这种情况下，\\(-2\\operatorname{log}\\hat{L}\\) 值的差异可以非正式地与 \\(\\chi^2_1\\) 分布的百分位点进行比较。如果观测差异相对较大或较小，关于脆弱性程度的结论就会很清楚。为了更精确地确定脆弱效应的显著性，我们可以使用以下结果：当将脆弱项添加到全参数模型时，\\(-2\\operatorname{log}\\hat{L}\\) 变化的渐近分布是 \\(\\chi^2_1\\) 分布和 \\(\\chi^2_0\\) 分布的等权混合，记作 \\(0.5(\\chi_0^2+\\chi_1^2)\\)。\\(\\chi^2_0\\) 在零处有一个点质量，因此如果随机变量 \\(W\\) 具有 \\(0.5(\\chi_0^2+\\chi_1^2)\\) 分布，则 \\(\\text{P}(W=0)=0.5\\) 以及对于\\(w>0\\) 有 \\(\\text{P}(W>w)=0.5\\text{P}(\\chi_1^2>w)\\)。因此，为应用此结果，用于检验脆弱性方差为零的假设的 \\(P\\) 值只是使用 \\(\\chi^2_1\\) 分布所获 \\(P\\) 值的一半。在临界情况下，可能需要其他方法，例如 bootstrapping. 该过程可用于获得脆弱项方差的区间估计。简言之，bootstrapping 涉及有放回地对数据进行重抽样，以给出 \\(n\\) 个生存时间的新样本。然后为该样本拟合包含脆弱项的生存模型，并估计随机效应的方差。该步骤将重复很多次。方差的 bootstrap 估计的分布的 2.5% 和 97.5% 百分位数定义了方差的 95% 区间估计。在 Cox 回归模型的情况下，使用 10.5 节概述的惩罚偏对数似然法进行拟合，使用由最大化的边际对数似然形成的 \\(-2\\log\\hat{L}_m\\) 统计量来评估脆弱项的显著性。对于 lognormal 脆弱效应，从最大似然估计获得的具脆弱性的模型的最大边际对数似然可直接与无脆弱性的相应 Cox 回归模型的最大偏对数似然进行比较13。当假定 gamma 脆弱效应时，也会使用类似的过程，但此处必须将事件总数 \\(\\sum_{=1}^n\\delta_i\\) 添加到最大边际对数似然中，如第 10.5.2 节所解释的。与参数建模一样，该检验程序只是近似的，可能需要 bootstrapping 来更可靠地评估脆弱效应的程度。示例 10.3  (肺移植登记患者的生存) 患者在接受器官移植评估后的预期生存时间，患者和临床医生都非常关注。在一项旨在量化这一生存时间并从肺移植的名单中确定与生存相关的因素的研究中，收集了 2004 年在英国注册等待肺移植患者的有关数据。生存时间是从登记之日起直到死亡，无论是否进行了包括移植在内的所有干预治疗。从名单中删除之日（即最后一次随访日期）或是截至 2012 年 4 月 30 日仍然存活的记录均视为删失。此外，还记录了登记时的年龄、性别、体重指数和原发性疾病，其中原发性疾病分为纤维化、慢阻肺（COPD）、化脓性疾病和其他。数据集中有 196 名患者，其中 123 人在研究期间死亡。前 20 名患者的数据如表 10.2 所示。\n我们首先拟合了一个包含年龄、性别、体重指数和原发疾病的 Weibull 比例风险模型。该模型的 \\(-2\\log\\hat{L}\\) 统计量为 2043.73. 现在引入 lognormal 脆弱项，通过将正态分布随机效应添加到模型的线性部分，并最大化式 (10.17) 中的似然函数。具有 lognormal 脆弱性的 Weibull 模型的 \\(-2\\log\\hat{L}\\) 值为 2026.85，加上随机效应后 \\(-2\\log\\hat{L}\\) 的变化为 16.88. 将该减小量与 \\(\\chi^2_1\\) 分布的百分位点进行比较，脆弱效应非常显著，\\(P<0.001\\)。这意味着，在考虑了四个解释变量的效应后，本研究中患者的生存时间之间存在显著的异质性。若以 \\(0.5(\\chi_{0}^{2}+\\chi_{1}^{2})\\) 分布作为参考，得到脆弱效应显著性不太保守的估计，相当于将与 \\(\\chi^2_1\\) 分布的比较中的 \\(P\\) 值减半，那么会更显著。与 lognormal 脆弱性对应的正态随机效应的方差为 \\(\\hat{\\sigma}_u^2=2.254\\)。使用式 (10.4) 和 (10.5)，lognormal 脆弱效应的均值和方差分别为 3.09 和 81.20.接下来，我们拟合一个 Weibull 模型，该模型包含年龄、性别、体重指数和原发性疾病，以及 gamma 脆弱效应。该模型是通过最大化式 (10.23) 中的对数似然函数来拟合的，得到 gamma 脆弱效应具有方差 \\(\\hat\\theta^{−1}=3.015\\)。随机效应的相应方差由式 (10.8) 计算得出，为 10.19. 具有 gamma 脆弱性的 Weibull 模型的 \\(-2\\log\\hat{L}\\) 统计量为 2023.69，因此脆弱项的添加导致 \\(-2\\log\\hat{L}\\) 统计量的值减小 20.04。这种变化非常显著（\\(P<0.001\\)），并且大于引入 lognormal 脆弱时的变化。在这个例子中，脆弱项两个分布的方差以及随机效应的相应分布都非常不同。为了更详细地探讨这一点，图 10.7 和 10.8 显示了随机变量 \\(U\\) 的拟合的正态和 exp-gamma 概率密度函数，以及脆弱随机变量 \\(Z\\) 相应的 lognormal 和 gamma 概率密度。图 10.7 显示了随机效应 exp-gamma 分布的非对称性，尽管众数为零，但根据式 (10.7) 得出的均值为 −2.05. 这解释了随机效应的正态分布和 exp-gamma 分布方差估计的差异。图 10.8 显示，当 \\(z_i>0.2\\) 时，脆弱效应的密度函数估计非常相似。然而，当 \\(z_i\\) 趋于零时，拟合的 gamma 分布的密度趋于 \\(\\infty\\)，而拟合的 lognormal 分布是单峰的。此外，拟合的 gamma 分布的均值是 1，而根据式 (10.4) 中，拟合的 lognormal 分布的均值为 3.09，这就是 lognormal 脆弱性方差远大于 gamma 分布的脆弱性方差的原因。为了比较各种项的参数估计及其标准误，表 10.3 显示了不同拟合的 Weibull 模型的估计，包括随机效应 \\(u_i\\) 和脆弱效应 \\(z_i\\) 的方差估计 \\(z_i\\)，分别表示为 \\(\\widehat{\\operatorname{var}}\\left(u_{}\\right)\\) 和 \\(\\widehat{\\operatorname{var}}\\left(z_{}\\right)\\)。请注意，对于正态随机效应，方差估计为 \\(\\widehat{\\operatorname{var}}\\left(u_{}\\right)=\\hat\\sigma^2_u\\)，而对于伽玛脆弱性，方差估计则为 \\(\\widehat{\\operatorname{var}}\\left(u_{}\\right)=1/\\hat\\theta\\)。然后使用式 (10.5) 来获得 lognormal 脆弱性方差，并且式 (10.8) 给出了对应于 gamma 脆弱随机效应的方差。\n该表显示，当添加脆弱项时，参数估计倾向于离零更远，并且标准误也更大。然而，所列因素对患者生存的影响的推断并没有受到脆弱项的较大影响，并且当包括 lognormal 或 gamma 脆弱效应时，所获结果几乎没有差异。对患者生存产生影响的唯一因素是原发疾病，COPD 患者的死亡风险低于其他疾病患者。此外，根据 \\(-2\\log\\hat{L}\\) 统计量，具有 gamma 脆弱性的模型可能优于具有 lognormal 脆弱性的模型。为了避免对潜在基线风险函数的形式做出具体假定，我们拟合了 Cox 回归模型，其中包含年龄、性别、体重指数和原发性疾病，并且还包括 lognormal 或 gamma 脆弱项。这些模型是通过分别最大化式 (10.27) 和 (10.29) 中的惩罚对数似然函数来拟合的。为了检验在存在四个解释变量的情况下所有脆弱效应均为零的假设，我们将拟合的 Cox 模型的 \\(-2\\log\\hat{L}\\) 统计量值（即 1159.101），与具有脆弱性的 Cox 模型的最大化边际对数似然统计量 \\(-2\\log\\hat{L}_m\\) 进行比较。当添加 lognormal 脆弱项时，式 (10.28) 中的最大化边际对数似然统计量 \\(-2\\log L_{m}(\\hat{\\boldsymbol{\\beta}},\\hat{\\sigma}_{u}^{2})\\) 的值为 1157.480，这导致 \\(-2\\log\\hat{L}_m\\) 统计量的变化为 1.62，这并不显著（\\(P=0.203\\)）。拟合具有 gamma 脆弱性的模型后，式 (10.30) 中的 \\(-2\\log L_{m}(\\hat{\\boldsymbol{\\beta}},\\hat{\\theta})\\) 统计量为 −699.653，为此加上观测死亡人数 123，再乘以 −2 得到 1153.306. 这可与包含相同解释变量但无脆弱效应的 Cox 回归模型的 \\(-2\\log\\hat{L}\\) 值（1159.101）进行比较。该检验统计量的值减小了 5.80，与 \\(\\chi^2_1\\) 分布的百分位点相比，这是显著的（\\(P=0.016\\)）。考虑到原发性疾病和其他因素造成的生存差异，这表明了显著的脆弱效应。Cox 模型中的正态和 exp-gamma 随机效应的方差小于相应的 Weibull 模型中的方差，并且脆弱效应不那么显著。这表明，拟合的 Cox 回归模型比 Weibull 模型更能解释移植登记后生存时间的变异。为比较 Cox 回归模型中各项的参数估计及其标准误，表 10.4 显示了拟合的不同模型的估计以及随机效应的方差估计 \\(\\widehat{\\operatorname{var}}\\left(u_i\\right)\\)。\n与 Weibull 模型一样，当添加脆弱项时，一些参数估计会更大，并且标准误也更大，但表 10.3 和 10.4 中的参数估计大致相似。对于 Weibull 模型，gamma 脆弱性模型得到了 \\(-2\\log\\hat{L}_m\\) 统计量的最小值，并且对数据拟合得更好。脆弱效应的估计可以使用 10.4 节中概述的方法获得。例如，对于 具有 lognormal 脆弱性的 Cox 模型的脆弱项 \\(\\hat z_i\\) 的估计，有 7 名患者的 \\(\\hat z_i\\) 值大于 3，即患者 11, 36, 69, 70, 87, 113 和 163. 这些患者的生存时间分别为 16, 21, 3, 4, 38, 22 和 35 天，因此，正如预期的那样，最脆弱的患者是那些生存最短的患者。","code":""},{"path":"chap10.html","id":"sec10-7","chapter":"第 10 章 脆弱模型","heading":"10.7 共享脆弱模型","text":"试图解释个体生存时间异质性的模型可以提供对协变量效应估计的改进，或有助于解释诸如非比例风险等特征。然而，脆弱模型在某些情况下特别有用，此时某些特征的值是由个体组共享的。10.1.3 节给出了一些潜在应用领域的示例。为了建立生存数据的共享脆弱模型，假设有 \\(g\\) 组个体，第 \\((=1,2,\\ldots,g)\\) 组中有 \\(n_i\\) 个个体。对于比例风险模型，第 \\(\\) 组第 \\(j(j=1,2,\\ldots,n_i)\\) 个个体在时间 \\(t\\) 的死亡风险\\[\\begin{align}\nh_{ij}(t)=z_i\\exp(\\boldsymbol{\\beta'x}_{ij})h_0(t)\n\\tag{10.31}\n\\end{align}\\]其中 \\(\\boldsymbol x_{ij}\\) 是第 \\(\\) 组第 \\(j\\) 个个体 \\(p\\) 个解释变量的值向量，\\(\\boldsymbol\\beta\\) 是它们的系数向量，\\(h_0(t)\\) 是基线风险函数，\\(z_i\\) 是第 \\(\\) 个组中所有 \\(n_i\\) 个个体共同的脆弱效应。式 (10.31) 中的风险函数也可写为\\[h_{ij}(t)=\\exp(\\boldsymbol{\\beta'x}_{ij}+u_i)h_0(t)\\]其中 \\(u_i=\\log(z_i)\\) 并假定为 \\(g\\) 个随机变量 \\(U_1,U_2,\\ldots,U_g\\) 的实现，假定 \\(U_i\\) 具有均值为零的分布，其中正态分布是常见的选择。基线风险的形式可以在 Weibull 模型中完全指定，也可以如 Cox 模型一样不指定。根据第 5 章式 (5.60)，包含共享脆弱分量的一般参数加速失效时间模型的形式为\\[h_{ij}(t)=e^{-\\eta_{ij}}h_0(t/e^{\\eta_{ij}})\\]其中 \\(\\eta_{ij} = \\boldsymbol \\alpha' \\boldsymbol x_{ij}+u_i\\)。等价地，扩展式 (5.61)，该模型可以对数线性形式表示为\\[\\begin{aligned}\\log T_{ij}=\\mu+\\boldsymbol{\\alpha}'\\boldsymbol{x}_{ij}+u_i+\\sigma\\epsilon_{ij}\\end{aligned}\\]其中 \\(T_{ij}\\) 是与第 \\(\\) 组第 \\(j\\) 个个体生存时间相关的随机变量，\\(\\mu\\) 和 \\(\\sigma\\) 是截距和尺度参数，并且 \\(\\epsilon_{ij}\\) 具有某种指定的概率分布。","code":""},{"path":"chap10.html","id":"sec10-7-1","chapter":"第 10 章 脆弱模型","heading":"10.7.1 拟合共享脆弱模型","text":"将第 \\(\\) 组第 \\(j\\) 个个体的生存时间记为 \\(t_{ij}\\)，其中 \\(j = 1, 2,...,n_i\\) 且 \\(= 1, 2,...,g\\)，并将相应的事件指示符写为 \\(\\delta_{ij}\\) ，如果 \\(t_{ij}\\) 是事件时间，则为 1，否则为 0. 另外，令 \\(S_{ij} (t)\\) 和 \\(h_{ij} (t)\\) 分别为第 \\(\\) 组第 \\(j\\) 个个体的生存函数和风险函数。对于全参数模型，当脆弱项已知时，第 \\(\\) 组观测的似然函数为\\[\\begin{aligned}L_i(\\boldsymbol{\\beta})=\\prod_{j=1}^{n_i}h_{ij}(t_{ij})^{\\delta_{ij}}S_{ij}(t_{ij})\\end{aligned}\\]如 10.4 节所示，我们接下来将该似然关于 \\(u_i\\) 积分，得到\\[\\int_{-\\infty}^\\infty L_i(\\boldsymbol{\\beta})f(u_i)\\mathrm{d}u_i\\]其中 \\(f(u_i)\\) 是 \\(U_i\\) 的概率密度函数。跨 \\(g\\) 个组，似然函数为\\[L(\\boldsymbol{\\beta})=\\prod_{=1}^g\\int_{-\\infty}^\\infty L_i(\\boldsymbol{\\beta})f(u_i)\\mathrm{d}u_i\\]与个体脆弱效应的情况一样，只有当脆弱效应具有 \\(\\Gamma(\\theta,\\theta)\\) 分布时，才可以解析地积分。在这种情况下，第 \\(\\) 组的似然函数为\\[\\prod_{j=1}^{n_i}\\left\\{e^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_{ij}}h_0(t_{ij})\\right\\}^{\\delta_{ij}}\\frac{\\theta^\\theta\\Gamma(\\theta+d_i)}{\\Gamma(\\theta)\\{\\theta+\\sum_j\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_{ij})H_0(t_{ij})\\}^{\\theta+d_i}}\\]其中 \\(d_i=\\sum_i\\delta_{ij}\\) 为第 \\(\\) 组的死亡数。相应的跨 \\(g\\) 组对数似然为\\[\\begin{aligned}\n\\operatorname{log}L(\\boldsymbol{\\beta})=&\\, \\begin{aligned}\\sum_{=1}^{g}\\left\\{\\log\\Gamma(\\theta+d_i)-\\log\\Gamma(\\theta)-d_i\\log\\theta\\right\\}\\end{aligned}  \\\\\n&-\\sum_{=1}^g(\\theta+d_i)\\log\\left[1+\\theta^{-1}\\sum_{j=1}^{n_i}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_{ij})H_0(t_{ij})\\right] \\\\\n&+\\sum_{=1}^g\\sum_{j=1}^{n_i}\\delta_{ij}\\left[\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_{ij}+\\log h_0(t_{ij})\\right],\n\\end{aligned}\\]对其进行最大化，以给出基线风险函数中的参数 \\(\\theta\\) 和 \\(\\beta\\) 的估计。一旦拟合了该模型，就可以按照 10.4 节中描述的相同方式获得脆弱效应的估计 \\(\\hat z_i\\)，得到\\[\\hat{z}_i=\\frac{\\hat{\\theta}+d_i}{\\hat{\\theta}+\\sum_{j=1}^{n_i}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_{ij})\\hat{H}_0(t_{ij})}\\]标准误为 \\(\\hat{z}_i/(\\hat{\\theta}+d_i)\\)。带脆弱性的 Cox 回归模型可再次使用惩罚偏对数似然方法进行拟合，如 10.5 节所示。为了使该节给出的公式适应共享脆弱模型的情况，事件指示符 \\(\\delta_i\\) 替换为 \\(d_i\\)（第 \\(\\) 组中的死亡人数），并且关于 \\(= 1\\) 到 \\(n\\) 的求和替换为 \\(=1\\) 至 \\(g\\)。","code":""},{"path":"chap10.html","id":"sec10-7-2","chapter":"第 10 章 脆弱模型","heading":"10.7.2 比较共享脆弱模型","text":"同样，10.6 节给出的结果同样适用于共享脆弱性模型。具体来说，包括共享脆弱项的全参数模型可以使用 \\(-2\\log\\hat{L}\\) 统计量进行比较。如 10.6.1 节所示，为了检验脆弱性，可以将 \\(-2\\log\\hat{L}\\) 统计量在添加脆弱效应时的变化与 \\(0.5(\\chi_0^2+\\chi_1^2)\\) 分布的百分位点进行正式比较。对于使用惩罚偏对数似然方法拟合的具有共享脆弱的 Cox 模型，边际对数似然统计量 \\(-2\\log L_m(\\hat{\\boldsymbol{\\beta}},\\hat{\\sigma}_u^2)\\) 和 \\(-2\\log L_m(\\hat{\\boldsymbol{\\beta}},\\hat{\\theta})\\) 可分别用于比较具有 lognormal 或 gamma 脆弱性的模型。这些统计量也可与没有脆弱性的 Cox 回归模型的 \\(-2\\log\\hat{L}\\) 值进行比较，以评估脆弱效应的程度。然而，10.6.1 节中概述的这种方法的局限性也适用于此。注意，在 gamma 脆弱性的情况下，需要将量 \\(\\sum_{=1}^g d_i\\) 添加到 \\(-2\\log L_m(\\hat{\\boldsymbol{\\beta}},\\hat{\\sigma}_u^2)\\) 中，以确保在无脆弱性的条件下与最大化偏对数似然具有可比性，就像单变量脆弱性一样。可以使用 10.4 节描述的方法来估计随机效应。当脆弱项代表多中心研究中的中心时，这种估计特别有用，因为中心效应估计的秩次提供了关于不同中心在患者生存方面的优点的信息。但在这里，模型中解释变量的系数估计的解释是以共享脆弱性为条件的。这意味着风险比与同一组中个体效应的比较有关。对随机效应的估计也会得到对具有给定特征的个体的生存函数的估计，并且可以很容易地获得中位生存时间。不涉及新的原则。最后，我们以一个示例来说明其中的一些特征。示例 10.4  (肾移植后的生存) 已故器官捐献者通常捐献两个肾脏，然后通常由不同的移植中心移植给两个不同的受体。在对短期移植物和患者生存进行建模时，需要考虑与受体相关的许多因素以及与移植手术本身相关的因素。本示例基于特定年份进行的所有肾移植的结果，其中供体因循环系统衰竭而亡。结局变量是移植物生存，定义为移植失败或死亡（但移植物正常工作）中较早发生的一项。在记录的许多解释因素中，本例使用了：患者年龄（岁）、糖尿病状况（0 = 不存在，1 = 存在）和冷缺血时间（CIT），即从供体中取出肾脏到移植到受体之间的时间（以小时为单位）。除了这些受体和移植因素外，供体因素也可能对移植的结果产生影响。虽然与供体相关的许多因素都会被常规记录下来，但很难将所有因素都考虑在内。此外，接受相同受体两个肾脏的患者的生存时间可能比接受不同供体肾脏的患者的生存时间具有更高的相关性14。考虑供体因素（同时还考虑到使用相同供体器官时的结局之间的关联）的一种方法是将供体作为共享脆弱效应。在相同供体的两个肾脏受体的生存时间模型中，脆弱项是相同的。在这项研究中，共有 434 例移植手术使用了 270 名已故供体的器官。其中，106 人捐献了一个肾脏，164 人捐献了双肾。表 10.5 显示了当年前 15 名供体的 22 名肾脏受体的数据。\n在拟合包含冷缺血时间、受体年龄和糖尿病状况的 Cox 回归模型时，\\(-2\\log\\hat{L}\\) 统计量的值为 831.87. 为了考虑供体效应，添加了 lognormal 共享脆弱效应，并且 \\(-2\\log\\hat{L}\\) 统计量减小为 831.46，在一个自由度上减小了 0.41. 与 \\(\\chi^2_1\\) 分布或 \\(0.5(\\chi_0^2+\\chi_1^2)\\) 分布相比，这并不显著（\\(P = 0.52\\)）。这表明不存在脆弱效应。不包含脆弱性以及包含 lognormal 脆弱性的拟合的 Cox 回归模型中的参数估计如表 10.6 所示。\n有证据表明患者的年龄会影响移植生存，但考虑到这一点后，没有证据表明糖尿病状况和冷缺血时间会影响这些患者的结果。此外，这三个变量对移植生存的效应不受供体效应的影响。当将 gamma 脆弱性添加到包含相同解释变量的 Cox 回归模型中时，\\(-2\\log\\hat{L}\\) 的值与其他模型的值非常相似，如表 10.6 所示，参数估计实际上是相同的。当假定生存时间为 Weibull 分布时，获得了非常相似的结果。总之，适当考虑供体效应并不会对解释性因素对这些移植受者短期生存率影响的推断产生实质性影响。","code":""},{"path":"chap10.html","id":"sec10-8","chapter":"第 10 章 脆弱模型","heading":"10.8 脆弱建模的其他方面","text":"本节简要讨论了与对魔建模相关的许多其他问题。","code":""},{"path":"chap10.html","id":"sec10-8-1","chapter":"第 10 章 脆弱模型","heading":"10.8.1 模型检查","text":"第 4 章和第 7 章描述的模型检查技术可以揭示离群观测、有影响的值和不恰当的协变量函数形式。此外，评估具有 gamma 脆弱性的参数模型充分性的一种非正式方式是将观测生存函数与从脆弱模型导出的可观测函数进行比较，如示例 10.2 所示。在更复杂的问题中，可以通过比较具有与脆弱模型相同解释变量的 Cox 模型拟合得出的基线生存函数，与将所有解释变量都设为零的个体可观测生存函数，来进行比较15。对于脆弱性分布的其他选择，可观测生存函数只能数值地确定，因此这种方法并不那么有用。在脆弱建模中，还可以严格检查所选脆弱性分布的有效性。本章描述了两种特定的分布模型：gamma 分布和 lognormal 分布，但还有许多其他选择。选择哪种脆弱性分布通常取决于数学便利性和统计软件的可用性。区分替代脆弱性分布的一种方法是考虑一般分布族 (general distribution family)，特定的分布是其特例。幂方差函数 (power variance function, PVF) 分布在这方面广泛使用。该分布的密度函数是三个参数 \\(\\alpha,\\delta\\) 和 \\(\\theta\\) 的函数，对于 \\(\\theta\\geqslant0,0<\\alpha\\leqslant1,\\delta>0\\)，其均值和方差由下式给出\\[\\begin{aligned}\\mathrm{E}\\left(Z\\right)&=\\delta\\theta^{\\alpha-1},\\quad\\quad\\mathrm{~var}\\left(Z\\right)=\\delta(1-\\alpha)\\theta^{\\alpha-2}\\end{aligned}\\]令 \\(\\delta = \\theta^{1-\\alpha}\\) 得到一个具有单位均值、方差为 \\((1 −\\alpha)/\\theta\\) 的分布。当 \\(\\alpha = 0\\) 时，分布简化为方差为 \\(\\theta−1\\) 的 gamma，当 \\(\\alpha = 0.5\\) 时，分布简化为逆高斯分布。那么，关于 \\(\\alpha\\) 值的假设检验可以指导模型选择。模型检查的另一种方法是评估基于模型的关键推断对脆弱模型特定选择的敏感性。将完全参数模型的风险比与具有相同脆弱性分布的 Cox 回归模型的风险比进行比较，同样具有价值。","code":""},{"path":"chap10.html","id":"sec10-8-2","chapter":"第 10 章 脆弱模型","heading":"10.8.2 相关脆弱模型","text":"将同组的个体脆弱性完全相同（共享脆弱模型）放宽至仅仅是相关的，就得到了共享脆弱模型的一个重要扩展16。当研究重点在事件时间之间的关联时，比如研究成对器官的事件时间或双胞胎之间的事件时间时，这种模型尤具意义。在二元脆弱性的情况下，可以通过扩展式 (10.31) 中的模型来对相关脆弱性进行建模，以使一个对子中的每个成员都具有单独的脆弱性。那么在第 \\(\\) 对中，对于 \\(j=1,2\\)，风险函数为\\[\\begin{aligned}h_{ij}(t)=z_{ij}\\exp(\\boldsymbol{\\beta'x}_{ij})h_0(t)\\end{aligned}\\]并且相应的脆弱随机变量 \\((Z_{i1},Z_{i2})\\) 采用二元分布。在 lognormal 脆弱性的情况下，可以假定模型线性部分中相应的随机效应 \\(U_{ij}=\\log(Z_{ij})\\) 为二元正态分布，且 \\(\\mathrm{corr}\\left(U_{i1},U_{i2}\\right)=\\rho\\)。该相关性不必对每组都相同。那么可以评估这种相关性的程度。这种模型可以使用似然法或惩罚似然法进行拟合，但也可以使用 Monte Carlo Markov Chain (MCMC) 方法进行拟合，如第 16 章所述。","code":""},{"path":"chap10.html","id":"sec10-8-3","chapter":"第 10 章 脆弱模型","heading":"10.8.3 依赖性度量","text":"当使用共享脆弱模型来解释组内个体的事件时间之间的关联时，较大的脆弱方差对应于时间之间的高度依赖性。从这个意义上说，脆弱性方差是一种依赖性的度量，这种依赖性的程度可以在替代模型中进行比较。例如，在添加某些协变量时，脆弱效应可能会减弱，因此脆弱性方差的减小将表明修正的模型成功地减小了无法解释的变异。参数模型中的其他依赖性度量可以基于相关性。在 gamma 脆弱性分布的特殊情况下，Kendall 秩相关系数 (Kendall’s coefficient rank correlation) \\(\\tau\\) 是度量一对生存时间之间关联的实用方法。\\(\\tau\\) 仅与脆弱性方差 \\(\\theta^{−1}\\) 相关，可根据 \\(\\tau=(1+2\\theta)^{−1}\\) 计算。这样做的好处是它得到了 \\((0,1)\\) 范围内依赖性的总结统计量。","code":""},{"path":"chap10.html","id":"sec10-8-4","chapter":"第 10 章 脆弱模型","heading":"10.8.4 模型拟合中的数值问题","text":"脆弱性模型通常结合数值积分和优化进行拟合。因此，为未知参数指定合适的初始值非常重要。这些初始值最好是通过拟合无脆弱性的相应模型，或使用较小的初始脆弱方差来获得。即便如此，数值程序也可能导致拟合过程中的计算问题，以及所得估计的不稳定性。当待估参数具有非常不同的尺度时，尤其如此。例如，在示例 10.3 中，Weibull 形状参数 \\(\\lambda\\) 的估计远小于其他参数的估计，从而导致收敛问题。这种困难往往可以通过改变时间尺度来克服。例如，通过分别除以 30.44 或 365.25，将以天为单位的生存时间转换为以月或年为单位的生存时间，通常可以收敛，这适用于示例 10.3。其他方法包括重新调整某些参数，例如通过使用 \\(\\lambda' = 10000\\lambda\\) 或重新参数化模型。方差参数，例如正态随机效应中的 \\(\\sigma^2_u\\)，可以通过估计 \\(\\omega=\\log\\sigma_u^2\\) 并在模型中以 \\(\\exp(\\omega)\\) 代替 \\(\\sigma^2_u\\) 来重新编码。如果这类尝试仍不成功，则可能需要对数值积分过程中使用的设置或定义优化过程收敛的标准进行一些更改。","code":""},{"path":"chap10.html","id":"sec10-9","chapter":"第 10 章 脆弱模型","heading":"10.9 延伸阅读","text":"Hougaard (2000) 对脆弱模型进行了广泛的讨论，并给出了一些示例。最近，Hanagal (2019), Wienke (2011) 以及 Duchateau Janssen (2008) 都对脆弱建模进行了全面的描述。一般性综述文章包括 Aalen (1994), Aalen (1998) 和 Hougaard (1995)。Balan Putter (2020) 概述了脆弱建模的理论和实践。关于混合模型的一般文本包括 Brown Prescott (2000), Demidenko (2013), Stroup (2013) 以及 West, Welch Galecki (2022). 讨论限制性最大似然估计 (REML) 的文本包括 McCulloch, Searle Neuhaus (2008) 以及 Searle, Casella McCulloch (2006).McGilchrist Aisbett (1991) 描述了如何拟合具有正态随机效应的 Cox 模型，并通过一个备受讨论的透析患者插入导管后感染复发时间的例子来说明这一点。他们的方法在 Ripatti Palmgren (2000) 中得到了推广，他们展示了如何使用惩罚偏对数似然方法来拟合具有多变量分布的随机脆弱效应。Therneau Grambsch (2000) 包含了关于脆弱模型的一个章节，并描述了如何使用惩罚偏对数似然方法来拟合具有脆弱性的 Cox 模型，并检验关于拟合模型参数的假设；另见 Therneau, Grambsch Pankratz (2003). 另一种拟合方法基于 Klein (1992) 和 Klein Moeschberger (2005) 描述的期望最大化 (EM) 算法。可以使用 Wald 检验，而不是使用最大边际对数似然将 Cox 回归模型与脆弱性进行比较。Therneau Grambsch (2000)描述了这种方法，并使用了 Gray (1992) 描述的广义自由度的概念。Claeskens, Nguti Janssen (2008) 给出了将脆弱效应添加到参数模型时 \\(-2\\log\\hat{L}\\) 的变化具有渐近 \\(0.5(\\chi_0^2+\\chi_1^2)\\) 分布的结果。Lambert et al. (2004) 和 Nelson et al. (2006) 展示了如何使用概率积分变换来拟合具有非正态随机脆弱效应的参数加速失效时间模型。这允许在使用为拟合具有正态随机效应的模型而设计的计算机软件时采用其他分布。关于脆弱模型充分性检验方法的研究相对较少，主要侧重于检验 gamma 脆弱性模型的有效性。Shih Louis (1995) 是最早开发 gamma 脆弱性分布假设检验的论文之一，Shih (1998) 给出了一个用于二元生存数据的拟合优度检验，Glidden (1999) 描述了一些扩展。最近，Geerdens, Claeskens Janssen (2013) 给出了一个正式的拟合优度检验，他们还简要回顾了这一领域的其他工作。","code":""},{"path":"chap11.html","id":"chap11","chapter":"第 11 章 非比例风险和机构的比较","heading":"第 11 章 非比例风险和机构的比较","text":"比例风险模型广泛用于医学研究和其他应用领域的生存数据建模。这种比例性假设意味着解释变量或因素对发生事件的风险的影响不依赖于时间。这可能是一个相当强的假设，且经常会出现这种假设站不住脚的情况。尽管前面的章节已经介绍了不假设比例风险的模型，但本章还介绍了一些其他方法。非比例风险模型的一个特别重要的应用是比较机构之间的生存率，因此还描述了可以在这种情况下使用的方法。","code":""},{"path":"chap11.html","id":"sec11-1","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.1 非比例风险","text":"不需要比例风险假设的模型包括第 5 章介绍的加速失效时间模型和比例几率模型，以及第 8 章介绍的包含时依变量的 Cox 回归模型。但我们经常面临这样一种情况：不能假设比例风险，且上述模型都不能令人满意。例如考虑一项研究，比较外科手术与化疗在治疗一种特殊形式癌症中的效果。假设两种治疗的生存函数如图 11.1 所示，其中时间尺度为年。显然，风险是不成比例的。接受手术治疗的患者可能会因无法承受手术或手术引起的并发症而过早死亡。当将侵袭性化疗与标准化疗进行比较时，也会出现类似的情况。同样，积极治疗的长期优势可能是以短期死亡率过高为代价的。\n在得到图 11.1 所示生存函数的研究中，很明显，分析两年生存率将是合适的。现考虑一项研究，该研究比较了手术联合化疗与单独的手术，其生存函数如图 11.2 所示。在这里，化疗的短期效益当然可能是值得的，但对两年生存率的分析将无法确定治疗差异。两种生存率之差并不恒定，使得基于给定时间的生存率的分析难以进行。然而，假定研究的第一年内风险是成比例的，并在此时进行生存分析，可能是合理的。\n一种适用于分析本节所述情况的方法是，将研究的终点定义为存活到或超过某个特定时间。例如，在得到图 11.1 所示生存函数的研究中，治疗差异在两年后大致恒定。因此，可以建立模型来描述生存超过两年的概率与预后变量和治疗之间的关系。在其他情况下，可能适合对诸如第一年治疗复发的概率、癌症缓解期少于六个月的概率或试验开始后五年内某疾病或病症不复发的概率等量进行建模。这种方法的缺点是，所有患者都必须随访到分析生存率的时间点，并且在此之前无法使用死亡数据。此外，需要对两种治疗其一的长期益处抱有信心，以确保试验不会因为一个治疗组的死亡率过高而提前停止。","code":""},{"path":"chap11.html","id":"sec11-1-1","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.1.1 对给定时间的事件概率建模","text":"事件在时间起点和某个特定时间点之间（或超过给定时间）发生的概率的模型，可从生存函数中导出17。考虑在某个指定时间 \\(\\tau\\) 之前发生事件的概率，并令 \\(p_i(\\tau)\\) 表示第 \\((=1,2,\\ldots,n)\\) 个患者发生该事件的概率。使用 Cox 回归模型，第 \\(\\) 个患者在时间 \\(\\tau\\) 发生事件的风险由下式给出\\[\\begin{aligned}h_i(\\tau)=\\exp(\\eta_i)h_0(\\tau)\\end{aligned}\\]其中 \\(\\eta_i=\\boldsymbol{\\beta'x}_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\)，\\(\\boldsymbol x_i\\) 是解释变量的值向量，\\(h_0(\\tau)\\) 是 \\(\\tau\\) 处的基线风险函数。第 \\(\\) 个个体在时间 \\(\\tau\\) 后经历事件的概率是生存函数 \\(S_i(\\tau)\\)，因此 \\(S_i(\\tau)=1 − p_i(\\tau)\\)。现在，根据第 3 章式 (3.26)\\[\\begin{align}\nS_i(\\tau)=\\{S_0(\\tau)\\}^{\\exp(\\eta_i)}\n\\tag{11.1}\n\\end{align}\\]其中 \\(S_0(\\tau)\\) 是基线生存函数在 \\(\\tau\\) 处的值，即所有解释变量均取零值的个体的生存函数。因此，在此模型下，截至时间 \\(\\tau\\) 事件的概率为\\[\\begin{aligned}p_i(\\tau)=1-\\{S_0(\\tau)\\}^{\\exp(\\eta_i)}\\end{aligned}\\]因此\\[\\begin{aligned}\\log[-\\log\\{1-p_i(\\tau)\\}]=\\eta_i+\\log\\{-\\log S_0(\\tau)\\}\\end{aligned}\\]记 \\(\\beta_0=\\log\\{-\\log S_0(\\tau)\\}\\)，该模型可表示为\\[\\begin{align}\n\\log[-\\log\\{1-p_i(\\tau)\\}]&=\\beta_0+\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\n\\tag{11.2}\n\\end{align}\\]这是截至时间 \\(\\tau\\) 的事件发生概率的互补双对数 (complementary log-log) 变换的线性模型。该模型可以拟合二分类响应变量的数据，对于研究中在时间 \\(\\tau\\) 之前没有经历过事件的个体，该变量的值为零，否则为一。使用类似的方式可定义另一个互补双对数模型，用于刻画给定时间之后事件发生的概率 \\(1 − p_i(\\tau)\\)。与生存数据建模一样，可以基于统计量 \\(-2\\log\\hat{L}\\) 来比较为二元响应变量数据拟合的模型。这里，\\(\\hat{L}\\) 是二元数据的最大似然，\\(-2\\log\\hat{L}\\) 通常称为偏差 (deviance). 两个嵌套模型的偏差之差具有渐近卡方分布，因此可以按照与生存分析中使用的模型相同的方式比较二元数据的拟合模型。当为观测数据拟合式 (11.2) 中的模型时，常数 \\(\\beta_0\\) 的估计是 \\(\\log\\{-\\log S_0(\\tau)\\}\\) 的估计，由此可以获得基线生存函数在 \\(\\tau\\) 处的估计。该模型中的 \\(\\beta\\) 是对数风险比，相应的风险比的置信区间可根据 \\(\\hat \\beta_0\\) 的标准误按常规方法求出。示例 11.1  (溃疡复发) 第 9 章示例 9.1 给出了比较两种治疗方法（记作 和 B）的临床试验中溃疡复发时间的数据。在本例中，对招募到研究后 12 个月内复发的概率进行了建模。在研究的 43 名患者中，11 名患者在第一年出现复发，即患者 1, 10, 14, 15, 17, 18, 26, 27, 30, 32 和 37. 此外，三名患者在六个月时的结果为阴性，因此不知道他们在那之后是否复发。这三个患者的数据已被省略，因此本例中使用的数据集中现在有 40 个患者。为了对治疗后前 12 个月内溃疡复发的概率进行建模，定义了一个二元响应变量，如果患者在 12 个月内经历了复发，则该变量取值为 1，否则取值为 0。然后采用一种模型，其中响应概率的互补双对数变换与治疗（\\(Treat\\)）、患者年龄（\\(Age\\)）和疾病持续时间（\\(Dur\\)）相关。这里，如果患者接受治疗 ，\\(Treat\\) 取值 0，如果接受治疗 B，则取值为 1；如果疾病持续时间小于五年，则 \\(Dur\\) 为 0，否则为 1.表 11.1 给出了为二元响应变量拟合具有各种项的互补双对数模型的偏差。所有拟合的模型都包含一个常数项。\n表 11.1 中的偏差表明，没有任何证据表明治疗与变量 \\(Dur\\) 和 \\(Age\\) 之间存在交互作用。将 \\(Treat\\) 添加到包含 \\(Dur\\) 和 \\(Age\\) 的模型时，一个自由度上的偏差变化仅为 0.102，并不显著。此外，为零模型添加 \\(Dur\\) 或 \\(Age\\) 都不会导致偏差显著减小。单独拟合 \\(Treat\\) 导致的偏差变化在一个自由度上仅为 0.084，这也远远谈不上显著。由此得出的结论是，患者随机接受的治疗确实会影响第一年溃疡复发的概率。在拟合仅包含 \\(Treat\\) 的模型时，\\(Treat\\) 的系数估计为 0.181，标准误为 0.629. 接受治疗 B 的患者溃疡复发相对于接受治疗 的患者的风险比为 \\(\\exp(0.181)=1.20\\)，因此接受治疗 B 的患者的溃疡复发风险高出 20%。然而，该风险比与一没有显著差异。对数风险比的 95% 置信区间的上下限为 \\(0.181\\pm1.96\\times0.629\\)，因此风险比本身的相应区间估计为 \\((0.35, 4.11)\\)。请注意，此区间包括一，这是缺乏显著治疗效应所预示的结果。该拟合模型中的常数项估计为 −1.246。这是 \\(\\log\\{-\\log S_0(12)\\}\\) 的估计，其中 \\(S_0(12)\\) 是接受治疗 的患者在 12 个月时的生存函数。因此，接受治疗 的患者的复发概率估计为 \\(\\exp(-e^{-1.246})=0.75\\)。接受治疗 B 的患者的相应值为 \\(0.75^{\\exp(0.181)}=0.71\\)。这些估计假定所有患者最终都会经历复发，因此没有意义。然而，在第一年内复发的概率估计为：接受治疗 的患者为 0.25，接受治疗 B 的患者为 0.29。 这再次表明，在接受随机分组后的 12 个月内，接受治疗 B 的患者复发的概率略有增加。严格来说，基于特定时间的生存概率的分析只有在研究开始时指定了该时间时才有效，这可能很难做到。如果数据用于提出诸如生存超过两年的概率等终点，那么在解释显著性检验的结果时需要谨慎18。","code":""},{"path":"chap11.html","id":"sec11-2","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.2 分层比例风险模型","text":"有时会出现的一种情况是，风险在总体上不成比例，但在不同的数据亚组中成比例。例如，考虑将新药与特定疾病的治疗标准进行比较的情况。如果研究涉及两个中心，那么有可能在每个中心，新药都将死亡风险降低了一半，但标准药物的风险函数因中心而异。因此，使用特定药物的个体在这两个中心之间的风险不成比例。这种情况如图 11.3 所示。\n在此类问题中，可以假定每个亚组或层 (strata) 中的患者具有不同的基线风险函数，但所有其他解释变量在每层内都满足比例风险假设。假设第 \\(j\\) 层中的患者具有基线风险函数 \\(h_{0j} (t)\\)，其中 \\(j = 1, 2,...,g\\)，其中 \\(g\\) 是层数。解释变量对风险函数的效应可用 \\(h_{ij}(t)\\) 的比例风险模型来表示，即，第 \\(j\\) 层中第 \\(\\) 个个体的风险函数，其中 \\(= 1, 2,...,n_j\\) ，比如，\\(n_j\\) 是第 \\(j\\) 层的个体数。然后我们就有了分层比例风险模型 (stratified proportional hazards model)\\[h_{ij}(t)=\\exp(\\boldsymbol{\\beta'x}_{ij})h_{0j}(t)\\]其中 \\(\\boldsymbol x_{ij}\\) 是第 \\(\\) 个个体记录的 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 的值向量。该模型是结合风险调整的生存函数引入的，如第 3 章 3.11.1 节所述。作为该模型的一个例子，考虑一个特殊情况，在每个中心都有两种需比较的治疗，并且没有其他解释变量。令 \\(x_{ij}\\) 为指示变量 \\(X\\) 的值，如果第 \\(j\\) 个中心第 \\(\\) 名患者接受标准治疗，则为零，如果接受新治疗，则为一。则个体风险函数为\\[\\begin{aligned}h_{ij}(t)=e^{\\beta x_{ij}}h_{0j}(t)\\end{aligned}\\]在拟合该模型时，\\(\\beta\\) 的估计是每个中心接受新治疗的患者相对于标准治疗的患者的对数风险比。这种分层比例风险模型可以很容易使用标准软件包进行生存分析，并可使用 \\(-2\\log\\hat{L}\\) 统计量来比较嵌套模型。除了分层变量不能包含在模型的线性部分之外，不涉及任何新的原理。当比较两组或多组生存数据时，分层比例风险模型实际上相当于第 2 章 2.8 节中描述的分层 log-rank 检验。","code":""},{"path":"chap11.html","id":"sec11-2-1","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.2.1 治疗之间的非比例风险","text":"如果两种治疗之间存在不成比例的风险，忽视这一现象可能会得出误导性的推断。为了说明这一点，假设两组个体在新的标准治疗中的风险函数如图 11.4 () 所示。如果拟合了比例风险模型，则所得拟合的风险函数可能如图 11.4 (ii) 所示。那么，就会对两种治疗的相对优势得出错误的结论。\n治疗之间的非比例风险可以通过假定一系列连续时间区间中的比例风险来建模。这是使用分段 Cox 模型 (piecewise Cox model) 实现的，该模型类似于第 6 章介绍的分段指数模型。为了说明模型的使用，假设图 11.4 中给出风险函数的时间段分为三个区间，即 \\((0,t_1],(t_1,t_2]\\) 和 \\((t_2,t_3]\\)。在每一个时间区间内，可以假定风险成比例。现在，令 \\(X\\) 是与两种治疗相关的指标变量，如果个体接受标准治疗，则 \\(X=0\\)，如果个体接受新治疗，则 \\(X=1\\)。那么可以通过定义两个时依变量 \\(X_2(t)\\) 和 \\(X_3(t)\\) 来拟合分段 Cox 回归模型，这两个变量如下所示\\[\\left.X_2(t)=\\left\\{\\begin{array}{l}1\\text{ }t\\(t_1,t_2]\\text{ }X=1,\\\\0\\text{ otherwise};\\end{array}\\right.\\right.\\\\\n\\left.X_3(t)=\\left\\{\\begin{array}{l}1\\text{ }t\\(t_2,t_3]\\text{ }X=1,\\\\0\\text{ otherwise};\\end{array}\\right.\\right.\\]在没有其他解释变量的情况下，第 \\(\\) 个个体在时间 \\(t\\) 的风险函数模型可写为\\[\\begin{align}\nh_i(t)=\\exp\\{\\beta_1x_i+\\beta_2x_{2i}(t)+\\beta_3x_{3i}(t)\\}h_0(t)\n\\tag{11.3}\n\\end{align}\\]其中 \\(x_i\\) 是第 \\(\\) 个个体的 \\(X\\) 值，\\(x_{2i}(t)\\) 和 \\(x_{3i}(t)\\) 是第 \\(\\) 个个体两个时依变量在时间 \\(t\\) 处的值。在此模型下，新治疗个体相对于标准治疗个体的对数风险比：当 \\(t\\\\left(0,t_1\\right]\\) 时，为 \\(\\beta_1\\)；当 \\(t\\\\left(t_1,t_2\\right]\\) 时，为 \\(\\beta_1+\\beta_2\\)；当 \\(t\\\\left(t_2,t_3\\right]\\) 时，为 \\(\\beta_1+\\beta_3\\)。该模型可按照第 8 章描述的方式进行拟合。式 (11.3) 的模型允许通过将变量 \\(x_{2i}(t)\\) 和 \\(x_{3i}(t)\\) 添加到仅包含 \\(x_i\\) 的模型来检验比例风险假设。\\(-2\\log\\hat{L}\\) 统计量的显著减小表明新治疗（\\(X = 1\\)）相对于标准 治疗（\\(X = 0\\)）的风险比不是恒定的。对于第 \\(\\) 个个体，将 \\(x_{1i}(t)\\) 定义为以下值，并拟合包含 \\(x_{1i}(t),x_{2i}(t)\\) 和 \\(x_{3i}(t)\\) 的模型，可以获得式 (11.3) 中模型的等价公式：\\[\\left.X_1(t)=\\left\\{\\begin{array}{l}1\\text{ }t\\(0,t_1]\\text{ }X=1,\\\\0\\text{ otherwise},\\end{array}\\right.\\right.\\]该模型中三个时依变量的系数是三个区间中新治疗相对于标准的对数风险比。风险比的置信区间可以直接从该版本的模型中获得。示例 11.2  (胃癌患者的生存) 在 Gastrointestinal Tumor Study Group 进行的一项随机对照试验中，招募了 90 名局部晚期胃癌患者。他们被随机分配接受单独的化疗，即，5-氟尿嘧啶与 1-(2-氯乙基)-3-(4-甲基环己基)-1-亚硝基脲甲基（甲基 CCNU）的组合，或接受该化疗治疗与 5000 rad 的外部放疗的组合。患者随访 8 年以上，关注的结果是从随机分组到死于胃癌的天数，Stablein Koutrouvelis (1985) 报告的数据见表 11.2.\n每个治疗组患者的生存函数的 Kaplan-Meier 估计如图 11.5 所示。这一图形表明，在最初的两年里，接受化疗与放疗联合治疗的患者的生存率低于单独接受化疗的患者。然而，从长远来看，联合治疗更为有利。图 11.6 中对数累积风险图中的两条线不平行，再次证实了治疗效应是时依的。如果忽略数据的这一方面，并拟合 Cox 回归模型，相对于单独的化疗治疗，联合治疗的估计风险比将为 1.11，将治疗效应添加到零模型后，\\(-2\\log\\hat{L}\\) 统计量变化对应的 \\(P\\) 值为 0.64. 那么我们会得出结论，没有证据表明存在治疗效应，但由于两种治疗的死亡风险不成比例，因此该分析是不正确的。\n使用分段 Cox 回归模型可获得治疗效应更合适的总结，其中假定治疗效应在每个独立的区间中是恒定的，但在不同区间中不同。本分析将使用四个时间区间：\\(1–360,~361–720,~721–1080\\) 和 \\(1081–\\) 天。然后，通过定义四个变量 \\(X_1(t),X_2(t),X_3(t),X_4(t)\\) 来设定时依治疗效应，其中，当 \\(t\\) 在联合治疗的患者的第 \\(j(j=1,2,3,4)\\) 个时间区间内时，\\(X_j(t)=1\\)，否则为 0. 这相当于拟合与四个区间相关的时依变量与治疗效应之间的交互作用。如果 \\(x_{ji}(t)\\) 是第 \\(\\) 个个体第 \\(j\\) 个变量时间 \\(t\\) 处的值，则时间 \\(t\\) 处的死亡风险的 Cox 回归模型为\\[\\begin{aligned}h_i(t)=\\exp\\left\\{\\beta_1x_{1i}(t)+\\beta_2x_{2i}(t)+\\beta_3x_{3i}(t)+\\beta_4x_{4i}(t)\\right\\}h_0(t)\\end{aligned}\\]其中 \\(h_0(t)\\) 是基线风险函数。在该模型中，四个 \\(\\beta\\) 系数是在四个区间中联合治疗相对于单独化疗的对数风险比，\\(h_0(t)\\) 是接受化疗治疗的患者的风险函数。拟合所有四个时依变量后，\\(-2\\log\\hat{L}\\) 的值为 602.372. 对于仅拟合治疗效应的模型，在比例风险假设下，第 \\(\\) 名患者在时间 \\(t\\) 处的死亡风险为 \\(h_i(t)=\\exp(\\beta x_i)h_0(t)\\)，其中 \\(x_i\\) 是第 \\(\\) 名患者变量 \\(X\\) 的值，其中，对于接受化疗治疗的患者，\\(X = 0\\)，对于接受联合治疗的患者，\\(X = 1\\)。该模型的 \\(-2\\log\\hat{L}= 614.946\\)。这两个模型是嵌套的，它们的 \\(-2\\log\\hat{L}\\) 值之差提供了比例风险检验。在三个自由度上，12.57 的差值具有高度显著性（\\(P = 0.005\\)），证实有明确证据表明治疗效应的风险比不成比例，对于拟合四个时依变量的模型，风险比和 95% 置信区间见表 11.3.\n该表总结了治疗效应在四个时间区间内的变化情况。在第一年，接受联合治疗的患者在任何时间的死亡风险是单独接受化疗的患者的两倍以上。在随后的几年中，接受联合治疗的患者的死亡风险降低，尽管三个区间估计值均包括 1.0，这表明这些风险比与一没有显着差异。","code":""},{"path":"chap11.html","id":"sec11-3","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.3 限制性平均生存","text":"当风险不成比例时，风险比就不是协变量或治疗效应的适当总结，因为风险比是时依的，因此对该比的单一估计可能会产生误导。另一种易于解释的总结性度量为，直到某个预定时间点的平均生存时间，称为限制性平均生存时间 (restricted mean survival time).为了定义限制性平均生存时间，假设 \\(T\\) 是与生存时间相关的随机变量。直到 \\(t_0\\) 的限制性平均生存时间 \\(\\mu(t_0)\\) 是随访期间 \\(T\\) 和 \\(t_0\\) 最小值的期望值，因此 \\(\\mu(t_0)=\\text{ E}\\left(\\min\\{T,t_0\\}\\right)\\)。现在，\\[\\begin{aligned}\\operatorname{E}\\left(\\min\\{T,t_0\\}\\right)&=\\operatorname{E}\\left(T;T\\leqslant t_0\\right)+t_0\\operatorname{P}(T>t_0)\\end{aligned}\\]并且当 \\(T\\) 具有密度为 \\(f(t)\\) 的参数分布时，有\\[\\begin{aligned}\\operatorname{E}\\left(T;T\\right.\\leqslant t_0)=\\int_0^{t_0}uf(u)\\mathrm{d}u\\end{aligned}\\]\n分部积分得到\\[\\begin{aligned}\\int_0^{t_0}uf(u)\\mathrm{d}u&=uF(u)|_0^{t_0}-\\int_0^{t_0}F(u)\\mathrm{d}u=t_0F(t_0)-\\int_0^{t_0}F(u)\\mathrm{d}u\\end{aligned}\\]因此\\[\\begin{aligned}\\int_0^{t_0}uf(u)\\mathrm{d}u&=\\int_0^{t_0}S(u)\\mathrm{d}u-t_0S(t_0)\\end{aligned}\\]最后，由于 \\(t_0\\text{P}(T>t_0)=t_0S(t_0)\\)，有\\[\\mathrm{E}\\left(\\min\\{T,t_0\\}\\right)=\\int_0^{t_0}S(u)\\mathrm{d}u\\]因此，限制性平均生存时间是生存函数估计直到 \\(t_0\\) 下的面积，并且是易于理解的总结统计量。例如，如果时间以月为单位，则 \\(\\mu (24)\\) 是 24 个月期间的平均存活月数，即两年预期寿命。该统计量也可用于总结治疗参数或其他解释变量对特定时间段预期寿命的影响。限制性平均生存可根据生存函数的 Kaplan-Meier 估计来确定。例如，在第 \\(r\\) 个有序事件时间 \\(t_{(r)}\\) 的限制性平均估计为\\[\\begin{aligned}\\hat{\\mu}(t_{(r)})&=\\sum_{j=1}^r\\hat{S}(t_{(j-1)})(t_{(j)}-t_{(j-1)})\\end{aligned}\\]其中 \\(\\hat{S}(t_{(j)})\\) 是第 \\(j\\) 个事件时间 \\(t_{(j)}\\) 时生存函数的 Kaplan-Meier 估计，其中 \\(t_{(0)}\\) 定义为零。该估计的标准误由下式给出：\\[\\left(\\sum_{j=1}^{r-1}A_j^2\\frac{d_j}{n_j(n_j-d_j)}\\right)^{\\frac12}\\]其中 \\(n_j\\) 是处于风险的个体数，\\(d_j\\) 是 \\(t_{(j)}\\) 时的事件数，并且\\[\\begin{aligned}A_j=\\sum_{=j}^{r-1}\\hat{S}(t_{()})(t_{(+1)}-t_{()})\\end{aligned}\\]若需要在非事件时间处估计限制性生存，则要对这些结果进行微小的修改。当存在两组生存时间时，如在比较两种治疗的临床试验中，并预期或已发现了非比例风险时，可根据两生存函数的 Kaplan-Meier 估计下面积来确定限制性平均生存时间。直到给定时间的限制性平均生存估计的差异可作为总体治疗效应未调整的总结性度量。更一般地说，考虑两个治疗组之间风险不成比例并且可以获得其他解释变量值的情况。在这里，可以使用具有不同潜在风险的参数模型，例如每个治疗组具有不同形状参数的 Weibull 模型。该模型下的生存函数是完全参数化的，因此可对拟合的生存函数进行积分来估计限制性平均生存时间，或解析地或数值地。通过使用第 6 章 6.4 节描述的 Royston Parmar模型，可以在潜在基线风险函数建模时获得更大程度的灵活性。通过添加治疗因素与定义基线风险的限制性立方样条函数之间的交互项，可以拟合每个治疗组不同的潜在风险函数。同样，限制性平均生存时间可以通过对拟合的生存函数进行积分来获得。","code":""},{"path":"chap11.html","id":"sec11-3-1","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.3.1 伪值的使用","text":"对限制性平均生存关于解释变量的依赖性进行建模的一种通用且直接的方法是基于伪值 (pseudo-values)。这些值是由从 \\(n\\) 个个体的完整集合中获得的某个量的估计与省略第 \\((=1,2,\\ldots,b)\\) 个个体获得的估计之差形成的。然后使用标准回归模型对伪值关于解释变量的依赖性进行建模。为了获得限制性平均的伪值，首先确定完整生存时间集的生存函数的 Kaplan-Meier 估计，从中获得某个 \\(t_0\\) 处的限制性平均生存，即 \\(\\hat \\mu(t_0)\\)。然后，依次省略每个观测，并根据缩减数据集估计限制性平均生存，给出 \\(\\hat{\\mu}_{(-)}(t_0)(=1,2,\\ldots,n)\\)。那么第 \\(\\) 个伪值为\\[\\begin{align}\nz_i=n\\hat{\\mu}(t_0)-(n-1)\\hat{\\mu}_{(-)}(t_0)\n\\tag{11.4}\n\\end{align}\\]这度量了第 \\(\\) 个个体对 \\(t_0\\) 处限制性平均生存时间估计的贡献，并且无论该个体的观测生存时间是否为删失的，其定义都是如此。然后假定第 \\(\\) 个伪值 \\(z_i\\) 为随机变量 \\(Z_i\\) 的观测，则可以使用广义线性模型对 \\(Z_i\\) 的期望值关于治疗因素和解释变量的依赖性进行建模。一个自然的选择是假定 \\(Z_i\\) 是正态分布的，对其均值 \\(\\mathrm{E}\\left(Z_{}\\right)\\) 建立对数线性模型。那么 \\(\\log\\text{ E}\\left(Z_i\\right)=\\beta_0+\\boldsymbol{\\beta'x}_i\\)，其中 \\(\\beta_0\\) 是一个常数，\\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体解释变量的值向量。\\(\\mathrm{E}\\left(Z_{{}}\\right)\\) 的线性回归模型通常会给出类似的结果。在实际应用中，\\(t_0\\) 的值必须在分析之前确定。当感兴趣的是特定时间段内事件的发生时，该时间段将确定 \\(t_0\\) 的值。例如，如果感兴趣的是在诊断出特定形式的癌症后一年内的平均生存时间，则 \\(t_0\\) 将是 365 天。在其他情况下，\\(t_0\\) 通常取为接近数据集中最长的观测事件时间。示例 11.3  (胃癌患者的生存) 对示例 11.2 给出的胃癌患者生存时间数据的另一种分析基于限制性平均。计算 5 年的限制性平均生存，即，每个治疗组中患者生存函数的 Kaplan-Meier 估计直到 \\(t=1826\\) 下的面积。这对于单一化疗为 \\(661.31\\text{ (se = 74.45)}\\)，对于联合治疗为 \\(571.89\\text{ (se = 94.04)}\\)，这意味着在 5 年的时间里，患者在单独化疗时平均生存 1.8 年，在联合治疗时平均生存 1.6 年。两个治疗组直到 1826 天的限制性平均生存时间的 95% 置信区间分别为 \\((515.39,807.23)\\) 和 \\((387.57,756.21)\\)。由于这些区间之间存在很大的重叠，因此没有证据表明两组之间的限制性平均生存时间存在差异。接下来我们将说明如何使用伪值分析这些数据。首先，获得完整数据集的生存函数的 Kaplan-Meier 估计，由此，直到 1826 天的限制性平均估计为 616.60 天。这是对这段时间内患者平均生存时间的总体估计。然后依次省略每个观测（共 90 个），并根据每组（共 89 个观测）数据重新计算 Kaplan-Meier 估计。然后对每组（共 90 组）数据估计直到 1826 天的限制性平均，然后使用式 (11.4) 获得 90 个伪值。这些值表示每个观测对五年限制性平均总体估计的贡献。对于表 11.2 中的数据，伪值等于 1826 天之前死亡的患者的观测生存时间，而对于生存超过该时间的 10 名患者，伪值均等于 1826. 伪值出现这种模式的原因在于，删失生存时间是数据集中最长的观测随访时间。下一步是对伪值关于治疗效应的依赖性进行建模。这可以使用第 \\((=1,2,\\ldots,n)\\) 个伪观测的期望值 \\(\\mathrm{E}\\left(Z_{{}}\\right)\\) 的对数线性模型来完成，即 \\(\\log\\text{ E}\\left(Z_i\\right)=\\beta_0+\\beta_1x_i\\)，如果第 \\(\\) 名患者接受单独化疗，则 \\(x_i=0\\)，否则 \\(x_i=1\\)。在对数线性模型中添加治疗效应后，偏差从 28591297（自由度为 89）减小为 28411380（自由度为 88），因此用于检验治疗效应的 \\(F\\text{-ratio}\\) 为 \\((28591297-28411380)/\\{28411380/88\\}=0.56\\)，这作为自由度为 1, 88 的 \\(F\\) 统计量，并不显著（\\(P=0.46\\)）。使用 \\(\\mathrm{E}\\left(Z_{{}}\\right)\\) 的线性模型获得了大致相同的结果，这相当于使用两样本 \\(t\\) 检验来比较每个治疗组伪值的均值。因此，为化疗增加放疗对患者 1826 天内的生存不起作用。总之，表 11.2 中的数据表明，化疗与放疗的联合治疗对患者有长期的益处，只要他们能熬过最初18个月左右的高死亡风险期。但是，在 5 年的随访期内，平均而言，联合治疗对生存没有益处。","code":""},{"path":"chap11.html","id":"sec11-4","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.4 机构的比较","text":"对卫生服务问责的需求导致了一系列绩效指标的引入，这些指标用于度量不同机构提供的护理质量。其中一项关键指标是风险调整的死亡率，该指标总结了不同医疗机构中患者的死亡率，同时考虑了接受治疗的患者特征的差异。此类统计量提供了一种在平等的基础上比较机构绩效的方法。可以为生存率、康复率和感染率定义类似的度量，本节描述的方法同样适用于其他类型组织之间的比较，如学校、大学和金融服务提供商。在本节中，我们描述并说明了如何从生存数据中获得风险调整失效率 (risk-adjusted failure rate, RAFR) 的点估计和区间估计。\\(RAFR\\) 是在给定时间处下式的估计\\[\\begin{align}\n\\frac{\\text{观测失效率}}{\\text{预期失效率}} \\times \\text{总失效率}\n\\tag{11.5}\n\\end{align}\\]其中，观测失效率是根据特定机构在给定时间的生存函数的 Kaplan-Meier 估计获得的，而当时的总失效率是根据所有机构的数据拟合的生存函数估计的，这忽略了它们之间的差异。机构的预期失效率可根据第 3 章 3.11 节中定义的风险调整的生存函数进行估计，该函数是机构在给定时间基于风险调整的个体生存函数估计的平均值。用 1 生存函数减去的相应值来获得在给定时间每个失效率的估计。一旦获得 \\(RAFR\\)，可以简单地根据 \\(RASR=1−RAFR\\) 得到风险调整生存率 (risk-adjusted survival rate, RASR).示例 11.4  (肾移植中心之间的比较) 本节介绍的方法将通过英国八家肾移植中心的数据进行说明，这些数据反映了从 2009 年 1 月至 2011 年 12 月三年期间肾移植受体的移植生存率情况。有许多因素可能会影响中心的生存率，在本示例中，考虑了供体年龄、供体是脑死亡 (DBD) 还是因循环衰竭而亡 (DCD) 的指标，移植时受体的年龄、受体的糖尿病状况（不存在、存在）以及从供体取出肾脏到移植到受体体内经历的时间（称为冷缺血时间）。还记录了移植存活时间，这定义为移植失败和患者死亡中的较早时间，以及一个事件指示符：如果在最后已知的随访日期或 2012 年 12 月，患者还存活且移植物正常工作，则为零，否则为一。变量总结如下。\\(Patient\\)：患者标识符\\(Centre\\)：移植中心 \\((1,2,\\ldots,8)\\)\\(Tsurv\\)：移植生存期（天）\\(Tcens\\)：事件指示符（0 = 删失，1 = 移植失败）\\(Dage\\)：供体年龄\\(Dtype\\)：供体类型（0 = DBD，1 = DCD）\\(Rage\\)：受体年龄\\(Diab\\)：糖尿病状态（0 = 不存在，1 = 存在）\\(CIT\\)：冷缺血时间（小时）数据集中有 1439 名患者，前 30 名移植患者的数据如表 11.4 所示。7 号患者的移植肾脏未正常工作，因此该患者的 \\(Tsurv = 0\\)。\n我们最关注一年移植失败率，因此将使用这一指标对八个移植中心进行比较。我们首先获得了所有 1439 名患者未调整的生存函数的 Kaplan-Meier 估计，从中得到一年总失效率为 \\(1−0.904=0.096\\)。类似地，特定于中心的一年失效率是根据每个中心患者的生存函数的 Kaplan-Meier 估计中获得。接下来，使用第 3 章 3.11.1 节描述的方法计算每个中心的风险调整生存率。为数据拟合包含变量 \\(Dage,Dtype,Rage,Diab\\) 和 \\(CIT\\) 的 Cox 回归模型，根据该模型，第 \\(j(j=1,2,\\ldots8)\\) 个中心第 \\(\\) 名患者的生存函数估计为\\[\\begin{align}\n\\hat{S}_{{}{j}}(t)=\\{\\hat{S}_0(t)\\}^{\\exp(\\hat{\\eta}_{{}{j}})}\n\\tag{11.6}\n\\end{align}\\]其中\\[\\begin{aligned}\\hat{\\eta}_{ij}&=0.023Dage_{ij}+0.191Dtype_{ij}+0.002Rage_{ij}-0.133Diab_{ij}+0.016CIT_{ij}\\end{aligned}\\]\\(\\hat{S}_0(t)\\) 为基线生存函数。在第 \\(j\\) 个中心时间 \\(t\\) 处的平均生存函数为\\[\\hat{S}_j(t)=\\frac1{n_j}\\sum_{{}=1}^{{n}_j}\\hat{S}_{{}j}(t)\\]其中 \\(n_j\\) 是第 \\(j\\) 个中心的患者数，那么可以根据该生存函数估计一年的预期移植失败率。未调整和调整的一年生存率以及 \\(RAFR\\) 如表 11.5 所示。\n为了说明计算结果，对于中心 1，未调整和调整的一年生存率分别为 0.9138 和 0.8920，由于总体未调整生存率为 0.096，因此 \\(RAFR\\) 为\\[\\begin{aligned}\\frac{1-0.9138}{1-0.8920}\\times0.096&=0.077\\end{aligned}\\]该中心相应的风险调整移植生存率为 0.923。在这 8 个中心中，风险调整的一年失效率在 6% 到 17% 之间。计算式 (11.5) 中 \\(RAFR\\) 的另一种更方便的方法为，在给定时间内对下式进行估计\\[\\begin{align}\n\\frac{\\text{观测失效数}}{\\text{预期失效数}} \\times \\text{总失效数}\n\\tag{11.7}\n\\end{align}\\]为了使用这个定义来估计 \\(RAFR\\)，我们需要对所关注的时间段内的预期失效数进行估计。从第 1 章 1.4 节可以看出，时间 \\(t\\) 处的累积失效风险 \\(H(t)\\) ，是假定在此之前没有发生过故障，直到 \\(t\\) 的期间内的预期失效数。因此，对于第 \\(j\\) 个机构生存到时间 \\(t_{ij}\\) 的第 \\(\\) 个个体，\\(H_{ij} (t_{ij})\\) 为其随访期间的预期失效数。利用第 1 章式 (1.8)的结果，中心 \\(j\\) 的失效数估计为\\[\\begin{align}\n\\hat{e}_j=\\sum_{=1}^{n_j}\\hat{H}_{ij}(t_{ij})=-\\sum_{=1}^{n_j}\\log\\hat{S}_{ij}(t_{ij})\n\\tag{11.8}\n\\end{align}\\]其中 \\(\\hat{S}_{ij}(t_{ij})\\) 在式 (11.6) 中定义。示例 11.5  (肾移植中心之间的比较) 根据示例 11.4 描述的数据，现在使用式 (11.7) 来估计八个肾移植中心移植结果的 \\(RAFR\\). 首先确定每个中心第一年的观测移植失败数。接下来，为数据拟合 Cox 回归模型，以给出第 \\(j\\) 个中心第 \\(\\) 个患者生存函数的估计 \\(\\hat{S}_{ij}(t)\\)。对于 \\(Tsurv \\leqslant 365\\) 的患者，获得了他们的生存函数在其 \\(Tsurv\\) 值处的估计，而对于 \\(Tsurv > 365\\) 的患者，获得了他们的生存函数在 \\(t = 365\\) 处的估计。然后获得每个患者累积风险的相应估计，并利用式 (11.8)，对第 \\(j\\) 个中心的患者的这些估计进行求和，得出该中心预期失效数的估计。这些值如表 11.6 所示。为了说明计算结果，对于中心 1，第一年有 23 例移植失败，预期数估计为 28.96. 总体失效率为 0.096，因此该中心的 \\(RAFR\\) 为\\[\\begin{aligned}RAFR&=\\frac{23}{28.96}\\times0.096=0.076\\end{aligned}\\]此表中的 \\(RAFR\\) 值与表 11.5 给出的值非常相似。","code":""},{"path":"chap11.html","id":"sec11-4-1","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.4.1 \\(RAFR\\) 的区间估计","text":"为了获得风险调整的失效率的区间估计，我们使用式 (11.7) 中的定义，并假定估计预期失效数和总失效率时的误差可以忽略不计。这个假定常常是合理的，因为这些量是从涵盖所有机构的大型数据集获得的。现在，令 \\(Y_j\\) 是与给定时间段内第 \\(j\\) 个机构中的 \\(n_j\\) 个个体失效数相关的随机变量，并且设 \\(y_j\\) 是相应的观测值。另外，设 \\(p_j\\) 是第 \\(j\\) 个机构的失效概率，则 \\(Y_j\\) 服从二项分布。通常，\\(n_j\\) 将足够大，使得二项分布的泊松近似是有效的，根据该近似，当 \\(n_j\\rightarrow\\infty,p_j\\rightarrow\\infty\\) 且 \\(\\mu_jp_j\\) 保持有限值时，参数为 \\(n_j,p_j\\) 的二项分布趋于均值为 \\(\\mu_j\\rightarrow\\infty\\) 泊松分布。那么，与第 \\(j\\) 个机构的失效数相关的随机变量 \\(Y_j\\) 具有均值为 \\(\\mu_j\\) 的泊松分布。请注意，该结果仅在失效概率较小时有效，因为当失效不太频繁时，失效概率就会较小。此外，这一结果意味着我们不需要在下面的计算中详细考虑 \\(n_j\\) 的值，这在个体可能具有删失生存时间时特别有用。使用第 2 章的式 (2.8) 的结果，\\(\\log Y_j\\) 近似服从均值为 \\(\\log \\mu_j\\)、方差为 \\(\\operatorname{var}\\left(\\log Y_j\\right)\\approx\\mu_j^{-2}\\operatorname{var}\\left(Y_j\\right)\\) 的正态分布，利用这一结果可获得第 \\(j\\) 个机构死亡人数的近似区间估计。 现在，泊松随机变量的方差等于其均值，因此 \\(\\mathrm{var}\\left(Y_j\\right)=\\mu_j\\)，并且 \\(\\log Y_j\\) 的方差约为 \\(1/\\mu_j\\) 。由于 \\(\\mu_j\\) 的最佳估计仅是观测失效数 \\(y_j\\) ，因此该方差可通过 \\(1/y_j\\) 来估计。由此，失效数的 95% 区间估计是区间 \\(\\operatorname{exp}\\{\\operatorname{log}y_j\\pm1.96/√(y_j)\\}\\)。还可计算特定机构失效数的“精确”泊松限。假设我们观测到均值为 \\(\\mu\\) 的泊松随机变量 \\(Y\\) 的值为 \\(y\\)。\\(\\mu\\) 的 95% 区间的下限是 \\(y_L\\)，满足当 \\(\\mu=y_L\\) 时 \\(\\mathrm{P}(Y\\geqslant y)=0.025\\)。类似地，\\(\\mu\\) 的 95% 区间的上限是 \\(y_U\\)，满足当 \\(\\mu=y_U\\) 时，\\(\\mathrm{P}(Y\\leqslant y)=0.975\\)。这些限可证明具有理想的最优性。为了计算这些精确的限，我们可以使用一般结果：如果 \\(Y\\) 具有均值为 \\(\\mu\\) 的泊松分布，并且 \\(X\\) 具有形状参数为 \\(y + 1\\) 且尺度参数为一的 gamma 分布，即 \\(Y\\sim P(\\mu),X\\sim\\Gamma(y+1,1)\\)，那么 \\(P(Y\\leqslant y)=1-P(X\\leqslant\\mu)\\)。这意味着\\[\\begin{align}\n\\sum_{k=0}^y\\frac{e^{-\\mu}\\mu^k}{k!}&=1-\\int_0^\\mu\\frac{e^{-x}x^y}{\\Gamma(y+1)}\\mathrm{d}x\n\\tag{11.9}\n\\end{align}\\]其中 \\(\\Gamma(y+1)=y!\\) 为 gamma 函数。gamma 分布在第 5 章 5.1.2 节介绍过，该结果可用分部积分来验证。事件数 95% 区间的下限 \\(y_L\\) 是泊松随机变量 \\(Y\\) 满足 \\(\\text{P}(Y\\geqslant y)=0.025\\) 的期望值。改写式 (11.9) 中的结果\\[\\begin{aligned}\\mathrm{P}(Y\\geqslant y)&=1-\\mathrm{P}(Y\\leqslant y-1)=1-\\sum_{k=0}^{y-1}\\frac{e^{-y_L}y_L^k}{k!}=\\int_0^{y_L}\\frac{e^{-x}x^{y-1}}{\\Gamma(y)}\\mathrm{d}x\\end{aligned}\\]所以 \\(y_L\\) 满足\\[\\begin{aligned}\\int_0^{\\large y_L}\\frac{e^{-x}x^{\\large y-1}}{\\Gamma(y)}\\mathrm{d}x&=0.025\\end{aligned}\\]这意味着 \\(y_L\\) 是形状参数为 \\(y\\)、尺度参数为一的 gamma 随机变量的下 2.5% 分位点，因此可以从 gamma 分布的逆累积分布函数获得。同样，95% 置信区间的上限 \\(y_U\\) 是泊松随机变量满足 \\(\\mathrm{P}(Y\\leqslant y)=0.025\\) 的期望值。再次使用式 (11.9)\\[\\begin{aligned}\\mathrm{P}(Y\\leqslant y)&=\\sum_{k=0}^{y}\\frac{e^{-y_U}y_U^k}{k!}=1-\\int_{0}^{y_U}\\frac{e^{-x}x^y}{\\Gamma(y+1)}\\mathrm{d}x\\end{aligned}\\]因此 \\(y_U\\) 是形状参数为 \\(y\\)、尺度参数为一的 gamma 随机变量的上 2.5% 分位点。作为说明，假设特定机构的观测事件数为 \\(y = 9\\)，如示例 11.4 中肾移植失败率数据的中心 6. 形状参数为 9、尺度参数为 1 的 gamma 分布的下 2.5% 分位点为 \\(y_L = 4.12\\)，因此当 \\(Y\\) 具有均值为 \\(\\mu = 4.12\\) 的泊松分布时，\\(\\mathrm{P}(Y\\geqslant9)=0.025\\)。此外，形状参数为 10、尺度参数为 1 的 gamma 分布的上 2.5% 分位点为 \\(y_U = 17.08\\)，因此当 \\(Y\\) 具有均值为 17.08 的泊松分布时，\\(\\mathrm{P}(Y\\leqslant9)=0.025\\)。这两个分布如图 11.7 所示。均值为 4.12 的分布中 \\(y = 9\\) 右侧的尾部面积和均值为 17.08 的分布中 \\(y = 9\\) 左侧的尾部面积均等于 0.025。观测事件数的精确 95% 区间估计为 \\((4.12, 17.08)\\)。\n使用近似或精确方法获得失效数的区间估计 \\((y_L, y_U)\\) 后，\\(RAFR\\) 的相应限为 \\(\\frac{y_L}{e_j}\\times\\) 总失效率和 \\(\\frac{y_U}{e_j}\\times\\) 总失效率。其中 \\(e_j\\) 是第 \\(j\\) 个机构的失效数估计，使用式 (11.8) 获得，误差可忽略不计。示例 11.6  (肾移植中心之间的比较) 对于示例 11.4 给出的 8 个中心的肾移植结果数据，\\(RAFR\\) 的近似和精确的 95% 置信限如表 11.7 所示。\n为了说明如何计算这些区间的估计，请考虑中心 1 的数据，其中 \\(y_1=23\\)，相应的预期死亡数在示例 11.5 估计为 28.96. 该中心移植失败数对数的标准误为 \\(1/\\sqrt{(y_1)}=1/\\sqrt{(23)}=0.209\\)。那么，\\(y_1\\) 的 95% 置信区间为 \\(\\exp(\\log23\\pm1.96\\times0.209)\\)，即 \\((15.28,34.61)\\)，并且 \\(RAFR\\) 的相应区间为\\[\\left(\\frac{15.28}{28.96}\\times0.096,\\quad\\frac{34.61}{28.96}\\times0.096\\right)\\]即 \\((0.051,0.115)\\)。根据 \\(\\Gamma(23,1)\\) 随机变量的下 2.5% 分位点和 \\(\\Gamma(24,1)\\) 随机变量的上 2.5% 分位点可以得到该中心失效数的精确限。这得到了区间 \\((14.58,34.51)\\)，\\(RAFR\\) 的相应区间为\\[\\left(\\frac{14.58}{28.96}\\times0.096,\\quad\\frac{34.51}{28.96}\\times0.096\\right)\\]即 \\((0.048,0.115)\\)。表 11.7 显示，当观测失效数不小于 9 时，近似限和精确限之间的一致性非常好。","code":""},{"path":"chap11.html","id":"sec11-4-2","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.4.2 泊松回归模型的使用","text":"使用建模方法可以方便地获得 \\(RAFR\\) 的近似区间估计。令 \\(F_j\\) 为风险调整的失效率，\\(e_j\\) 为中心 \\(j\\) 的预期失效数，因此\\[\\begin{aligned}F_j=\\frac{y_j}{e_j}\\times\\text{总失效率}\\end{aligned}\\]由于我们假设与第 \\(j\\) 个机构失效数相关的随机变量 \\(Y_j\\) 具有均值为 \\(\\mu_j\\) 的泊松分布，因此有\\[\\begin{align}\n\\operatorname{E}\\left(F_j\\right)&=\\frac{\\mu_j}{e_j}\\times\\text{总失效率}\n\\tag{11.10}\n\\end{align}\\]为了对中心 \\(j\\) 的 \\(RAFR\\)，即 \\(F_j\\)，建模，我们取 \\(\\log \\text{ E}\\,(F_j)=c_j\\)，其中 \\(c_j\\) 是第 \\(j\\) 个机构的效应。现在，使用式 (11.10)\\[\\begin{aligned}\\log\\text{ E}\\left(F_j\\right)=\\log\\mu_j-\\log\\{e_j/(\\text{总失效率})\\}\\end{aligned}\\]这得到了 \\(\\mu_j\\) 的对数线性模型，其中\\[\\begin{align}\n\\log\\mu_j=c_j+\\log\\{e_j/(\\text{总失效率})\\}\n\\tag{11.11}\n\\end{align}\\]在该模型中，项 \\(\\log\\{e_j/(\\text{总失效率})\\}\\) 是具有已知的单位系数的变量，称为偏移 (offset). 当为每个机构的观测失效数 \\(y_j\\) 拟合式 (11.11) 中的对数线性模型时，该模型的未知参数数量等于观测数。因此，这将是对数据的完美拟合，因此拟合值 \\(\\hat{\\mu}_{j}\\) 将等于观测失效数。参数估计 \\(\\hat{c}_{j}\\) 将是 \\(\\log\\text{ E }(F_j)\\) 的拟合值，因此第 \\(j\\) 个中心的 \\(RAFR\\) 为 \\(\\exp(\\hat{c}_j)\\)。那么，\\(RAFR\\) 的 95% 置信区间为 \\(\\exp\\{\\hat{c}_j\\pm1.96\\text{ se}\\left(\\hat{c}_j\\right)\\}\\)，其中，可以从拟合的对数线性模型的计算机输出中获得 \\(\\hat{c}_{j}\\) 及其标准误。示例 11.7  (肾移植中心之间的比较) 表 11.8 给出了 \\(RAFR\\) 的区间估计，该估计是通过为 8 个中心移植失败数的数据拟合式 (11.11) 中的对数线性模型得到的。\n从拟合的对数线性模型中获得的 \\(RAFR\\) 值及其相应的区间估计与表 11.7 中给出的近似区间估计完全一致。","code":""},{"path":"chap11.html","id":"sec11-4-3","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.4.3 随机机构效应","text":"式 (11.11) 中关于预期事件数的对数线性模型为计算各机构 \\(RAFR\\) 的区间估计提供了一个框架。在该模型中，与机构效应相关的参数拟合为固定效应，当机构数较少时，这是完全合适的，如示例 11.4 所示。当机构较多时也可以使用这种方法，但此时将机构效应作为固定效应纳入模型是不可取的。相反，将采用随机效应对机构间变异进行建模。第 10 章 10.1.1 节在脆弱模型的背景下介绍了随机效应。假设第 \\(j\\) 个机构的效应 \\(c_j\\) 是从均值为 \\(\\alpha\\)、方差为 \\(\\sigma^2_c\\) 的正态分布中抽取的，表示为 \\(N(\\alpha,\\sigma_{c}^{2})\\)。由于第 \\(j\\) 个中心的 \\(RAFR\\) 的对数线性模型满足 \\(\\log \\text{ E }(F_j) = c_j\\)，因此各中心的预期 \\(RAFR\\) 值 \\(\\text{E }(F_j)\\) 的变异隐含了对数正态分布。或者，式 (11.11) 中的模型可以写为\\[\\begin{aligned}\\log\\mu_j=\\alpha+c_j+\\log\\{e_j/(\\text{总失效率})\\}\\end{aligned}\\]其中，\\(c_j\\) 具有 \\(N(0,\\sigma^2_c)\\) 分布，\\(\\alpha\\) 是 \\(RAFR\\) 的对数的总体值，因此 \\(e^\\alpha\\) 是总失效率。使用随机效应而不是固定效应会产生两个后果。首先，机构效应估计 \\(\\hat c_j\\) 向总体率 \\(\\hat\\alpha\\) “收缩”，而且 \\(RAFR\\) 越极端，收缩越大。第二，随机效应模型中对机构效应的区间估计将比使用固定效应时更短，从而提高了对未来患者的预测精度。当使用中心率来指导患者选择时，这两个特征都是令人满意的。第 3 章的 3.7 节在描述变量选择的 lasso 法时提到了收缩的概念。示例 11.8  (肾移植中心之间的比较) 随机中心效应现在用于为八个肾移植中心的移植失败观测数进行建模。令 \\(y_j\\) 为第 \\(j\\) 个中心的观测失效数，将 \\(y_j\\) 取为均值为 \\(\\mu_j\\) 的泊松随机变量的观测，得到模型\\[\\begin{aligned}\\log\\mu_j=c_j+\\log\\{e_j/(\\text{总失效数})\\}\\end{aligned}\\]且 \\(c_j\\sim N(\\alpha,\\sigma^2_c)\\)。\\(\\alpha\\) 的估计为 \\(\\tilde \\alpha = -2.341\\)，因此 \\(\\exp(\\tilde{\\alpha})=0.096\\)，与根据整体生存函数的 Kaplan-Meier 估计获得的失效率估计相同。中心效应的方差估计为 \\(\\tilde{\\sigma}_c^2=0.054\\)，标准误为 0.054，因此没有证据表明中心间变异存在显着差异。根据中心效应的估计 \\(\\tilde c_j\\) 可得到 \\(RAFR\\) 的估计 \\(\\exp(\\tilde c_j)\\)，这些估计是作为随机效应后验分布的众数的估计获得的（见第 10 章 10.4 节），展示在表 11.9 中。\n使用随机效应模型对 \\(RAFR\\) 的估计与表 11.8 所示的固定效应模型的估计相似，但更接近 0.096 的总体率。这一点在有最大 \\(RAFR\\) 的中心 8 尤为明显。此外，\\(\\text{se}\\left(\\tilde{c}_{j}\\right)\\) 的值通常较小，这反过来意味着相应的区间估计较窄。这两个特征说明了使用随机中心效应引起的收缩效应。","code":""},{"path":"chap11.html","id":"sec11-5","chapter":"第 11 章 非比例风险和机构的比较","heading":"11.5 延伸阅读","text":"Stablein, Carter Novak (1981) 以及 Gore, Pocock Kerr (1984) 给出了比例风险模型不适用的情况下的生存分析示例。关于分层比例风险模型的更多细节可以在 Kalbfleisch Prentice (2002) 以及 Lawless (2002) 中找到。Schemper (1992) 回顾了 Cox 回归模型中处理非比例风险的方法。Therneau Grambsch (2000) 的第 6 章还讨论了处理非比例风险的策略。Royston Parmar (2011) 描述并说明了如何使用限制性平均生存时间来总结存在非比例风险时的治疗差异。Schemper, Wakounig Heinze (2009) 讨论了平均风险比的使用。Andersen, Hansen Klein (2004) 展示了如何使用伪值对限制性平均进行建模，Andersen Perme (2010) 回顾了伪值在生存分析中的应用。Klein et al. (2008) 描述了用于计算限制性平均的 SAS 宏和 R 包。Thomas、Longford Rolph (1994) 以及 Goldstein Spiegelhalter (1996) 描述和说明了比较机构绩效的统计方法。Spiegelhalter et al. (2002) 对多家医院进行小儿心脏手术后的手术结果进行了详细比较。Sun, Ono Takeuchi（1996）展示了如何利用泊松分布与 gamma 分布或卡方分布之间的关系来获得标准化死亡率的精确泊松限。Spiegelhalter (2005) 描述的漏斗图提供了机构绩效的直观比较。Ohlssen, Sharples Spiegelhalter (2007) 描述了可用于识别与其他机构表现不同的机构的技术，Spiegelhalter et al. (2012) 对医疗保健监管中使用的统计方法进行了全面回顾。","code":""},{"path":"chap12.html","id":"chap12","chapter":"第 12 章 竞争风险","heading":"第 12 章 竞争风险","text":"在以死亡为结局的研究中，个体可能死于多种不同原因之一。例如，在比较两种或多种前列腺癌疗法的研究中，患者可能死于中风、心肌梗塞或癌症本身。在某些情况下，对所有原因造成的死亡进行分析可能是适当的，并且可以使用生存分析的标准方法。\n更常见的是，人们会对不同原因导致的死亡风险如何取决于治疗效应和其他解释变量感兴趣。当然，由其中任何一种原因导致的死亡都排除了由任何其他原因导致的死亡，这一特征对于此类数据的分析具有重要意义。\n在本章中，我们回顾了总结不同死因生存时间数据的方法，并描述了原因别 (cause-specific) 生存数据的模型。","code":""},{"path":"chap12.html","id":"sec12-1","chapter":"第 12 章 竞争风险","heading":"12.1 竞争风险的介绍","text":"个体面临着多种死亡的风险。这些风险竞相成为死亡的实际原因，这就产生了所谓的竞争风险 (competing risks) 的情况，在这种情况下，竞争风险阻碍了特别关注的事件的发生。更一般地说，当一个可能经历多个不同终点之一，若其中一个事件发生，则会阻碍或消除其他终点发生的可能性，这些情况适用“竞争风险”这一术语。此类数据出现在许多应用领域中。例如，在癌症临床试验中，我们可能对特定癌症导致的死亡感兴趣，而心肌梗塞或中风等事件是竞争风险。一项涉及动物暴露于可能致癌物质的研究可能会导致暴露的动物死于不同的癌症，考虑到相互竞争的死因，每种死因可能都是令人感兴趣的。在白血病患者骨髓移植后的结果的研究中，可能的终点可能是出院、复发、移植物抗宿主病或死亡的发生，所关注的是在存在其他风险的情况下，各种因素如何影响每种事件的发生时间。在有多个终点的情况下，数据分析可能有多个目标。例如，在存在竞争风险的情况下，确定哪些因素与特定终点相关可能很重要。考虑到可能的竞争原因，可能还需要估计这些因素对原因别死亡风险的影响。在其他情况下，比较不同死因的存活时间，以确定导致事件发生时间提前或推迟的原因是很有意义的。可能还需要对不同终点的某些因素的风险比估计的一致性进行评估。下面是一个具有多个终点的数据集示例。示例 12.1  (肝移植受体的生存) 许多情况会导致肝脏衰竭，唯一可能的治疗方法是肝移植。移植通常非常有效，成年移植受体的中位生存时间现在已经超过 12 年。然而，肝移植后，移植物可能因急性或慢性器官排异反应、肝动脉血栓形成、复发性疾病或其他原因而衰竭。本例基于 1761 名成年患者从肝移植到移植物衰竭的时间，这些患者在 2000 年 1 月至 2010 年 12 月期间首次对已故捐赠者的器官进行了选择性移植，并随访至 2012 年底。这些数据涉及三种特殊肝病的移植患者，即原发性胆汁性肝硬化 (PBC)、原发性硬化性胆管炎 (PSC) 和酒精性肝病 (ALD). 除了移植物生存时间外，还提供了患者的年龄和性别（1 = 男性，2 = 女性）、原发性肝病和移植物衰竭原因（0 = 正常工作的移植物，1 = 排异反应，2 = 血栓，3 = 复发性疾病，4 = 其他）的信息。由于移植非常成功，这些数据显示出严重的删失，只有 261 名（15%）患者经历了移植物衰竭，另有 211 人在移植物功能正常的情况下死亡。后者群体的失效时间在他们去世时删失。表 12.1 给出了数据集的前 20 个观测。","code":""},{"path":"chap12.html","id":"sec12-2","chapter":"第 12 章 竞争风险","heading":"12.2 总结竞争风险数据","text":"在标准生存分析中，我们观察与生存时间相关的随机变量 \\(T\\)。此外，还会有一个事件指示符，指示终点是否实际发生或观测时间是否已删失。当存在竞争风险时，事件指示符会扩展以涵盖不同的可能终点。因此，所得数据是生存时间 \\(T\\) 和原因 \\(C\\)。那么，给定个体的数据是 \\((T,C)\\) 的观测，我们将第 \\(\\) 个个体的数据记作 \\((t_i, c_i),= 1, 2,...,n\\)，其中 \\(c_i\\) 的可能值为 \\(0, 1, 2,...,m\\)，并且当未观察到终点时 \\(c_i = 0\\)。从数据中，我们知道个体 \\(\\) 在时间 \\(t_i\\) 之前，第 \\(j(j=1,2,\\ldots,m)\\) 个原因尚未发生。例如，某个特定原因，例如第 \\(j\\) 个，在时间 \\(t_i\\) 发生，如果第 \\(j\\) 个原因没有发生，那么所有其他潜在原因可能在时间 \\(t_i\\) 之后发生。由于我们不知道哪个原因可能在何时发生，估计原因别生存函数（即特定终点在任何时间 \\(t\\) 之后发生的概率）可能会遇到困难。","code":""},{"path":"chap12.html","id":"sec12-2-1","chapter":"第 12 章 竞争风险","heading":"12.2.1 生存函数的 Kaplan-Meier 估计","text":"为了总结竞争风险数据，我们可以考虑对每种原因使用单独的生存函数估计。这将涉及依次使用每个感兴趣原因的事件时间，将所有其他原因的事件次数视为删失。这是合理的，因为如果观察到特定的终点，在此之前就不可能发生其他死因。而如果没有发生这个特定的终点，其他原因可能会在以后发生。以这种形式表达的数据称为原因别生存数据。然而，使用生存函数的 Kaplan-Meier 估计来总结此类数据存在缺陷，如以下示例所示。示例 12.2  (肝移植受体的生存) 表 12.2 中给出了来自示例 12.1 使用的数据集中的 8 名患者的移植失败时间和失效原因的数据。\n用于构建患有移植排异和血栓形成的患者的生存函数的数据集如下，其中星号（*）表示删失观测。对于排异反应引起的失效，移植物生存时间为：\\[\\begin{aligned}18\\quad27^*\\quad63^*\\quad80\\quad143^*\\quad255^*\\quad294\\quad370\\end{aligned}\\]对于血栓引起的失效，移植物生存时间为：\\[\\begin{aligned}18^*\\quad27\\quad63\\quad80^*\\quad143\\quad255\\quad294^*\\quad370^*\\end{aligned}\\]生存函数的 Kaplan-Meier 估计可根据原因别生存时间计算，并得出表 12.3 所示的估计。\n根据该表中的生存函数估计，在 370 天期间因排异反应导致移植失败的概率为 1.000，因血栓导致移植失败的概率为 1 − 0.357 = 0.643. 然而，这 8 名患者中有一半在 370 天内因排异反应导致移植失败，另一半则因血栓形成而失效。因此，每种情况下 370 天时的生存函数应为 0.5。此外，在 370 天后不论是由于排异还是血栓形成导致移植失败的概率都应该是 0，因为那时所有 8 名患者均已失效，而不是 Kaplan-Meier 估计给出的 \\(1 − (1 + 0.643)\\)。这个简单的例子表明，当存在竞争风险时，Kaplan-Meier 估计并不能对生存数据进行适当的总结。那么 Kaplan-Meier 估计在估计什么呢？考虑对第 \\(j\\) 个原因的 Kaplan-Meier 估计，其中来自其他原因的事件时间视为删失。如果原因 \\(j\\) 是唯一的死亡原因，即所有其他风险均已消除，则 Kaplan-Meier 估计是在时间 \\(t\\) 后死亡的概率。因此，该估计没有适当考虑其他原因造成的竞争风险。此外，Kaplan-Meier 估计假定个体最终会因任何给定的原因死亡，因此没有考虑到某个特定死因可能永远不会发生的情况。一般来说，与示例 12.2 一样，Kaplan-Meier 估计的补集会高估某一特定事件的发生率，因此，在竞争风险的背景下，这一估计很少具有有意义的解释。","code":""},{"path":"chap12.html","id":"sec12-3","chapter":"第 12 章 竞争风险","heading":"12.3 风险和累积发生率函数","text":"本节介绍了在竞争风险背景下特别有用的两个函数，即不同事件类型的风险函数和累积发生率函数 (cumulative incidence function).","code":""},{"path":"chap12.html","id":"sec12-3-1","chapter":"第 12 章 竞争风险","heading":"12.3.1 原因别风险函数","text":"第 \\(j(j=1,2,\\ldots,m)\\) 个原因的原因别风险函数 (cause-specific hazard function) \\(h_j(t)\\) 定义为\\[\\begin{align}\nh_j(t)=\\lim_{\\delta t\\to0}\\left\\{\\frac{\\text{P}(t\\leqslant T\\leqslant t+\\delta t,C=j\\mid T\\geqslant t)}{\\delta t}\\right\\}\n\\tag{12.1}\n\\end{align}\\]该风险函数是在存在所有其他风险的情况下，第 \\(j\\) 个原因在时间 \\(t\\) 的瞬时失效率。根据式 (12.1) 中 \\(h_j(t)\\) 的定义，并遵循用于推导第 1 章式 (1.4) 的方法，我们得出\\[\\begin{aligned}\nh_{j}(t)& =\\lim_{\\delta t\\to0}\\left\\{\\frac{\\mathrm{P}(t\\leqslant T\\leqslant t+\\delta t,C=j)}{\\delta t\\mathrm{P}(T\\geqslant t)}\\right\\}  \\\\\n&=\\frac1{\\mathrm{P}(T\\geqslant t)}\\lim_{\\delta t\\to0}\\left\\{\\frac{\\mathrm{P}(t\\leqslant T\\leqslant t+\\delta t,C=j)}{\\delta t}\\right\\}\n\\end{aligned}\\]因此\\[\\begin{align}\nh_{{j}}(t)=\\frac{f_{{j}}(t)}{S(t)}\n\\tag{12.2}\n\\end{align}\\]其中 \\(f_j (t)\\) 是原因别密度函数，\\(S(t) = \\text{P}(T \\ge t)\\) 是总生存函数。由于 \\(m\\) 个可能的原因中只有一个会导致事件发生，则\\[\\begin{aligned}\\text{P}(t\\leqslant T\\leqslant t+\\delta t\\mid T\\geqslant t)&=\\sum_{j=1}^m\\text{P}(t\\leqslant T\\leqslant t+\\delta t,C=j\\mid T\\geqslant t)\\end{aligned}\\]然后，使用式 (12.1) 中原因别风险的定义，总风险函数为 \\(h(t)=\\sum_{j=1}^mh_j(t)\\)。类似地，总累积风险函数为 \\(H(t)=\\sum_{j=1}^mH_j(t)\\)，其中 \\(H_j(t)\\) 是第 \\(j\\) 个原因的累积风险函数。那么总生存函数为\\[\\begin{align}\nS(t)=\\exp\\left\\{-\\sum_{j=1}^mH_j(t)\\right\\}\n\\tag{12.3}\n\\end{align}\\]虽然 \\(S(t)\\) 也可以表达为\\[S(t)=\\prod_{j=1}^mS_j^\\dagger(t)\\]其中 \\(S_j^\\dagger(t)=\\exp\\{-H_j(t)\\}\\)，但 \\(S_j^\\dagger(t)\\) 不是一个可观测生存函数。这是因为当有不止一个可能的原因时，我们永远无法知道在时间 \\(t\\) 之后可能发生的死因。存在竞争风险的生存研究也可以用 \\(m\\) 个随机变量 \\(T_1,T_2,\\ldots,T_m\\) 来表示，这些变量与 \\(m\\) 个可能的失效原因的时间相关。这些随机变量无法直接观测，因为只有一个事件可以发生，因此它们称为潜随机变量 (latent random variables). 在实践中，我们观察到 \\(m\\) 个事件中最早发生的事件，并且与该事件时间相关的随机变量 \\(T\\) 满足 \\(T=\\min(T_1,T_2,\\ldots,T_m)\\)。如果不同的原因是独立的，则式 (12.2) 中的风险函数是与 \\(T_j\\) 相关的边际风险函数，其中 \\(T_j\\) 是第 \\(j\\) 个事件类型的随机变量，该边际风险为\\[\\lim_{\\delta t\\to0}\\left\\{\\frac{\\mathrm{P}(t\\leqslant T_j\\leqslant t+\\delta t\\mid T_j\\geqslant t)}{\\delta t}\\right\\}\\]不幸的是，与不同原因的时间相关的随机变量 \\((T_1,T_2,\\ldots,T_m)\\) 的联合分布不能唯一地确定，并且无法使用竞争风险数据来检验不同原因的独立性假设。因此，将不会进一步考虑这种竞争风险的表述。","code":""},{"path":"chap12.html","id":"sec12-3-2","chapter":"第 12 章 竞争风险","heading":"12.3.2 原因别累计发生率函数","text":"在竞争风险数据中，直到个体死于特定原因时才会出现死因。因此，特定原因的原因别累积发生率函数 (cause-specific cumulative incidence function) 是比生存函数更有用的数据总结。这是在存在所有其他风险的情况下，生存到时间 \\(t\\) 且死因为 \\(j(j=1,2,\\ldots,m)\\) 的概率，由下式给出\\[F_j(t)=\\mathrm{P}(T<t,C=j)\\]累积发生率函数的最大值为\\[\\begin{aligned}\\text{P}(T<\\infty,C=j)=\\text{P}(C=j)=\\pi_j\\end{aligned}\\]其中 \\(\\pi_j\\) 是原因 \\(j\\) 发生的最终概率。因此，当 \\(t\\rightarrow\\infty\\)时，\\(F_j(t)\\\\pi_j\\)，并且由于 \\(F_j(t)\\) 的极限不是 1，因此 \\(F_j(t)\\) 不是“适当”的概率分布函数。因此，累积发生率函数也称为子分布函数 (subdistribution function).根据式 (12.2)，\\(f_j(t)=h_j(t)S(t)\\)，那么 \\(F_j(t)\\) 可用如下形式表示\\[\\begin{align}\nF_j(t)&=\\int_0^th_j(u)S(u)\\mathrm{d}u\n\\tag{12.4}\n\\end{align}\\]式 (12.4) 表明原因别累积发生率函数可通过下式估计\\[\\begin{align}\n\\hat{F_j}(t)=\\sum_{:t_i\\leqslant t}\\frac{\\delta_{ij}}{n_i}\\hat{S}(t_{-1})\n\\tag{12.5}\n\\end{align}\\]其中 \\(\\hat{S}(t_{-1})\\) 是在 \\(t_{−1}\\) 处的总生存函数的 Kaplan-Meier 估计，忽略了不同原因。\\(n_i\\) 是在 \\(t_i\\) 之前存活且未删失的个体数，而 \\(\\delta_{ij}\\) 是特定原因的事件指示符。因此，如果原因 \\(j\\) 是第 \\(\\) 个个体的死因，则 \\(\\delta_{ij}\\) 为 1，否则为 0，并且式 (12.5) 中的比值 \\(\\delta_{ij}/n_i\\) 是第 \\(j\\) 个原因的风险函数的 Nelson-Aalen 估计；参见第 2 章的 2.3.3 节。式 (12.5) 中的求和运算是关于直到时间 \\(t\\) 的所有事件时间进行的，因此给定原因的累积发生率函数估计使用了所有原因的死亡时间信息。这意味着无法根据相应的原因别风险函数来估计原因别累积发生率函数。当只有一种事件类型，即 \\(m = 1\\) 时，我们有 \\(\\delta_{i1} \\equiv \\delta_i\\)，并使用第 2 章的式 (2.4)，我们发现 \\(\\hat{F}_1(t)=1-\\hat{S}(t)\\)，其中 \\(\\hat{S}(t)\\) 是生存函数通常的 Kaplan-Meier 估计。时间 t 处累积发生率函数估计的方差由下式给出\\[\\begin{aligned}\\text{var}\\left\\{\\hat{F_j}(t)\\right\\}=&\\,\\sum_{:t_i\\leqslant t}\\left\\{\\left[\\hat{F_j}(t)-\\hat{F_j}(t_i)\\right]^2\\frac{\\delta_i}{n_i(n_i-\\delta_i)}+\\hat{S}(t_{-1})^2\\frac{\\delta_{ij}(n_i-\\delta_{ij})}{n_i^3}\\right\\}\\\\&-2\\sum_{:t_i\\leqslant t}\\left\\{\\hat{F_j}(t)-\\hat{F_j}(t_i)\\right\\}\\hat{S}(t_{-1})\\frac{\\delta_{ij}}{n_i^2},\\end{aligned}\\]其中 \\(\\delta_i=\\sum_{j=1}^m\\delta_{ij}\\)，\\(n_i\\) 为在时间 \\(t_i\\) 处于风险的人数。累积发生率函数在任意时刻 \\(t\\) 的置信区间可用第 2 章 2.2.3 节描述的方法求出。当只有一种类型的事件时，\\(\\hat{S}(t_{-1})=n_i(n_i-\\delta_i)^{-1}\\hat{S}(t_i)\\)，并且上述方差的平方根可简化为 Kaplan-Meier 估计的标准误的 Greenwood 公式，如第 2 章的式 (2.12) 所示。使用 \\(\\hat{F}(t)=\\sum_{j=1}^m\\hat{F}_j(t)\\) 这一结果，总累积发生率 \\(F(t)\\) 也可根据 \\(m\\) 个原因别发生率函数估计。这反过来又得到了总生存函数的估计 \\(\\hat{S}(t)=1-\\hat{F}(t)\\)，其中在没有解释变量的情况下，\\(S(t)\\) 是通常的 Kaplan-Meier 估计，忽略了不同原因导致的死亡差异。示例 12.3  (肝移植受体的生存) 示例 12.2 表明，生存函数的 Kaplan-Meier 估计不能用于估计累积发生率，对于表 12.2 所示的数据，需要分别计算移植失败的两个原因（排异反应和血栓形成）的累积发生率函数， 示于表 12.4 中。\\(\\hat{S}(t_{-1})\\) 的值是根据所有事件时间的生存函数的 Kaplan-Meier 估计计算的。\n使用式 (12.5) 计算两个原因在 370 天处的累积发生率估计，均为 0.5，符合要求。此外，370 天处的总生存函数估计现在是 \\(\\hat{S}(370)=1-\\sum_{j=1}^m\\hat{F}_j(370)=1-(0.5+0.5)=0\\)，这也是正确的。示例 12.4  (肝移植受体的生存) 对于肝移植受体的生存时间数据，由于排异、肝动脉血栓形成、疾病复发或其他原因导致的移植失败的累积发生率函数估计如图 12.1 所示。该图显示，移植失败的四种原因之间的发生率函数有所不同，其中其他原因导致的移植失败在这些肝脏受体中的发生率最高。每种原因发生移植失败的最终概率估计是根据 12 年累积发生率函数估计得到的，其中排异、肝动脉血栓形成、复发性疾病和其他原因的该函数的近似估计分别为 0.025, 0.055, 0.060 和 0.102.\n累积发生率函数估计也可用于总结某些解释变量对特定终点的影响。如图 12.2 显示了具有三种移植指征（PBC， PSC 和 ALD）的移植受体的血栓形成的累积发生率。PBC 和 PSC 患者的血栓形成发生率非常相似，高于 ALD 患者。然而，需要更正式的分析来确定这些差异的显著性。累积发生率函数提供了竞争风险数据的描述性总结，但在存在竞争风险的情况下，可以通过类似于 log-rank 检验的方法来比较两个或更多组别，从而对其进行补充。这些检验方法包括 Gray 检验 (Gray, 1988) 以及 Pepe Mori (1993) 提出的方法。这里没有给出更多细节，因为可以通过建模方法获得分析竞争风险数据的替代程序，这在第 12.4 节和 12.5 节中描述。","code":""},{"path":"chap12.html","id":"sec12-3-3","chapter":"第 12 章 竞争风险","heading":"12.3.3 关注的其他函数","text":"原因别累积发生率函数 \\(F_j(t)\\) 可得到竞争风险情况下可能关注的某些其他量。例如，当死因为 \\(j\\) 时，\\(t\\) 之前的死亡概率为\\[\\mathrm{P}(T<t\\mid C=j)=\\pi_j^{-1}F_j(t)\\]其中 \\(\\pi_j\\) 是第 \\(j\\) 个原因发生的概率。此外，当死亡发生在时间 \\(t\\) 之前时，死于原因 \\(j\\) 的概率为\\[\\begin{aligned}\\text{P}(C=j\\mid T<t)=\\frac{F_j(t)}{F(t)}\\end{aligned}\\]其中 \\(F(t)=1-S(t)\\)，\\(S(t)\\) 为总生存函数。根据累积发生率函数估计可以很容易地获得这些概率的估计。","code":""},{"path":"chap12.html","id":"sec12-4","chapter":"第 12 章 竞争风险","heading":"12.4 原因别风险建模","text":"为了对原因别风险函数关于 \\(p\\) 个解释变量值的依赖性进行建模，我们记第 \\((=1,2,\\ldots,n)\\) 个个体来自原因 \\(j(j=1,2,\\ldots,m)\\) 的死亡风险为\\[h_{{}j}(t)=\\exp(\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_i)h_{0j}(t)\\]式中，\\(h_{0j}(t)\\) 是第 \\(j\\) 个原因的基线风险，\\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体解释变量的值向量，\\(\\boldsymbol \\beta_j\\) 是第 \\(j\\) 个原因解释变量的系数向量。根据在后文给出的结果，可以根据原因别生存数据为每种死因开发单独的模型，如示例 12.2 所示。为此，依次为每个原因生成一组生存数据，其中该原因导致的死亡是一个事件，所有其他原因的死亡时间视为删失。那么可以使用 Cox 回归模型或参数模型，以通常的方式基于风险比来推断每个解释变量对原因别风险函数的效应。在对原因别风险进行建模时，经历竞争风险的个体的事件时间是删失的，就好像未来有可能发生感兴趣的事件一样19。因此，风险比估计对应于其他死因被排除或假定不发生的情况。这可能会导致高估特定原因的风险。此外，原因别生存数据的模型也是基于通常的独立删失假设。如果竞争事件不是独立于感兴趣的事件而发生的，则该假设是无效的。不幸的是，独立竞争风险的假设不能用观测数据来检验。尽管存在这些缺点，但当关注点在于解释变量如何直接影响与特定死因相关的风险，而忽略其他原因造成的死亡时，这种方法可能是合理的。当只有一种事件类型时，生存函数以及累积发生率函数可以使用第 1 章的式 (1.7) 和 (1.6) 根据风险函数计算。解释变量值的变化对风险函数的影响可根据这种变化对累积发生率函数的影响来解释。然而，在存在竞争风险的情况下，任何原因的累积发生率函数取决于每个潜在死亡原因的发生风险，如式 (12.5) 所示。这意味着我们无法通过分析原因别生存数据来推断解释变量如何影响每种原因的累积发生率。为此，我们需要直接对 \\(F_j(t)\\) 进行建模，第 12.5 节描述并说明了一个特定的模型。","code":""},{"path":"chap12.html","id":"sec12-4-1","chapter":"第 12 章 竞争风险","heading":"12.4.1 竞争风险模型的似然函数","text":"本节表明，为 \\(m\\) 组原因别生存数据拟合单独的模型（如 Cox 回归模型或全参数模型），来对原因别风险函数对解释变量的依赖性进行建模。原因别风险函数的模型，其中每个原因的基线风险函数 \\(h_{0j} (t), j = 1, 2,...,m\\) 未指定时，是通过最大化偏似然函数来拟合的，就像在单一死因的情况一样。考虑第 \\((=1,2,\\ldots,n)\\) 个个体在第 \\(\\) 个有序死亡时间 \\(t_i\\) 死于原因 \\(j\\) 的概率，条件是在时间 \\(t_i\\) 处有死亡风险的个体之一死于原因 \\(j\\)。使用第 3 章 3.3.1 节描述的方法，该概率为\\[\\begin{align}\n\\frac{\\exp(\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_i)}{\\sum_{l\\R(t_i)}\\exp(\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_l)}\n\\tag{12.6}\n\\end{align}\\]其中 \\(R(t_i)\\) 为时间 \\(t_i\\) 的风险集，即，在 \\(t_i\\) 之前还存活且未删失的个体的集合。如果第 \\(\\) 个个体死于第 \\(j\\) 个原因，则令 \\(\\delta_{ij} = 1\\)，否则为 0. 则式 (12.6) 中的偏似然函数可以写为\\[\\prod_{j=1}^m\\left\\{\\frac{\\exp(\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_i)}{\\sum_{l\\R(t_i)}\\exp(\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_l)}\\right\\}^{\\delta_{ij}}\\]那么所有 \\(n\\) 个个体的偏似然函数是\\[\\prod\\limits_{=1}^n\\prod\\limits_{j=1}^m\\left\\{\\frac{\\exp(\\boldsymbol{\\beta'}_j\\boldsymbol{x}_i)}{\\sum\\limits_{l\\R(t_i)}\\exp(\\boldsymbol{\\beta'}_j\\boldsymbol{x}_l)}\\right\\}\\delta_{ij}\\]该函数可分解为形如下式的 \\(m\\) 项的乘积\\[\\prod_{=1}^n\\left\\{\\frac{\\exp(\\boldsymbol{\\beta'}_j\\boldsymbol{x}_i)}{\\sum_{l\\R(t_i)}\\exp(\\boldsymbol{\\beta'}_j\\boldsymbol{x}_l)}\\right\\}^{\\delta_{ij}}\\]这是第 \\(j\\) 个原因对应的原因别生存数据的偏似然函数。这意味着可以为原因别生存数据拟合 \\(m\\) 个单独的 Cox 回归模型，以确定解释变量如何影响每种原因的死亡风险。当 \\(h_{0j}(t)\\) 完全指定时，我们就得到了一个可使用标准最大似然法进行拟合的参数模型。同样，此时似然函数分解为原因别生存数据的似然之积。为了证明这一点，在 \\(t_i\\) 处死于原因 \\(c_i\\) 的个体对似然函数的贡献为 \\(f_{c_i}(t_i)\\)，其中 \\(c_i = 1, 2,...,m,=1,2,\\ldots,n\\). 删失生存时间（原因变量 \\(c_i=0\\)）不包含有关未来可能的死亡原因的信息，因此对似然函数的相应贡献是总生存函数 \\(S(t_i)\\)。暂时忽略协变量，\\(n\\) 个个体数据的似然函数为\\[\\begin{align}\nL=\\prod_{=1}^nf_{c_i}(t_i)^{\\delta_i}S(t_i)^{1-\\delta_i}\n\\tag{12.7}\n\\end{align}\\]其中，如果第 \\(\\) 个个体具有删失生存时间，则 \\(\\delta_i = 0\\)，否则为 1. 使用式 (12.2) 中的结果，并令 \\(h_{c_i} (t)\\) 表示经历原因 \\(c_i\\) 的第 \\(\\) 个个体的风险函数，有\\[\\begin{align}\nL=\\prod_{=1}^{n}\\{h_{c_{}}(t_{})\\}^{\\delta_{}}S(t_{})\n\\tag{12.8}\n\\end{align}\\]现在，根据式 (12.4)，\\(S(t_i)~=~\\prod_{j=1}^m\\exp\\{-H_j(t_i)\\}\\)，其中，第 \\(j\\) 个原因在时间 \\(t_i\\) 处的累积风险函数 \\(H_j(t_i)\\) 是根据相应的原因别风险函数 \\(h_j (t_i)\\) 获得的，即\\[\\begin{aligned}H_j(t_i)&=\\int_0^{t_i}h_j(u)\\mathrm{d}u\\end{aligned}\\]此外，若 \\(c_i = j(j=1,2,\\ldots,m)\\)，则令 \\(\\delta_{ij} = 1\\)，否则为 0，式 (12.8) 中似然可以仅用每个原因的风险函数来表示，即\\[\\begin{aligned}L&=\\prod_{=1}^n\\left(\\prod_{j=1}^mh_j(t_i)^{\\delta_{ij}}\\right)\\prod_{j=1}^m\\exp\\{-H_j(t_i)\\}\\end{aligned}\\]该式可写为\\[\\begin{align}\nL&=\\prod_{=1}^n\\prod_{j=1}^mh_j(t_i)^{\\delta_{ij}}\\exp\\{-H_j(t_i)\\}\n\\tag{12.9}\n\\end{align}\\]式 (12.9) 中的似然函数是如下形式的 \\(m\\) 项的乘积\\[\\begin{aligned}\\prod_{=1}^nh_j(t_i)^{\\delta_{ij}}\\exp\\{-H_j(t_i)\\}\\end{aligned}\\]将其与式 (12.8) 进行比较，我们发现这是当所有其他原因的事件时间都删失时，第 \\(j\\) 个原因的似然函数。因此，可以为原因别生存数据拟合单独的参数模型来估计原因别风险函数。例如，如果第 \\(j\\) 个原因的基线风险函数 \\(h_{0j} (t)\\) 取为 Weibull 形式，则 \\(h_{0j}(t)=\\lambda_j\\gamma_jt^{\\gamma_j-1}\\)，则该基线风险函数中的参数 \\(\\lambda_j\\) 和 \\(\\gamma_j\\)，连同模型解释变量的系数，可以通过为原因别生存时间拟合单独的 Weibull 模型来获得。然后可以使用标准方法来推断解释变量对每种原因的死亡风险的影响。示例 12.5  (肝移植受体的生存) 为了说明对原因别风险的建模，与为肝移植受体移植失败时间的原因别数据拟合单独的 Cox 回归模型。拟合的模型包含与患者年龄（线性项）、性别和原发疾病相关的变量。相应的风险比及其 95% 置信限如表 12.5 所示。\n该表中的风险比可以解释为每个变量对移植失败的四种可能原因其一的影响，而不考虑其他三种原因的发生。例如，排异反应的风险比适用于假定的情况：患者只能因排异反应而导致移植失败。根据这项分析，老年患者发生排异反应和血栓形成的风险较小，但随着患者年龄的增长，其他原因导致的移植物衰竭的风险增加。没有证据表明移植失败的风险受性别的影响。与 PSC 和 ALD 患者相比，PBC 患者因复发性疾病导致移植失败的风险较低，而且有迹象表明 PBC 患者因血栓形成而导致移植失败的发生率较高。","code":""},{"path":"chap12.html","id":"sec12-4-2","chapter":"第 12 章 竞争风险","heading":"12.4.2 累积发生率函数的参数模型","text":"在 12.4.1 节中，我们了解了如何通过对原因别生存数据进行建模来拟合第 \\(j\\) 个原因的风险函数 \\(h_j (t),j = 1, 2,...,m\\) 的标准参数模型。然而，如果第 \\(j\\) 个原因的风险函数具有 Weibull 形式，则根据式 (12.2)，相应的密度函数 \\(f_j (t)\\) 和累积发生率函数 \\(F_j (t)\\) 不是 Weibull 分布生存时间的相应形式。事实上，由于累积发生率函数不是适当的分布函数，我们无法使用标准概率分布对此进行建模，我们需要考虑到特定原因的最终概率 \\(F_j (\\infty)<1\\) 这一事实。举一个最简单的例子，假定生存时间是指数分布，对于原因 \\(j=1,2,\\ldots,m\\) 其均值为 \\(\\theta_j^{-1}\\)。那么，以原因 \\(j\\) 为条件，\\[\\begin{aligned}\\mathrm{P}(T<t\\mid C=j)=1-e^{-\\theta_jt}\\end{aligned}\\]因此原因 \\(j\\) 的累积发生率为\\[\\begin{aligned}F_j(t)=\\mathrm{P}(T<t\\mid C=j)P(C=j)=\\pi_j(1-e^{-\\theta_jt})\\end{aligned}\\]其中 \\(\\pi_j\\) 是死于 \\(j\\) 的概率。当 \\(t\\rightarrow \\infty\\)，该累计发生率函数趋于 \\(\\pi_j\\)，符合要求。相应的密度函数为 \\(f_j (t) = \\pi_j \\theta_j e^{−\\theta_j t}\\)，利用式 (12.2) 中的结果，并取 \\(S(t)=\\prod_{j=1}^{m}\\{1{-}F_j(t)\\}\\)，相应的原因别风险变为\\[\\begin{aligned}\\lambda_j(t)&=\\frac{\\pi_j\\theta_je^{-\\theta_jt}}{\\prod_j\\{1-\\pi_j(1-e^{-\\theta_jt})\\}}\\end{aligned}\\]即使条件发生率函数具有指数形式，该原因别风险函数也不是常数。当对第 \\(j\\) 个原因的累积发生率 \\(F_j(t)\\) 采用参数模型时，可以通过最大化式 (12.7) 中的似然函数来拟合模型，其中 \\(n\\) 个观测 \\((t_i,c_i)\\) 的似然函数为\\[\\prod_{=1}^nf_{c_i}(t_i)^{\\delta_i}S(t_i)^{1-\\delta_i}\\]其中，对于删失观测，\\(\\delta_i=0\\)，否则为 1。在该表达式中，如果第 \\(\\) 个个体经历第 \\(j\\) 个事件类型，则 \\(c_i=j\\)，并且 \\(S(t_i)\\) 是根据 \\(S(t_i)=\\prod_{j=1}^m\\{1-F_j(t_i)\\}\\) 计算的 \\(t_i\\) 处的生存函数。即使在指数原因别生存时间的情况下，相应的似然函数也具有复杂的形式，并且需要数值方法来确定使其最大化的未知参数的估计。因此，累积发生率的参数模型在实践中很少使用。","code":""},{"path":"chap12.html","id":"sec12-5","chapter":"第 12 章 竞争风险","heading":"12.5 原因别发生率建模","text":"在标准生存分析中，只有一个可能的终点，累积发生率、生存和风险函数之间存在直接的对应关系，并且生存函数的模型可直接根据风险函数的模型获得。如 12.4 节所述，当存在竞争风险时，情况并非如此。尽管原因别风险模型可用于确定解释变量对竞争风险的影响，但需要采用不同的方法来对它们如何影响累积发生率函数进行建模。在本节中，描述了原因别累积发生率函数对解释变量的依赖性的模型。该模型由 Fine Gray (1999) 提出，称为 Fine Gray 模型。","code":""},{"path":"chap12.html","id":"sec12-5-1","chapter":"第 12 章 竞争风险","heading":"12.5.1 Fine and Gray 竞争风险模型","text":"第 \\(j\\) 个原因的原因别累积发生率函数或子分布函数为 \\(F_j(t)=\\text{P }(T~<~t,C~=~j)\\)。使用第 1 章式 (1.5) 中首先给出的关系，对于第 \\(j\\) 个原因，子分布的相应风险函数，称为子分布风险函数或子风险 (subdistribution hazard function subhazard)，为\\[\\begin{align}\n\\lambda_j(t)&=-\\frac{\\mathrm{d}}{\\mathrm{d}t}\\log\\{1-F_j(t)\\}=\\frac{1}{1-F_j(t)}\\frac{\\mathrm{d}F_j(t)}{\\mathrm{d}t}\n\\tag{12.10}\n\\end{align}\\]现在，\\(1 − F_j (t)\\) 是一个个体在时间 \\(t\\) 后生存的概率，或者在此之前死于第 \\(j\\) 个原因以外的原因的概率，如第 1 章 1.3 节所述，有\\[\\frac{\\mathrm{d}F_j(t)}{\\mathrm{d}t}=\\lim_{\\delta t\\to0}\\left\\{\\frac{F_j(t+\\delta t)-F_j(t)}{\\delta t}\\right\\}\\]那么子分布风险函数 \\(\\lambda_j(t)\\) 可表示为\\[\\lambda_j(t)=\\lim_{\\delta t\\to0}\\left\\{\\frac{\\text{P}(t\\leqslant T\\leqslant t+\\delta t,C=j\\mid T\\geqslant t\\text{ }\\{T\\leqslant t\\text{ }C\\neq j\\})}{\\delta t}\\right\\}\\]这是在时间 \\(t\\) 原因 \\(j\\) 的瞬时死亡率，给定在此之前未死于原因 \\(j\\)。由于该风险函数的定义包括了那些在时间 \\(t\\) 之前已经死于 \\(j\\) 以外的原因的个体，所以该子分布风险函数在定义和解释上都不同于式 (12.1) 中的原因别风险。为了对原因别累积发生率函数进行建模，假定第 \\(j\\) 个原因的子风险函数采用 Cox 回归模型。第 个个体（共 \\(n\\) 个）在时间 \\(t\\) 时原因 \\(j\\) 的风险为\\[\\begin{align}\n\\lambda_{ij}(t)=\\exp(\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_i)\\lambda_{0j}(t)\n\\tag{12.11}\n\\end{align}\\]其中 \\(\\lambda_{0j} (t)\\) 是原因 \\(j\\) 的基线子分布风险函数，\\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体 \\(p\\) 个解释变量的值向量，向量 \\(\\boldsymbol \\beta_j\\) 包含第 \\(j\\) 个原因的系数。在该模型中，假定子分布风险函数是成比例的。式 (12.11) 中的模型是通过改编第 3 章式 (3.4) 中通常的偏似然来拟合的，以纳入风险集中的值的加权组合。所得第 \\(j\\) 个原因的偏似然函数为\\[\\begin{align}\n\\prod_{h=1}^{r_j}\\frac{\\exp(\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_h)}{\\sum_{l\\R(t_{(h)})}w_{hl}\\exp(\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_l)}\n\\tag{12.12}\n\\end{align}\\]其中乘积运算是关于死于原因 \\(j\\) 的\\(r_j\\) 个个体来进行的，其对应的死亡时间为 \\(t_{(1)}<t_{(1)}\\ldots<t_{(r_j)}\\)，\\(\\boldsymbol x_h\\) 是在时间 \\(t_{(h)},h=1,2,\\ldots,r_j\\) 死于原因 \\(j\\) 的个体的解释变量的值向量。所有在第 \\(h\\) 个事件时间 \\(t_{(h)}\\) 之前未经历过事件、生存时间大于等于 \\(t_{(h)}\\) 的个体，以及那些在 \\(t_{(h)}\\) 之前经历过竞争风险，生存时间小于等于 \\(t_{(h)}\\) 的个体，构成了风险集 \\(R(t_{(h)})\\)。该风险集并不容易解释，因为在时间 \\(t\\) 之前死于除第 \\(j\\) 个原因以外的原因的个体在 \\(t\\) 时不再面临风险，尽管如此，他们确实出现在该模型的风险集中。式 (12.12) 中的权重定义为\\[\\begin{aligned}w_{hl}&=\\frac{\\hat{S}_c(t_{(h)})}{\\hat{S}_c(\\min\\{t_{(h)},t_l\\})}\\end{aligned}\\]其中 \\(\\hat{S}_c(t)\\) 是删失时间的生存函数的 Kaplan-Meier 估计。这是通过将数据集中的所有事件时间（无论何种类型）视为删失时间，同样地，将所有删失时间视为事件时间，根据这样的数据计算的 Kaplan-Meier 估计。当 \\(t_l\\geqslant t_{(h)}\\) 时，即对于处于 \\(t_{(h)}\\) 的风险集中、在此之前未发生事件的那些个体，权重 \\(w_{hl}\\) 将为 1.0，否则小于 1.0. 该加权函数的作用是，死于第 \\(j\\) 个原因以外的原因的个体仍在风险集中，并赋予其一个超过所有事件时间的删失时间。此外，随着竞争事件与关注事件之间的时间的增加，权重变得更小，因此竞争风险导致的早期死亡对结果的影响会逐渐减小20。最大化式 (12.12) 中的偏似然被以获得给定原因的 \\(\\beta\\) 参数的估计。由于此偏似然中使用的权重可能会因特定个体生存时间而异，因此必须首先将数据整理为计数过程格式，第 8 章 8.3 节对其进行了概述。这也使得能直接地在此模型中包含时依变量。子分布风险函数很难解释，拟合的模型最好根据解释变量对第 \\(j\\) 个原因的原因别累积发生率函数的效应进行解释，根据式 (12.10)，第 \\(\\) 个个体的累计发生率函数可以通过下式进行估计\\[\\hat{F}_{ij}(t)=1-\\exp\\{-\\hat{\\Lambda}_{ij}(t)\\}\\]其中 \\(\\hat\\Lambda_{ij} (t)\\) 是累积子分布风险函数 \\(\\Lambda_{ij} (t)\\) 的估计。该估计由下式给出\\[\\hat{\\Lambda}_{ij}(t)=\\exp(\\hat{\\boldsymbol{\\beta}}'_j\\boldsymbol{x}_i)\\hat{\\Lambda}_{0j}(t)\\]其中 \\(\\hat{{\\Lambda}}_{0{j}}(t)\\) 是第 \\(j\\) 个事件类型的基线累积子分布风险函数。该函数可以使用基线累积风险函数的 Nelson-Aalen 估计（第 3 章式 (3.29)）的改编来估计，即\\[\\hat{\\Lambda}_{0j}(t)=\\sum_{t_{(h)}\\leqslant t}\\frac{d_h}{\\sum_{l\\R(t_{(h)})}w_{hl}\\exp(\\hat{\\boldsymbol{\\beta}_j^{\\prime}}\\boldsymbol{x}_l)}\\]其中 \\(d_h\\) 是时间 \\(t_{(h)}\\) 时的死亡人数。Fine Gray 模型还可以用每个原因的基线累积发生率函数 \\(F_{ij} (t)\\) 来表示，其中\\[F_{ij}(t)=1-\\{1-F_{0j}(t)\\}^{\\exp(\\boldsymbol{\\beta}'_j\\boldsymbol{x}_i)}\\]\\(F_{0j}(t)=1-\\exp\\{-\\Lambda_{0j}(t)\\}\\) 是第 \\(j\\) 个原因的基线累积发生率函数。这强调了正在对感兴趣的量进行建模。示例 12.6  (肝移植受体的生存) 在本示例中，利用累积关联函数的 Fine Gray 模型用于对示例 12.1 给出的数据进行建模。对移植排斥反应、血栓形成、复发性疾病和其他失效原因依次拟合累积发生率模型。这四种失效类型的子风险比 (subhazard ratio) 及其相应的 95% 置信区间如表 12.6 所示。\n该表中的子风险比总结了在存在竞争风险的情况下每个变量对移植失败的不同原因的发生率的直接效应。然而，它们的值与表 12.5 中显示的风险比非常相似，这表明移植失败的竞争原因之间几乎没有关联。但在后面的示例（12.6 节中的示例 12.7）中，情况并非如此。","code":""},{"path":"chap12.html","id":"sec12-6","chapter":"第 12 章 竞争风险","heading":"12.6 模型检查","text":"第 4 章描述的许多模型检查程序可直接用于检查原因别模型的充分性。检查解释变量的函数形式（鞅和 Schoenfeld 残差图）和比例风险检验（缩放 Schoenfeld 残差图、比例风险检验）的方法特别有用21。此外，第 7 章 7.3 节描述将观测生存与基于模型的估计进行比较的方法，改编后可用于确定对每个原因的累积发生率假定的参数模型的有效性。示例 12.7 说明了其中一些方法。示例 12.7  (实验小鼠的生存) 在一项实验研究中，为了比较两组小鼠暴露在辐射后的生存时间，一组在标准环境中饲养，另一组在无菌环境中饲养。这些小鼠均为 RFM 品系雄性，这是一种特别容易受到电离辐射后发展出肿瘤的品系。小鼠在 5 到 6 周大时接受 300 rad 剂量的辐射，并追踪每只小鼠直至其死亡。经尸检后，每只小鼠的死因记录为胸腺淋巴瘤 (Thymic lymphoma)、网状细胞肉瘤 (Reticulum cell sarcoma) 或其他原因，以及相应的生存天数。这些数据首先由 Hoel (1972) 描述，并列于表 12.7. 这些数据的特点是没有删失生存时间。\n这三种原因的累积发生率函数估计如图 12.3 所示。该图表明，在无菌环境中饲养的小鼠胸腺淋巴瘤的发生率更高，但在标准环境中饲养的小鼠网状细胞肉瘤的发生率更高。其他原因导致的死亡发生率在两种环境中也有所不同。接下来，我们为原因别生存时间拟合 Cox 回归模型。对于在第 \\((=1,2)\\) 个环境中饲养的小鼠，第 \\(j(j=1,2,3)\\) 个原因别风险的模型为\\[\\begin{aligned}h_{ij}(t)=\\exp(\\beta_jx_i)h_{0j}(t)\\end{aligned}\\]其中，对于在无菌环境中饲养的小鼠，\\(x_i=1\\)，否则为 0，因此 \\(\\beta_j\\) 是相对于标准环境，在无菌环境下饲养的小鼠在任何时间因 \\(j\\) 原因死亡的对数风险比。表 12.8 显示了每种死因的风险比估计、相应的 95% 置信限以及用于检验风险比为 1.0 的假设的 \\(P\\) 值。\n该表显示，胸腺淋巴瘤的死亡风险未受到小鼠饲养环境显著的影响，但在无菌环境中饲养的小鼠死于网状细胞肉瘤或其他原因的风险显著较低。该分析表明，在其他两种可能的死因无法发生的情况下，饲养小鼠的环境类型如何影响三种死因的发生。由于任何特定死因的累积发生率取决于所有可能原因的风险，因此我们无法通过对原因别风险进行建模来得出有关环境对原因别发生率函数的影响的任何结论。为此，我们针对胸腺淋巴瘤、网状细胞肉瘤和其他原因的累积发生率拟合了 Fine Gray 模型。在存在竞争风险的情况下，这使得能够对环境对三种死亡原因的效应进行建模。根据式 (12.11)，在第 \\(\\) 个环境中饲养的、因第 \\(j\\) 个原因而亡的小鼠的子风险函数模型为\\[\\begin{align}\n\\lambda_{ij}(t)=\\exp(\\beta_jx_i)\\lambda_{0j}(t)\n\\tag{12.13}\n\\end{align}\\]因原因 \\(j\\) 而亡的累积发生率的相应模型为\\[F_{{}j}(t)=1-\\operatorname{exp}\\{-e^{\\boldsymbol{\\beta}_{j}x_{}}\\Lambda_{0{j}}(t)\\}\\]其中 \\(\\Lambda_{0j} (t)\\) 是基线累积子风险函数，对于无菌环境，\\(x_i = 1\\)，否则为 0. 表 12.9 给出了在无菌环境中饲养的小鼠相对于在标准环境中饲养的小鼠的子风险函数的估计之比、\\(P\\) 值和 95% 置信限。\n该表表明，在存在竞争的死亡风险的情况下，环境对胸腺淋巴瘤死亡的子风险有一定影响，对网状细胞癌死亡有非常显著的影响，但对其他原因造成的死亡没有影响。无菌环境增加了胸腺淋巴瘤的子风险，并降低了网状细胞肉瘤的子风险。乍一看，与表 12.8 中的风险比相比，表 12.9 中的子风险比显得十分惊人。尽管这一特征可能是由于竞争风险对胸腺淋巴瘤或其他原因死亡发生率的影响，但累积发生率函数的估计提出了另一种解释，如图 12.3 所示。对于其他原因造成的死亡，在事件相对较少的情况下，标准环境中的死亡发生率超过无菌环境中的死亡率。在事件较多的后期，发生率函数更接近，超过 80022 天后，无菌环境中的死亡发生率更高。因此，Fine Gray 模型中的子风险函数成比例的假设是可疑的。\n使用第 4 章 4.4 节中描述的技术来进一步探究这一点。\n首先，我们得到了每个原因的子风险函数模型的缩放 Schoenfeld 残差图，并叠加了一条平滑曲线。其他原因造成的死亡的图形如图 12.4 所示，该图清晰地表明，平滑曲线不是水平的，并强烈表明环境效应是时依的。\n为进一步检验比例子风险的假设，将时依变量 \\(x_i \\log t\\) 以及与原因相关的系数 \\(\\beta_{j1}\\) 纳入式 (12.13) 的模型中。将此项添加到子风险模型中后，\\(-2\\operatorname{log}\\hat{L}\\) 值的变化对于胸腺淋巴瘤死亡不显著（\\(P = 0.16\\)），但对于网状细胞肉瘤是显著的（\\(P = 0.016\\)），对于其他原因的死亡非常显著（\\(P < 0.001\\)）。这表明环境对网状细胞肉瘤和其他原因导致的死亡的子风险的效应并不独立于时间。以其他原因导致的死亡（其中 \\(j = 3\\)）来说明这一点，图 12.5 显示了时依子风险比 \\(\\exp\\{\\beta_3+\\beta_{31}\\log t\\}\\) 关于 \\(\\log t\\) 绘制的图形，并附有 95% 置信带。对于生存时间小于 240 天的风险比显著小于 1.0，对于生存时间大于 650 天的风险比显著大于 1.0.\n这些数据的另一个特点是，在标准环境中饲养的小鼠中，有四只小鼠因其他原因死亡的时间异常短，但这些观测对结果几乎没有影响。","code":""},{"path":"chap12.html","id":"sec12-7","chapter":"第 12 章 竞争风险","heading":"12.7 延伸阅读","text":"最早发表的有关竞争风险的文章是 David Moeschberger (1978) 的文章，其中包括自 17 世纪以来该领域工作的总结。最新的是 Moeschberger Klein (1995) 的论文，以及 Pintilie (2006), Crowder (2012) 和 Beyersmann, Allignol Schumacher (2012) 的文本。它们都展示了如何使用 R 软件进行分析。Crowder (2001) 对该领域给出了更数学化的解释。包含竞争风险章节的生存分析书籍包括 Kalbfleisch Prentice (2002), Lawless (2002) 以及 Kleinbaum Klein (2012). 也有关于竞争风险的教程论文，例如 Putter, Fiocco Geskus (2007) 以及 Pintilie (2007a) 的论文。该领域的术语命名极不一致；参见 Wolbers Koller (2007) 以及 Latouche, Beyersmann Fine (2007) 对 Pintilie (2007a) 中所采用命名规则的评论，以及 Pintilie (2007b) 的回应。Wolbers et al. (2009) 举例说明了在预测建模中使用竞争风险模型，而 Tai et al. (2001) 则对四种不同方法进行了比较。累积发生率函数估计的方差表达式由 Aalen (1978a), Marubini Valsecchi (1995) 以及 Lin (1997) 等人导出。Gray (1988) 和 Pepe Mori (1993) 描述了各种模型，并提出了在存在竞争风险的情况下比较两组或多组生存时间的累积发生率函数的检验。Kalbfleish Prentice (2002) 以及 Maller Zhu (2002) 描述了原因别风险参数模型，而 Hinchcliffe Lambert (2013) 描述并说明了竞争风险数据的灵活参数模型。Fine Gray (1999) 引入了竞争风险的 Fine Gray 模型。许多论文提出了 Fine Gray 模型的扩展，包括 Sun et al. (2006) 的加性模型，以及 Jeong Fine (2007) 的参数模型。","code":""},{"path":"chap13.html","id":"chap13","chapter":"第 13 章 多次事件和事件史分析","heading":"第 13 章 多次事件和事件史分析","text":"随着时间的推移，观测个体可能会经历多个相同类型的事件，或多个不同类型的事件。经常会遇到重复发生相同类型事件的研究，称为多次事件，如头痛或哮喘发作，并且需要对此类事件发生率关于个体特征或暴露因素的依赖性进行建模的技术。当一个个体可能经历多种不同类型的结局时，也会出现多种事件 (multiple event) 数据，我们关注影响每个结局的时间的因素。如果一个事件的发生排除了所有其他事件的发生，这是我们在第 12 章中考虑的竞争风险的情况，但在本章中，我们考虑的情况不一定是这种情况。\n对于 “multiple event” 的翻译，当单一事件反复发生时，译者将其译作“多次事件”，而对于可能有多种事件发生的情况，则译作“多种事件”。这一区别在后文的复发事件模型 (AG, PWP) 与多种事件模型 (WLW) 可以看到。译者不将其译作“多重事件”的原因在于，“多重”有“同时”之意，例如“多重比较”=同时进行多种比较。但很显然，复发事件不可能同时发生。在对疾病过程进行建模时，个体可能会经历与疾病特定阶段 (stages) 相对应的多个阶段 (phases) 或状态 (states). 例如，被诊断为慢性肾病的患者在接受肾移植之前可能会进行透析，移植后可能会出现慢性排异反应或移植物衰竭的阶段。患者可能在确诊后的随访期间经历部分或全部这些事件，并且事件的顺序称为事件史 (event history). 多状态模型 (multistate models) 可用于描述患者在各种状态之间的转移，并研究解释变量对患者从一种状态转移到另一种状态的速率的效应。多次事件和事件史数据可以使用扩展的 Cox 回归模型进行分析，该模型适用于可能发生多次事件的情况，该扩展涉及到为随时间推移而发生的事件开发概率模型，称为计数过程 (counting process)，因此本章首先介绍计数过程。","code":""},{"path":"chap13.html","id":"sec13-1","chapter":"第 13 章 多次事件和事件史分析","heading":"13.1 计数过程的介绍","text":"第 \\(\\) 个个体的计数过程定义为随机变量 \\(N_i(t),t\\geqslant0\\) 的值序列，其中 \\(=1,2,\\ldots,n\\)，其对时间段 \\((0,t]\\) 内某事件的发生次数进行计数。那么，计数过程 \\(N_i(t)\\) 的一个实现 (realisation) 是从 0 开始并以一个单位的步长递增的阶跃函数。接下来，我们将 \\(Y_i(t), t \\geqslant 0\\) 定义为一个过程，其中，当第 \\(\\) 个个体面临在时间 \\(t\\) 发生事件的风险时，\\(Y_i(t) = 1\\)，否则为 0，因此 \\(Y_i(t)\\) 有时称为风险过程 (-risk process). \\(Y_i(t)\\) 的值必须在时间 \\(t−\\)（紧接在 \\(t\\) 之前的时间）处已知，在这种情况下，\\(Y_i(t)\\) 称为可预测过程 (predictable process).与计数过程 \\(N_i(t)\\) 相关的概念为强度 (intensity)，即事件发生的速率。正式地说，计数过程 \\(N_i(t)\\) 的强度是在单位时间内增加一步的概率，以直到时间 \\(t\\) 的过程历史为条件。直到但不包括时间 \\(t\\) 的过程的历史或滤子 (filtration) 记作 \\(\\mathcal H(t−)\\)，并由直到时间 \\(t\\) 所有 \\(s\\) 值的值集 \\(\\{N_i(s),Y_i(s)\\}\\) 确定。强度过程用 \\(\\lambda_i(t),t\\geqslant0\\) 表示。那么，以无穷小量来表示\\[\\begin{aligned}\n\\lambda_i(t)& \\begin{aligned}=\\frac1{\\text{d}t}\\text{P}\\{N_i(t)\\text{在长度为 d}t\\text{ 的区间中增加一步}\\mid\\mathcal{H}(t-)\\},\\end{aligned}  \\\\\n&=\\left.\\frac1{\\mathrm{d}t}\\mathrm{P}\\{N_i(t+\\mathrm{d}t)-N_i(t)=1\\mid\\mathcal{H}(t-)\\}.\\right.\n\\end{aligned}\\]其中 \\(\\text{d}t\\) 是无穷小的时间区间。如果我们令 \\(\\text dN_i(t) = N_i(t +\\text dt) − N_i(t)\\) 表示 \\(N_i(t)\\) 在长度为 \\(\\text dt\\) 的无穷小的时间区间内的变化，则 \\(\\lambda_i(t)\\) 可表示为\\[\\begin{align}\n\\lambda_i(t)=\\frac{1}{\\mathrm{d}t}\\text{P}\\{\\text{d}N_i(t)=1\\mid\\mathcal{H}(t-)\\}\n\\tag{13.1}\n\\end{align}\\]由于 \\(\\text dN_i(t)\\) 为 0 或 1，因此得出\\[\\begin{aligned}\\lambda_i(t)&=\\frac{1}{\\text{d}t}\\operatorname{E}\\left\\{\\text{d}N_i(t)\\mid\\mathcal{H}(t-)\\right\\}\\end{aligned}\\]因此，计数过程的强度是单位时间内的预期事件数，以过程的历史为条件。我们还可定义累积强度或积分强度 (cumulative intensity integrated intensity)\\[\\begin{aligned}\\Lambda_i(t)&=\\int_0^t\\lambda_i(u)\\mathrm{d}u\\end{aligned}\\]表示时间区间 \\((0, t]\\) 内事件的累积预期数，即 \\(\\Lambda_i(t) =\\mathrm{E}\\left\\{N_i(t)\\right\\}\\)。","code":""},{"path":"chap13.html","id":"sec13-1-1","chapter":"第 13 章 多次事件和事件史分析","heading":"13.1.1 强度函数建模","text":"第 \\(\\) 个个体强度函数的一个简易且通用模型是，它取决于可观测、可预测的随机过程 \\(Y_i(t)\\)、时间以及 \\(p\\) 个可能为时依的解释变量 \\(X_1(t),X_2(t),\\ldots,X_p(t)\\) 的时间和已知值的未知函数。那么，计数过程 \\(N_i(t)\\) 的强度为\\[\\begin{aligned}\\lambda_i(t)=Y_i(t)g\\{t,\\boldsymbol{x}_i(t)\\}\\end{aligned}\\]其中 \\(\\boldsymbol x_i(t)\\) 是第 \\(\\) 个个体在时间 \\(t\\) 处 \\(p\\) 个解释变量的值向量。令 \\(g\\{t,\\boldsymbol{x}_i(t)\\}=\\exp\\{\\boldsymbol{\\beta'x}_i(t)\\}\\lambda_0(t)\\)，我们有\\[\\lambda_i(t)=Y_i(t)\\exp\\{\\boldsymbol{\\beta'x}_i(t)\\}\\lambda_0(t)\\]其中 \\(\\lambda_0(t)\\) 是仅取决于 \\(t\\) 的基线强度函数。第 3 章 3.3.1 节用于推导生存时间样本的偏似然的方法，可以改写，以获取计数过程的实现的数据的似然。此处省略了具体细节，但在计数过程表示法中，偏似然的形式为\\[\\begin{align}\n\\prod_{=1}^n\\prod_{\\begin{array}{c}t\\geqslant0\\\\\\end{array}}\\left\\{\\frac{Y_i(t)\\exp\\{\\boldsymbol{\\beta'x}_i(t)\\}}{\\sum_{l=1}^nY_l(t)\\exp\\{\\boldsymbol{\\beta'x}_l(t)\\}}\\right\\}^{\\text{d}N_i(t)}\n\\tag{13.2}\n\\end{align}\\]其中，若 \\(N_i(t)\\) 在时间 \\(t\\) 增加一个单位，则 \\({\\text{d}N_i(t)}=1\\)，否则为 0. 那么，将该函数关于强度函数中的未知参数最大化，从而得出 \\(\\beta\\) 的估计。在计数过程研究中已发展出了大量的理论，这使得可以确定参数估计的渐近性质。该理论基于一种称为鞅 (martingale) 的零均值随机过程的性质。事实上，该过程定义为\\[\\begin{align}\nM_i(t)=N_i(t)-\\Lambda_i(t)\n\\tag{13.3}\n\\end{align}\\]使得对于所有的 \\(t\\) 有 \\(\\operatorname{E}\\left\\{M_i(t)\\right\\}=0\\)，并且是一个鞅。这里不会给出理论细节，但请注意，式 (13.3) 是第 4 章式 (4.6) 中定义的鞅残差的基础。","code":""},{"path":"chap13.html","id":"sec13-1-2","chapter":"第 13 章 多次事件和事件史分析","heading":"13.1.2 作为计数过程的生存数据","text":"具有右删失生存时间的生存数据由时间 \\(t_i(=1,2,\\ldots,n)\\) 和事件指示符 \\(\\delta_i\\) 形成的对组成，是计数过程的一个特例。为了证明这一点，请考虑一个计数过程，其中当第 \\(\\) 个个体面临事件发生的风险时 \\(N_i(t) = 0\\)，并且当事件发生时 \\(N_i(t)\\) 阶跃为 1. 由于个体在时间起点处于风险中，则 \\(N_i(0) = 0\\)，因此过程 \\(N_i(t)\\) 从 0 开始，并在第 \\(\\) 个个体的事件时间增加到 1，但对于那些具有删失生存时间的个体保持为 0. 风险过程的值 \\(Y_i(t)\\) 在事件发生或时间删失之前保持 1，此后为 0.根据式 (13.1)，计数过程的强度满足\\[\\begin{aligned}\n\\lambda_i(t)\\mathrm{d}t& \\begin{aligned}=\\text{ P}\\{\\text{d}N_i(t)=1\\mid\\mathcal{H}(t-)\\}\\end{aligned}  \\\\\n&=\\text{P}\\{t\\leqslant T_i\\leqslant t+\\text{d}t\\mid\\mathcal{H}(t-)\\}\n\\end{aligned}\\]其中 \\(T_i\\) 是与第 \\(\\) 个个体的事件发生时间相关的随机变量。强度函数可以表示为\\[\\begin{align}\n\\lambda_i(t)\\mathrm{d}t=Y_i(t)h_i(t)\\mathrm{d}t\n\\tag{13.4}\n\\end{align}\\]其中\\[h_i(t)\\mathrm{d}t=\\mathrm{P}(t\\leqslant T_i\\leqslant t+\\mathrm{d}t\\mid T\\geqslant t)\\]是第 1 章式 (1.3) 中首次定义的风险函数 \\(h_i(t)\\)。式 (13.4) 中的结果来源于这样一个事实，即在生存数据中，在 \\(t\\) 到 \\(t+\\text{d}t\\) 的时间区间内发生事件的风险仅取决于在时间 \\(t−\\) 处于风险的个体，因此那时的相关历史 (relevant history) \\(\\mathcal{H}(t\\boldsymbol{-})\\) 为 \\(T_i\\geqslant t\\)。在式 (13.4) 中包含 \\(Y_i(t)\\) 可确保当第 \\(\\) 个个体不处于风险中时，\\(\\lambda_i(t)=0\\)。根据式 (13.4)，计数过程的强度由 \\(\\lambda_i(t)=Y_i(t)h_i(t)\\) 给出，因此强度函数是当第 \\(\\) 个人处于事件风险时，在时间 \\(t\\) 发生事件的风险。此外，标准 Cox 回归模型的强度函数可表示为\\[Y_i(t)\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\]其中 \\(h_0(t)\\) 是基线风险函数。在后文中，这将像往常一样简记为 \\(h_i(t)\\)。为了根据式 (13.2) 中的一般结果获得该模型的似然函数，我们注意到 \\(\\operatorname{d}N_i(t)\\) 在事件时间之前为 0，在事件时间处为 1. 对式 (13.2) 中偏似然函数的唯一贡献来自处于风险的个体，因此式 (13.2) 变为\\[\\prod_{=1}^n\\left\\{\\frac{\\exp\\{\\boldsymbol{\\beta'x}_i(t)\\}}{\\sum_{l\\R(t_i)}\\exp\\{\\boldsymbol{\\beta'x}_l(t)\\}}\\right\\}^{\\delta_i}\\]正如第 3 章式 (3.5)。当解释变量非时依时，对于 \\(t\\) 的所有值，有 \\(x_j\\equiv x_j(t)\\)，这就是第 3 章 3.3 节中的式 (3.5)。这些结果意味着计数过程理论可用于证明生存分析中的许多标准结果，并导出检验统计量的渐近性质。然而，计数过程表示法的巨大优势在于它可用于在多个方向上扩展 Cox 模型。这些包括时变解释变量、相依删失、复发事件、每个个体的多次事件以及相关数据的模型。它还允许处理具有更复杂删失模式的问题。其中包括左截尾（其中个体的随访过程仅在时间起点之后的某个已知时间开始）以及多状态模型。本章将考虑其中一些情况。","code":""},{"path":"chap13.html","id":"sec13-1-3","chapter":"第 13 章 多次事件和事件史分析","heading":"13.1.3 计数过程格式的生存数据","text":"计数过程数据由时间区间序列 \\((t_{j-1},t_j],~j=1,2,\\ldots\\) 组成，其中 \\(t_0=0\\)，在该时间区间内，计数过程 \\(N_i(t)\\)、风险过程 \\(Y_i(t)\\) 和任意时变解释变量 \\(x_i(t)\\) 的值对于第 \\(\\) 个个体（共 \\(n\\) 个）是恒定的。与每个区间相关的是区间结束时 \\(N_i(t)\\) 的值 \\(N_i(t_j)\\)，其标记了 \\(N_i(t)\\) 增加一个单位的时间，或 \\(Y_i(t)\\) 或解释变量的值变化的时间。这的得到了另一种更灵活的格式化生存数据的方式，如第 8 章 8.3 节所述。为了以计数过程格式表达生存数据，假设 \\(t\\) 是事件时间，\\(\\delta\\) 是特定个体的事件指示符。将时间区间 \\((0, t]\\) 划分为一系列 \\(r\\) 个区间，分割点 \\(t_1,t_2,\\ldots,t_{r-1}\\) 满足 \\(0<t_1<t_2<\\cdots<t_{r-1}<t\\)。相应的区间为 \\((0,t_1],(t_1,t_2],\\ldots,(t_{r-1},t]\\)。所有时变解释变量的值、风险过程和计数过程在每个时间区间内都是恒定的。\\(t_j\\) 处的事件状态为 \\(N(t_j)\\)，因此，如果个体在 \\(t_j\\) 时仍处于风险中，则 \\(N(t_j) = 0\\)，如果该个体在 \\(t_j\\) —— 第 \\(j(j=1,2,\\ldots,r)\\) 个区间 \\((t_{j−1}, t_j ]\\) 的终点 —— 经历事件，则 \\(N(t_j) = 1\\)，其中 \\(t_r \\equiv t\\)。那么，对于第 \\(\\) 个个体，可用序列 \\(\\{t_{,j-1},t_{ij},N_i(t_{ij})\\}\\) 替换对生存时间和事件指示符 \\(\\left(t_i,\\delta_i\\right)\\) 的观测，其中 \\(j=1,2,\\ldots,r,t_{i0}\\equiv 0\\) 且 \\(t_{ir}\\equiv t_i\\)。生存数据现在采用计数过程格式。示例 13.1  (计数过程格式说明) 计数过程格式的使用见第 8 章的示例 8.1 中，其中在基线和 88, 172, 245 和 357 天对生存 379 天的个体进行了时依变量的测量。表 13.1 显示了以计数过程表示法展示的同一患者的数据。","code":""},{"path":"chap13.html","id":"sec13-1-4","chapter":"第 13 章 多次事件和事件史分析","heading":"13.1.4 方差-协方差阵的稳健估计","text":"当使用 Cox 回归模型的计数过程表示来分析多次事件数据时，个体内的事件时间将不是独立的。这又意味着以通常方式获得的拟合模型中参数估计的标准误可能小于实际值。为避免高估基于模型的估计的精度，可以通过使用一个不那么依赖于潜在模型的方差-协方差阵的稳健估计 (robust estimate)。本节将描述一种广泛使用的稳健估计，即三明治估计 (sandwich estimate)，许多研究表明该估计在错误指定的 Cox 回归模型中表现良好。Cox 回归模型中参数估计的方差-协方差阵的基于标准模型的估计 \\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\) 是观测信息矩阵的逆。这是在第 3 章 3.3.3 节中介绍的，是一个 \\(p × p\\) 矩阵，表示为 \\(\\boldsymbol{}^{-1}(\\hat{\\boldsymbol{\\beta}})\\)，其中 \\(p\\) 是未知 \\(\\beta\\) 参数的数量。 Lin Wei (1989) 提出的方差协方差矩阵的稳健估计可以根据 \\(\\boldsymbol{^{-1}}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{^{-1}}(\\hat{\\boldsymbol{\\beta}})\\) 计算得出，其中矩阵 \\(\\boldsymbol{}(\\hat{\\boldsymbol{\\beta}})\\) 可视为允许潜在模型错误指定的修正项。该修正项夹在两个信息矩阵的逆矩阵之间，由此得三明治估计之名。修正矩阵为 \\(\\boldsymbol{}(\\hat{\\boldsymbol{\\beta}})=\\boldsymbol{U'}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{U}(\\hat{\\boldsymbol{\\beta}})\\)。其中 \\(\\boldsymbol{U}(\\hat{\\boldsymbol{\\beta}})\\) 是有效得分的 \\(n × p\\) 矩阵，对 \\(n\\) 个观测的每个观测在估计 \\(\\hat{\\boldsymbol{\\beta}}\\) 处计算。在第 4 章 4.3.1 节中，第 \\(\\) 个观测的有效得分的 \\(p × 1\\) 向量记作 \\(\\boldsymbol{r}_{U{}}\\)，称为第 \\(\\) 个观测的得分残差向量，因此 \\(\\boldsymbol{U}(\\hat{\\boldsymbol{\\beta}})\\) 是一个 \\(n × p\\) 矩阵，其行为 \\(\\boldsymbol{r}_{U1}^{\\prime},\\boldsymbol{r}_{U2}^{\\prime},\\ldots,\\boldsymbol{r}_{Un}^{\\prime}\\)。现在，在省略第 个观测值后，\\(\\beta\\) 参数向量的变化近似为 \\(\\boldsymbol{r}_{U{}}^{\\prime}\\operatorname{var}\\left(\\hat{\\boldsymbol{\\beta}}\\right)\\)，如第 4 章 4.3.1 节所示。以本节的表示法，这些值的矩阵为 \\(\\boldsymbol{D}(\\hat{\\boldsymbol{\\beta}})=\\boldsymbol{U}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{}^{-1}(\\hat{\\boldsymbol{\\beta}})\\)，该矩阵第 \\(\\) 行的分量为 delta-beta 统计量，用于评估第 \\(\\) 个观测对每个参数估计（共 \\(p\\) 个）的影响。因此，三明治估计可写为 \\(\\boldsymbol{D'}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{D}(\\hat{\\boldsymbol{\\beta}})\\)，这显示了如何根据 delta-beta 获得三明治估计。在本章设想的应用中，数据由每个个体内相对较少的事件时间组成。在这种情况下，最好将三明治估计建立在个体内事件时间的聚合 (aggregate) 上。这可以通过将有效得分，即矩阵 \\(\\boldsymbol{U}\\left(\\hat{\\boldsymbol{\\beta}}\\right)\\) 的元素，在每个个体（共 \\(n\\) 个）内的事件时间上求和来实现，所以该矩阵仍是 \\(n × p\\) 的。当使用方差-协方差阵的稳健估计时，比较稳健标准误与通常的基于模型的标准误的比值可能会有所帮助。这样就可以确定使用稳健估计对风险比区间估计等量的影响。","code":""},{"path":"chap13.html","id":"sec13-2","chapter":"第 13 章 多次事件和事件史分析","heading":"13.2 复发事件建模","text":"在医学研究中，一个个体经历多个相同类型的事件（称为复发事件, recurrent event）的情况很常见，例如肿瘤复发、感染发作、药物不良反应、癫痫发作、出血事件、偏头痛和心胸事件。因此需要相应技术来估计复发 (recurrences) 发生的速率或强度 (rate intensity)，以及复发率对个体特征或暴露因素的依赖性。在对复发事件数据的初始分析中，可以使用生存分析的标准方法对第一次事件的时间进行建模。虽然简单，但这种方法忽略了后续事件，因此没有充分利用所有数据。然而，更细致的分析因两个特征而变得复杂。首先，个体之间对复发事件的易感性会有所不同，个体内的复发时间可能不是独立的。其次，在发生大出血等事件后，采取的治疗可能意味着个体在短时间内不会有再出血的风险。因此，有必要修改面临复发事件风险的集合，以考虑到这一点。Cox 回归模型的变体为分析复发事件数据的建模方法提供了方便的框架。特别是，13.1 节描述的计数过程方法可以纳入风险状态随时间变化等特征。常用三种模型分析复发事件。其中最简单的是 Anderson Gill (1982)，但更灵活的模型是 Prentice, Williams Peterson (1981)。第三个由 Wei, Lin Weissfeld (1989) 提出的模型也会描述，但该模型在存在不同类型的事件时更有用，而不是相同类型事件的复发，因此将在后面的 13.3.1 节介绍。我们效仿其他人将这些模型分别称为 AG, PWP 和 WLW 模型。","code":""},{"path":"chap13.html","id":"sec13-2-1","chapter":"第 13 章 多次事件和事件史分析","heading":"13.2.1 Anderson and Gill 模型","text":"在该模型中，基线强度函数对于所有复发都是共同的，不受先前事件发生的影响，并且个体内的单个复发时间是独立的。因此，当主要关注总复发率时，该模型特别有用。刻画第 \\(\\) 个个体（共 \\(n\\) 个）在时间 \\(t\\) 发生事件的强度或风险的 AG 模型由下式给出\\[\\begin{align}\nh_i(t)=Y_i(t)\\exp\\{\\boldsymbol{\\beta'x}_i(t)\\}h_0(t)\n\\tag{13.5}\n\\end{align}\\]其中 \\(Y_i(t)\\) 表示第 \\(\\) 个个体在时间 \\(t\\) 是否有发生事件的风险，\\(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i(t)\\) 是 \\(p\\) 个可能时依的解释变量的线性组合，\\(h_0(t)\\) 是基线风险函数。可能经历多次事件的患者仍然处于风险中，因此 \\(Y_i(t)\\) 将保持为 1，除非个体在某个时间段内暂时不处于风险中，或者直到随访时间删失。时间 \\(t\\) 处的风险集是在时间 \\(t\\) 仍在随访的所有个体的集合，就像标准 Cox 模型一样。为了拟合该模型，复发事件数据以计数过程格式表示，其中第 \\(j\\) 个时间区间 \\((t_j−1, t_j ]\\) 是第 \\(j −1\\) 次和第 \\(j\\) 次复发之间的时间，\\(j = 1, 2,\\ldots\\)，其中 \\(t_0 = 0\\)。状态变量表示事件是否发生在区间终点（即第 \\(j\\) 次复发的时间），如果 \\(t_j\\) 是事件时间，则状态变量为 1，否则为 0. 未经历任何事件的个体只贡献一个时间区间，其终点为删失的，因此其状态变量为 0. 类似地，状态变量在随访期终点将为 0，除非在该时间观测到事件。拟合 AG 模型所需的数据格式稍后在示例 13.2 中说明。通过在模型中纳入对应于先前事件数量或从起点开始的时间的项，可以在一定程度上放宽独立复发时间的假设。由于复发时间之间的任何关联通常会导致 的基于模型的标准误过小，因此可以使用 13.1.4 节描述的 \\(\\beta\\) 参数估计的方差-协方差阵的稳健形式。这种方法可能无法正确解释个体内相关 (within-subject dependence)，因此，如第 10 章所述，可以通过纳入第 \\(\\) 名个体的随机脆弱效应来考虑复发时间之间的关联。将随机个体效应 \\(u_i\\) 添加到 AG 模型中得到\\[\\begin{aligned}h_i(t)=Y_i(t)\\exp\\{\\boldsymbol{\\beta'x}_i(t)+u_i\\}h_0(t)\\end{aligned}\\]其中 \\(u_i\\) 可假定为具有 \\(N(0,\\sigma_u^2)\\) 分布。使用第 10 章 10.6 节描述的方法，拟合具有以及不具有脆弱效应的 AG 模型，可以评估复发时间的个体内相关的程度。一旦拟合了模型，就可以确定风险比及其相应的区间估计。此外，可以使用未调整或调整的累积强度（或风险）函数和累积发生率函数（根据生存函数的补集来估计）来总结复发时间。这将在示例 13.2 中进行说明。","code":""},{"path":"chap13.html","id":"sec13-2-2","chapter":"第 13 章 多次事件和事件史分析","heading":"13.2.2 Prentice, Williams, and Peterson 模型","text":"直接扩展式 (13.5) 中的 AG 模型得到了一个更灵活的模型，其中为每个事件定义了单独的层。该模型允许强度随复发而异，因此个体内复发时间 (within-subject recurrence times) 不再是独立的。在 PWP 模型中，第 \\(\\) 个个体在时间 \\(t\\) 发生第 \\(j(j=1,2,\\ldots)\\) 次事件的风险为\\[\\begin{align}\nh_{ij}(t)=Y_{ij}(t)\\exp\\{\\boldsymbol{\\beta}_j^{\\prime}\\boldsymbol{x}_i(t)\\}h_{0j}(t)\n\\tag{13.6}\n\\end{align}\\]其中 \\(Y_{ij} (t)\\) 在第 \\(j − 1\\) 次复发事件之前为 1，此后为 0，\\(\\boldsymbol\\beta_j\\) 是第 \\(j\\) 次复发时间的 \\(p\\) 个解释变量的系数向量，\\(\\boldsymbol x_i(t)\\) 是解释变量的值向量，\\(h_{0j} (t)\\) 是第 \\(j\\) 次复发的基线风险。在此模型中，第 \\(j\\) 次复发的风险集仅限于经历过先前 \\(j−1\\) 次复发的个体。由于第 \\(j\\) 个复发事件的强度取决于第 \\(j − 1\\) 个事件的发生，因此这称为条件模型 (conditional model)，并被广泛认为是最令人满意的一般模型。式 (13.6) 中定义的 PWP 模型可以使用 Cox 回归模型进行拟合，按复发次数分层。数据以拟合 AG 模型相同的格式来表示，其中状态指示符在第 \\(j\\) 次复发时间之前为 1，此后为 0. 此外，分层因素表示复发次数。对于每次复发，解释变量的系数可以采用不同的值，但是当大量复发不经常发生时，它们可以限制在对于层的子集（或在所有层）中具有共同值23。像往常一样，\\(-2\\operatorname{log}\\hat{L}\\) 统计量值的变化可用于正式检验风险比在层间恒定24的假设。该模型特别适用于关注事件不同复发之间的时间间隔以及风险比是否因复发次数而异的情况。与 AG 模型一样，可以使用参数估计的稳健方差-协方差矩阵来进一步考虑复发时间的相关性，并且可以通过使用脆弱项来扩展该模型，以解释复发时间之间的任何关联。示例 13.2  (雌性大鼠乳腺肿瘤的复发) 在旨在比较有效的癌症预防治疗和对照治疗的动物实验中，肿瘤的发生率是令人感兴趣的。Gail, Santner Brown (1980) 描述了一项关于雌性大鼠乳腺癌发展的实验，其中大鼠被随机分配到两个处理组中。首先给大鼠注射致癌物质，然后注射维甲酸乙酯 (retinyl acetate)，这是一种维生素 的自然形式，具有抑制肿瘤发展的潜力。60 天后，48 只没有肿瘤的大鼠被随机分配到继续接受维甲酸 (retinoid) 预防治疗的组，或不接受此类治疗的对照组。每周对这些大鼠进行两次肿瘤证据评估，观察期在随机接受治疗 122 天后结束。122 天时没有肿瘤的大鼠的复发时间为删失的。表 13.2 中的数据给出了接受维甲酸预防的 23 只大鼠以及 25 只对照组大鼠从随机化到发生乳腺肿瘤的时间。由于不是每天都对这些老鼠进行评估，一些老鼠在一次评估中被发现患上了不止一个肿瘤。例如，在第 42 天，对照组中的一只大鼠被发现有三个肿瘤。为了消除结观测产生的模糊性，将这些时间表示为 42, 42.1 和 42.2 天。\n对第一次事件的时间进行建模可进行初步的简单分析。实验的 48 只老鼠中，只有两只没有发展出肿瘤，因此生存时间为删失的。使用 Cox 回归模型，相对于对照组，接受维甲酸治疗的大鼠中第一次出现肿瘤的风险为 0.50. 这与 1 显著不同（\\(P = 0.027\\)），相应的 95% 置信区间为 \\((0.27, 0.93)\\)。有强有力的证据表明，接受治疗的大鼠首次出现肿瘤的风险约为对照大鼠的一半。为了说明如何组织数据以进行复发事件分析，请考虑治疗组中第五只大鼠的数据，该大鼠检测到肿瘤的时间为 70, 74, 85 和 92 天，直到随访的第 122 天，未检测到更多的肿瘤。为了将数据用于 AG 和 PWP 模型，将该序列以计数过程格式表示，示于表 13.3 中。治疗组由一个解释变量表示，这对于接受维甲酸治疗的大鼠为 1，否则为 0.\n在 AG 模型中，在时间 \\(t\\) 发展出肿瘤的风险由下式给出\\[\\begin{aligned}h_i(t)=Y_i(t)\\exp(\\beta x_i)h_0(t)\\end{aligned}\\]其中，当大鼠处于肿瘤发展的风险时，\\(Y_i(t)= 1\\)，否则为 0，如果第 \\(\\) 只大鼠在治疗组中，则 \\(X_i = 1\\)，否则为 0，\\(\\beta\\) 是接受维甲酸治疗的大鼠相对于对照组大鼠的对数风险比。然后为表 13.3 所示的数据中的停止时间（即每个区间的终点）拟合标准 Cox 回归模型。使用治疗效应的稳健标准误，得到 \\(\\hat{\\beta}=-0.801\\) 以及 \\(\\text{se}\\left(\\hat{\\beta}\\right)=0.198\\)，该估计显著小于零（\\(P < 0.001\\)），并且在任何给定时间，维甲酸组大鼠发生肿瘤的总体风险相对于对照组大鼠为 0.45，95% 置信区间为 \\((0.30,0.66)\\)。维甲酸治疗组大鼠的肿瘤发生率不到对照组大鼠的一半。可以使用每个治疗组中大鼠肿瘤复发的累积强度（或风险）估计来总结治疗差异。即 \\(\\exp(\\hat{\\beta}x)\\hat{H}_0(t)\\)，其中，\\(\\hat{H}_0(t)\\) 是基线累积强度函数估计，对于接受维甲酸治疗的大鼠，\\(x = 1\\)，对于对照组的大鼠，\\(x = 0\\)。这也是随时间推移肿瘤复发的累积预期数。每种治疗的累积强度如图 13.1 所示。这表明接受维甲酸治疗的大鼠的肿瘤发生强度低于对照组大鼠。45 天时，预估治疗组中的大鼠将出现一个肿瘤，但对照组中的大鼠此时将出现两个肿瘤。\n复发的累积发生率可根据 \\(1-\\hat{S}_0(t)^{\\exp(\\hat{\\beta}x)}\\) 计算，\\(x = 0\\) 或 \\(1\\)，其中 \\(\\hat{S}_0(t)=\\exp\\{-\\hat{H}_0(t)\\}\\) 是拟合的 AG 模型的基线生存函数估计。两个发生率函数如图 13.2 所示。该图再次证实对照组大鼠的肿瘤发生率明显更高。治疗组大鼠的中位肿瘤复发时间为 31 天，对照组大鼠的中位肿瘤复发时间为 17 天。\n可以通过向 AG 模型添加正态分布随机效应来对大鼠内复发时间之间的关联进行建模，而不是使用治疗效应的稳健标准误。这种随机效应对于每只大鼠来说都是不同的，但对于大鼠内的复发时间来说是恒定的。建模后，大鼠效应非常显著，随机效应的方差估计为 0.25. 在此模型中，总体风险比估计为 0.46，95% 置信区间为 \\((0.31, 0.71)\\)。这些估计与使用稳健标准误获得的估计相似。AG 模型的一个缺点在于复发率不取决于先前复发的次数，因此我们接下来拟合 PWP 模型。在该模型中，第 \\((=1,2,\\ldots,48)\\) 只大鼠第 \\(j(j=1,2,\\ldots)\\) 次复发的风险为\\[h_{ij}(t)=Y_{ij}(t)\\exp(\\beta_jx_i)h_{0j}(t)\\]其中 \\(y_{ij}(t)=1\\)，直到第 \\(j−1\\) 次复发后为 0，如果第 \\(\\) 只大鼠在治疗组，则 \\(x_i=1\\)，否则为 0，\\(\\beta_j\\) 为第 \\(j\\) 次复发的治疗效应。拟合该模型后，前四次复发和五次及以上复发的估计 \\(\\hat{\\beta}_j\\)、风险比估计 \\(\\exp(\\hat{\\beta}_j)\\) 及其标准误如表 13.4 所示。该表中显示了标准的基于模型的标准误和使用三明治估计获得的标准误。不同寻常的是，基于稳健估计的估计较小，但三明治估计将用于后续分析。\n首次复发的风险比为 \\(\\exp(-0.686)=0.50\\)，这与仅对第一次肿瘤发生的时间进行建模的风险比相同，理应如此。第 2 次和第 4 次复发的风险比比接近 1，\\(P=0.697,0.839\\)，而第 3 次和 5次及以上复发的风险比显著小于 1，\\(P=0.029,0.002\\)。然而，对于拟合的 PWP 模型，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 812.82，在约束所有 \\(\\beta\\) 相等的情况下，该统计量的值增加到 816.95. 与 \\(\\chi^2_4\\) 分布的百分位点相比，4.13 的增加并不显著（\\(P=0.39\\)），因此，总体上，没有证据表明不同次数复发的风险比之间存在差异。公共 \\(\\beta\\) 的估计为 −0.523，因此任何复发的风险比为 0.59，95% 置信区间为 \\((0.46，0.77)\\)。这与使用 AG 模型发现的非常相似，但在这里，复发时间具有不同的基线风险。通过拟合包含与复发次数相关的因素的非分层模型，可以将风险函数 \\(h_{ij} (t)\\) 约束为成比例的，即\\[\\begin{aligned}h_{ij}(t)=Y_{ij}(t)\\exp(\\beta_jx_i+\\zeta_j)h_0(t)\\end{aligned}\\]其中 \\(\\zeta_j\\) 是第 \\(j\\) 次复发的效应。如果 \\(\\zeta_j\\) 都为零，则该模型简化为 AG 模型。分层和非分层模型不是嵌套的，因此两种模型不能直接进行比较。然而，假定成比例的风险，总体风险为 0.59，95% 置信区间为 \\((0.45，0.77)\\)，这与使用分层模型得到的结果非常相似。","code":""},{"path":"chap13.html","id":"sec13-3","chapter":"第 13 章 多次事件和事件史分析","heading":"13.3 多种事件","text":"患有慢性病的个体可能会经历多种事件，每种事件的类型都不同。个体可能不会经历所有这些事件，虽然复发事件具有自然的时间顺序，但多种事件发生的顺序可能因个体而异。例如，肝病患者可能会经历诸如疾病的组织学进展、静脉曲张、腹水、血清胆红素水平升高、肝移植和死亡等事件。通常，这些事件中的每一个最多发生一次，其顺序可能因患者而异。这些数据可以通过为来自相同时间起点的每个事件时间拟合不同的模型来分析，但更有效的分析是基于 Wei, Lin Weissfeld (WLW) 模型25。","code":""},{"path":"chap13.html","id":"sec13-3-1","chapter":"第 13 章 多次事件和事件史分析","heading":"13.3.1 Wei, Lin and Weissfeld 模型","text":"在此模型中，为每个事件定义了层，层的总数等于可能事件的数量。对于 PWP 模型，第 \\(\\) 个个体在时间 \\(t\\) 发生第 \\(j\\) 个事件的风险由下式给出\\[\\begin{aligned}h_{ij}(t)=Y_{ij}(t)\\exp\\{\\boldsymbol{\\beta}'_j\\boldsymbol{x}_i(t)\\}h_{0j}(t)\\end{aligned}\\]但现在 \\(Y_{ij} (t)\\) 为 1，直到第 \\(j\\) 个事件发生后为 0. 在此模型中，时间 \\(t\\) 时的风险集由在时间 \\(t\\) 时接受随访且尚未发生第 \\(j\\) 个事件的所有个体组成。该模型与第 \\(j\\) 个事件的 Cox 回归模型具有相同的形式，只是在 WLW 模型中，\\(\\beta\\) 是根据所有事件时间联合估计的。 WLW 模型称为边际模型 (marginal model)，因为每个事件时间都视为单独的事件，并且每个事件的时间起点是每个个体随访时间的开始。风险比可能因事件类型而异，并且该模型还考虑到每个事件潜在强度的差异。为拟合该模型，需确定研究中所有个体可能发生的事件总数 \\(r\\)，并且每个事件的时间表示为从时间起点开始的一系列区间 \\((0, t_j]\\)，其中 \\(t_j\\) 是第 \\(j\\) 个事件时间，\\(j = 1, 2,...,r\\)。可以再次使用稳健的方差-协方差阵，或者可以合并脆弱项，以专门考虑个体内事件时间之间的任何相关性。此外，可以将基线风险视为成比例的，也可以引入对 \\(\\beta\\) 参数的约束，如 13.2.2 节中的 PWP 模型。WLW 模型最初是作为一种复发事件的模型提出的，但在这一领域的使用存在一些争议。具体来说，当 WLW 模型用于对复发事件进行建模时，风险集的定义是，仅经历过一次复发的个体不仅面临第二次复发的风险，而且还面临第三次、第四次、第五次复发的风险， 等等。这使得关于解释变量系数的解释变得困难。由于这种不一致，如果考虑“从时间起点到单独的事件时间”是自然的，才建议使用该模型26。示例 13.3  (他莫昔芬治疗乳腺癌患者的临床试验) 有大量证据表明，乳腺癌女性接受保乳手术后，除他莫昔芬治疗外，局部放疗可降低同一乳房肿瘤复发的风险，并提高长期生存率。乳房筛查能够检测出非常小的肿瘤，人们关注的是确定低风险患者是否可以避免放疗。1992 年开展了一项多中心临床试验，以确定放疗辅助治疗对 50 岁及以上因直径小于等于 5cm 的浸润性腺癌接受保乳手术的女性的益处。患者被随机分配接受每日 20mg 他莫昔芬治疗五年外加乳房放疗，或仅接受他莫昔芬治疗。患者在前三年每三个月就诊一次，接下来两年每六个月就诊一次，之后每年就诊一次，随访至 2002 年结束。试验及其结果的详细信息由 Fyles et al. (2004) 提供。本示例基于 Pintilie (2006) 使用的某特定中心的数据，涉及 320 名被随机分配接受他莫昔芬加放疗的女性，以及 321 名仅接受他莫昔芬的女性。随机分组时，记录患者年龄、肿瘤大小、肿瘤组织学、激素受体水平、血红蛋白水平以及是否进行腋窝淋巴结清扫等信息。在随访过程中，记录从随机分组到首次发生局部复发、腋窝复发、远处复发、任何类型的第二个恶性肿瘤和死亡的时间。对于每位患者，数据集包含从随机化到发生任何这些事件的天数以及事件指示符。对于没有发生事件且在随访结束时仍然存活的女性，每个事件时间均在她们还存活的已知最后日期进行删失。数据集中的变量如下所示，25 名接受他莫昔芬和放疗的患者的解释变量和生存数据如表 13.5 所示。\\(Id\\)：患者标识符\\(Treat\\)：治疗组（0 = 他莫昔芬+放疗，1 = 他莫昔芬）\\(Age\\)：患者年龄\\(Size\\)：肿瘤大小 (cm)\\(Hist\\)：肿瘤组织学（1 = 导管，2 = 小叶，3 = 髓质，4 = 混合，5 = 其他）\\(HR\\)：激素受体水平（0 = 阴性，1 = 阳性）\\(Hb\\)：血红蛋白水平 (g/l)\\(ANdis\\)：腋窝淋巴结清扫术（0 = 否，1 = 是）\\(Lsurv\\)：局部复发或最终随访的时间\\(Ls\\)：局部复发（0 = 否，1 = 是）\\(Asurv\\)：腋窝复发或最终随访的时间\\(\\)：腋窝复发（0 = 否，1 = 是）\\(Dsurv\\)：远处复发或最终随访的时间\\(Ds\\)：远处复发（0 = 否，1 = 是）\\(Msurv\\)：第二个恶性肿瘤或最终随访的时间\\(Ms\\)：第二个恶性肿瘤（0 = 否，1 = 是）\\(Tsurv\\)：从随机分组到死亡或最终随访的时间\\(Ts\\)：最终随访的状态（0 = 存活，1 = 死亡）\n表 13.5\n\n此表可保存后旋转以便阅读\n\n\n这些数据将使用 WLW 模型进行分析，第一步是将数据组织成所需的格式。尽管没有患者经历过三种以上的事件，但修改后的数据集将为每位患者提供五行，分别对应于局部复发、腋窝复发、远处复发、第二个恶性肿瘤和死亡的时间。解释变量的值在每行中重复。此表可保存后旋转以便阅读为了说明数据的这种重组，表 13.6 显示了四名患者的事件时间和删失指示符，其中一名患者没有事件，一名患者有一个事件，一名患者有两个事件，一名患者有三个事件。在此表中，\\(Nevents\\) 是事件数，解释变量已省略。\n表 13.7 中给出了这四名患者的数据（按所需的格式）。这里，变量 \\(Time\\) 是相关事件的时间，\\(Status\\) 是事件状态，其中 0 对应于删失时间，1 对应于事件。在该表中，变量 \\(Event\\) 编码为 1 表示局部复发，2 表示腋窝复发，3 表示远处复发，4 表示第二个恶性肿瘤，5 表示死亡。\n现在为表 13.7 所示数据拟合按事件分层的 Cox 回归模型，其中解释变量系数因事件而异。对于每种事件类型，表 13.8 显示了单独使用他莫昔芬治疗相对于他莫昔芬配合放疗的风险比、基于 Wald 检验的相应 \\(P\\) 值以及经 \\(Age,Size,Hist,HR,Hb\\) 和 \\(ANdis\\) 变量调整的风险比的 95% 置信限。使用了参数估计的方差-协方差阵的稳健估计。\n根据该表，如果在不进行放疗的情况下使用他莫昔芬，局部复发的风险会增加 10 倍以上，这一效应非常显著（\\(P < 0.001\\)）。还有一些证据（在 10% 水平上显著）表明，缺乏放疗会增加腋窝复发的风险，但所有其他事件的风险比估计与 1 没有显著差异。对该数据集的进一步分析将确定不同事件类型风险成比例的程度，并确定哪些解释变量与每个结局相关。","code":""},{"path":"chap13.html","id":"sec13-4","chapter":"第 13 章 多次事件和事件史分析","heading":"13.4 事件史分析","text":"在主要结局是从时间起点到死亡的生存研究中，随访期间发生的其他非致命事件可能有助于进一步阐明潜在的死亡过程。中间事件 (intermediate events) 的序列定义了事件史 (event history)，并且可以使用多状态模型 (multistate models) 来分析这类数据。患者在生存研究中的经历可认为是一个涉及两个状态 (states) 的过程。在进入研究时，患者处于存活的状态。然后，患者以一定的转移率 (transition rate) \\(h(t)\\) 从这种“活”的状态转移为“死”的状态，这是在给定时间 \\(t\\) 死亡的风险。这种情况如图 13.3 所示。然后对从一种状态到另一种状态的转移率关于解释变量的依赖性进行建模。\n作为存在多个状态的示例，请考虑有关移植患者的生存研究。移植后存在移植物衰竭的风险以及死亡的风险，并且这两种事件的转移率可能大不相同。此外，移植物衰竭的患者可以再次移植，但也可能未再次移植就去世了。这种情况如图 13.4 所示。\n这种四状态模型可根据从移植到死亡的转移率 \\(h_{TD}(t)\\)、从移植到移植物衰竭的转移率 \\(h_{TF} (t)\\)、从移植物衰竭到再移植的转移率 \\(h_{FR}(t)\\)、从移植物衰竭到死亡的转移率 \\(h_{FD}(t)\\) 以及从再移植到死亡的转移率 \\(h_{RD}(t)\\) 来指定。请注意，虽然 \\(h_{TD}(t),h_{FD}(t)\\) 和 \\(h_{RD}(t)\\) 均表示时间 \\(t\\) 时的死亡风险，但风险取决于患者是否发生移植物衰竭或已进行再移植，并且这些风险可能都不同。当没有发生移植物衰竭时，可以直接对移植后的死亡风险 \\(h_{TD}(t)\\) 建模。此时，移植物衰竭患者的生存时间在失效时删失。存活且未经历移植物衰竭的患者的生存时间也是删失的。在对从移植物衰竭或再移植到死亡的转移率进行建模时，在任何时间处于死亡风险集的患者包括发生移植物衰竭但仍然存活或再移植且仍然存活的患者。尚未发生移植物衰竭或再移植的患者不能处于任一风险集中。幸运的是，通过以计数过程格式表达数据，Cox 回归模型可用于对该四状态模型中状态之间的所有四种转移进行建模。此外，这种方法可扩展到更复杂的多状态模型。","code":""},{"path":"chap13.html","id":"sec13-4-1","chapter":"第 13 章 多次事件和事件史分析","heading":"13.4.1 事件史分析模型","text":"假设 \\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体的 \\(p\\) 个解释变量的值向量，并令 \\(\\boldsymbol\\beta_{jk}\\) 是它们从状态 \\(j\\) 转移到状态 \\(k\\) 的相应系数向量。另外，用 \\(h_{0jk}(t)\\) 表示此转移的基线强度函数。多状态模型中第 \\(\\) 个个体在时间 \\(t\\) 处从状态 \\(j\\) 到状态 \\(k\\) 的转移率为\\[\\begin{aligned}h_{ijk}(t)=Y_{ijk}(t)\\exp\\{\\boldsymbol{\\beta}'_{jk}\\boldsymbol{x}_i\\}h_{0jk}(t)\\end{aligned}\\]其中，如果第 \\(\\) 个个体处于状态 \\(j\\) 且有在时间 \\(t\\) 进入状态 \\(k\\) 的风险，则 \\(Y_{ijk}(t) = 1\\)，否则 \\(Y_{ijk}(t) = 0\\)。如同本章描述的其他模型，该模型的解释变量也可能是时依的。时间通常是从进入初始状态的时间点开始测量的，这标志着时间起点。当为每个转移假定单独的基线风险和单独的回归系数时，可以使用分层 Cox 回归模型来对不同的转移率进行建模。还可以假定成比例的风险率，并通过在模型中包括对应于不同状态的因素来建模。一般来说，为此需要生存数据的计数过程公式，因为风险集定义将取决于所关注的转移。与从状态 \\(j\\) 到状态 \\(k\\) 的转移相关的特定个体数据将包含一个记录，这给出了进入状态 \\(j\\) 的时间、从状态 \\(j\\) 退出的时间以及一个状态指示符，如果转移是从状态 \\(j\\) 到状态 \\(k\\)，则该状态指示符为 1，否则为 0。该过程如示例 13.4 所示。示例 13.4  (骨髓移植后的患者结局) European Group Blood Marrow Transplantation (EBMT) 的成立是为了促进干细胞移植，并允许临床医生开展合作研究。这是由 EBMT Registry 促进的，其包含了接受过造血干细胞移植的患者的临床和结局数据。该登记处成立于 20 世纪 70 年代初，由移植中心和国家登记处提供数据，包括对其患者的年度随访数据。因此，EBMT Registry 是对白血病、淋巴瘤、骨髓瘤和其他血液疾病患者进行干细胞移植结局的回顾性研究的宝贵数据来源。本实例基于 2204 名接受骨髓移植的白血病患者数据，这些患者向 EBMT Registry 报告，在 Putter, Fiocco Geskus (2007) 中使用过。移植的目的是让血小板计数恢复到正常水平，但有些人可能会在达到这种状态之前复发或死亡。而那些血小板计数已恢复正常的个体也可能会复发或死亡。将使用具有三个状态的模型来表示该事件史。移植后的时间是初始状态（状态 1），患者随后可能进入血小板已恢复的状态（状态 2）或对应于复发或死亡的状态（状态 3）。从状态 2 到状态 3 的转移也是可能的。该多状态模型如图 13.5 所示。在此图中，从状态 \\(\\) 到状态 \\(j\\) 的转移率表示为 \\(h_{ij} (t)\\)，因此三个速率为 \\(h_{12}(t), h_{13}(t)\\) 和 \\(h_{23}(t)\\)。\n对于每位患者，还获取到与疾病类型相关的变量 \\(Leukaemia\\) 的数据，这划分为急性髓性白血病 (AML)、急性淋巴细胞白血病 () 和慢性髓性白血病 (CML). 还记录了他们的年龄组 \\(Age\\)（\\(\\leqslant 20,21-40,>40\\)）、供体与受体的性别是否匹配 \\(Match\\)（0 = 否，1 = 是）以及 T 细胞是否耗尽 \\(Tcell\\)（0 = 否，1 = 是）。前 20 名患者的数据如表 13.9 所示。该表显示了从移植到血小板恢复的时间（\\(Ptime\\)）以及复发或死亡的时间（\\(RDtime\\)）。还显示了血小板恢复（\\(Pcens\\)）和复发或死亡（\\(RDcens\\)）时的事件指示符，这对于删失观测为 0，对于事件为 1.\n在 2204 名接受骨髓移植的患者中，有 1169 名患者血小板恢复到正常水平，458 名患者在血小板水平恢复正常之前复发或死亡。另有 383 名患者在血小板恢复后复发或死亡。还有 152 名患者病情复发，但仍在监测血小板恢复情况（例如表 13.9 中的患者 10, 18 和 20）。由于图 13.5 所示的模型不允许从复发或死亡到血小板恢复的转移，因此在这些患者复发时血小板恢复的时间是删失的。为拟合多状态模型，需要对数据进行格式化，使得每个患者每个可能的转移都有一行观测。存在三种可能的转移，表示为 \\(1\\rightarrow 2,1\\rightarrow 3\\) 和 \\(2\\rightarrow 3\\)。对于转移 \\(2\\rightarrow 3\\)，只有血小板水平恢复正常的患者才有后续复发或死亡的风险，因此仅记录这些患者的两种可能的转移。对于表 13.9 中前 10 名患者的数据，表 13.10 展示了以这种格式表示的数据。\n为表 13.10 所示格式的数据拟合 Cox 回归模型来为三种状态之间的转移建模，并按转换类型分层。首先，为模型纳入四个解释变量（\\(Leukaemia,Age, Match\\) 和 \\(Tcell\\)）以及层与这四个变量之间的交互作用，拟合了一个分层模型，该模型允许与四个解释变量相关的参数取决于转移类型。使用 \\(-2\\operatorname{log}\\hat{L}\\) 统计量比较替代模型，结果表明，没有证据表明因素 \\(Tcell\\) 和 \\(Match\\) 在三种转移类型中有所不同，并且这三种转移都不依赖于 \\(Match\\)。因此，缩减模型包含 \\(Leukaemia,Age\\) 和 \\(Tcell\\) 的主效应，以及 \\(Leukaemia\\) 与 \\(Transition\\)、\\(Age\\) 与 \\(Transition\\) 之间的交互作用。对于该模型，风险比及其相关的 95% 置信区间如表 13.11 所示。在此示例中，使用了方差的稳健估计，但所得标准误与基于模型的估计差别不大。\n白血病类型和年龄组对这三个转移的效应不同。CML 患者血小板恢复的速度比其他两种患者要慢，并且在血小板恢复后更有可能复发。与 AML 或 CML 患者相比，患者在血小板恢复前复发或死亡的风险更大。21 - 40 岁的患者血小板恢复速度比其他人慢，而 40 岁以上的患者无论血小板是否恢复，复发或死亡的风险都会增加。 T T 细胞耗竭会显著提高向其他状态的转移率，但没有证据表明这些转移类型之间的转移率有所不同。对于 20 岁以下、患 AML 且无 T 细胞耗竭的患者的三个基线累积风险和发生率，如图 13.6 和 13.7 所示。基线累积风险图显示，向血小板恢复转移发生的速度比向复发或死亡转移的速度快得多。累积发生率函数具有非常相似的模式，从图 13.7 中可以看出，对于基线组的患者，从两种可能状态中的任何一种转移为复发或死亡的一年累积发生率大约是血小板恢复发生率的三分之一27。\n图 13.6 表明，从其他两种状态转移为复发或死亡的基线风险函数很可能是成比例的，尽管转移为血小板恢复状态的风险率与其他两种不同。因此，也许模型可进一步简化，但这对由此产生的推断几乎没有影响。","code":""},{"path":"chap13.html","id":"sec13-5","chapter":"第 13 章 多次事件和事件史分析","heading":"13.5 延伸阅读","text":"许多文献描述了生存分析中的计数过程方法，包括 Fleming Harrington (2005) , Aalen, Borgan Gjessing (2008) 以及 Andersen et al. (1993) . Andersen Gill (1982) 给出了基于计数过程理论的生存数据模型的数学处理，而 Gill (1984) 中包含了更易读的总结。另见 Andersen Borgan (1985) 的综述文章。Lin Wei (1989) 介绍了 Cox 回归模型中参数估计的方差-协方差阵的稳健三明治估计，Therneau Grambsch (2000) 描述了其与 delta-beta 的联系。本章涵盖的三个关于复发和多种事件的模型是由 Andersen 和 Gill (1982) , Prentice, Williams Petersen (1981) 以及 Wei, Lin Weissfeld (1989) 提出的。Cook Lawless (2007) 对复发事件方法进行了全面回顾，Therneau Grambsch (2000) 在其关于 Cox 回归模型扩展的文本中描述了复发和多种事件的模型。Cook Lawless (2018) 提供了对多状态建模和分析的全面处理，Wei Glidden (1997) 概述了临床试验中分析多种事件的统计方法。Kelly Lim (2000) 对复发事件数据的不同模型进行了仔细的讨论，得出的结论是 WLW 模型是不合适的。Metcalfe Thompson (2007) 提出了支持和反对 WLW 模型来分析复发事件数据的论点。Andersen Keiding 于 2002 年在 Statistical Methods Medical Research 专刊上发表的文章（该专刊专门讨论这一主题）及其后续论文对多状态模型进行了详尽的综述。其他综述文章包括 Commenges (1999), Hougaard (1999) 以及 MeiraMachado et al. (2009). Hougaard (2000) 在对多变量生存数据的解释中阐述了事件史模型。Putter, Fiocco Geskus (2007) 的教程文章介绍了 Cox 回归模型如何应用于事件史建模，并以第 13.4 节示例 13.4 中使用的 EBMT 数据为例进行了说明。其他一些文章也对骨髓移植患者的多状态模型进行了介绍，包括 Keiding, Klein Horowitz (2001) 和 Klein Shu (2002)，Hougaard Madsen (1985) 和 Andersen (1988) 给出了在医学研究中使用多状态模型的进一步示例。Beyersmann, Allignol Schumacher (2012) 以及 Putter, Fiocco Geskus (2007) 的文章介绍了 R 软件在竞争风险分析和多状态建模中的应用，另见 Putter (2011)，这是 Journal Statistical Software 的一期特刊。必须知道复发时间才能使用本章介绍的方法。许多作者在动物致癌实验中考虑了不依赖于已知复发时间的多状态模型。具体来说有 Dinse (1991), Kodell Nelson (1980) 以及 McKnight Crowley (1984). Lindsey Ryan (1993) 给出了这些文献的综述。","code":""},{"path":"chap14.html","id":"chap14","chapter":"第 14 章 相依删失","heading":"第 14 章 相依删失","text":"本书中描述的用于分析删失生存数据的方法仅在删失是独立的 (independent) 或非信息性 (non-informative) 的情况下才有效。本质上，这意味着删失与实际生存时间无关，因此具有删失生存时间的个体代表了解释变量测量值相同且当时处于风险的所有其他个体。例如，如果患者因搬迁到该国的不同地区而退出研究，或者在预先规定的时间分析生存数据，删失时间将视为独立的。另一方面，如果患者因特定治疗出现危及生命的副作用而退出，或者如果对积极治疗没有响应的患者接受了补救药物，则删失时间不再独立于生存时间。这种删失认为是相依的 (dependent) 或信息性的 (informative). 本章展示了在对生存数据进行建模时如何考虑相依删失。","code":""},{"path":"chap14.html","id":"sec14-1","chapter":"第 14 章 相依删失","heading":"14.1 识别相依删失","text":"相依删失发生在死亡等事件的时间与删失发生的时间之间存在相关性的情况下。由于这两个事件都不能在给定的个体中观察到，所以不可能使用观测数据来确定数据集是否具有相依删失，也不可能确定任何此类依赖性的程度。然而，研究的背景通常可以表明是否可能存在相依删失。例如，考虑由获得性免疫缺陷综合征（AIDS）临床试验小组进行的双盲临床试验，称为 ACTG 175 试验，并由 Hammer et al. (1996) 报道。在这项试验中，2467 名患者被随机分配到四种治疗方案中的一种，主要终点是从随机化到分化簇 4 (cluster differentiation 4, CD4) 细胞计数至少减少 50% 的时间、发展成艾滋病或死亡。有 1902 个删失事件时间，其中 933 次是由患者在随访期结束时没有经历过三种事件中的任何一种，因此反映了独立的行政删失 (administrative censoring). 此外，283 人因治疗毒性而停止治疗，380 人应患者或研究人员的要求离开研究。这可能是因为健康状况不佳的患者更有可能经历毒性，而对于这些患者来说，他们的事件时间可能更短。同样，患者可能已经离开研究以寻求替代治疗，同样，这些患者可能不能代表整个患者组。因此，在分析到主要终点的时间时，需要考虑相依删失的可能性。统计方法可以通过多种方式来检验独立删失的假设。一种方法是根据解释变量的值绘制观测生存时间，其中将删失观察与未删失观测区别开。如果在删失中表现出一种模式，例如在特定治疗的早期有更多的删失观测，或者如果解释变量的值在特定范围内的患者的删失生存时间的比例更大，则表明存在相依删失。更正式地说，可使用模型来考察删失概率是否与模型中的解释变量相关。具体来说，线性 logistic 模型可用于对二元响应变量进行建模，如果观测生存时间是删失的，则该变量取值 1，否则为 0. 如果发现删失概率取决于某些解释变量的值，则可能违反了独立删失的假设。","code":""},{"path":"chap14.html","id":"sec14-2","chapter":"第 14 章 相依删失","heading":"14.2 对相依删失的敏感性","text":"即使存在相依删失，这一特征也不一定会影响主要兴趣的推断。因此，重要的是要确定这种推断对相依删失可能性的敏感性，这可以通过两种互补分析来考察。首先，我们假定贡献删失观测的个体实际上是那些事件风险较高的个人。因此，我们假设生存时间删失的个体会在删失时间之后立即经历事件，并将所有删失时间指定为事件时间。在第二个分析中，我们假定删失的个体是那些事件风险较低的个体。那么，我们假设具有删失时间的个体只在数据集中所有其他个体的最长生存时间之后才经历该事件。因此，被删失时间被最长的事件时间所取代。那么可以详细研究这两个假设对分析结果的影响。如果从原始分析和两个补充分析中得出基本相同的结论，则可以放心地假定结果对相依删失的可能性不敏感。确定相依删失潜在影响的另一种方法是在存在相依删失的情况下获得生存函数的界 (bounds). 目前存在许多建议，但其中许多建议的界太宽，没有实际价值，因此将不再进一步考虑这种方法。由于在没有额外信息的情况下无法识别相依删失的发生，因此分析风险评分或中位生存时间等指标对失效时间和删失时间之间关联引入的敏感程度是很有用的28。下一部分将概述 Siannis, Copas Lu (2005) 描述的参数比例风险模型中相依删失的敏感性分析方法。","code":""},{"path":"chap14.html","id":"sec14-2-1","chapter":"第 14 章 相依删失","heading":"14.2.1 敏感性分析","text":"假设 \\(T\\) 是与生存时间相关的随机变量，\\(C\\) 是与删失时间相关的随机变量。我们假定一个在 \\(t\\) 时刻死亡风险和删失风险均为 Weibull 比例风险的模型。第 \\((=1,2,\\ldots,n)\\) 个个体的两个风险函数分别为 \\(h_i(t)\\) 和 \\(h_{ci}(t)\\)，其中\\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t),\\quad h_{ci}(t)=\\exp(\\boldsymbol{\\beta}'_c\\boldsymbol{x}_i)h_{c0}(t)\\end{aligned}\\]其中 \\(\\boldsymbol x_i\\) 是 \\(p\\) 个解释变量的值向量。生存时间和删失时间的基线风险函数由下式给出\\[\\begin{aligned}h_0(t)=\\lambda\\gamma t^{\\gamma-1},\\quad h_{c0}(t)=\\lambda_c\\gamma_ct^{\\gamma_c-1}\\end{aligned}\\]其中 \\(\\lambda,\\lambda_{c}\\) 和 \\(\\gamma,\\gamma_{c}\\) 分别为潜在 Weibull 分布的尺度参数和形状参数。生存时间和删失时间的模型可以包含不同的解释变量。拟合这些模型后，\\(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\) 和 \\(\\boldsymbol{\\beta}^{\\prime}_c\\boldsymbol{x}_i\\) 的估计分别为风险评分 (risk score) \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 和删失评分 (censoring score) \\(\\hat{\\boldsymbol{\\beta}}_c^{\\prime}\\boldsymbol{x}_i\\)。风险评分值与相应删失评分值的关系图将有助于确定是否存在相依删失。具体来说，如果这两个评分存在关联，则表明存在相依删失。我们现在引入一个参数 \\(\\phi\\) 来度量 \\(T\\) 与 \\(C\\) 之间的依赖程度。当 \\(\\phi = 0\\) 时，删失与生存时间无关，但随着 \\(\\phi\\) 的增加，删失变得更加依赖生存时间。事实上，\\(\\phi\\) 是 \\(T\\) 和 \\(C\\) 之间相关性的上界。现在令 \\(\\hat{\\boldsymbol{\\eta}}(\\boldsymbol{x}_0)\\) 表示个体的风险评分，其中 \\(\\boldsymbol x_0\\) 是模型中解释变量的值向量，并令 \\(\\hat{\\eta}_\\phi(\\boldsymbol{x}_0)\\) 为该个体的风险评分，其中使用 \\(\\phi\\) 来度量生存时间和删失时间之间的关联。然后可以证明，在假定的 Weibull 模型中，失效时间和删失变量时间之间存在较小依赖性 \\(\\phi\\) 时，风险评分变化的近似值由下式给出\\[\\begin{align}\nB(\\boldsymbol{x}_0)=\\hat{\\eta}_\\phi(\\boldsymbol{x}_0)-\\hat{\\eta}(\\boldsymbol{x}_0)=\\phi\\frac{\\sum_{=1}^n\\{\\hat{\\lambda}_ce^{\\hat{\\boldsymbol{\\beta}}_c^{\\prime}}\\boldsymbol{x}_0t_i^{\\hat{\\gamma}+\\hat{\\gamma}_c}-(1-\\delta_i)t_i^{\\hat{\\gamma}}\\}}{\\sum_{=1}^nt_i^{\\hat{\\gamma}}}\n\\tag{14.1}\n\\end{align}\\]其中，\\(\\delta_i\\) 是第 \\(\\) 个个体的事件指示符，对于删失观测为 0，否则为 1.敏感性指数 (sensitivity index) \\(B(\\boldsymbol{x}_0)\\) 仅通过删失评分 \\(\\hat{\\boldsymbol{\\beta}}_c^{\\prime}\\boldsymbol{x}_0\\) 取决于解释变量的值，并且式 (14.1) 表明，当删失风险最大时，风险评分对相依删失最为敏感。对于 \\(\\phi\\) 的给定值，\\(B(\\boldsymbol{x}_0)\\) 关于删失评分 \\(\\hat{\\boldsymbol{\\beta}}_c^{\\prime}\\boldsymbol{x}_0\\) 一系列值的图形，提供了风险评分对相依删失敏感性的信息。通常，\\(\\phi\\) 取值范围选为 \\((−0.3, 0.3)\\)。该图将指示可能导致相依删失对风险评分产生不可忽略的影响的删失评分的值。我们还可以考察其他总结统计量对相依删失的敏感性，例如生存率和中位生存时间。对于 Weibull 比例风险模型，第 \\(\\) 个个体在时间 \\(t\\) 的生存函数估计为\\[\\hat{S}_i(t)=\\{\\hat{S}_0(t)\\}\\mathrm{exp}(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol x_i)\\]其中，\\(\\hat{S}_0(t)=\\hat{\\lambda}t^{\\hat{\\gamma}}\\) 是基线生存函数估计。使用式 (14.1)，当存在相依删失时，生存函数估计近似于\\[\\{\\hat{S}_0(t)\\}^{\\exp\\{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i+B(\\boldsymbol{x}_i)\\}}\\]对于给定的 \\(\\phi\\) 值，可以从中确定相依删失对生存率的影响。同样，Weibull 模型中解释变量向量为 \\(\\boldsymbol x_i\\) 的个体的中位生存时间估计为\\[\\hat{t}(50)=\\left\\{\\frac{\\log2}{\\hat{\\lambda}\\exp(\\hat{\\boldsymbol{\\beta}}'\\boldsymbol{x}_i)}\\right\\}^{1/\\hat{\\gamma}}\\]再次使用式 (14.1)，当生存时间和删失时间之间存在一定程度的依赖性时，中位数估计为\\[\\hat{t}_\\phi(50)=\\left\\{\\frac{\\log2}{\\hat\\lambda\\exp[\\hat\\beta^{\\prime}\\boldsymbol{x}_i+B(\\boldsymbol{x}_i)]}\\right\\}^{1/\\hat\\gamma}\\]对于 \\(\\phi\\) 的某个值，该个体中位生存时间相对减小的近似值为\\[\\begin{align}\n\\frac{\\hat{t}(50)-\\hat{t}_\\phi(50)}{\\hat{t}(50)}&=1-\\exp\\{-\\hat{\\gamma}^{-1}B(\\boldsymbol{x}_i)\\}\n\\tag{14.2}\n\\end{align}\\]该量与删失评分 \\(\\hat{\\boldsymbol{\\beta}}_c^{\\prime}\\boldsymbol{x}_i\\) 一系列可能值的关系图，显示了具有不同删失评分的个体的中位生存时间如何受到相依删失的影响。使用一系列不同的 \\(\\phi\\) 值，还可以探索中位生存时间估计对不同程度的相依删失的稳健性。","code":""},{"path":"chap14.html","id":"sec14-2-2","chapter":"第 14 章 相依删失","heading":"14.2.2 相依删失的影响","text":"在独立删失的情况下，删失的个体代表了删失时面临风险的个体，事件时间数据的标准分析得到的风险比和生存函数的估计将是无偏的。另一方面，如果存在相依删失，但假定它是独立的，则基于模型的估计可能是有偏的。这种偏差的方向取决于事件发生时间与删失变量时间之间是正相关还是负相关。如果这两个变量之间存在正相关，那么预期那些事件时间删失的个体的实际事件时间会比那些仍处于风险中的个体短。类似地，如果存在负相关，则事件时间删失的个体可能是那些原本会在更长时间后才发生感兴趣事件的个体。那么，生存分析的标准方法将分别导致对生存函数的高估或低估，并且偏差的程度将随着相依删失观测数的增加而趋于增加。示例 14.1  (等待肝移植的死亡时间) 一旦患者被判定需接受肝移植手术，他们就会列入登记名单。然而，全国范围内的肝脏短缺意味着患者可能需要等待一段时间才能接受手术，有许多人在等待过程中去世。在一项旨在确定登记接受肝移植手术患者的死亡率以及某些因素对这一结局变量的影响的研究中，研究人员从 UK Transplant Registry 获取了患者从登记到死亡的时间数据。该研究队列包括 281 名原发性胆汁性肝硬化的成年患者。这种疾病主要影响女性，其特征是肝脏内小胆管进行性破坏，导致胆汁在肝脏内积聚、肝脏组织损伤和肝硬化。这些患者在 2006 年 1 月 1 日起的五年内首次登记进行肝移植，感兴趣的响应变量是从登记接受肝移植手术到死亡的时间。对于接受移植手术的患者，从注册到移植的时间视为删失时间。当患者因病情恶化到无法再进行移植手术而从名单上移除时，其时间视为死亡时间。除了列出的生存时间外，还提供了患者的年龄（岁）和性别（男性 = 1，女性 = 0）、体重指数 (BMI, kg/m2) 以及英国终末期肝病 (UK end-stage liver disease, UKELD) 评分，这是一种疾病严重程度的指标，值越高对应的疾病越严重。表 14.1 给出了该数据集中的前 20 个观测，其中对于等待移植期间死亡的患者，状态变量为 1；当其登记时间删失时，状态变量为 0. 数据已按生存时间排序。\n肝脏通常按需分配，往往会提供给病情较重的患者。因此，接受移植的患者往往是那些更接近死亡的人。删失时间将与死亡时间相关，因此从登记到移植的时间取决于从登记到死亡且未进行移植的时间。为了说明 14.2.1 节描述的敏感性分析，考虑时间 \\(t\\) 时死亡风险的 Weibull 模型，其中解释变量包含表示肝脏登记名单上患者的年龄、性别、BMI 和 UKELD 值。从对数累积风险图来看，Weibull 分布对未调整的生存时间拟合得很好。考虑相同的四个解释变量，Weibull 分布对删失时间也拟合得很好。从这些拟合的模型中，可以获得 281 名患者的风险评分 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 和删失评分 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}_c\\boldsymbol{x}_i\\)。每个患者的风险评分关于删失评分的图形示于图 14.1 中。该图表明，风险评分与删失评分呈正相关，因此死亡风险较大的个体，即风险评分较高的个体，更有可能删失。这表明该数据集存在相依删失。\n为了探索这种相依删失如何影响中位生存时间，使用式 (14.2)，对于一个适中的 \\(\\phi\\) 值，获得了中位生存时间的相对变化。即，取 \\(\\phi=0.3\\)（这对应于适中的相依删失程度），中位生存时间相对减少百分比关于取值在 \\((1.5,3)\\) 范围内的 \\(\\hat{\\boldsymbol{\\beta}}_c^{\\prime}\\boldsymbol{x}_i\\) 的图形，如图 14.2 所示。\n该图表明，当删失评分约为 1.5 时，中位生存时间的相对减少才接近于零，这对应于删失风险最低的个体，即移植机会最小的个体。另一方面，对于删失评分为 2.2 的个体（接近数据集中 281 名患者的平均删失评分），相依删失可能会使中位数降低约 30%. 对于那些面临最大删失风险（删失评分至少为 3.0）的人，中位数降低百分比大于 50%29. 因此，基于独立删失假设的分析可能会产生严重误导。下一节将描述一种在生存数据建模中考虑相依删失的技术。","code":""},{"path":"chap14.html","id":"sec14-3","chapter":"第 14 章 相依删失","heading":"14.3 相依删失建模","text":"在存在相依删失的情况下，必须修改生存数据分析的标准方法。当删失没有在患者时间过早发生时，分析到任何删失发生之前的时间的生存率可能是有用的。或者，可以使用第 11 章 11.1.1 节中描述的方法对超过此时间的生存概率进行建模。但是，当相依删失发生在研究早期时，这种方法不太可能有用。更好的方法是使用直接考虑相依删失的 Cox 回归模型来分析生存数据。","code":""},{"path":"chap14.html","id":"sec14-3-1","chapter":"第 14 章 相依删失","heading":"14.3.1 相依删失的 Cox 回归模型","text":"假设对 \\(n\\) 个个体的事件时间数据预期采用 Cox 回归模型，其中一些时间可能会删失，因此第 \\(\\) 个个体在时间 \\(t\\) 的事件风险为\\[h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\]其中 \\(\\boldsymbol x_i\\) 是 \\(p\\) 个解释变量的值向量，\\(\\boldsymbol\\beta\\) 是它们的系数向量，\\(h_0(t)\\) 是基线风险函数。为在拟合该模型时考虑相依删失，我们首先开发一个删失生存时间的模型。然后将其用于在拟合 Cox 回归模型过程中，为观测生存时间对偏似然函数的贡献进行加权。为了总结这项技术的基本思想，考虑第 \\(\\) 个个体在事件时间 \\(t\\) 处于风险中。假设该个体的生存时间在时间 \\(t\\) 或之后删失的概率是 \\(1/3\\)。这意味着，平均而言，还有两个解释变量与该个体相同的个体，他们的生存时间会在时间 \\(t\\) 之前删失。如果他们的生存时间没有删失，他们将至少存活到 \\(t\\)，就像第 \\(\\) 个个体一样。如果这三个个体都存活到 \\(t\\) 而未删失，那么每个个体在时间 \\(t\\) 对偏似然函数的贡献都是相同的。这可以通过将事件时间 \\(t\\) 处第 \\(\\) 个个体对偏似然的贡献赋予权重 \\(3\\)（删失概率的倒数）来建模。该过程得到了模型未知参数的逆概率删失加权 (Inverse Probability Censoring Weighted, IPCW) 估计。该加权过程的效果是，对在 \\(t\\) 之前具有较大删失概率的个体赋予更大的权重，因此这解释了与生存时间相关的删失。为了计算用于调整相依删失的权重，需要一个模型来描述时间 \\(t\\) 或之后的删失概率对解释变量值的依赖性。这是通过将删失时间视为终点、将实际事件时间视为删失观测，对删失观测数据进行建模获得的。如果数据包括事件指示符 \\(\\delta\\)，即对于事件其值为一、对于删失观测其值为零，则删失时间的相应指示变量为 \\(1−\\delta\\)。为删失生存时间拟合生存模型，得到的基线生存函数估计 \\(\\hat{S}_{c0}(t)\\)。由此，第 \\(\\) 个个体（其解释变量的值向量为 \\(\\boldsymbol x_i\\)）在时间 \\(t\\) 或之后发生删失的概率为\\[\\begin{align}\n\\hat{S}_{ci}(t)=[\\hat{S}_{c0}(t)]^{\\exp(\\boldsymbol{\\hat{\\beta}}_{c}^{\\prime}\\boldsymbol{x}_{})}\n\\tag{14.3}\n\\end{align}\\]其中 \\(\\hat{\\boldsymbol{\\beta}}_c\\) 是删失模型中解释变量的系数向量估计。第 \\(\\) 个个体在时间 \\(t\\) 处的权重为 \\(w_i(t)=\\{\\hat{S}_{ci}(t)\\}^{-1}\\)，然后使用这些权重来拟合事件时间的 Cox 回归模型。通过将 Cox 回归模型重新表述为计数过程以得到加权偏似然函数。根据第 13 章式 (13.2) 给出的公式的扩展以纳入权重 \\(w_i(t)\\)，该似然函数为\\[\\begin{align}\n\\prod_{=1}^n\\prod_{\\begin{array}{c}t\\geqslant0\\\\\\end{array}}\\left\\{\\frac{w_i(t)Y_i(t)\\exp\\{\\boldsymbol{\\beta^{\\prime}x}_i\\}}{\\sum_{l=1}^nw_l(t)Y_l(t)\\exp\\{\\boldsymbol{\\beta^{\\prime}x}_l\\}}\\right\\}^{{\\mathrm{d}N_i(t)}}\n\\tag{14.4}\n\\end{align}\\]其中，若个体在时间 \\(t\\) 处于风险，则 \\(Y_i(t) = 1\\)，否则为 0；如果事件在时间 \\(t\\) 发生，则 \\({\\mathrm{d}N_i(t)}=1\\)，否则为 0，并且内部的乘积运算关于所有事件时间进行。该模型也可以纳入时变解释变量。使用式 (14.3) 获得的权重取决于删失模型中的解释变量，在每个事件时间具有不同的值，并且其值在个体随访期内会发生变化。因此，使用参数模型对删失时间进行建模更加方便，因为权重是 \\(t\\) 的连续函数。所选模型的精确形式并不那么重要，建议一般使用 Weibull 模型。第 \\(\\)个个体在 \\(t\\) 时刻的删失风险为 \\(h_{ci}(t)=\\exp(\\boldsymbol{\\beta'}_c\\boldsymbol{x}_i)h_{c0}(t)\\)，其中 \\(h_{c0}(t)=\\lambda_{c}\\gamma_{c}t^{\\gamma_{c}-1}\\)，\\(\\boldsymbol x_i\\) 是删失模型中第 \\(\\) 个个体解释变量的值向量。相应的生存函数为\\[\\begin{aligned}S_{ci}(t)=\\exp\\{-\\lambda_c\\exp(\\boldsymbol{\\beta}'_c\\boldsymbol{x}_i)t^{\\gamma_c}\\}\\end{aligned}\\]注意，删失生存时间模型中的变量不必与生存时间模型中的变量相同。根据第 5 章 5.6.3 节中描述的 Weeibull 模型的对数线性公式\\[\\begin{align}\nS_{ci}(t)=\\exp\\left\\{-\\exp\\left[\\frac{\\log t-\\mu_c-\\boldsymbol{\\alpha'}_c\\boldsymbol{x}_i}{\\sigma_c}\\right]\\right\\}\n\\tag{14.5}\n\\end{align}\\]其中 \\(\\mu_c\\) 是“截距”，\\(\\sigma_c\\) 是“尺度”，\\(\\alpha_{cj}\\) 是第 \\(j\\) 个解释变量的系数，并且 \\(\\lambda_c=\\exp(-\\mu_c/\\sigma_c),\\gamma_c=1/\\sigma_c,\\beta_{cj}=-\\alpha_{cj}/\\sigma_c\\)，其中 \\(j = 1, 2,...,p\\)。为了处理权重的时依性，需要使用第 13 章 13.1.3 节中描述的 \\((start,stop,status)\\) 表示法以计数过程格式表示数据。停止时间视为数据集中的事件时间。示例 14.2  (相依删失的数据格式) 假设数据集中的前三个有序事件时间为 18, 55 和 73 天。以计数过程格式表示的 73 天的观测生存时间采用区间 \\((0, 18],(18, 55],(55, 73]\\)，其中状态指示符对于前两个区间为 0，对于第三个区间为 1. 如果对 73 天的生存时间是删失的，则第三个区间的状态将为 0. 进一步假设在 18, 55 和 73 天或之后的基于模型的删失概率分别为 0.94, 0.82 和 0.75（这是使用删失生存时间的模型获得的）。那么，基于计数过程格式，在为数据拟合 Cox 回归模型时所使用的权重分别为 1.064, 1.220 和 1.333.当删失超过 \\(t\\) 的概率很小时，根据式 (14.3) 计算的权重 \\(w_i(t)\\) 可能会相当大，这可能会导致计算问题。那么，使用稳定权重 (stabilised weights) \\(w^*_i (t)\\) 会更有效，该权重计算为 \\(w_i^*(t)=\\hat{S}_{KM}(t)/\\hat{S}_{ci}(t)\\)，其中 \\(\\hat{S}_{KM}(t)\\) 是在 \\(t\\) 之后删失的概率的 Kaplan-Meier 估计。在权重分子中使用项 \\(\\hat{S}_{KM}(t)\\) 对参数估计没有影响，因为 \\(\\hat{S}_{KM}(t)\\) 独立于模型中的解释变量，并在式 (14.4) 中偏似然函数的分子和分母中抵消。然而，它确实会提高模型拟合过程的稳定性。最后，为了解释模型指定中额外的不确定性，建议采用参数估计的方差-协方差矩阵的稳健估计，如第 13 章 13.1.4 节中介绍的三明治估计。示例 14.3  (等待肝移植的死亡时间) \n现在我们使用一种可考虑任何相依删失的建模方法，对示例 14.1 中从注册到接受肝移植的生存时间数据进行分析。为了对删失概率建模，我们对从登记到删失的时间拟合了一个 Weibull 模型，其中当表 14.1 中的状态变量为 1 时，删失指示符为 0，反之亦然。使用 Weibull 模型的对数线性公式，在时间 \\(t\\) 或之后删失的概率估计为\\[\\begin{align}\n\\hat{S}_{ci}(t)=\\exp\\left\\{-\\exp\\left[\\frac{\\log t-\\hat{\\mu}_c-\\hat{\\alpha}_{c1}x_{1i}-\\hat{\\alpha}_{c2}x_{2i}-\\hat{\\alpha}_{c3}x_{3i}-\\hat{\\alpha}_{c4}x_{4i}}{\\hat{\\sigma}_c}\\right]\\right\\}\n\\tag{14.6}\n\\end{align}\\]其中 \\(x_{1i}\\) 是年龄，\\(x_{2i}\\) 是性别，\\(x_{3i}\\) 是 BMI，\\(x_{4i}\\) 是第 \\(\\) 个患者登记时的 UKELD 评分。该模型的参数估计及其标准误如表 14.2 所示。在这个阶段，可以通过排除对删失概率没有显著影响的变量（即年龄、性别和 BMI）来修改模型，但我们将继续使用包含所有四个变量的删失模型。\n接下来，将表 14.1 中的数据以计数过程格式表示，并且权重是“停止”时间的删失概率的倒数（即式 (14.6) 中的删失概率估计的逆）计算得出的。表 14.1 中前 10 名患者的数据以计数过程格式显示在表 14.3 中，还包含为生存时间拟合 Cox 回归模型的删失概率和权重。\n然后拟合包含相同四个解释变量的加权 Cox 回归模型，则第 \\(\\) 个患者在时间 \\(t\\) 的死亡风险估计为\\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\hat{\\beta}_3x_{3i}+\\hat{\\beta}_4x_{4i}\\}\\hat{h}_0(t)\\end{aligned}\\]其中 \\(\\hat h_0(t)\\) 是基线风险函数估计。考虑相依删失的加权 Cox 回归模型中的参数估计及其标准误如表 14.4 所示。还显示了不考虑相依删失时相应的未加权估计。在这两种情况下都使用了参数估计方差-协方差阵的三明治估计，但这对标准误差的影响很小。\n两组估计有些不同，这表明经相依删失的调整影响了风险比的估计。在未加权分析中，年龄和 UKELD 评分均非常显著（\\(P < 0.001\\)），而在加权分析中，年龄不再显著。根据经相依删失调整的 UKELD 的风险比，UKELD 每增加一个单位，死亡风险就会增加 17%.为了说明相依删失调整的效果，图 14.3 显示了一名 50 岁、UKELD 评分为 60、BMI 为 25 的女性患者的生存函数估计，来自死亡风险的加权和未加权 Cox 回归模型。\n该图显示，如果不考虑相依删失，生存率会被高估。具体来说，如果不考虑相依删失，六个月的生存率估计为 77%，但考虑相依删失后，估计为 65%. 此外，80% 的生存率被高估了近两个月。因此，如果不考虑相依删失，可能会得出对等待肝移植患者的等待名单死亡率的误导性估计。对于本分析的扩展，我们可以分别针对不同的删失原因建立模型，具体包括移植和因病情恶化而从登记名单中移除的情况，以及任何独立的删失情况。此外，还可以将 UKELD 评分随时间的变化纳入模型，以便考虑到登记期间疾病严重程度的变化。","code":""},{"path":"chap14.html","id":"sec14-4","chapter":"第 14 章 相依删失","heading":"14.4 延伸阅读","text":"许多作者都讨论了存在相依删失时生存函数的界，包括 Peterson (1976), Slud Rubinstein (1983) 以及 Klein Moeschberger (1988). Tsiatis (1975) 解释了为什么无法根据观测数据来估计事件时间和删失时间之间的关联程度，Siannis (2004) 和 Siannis, Copas Lu (2005) 描述了用于确定参数模型中推断对相依删失的敏感性的方法，该方法已扩展到 Siannis（2011）中的 Cox 比例风险模型，尽管该方法计算起来非常复杂。Wu Carroll (1988) 以及 Schlucter (1992) 描述了具有相依删失数据的模型。Robins Rotnitzky (1992) 以及 Robins (1993) 引入了逆概率删失加权。Robins Finkelstein (2000) 展示了如何使用这些估计来调整 Kaplan-Meier 估计以考虑相依删失。Satten, Datta 和 Robins (2001) 以及 Scharfstein Robins (2002) 展示了如何在存在相依删失的情况下估计 Cox 回归模型的生存函数。","code":""},{"path":"chap15.html","id":"chap15","chapter":"第 15 章 生存研究的样本量要求","heading":"第 15 章 生存研究的样本量要求","text":"当感兴趣的响应变量是生存时间时，医学研究计划的设计需要考虑许多方面。这些因素包括研究参与者的纳入和排除标准、研究时间起点和终点的明确定义以及患者随访的持续时间等因素。在临床试验中，还必须指定治疗的规范、将患者分配到治疗组时采用的随机方法以及盲法的使用。还可以考虑研究是否应该基于固定数量的患者，或者是否应该采用序贯设计 (sequential analysis)，在这种设计中，研究将持续进行，直到有足够数量的事件能够区分不同的治疗。还需要讨论是否需要进行中期分析或适应性设计，以允许在数据积累时对样本量或治疗的分配进行有计划的修改。其中许多考虑因素并不是以生存为关注结局的研究所独有的，并且在许多有关临床试验设计和分析的文本中进行了讨论，例如 Friedman, Furberg DeMets (2010), Matthews (2006) 和 Pocock (1983). 然而，这里将讨论固定样本量研究设计中的一个问题。这是生存研究中所需患者数量的关键问题。如果招募的患者太少，数据中的信息可能不足以使治疗差异显著。另一方面，在不必要的大型研究中浪费资源也是不道德的。本章将介绍生存数据的样本量计算。","code":""},{"path":"chap15.html","id":"sec15-1","chapter":"第 15 章 生存研究的样本量要求","heading":"15.1 区分两个治疗组","text":"许多生存研究都关注区分两种替代疗法。因此，本章的重点将是一项对接受新疗法的患者与接受标准疗法的患者的生存时间进行比较的研究。当然，同样的公式也可用于其他情况和其他终点。假设有两组患者，标准疗法分配给第一组患者，而新疗法分配给第二组患者。假定生存时间的比例风险模型，新疗法患者在时间 \\(t\\) 的死亡风险 \\(h_{N}(t)\\) 可以写成\\[\\begin{aligned}h_N(t)=\\psi h_S(t)\\end{aligned}\\]其中，\\(h_S(t)\\) 是标准疗法中患者在 \\(t\\) 时的风险函数，\\(\\psi\\) 是未知的风险比。我们还将 \\(\\theta=\\log\\psi\\) 定义为对数风险比。如果 \\(\\theta\\) 为零，则没有治疗差异。另一方面，负的 \\(\\theta\\) 值表示在新疗法下生存时间更长，而正的 \\(\\theta\\) 值表示患者在标准疗法下生存更长。为检验 \\(\\theta=0\\) 的零假设，可以使用 2.6 节中描述的 log-rank 检验。如 3.14 节所示，这相当于使用在 Cox 回归模型中的等风险零假设的得分检验。在本章中，样本量要求将基于 log-rank 检验统计量，但当设想基于 Cox 回归模型的分析时，也可以使用所提供的公式。在生存研究中，删失的发生意味着通常不可能测量研究中所有患者的实际生存时间。然而，在分析中重要的是实际死亡人数，而不是患者总数。因此，确定研究中患者人数的第一步是计算必须观察到的死亡人数。然后我们再确定所需的患者数量。","code":""},{"path":"chap15.html","id":"sec15-2","chapter":"第 15 章 生存研究的样本量要求","heading":"15.2 计算所需的死亡人数","text":"为了确定研究所需的样本量，我们需要计算所需的病人数量，以确保在真实但未知的对数风险比为 \\(\\theta_R\\) 时，有某种机会宣称 \\(\\theta\\) 与零有显著差异。这里的 \\(\\theta_R\\) 是 \\(\\theta\\) 的参考值 (reference value). 它将通过显著性检验来反映治疗差异的程度，这是我们所关心的30。在比较新疗法与标准疗法的研究中，可能存在一个最小的值得改进 (minimum worthwhile improvement) 和一个最大的预期改进 (maximum envisaged improvement). \\(\\theta_R\\) 的实际选择将介于这两个值之间。在实践中，\\(\\theta_R\\) 的选择可能基于期望的风险比、需检出的中位生存期变化，或者在给定时间的生存概率的差异。这将在后面的示例 15.1 中进行讨论和说明。更正式地说，所需的死亡人数取为，当实际 \\(\\theta = \\theta_R\\) 时，使用具有指定显著性水平 \\(\\alpha\\) 的假设检验，有 \\(1 − \\beta\\) 的概率宣称观测对数风险比与零显著不同。项 \\(1 − \\beta\\) 表示当原假设实际为假时拒绝它的概率，称为检验的功效 (power). \\(\\beta\\) 表示当原假设为假时未拒绝它的概率，有时称为第 II 类错误 (type II error). \\(\\alpha\\) 和 \\(\\beta\\) 都取较小的值。典型的值为 \\(\\alpha = 0.05\\) 和 \\(\\beta = 0.1\\)，此时，有 90% 的机会在 5% 的水平上宣称两种治疗之间存在显著差异。\\(\\alpha\\) 和 \\(\\beta\\) 的具体指定在一定程度上取决于具体情况。如果在较低的显著性水平上检出显著的差异很重要，或者如果需要更高的机会宣称显著的结果，则需要相应地修改 \\(\\alpha\\) 和 \\(\\beta\\)。生存研究中所需的死亡人数 \\(d\\) 可通过下式计算\\[\\begin{align}\nd=\\frac{4(z_{\\alpha/2}+z_\\beta)^2}{\\theta_R^2}\n\\tag{15.1}\n\\end{align}\\]其中 \\(z_{\\alpha/2}\\) 和 \\(z_\\beta\\) 分别为标准正态分布的上 \\(\\alpha/2\\) 分位点和上 \\(\\beta\\) 分位点。方便起见，记 \\((\\alpha,\\beta)=(z_{\\alpha/2}+z_\\beta)^2\\)，式 (15.1) 得变为\\[\\begin{align}\nd=4c(\\alpha,\\beta)/\\theta_R^2\n\\tag{15.2}\n\\end{align}\\]表 15.1 给出了显著性水平 \\(\\alpha\\) 和功效 \\(1−\\beta\\) 的常用值的 \\(c(\\alpha, \\beta)\\) 值。\n计算所需的死亡人数需要确定 \\(\\theta_R\\) 的值，并选择适当的 \\(\\alpha\\) 和 \\(\\beta\\) 值。然后将表 15.1 与式 (15.2) 结合使用，给出研究中所需的死亡人数。式 (15.2) 中结果的推导假定了每个治疗组有相同数量的个体。如果情况并非如此，则必须进行修改。具体来说，如果分配到 Group 的个体比例为 \\(\\pi\\)，则分配到 Group II 的比例为 \\(1 − \\pi\\)，则所需的死亡总数为\\[d=\\frac{c(\\alpha,\\beta)}{\\pi(1-\\pi)\\theta_R^2}\\]请注意，两个治疗组中个体数量的不均衡将增加所需死亡总数。此外，推导过程中还涉及一次近似，这意味着计算出的死亡人数可能被低估。因此，建议对计算出的值进行明智的向上取整，以弥补这一低估。所需死亡人数公式的实际推导非常重要，因此下面 15.2.1 节给出了详细信息，可以省略而不失连续性。然后说明了一个计算示例。","code":""},{"path":"chap15.html","id":"sec15-2-1","chapter":"第 15 章 生存研究的样本量要求","heading":"15.2.1 所需死亡人数的推导","text":"现在根据 log-rank 检验得出用于比较两个治疗组所需死亡人数的表达式。如 2.6 节所述，假设研究中的个体中有 \\(r\\) 个不同的死亡时间，\\(t_{(1)}<t_{(2)}<\\cdots<t_{(r)}\\)，并且在第 \\((=1,2)\\) 组第 \\(j(j=1,2,\\ldots,r)\\) 个有序死亡时间 \\(t_{(j)}\\) 有 \\(d_{ij}\\) 个死亡。还假设第 \\(\\) 组中 \\(t_{(j)}\\) 时处于的风险人数为 \\(n_{ij}\\) ，\\(t_{(j)}\\) 处的风险总数记作 \\(n_j = n_{1j} +n_{2j}\\) ，\\(t_{(j)}\\) 处的死亡人数记作 \\(d_j = d_{1j} + d_{2j}\\)。那么 log-rank 统计量为\\[\\begin{aligned}U&=\\sum_{j=1}^r(d_{1j}-e_{1j})\\end{aligned}\\]其中，\\(e_{1j}\\) 是 \\(t_{(j)}\\) 时 Group 的预期死亡数，由 \\(e_{1j}=n_{1j}d_j/n_j\\) 给出，log-rank 统计量的方差为\\[\\begin{align}\nV&=\\sum_{j=1}^r\\frac{n_{1j}n_{2j}d_j(n_j-d_j)}{n_j^2(n_j-1)}\n\\tag{15.3}\n\\end{align}\\]当使用 log-rank 检验时，如果 \\(U\\) 的绝对值足够大，即如果 \\(|U|>k\\)，其中 \\(k\\) 为某个正的常数，则拒绝 \\(\\theta=0\\) 的零假设。因此，对于功效为 \\(1−\\beta\\) 的双侧 \\(100\\alpha\\%\\) 显著性检验，我们要求\\[\\begin{align}\n\\mathrm{P}(|U|>k;\\theta=0)=\\alpha\n\\tag{15.4}\n\\end{align}\\]以及\\[\\mathrm{P}(|U|>k;\\theta=\\theta_R)=1-\\beta\\]我们现在不加证明地引用 Sellke Siegmund (1983) 中的一个结果，根据该结果，对于较小的 \\(\\theta\\) 值，log-rank 统计量 \\(U\\) 具有均值 \\(\\theta V\\) 和方差为 \\(V\\) 的近似正态分布。事实上，在原假设 \\(\\theta = 0\\) 下 \\(U \\sim N(0, V )\\) 这一结果用作 log-rank 检验的基础。那么，由于\\[\\begin{aligned}\\text{P}(|U|>k;\\theta=0)=\\text{P}(U>k;\\theta=0)+\\text{P}(U<-k;\\theta=0)\\end{aligned}\\]以及当 \\(\\theta = 0\\) 时，\\(U\\) 具有 \\(N(0, V )\\) 分布，该分布关于零对称，有\\[\\begin{aligned}\\mathrm{P}(U>k;\\theta=0)=\\mathrm{P}(U<-k;\\theta=0)\\end{aligned}\\]然后根据式 (15.4) 得出\\[\\begin{align}\n\\mathrm{P}(U>k;\\theta=0)=\\frac\\alpha2\n\\tag{15.5}\n\\end{align}\\]接下来，我们注意到，\\[\\begin{aligned}\\mathrm{P}(|U|>k;\\theta=\\theta_R)=\\mathrm{P}(U>k;\\theta=\\theta_R)+\\mathrm{P}(U<-k;\\theta=\\theta_R)\\end{aligned}\\]对于在假设检验中可能使用的 \\(k\\) 值，无论是 \\(\\mathrm{P}(U<-k;\\theta=\\theta_R)\\) 还是 \\(\\mathrm{P}(U>k;\\theta=\\theta_R)\\) 都是可忽略不计的。例如，如果新疗法预期会增大生存率，即认为 \\(\\theta_R\\) 小于零，那么 \\(U\\) 值大于 \\(k(k>0)\\) 的概率将很小。因此，不失一般性，我们取\\[\\mathrm{P}(|U|>k;\\theta=\\theta_R)\\approx\\mathrm{P}(U<-k;\\theta=\\theta_R)\\]现在我们用 \\(z_p\\) 表示标准正态分布的上 \\(100p\\%\\) 分位点。则 \\(\\Phi(z_p)=1−p\\)，其中 \\(\\Phi(\\cdot)\\) 表示标准正态分布函数。因此，量 \\(\\Phi(z_p)\\) 表示在值 \\(z_p\\) 左侧的标准正态密度函数下的面积。现在，由于当 \\(\\theta = 0\\) 时 \\(U \\sim N(0, V )\\)\\[\\begin{aligned}\\mathrm{P}(U>k;\\theta=0)=1-\\mathrm{P}(U\\leqslant k;\\theta=0)=1-\\Phi\\left(\\frac{k}{\\surd(V)}\\right)\\end{aligned}\\]利用式 (15.4)，我们得到\\[\\Phi\\left(\\frac k{√(V)}\\right)=1-(\\alpha/2)\\]因此\\[\\begin{aligned}\\frac k{√(V)}&=z_{\\alpha/2}\\end{aligned}\\]其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点，因此 \\(k\\) 可表示为\\[\\begin{align}\nk=z_{\\alpha/2}√(V)\n\\tag{15.6}\n\\end{align}\\]以类似的方式，由于当 \\(\\theta = \\theta_R\\) 时 \\(U\\sim N(\\theta_RV,V)\\)，有\\[\\begin{aligned}\\mathrm{P}(U<-k;\\theta=\\theta_R)=\\Phi\\left(\\frac{-k-\\theta_RV}{\\surd(V)}\\right)\\approx1-\\beta\\end{aligned}\\]所以我们取\\[\\frac{-k-\\theta_RV}{√(V)}=z_\\beta \\]其中 \\(z_\\beta\\) 是标准正态分布的上 \\(\\beta\\) 分位点。如果我们现在利用式 (15.6) 替换 \\(k\\)，我们得到\\[-z_{\\alpha/2}√(V)-\\theta_RV=z_\\beta√(V)\\]因此 \\(V\\) 需满足\\[\\begin{align}\nV=(z_{\\alpha/2}+z_\\beta)^2/\\theta_R^2\n\\tag{15.7}\n\\end{align}\\]以满足指定的要求。当死亡人数相对于风险人数较少时，式 (15.3) 中 \\(V\\) 的表达式近似为\\[\\begin{align}\n\\sum_{j=1}^r\\frac{n_{1j}n_{2j}d_j}{n_j^2}\n\\tag{15.8}\n\\end{align}\\]此外，如果 \\(\\theta\\) 很小，并且每个治疗组以相似的速度招募入组，那么对于 \\(j=1,2,\\ldots,r\\) 有 \\(n_{1j}\\approx n_{2j}\\)，因此\\[\\begin{aligned}\\frac{n_{1j}n_{2j}}{n_j^2}=\\frac{n_{1j}n_{2j}}{(n_{1j}+n_{2j})^2}\\approx\\frac{n_{1j}^2}{(2n_{1j})^2}=\\frac14\\end{aligned}\\]那么 \\(V\\) 由下式给出\\[V\\approx\\sum_{j=1}^rd_j/4=d/4\\]其中 \\(d=\\sum_{j=1}^rd_j\\) 为研究中个体的死亡总数。最后，使用式 (15.7)，我们现在要求 \\(d\\) 满足\\[\\begin{aligned}\\frac{d}{4}=\\frac{(z_{\\alpha/2}+z_{\\beta})^2}{\\theta_{R}^2}\\end{aligned}\\]这得到了式 (15.1) 所示的所需死亡人数公式。在晚期死亡时间，即式 (15.8) 中的 \\(j\\) 值接近 \\(r\\) 时，两组中处于风险的个体数将会较少。这可能意味着 \\(n_{1j}\\) 和 \\(n_{2j}\\) 在晚期死亡时间将大不相同，因此 \\(n_{1j}n_{2j}/n_j^2\\) 将小于 0.25。这反过来意味着 \\(V < d/4\\)，因此所需的死亡人数往往会低估。示例 15.1  (慢性活动性肝炎的生存) 患有慢性活动性肝炎的患者很快就会因肝功能衰竭而过早死亡。一种新的疗法已经问世，因此计划进行一项临床试验，以评估这种新疗法对该疾病患者生存时间的影响。作为第一步，我们获得了接受标准疗法的年龄相近的患者的生存时间（以年为单位）的信息。由这些数据得到的生存函数的 Kaplan-Meier 估计如图 15.1 所示。\n根据该生存函数估计，中位生存时间为 3.3 年，2 年、4 年和 6 年的生存率分别为 \\(S(2)=0.70,S(4)=0.45\\) 和 \\(S(6)=0.25\\)。新疗法预计可将五年生存率从标准疗法的 0.41 提高到 0.60. 该信息可用于计算 \\(\\theta_R\\) 的值。为此，我们使用以下结果：如果假定风险函数成比例，则在时间 \\(t\\) 接受新疗法的个体的生存函数为\\[\\begin{align}\nS_N(t)=[S_S(t)]^\\psi\n\\tag{15.9}\n\\end{align}\\]其中 \\(S_S(t)\\) 是个体在 \\(t\\) 时接受标准疗法的生存函数，\\(\\psi\\) 是风险比。所以\\[\\psi=\\frac{\\log S_N(t)}{\\log S_S(t)}\\]因此，\\(S(t)\\) 从 0.41 增加到 0.60 对应的 \\(\\psi\\) 值为\\[\\begin{aligned}\\psi_R=\\frac{\\log(0.60)}{\\log(0.41)}=0.57\\end{aligned}\\]有了这个信息，接受新疗法的患者的生存函数为 \\([S_S(t)]^{\\psi_R}\\)，因此 \\(S_N (2) = 0.82,S_N (4) = 0.63\\) 以及 \\(S_N (6) = 0.45\\)。两个生存函数的图形如图 15.2 所示。\n新疗法下的中位生存时间可以根据生存函数的估计来确定。根据图 15.2，新疗法下的中位生存时间估计约为六年。因此，0.57 的风险比意味着中位生存时间从标准疗法的 3.3 年增加到新疗法的 6 年。为计算比较两种疗法的研究所需的死亡人数，我们将取 \\(\\alpha = 0.05\\) 以及 \\(1 − \\beta = 0.90\\)。利用该 \\(\\alpha\\) 和 \\(\\beta\\) 的值，表 15.1 中的函数 \\(c(\\alpha,\\beta)\\) 值为 10.51。将 \\(c(0.05, 0.1)\\) 代入 式 (15.2) 并取 \\(\\theta_R = \\log \\psi_R = \\log(0.57) = −0.562\\)，在 5% 的显著性水平下，为了有 90% 的机会检出 0.57 的风险比具有显著性，所需的死亡人数为\\[\\begin{aligned}d=\\frac{4\\times10.51}{0.562^2}=133\\end{aligned}\\]考虑到低估的可能性，死亡总数可四舍五入为 140 人。这意味着每个治疗组需要观察到大约 70 例死亡。需要检出的治疗差异也可用中位生存时间所期望的绝对或相对变化来表示。然后，通过反转前面的计算，可以得出在式 (15.1) 中使用的相应的对数风险比。例如，假设预期中位生存时间将从标准疗法的 3.3 年增加到新疗法的 5 年。当 \\(t=5\\) 时，新疗法的生存函数为 0.5，使用式 (15.9)，\\(S_N(5)=\\{S_S(5)\\}^{\\psi_R}=0.5\\)。因此，\\(\\psi_R\\log\\{S_S(5)\\}=\\log0.5\\)，并且由于 \\(S_S(5)=0.41\\)，则 \\(\\psi_R=0.78\\)。这反映了与 \\(\\psi_R\\) 取 0.57 时相比，治疗效应不太乐观。如果要以 90% 的把握宣称该风险比在 5% 水平下与 1 显著不同，则需要观察到的相应死亡人数约为 680 人。这远大于将 0.57 的风险比识别为显著结果所需的人数。上述计算只有在研究将持续到一定数量的参与者死亡时，才能直接用于研究。大多数试验的设计都是基于要招募的患者数量，因此我们现在必须研究如何获得该量。","code":""},{"path":"chap15.html","id":"sec15-3","chapter":"第 15 章 生存研究的样本量要求","heading":"15.3 计算所需的患者人数","text":"为了计算生存研究所需的实际患者数量，我们需要考虑研究期间内患者死亡的概率。通常情况下，患者会在长度为 \\(\\) 的入组期 (accrual period) 内入组。招募完成后，还会有一个长度为 \\(f\\) 的随访期 (follow-period). 因此，研究的总时长将是 \\(+ f\\)。请注意，如果 \\(f\\) 很小甚至为零，那么为了获得特定数量的死亡患者，就需要招募相应地更多的患者。一旦评估了研究中患者死亡的概率，就可以根据以下公式得到所需的患者数量\\[\\begin{align}\nn=\\frac{d}{\\text{P}(\\text{死亡})}\n\\tag{15.10}\n\\end{align}\\]其中 \\(d\\) 是根据式 (15.2) 得出的所需死亡人数。根据下一节推导的结果，死亡概率可表示为\\[\\begin{align}\n\\mathrm{P}(\\text{死亡})&=1-\\frac16\\{\\bar{S}(f)+4\\bar{S}(0.5a+f)+\\bar{S}(+f)\\}\n\\tag{15.11}\n\\end{align}\\]其中\\[\\bar{S}(t)=\\frac{S_S(t)+S_N(t)}2\\]\\(S_S(t)\\) 和 \\(S_N (t)\\) 分别是标准疗法和新疗法个体在时间 \\(t\\) 的生存函数估计。上述结果显示了如何计算入组期为 \\(\\)、随访期为 \\(f\\) 的试验所需的患者数量。当然，入组期和随访期的长短取决于招募率 (recruitment rate). 因此，假设招募率预计为 \\(m\\) 名患者/每月，并且需要 \\(d\\) 例死亡。如果在一个月内有 \\(n\\) 名患者参与研究，这意味着每个月需要招募 \\(n/\\) 名患者。在实践中可能会有预期的入组率 (accrual rate) \\(m\\) 的信息。在长度为 \\(\\) 的入组期内招募的人数为 \\(ma\\)，因此研究中的预期死亡人数为\\[ma\\times\\mathrm{P}(\\text{死亡})\\]然后，可以通过数值方法得出使该值接近所需死亡人数的 \\(\\) 和 \\(f\\) 的值，例如，通过尝试不同的 \\(\\) 和 \\(f\\) 值。我们可以利用计算机实现这一算法，并使用优化方法找到 \\(\\) 的值，使得对于一系列 \\(f\\) 的值\\[\\begin{align}\nd-\\{ma\\times\\mathrm{P}(\\text{死亡})\\}\n\\tag{15.12}\n\\end{align}\\]接近于零。或者，可以找到对于一系列 \\(\\) 值使式 (15.12) 成立的 \\(f\\) 值。一张给出不同 \\(\\) 和 \\(f\\) 值组合所需患者数量的双向表对于研究规划将特别有用。以下小节给出了式 (15.11) 中结果的详细推导，并且可以再次省略而不失连续性。","code":""},{"path":"chap15.html","id":"sec15-3-1","chapter":"第 15 章 生存研究的样本量要求","heading":"15.3.1 所需患者人数的推导","text":"我们从分布理论的一般结果开始，即，在研究期间患者死亡的边际概率，可根据死亡以及在时间 \\(t\\) 进入研究的联合概率来获得\\[\\begin{align}\n\\mathrm{P}(\\text{死亡})&=\\int_0^\\mathrm{P}(\\text{死亡且在时间 } t \\text{ 进入研究})\\mathrm{d}t\n\\tag{15.13}\n\\end{align}\\]该联合概率又等于\\[\\begin{align}\n\\mathrm{P}(\\text{死亡且在时间 } t \\text{ 进入研究})&=\\mathrm{P}(\\text{死亡}\\mid\\text{在时间 } t \\text{ 进入研究})\\times\\mathrm{P}(\\text{在时间 } t \\text{ 进入研究})\n\\tag{15.14}\n\\end{align}\\]这仅是 \\(\\text{P}(\\mid B)=\\text{P}(AB)/\\text{P}(B)\\) 这一结果的一个版本。我们现在假定入组期的招募率是均匀的。那么可认为进入研究的时间的分布在时间区间 \\((0,)\\) 上是均匀的。因此，对于区间 \\((0,)\\) 中的任何 \\(t\\) 值，一个个体在时间 \\(t\\) 被招募到研究中的概率为 \\(t^{-1}\\)。根据式 (15.13) 和 (15.14)，我们有\\[\\begin{aligned}\\mathrm{P}(\\text{死亡})&=\\int_0^\\mathrm{P}(\\text{死亡}\\mid\\text{在时间 } t \\text{ 进入研究})\\,^{-1}\\mathrm{d}t\\end{aligned}\\]因此\\[\\begin{aligned}\\text{P}(\\text{死亡})&=1-\\frac1a\\int_0^\\mathrm{P}(\\text{死亡}\\mid\\text{在时间 } t \\text{ 进入研究})\\text{d}t\\end{aligned}\\]在时间 \\(t\\) 进入研究的患者在研究期间存活，即生存时间为 \\(+f\\) 的患者，必须在进入研究后存活 \\(+f−t\\)。因此，条件概率 \\(\\mathrm{P}(\\text{死亡}\\mid\\text{在时间 } t \\text{ 进入研究})\\) 是生存超过 \\(+f−t\\) 的概率。该概率是该个体在 \\(+f−t\\) 处的生存函数值，即 \\(S(+f–t)\\)。因此\\[\\begin{aligned}\\mathrm{P}(\\text{死亡})&=1-\\frac1a\\int_0^(+f-t)\\mathrm{d}t\\end{aligned}\\]令 \\(u=+f−t\\)，上式成为\\[\\begin{align}\n\\mathrm{P}(\\mathrm{死亡})=1-\\frac1a\\int_f^{+f}S(u)\\mathrm{d}u\n\\tag{15.15}\n\\end{align}\\]现在使用数值积分来近似生存函数的积分。根据 Simpson’s rule\\[\\begin{aligned}\\int_u^vf(x)\\mathrm{d}x&\\approx\\frac{v-u}{6}\\left\\{f(u)+4f\\left(\\frac{u+v}{2}\\right)+f(v)\\right\\}\\end{aligned}\\]因此\\[\\begin{aligned}\\int_f^{+f}S(u)\\mathrm{d}u&\\approx\\frac{}{6}\\left\\{S(f)+4S(0.5a+f)+S(+f)\\right\\}\\end{aligned}\\]因此，利用式 (15.15)，研究期间的死亡概率由下式给出\\[\\begin{aligned}\\mathrm{P}(\\mathrm{死亡})&=1-\\frac16\\left\\{S(f)+4S(0.5a+f)+S(+f)\\right\\}\\end{aligned}\\]根据该结果，Group 中生存函数为 \\(S_S(t)\\) 的个体的近似死亡概率为\\[\\begin{aligned}\\text{P}(\\text{死亡; Group })&=1-\\frac{1}{6}\\left\\{S_S(f)+4S_S(0.5a+f)+S_S(+f)\\right\\}\\end{aligned}\\]类似地，对于 Group II 中的个体\\[\\begin{aligned}\\text{P}(\\text{死亡; Group II})&=1-\\frac{1}{6}\\left\\{S_N(f)+4S_N(0.5a+f)+S_N(+f)\\right\\}\\end{aligned}\\]假设一个个体被分配到两个治疗组的概率相等，那么总死亡概率是这两个概率的平均，因此\\[\\begin{aligned}\\text{P}(\\text{死亡})=\\frac{\\text{P}(\\text{死亡};\\text{ Group })+\\text{P}(\\text{死亡};\\text{ Group II})}2\\end{aligned}\\]代入两个治疗组的死亡概率，并令 \\(\\bar{S}(t)=\\{S_S(t)+S_N(t)\\}/2\\) ，总死亡概率可写为\\[\\begin{aligned}\\mathrm{P}(\\mathrm{死亡})=1-\\frac16\\{\\bar{S}(f)+4\\bar{S}(0.5a+f)+\\bar{S}(+f)\\}\\end{aligned}\\]如式 (15.11) 所示。如果分配到 Group 的个体比例为 \\(\\pi\\)，则总死亡概率变为\\[\\pi\\text{ P}(\\text{死亡; Group })+(1-\\pi)\\text{ P}(\\text{死亡; Group II})\\]式 (15.11) 中给出的总死亡概率结果需作相应修改。示例 15.2  (慢性活动性肝炎的生存) 示例 15.1 表明，慢性肝炎研究需要观察 140 例死亡，才能有足够的功效来检测 0.57 的风险比在 5% 的水平上是否显着。假设将在 18 个月的入组期招募患者参加该研究，并且随后有 24 个月的随访期。根据式 (15.11)，研究 42 个月内的死亡概率由下式给出\\[\\mathrm{P}(\\mathrm{死亡})=1-\\frac{1}{6}\\left\\{\\bar{S}(24)+4\\bar{S}(33)+\\bar{S}(42)\\right\\}\\]现在，使用图 15.2 所示的生存函数估计，\\[\\begin{gathered}\n\\bar{S}(24)=\\frac{S_S(24)+S_N(24)}2=\\frac{0.70+0.82}2=0.76 \\\\\n\\bar{S}(33) =\\frac{S_S(33)+S_N(33)}2=\\frac{0.57+0.73}2=0.65 \\\\\n\\bar{S}(42)=\\frac{S_S(42)+S_N(42)}2=\\frac{0.45+0.63}2=0.54\n\\end{gathered}\\]因此死亡概率为\\[\\begin{aligned}1-\\frac16\\{0.76+(4\\times0.65)+0.54\\}&=0.350\\end{aligned}\\]根据式 (15.10)，所需的患者数量为\\[\\begin{aligned}n=\\frac{140}{0.350}=400\\end{aligned}\\]因此，在 18 个月的入组期内需要招募 400 名患者参与该研究。这需要每月约 22 名患者的招募率。如果预计每月仅招募 18 名患者，则需要延长入组期，以确保有足够的人数来提供所需的死亡人数。一个月内可招募的人数为 \\(18a\\)。然后可以尝试各种 \\(\\) 值，以使其近似等于根据式 (15.10) 获得的值。例如，如果我们取 \\(= 24\\) 并继续使用 \\(f = 24\\)，则研究四年内的死亡概率为\\[\\mathrm{P}(\\mathrm{死亡})=1-\\frac16\\{\\bar{S}(24)+4\\bar{S}(36)+\\bar{S}(48)\\}\\]根据图 15.2，可以估计每种治疗的患者在 24, 36 和 48 个月时的生存函数，我们得到 \\(\\bar{S}(24)=0.76,\\bar{S}(36)=0.654\\) 以及 \\(\\bar{S}(48)=0.50\\)。那么死亡的概率为 0.357，而现在所需的死亡人数是 393 人。这与估计的每月 18 人的招募率大体一致。现在假设决定研究没有随访期，因此入组期等于研究的持续时间。如果入组期为 20 个月，则 \\(= 20\\) 且 \\(f = 0\\)，则死亡概率为\\[\\begin{aligned}\\text{P}(\\text{死亡})=1-\\frac{1}{6}\\{\\bar{S}(0)+4\\bar{S}(10)+\\bar{S}(20)\\}\\end{aligned}\\]现在，\\(\\bar{S}(0)=1.00,\\bar{S}(10)=0.82\\) 以及 \\(\\bar{S}(20)=0.79\\)，死亡概率为 0.155. 现在所需的患者数量为 \\(140/0.155 = 903\\)，每月招募 45 名患者就可以满足这一要求。这表明随访期的缺失会增加必须进入研究的患者数量。","code":""},{"path":"chap15.html","id":"sec15-3-2","chapter":"第 15 章 生存研究的样本量要求","heading":"15.3.2 一个近似程序","text":"本节概述了一个更简单的用于计算生存研究中所需患者数量以比较两种治疗方法的程序。此结果的基础为，\\(\\{S_S(\\tau)+S_N(\\tau)\\}/2\\) 是研究中的患者在 \\(\\tau\\) 时间后生存的平均概率，其中 \\(S_S(\\tau)\\) 和 \\(S_N (\\tau)\\) 是时间 \\(\\tau\\) 处生存函数值，分别对应接受标准疗法和新疗法的患者。从时间起点到 \\(\\tau\\) 期间的死亡概率可近似为\\[\\begin{aligned}1-\\frac{S_S(\\tau)+S_N(\\tau)}2\\end{aligned}\\]使用式 (15.10)，所需的患者数成为\\[n=\\frac{2d}{2-S_S(\\tau)-S_N(\\tau)}\\]其中 \\(d\\) 为所需死亡数。此计算中使用的 \\(\\tau\\) 值的自然选择是研究中患者随访期的平均长度 \\(f + (/2)\\)，其中 \\(\\) 是入组期长度，\\(f\\) 是随访期长度。该过程非常近似，因为它没有考虑超出 \\(\\tau\\) 的患者随访时间。因此，该结果往往会高估所需的样本量。示例 15.3  (慢性活动性肝炎的生存) 慢性活动性肝炎的研究现在用于说明确定所需患者人数的近似程序。与示例 15.2 一样，假设在 18 个月的时间内招募患者，并且还有 24 个月的进一步随访期。患者随访期的平均长度为 \\(\\tau=f+(/2)=33\\) 个月。从图 15.2 可以看出，两组患者的生存函数分别为 \\(S_S(33)=0.57\\) 和 \\(S_N(33)=0.73\\)。因此，0 至 33 个月期间的近似死亡概率为 0.35，并且需要造成 140 例死亡的患者人数为 \\(140/0.35=400\\)。在本示例中，由近似结果给出的样本量与示例 15.2 使用的更复杂的程序给出的样本量相同，但通常情况并非如此。","code":""},{"path":"chap15.html","id":"sec15-4","chapter":"第 15 章 生存研究的样本量要求","heading":"15.4 延伸阅读","text":"Friedman, Furberg DeMets (2010), Matthews (2006) 和 Pocock (1983) 以及 Altman (1991) 的更一般的文本中给出了设计临床试验时需要考虑的问题的全部细节。Whitehead (1997) 描述了当感兴趣的结局变量是生存时间时，如何设计序贯临床试验，Jennison Turnbull (2000) 描述了成组序贯法。Machin et al. (2009) 和 Julious (2010) 提供了涉及不同类型响应变量（包括生存时间）的研究所需的样本量要求的详细表格。大多数统计软件包，包括 SAS, R 和 Stata，都具有样本量计算功能。此外，一些商业可用的样本量计算软件包，如 PASS (Power Analysis Sample Size program) 和 nQuery Advisor 也可实现生存研究中所需患者数量的计算。式 (15.1) 中所需死亡人数的公式出现在许多论文中，包括 Bernstein Lagakos (1978), Schoenfeld (1981), Schoenfeld Richter (1982) 以及 Schoenfeld (1983)，尽管结果所基于的假设不同。Bernstein Lagakos (1978) 假设每组的生存时间呈指数分布，得到式 (15.1)。Lachin (1981), Rubinstein, Gail Santner (1981) 以及 Lachin Foulkes (1986) 也讨论了假设生存时间呈指数分布的试验中的样本量要求。另请参见 George 和 Desu (1974) 的早期著作。15.3 节中所需患者数量的公式基于 Schoenfeld (1983). 当假设生存时间为指数时，这些公式简化为 Schoenfeld Richter (1982) 的结果。尽管所得公式更易于使用，但根据生存时间分布的限制性假设进行样本量计算是危险的。Freedman (1982) 给出了所需死亡人数公式的一个变体。Freedman 用 \\(\\{(1+\\psi)/(1-\\psi)\\}^2\\) 代替了式 (15.1) 中的 \\(4/(\\log\\psi)^2\\)。然而，对于较小的 \\(\\log \\psi\\) 值\\[\\{(1+\\psi)/(1-\\psi)\\}^2\\approx4/(\\log\\psi)^2\\]因此这两个表达式往往会给出相似的结果。15.3.2 节中给出的所需患者数量的近似公式也是由 Freedman (1982) 提出的。Lakatos (1988) 提出了一种估计比较两种治疗所需患者数量的方法，该方法可以解决交错进入、不依从、失访和非成比例风险等问题。Lakatos Lan (1992) 表明 Lakatos 程序在各种情况下都表现良好。该方法基于马尔可夫模型，并且需要计算机程序来实现。Latouche, Porcher Chevret (2004) 给出了第 12 章 12.5 节中描述的用于在存在竞争风险的情况下对子分布风险函数进行建模的近似样本量公式。","code":""},{"path":"chap16.html","id":"chap16","chapter":"第 16 章 贝叶斯生存分析","heading":"第 16 章 贝叶斯生存分析","text":"本书中描述的大多数建模技术都是基于构建观测事件时间数据的似然或偏似然函数。然后，在拟合模型的未知参数上最大化该似然函数，以获得风险比等量的估计。然后使用这些估计的标准误构建区间估计并执行假设检验。这种方法将样本数据视为随机变量的观测，并支持所谓的经典统计推断方法。另一种方法是将未知的模型参数视为随机变量。这种方法称为贝叶斯推断 (Bayesian inference)，相关方法现已广泛应用于许多应用领域，包括生物医学科学。本章描述并说明了贝叶斯生存数据建模方法的基本特征。","code":""},{"path":"chap16.html","id":"sec16-1","chapter":"第 16 章 贝叶斯生存分析","heading":"16.1 贝叶斯定理","text":"支撑贝叶斯推断的是一个条件概率定理，即贝叶斯定理 (Bayes’ theorem)，由 Rev. Thomas Bayes 发表于 1763 年。其简单的版本为，事件 发生的概率表达式，以另一个事件 D 发生为条件，由下式给出\\[\\begin{align}\n\\mathrm{P}(\\mid D)=\\mathrm{P}(AD)/\\mathrm{P}(D)\n\\tag{16.1}\n\\end{align}\\]其中 \\(\\text{P}(AD)\\) 是事件 \\(\\) 和 \\(D\\) 发生的联合概率。类似地，给定 \\(\\) 时 \\(D\\) 的条件概率为\\[\\begin{aligned}\\text{P}(D\\mid )=\\text{P}(DA)/\\text{P}()\\end{aligned}\\]将该式中的联合概率 \\(\\text P(DA)\\) 代入式 16.1，我们得到\\[\\begin{align}\n\\mathrm{P}(\\mid D)&=\\frac{\\mathrm{P}(D\\mid )\\mathrm{P}()}{\\mathrm{P}(D)}\n\\tag{16.2}\n\\end{align}\\]现在将该结果扩展到 \\(k\\) 个互斥事件 \\(A_1,A_2,\\ldots,A_k\\) 中的至少一个必然与某个其他事件 \\(D\\) 一起发生的情况。假设 \\(D\\) 已经发生，则这 \\(k\\) 个事件中发生任何一个的条件概率\\[\\begin{aligned}\\mathrm{P}(A_i\\mid D)&=\\frac{\\mathrm{P}(D\\mid A_i)\\mathrm{P}(A_i)}{\\mathrm{P}(D)}\\end{aligned}\\]其中 \\(=1,2,\\ldots,k\\)。事件 \\(D\\) 的总概率是 \\(D\\) 与 \\(k\\) 个事件 \\(A_1,A_2,\\ldots,A_k\\) 中的任何一个同时发生的概率之和，因此分母为\\[\\begin{aligned}\\text{P}(D)=\\sum_{=1}^k\\mathrm{P}(DA_i)=\\sum_{=1}^k\\mathrm{P}(D\\mid A_i)\\text{P}(A_i)\\end{aligned}\\]这个结果意味着条件概率 \\(\\mathrm{P}(A_i\\mid D)\\) 之和为一，那么贝叶斯定理的完整版本为\\[\\begin{align}\n\\mathrm{P}(A_i\\mid D)&=\\frac{\\mathrm{P}(D\\mid A_i)\\mathrm{P}(A_i)}{\\sum_{=1}^k\\mathrm{P}(D\\mid A_i)\\mathrm{P}(A_i)}\n\\tag{16.3}\n\\end{align}\\]该定理为贝叶斯推断方法提供了基础。","code":""},{"path":"chap16.html","id":"sec16-2","chapter":"第 16 章 贝叶斯生存分析","heading":"16.2 贝叶斯推断","text":"在贝叶斯推断中，对式 (16.3) 进行了重新解释，以显示如何将关于未知参数 \\(\\theta\\) 的先验信息与观测数据相结合，从而给出该参数的后验概率分布。当 \\(\\theta\\) 是离散的，它可能取的特定值对应于式 (16.3) 中的事件 \\(A_i\\)。当 \\(\\theta\\) 是连续的，通常情况下，数据外部关于 \\(\\theta\\) 的知识可以总结为先验概率密度函数 \\(\\pi(\\theta)\\)。在生存分析中，数据是 \\(n\\) 个观测生存时间 \\(t_1,t_2,\\ldots,t_n\\)，其中一些可能会删失。将这些数据组装为向量 \\(\\boldsymbol t\\)，并且对应于式 (16.3) 中的事件 \\(D\\)。数据取决于数据生成过程所假定模型中的 \\(\\theta\\) 值，根据该模型构建似然函数 \\(L(\\boldsymbol{t}\\mid\\theta)\\)，对应于式 (16.3) 的 \\(\\mathrm{P}(D\\mid A_i)\\)。将 \\(\\theta\\) 视为连续的，贝叶斯定理分母中的求和替换为在 \\(\\theta\\) 可能值范围内的积分。所得的数据和先验密度的组合是 \\(\\theta\\) 的后验密度函数 \\(\\pi(\\theta\\mid \\boldsymbol t)\\)，因此根据式 (16.3) 中的贝叶斯定理\\[\\pi(\\theta\\mid\\boldsymbol{t})=\\frac{L(\\boldsymbol{t}\\mid\\theta)\\pi(\\theta)}{\\int_\\theta L(\\boldsymbol{t}\\mid\\theta)\\pi(\\theta)}\\]通常，一个模型将取决于多个参数，例如 \\(p\\) 个，将其集合 \\(\\theta_1,\\theta_2,\\ldots,\\theta_p\\) 表示为向量 \\(\\boldsymbol \\theta\\)。给定数据，\\(\\boldsymbol \\theta\\) 的后验密度函数 \\(\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\) 与样本似然函数 \\(L(\\boldsymbol{t}\\mid\\theta)\\) 与 \\(\\boldsymbol \\theta\\) 的先验密度 \\(\\pi\\left(\\boldsymbol{\\theta}\\right)\\) 的乘积成正比，再次根据式 (16.3)\\[\\begin{align}\n\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})=\\frac{L(\\boldsymbol{t}\\mid\\boldsymbol{\\theta})\\pi(\\boldsymbol{\\theta})}{p(\\boldsymbol{t})}\n\\tag{16.4}\n\\end{align}\\]分母 \\(p(\\boldsymbol t)\\) 是一个归一化常数，以确保后验密度 \\(\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\) 积分为 1，同时也是样本数据的边际分布 (marginal distribution)，由下式给出\\[\\begin{aligned}p(\\boldsymbol{t})=\\int_\\boldsymbol{\\theta}L(\\boldsymbol{t}\\mid\\boldsymbol{\\theta})\\pi(\\boldsymbol{\\theta})\\mathrm{d}\\boldsymbol{\\theta}\\end{aligned}\\]这种对未知模型参数可能值的多维积分通常很难计算。然而，我们将在 16.6 节中看到，可以使用数值方法来估计后验分布，从而不需要获得 \\(p(\\boldsymbol{t})\\)。通常，我们对模型中的特定参数感兴趣，而其他参数只是讨厌参数 (nuisance parameters). 例如，在为生存时间拟合 Weibull 模型时，我们可能需要有关部分或全部回归系数或风险比的信息，但不一定需要 Weibull 模型的基础尺度和形状参数。\\(\\theta_j\\)（\\(\\boldsymbol \\theta\\) 中的第 \\(j\\) 个模型参数）的后验边际分布可以通过对其他 \\(p − 1\\) 个参数积分来计算，即\\[\\pi(\\theta_j\\mid\\boldsymbol{t})=\\int_{\\boldsymbol{\\theta}_{(-j)}}\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\mathrm{~d}\\boldsymbol{\\theta}_{(-j)}\\]其中 \\(\\boldsymbol{\\theta}_{(-j)}\\) 表示 \\(\\boldsymbol \\theta\\) 中不包括 \\(\\theta_j\\) 的参数集。在贝叶斯推断中，生存时间假定模型中的参数视为随机变量，并且对这些参数的推断基于它们的后验分布。然后，通过该后验分布可导出贝叶斯点估计、区间估计和假设检验。","code":""},{"path":"chap16.html","id":"sec16-3","chapter":"第 16 章 贝叶斯生存分析","heading":"16.3 生存数据的贝叶斯模型","text":"当可以完全指定似然函数时，可以轻松实现生存数据建模的贝叶斯方法。假设要拟合比例风险模型，其中第 \\((= 1, 2,...,n)\\) 个个体在时间 \\(t\\) 的风险函数和生存函数由下式给出\\[h_i(t)=\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)h_0(t),\\quad\\quad S_i(t)=S_0(t)^{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)}\\]在这些表达式中，\\(\\boldsymbol x_i\\) 是第 \\(\\) 个个体解释变量的值向量，\\(h_0(t)\\) 是基线风险函数，\\(S_0(t)\\) 是根据 \\(S_0(t)=\\exp\\{-H_0(t)\\}\\) 得到的基线生存函数，其中基线累积风险为 \\(H_0(t)=\\int_0^th_0(u)\\mathrm{d}u\\)。在参数模型中，基线风险函数是未知参数的完全指定函数。例如，第 5 章介绍的 Weibull 模型的基线风险取决于形状参数 \\(\\gamma\\) 和尺度参数 \\(\\lambda\\)。因此，拟合参数模型时使用的似然函数取决于参数 \\(\\boldsymbol \\theta\\)，其中包括 \\(\\beta\\) 系数和基线风险中的两个参数。使用第 5 章的式 (5.15)，参数模型的似然函数由下式给出\\[\\begin{align}\nL(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})&=\\prod_{=1}^n\\{h_i(t_i)\\}^{\\delta_i}S_i(t_i)\n\\tag{16.5}\n\\end{align}\\]其中 \\(\\delta_i\\) 是指示变量，当 \\(t_i\\) 发生事件时该变量为 1，否则为 0，\\(h_i(t_i)\\) 和 \\(S_i(t_i)\\) 是在时间 \\(t_i\\) 时的风险函数和生存函数。第 5 章给出了特定模型的风险和生存函数形式的详细信息。那么，式 (16.5) 中的似然可直接用于式 (16.4) 中的后验概率表达式，并与关于模型中未知参数的任何先验知识相结合。此外，任何全参数模型，包括加速失效时间模型、比例几率模型、基于样条函数的灵活模型、区间删失数据模型等，都可以很容易地纳入贝叶斯框架。Cox 回归模型也可以使用贝叶斯方法进行拟合，使用第 3 章 3.3 节描述的、由式 (3.4) 给出的偏似然函数，可代替式 (16.4) 中的 \\(L(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\)。这种似然仅取决于模型中的 \\(\\beta\\) 系数，并且也可以包含关于这些系数的先验信息。一旦获得了模型中未知 \\(\\beta\\) 参数的贝叶斯估计，就可以使用第 3 章 3.10 节中的结果得出基线累积风险和生存函数的估计。这种方法的缺点是它无法包含有关基线风险函数的先验信息。为此，需要针对基线风险本身建立一个模型。假设数据包含 \\(r\\) 个有序事件时间 \\(t_{(1)}<t_{(2)}<\\cdots<t_{(r)}\\)。Cox 回归模型假定相邻事件时间之间存在恒定的基线风险，因此相应的参数模型对于 \\(t_{(j-1)}\\leqslant t<t_{(j)}\\) 将具有 \\(h_0(t) = \\lambda_j\\)，其中 \\(t_{(0)} = 0\\) 且 \\(\\lambda_j > 0,j = 1, 2,...,r\\)。该风险函数在每个时间区间内都是恒定的，并且是第 6 章 6.1 节描述的分段指数模型。比例风险模型的相应似然函数\\[h_i(t)=\\exp(\\eta_i)h_0(t)\\]可根据式 (16.5) 计算，其中 \\(\\eta_i=\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\) 是第 \\(\\) 个个体 \\(p\\) 个解释变量值的线性组合。对于 \\(t_{(j-1)}\\leqslant t<t_{(j)}\\)，其中 \\(j=1,2,\\ldots,r\\)，风险和生存函数可根据 \\(h_i(t)=\\exp(\\eta_i)\\lambda_j\\) 得出，分别为 \\(S_i(t)=\\exp\\{-H_i(t)\\}\\) 和 \\(H_i(t)=\\exp(\\eta_i)H_0(t)\\)，其中基线累积风险由下式给出\\[\\begin{aligned}H_0(t)=\\sum_{j=1}^r\\lambda_j\\Delta_j(t)\\end{aligned}\\]以及\\[\\left.\\Delta_j(t)=\\left\\{\\begin{array}{ll}0&\\quad t<t_{(j-1)}\\\\t-t_{(j-1)}&\\quad t_{(j-1)}\\leqslant t<t_{(j)}\\\\t_{(j)}-t_{(j-1)}&\\quad t\\geqslant t_{(j)}\\end{array}\\right.\\right.\\]对于大型数据集，\\(h_0(t)\\) 中的区间数量和相应的参数数量大得令人望而却步。那么需要定义更宽的区间，在每个区间内假定风险恒定。大多数用于贝叶斯半参数建模的计算机软件采用分段指数基线风险模型，而不是标准的 Cox 模型。","code":""},{"path":"chap16.html","id":"sec16-3-1","chapter":"第 16 章 贝叶斯生存分析","heading":"16.3.1 简单指数模型的贝叶斯版本","text":"在第 5 章的 5.4.1节中，我们展示了为单一样本删失生存数据拟合均值为 \\(\\lambda^{−1}\\) 的指数分布，其中使用了经典的基于似然的方法拟合。现在描述相应的贝叶斯方法。假设观测数据由 \\(n\\) 个指数分布的生存时间 \\(t_1, t_2,...,t_n\\) 的样本组成，其中 \\(r\\) 为个事件时间，其余 \\(n − r\\) 个是右删失的。用指标 \\(\\delta_i\\) 来表示第 \\(\\) 个观测是否为删失的，\\(\\delta_i = 0\\) 对应删失观测，则数据的似然如第 5 章式 (5.16) 所示为\\[\\prod_{=1}^n\\lambda^{\\delta_i}e^{-\\lambda t_i}\\]现在将其写为 \\(L(\\boldsymbol{t}\\mid\\lambda)\\) 以强调这是数据 \\(\\boldsymbol t\\) 在参数为 \\(\\lambda\\) 的指数模型下的似然，因此\\[\\begin{align}\nL(\\boldsymbol{t}\\mid\\lambda)=\\lambda^re^{-\\lambda S}\n\\tag{16.6}\n\\end{align}\\]其中 \\(r=\\sum_{=1}^n\\delta_i\\) 以及 \\(S=\\sum_{=1}^nt_i\\)。贝叶斯推断过程通过制定 \\(\\lambda\\) 的先验分布来进行。由于 \\(\\lambda\\) 必须为正，因此任何先验信息都必须总结在区间 \\((0, \\infty)\\) 中。如果我们对 \\(\\lambda\\) 的可能值有一个很好的了解，我们可以使用以最合理的 \\(\\lambda\\) 值为中心的分布，其范围包含该值。例如，我们可以将先验视为 gamma 分布，其均值等于 \\(\\lambda\\) 的先验估计，其方差之大小取决于我们对该估计的信心。在本例中，我们假设没有关于 \\(\\lambda\\) 的先验知识。根据 16.4 节中的预期结果，\\(\\lambda\\) 的一个合适的先验密度函数 \\(\\pi (\\lambda)\\) 与 \\(\\lambda^{−1}\\) 成正比，我们取 \\(\\pi (\\lambda)=c\\lambda^{−1}\\)。由于常数 \\(c\\) 在式 (16.4) 中后验密度函数的分子和分母中都出现，因此该常数实际上可忽略。给定样本数据的 \\(\\lambda\\) 的后验分布由下式给出\\[\\begin{align}\n\\pi(\\lambda\\mid\\boldsymbol{t})=\\frac{L(\\boldsymbol{t}\\mid\\lambda)\\pi(\\lambda)}{p(\\boldsymbol{t})}\n\\tag{16.7}\n\\end{align}\\]其中\\[\\begin{aligned}p(\\boldsymbol{t})=\\int_0^\\infty L(\\boldsymbol{t}\\mid\\lambda)\\pi(\\lambda)\\mathrm{d}\\lambda\\end{aligned}\\]使用式 (16.6)，式 (16.7) 中的分子为\\[\\begin{align}\nL(\\boldsymbol{t}\\mid\\lambda)\\pi(\\lambda)=\\lambda^{r-1}\\exp(-\\lambda S)\n\\tag{16.8}\n\\end{align}\\]接下来，使用第 5 章式 (5.6) 中定义的 gamma 函数，其中\\[\\begin{aligned}\\Gamma(r)&=\\int_0^\\infty u^{r-1}e^{-u}\\mathrm{d}u\\end{aligned}\\]设 \\(u=\\lambda S\\)，则 \\(\\mathrm{d}u=S\\mathrm{d}\\lambda\\)，式 (16.7) 的分母为\\[p(\\boldsymbol{t})=\\int_0^\\infty\\lambda^{r-1}\\exp(-\\lambda S)\\mathrm{d}\\lambda=\\frac{\\Gamma(r)}{S^r}\\]根据式 (16.7) 和 (16.8)，\\(\\lambda\\) 的后验密度函数由下式给出\\[\\begin{aligned}\\pi(\\lambda\\mid\\boldsymbol{t})=\\frac{\\lambda^{r-1}S^r\\exp(-\\lambda S)}{\\Gamma(r)}\\end{aligned}\\]这是随机变量 \\(\\lambda\\) 的概率密度函数，与第 5 章式 (5.11) 中 gamma 分布的密度比较后表明，\\(\\lambda\\) 具有参数为 \\(r\\) 且 \\(S=\\sum_it_i\\) 的 gamma 后验分布。只要 \\(r > 1\\)，该分布的平均值为 \\(r/S\\)，众数为 \\((r − 1)/S\\)。请注意，\\(\\lambda\\) 后验分布的均值与第 5 章 5.4 节 \\(\\lambda\\) 的最大似然估计导出的相同。当我们使用很少或根本不传达有关未知参数信息的先验分布时，通常会出现这种情况。在这个最简单的模型中，可以获得后验分布的显式形式，以便来自先验信息和数据的有关 \\(\\lambda\\) 的所有信息都可以 gamma 分布的形式传达。然而很少是这种情况，并且通常需要用于获得后验分布的数值方法。示例 16.1  (停用宫内节育器的时间) 在本示例中，使用贝叶斯方法来分析示例 1.1 中关于 18 名妇女的宫内节育器停用时间的数据。具体而言，停用时间将假定为具有均值 \\(\\lambda\\) 的指数分布，因此根据式 (16.6)，样本数据的似然为\\[L(\\boldsymbol{t}\\mid\\lambda)=\\lambda^r\\exp\\{-\\lambda S\\}\\]其中 \\(r\\) 为事件数以及 \\(S=\\sum_{=1}^nt_i\\)。\\(\\lambda\\) 的无信息先验 (non-informative prior) 将与密度 \\(\\pi(\\lambda)\\propto\\lambda^{-1}\\) 一起使用。数据中有 \\(r＝9\\) 个事件时间，所有 18 个停用时间之和为 1046. \\(\\lambda\\) 的后验密度与 \\(\\lambda\\) 的似然和先验密度函数之积成比例，即\\[\\begin{align}\n\\lambda^8\\exp(-1046\\lambda)\n\\tag{16.9}\n\\end{align}\\]在这种情况下，我们可以求出这样一个比例常数，使得该表达式的积分为 1. 正如在 16.3.1 节所述，\\(\\lambda\\) 的后验分布是 gamma 分布，并具有参数 9 和 1046，这意味着\\[\\pi(\\lambda\\mid\\boldsymbol{t})=\\frac{\\lambda^81046^9\\exp(-1046\\lambda)}{\\Gamma(9)}\\]\n其中 \\(\\lambda>0\\)。该后验分布可用于构建贝叶斯点估计、区间估计和假设检验，我们将在 16.5 节返回到这一点。接下来我们更详细地讨论如何指定先验信息。","code":""},{"path":"chap16.html","id":"sec16-4","chapter":"第 16 章 贝叶斯生存分析","heading":"16.4 纳入先验信息","text":"贝叶斯推断要求量化有关未知模型参数的先验信息，以便纳入推断过程。如果此类信息可用，并且可以总结为先验密度函数，则称有关未知模型参数的先验是信息性的 (informative) 另一方面，如果此类先验信息很少或没有，则先验信息分别成为为模糊的 (vague) 或无信息的 (non-informative). 那么先验密度函数将基本上是平坦的。构成向量 \\(\\boldsymbol \\theta\\) 的每个参数 \\(\\theta_1,\\theta_2,\\ldots,\\theta_p\\) 都需要先验分布。当这些先验分布视为彼此独立时，总先验为\\[\\pi(\\boldsymbol{\\theta})=\\pi_1(\\theta_1)\\pi_2(\\theta_2)\\cdots\\pi_p(\\theta_p)\\]其中 \\(\\pi_j (\\theta_j)\\) 是第 \\(j(j=1,2,\\ldots,p)\\) 个参数 \\(\\theta_j\\) 的先验密度。如果不能做出这种独立性假设，则可以将 \\(\\boldsymbol \\theta\\) 视为具有多元分布，例如多元正态分布。然后可以考虑有关各个参数之间的任何相关性的先验信息。虽然这会增加一层复杂性，但在原则上，将 \\(\\boldsymbol \\theta\\) 视为具有多元分布而非 \\(p\\) 个独立单变量先验分布之积，并不存在根本性困难。我们现在依次考虑不同程度的先验信息。","code":""},{"path":"chap16.html","id":"sec16-4-1","chapter":"第 16 章 贝叶斯生存分析","heading":"16.4.1 无信息先验信息","text":"即使没有关于模型未知参数的先验知识，这种知识的欠缺也必须通过无信息性先验密度函数来量化。此类先验分布会对未知参数的所有可能值赋予相似的概率密度，并具有较大的方差。那么，后验分布将由似然的形式主导，因此，由此产生的推断几乎完全由数据所驱动。用于总结参数知识欠缺的先验分布取决于其可能值的范围。对于可以取 \\((−\\infty, \\infty)\\) 范围内任何值的参数，例如生存模型中解释变量的系数，先验密度函数 \\(\\pi (\\theta)\\) 可视为在此范围内恒定。那么，\\(\\theta\\) 具有均匀分布，记为 \\(U(−\\infty, \\infty)\\)。然而，这是一个不适当分布 (improper distribution)，因为该均匀密度函数的积分 \\(\\int_{-\\infty}^{\\infty}\\pi(\\theta)\\mathrm{d}\\theta\\) 是没有定义的。然而，只要式 (16.4) 的分母中的积分是有限的，这就不是问题。对于只能在 \\((0,\\infty)\\) 范围内取正值的参数，例如风险比或尺度参数，可以假定 \\(\\pi(\\theta)\\) 在此范围内为常数。然后可以采用 \\((0,\\infty)\\) 上的均匀先验，尽管这也是不适当先验分布。严格为正的参数 \\(\\theta\\) 意味着 \\(\\log \\theta\\) 定义在 \\((−\\infty, \\infty)\\) 范围内。这表明 \\(\\log \\theta\\) 使用了 \\((−\\infty, \\infty)\\) 上的不适当均匀分布。这对应于 \\(\\theta\\) 在 \\((0,\\infty)\\) 范围内与 \\(1/\\theta\\) 成比例的分布。请注意，通过对 \\(\\theta\\) 或其函数（如 \\(\\log \\theta\\)）的无知的量化，可得到不同的先验分布。有时，对于定义在 \\((0, 1)\\) 上的参数 \\(\\theta\\)（例如概率）需要用到先验分布。此时一个常见的先验选择是 beta 分布的形式，对于 \\(0\\leqslant\\theta\\leqslant1\\) 和选定的 \\(\\alpha\\)，其密度函数与 \\(\\theta^{\\alpha-1}(1-\\theta)^{\\alpha-1}\\) 成正比。该分布的均值为 0.5，方差随 \\(\\alpha\\) 的增加而减小。当 \\(\\alpha=1\\) 时，\\(\\pi(\\theta) = 1\\)，这对应于 \\((0, 1)\\) 上的均匀先验。当 \\(\\alpha=0\\) 时，\\(\\pi(\\theta)\\propto\\theta^{-1}(1-\\theta)^{-1}\\)，这对应于 \\(\\theta\\) 的 logistic 变换，即 \\(\\text{logit}(\\theta) = \\log{\\theta/(1 − \\theta)}\\)，其分布为不适当的 \\(U(−\\infty, \\infty)\\)。这两种无信息先验的选择都具有直观吸引力。以准确且不会引起争议的方式指定先验信息存在困难，再加上人们希望使用对最终推断影响较小或无影响的先验，使得无信息先验被广泛使用。然而，使用平坦的先验分布来表示缺乏先验知识可能会受到批评。例如，假设治疗效应的风险比是一个关键参数。可以使用在 \\((0,\\infty)\\) 上均匀的平坦先验来表达对风险比先验的无知。然而，这意味着我们的先验信息表明，在 0 到 10 范围内的风险比与 1000 到 1010 范围内的风险比一样合理，实际不太可能如此。相比仅使用默认的无信息先验指定，考虑未知参数的可能值范围通常是有价值的，以便可以将其总结为模糊或信息性先验分布。","code":""},{"path":"chap16.html","id":"sec16-4-2","chapter":"第 16 章 贝叶斯生存分析","heading":"16.4.2 模糊先验信息","text":"一个关于参数先验值提供少量信息的分布称为模糊、扩散或弱信息性的 (vague, diffuse weakly-informative). 模糊先验基于是适当但高度扩散的分布，因此它们仍然会被数据淹没。与无信息先验一样，关于 \\(\\theta\\) 的推断将几乎完全基于观测数据。对于可以取 \\((−\\infty, \\infty)\\) 范围内任意值的参数，模糊先验的常见选择是均值为零且方差较大的正态分布 \\(\\sigma^2\\)，记作 \\(N(0, \\sigma^2)\\)。\\(\\sigma^2\\) 需要有多大取决于未知参数的规模，但如果 \\(\\sigma\\) 大于 \\(\\theta\\) 预期最大值的两倍，则会得到非常平坦的先验。事实上，对于适当大的 \\(\\sigma^2\\) 值，正态分布与不适当的 \\(U(−\\infty, \\infty)\\) 分布非常相似。其他常用的其他分布包括具有较小自由度的 \\(t\\) 分布和柯西分布。当然，在 \\(\\theta\\) 的可能值范围内采用除均匀分布之外的任何分布都是在构建少量先验信息，后验分布仍绝大多数将由似然函数主导。关于正值参数 \\(\\theta\\) 的模糊先验知识可以使用 lognormal 分布来指定，该分布等价于 \\(\\log\\theta\\) 的正态分布。通常用于参数模型尺度参数的先验分布为 half-normal 分布。这是通过截断具有零均值的正态分布而形成的，因此它仅在正值有定义。该分布的均值为 \\(\\sigma√(2/\\pi)\\)，方差为 \\(\\sigma^2(1-2\\pi^{-1})\\) ，因此扩散的 half-normal 先验具有较大的 \\(\\sigma^2\\) 值。另一种选择是具有较大方差的 gamma 分布。例如，参数为 \\(r=λ=0.001\\) 的伽玛先验的均值为 1，方差为 1000，这也是一个扩散但适当的先验。尽管不同的先验分布必然会导致不同的后验分布，但就要得出的推断而言，任何此类差异可能没有实际意义。例如，无论对数风险比 \\(\\beta\\) 的无信息先验分布视为在 \\((−∞\\infty, \\infty)\\) 上具有均匀分布，还是具有扩散的正态分布，可能都不会对关于 \\(\\beta\\) 值的推断产生实质性影响。对于较大的数据集尤其如此，但在较小的数据集中可能会有明显差异。正如不适当的先验可能是参数先验知识状态的不切实际的表示一样，模糊先验也会因类似的理由受到批评。具体来说，具有较大方差的正态先验分布仍然可能将较大概率分配给不太可能出现的参数值。例如，假设治疗效应的对数风险比 \\(\\beta\\) 的先验分布为 \\(N(0,10)\\)，意味着 \\(\\beta\\) 有大约 20% 的可能性超出范围 \\((−4,4)\\)，但对于一个相当不可能的值来说，这是相当大的。","code":""},{"path":"chap16.html","id":"sec16-4-3","chapter":"第 16 章 贝叶斯生存分析","heading":"16.4.3 实质的先验信息","text":"当先验信息是实质的 (substantial) 或信息性的 (informative) 时，后验分布可能在很大程度上取决于先验分布的假定形式。因此，必须仔细考虑如何获取先验信息，以确保信息的准确性。有时，模型中一些或所有未知参数的先验信息可从先前的知识中获得。在其他情况下，结合文献检索和专家意见可能会得出合适的数值总结。此外，在当前研究与先前研究相似的情况下，也可以利用先前研究得到的关键参数估计来构建合适的先验分布。通常，信息性先验基于概率分布（例如正态分布或 gamma 分布），具体取决于参数可能值的范围。信息先验可能相当主观，因为对先验的数值指定很可能因人而异。然而，人们可能会同意，对于某个解释变量（例如治疗效应）的风险比，很可能以 1.5 为中心，并且几乎不可能超过 4. 那么，可以构建一个不对称的先验分布，该分布的中位数为 1.5，并且其方差设定得较小，使得效应超过 4 的概率非常低。先验分布的选择总是存在一定程度的随意性，而且人们经常担心后验分布在多大程度上依赖于所做的选择。因此，可以在分析中使用一系列似是而非的先验，并评估后验分布对这些不同选择的敏感性。","code":""},{"path":"chap16.html","id":"sec16-5","chapter":"第 16 章 贝叶斯生存分析","heading":"16.5 总结后验信息","text":"参数 \\(\\theta\\) 的后验分布总结了先验分布中的所有可用信息以及样本数据的似然，因此支撑了关于 \\(\\theta\\) 的推论。现在依次考虑点估计、区间估计和假设检验。","code":""},{"path":"chap16.html","id":"sec16-5-1","chapter":"第 16 章 贝叶斯生存分析","heading":"16.5.1 点估计","text":"θ 最合适的点估计是使后验密度最大化的值，即分布的众数。有时可以通过将后验密度的导数或其对数设为零并求出满足该方程的 \\(\\theta\\) 值来解析获得众数。当该方法不可能时，就需要函数最大化的数值方法。如果后验分布是合理对称的，则后验分布的均值也可以用作位置的点估计。然后，可以方便地用分布的方差或标准差来总结分布的分散或离散 (spread dispersion). 当后验分布不对称时，中位数将是一个更合适的点估计，而一个合适的分散的度量是第 2 章 2.4 节定义的半四分位距。一般而言，中位数或均值是比众数更方便的位置总结。","code":""},{"path":"chap16.html","id":"sec16-5-2","chapter":"第 16 章 贝叶斯生存分析","heading":"16.5.2 区间估计","text":"区间估计通常比点估计更能提供有关参数后验分布的信息。精确的 \\(100(1−\\alpha)\\%\\) 区间估计是指能以预先指定的概率 \\(1−\\alpha\\)31 包含 \\(\\theta\\) 的区间。该区间的下限和上限，\\(\\theta_l\\) 和 \\(\\theta_u\\) 满足\\[\\int_{\\theta_l}^{\\theta_u}\\pi(\\theta\\mid\\boldsymbol{t})\\mathrm{d}\\theta=1-\\alpha\\]其中 \\(\\alpha\\) 适当地小。这通常称为概率区间 (probability interval)，因为它表示 \\(\\theta\\) 位于区间 \\((\\theta_l,\\theta_u)\\) 中的后验概率。将 \\(\\alpha\\) 取为 0.05 或 0.01 会得到 95% 或 99% 概率区间。有许多方法可以定义区间 \\((\\theta_l,\\theta_u)\\)。其中一种是确保后验概率密度在 \\(\\theta_l\\) 和 \\(\\theta_u\\) 处是相等的，使得该区间外的任何 \\(\\theta\\) 值的概率密度都不高于区间内的任何 \\(\\theta\\) 值的概率密度。以这种方式构建的区间称为最高概率密度 (highest probability density, HPD) 区间，并且是在贝叶斯推断中获得区间估计的最自然的方式。HPD 区间通常需要以数值方式获得。概括地说，需要确定满足 \\(\\pi(\\theta\\mid\\boldsymbol{t})=\\phi\\) 的 \\(\\theta\\) 值，其中 \\(\\phi\\) 取一系列值。然后，可根据下式计算出与特定 \\(\\phi\\) 值相关的概率覆盖\\[\\int_\\theta\\pi(\\theta\\mid\\boldsymbol{t})\\mathrm{~d}\\theta \\]其中积分是对满足 \\(\\pi(\\theta\\mid\\boldsymbol{t})>\\phi\\) 的 \\(\\theta\\) 值进行的。这给出了所需 \\(\\alpha\\) 的 \\(\\phi\\) 值，称为 \\(\\phi_\\alpha\\)，那么 HPD 区间的上下限就是使 \\(\\pi(\\theta\\mid\\boldsymbol{t})=\\phi_\\alpha\\) 的 \\(\\theta\\) 值。另一种方法是采用具有等尾面积 (equal tail areas) 的区间。那么，一个 \\(100(1 − \\alpha)%\\) 区间估计在后验分布的两个尾部都具有概率 \\(\\alpha/2\\)。从后验分布的上下 \\(\\alpha/2\\) 分位点可以很容易地得到相应的区间限。以这种方式构建的区间估计称为可信区间 (credible interval)，通常比 HPD 区间更容易获得。这两个区间示于图 16.1.\n在该图中，满足 \\(\\pi(\\theta\\mid\\boldsymbol{t})=\\phi_\\alpha\\) 的 \\(\\theta\\) 值形成了 \\(100(1-\\alpha)\\%\\) 的 HPD 区间 \\((\\theta_l^H,\\theta_u^H)\\)，并且 \\(\\theta\\) 的 \\(100(1−\\alpha)\\%\\) 可信区间为 \\((\\theta_l^C,\\theta_u^C)\\)。请注意，这两个区间非常不同，即使它们具有相同的概率覆盖范围。虽然贝叶斯概率区间等价于经典推断中的置信区间，但它们在解释上有非常重要的区别。置信区间是这样定义的：（随机）区间以预定概率包含未知参数真实（固定）值。然而，概率区间是这样的：随机变量 \\(\\theta\\) 有特定的概率包含在该区间内。此外，贝叶斯概率区间直接根据后验密度函数获得，不需要计算标准误。因此，它们的有效性不依赖于大样本，所以它们也是精确的区间。","code":""},{"path":"chap16.html","id":"sec16-5-3","chapter":"第 16 章 贝叶斯生存分析","heading":"16.5.3 贝叶斯假设检验","text":"假设检验广泛用于经典推断以评估原假设的有效性，与其相关的 \\(P\\) 值被用作度量反对原假设证据强度的指标。如果根据来自数据的证据拒绝原假设，则备择假设将成为任何后续行动的基础。似然比检验通过使用统计量 \\(-2\\log\\hat{L}\\) 来比较替代模型，为生存分析中大多数假设检验的构建奠定了基础。然而，似然比统计量仅具有已知的渐近卡方分布，并且依赖于大样本（即相对较多的事件数）以获得有效性。在贝叶斯方法中，不需要区分零假设和替代假设，我们只需使用概率区间计算 \\(\\theta\\) 具有特定值或值范围的后验概率。这得到了对假设为真的概率的直接和精确的评估。假设 (suppose) 我们假设 (hypothesise) \\(\\theta\\) 具有大于 \\(\\theta_0\\) 的某个值。该概率可使用如下公式从 \\(\\theta\\) 的后验密度 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 求出\\[P(\\theta>\\theta_0)=\\int_{\\theta_0}^\\infty\\pi(\\theta\\mid\\boldsymbol{t})\\mathrm{d}\\theta\\]例如，如果 \\(\\theta\\) 是一个风险比，因此 \\(\\theta>0\\)，我们可以通过简单地计算 \\(\\theta\\) 的后验密度超过 2 的概率来检验风险比大于 2 的假设。示例 16.2  (停用宫内节育器的时间) 在示例 16.1 中，对于宫内节育器停用时间数据，假定 \\(\\lambda\\) 为指数分布的后验分布是具有参数 \\((9,1046)\\) 的 gamma 分布。该分布的众数，即后验密度最高的 \\(\\lambda\\) 的值为 \\(8/1046\\)，即 0.00765. \\(\\lambda\\) 的 95% 概率区间为满足下式的区间 \\((\\lambda_l,\\lambda_u)\\)\\[\\int_{\\lambda_l}^{\\lambda_u}\\pi(\\lambda\\mid\\boldsymbol{t})\\mathrm{d}\\lambda=0.95\\]最高概率密度区间很难获得，因为满足该方程的值 \\(\\lambda_{l},\\lambda_{u}\\) 无法代数地求出。使用数值方法，95% HPD 区间为 \\((0.0035, 0.0143)\\)，这意味着 \\(\\lambda\\) 有 95% 的机会位于该区间内。与之相比，\\(\\lambda\\) 后验分布的下 2.5% 和上 2.5% 分位点更容易求出。从参数为 \\((9, 1046)\\) 的 gamma 分布的分布函数来看，它们是 0.0039 和 0.0151。那么区间 \\((0.0039, 0.0151)\\) 就是 \\(\\lambda\\) 的 95% 可信区间。在此示例中，HPD 和可信区间非常相似，因为 \\(\\lambda\\) 的后验密度函数非常对称。通过如下积分计算 \\(\\lambda\\) 后验概率小于 0.01 的概率，以检验 \\(\\lambda<0.01\\) 的假设\\[\\int_0^{0.01}\\pi(\\lambda\\mid\\boldsymbol{t})\\mathrm{d}\\lambda \\]根据 gamma 分布的分布函数，这是 0.717，因此 \\(\\lambda<\\) 小于 0.01 的概率为 0.72.贝叶斯推断方法可以对未知参数进行点估计和精确区间估计，以及对该参数值的精确假设检验。由于这些结果可以直接以关于参数值的概率陈述形式进行解读，因此这种方法在实践中具有很大的吸引力。","code":""},{"path":"chap16.html","id":"sec16-6","chapter":"第 16 章 贝叶斯生存分析","heading":"16.6 计算后验分布","text":"尽管贝叶斯推断技术具有许多优点，但由于计算机能力的限制，它们并未得到广泛的实际应用。但现在情况已经不同了，用于数值评估后验密度函数的高效计算方法现已唾手可得。这意味着，在后验密度无法以封闭形式表示的情况下，或者当获得参数后验分布所需的积分在代数上不可能时，仍能确定后验密度的形式以及相关的总结统计量。这些技术依赖于模拟，以从后验分布中获得随机样本。假设可从 \\(\\theta\\) 的后验分布得到参数 \\(\\theta\\) 的 \\(N\\) 个模拟值。对于足够大的 \\(N\\) 值，这些值的直方图将逼近它们被抽取的后验分布。此外，关于该后验分布的推断也可基于这些模拟值来进行。例如，可以通过这些模拟值的样本均值来估计后验均值，并且可根据预设范围内的样本值比例来获得概率区间。随着 \\(N\\) 值的增大，这些估计值会越来越接近相应的真值。有许多可能的模拟方法，但在这里我们描述一种非常通用的技术，称为拒绝采样 (rejection sampling)，当后验分布具有复杂形式时特别有用。","code":""},{"path":"chap16.html","id":"sec16-6-1","chapter":"第 16 章 贝叶斯生存分析","heading":"16.6.1 拒绝采样","text":"这种直接的模拟方法可用于从单个参数的后验密度函数 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 中抽取样本值。重要的是，当已知的与真实的 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 只相差一个常数倍时，就可以使用拒绝采样32。因为根据式 (16.4)，\\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 与样本似然函数和先验密度之积 \\(L(\\boldsymbol{t}\\mid\\theta)\\pi(\\theta)\\) 成正比，因此无需执行必要的积分以获得归一化常数，我们就能利用拒绝采样从 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 中抽样。这是一个显著的优势。其基本思想是，我们不从 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 中采样，而是从具有密度函数 \\(f(\\theta\\mid\\boldsymbol{t})\\) 的分布中采样，然后对其缩放以包络 (envelope) \\(\\pi(\\theta\\mid\\boldsymbol{t})\\)。选择基本密度函数 (base density function) \\(f(\\theta\\mid\\boldsymbol{t})\\) 以便可以直接从中模拟样本值。取缩放因子 \\(K\\) 使得对于任何 \\(\\theta\\) 值 \\(Kf(\\theta\\mid\\boldsymbol{t})\\) 都不小于 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\)，即\\[\\begin{align}\nK=\\max_\\theta\\left\\{\\frac{\\pi(\\theta\\mid\\boldsymbol{t})}{f(\\theta\\mid\\boldsymbol{t})}\\right\\}\n\\tag{16.10}\n\\end{align}\\]最简单的基本密度函数是在两个值 \\(\\) 和 \\(b\\) 之间恒定的函数，即均匀密度，表示为 \\(U(, b)\\)。相应的基本密度函数对于 \\(\\leqslant \\theta \\leqslant b\\) 为 \\(f(\\theta\\mid\\boldsymbol{t})=1/(b-)\\)，否则为 0，这里选取的限 \\(\\) 和 \\(b\\) 应当超出后验 \\(\\theta\\) 值的合理范围。根据式 (16.10)，缩放因子 \\(K\\) 为：\\[\\begin{aligned}K=(b-)\\max_\\theta\\{\\pi(\\theta\\mid\\boldsymbol{t})\\}\\end{aligned}\\]使 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 最大化的 \\(\\theta\\) 值是该后验分布的众数 \\(\\tilde\\theta\\)，因此\\[\\begin{aligned}K=(b-)\\pi(\\tilde{\\theta}\\mid\\boldsymbol{t})\\end{aligned}\\]\\(\\theta\\) 的值可以通过对 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 关于 \\(\\theta\\) 进行微分并令导数等于零来求出。当后验密度不容易微分时（通常如此），可能需要函数最大化的数值方法。为了说明，假设我们希望从非负参数 \\(\\theta\\) 的后验分布中采样，其密度如图 16.2 所示。在该图中，范围 \\((,b)\\) 内的均匀基本密度用虚线表示，它显然没有包含我们希望从中进行采样的分布。因此，通过将 \\(f(\\theta\\mid\\boldsymbol{t})\\) 乘以 \\(K=(b-)\\pi(\\theta\\mid\\boldsymbol{t})\\) 来缩放均匀密度，得到一个恒为 \\(\\pi(\\tilde{\\theta}\\mid\\boldsymbol{t})\\) 的函数。该函数如图 16.2 中的实线所示。\n下一步是根据基本密度 \\(f(\\theta\\mid\\boldsymbol{t})\\) 模拟随机数 \\(\\theta_s\\)。我们还根据 \\(U(0, 1)\\) 分布模拟另一个随机数 \\(u\\)。那么如果\\[\\begin{aligned}u\\leqslant\\frac{\\pi(\\theta_s\\mid\\boldsymbol{t})}{Kf(\\theta_s\\mid\\boldsymbol{t})}\\end{aligned}\\]我们接受 \\(\\theta_s\\) 作为 \\(\\pi({\\theta}\\mid\\boldsymbol{t})\\) 的样本值，否则拒绝 \\(\\theta_s\\)。这等价于模拟在 \\((0,Kf(\\theta_s\\mid\\boldsymbol{t}))\\) 中均匀分布的随机数 \\(v\\)，并且如果 \\(v\\leqslant\\pi(\\theta_s|\\boldsymbol{t})\\) 则接受 \\(\\theta_s\\)。因此，模拟值 \\(\\theta_s\\) 以概率 \\(\\pi(\\theta_s\\mid\\boldsymbol{t})/Kf(\\theta_s\\mid\\boldsymbol{t})\\) 被接受，并且是 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 的采样值。图 16.2 也对此进行了说明。由于在函数 \\(f(\\theta\\mid\\boldsymbol{t})\\) 图形下的均匀随机数的 x 坐标与在 \\(\\pi(\\theta\\mid\\boldsymbol{t})\\) 图形下的均匀随机数的 x 坐标相同，因此该模拟过程适用于已知的与真实的后验密度仅相差某个常数倍的情况33。将该过程重复多次，直到我们从后验分布中获得足够多的 \\(\\theta\\) 值样本。然后绘制这些值的直方图，以总结后验密度。此外，采样值的均值可以用作 \\(\\theta\\) 后验分布的均值，\\(\\theta\\) 的概率区间也可从模拟值中获得。使用均匀包络（如图 16.2 所示）会导致许多采样值 \\(\\theta_s\\) 被拒绝，因为基本密度函数与 \\(\\pi({\\theta}\\mid\\boldsymbol{t})\\) 不太接近。更好的基本密度选择可能是基于 gamma 分布，甚至是正态分布。更详细的改进将包括使用分段基函数和自适应方法，其中随着关于 \\(\\pi({\\theta}\\mid\\boldsymbol{t})\\) 信息的积累，\\(f(\\theta\\mid\\boldsymbol{t})\\) 会发生变化。示例 16.3  (停用宫内节育器的时间) 为说明拒绝采样，将模拟示例 16.1 中 \\(\\lambda\\) 后验分布的值。虽然我们知道这种情况下后验分布的实际密度，但在本例中我们假设最多只知道与 \\(\\pi(\\left.\\lambda\\mid\\boldsymbol{t}\\right)\\) 相差一个常数比例的函数。那么，后验密度与数据的似然 \\(L(\\boldsymbol{t}\\mid\\lambda)\\) 和 \\(\\lambda\\) 的先验分布 \\(\\pi (\\lambda)\\) 之积成正比，因此根据 16.3 节中的式 (16.9)\\[\\pi(\\lambda\\mid\\boldsymbol{t})\\propto L(\\boldsymbol{t}\\mid\\lambda)\\pi(\\lambda)=\\lambda^8\\exp(-1046\\lambda)\\]该函数与 \\(\\lambda\\) 的关系图如图 16.3 所示。对该函数的对数求微分，并将导数设为零，我们发现它在 \\(\\tilde\\lambda = 8/1046 = 0.00765\\) 处有最大值，并且在 \\(\\tilde\\lambda\\) 处的密度为 \\(3.927×10^{−21}\\)。从图 16.3 中我们还看到，当 \\(\\lambda > 0.02\\) 时，该函数在实际意义上上为零，因此使用 \\((0, 0.02)\\) 上的均匀基本密度。将其乘以 \\(K=0.02\\pi(\\tilde{\\lambda}\\mid t)\\)，以便函数 \\(\\lambda^8\\exp(-1046\\lambda)\\) 被一个最大值为 \\(3.927 × 10^{−21}\\) 的矩形包围。\n接着，模拟在 \\((0,0.02)\\) 上均匀分布的 10,000 个值，记作 \\(\\lambda\\) 的模拟值 \\(\\lambda_s\\)，如果区间 \\((0,3.927\\times10^{-21})\\) 中的第二个均匀随机数 \\(u\\) 不超过 \\(\\lambda_s^8\\exp(-1046\\lambda_s)\\)，则每个模拟值 \\(\\lambda_s\\) 被接受为 \\(\\lambda\\) 的后验分布 \\(\\pi(\\lambda\\mid\\boldsymbol{t})\\) 的值。请注意，我们这里没有使用完整的后验密度，但模拟值将是后验分布中的一个样本。根据模拟值，我们得到了如图 16.4 所示的直方图。通过将模拟值除以它们的总和以及区间宽度（此处为 0.0005），根据模拟值的频率分布获得密度估计。\n叠加在该直方图上的是实际的 gamma 后验密度函数。它们之间有很好的一致性，并且通过大量的模拟可以进一步改善这一点。\\(\\lambda\\) 后验分布模拟值的样本均值和中位数分别为 0.00861 和 0.00832。根据模拟值分布的下/上 2.5% 分位点获得的 \\(\\lambda\\) 95% 可信区间为 \\((0.0040, 0.0149)\\)。可以使用大于 0.01 的模拟 \\(\\lambda\\) 值的比例（即 0.284）来检验 \\(\\lambda>0.01\\)的假设。后验 gamma 分布的均值和中位数对应的精确值为 0.00860 和 0.00829，95% 可信区间为 \\((0.0039, 0.0151)\\) 且 \\(P(\\lambda > 0.01) = 0.283\\)。一致性非常好。由于在抽样过程中只接受了 10,000 个模拟值中的 23%，因此该过程的效率相对较低。若选用一个与由 \\(L(\\boldsymbol{t}\\mid\\lambda)\\pi(\\lambda)\\) 形成的函数更为接近的基本密度，则预期在相同的模拟次数下能得到更好的一致性结果。这个例子说明了如何使用模拟方法来获得单个参数的边际后验分布。下一步是确定向量 \\(\\boldsymbol\\theta\\) 中 \\(p\\) 个未知参数的联合后验密度，这也是使用模拟来完成的。","code":""},{"path":"chap16.html","id":"sec16-6-2","chapter":"第 16 章 贝叶斯生存分析","heading":"16.6.2 使用 MCMC 从后验分布中采样","text":"参数向量 \\(\\boldsymbol\\theta\\) 的后验分布 \\(\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\) 可通过从 \\(\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\) 中独立抽取样本的过程来模拟，该过程涉及对先前抽样的值进行更新。然后利用这些模拟出的值来识别并总结后验分布的关键特征。用 \\(\\boldsymbol{\\theta}_{(-j)}\\) 表示 \\(\\boldsymbol\\theta\\) 中不包括 \\(\\theta_j\\) 的参数集，并令 \\(\\boldsymbol{\\theta}_{(-j)}^*\\) 为 \\(\\boldsymbol{\\theta}_{(-j)}\\) 的最新采样值。那么 \\(\\theta_j\\) 的后验密度（以值 \\(\\boldsymbol{\\theta}_{(-j)}\\) 和数据 \\(\\boldsymbol t\\) 为条件）为 \\(\\pi(\\theta_j\\mid\\boldsymbol{\\theta}_{(-j)}^*,\\boldsymbol{t})\\)，并且使用式 (16.4)，这与下式成正比\\[\\begin{align}\nL(\\boldsymbol{t}\\mid\\theta_j,\\boldsymbol{\\theta}_{(-j)}^*)\\pi(\\theta_j,\\boldsymbol{\\theta}_{(-j)}^*)\n\\tag{16.11}\n\\end{align}\\]其中 \\(j=1,2,\\ldots,p\\)。在此表达式中，\\(L(\\boldsymbol{t}\\mid\\theta_j,\\boldsymbol{\\theta}_{(-j)}^*)\\) 是样本似然，\\(\\pi(\\theta_j,\\boldsymbol{\\theta}_{(-j)}^*)\\) 是 \\(\\boldsymbol\\theta\\) 的先验密度函数在 \\(\\theta_j,\\boldsymbol{\\theta}_{(-j)}^*\\) 处计算的值。比例常数确保条件后验密度 \\(\\pi(\\theta_j\\mid\\boldsymbol{\\theta}_{(-j)}^*,\\boldsymbol{t})\\) 关于 \\(\\theta_j\\) 的积分为 1. 可以在不知道比例常数的情况下，使用 16.6.1 节描述的拒绝采样，从该后验密度来模拟 \\(\\boldsymbol\\theta\\) 各分量的值。从 \\(\\boldsymbol{\\theta}_{(-j)}^*\\) 分量的初始值开始，从 \\(\\pi(\\theta_j\\mid\\boldsymbol{\\theta}_{(-j)}^*,\\boldsymbol{t})\\) 中采样一个值，记作 \\(\\theta_{j}^{*}\\)。然后将其用于更新 \\(\\boldsymbol\\theta\\) 的其余分量，并重复该过程以给出 \\(\\boldsymbol\\theta\\) 的一系列模拟值。在此模拟过程中，\\(\\boldsymbol\\theta\\) 中参数的最新模拟值仅取决于最近的值。该性质称为马尔可夫性 (Markov property)，并且在更新中使用固定的转移概率 (transition probabilities) \\(\\pi(\\theta_j\\mid\\boldsymbol{\\theta}_{(-j)},\\boldsymbol{t})\\) 找到的连续 (consecutive) 模拟值形成马尔可夫链 (Markov chain). 该模拟过程称为 Markov Chain Monte Carlo (MCMC). 根据马尔可夫链相关的理论，在某些条件下（模拟后验分布值时通常满足），模拟值序列 \\(\\boldsymbol{\\theta^{(1)}},\\boldsymbol{\\theta^{(2)}},\\boldsymbol{\\theta^{(3)}},\\ldots\\) 的分布将收敛于 \\(\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\)。因此，一旦 \\(\\boldsymbol\\theta\\) 值的流 (stream) 变得稳定，连续的值就视为从后验分布 \\(\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\) 中抽取的模拟值，然后这些值可用于总结后验分布的特征。此外，\\(\\boldsymbol\\theta\\) 任何分量的后验密度都可以通过该参数采样值序列的直方图来估计，该直方图可以使用密度估计技术进行平滑处理。用于模拟 \\(\\boldsymbol\\theta\\) 值最广泛使用的算法之一是称为 Gibbs 抽样的特定 MCMC 过程，该过程概括为以下步骤。指定 \\(\\boldsymbol\\theta\\) 中 \\(p\\) 个未知参数的初始值，表示为 \\(\\theta_1^{(0)},\\theta_2^{(0)},\\ldots,\\theta_p^{(0)}\\)，并组装成向量 \\(\\boldsymbol{\\theta}^{(0)}\\)。每个参数依次从其条件后验分布中采样一个值，以所有其他参数的前一个值为条件。因此\n\\[\\begin{aligned}&\\theta_1^{(1)}\\text{ 采样于 }\\pi(\\theta_1\\mid\\theta_2^{(0)},\\theta_3^{(0)},\\theta_4^{(0)},\\ldots,\\theta_p^{(0)},\\boldsymbol{t})\\\\&\\theta_2^{(1)}\\text{ 采样于 }\\pi(\\theta_2\\mid\\theta_1^{(1)},\\theta_3^{(0)},\\theta_4^{(0)},\\ldots,\\theta_p^{(0)},\\boldsymbol{t})\\\\&\\theta_3^{(1)}\\text{ 采样于 }\\pi(\\theta_3\\mid\\theta_1^{(1)},\\theta_2^{(1)},\\theta_4^{(0)},\\ldots,\\theta_p^{(0)},\\boldsymbol{t})\\end{aligned}\\]依此类推，直到\n\\[\\begin{aligned}&\\theta_p^{(1)}\\text{ 采样于 }\\pi(\\theta_p\\mid\\theta_1^{(1)},\\theta_2^{(1)},\\theta_3^{(1)},\\ldots,\\theta_{p-1}^{(1)},\\boldsymbol{t})\\end{aligned}\\]这给出了 \\(\\boldsymbol{\\theta}\\) 分量的第一组模拟值 \\(\\boldsymbol{\\theta}^{(1)}\\)。然后重复该过程，使得\n\\[\\begin{aligned}&\\theta_1^{(2)}\\text{ 采样于 }\\pi(\\theta_1\\mid\\theta_2^{(1)},\\theta_3^{(1)},\\theta_4^{(1)},\\ldots,\\theta_p^{(1)},\\boldsymbol{t})\\\\\n&\\theta_2^{(2)}\\text{ 采样于 }\\pi(\\theta_2\\mid\\theta_1^{(2)},\\theta_3^{(1)},\\theta_4^{(1)},\\ldots,\\theta_p^{(1)},\\boldsymbol{t})\\\\\n&\\theta_3^{(2)}\\text{ 采样于 }\\pi(\\theta_3\\mid\\theta_1^{(2)},\\theta_2^{(2)},\\theta_4^{(1)},\\ldots,\\theta_p^{(1)},\\boldsymbol{t})\\end{aligned}\\]依此类推，直到\n\\[\\begin{aligned}&\\theta_p^{(2)}\\text{ 采样于 }\\pi(\\theta_p\\mid\\theta_1^{(2)},\\theta_2^{(2)},\\theta_3^{(2)},\\ldots,\\theta_{p-1}^{(2)},\\boldsymbol{t})\\end{aligned}\\]\n这给出了第二组模拟值 \\(\\boldsymbol{\\theta}^{(2)}\\)。该过程持续 \\(N\\) 次，直到获得值为 \\(\\theta_1^{(N)},\\theta_2^{(N)},\\ldots,\\theta_p^{(N)}\\) 的 \\(p\\) 向量 \\(\\boldsymbol{\\theta}^{(N)}\\)，其中 \\(N\\) 需要足够大以确保序列中各参数值均已收敛。在该模拟过程的每个步骤，可以使用 16.6.1 节描述的拒绝法从式 (16.11) 中的条件分布抽取样本值。模拟值序列通常需要一段时间才能稳定下来，因此 \\(\\boldsymbol\\theta\\) 的前 \\(M\\) 个样本值通常被丢弃。这一初始阶段称为热身 (burn-). 然后再运行 \\(N\\) 次模拟，然后将这 \\(N\\) 个采样值视为从 \\(\\boldsymbol\\theta\\) 的后验分布中抽取的，并构成后验推断的基础。具体地，每个参数 \\(\\theta_j,j=1,2,\\ldots,p\\) 的后验分布由 \\(N\\) 个模拟值 \\(\\theta_j^{(1)},\\theta_j^{(2)},\\ldots,\\theta_j^{(N)}\\) 的直方图总结。类似地，可以求出 \\(\\theta_j\\) 后验分布的均值和中位数等贝叶斯点估计以及区间估计。关于 \\(\\theta_j\\) 的假设检验可通过计算符合特定假设的 \\(N\\) 个模拟值的比例来进行，该比例估计了该假设成立的概率。丢弃的样本量和用作后验分布样本值的数量取决于 \\(\\boldsymbol\\theta\\) 值的收敛速度。丢弃的样本数量的典型选择在 10 到 1000 之间，但也可能更大。选择的实际值取决于初始估计的准确性和序列的表现。如果将非贝叶斯方法拟合的生存模型的估计取为此处的初始估计，则序列往往会很快收敛。在热身期之后使用的样本数量通常在 1000 和 20000 之间。通过监测 \\(\\boldsymbol\\theta\\) 的 \\(M\\) 个模拟值的初始序列以及热身期后的后续 \\(N\\) 个值，可以评估收敛性。这种监测过程可通过图形化程序来辅助进行，例如绘制每个参数的连续模拟值的图形，即所谓的轨迹图 (trace plot). 该图可以直观地评估生成的参数值序列的稳定性。上述描述总结了 Gibbs sampler 的基本特征，但该算法经过了许多改进，使得其在计算上更加高效。此外，还可以将检查合并到算法中以监视并确保模拟值的收敛。以这种方式生成的特定参数的样本值将是相关的，并且这意味着可能需要比通常情况更多的值。同样，可以监控这种自相关性，并且可以评估自相关值的等效样本量 (equivalent sample size). MCMC 过程可能还需要额外的自适应阶段 (adaptive phase)，以微调算法从而优化性能。在此阶段生成的样本将被丢弃。示例 16.4  (患乳腺癌妇女的预后) 为了说明如何在参数模型中估计后验分布，我们回到第 1 章示例 1.2 首次给出的有关乳腺癌女性生存时间的数据。在第 5 章示例 5.6 中，对这些数据拟合了 Weibull 模型，根据该模型，第 \\(\\) 个个体在时间 \\(t\\) 时的死亡风险为\\[h_i(t)=\\exp(\\beta x_i)h_0(t)\\]其中，如果肿瘤染色呈阳性，则 \\(x_i = 1\\)，否则为 0. 染色效应的对数风险比为 \\(\\beta\\)，\\(h_0(t)=\\lambda\\gamma t^{\\gamma-1}\\) 是尺度参数为 \\(\\lambda\\)、形状参数为 \\(\\gamma\\) 的基线 Weibull 风险。相应生存函数为 \\(S_0(t)^{\\exp(\\beta x_i)}\\)，其中 \\(S_0(t)=\\exp\\{-\\lambda t^\\gamma\\}\\)。利用这些结果，可以使用式 (16.5) 直接求出样本数据的似然。将该似然函数与有关 \\(\\beta,\\lambda\\) 和 \\(\\gamma\\) 的先验信息相结合，其中假定先验密度函数是独立的。每个参数都将使用扩散先验。具体来说，我们取 \\(\\beta \\sim N(0, 102)\\) 以及 \\(\\log \\lambda \\sim N(0, 102)\\)，这对应于 \\(\\lambda\\) 的 lognormal 分布。\\(\\sigma^2 = 102\\) 的 half-normal 先验将用于 \\(\\gamma\\)，这是一个均值为 8、方差为 36 的分布。将使用 MCMC 模拟方法来拟合模型，进行 1000 次模拟热身并随后运行 10,000 次。模型中三个未知参数后验值的轨迹如图 16.5 所示。该轨迹图表明模拟值非常稳定，因此建模过程已成功收敛到相关的后验分布。\\(\\beta,\\lambda\\) 和 \\(\\gamma\\) 的中位数和 95% 可信区间可从各自后验分布的 10,000 个模拟值中找到，分别为 \\(1.010 (0.060, 2.098), 0.003 (0.001, 0.018)\\) 和 \\(0.951 (0.677, 1.287)\\)。阳性染色风险 \\(\\exp(\\beta)\\) 的相应估计和可信区间为 \\(2.745 (1.062, 8.067)\\)。由于这些估计是从模拟建模过程中得出的，因此它们不能精确复现。形状参数 \\(\\gamma\\) 的可信区间包括 1，这表明指数模型可能很适合。我们将在示例 16.6 回到这一点。风险比的全后验分布可以使用 \\(\\exp(\\beta)\\) 的 10,000 个模拟值的直方图来总结，如图 16.6 所示。\n根据模拟结果，\\(\\exp(\\beta)\\) 的 9,822 个值大于 1，因此染色效应的风险比大于 1 的概率为 0.98. 事实上，这一风险比大于 4 的概率为 0.24. 因此染色效应是强烈的。这些估计与使用经典方法对数据进行 Weibull 模型拟合时得到的结果大致一致，如第 5 章示例 5.5 所示。然而，可信区间和假设检验程序的结果现在是使用概率语句来描述的。为了进一步说明这个过程，将为数据拟合具有分段指数基线风险函数的 Cox 回归模型，使用的是贝叶斯方法（如 16.3 节所述）。\\(\\beta\\) 的先验分布将取为 \\(N(0, 102)\\)， 将用作基线风险函数中参数的先验分布取 \\(r = λ = 0.001\\) 的 gamma. 建模中使用的似然函数如 6.1 节所述。将再次使用 MCMC 模拟过程程，进行 1000 次热身并随后运行 10,000 次模拟。所得风险比 \\(\\exp(\\beta)\\) 的后验值的中位数及 95% 可信区间为 \\(2.504 (0.988, 7.571)\\)。该结果其与相应的 Weibull 分布拟合的后验估计非常相似，尽管 Cox 模型的可信区间刚刚包括 1.","code":""},{"path":"chap16.html","id":"sec16-7","chapter":"第 16 章 贝叶斯生存分析","heading":"16.7 预测分布","text":"一旦拟合了模型，我们可能希望使用它来获得未知参数函数的估计，例如对于具有特定解释变量值的个体，估计其生存函数或风险函数。从 MCMC 模拟过程中得到的贝叶斯模型参数点估计（如均值或中位数），可以通过直接将这些估计代入生存函数或风险函数中的未知参数，来获取这些函数的估计。例如，假设有 \\(n\\) 个生存时间和单个解释变量 \\(X\\) 组成的数据，该解释变量对于第 \\((= 1, 2,...,n)\\) 个个体取值 \\(x_i\\)。为该数据拟合了指数模型，使用第 5 章 5.1.1 节中的结果，那么第 \\(\\) 个个体的生存函数和风险函数为\\[\\begin{align}\nS_i(t)=\\exp\\{-\\exp(\\beta x_i)\\lambda t\\},\\quad\\quad h_i(t)=\\exp(\\beta x_i)\\lambda\n\\tag{16.12}\n\\end{align}\\]其中 \\(\\boldsymbol\\beta\\) 是解释变量的系数，\\(\\lambda\\) 是该模型下的恒定基线风险，\\(t>0\\)。在 MCMC 模拟过程之后，将获得 \\(N\\) 组 \\(\\beta^{(\\nu)}\\text{ }\\lambda^{(\\nu)}\\) 的值，\\(\\nu=1,2,\\ldots,N\\)。如果 \\(\\tilde{\\beta}\\) 和 \\(\\tilde{\\lambda}\\) 是来自该模拟的 \\({\\beta}\\) 和 \\({\\lambda}\\) 的贝叶斯点估计，例如它们的样本均值，则通过将这些估计代入式 (16.12) 中来获得风险和生存函数的估计，这给出\\[\\begin{aligned}\\tilde{S}_i(t)=\\exp\\{-\\exp(\\tilde{\\beta}x_i)\\tilde{\\lambda}t\\},\\quad\\quad\\tilde{h}_i(t)=\\exp(\\tilde{\\beta}x_i)\\tilde{\\lambda}\\end{aligned}\\]完整的贝叶斯分析要求还考虑函数估计的不确定性，为此我们需要一个预测分布 (predictive distribution). 假设我们想要预测模型中解释变量值为 \\(\\boldsymbol x_0\\) 的新个体或现有个体在某个时间 \\(t\\) 的生存或风险函数。该个体的函数 \\(g(t)\\) 的后验预测分布 (posterior predictive distribution) 是以 \\(\\boldsymbol x_0\\) 和生存时间 \\(t\\) 为条件的 \\(g(t)\\) 的密度函数，，并由下式给出\\[p\\{g(t)|\\boldsymbol{x}_0,\\boldsymbol{t}\\}=\\int_\\boldsymbol{\\theta}p\\{g(t)\\mid\\boldsymbol{x}_0,\\boldsymbol{t},\\boldsymbol{\\theta}\\}\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\mathrm{d}\\boldsymbol{\\theta}\\]也就是说，我们将 \\(g(t)\\) 的密度，以 \\(\\boldsymbol x_0,\\boldsymbol t\\) 和未知模型参数 \\(\\boldsymbol \\theta\\) 为条件，关于 \\(\\boldsymbol \\theta\\) 的后验分布进行积分，使得 \\(g(t)\\) 的分布不涉及未知数参数。这解释了 \\(\\boldsymbol \\theta\\) 的不确定性。当使用 MCMC 方法模拟模型参数的值时，第 \\(\\nu(\\nu=1,2,\\ldots,N)\\) 组参数 \\(\\boldsymbol{\\theta}^{(\\nu)}\\) 可用于获得函数 \\(g(t)\\) 在这些模拟值处的值，记作 \\(g_{\\nu}(t)\\)。那么，该积分可以通过这 \\(N\\) 个 \\(g(t)\\) 值的分布来近似。例如，在具有单个解释变量 \\(X\\) 的生存时间的指数模型中，当 \\(X=x_0\\) 时，生存函数 \\(S(t)\\) 的预测分布为\\[\\begin{aligned}p\\{S(t)\\mid x_0,\\boldsymbol{t}\\}&=\\int_0^\\infty\\int_{-\\infty}^\\infty p\\{S(t)\\mid x_0,\\boldsymbol{t},\\beta,\\lambda\\}\\,\\pi(\\beta,\\lambda\\mid \\boldsymbol{t})\\,\\mathrm{d}\\beta\\,\\mathrm{d}\\lambda\\end{aligned}\\]其中 \\(\\pi(\\beta,\\lambda\\mid \\boldsymbol{t})\\) 是 \\(\\beta,\\lambda\\) 的联合后验密度。为了逼近此二重积分，使用 MCMC 得到模拟值 \\(\\beta^{(\\nu)}\\) 和 \\(\\lambda^{(\\nu)}\\)，其中 \\(\\nu=1,2,\\ldots,N\\)，并且这些将得到 \\(S(t)\\) 的 \\(N\\) 个模拟值，这由下式给出\\[\\begin{aligned}S^{(\\nu)}(t)=\\exp\\{-\\exp(\\beta^{(\\nu)}x_0)\\lambda^{(\\nu)}t\\}\\end{aligned}\\]其中 \\(\\nu=1,2,\\ldots,N\\)。这些模拟值形成了 \\(S(t)\\) 的预测分布。生存函数在任意值 \\(t\\) 处的点估计是 \\(S(t)\\) 模拟值的均值，即 \\(N^{-1}\\sum_{\\nu}S^{(\\nu)}(t)\\)。通过使用 \\(t\\) 的一系列值，可以找到生存函数的贝叶斯估计。任何 \\(t\\) 值的贝叶斯概率区间也可以按照 16.5.2 节描述的方式直接从 \\(S(t)\\) 的预测分布中得出。示例 16.5  (患乳腺癌妇女的预后) 在示例 16.4 中，为乳腺癌妇女生存时间数据拟合了 Weibull 模型，并获得了其贝叶斯估计。我们现在使用 16.7 节中的结果来获得肿瘤呈阳性和阴性染色患者的后验生存函数。第 \\(\\) 个患者在时间 \\(t\\) 的生存函数估计由下式给出\\[\\tilde{S_i}(t)=\\exp(-e^{\\tilde{\\beta}x_i}\\tilde{\\lambda}t\\tilde{\\gamma})\\]其中，如果肿瘤呈阳性染色，\\(x_i=1\\)，否则为 0，\\(\\tilde\\beta,\\tilde\\gamma\\) 和 \\(\\tilde\\gamma\\) 是参数的贝叶斯估计。对于给定的 \\(t\\) 值，对于 \\(\\beta,\\gamma\\) 和 \\(\\gamma\\) 的每个模拟值，\\(S_i(t)\\) 的单独估计将形成 \\(S_i(t)\\) 的后验预测分布。使用了 0 到 225（数据中的最长观测时间）范围内的 100 个 t 值。然后，对于每个 \\(t\\) 值和 \\(x_i=0,1\\)，使用生存函数 10,000 个模拟值的中位数以及上/下 2.5% 分位点，来估计阳性和阴性染色女性的生存函数以及每个 \\(t\\) 值 95% 可信区间形成的不确定性限值。结果如图 16.7 所示。生存函数明显是分离的，清楚地表明呈阳性染色的肿瘤患者的预后较差。\n对于 Cox 回归模型也可以进行类似的分析，这得到图 16.8. 在此图中，生存函数估计在事件时间之间是恒定的，得到阶梯状 (stepwise) 函数。阶梯状生存函数与图 16.7 中的相应函数非常相似。\n下一步是正式比较这些贝叶斯模型，以检查指数参数模型是否可以像 Weibull 一样拟合得很好，并比较具有和不具有与染色效应对应的解释变量的模型。","code":""},{"path":"chap16.html","id":"sec16-8","chapter":"第 16 章 贝叶斯生存分析","heading":"16.8 贝叶斯模型比较","text":"在生存分析的许多实际应用中，需要比较替代模型。假设正在考虑两个不同的模型，记作 \\(M_1\\) 和 \\(M_2\\)，这两个模型不一定需要嵌套。因为在贝叶斯框架中，在给定数据的情况下，根据各自的后验概率比较这两个模型是很自然的。根据式 (16.2)，对于 \\(j=1,2\\)，给定数据 \\(D\\) 的模型 \\(M_j\\) 的概率为 \\(\\text{P}(M_j\\mid D)=\\text{P}(D\\mid M_j)\\text{P}(M_j)/\\text{P}(D)\\)。那么，两个模型之间的选择可以基于每个模型的条件概率之比，即\\[\\begin{aligned}\\frac{\\text{P}(M_1\\mid D)}{\\text{P}(M_2\\mid D)}&=\\frac{\\text{P}(D\\mid M_1)\\text{ P}(M_1)}{\\text{P}(D\\mid M_2)\\text{ P}(M_2)}\\end{aligned}\\]这仅是每个模型下样本数据的边际概率之比乘以先验概率之比。量\\[\\begin{aligned}B=\\frac{\\text{P}(D\\mid M_1)}{\\text{P}(D\\mid M_2)}\\end{aligned}\\]称为贝叶斯因子 (Bayes factor)，总结了支持模型 \\(M_1\\) 而非模型 \\(M_2\\) 的证据的权重。这是贝叶斯推断中模型比较的基础。通常，介于 1 和 3 之间的 \\(B\\) 值视为有利于 \\(M_1\\) 的弱证据 (weak evidence)，介于 3 和 20 之间的值构成合理证据 (reasonable evidence)，介于 20 和 150 之间的值表示有力证据 (strong evidence)，如果 \\(B\\) 超过150，则有压倒性的证据 (overwhelming evidence) 支持 \\(M_1\\) 模型。贝叶斯因子 \\(B\\) 是在模型比较的经典方法下比较模型时使用的似然比，这在第 3 章 3.5 节描述。然而，我们不是在模型 \\(M_j,j=1,2\\) 中最大化未知模型参数 \\(\\boldsymbol\\theta_j\\) 的似然来获得这些参数的估计，而是关于 \\(\\boldsymbol\\theta_j\\) 积分以给出独立于 \\(\\boldsymbol\\theta_j\\) 的数据的边际概率。因此，模型 \\(M_j\\) 下的数据的边际分布 \\(\\mathrm{P}(D\\mid M_j)\\) 根据下式计算\\[\\begin{align}\n\\int_{\\boldsymbol{\\theta}_j}L_j\\left(\\boldsymbol{t}\\mid\\boldsymbol{\\theta}_j\\right)\\pi_j\\left(\\boldsymbol{\\theta}_j\\right)\\mathrm{d}\\boldsymbol{\\theta}_j\n\\tag{16.13}\n\\end{align}\\]其中 \\(L_j(\\boldsymbol{t}\\mid\\boldsymbol{\\theta}_j)\\) 和 \\(\\pi_j(\\boldsymbol{\\theta}_j)\\) 为模型 \\(M_j,j=1,2\\) 下的似然函数和先验密度函数。式 (16.13) 中的积分涉及先验密度函数，因此如果使用不适当先验分布，则无法获得贝叶斯因子。此外，由于需要对模型参数进行多重积分，贝叶斯因子通常很难或不可能计算。因此，通常采用替代统计量来总结模型的拟合。","code":""},{"path":"chap16.html","id":"sec16-8-1","chapter":"第 16 章 贝叶斯生存分析","heading":"16.8.1 用于比较模型的 DIC 统计量","text":"贝叶斯模型比较中最广泛使用的统计量之一与第 3 章 3.6 节中定义的贝叶斯信息准则 (BIC) 非常相似，称为偏差信息准则 (Deviance Information Criterion, DIC)。与 BIC 统计量一样，它是总结模型拟合度的项和代表模型复杂性的项的组合。DIC 基于量 \\(D(\\boldsymbol{\\theta})=-2\\log L(\\boldsymbol{t}\\mid\\boldsymbol{\\theta})\\)，有时称为偏差 (deviance). 在经典推断中，将 \\(\\boldsymbol\\theta\\) 中的模型参数替换为最大似然估计，得到 \\(\\hat{\\boldsymbol\\theta}\\)，那么 \\(D(\\hat{\\boldsymbol\\theta})\\) 就是第 3 章 3.5 节中介绍的 \\(-2\\log\\hat{L}\\) 统计量，并用作模型比较的基础。模型的复杂性通过模型参数有效数量 \\(p_D\\) 的估计来度量。将 \\(\\boldsymbol{\\theta}\\) 参数的后验均值向量记作 \\(\\bar{\\boldsymbol{\\theta}}\\)，该估计使用贝叶斯点估计获得，\\(p_D\\) 由下式给出\\[\\begin{align}\np_D =\\text{ E }\\left\\{-2\\log\\frac{L(\\boldsymbol{t}\\mid\\boldsymbol{\\theta})}{L(\\boldsymbol{t}\\mid{\\bar{\\boldsymbol\\theta}})}\\right\\} \\\\\n=\\text{ E}\\left\\{D(\\boldsymbol{\\theta})\\right\\}-D({\\bar{\\boldsymbol\\theta}})\n\\tag{16.14}\n\\end{align}\\]其中期望运算是关于 \\(\\boldsymbol{\\theta}\\) 中的参数进行的。然后，与 BIC 统计量类似，DIC 统计量定义为\\[\\begin{align}\nDIC=D(\\bar{\\boldsymbol{\\theta}})+2p_D\n\\tag{16.15}\n\\end{align}\\]优选具有较小 DIC 值的模型。当使用 MCMC 方法根据 \\(\\boldsymbol \\theta\\) 的后验分布模拟值 \\(\\boldsymbol{\\theta}^{(\\nu)},\\nu=1,2,\\ldots,N\\) 时，可以使用 \\(\\boldsymbol \\theta\\) 的模拟值的平均偏差来估计 \\(\\operatorname{E}\\left\\{D(\\boldsymbol{\\theta})\\right\\}\\)，这由 \\(\\overline{D(\\boldsymbol{\\theta})}=N^{-1}\\sum_{{\\nu}}D(\\boldsymbol{\\theta}^{(\\nu)})\\) 给出。另外，式 (16.14) 中的 \\(\\bar{\\boldsymbol \\theta}\\) 是模拟的 \\(\\boldsymbol \\theta\\) 值的均值，即 \\(N^{-1}\\sum_\\nu\\boldsymbol{\\theta}^{(\\nu)}\\)，因此 \\(p_D\\) 计算为 \\(\\overline{D(\\boldsymbol{\\theta})}-D(\\boldsymbol{\\bar{\\theta}})\\)，即后验平均偏差 (posterior mean deviance) 减去后验均值的偏差 (deviance posterior mean).","code":""},{"path":"chap16.html","id":"sec16-8-2","chapter":"第 16 章 贝叶斯生存分析","heading":"16.8.2 用于比较模型的 WAIC 统计量","text":"尽管 DIC 统计量被广泛使用，但它有许多局限性，例如模型的重新参数化可能导致统计量值略有不同。例如，当在 Weibull 模型的比例风险或加速失效时间表示中使用同一组解释变量时，可能会获得不同的 DIC 值（如第 5 章所述）。此外，模型复杂性的度量 \\(p_D\\) 可能为负。这催生了一系列其他统计量的问世，包括 Watanabe-Akaike Information Criterion (WAIC)，也称为 Widely Applicable Information Criterion.WAIC 统计量与式 (16.15) 中的 DIC 统计量类似，不同之处在于似然是在 \\(\\boldsymbol{\\theta}\\) 的后验分布 \\(\\pi(\\boldsymbol{\\theta}|\\boldsymbol{t})\\) 上进行平均，而不是将均值 \\(\\bar{\\boldsymbol{\\theta}}\\) 代入。这得到了统计量\\[\\begin{align}\nWAIC&=-2\\sum_{=1}^n\\log p(t_i|\\boldsymbol{t})+2p_W\n\\tag{16.16}\n\\end{align}\\]其中 \\(p(t_i|\\boldsymbol{t})\\) 是 \\(\\boldsymbol t_i\\) 的后验边际密度 (posterior marginal density)，由下式给出\\[\\begin{align}\np(t_i\\mid\\boldsymbol{t})=\\int_\\boldsymbol{\\theta}L(t_i\\mid\\boldsymbol{\\theta})\\pi(\\boldsymbol{\\theta}\\mid\\boldsymbol{t})\\mathrm{d}\\boldsymbol{\\theta}\n\\tag{16.17}\n\\end{align}\\]式 (16.16) 中模型复杂性的度量 \\(p_W\\) 为\\[\\begin{align}\np_W&=2\\sum_{=1}^n\\left[\\log p(t_i\\mid\\boldsymbol{t})-\\text{ E }\\left\\{\\log L(t_i\\mid\\boldsymbol{\\theta})\\right\\}\\right]\n\\tag{16.18}\n\\end{align}\\]其中 \\(L(t_{\\boldsymbol{}}\\mid\\boldsymbol{\\theta})\\) 是第 \\(\\) 个生存时间对似然函数的贡献，期望运算也是关于 \\(\\boldsymbol{\\theta}\\) 中的参数进行的。WAIC 统计量的值越小，模型越好。请注意，WAIC 的计算中使用了个体对似然的贡献。当使用 MCMC 模拟方法从一组参数 \\(\\boldsymbol{\\theta}\\) 的后验分布生成样本值时，可以通过每个观测值 \\(t_i(= 1, 2,...,n)\\) 在每个采样值集 \\(\\boldsymbol{\\theta}^{(\\nu)},\\nu=1,2,\\ldots,N\\) 上的似然贡献来计算 WAIC 统计量。然后可以通过这些似然贡献在 \\(\\boldsymbol{\\theta}^{(\\nu)}\\) 上的平均值来估计每个观测的后验边际密度，即 \\(N^{-1}\\sum_{{\\nu}}L(t_i\\mid\\boldsymbol{\\theta}^{(\\nu)})\\)。此外，式 (16.18) 中的第二项可以通过 \\(t_i\\) 的对数似然关于 \\(\\boldsymbol{\\theta}^{(\\nu)}\\) 的平均值来估计，即 \\(N^{-1}\\sum_{{\\nu}}\\log L(t_{{}}\\mid\\boldsymbol{\\theta}^{(\\nu)})\\)。示例 16.6  (患乳腺癌妇女的预后) 在示例 16.5 中，对阳性和阴性染色肿瘤的妇女的预后数据拟合了贝叶斯 Weibull 模型。为了探索死亡风险对染色效应的依赖性，将包含染色效应的 Weibull 模型与不包含染色效应的 Weibull 模型进行比较。在拟合示例 16.5 中的 Weibull 模型时，用于模型比较的 WAIC 统计量值为 319.5. 模型的模型复杂性的相应度量为 \\(p_W = 2.9\\)，非常接近 3，即模型中未知参数的数量（忽略先验分布中的参数）。当对每组女性建立一个具有共同 Weibull 分布的模型时，WAIC=321.3，\\(p_W=1.7\\)。由于此 WAIC 统计量大于包含染色效应的模型的统计量，因此我们得出结论，包含此效应确实会改进模型。用于比较这两个模型的 DIC 统计量的相应值为 \\(319.3 (p_D = 2.9)\\) 和 \\(321.5 (p_D = 1.9)\\)，这与 WAIC 的值非常相似。拟合具有分段指数风险的 Cox 回归模型时（如示例 16.4 所述），WAIC 值为 331.9，\\(p_W = 18.1\\)。这里 WAIC 的值比 Weibull 模型大得多，所以这个模型不太好。然而，这是因为 Cox 模型中拟合了更多参数。风险函数中阶跃较少的模型很可能会表现更好，因此会考虑参数较少的其他模型。表 16.1 给出了基线风险函数中具有不同参数数量的分段指数模型的 WAIC 和 \\(p_W\\) 值。基线风险变化的时间位于最小和最大未删失生存时间之间的等距百分位处。具有 \\(k\\) 个参数的分段指数模型将具有 \\(k − 1\\) 个阶跃的基线风险。 \\(k = 1\\) 的模型对应于恒定基线风险，即指数模型。\n该表显示，具有 \\(k=1,2,\\ldots,5\\) 个区间的模型是可比较的，但添加更多区间会导致 WAIC 值较大。请注意，表 16.1 中的值均小于基线风险在每个事件时间发生变化的模型的值 331.9. 拟合的分段指数模型还表明，基线风险在时间 70 之前大致恒定，此后逐渐减小。此外，对于 \\(k \\leqslant 5\\)，WAIC 值与 Weibull 模型的值类似。由于指数模型与 Weibull 模型具有非常相似的 WAIC 值，因此具有较少结的分段指数模型具有可比性也就不足为奇了。我们以另一个说明贝叶斯方法在分析事件发生时间方面的应用来结束本章。示例 16.7  (健康评估及其初级保健的连接) 在一项名为 HELP 研究的健康评估及其与初级保健连接的研究中，进行了一项涉及住院戒毒计划患者的临床试验。共有 470 名接受酒精、海洛因或可卡因戒毒且没有初级保健医生的患者被随机分配接受 HELP 诊所的协助，将他们与初级医疗保健连接起来，或不接受此类协助。该计划的最终目标是使患者能够从初级保健中受益，因此响应变量是从随机化到连接的天数。有些患者从未接受过初级保健，因此对事件时间是删失的。记录了每位患者的许多其他变量，但在本例中，我们将使用年龄、性别以及患者在参加试验时是否无家可归。Samet et al. (2003) 提供了有关该研究的更详细信息，数据位于 R 数据集 HELPmiss 中，该数据集是 mosaicData 包的一部分。数据集中的变量如下\\(Time\\)：与初级保健连接的时间（天）\\(Status\\)：事件指示器（0 = 删失/无连接，1 = 未删失）\\(Age\\)：患者年龄\\(Gender\\)：患者性别（0 = 女性，1 = 男性）\\(Housing\\)：无家可归状况（0 = 无家可归，1 = 有住房）\\(Help\\)：协助连接医疗保健（0 = 无，1 = 有）数据集的前 15 行如表 16.2 所示。\n主要关注的因素是 HELP 诊所的协助对与初级保健连接时间的影响。将使用贝叶斯方法来估计 HELP 临床效果的风险比，并调整其他三个因素。首先将考虑 Weibull 分布。模糊先验分布将用于与年龄、性别、住房状况以及 HELP 诊所是否提供协助相关的变量的系数 \\(\\beta_1,\\beta_2,\\beta_3,\\beta_4\\)。具体来说，我们将采用 \\(N(0, 1)\\) 分布，这意味着我们预计每个 \\(\\beta\\) 系数有 95% 的概率位于 \\((−2, 2)\\) 范围内，并且几乎没有存在风险比超过 \\(e^2 = 7.4\\)。Weibull 尺度参数的对数 \\(\\log \\lambda\\) 将假定为扩散 \\(N(0, 102)\\) 先验，因为该参数存在很大的不确定性。形状参数 \\(\\gamma\\) 将采用从 \\(N(0, 102)\\) 分布导出的扩散 half-normal 先验，并且 MCMC 模拟过程将使用 1000 次模拟的热身，然后进行 10,000 次运行。在拟合包含变量 \\(Help,Age,Gender\\) 和 \\(Housing\\) 的贝叶斯 Weibull 模型时，模型参数的模拟后验分布得出风险比和 95% 可信区间，对于 \\(Help,Age,Gender\\) 和 \\(Housing\\) 分别为 \\(5.155 (3.619, 7.503),1.024 (1.004, 1.045),1.404 (0.969, 2.100)\\) 和 \\(0.864 (0.642, 1.169)\\)。该模型的 WAIC 统计量值为 2344.2，\\(p_W = 5.6\\)。住房效应的风险比的可信区间包含 1，根据住房状态的 10000 个风险比模拟值，风险比小于 1.0 的后验概率为0.83. 因此，我们得出结论，住房状态不会影响获得初级保健所需的时间。当从模型中删除该变量时，WAIC = 2343.3，\\(p_W = 4.6\\)，表明模型略有改进。其余三个项的风险比的可信区间不包含了 1，因此保留了这些变量。下一步是考察 Weibull 基线风险是否可以通过使用样条函数对风险函数进行建模来改进。为此，我们将使用具有 B 样条基函数的立方样条作为危险函数的对数。该模型在第 6 章 6.3 节中进行了描述，确保了对数累积风险的最终估计将是时间的递增函数。当对数累积风险使用限制性立方样条模型时，情况不一定如此，并且它可能会导致 MCMC 模拟过程中出现困难。根据第 6 章的式 (6.10)，具有 \\(m\\) 个内部结的模型的对数风险函数的立方 B 样条模型为\\[\\begin{aligned}\\log h_i(t)=\\eta_i+\\sum_{j=1}^{m+4}\\alpha_jB_{j,3}(t)\\end{aligned}\\]其中，\\(\\alpha_j\\) 是第 \\(j(j=1,2,\\ldots,m+4)\\) 个 B 样条基函数 \\(B_{j,3}(t)\\) 的系数，且 \\(\\eta_i=\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\) 是解释变量值的线性组合。要拟合的模型都包括在 Weibull 模型中发现的三个显著的解释变量，即 \\(Help, Age\\) 和 \\(Gender\\)。样条基函数中的系数也将使用 \\(N(0,102)\\) 先验分布，因为它们的精确值同样存在不确定性。如第 6 章 6.2.3 节所述，结将设置为事件时间分布的百分位数，并将使用不同数量的结，以确定拟合最优的模型。现在，从至少两个边界结且无内部结开始，拟合具有越来越多的内部结数量 \\(m\\) 的立方样条模型。结果列于表 16.3. 在对数风险函数的 B 样条模型中，\\(m=0\\) 不像对数累积风险的限制性立方样条模型那样对应于 Weibull 分布。所有样条模型的 WAIC 值都小于具有 Weibull 基线风险函数的相应模型的 WAIC 值（2343.3），因此它们可以更好地描述潜在基线风险。然而，当添加第二个内部结时，WAIC 统计量开始增加，并且具有三个内部结的模型的 WAIC 仍然大于仅具有一个内部结的模型的 WAIC. 这表明，模型复杂性的增加并没有被拟合的略微改进所抵消。因此对于对数基线风险，我们使用只有一个内部结的 B 样条模型。\n使用 MCMC 模拟过程拟合该模型，变量 \\(Help,Age\\) 和 \\(Gender\\) 的风险比和 95% 可信区间分别为 \\(4.846 (3.440, 7.079),1.024 (1.004, 1.045)\\) 和 \\(1.398 (0.969, 2.074)\\)。因此，年龄每增加一岁，与医疗保健系统连接的机会就会增加为原来的 1.024 倍，其中男性患者与医疗系统相关的机会增加 40%，在获得医疗保健方面获得帮助的患者获得连接的机会几乎为五倍。基于样条模型的风险比估计与 Weibull 模型的风险比非常相似，但样条模型可以更好地表示潜在的连接风险。根据 MCMC 模拟，我们可以使用 16.7 节描述的方法来估计接受和未接受 HELP 诊所协助的具有特定特征的患者的后验风险函数和生存函数。风险函数和生存函数的预测分布分别显示了在给定时间进行连接的风险和在该时间之后进行连接的概率。图 16.9 和 16.10 显示了一名 30 岁男性患者的这些函数。\n与医疗保健连接的机会在研究开始后 28 天左右达到峰值，此后逐渐下降。这些图形清晰地表明，那些在获得医疗保健方面得到协助的人实际获得此类保健的机会要大得多。超过 100 天后，连接的机会几乎没有变化。","code":""},{"path":"chap16.html","id":"sec16-9","chapter":"第 16 章 贝叶斯生存分析","heading":"16.9 注释","text":"在本章中，我们了解了如何使用贝叶斯推断方法对生存数据进行建模。那么，与前面章节中描述的经典方法相比，这种方法的优点和缺点是什么？贝叶斯方法提供了一种为大型数据集拟复杂的现实模型方法，该方法使用的过程可以将新数据与来自外部知识或先前研究的任何可用信息相结合。这是通过统一的推断框架来实现的，该框架从指定将要构建似然的模型出发，通过为该模型中的所有未知参数制定先验分布，然后估计并总结用于推断的每个参数的后验分布。此外，与经典的推断程序不同，这种方法不依赖于大样本来保证点和区间估计以及假设检验的有效性。另一个优点是结果易于解释。在贝叶斯推断中，可信区间和假设检验直接基于有关参数（例如风险比）位于某个区间的概率或某些假设为真的概率的陈述。这比置信区间和 \\(P\\) 值更容易理解。当然也有缺点。首要问题是需要通过制定先验概率分布来纳入有关每个未知参数的先验知识。尽管在确实没有先验信息的情况下可以使用模糊且无信息性的先验分布来缓解这个问题，但对于主观性的担忧仍然存在。此外，获得后验分布的过程通常涉及使用基于 MCMC 方法的模拟技术，这可能是一个计算密集型的过程。此外，还可能涉及到数值方法的选择、迭代控制选项的设定以及识别和解决收敛问题的需求。虽然现代计算机软件支持这一系列操作，但相较于经典方法（例如使用 Cox 回归模型），这一过程确实需要更高水平的专业知识。总之，生存数据分析的贝叶斯方法提供了一种强大的方法来拟合现实模型，可以解释实际研究中经常发现的那些复杂特征。","code":""},{"path":"chap16.html","id":"sec16-10","chapter":"第 16 章 贝叶斯生存分析","heading":"16.10 延伸阅读","text":"Ibrahim, Chen Sinha (2001) 一书全面介绍了贝叶斯生存分析方法的理论和实践。有许多关于贝叶斯推断的通用教科书。介绍性文本包括 Bolstad Curran (2016), Hoff (2009), Lunn et al. (2012) 和 Lambert (2018). 更高级的文本包括 Bernardo Smith (1994), Box Tiao (1973) 以及 O’Hagan Forster (2004) 的文本。Gelman et al. (2013) 提供了关于贝叶斯数据分析的全面文本，而 McElreath (2020) 通过软件包 R 和 Stan 的例子说明了贝叶斯方法。Sahu (2022) 最近的文本详细讨论了贝叶斯方法的许多方面。Barnett (1999) 概述了贝叶斯推断，并将其与其他推断方法进行了比较。以下这些书都详细描述了用于模拟来自后验分布的值的 MCMC 方法。Gilks, Richardson Spiegelholter (1996) 以及 Gamerman Lopes (2006) 对这种方法进行了更全面的描述。有关 Gibbs sampler 的更多信息，请参阅 Geman Geman (1984) 以及 Gelfand Smith (1990). Casella George (1992) 提供了关于该方法的教程，Tierney (1994) 提供了更完整更高级的总结。评估链收敛性的诊断方法包括 Brooks Gelman (1998), Gelman Rubin (1992) 以及 Raftery Lewis (1992).Raftery (1995) 和 Kass Rafteri (1995) 描述了贝叶斯模型的选择和比较。DIC 统计量源自 Spiegelholter et al. (2002)，Spiegelharter et al. (2014) 将 DIC 与其他一些指标进行了比较，并回顾了他们的统计量是如何被接受的。WAIC 统计量由 Watanabe (2010, 2013) 引入，并由 Gelman, Hwang Vehtari (2014) 进一步发展。","code":""},{"path":"chap17.html","id":"chap17","chapter":"第 17 章 使用 R 进行生存分析","heading":"第 17 章 使用 R 进行生存分析","text":"\n本章给出了许多代码块 (code chunk)，默认为全局打开。点击代码块的 “Hide” 可隐藏该代码块 ；若希望全局隐藏以方便阅读，需将页面划到最上方，右侧会显示一个额外的全局控制，将其设为 “Hide Code” 即可（默认为 “Show Code”）。如无法显示/隐藏，可试着将全局控制的两个选项各点一次，原因不详。同时，为尊重原著，未删除代码块中的提示符 > ，因此直接将代码复制粘贴到 R 中并运行是会报错的，需删除该提示符。有许多统计软件包可用于实现本书中描述的技术，其中一些已在第 1 章 1.5 节中提及。其中，R (R Core Team, 2024) 可能是使用得最广泛的，至少有三个原因。首先，已经为各种各样的统计任务开发了 R 包，这些包由作者维护和更新。其次，新统计技术的开发和发布及其在 R 中的实施之间的周期相对较短，并且 R 代码通常伴随着新统计方法的发布。第三，R 是免费软件，可供所有人使用。然而，R 并不是一个容易学习的包，有一些编程经验是一个优势。其输出也往往相当简洁，但有时很难解释。就生存数据的分析而言，本章中的材料应该有助于解决这些问题。本章首先介绍了 R 代码和命名法，概述了数据输入和编辑的基础知识。接着，本章介绍了使用第 2 章至第 16 章描述的方法建模生存数据的 R 包。每种情况下都包含足够的细节，使读者能够快速入门。尽管对于任何特定任务通常都有许多不同的 R 包可以使用，但本章主要关注用于展示本书所涉技术的那些包。在某些情况下，这里展示的 R 代码可能不是最优雅或最简洁的，但应该相对容易理解。本章并不试图对软件进行全面评述，随着新包的开发和其他包的弃用，本章中的部分材料不可避免地会过时。","code":""},{"path":"chap17.html","id":"sec17-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.1 R 的介绍","text":"R 软件可以从 Comprehensive R Archive Network (CRAN) 下载，网址为 https://www.r-project.org。 该网站链接了许多国家的站点，从这些站点可以下载适用于 Linux, Windows 或 macOS 的 R code. R 的界面相当基础，但通过使用 RStudio Desktop 可以得到增强。RStudio Desktop 是 R 的一个集成开发环境，也是开源的，可从 https://posit.co/download/rstudio-desktop/ 下载。\n除了具有源代码编辑器，可以在运行 R 命令之前输入命令外，RStudio 还简化了保存和检索文件以及访问命令语法帮助的操作。当运行代码时，输出会出现在单独的窗口中，还有用于图形的窗口、工作区中的变量列表以及已使用命令的历史记录。安装 R 和 RStudio 后，可以通过打开 RStudio 来启动 R.与 R 的交互是通过带有 “>” 提示符的命令行进行的。在后续给出的代码中，R 命令将以 “>” 为前缀，但是该符号不是命令的一部分。R 命令直接或通过 RStudio 中的源编辑器输入到 R 工作区中。通常，使用 setwd(工作目录名称) 指定可以存储 R 代码的工作目录或文件夹比较方便，并且可以使用 getwd() 检查当前目录的名称。","code":""},{"path":"chap17.html","id":"sec17-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.2 数据输入和编辑","text":"用于生存分析的数据集通常具有与生存时间、删失或状态指示符以及解释变量或因子相对应的列，而行则包含每个个体的变量值。要使用 R 进行分析的数据集称为数据框 (dataframe)，这是一个矩形数组，其中列对应于变量，行对应于观测。变量的值可直接读入，例如其中 <- 是赋值运算符。在许多情况下，可以使用等号 =。函数 c 将函数的自变量组合成一个向量。然后 R 可以用作计算器来操纵变量的值，如用于计算 \\(y = x \\log(x) + \\exp(x^3/20)\\)，并且可以通过在命令提示符下键入 print(y) 或简单地输入 y 来输出结果。也可在计算中使用统计函数，例如要创建包含变量 x 和 y 的 R 数据框，请将值分配给数据框名称，如下所示可以使用前缀 # 将注释添加到 R 代码中。这一系列计算步骤产生的输出如下所示。请注意，某些命令（例如 data.frame）由两个单词组成，并用点分隔它们。变量名称还可以包含点，如 newdata.x，并且所有变量名称和命令名称都区分大小写。有大量数学和统计函数可以这种方式操作数据，包括用于条件执行语句、数据取子集、矩阵代数等命令。任何命令的帮助文档，例如 data.frame，都可以使用 help(data.frame) 获得。","code":"> x<-c(3.6,4.2,7.5,5.8,3.6)> y<-x*log(x)+exp(x^3/20)> mean(x)\n> sd(x)> testdata<-data.frame(x,y)> y\n[1] 1.491812e+01 4.665302e+01 1.448436e+09 1.726076e+04 1.491812e+01\n> # 形成 x 值的均值和标准差\n> mean(x)\n[1] 4.94\n> sd(x)\n[1] 1.690562\n> # 根据 x 和 y 构造数据框\n> testdata<-data.frame(x,y)\n> testdata\n    x            y\n1 3.6 1.491812e+01\n2 4.2 4.665302e+01\n3 7.5 1.448436e+09\n4 5.8 1.726076e+04\n5 3.6 1.491812e+01"},{"path":"chap17.html","id":"sec17-2-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.2.1 从文件中读取和操作数据","text":"本书的数据集均可从出版商网站 https://www.routledge.com/\n获得（译者注：具体链接为这里），并且可使用 read.table 函数读入 R 并形成数据框。假设本章中使用的数据集位于当前工作目录中。示例 1.2 中有关女性确诊为乳腺癌后的生存时间数据可输入并分配给名为 bcancer 的数据框，如这里，引号中的文件名是完整路径名，或者如果数据文件存储在当前目录中，则只是数据文件本身的名称。选项 header=TRUE 表示变量名称已包含在数据集中，并且这些变量名称将用作数据框中的变量名称。请注意，为了使表 1.2 提供的数据适用于基于计算机的分析，time 和 status 这两个变量表示右删失数据，其中如果观测时间是事件，则 status=1，否则 status=0。可以使用 print 函数检查数据框，如 print(bcancer) ，或者只需在提示符处键入数据框名称，如在前五个观测后，输出被截断。另一个有用的命令是 summary，它给出数据框中变量的描述性统计信息，如经常会发生具有相同名称的变量在不同数据框中使用的情况。为了引用特定数据框中的特定变量，使用 $ 符号来链接数据框名称和变量名称。例如，要通过将变量 stain 的值从 1, 2 转换为 0, 1 来形成新的变量 stain1，请使用操作数据集时通常需要的另一个过程是创建因子的工具。在乳腺癌数据集中，stain 是值为 1, 2 的变量。要将其设置为具有两个水平的因子，并分别将它们标记为“阴性”和“阳性”，请使用在该代码中，因子标签的分配顺序与数据中的顺序相同，因此当 bcancer$stain=1 时，因子水平被标记为 “Negative”.要退出 R 会话，请使用 quit，这样您可以选择保存当前工作空间的内容以供将来使用。但是，要将工作区专门保存在 RData 类型的文件中，并在以后进行恢复，可以使用以下代码在许多关于 R 的教科书中描述了可以进行的进一步操作，其中一些在本章末尾的延伸阅读部分提到。","code":"> bcancer<-read.table(\"Prognosis for women with breast cancer.dat\", header=TRUE)> bcancer\n   stain time status\n1      1   23      1\n2      1   47      1\n3      1   69      1\n4      1   70      0\n5      1   71      0\n .  .  .  .  .  .  .> summary(bcancer)\n     stain            time            status      \n Min.   :1.000   Min.   :  5.00   Min.   :0.0000  \n 1st Qu.:1.000   1st Qu.: 40.00   1st Qu.:0.0000  \n Median :2.000   Median : 71.00   Median :1.0000  \n Mean   :1.711   Mean   : 96.24   Mean   :0.5778  \n 3rd Qu.:2.000   3rd Qu.:148.00   3rd Qu.:1.0000  \n Max.   :2.000   Max.   :225.00   Max.   :1.0000  > bcancer$stain1<-bcancer$stain-1> bcancer$stainf<-factor(bcancer$stain,labels=c(\"Negative\",\"Positive\"))> save.image(\"breast cancer analysis\") \n> load(\"breast cancer analysis\")"},{"path":"chap17.html","id":"sec17-2-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.2.2 R 包","text":"R 程序具有许多操作、分析和展示数据的功能，其中一些功能已在本节中概述。然而，R 的强大之处是通过使用包 (packages) 来实现的。包由代码、示例数据和文档组成，可从 Comprehensive R Archive Network (CRAN) 下载。通常，一个包包含了许多用于包内特定任务的函数。现已有数千个包，涵盖统计技术、数据可视化、数据操作、机器学习、报告生成等。当需要用于某些特定目的时，可以通过首先安装包将包合并到R中。然后将已安装的包加载到当前工作区中，以使它们能够在 R 会话中使用。对于生存分析来说，一个特别重要的包是 survival 包。 CRAN 网站上包含完整的文档，作者提供了描述该软件包 Therneau (2024) 附带的 vignettes. 该软件包实现了多种生存分析方法，包括描述性技术、Cox 回归建模、参数建模、时依变量建模、脆弱建模和模型检查技术。base R 软件包含许多广泛使用的软件包，包括 survival，但是可以使用以下命令安装和加载该软件包以及任何其他软件包可以使用 library() 检查库中的包列表。许多软件包需要其他软件包才能正常工作，这些软件包将与主软件包一起下载。在以下各节中，按照本书的章节顺序，给出了用于实现生存数据建模特定技术的 R 代码。","code":"> install.packages(\"survival\") \n> library(\"survival\")"},{"path":"chap17.html","id":"sec17-3","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.3 非参数程序","text":"分析生存数据的第一步通常是绘制两组或多组数据的生存函数的 Kaplan-Meier 估计。要在 R 中执行此操作，请使用 survival 包中的 survfit 函数。以下代码可用于估计乳腺癌预后数据中两组女性的生存函数survfit 函数包含一个 survival 对象 Surv，用于描述模型公式中的响应变量。它的参数是生存时间和删失指示符，在本例中是 time 和 status。然后使用符号 ~ 将其链接到模型公式。如果模型中没有项，则模型公式可能仅包含 1，否则它是一串用符号 + 连接的变量和因子名称。还可以使用冒号 : 来连接项以构成交互作用项，以便 x 中变量的系数取决于 中因子水平，这由 :x 表示。在前面的代码中，指示了对两个染色组 Kaplan-Meier 估计的请求，但忽略组别的总体估计将使用 Surv(time,status) ~ 1 获得。summary 函数给出了每个 stain 值的生存函数估计的数值总结，该值可以是变量也可以是因子。stain=1 的 summary 输出如下在这段代码中，survfit 的结果被保存到 survfit 对象 km 中。该对象包含可以提取或用于补充命令的信息。例如，使用带有 km 的 plot 函数可获得两个生存函数的图形，如并得出与第 2 章图 2.9 所示非常相似的图。plot 函数有许多选项可用于自定义 CRAN 文档中描述的图形。还有其他的绘图函数，包括 lattice 包中的 xyplot 和 ggplot2 包。survival 包中的 R 函数 surfdiff 可用于执行第 2 章 2.6 节描述的 log-rank 和 Peto-Peto 检验。该函数使用的检验统计量是 \\(d_{1j}\\) 和 \\(e_{1j}\\)（在 \\(r\\) 个事件时间的第 \\(j\\) 个事件时间，一组中观测的和预期的死亡人数）之差的加权和，由下式给出\\[\\begin{aligned}U_T&=\\sum_{j=1}^rw_j(d_{1j}-e_{1j})\\end{aligned}\\]权重为 \\(w_j=[\\hat{S}_{KM}(t_{(j)})]\\rho\\)，其中 \\(\\hat{S}_{KM}(t_{(j)})\\) 为在假设两组生存函数之间没有差异的情况下，在第 \\(j\\) 个有序事件时间 \\(t_{(j)},j=1,2,\\ldots,r\\) 处的总体生存函数。当 \\(\\rho=0\\) 时（这是 \\(\\rho\\) 的默认值），得到 log-rank 检验，\\(\\rho=1\\) 给出了 Peto-Peto 检验。对于乳腺癌预后数据，其中数据包含在 R 数据框 bcancer 中，可以利用 survediff 使用以下代码进行 log-rank 检验使用 print(lr) 得到以下输出，这与第 2 章示例 2.12 中的计算结果一致输出给出了每个染色组观测的和预期的事件数，最后一列中的检验统计量标题为 (O-E)^2/V。无论在计算中使用哪一组，检验统计量都是相同的。在这个例子中，默认的小数位数有时是不够的。输出中的位数可以通过使用 print 函数的 digits= 选项来更改，如 print(lr,digits=5)。结果输出的卡方值为 3.515（\\(P=0.0608\\)）。Wilcoxon 检验未在 survival 包中实现，但由于结果通常与 Peto-Peto 检验的结果非常相似，因此可以使用它来代替。为此，我们在 survdiff 中包含选项 rho=1。进行 Peto-Peto 检验所需的代码和输出如下结果与示例 2.13 中的计算一致。如果特别需要 Wilcoxon 检验，则在首次安装 PHInfiniteEstimates 包后，可以按以下方式使用 PHInfiniteEstimates 包中的 R 函数 gehan.wilcoxon.test再次与示例 2.13 中的计算一致。这些检验的 R 代码可以扩展为包含多个因子，并且可以通过在模型公式中包含 strata 项来实现第 2 章 2.8 节描述的分层检验。","code":"> km<-survfit(Surv(time,status) ~ stain,data=bcancer)\n> summary(km)> km<-survfit(Surv(time,status) ~ stain,data=bcancer)\n> summary(km)\nCall: survfit(formula = Surv(time, status) ~ stain, data = bcancer)\n\n                stain=1 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n   23     13       1    0.923  0.0739        0.789        1.000\n   47     12       1    0.846  0.1001        0.671        1.000\n   69     11       1    0.769  0.1169        0.571        1.000\n  148      6       1    0.641  0.1522        0.402        1.000\n  181      5       1    0.513  0.1673        0.271        0.972> plot(km,xlab=\"Survival time\",ylab=\"Estimated survivor function\")> lr<-survdiff(Surv(time,status) ~ stain,data=bcancer)Call:\nsurvdiff(formula = Surv(time, status) ~ stain, data = bcancer)\n\n         N Observed Expected (O-E)^2/E (O-E)^2/V\nstain=1 13        5     9.57      2.18      3.51\nstain=2 32       21    16.43      1.27      3.51\n\n Chisq= 3.5  on 1 degrees of freedom, p= 0.06 > pp<-survdiff(Surv(time,status) ~ stain,rho=1,data=bcancer)\n> print(pp)\n\nCall:\nsurvdiff(formula = Surv(time, status) ~ stain, data = bcancer, \n    rho = 1)\n\n         N Observed Expected (O-E)^2/E (O-E)^2/V\nstain=1 13      3.0      6.6      1.97      4.11\nstain=2 32     15.7     12.1      1.08      4.11\n\n Chisq= 4.1  on 1 degrees of freedom, p= 0.04 > library(\"PHInfiniteEstimates\")\n> gehan.wilcoxon.test(Surv(time,status) ~ stain,data=bcancer)\n\n    Gehan-Wilcoxon\n\ndata:  \n= 4.18, p-value = 0.0409\nalternative hypothesis: two-sided"},{"path":"chap17.html","id":"sec17-4","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.4 Cox 回归模型","text":"给出第 \\(\\) 个个体（共 \\(n\\) 个）在时间 \\(t\\) 发生事件风险的 Cox 回归模型为\\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\\end{aligned}\\]其中 \\(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\) 是第 \\((=1,2,\\ldots,n)\\) 个个体解释变量值的线性组合。 \\(h_0(t)\\) 是未指定的基线风险函数。该模型可以使用 survival 包中的 R 函数 coxph 进行拟合。指定模型的语法与函数 surfit 中使用的语法相同，因为 Surv 对象链接到模型公式。如何处理结生存时间是一个重要的问题，这在第 3 章 3.3.2 节讨论过。许多 Cox 回归分析软件包使用 Breslow 法作为默认方法，主要是因为它在计算上很简单。然而，R生存函数 coxph 默认使用 Efron 法，因为该法更准确。这意味着 R 的默认输出可能与其他软件包的输出不匹配。为了更改 coxph 中处理结的方法，包含选项 ties=\"breslow\"，如下所示。输出将与本书中使用 Breslow 法的示例相对应。为了说明 coxph 函数的使用，将使用第 1 章示例 1.3 中给出的 48 名多发性骨髓瘤患者的生存时间数据。下面给出了用于输入数据并拟合包含变量 \\(Hb\\) 和 \\(Bun\\) 的 Cox 回归模型的 R 代码。使用 summary(coxregfit) 将得到如下输出拟合的 Cox 回归模型中变量 \\(Hb\\) 和 \\(Bun\\) 的系数估计分别为 -0.1336 和 0.0186，标准误分别为 0.0620 和 0.0057。输出中包括了基于统计量 \\(z=\\hat{\\beta}/\\text{se}(\\hat{\\beta})\\) 和相应 \\(P\\) 值的 Wald 检验。还给出了风险比 \\(\\exp(\\hat\\beta)\\)，在标题为 lower .95 和 upper .95 的列中还包括了相应的 95% 置信限。然后是一致性度量，即第 3 章3.12.1 节中描述的 c 统计量，以及拟合模型中所有系数均为零的假设的似然比、Wald 和 得分检验结果。这些检验在附录 的 .2 节中进行了定义，但很少使用 Wald 和得分检验。coxph 的输出不包括 \\(−2\\log\\hat L\\) 统计量的值，但这可以使用从 coxph 对象的 coxregfit 中提取该输出的两个值分别是没有解释变量的模型（即零模型）和拟合模型的统计量的值，这些与第 3 章表 3.9 中的值一致。用于比较拟合模型与零模型的似然比检验的结果（如 coxph 的输出所示）是零模型和拟合模型的 \\(−2\\log\\hat L\\) 值之差异，即 215.940 − 202.938 = 13.00。这可以与两个自由度的卡方分布的百分位点进行比较，以检验模型中是否需要 \\(Hb\\) 和 \\(Bun\\)。如第 3 章所述，模型构建方法通常按顺序包含变量，并且通常不关注该检验的结果通常。相反，我们应为每个模型获得 \\(−2\\log\\hat L\\) 统计量，并将由于包含或省略项而引起的变化与卡方分布的百分位点进行比较。然而，当拟合了两个不同的模型时，R 输出中给出的似然比检验统计量之差将与 \\(−2\\log\\hat L\\) 值之差相同。使用 coxph 拟合的模型的 AIC 或 BIC 统计量可以通过分别将 \\(2q\\) 或 \\(q\\log d\\) 添加到 \\(−2\\log\\hat L\\) 的值来直接获得，其中 \\(q\\) 是模型中 \\(\\beta\\) 参数的数量，\\(d\\) 是未删失观测的数量。或者，函数 extractAIC 可以应用于 coxph 对象。默认给出 AIC，但使用选项 k= 可用于设置 \\(\\log d\\) 来给出 BIC。使用 k=2（默认值）将给出 AIC 的标准公式。例如，确诊为多发性骨髓瘤患者的生存时间数据有 \\(d=36\\) 个事件。该值可利用 coxph 对象 coxregfit 的 coxregfit$nevent 获取，下面的代码给出包含 \\(Hb\\) 和 \\(Bun\\) 的模型的 AIC 和 BIC 统计量。在该输出中，第一个数字是模型中参数数量 \\(q\\) 的值，以及 AIC = 206.94，BIC = 210.10.","code":"> myeloma<-read.table(\"Survival of multiple myeloma patients.dat\", header=TRUE) \n> coxregfit<-coxph(Surv(time,status) ~ hb+bun,ties=\"breslow\", data=myeloma)Call:\ncoxph(formula = Surv(time, status) ~ hb + bun, data = myeloma, \n    ties = \"breslow\")\n\n  n= 48, number of events= 36 \n\n         coef exp(coef)  se(coef)      z Pr(>|z|)   \nhb  -0.133639  0.874906  0.062051 -2.154  0.03126 * \nbun  0.018571  1.018745  0.005674  3.273  0.00106 **\n---\nSignif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1\n\n    exp(coef) exp(-coef) lower .95 upper .95\nhb     0.8749     1.1430    0.7747     0.988\nbun    1.0187     0.9816    1.0075     1.030\n\nConcordance= 0.672  (se = 0.053 )\nLikelihood ratio test= 13  on 2 df,   p=0.002\nWald test            = 14.86  on 2 df,   p=6e-04\nScore (logrank) test = 17.76  on 2 df,   p=1e-04> -2*coxregfit$loglik\n[1] 215.9399 202.9382> # AIC \n> extractAIC(coxregfit)\n[1]   2.0000 206.9382\n\n> # BIC \n> extractAIC(coxregfit,k=log(coxregfit$nevent))\n[1]   2.0000 210.1052"},{"path":"chap17.html","id":"sec17-4-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.4.1 变量选择和 lasso","text":"R 不包括用于变量选择的自动程序，因为它们有许多缺点，如第 3 章 3.6 节所述。然而，survival 包中的 anova 函数给出当按照模型公式中出现的顺序依次向模型中添加项时得到的 \\(−2\\log\\hat L\\) 的值。例如，anova(coxregfit) 的输出如下所示。这给出了最大化偏对数似然的值（从零模型开始，添加 \\(Hb\\)，然后添加 \\(Bun\\)），可以将其乘以 −2 以给出 \\(−2\\log\\hat L\\) 统计量。标题为 Pr(>|Chi|) 的列中的 \\(P\\) 值指的是序贯地添加每个项时 \\(−2\\log\\hat L\\) 的变化的显著性。将 \\(Hb\\) 添加到零模型中会显著降低 \\(−2\\log\\hat L\\)，将 \\(Bun\\) 添加到包含 \\(Hb\\) 的模型中也是如此。\\(Bun\\) 的 \\(P\\) 值 0.0043 对应于在考虑 \\(Hb\\) 的效应后，该变量对死亡风险的效应的显著性。为了了解调整 \\(Bun\\) 后 \\(Hb\\) 的显著性，在 coxph 命令中以相反的顺序给出这两个变量，如下所示第 3 章 3.7 节描述了使用 lasso 来进行 Cox 回归模型的变量选择，这可以使用 penalized 包中的 R 函数 penalized 来实现。现使用 lasso 程序来确定在拟合多发性骨髓瘤患者生存数据的 Cox 回归模型中需要七个潜在解释变量中的哪一个，如第 3 章示例 3.7 所示。安装并加载 penalized 包后（如 17.2.2 节所述），lasso 程序通过如下代码来实施survival 对象 Surv(time,status) 再次用作响应，但模型公式在 penalized= 选项中给出。请注意，公式开头需要一个 ~ 符号。如果只惩罚某些参数，则可以在 unpenaltized= 选项中声明其余参数。选项 lambda1=0 指定使用 \\(L_1\\) 范数惩罚，它对应于 lasso，最小值为零。steps= 选项指定要使用 20 个 \\(\\lambda\\) 值。选项 steps=\"Park\" 使用 Park Hastie (2007) 中描述的方法自动选择步长。若选项 standardize= 设置为 TRUE，则将解释变量设置在类似的测量尺度上，如 3.7.2 节所述。通过将 penalized 对象分配给 penfit，如下 R 命令给出对应于每个 lasso 参数 \\(\\lambda\\) 值的偏对数似然值，以及 \\(\\lambda\\) 值的系数估计的轨迹，如图 3.2 所示。","code":"Analysis of Deviance Table\n Cox model: response is Surv(time, status)\nTerms added sequentially (first to last)\n\n      loglik  Chisq Df Pr(>|Chi|)   \nNULL -107.97                        \nhb   -105.53 4.8717  1   0.027300 * \nbun  -101.47 8.1300  1   0.004354 **\n---\nSignif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1> coxregfit<-coxph(Surv(time,status) ~ bun+hb,ties=\"breslow\",\n                   data=myeloma) \n> anova(coxregfit)> penfit<-penalized(Surv(time,status),penalized= ~ hb+bun+age+sex+\n                      ca+protein+pcells,lambda1=0,steps=20,standardize=TRUE,\n                  data=myeloma)> print(penfit) \n> plotpath(penfit)"},{"path":"chap17.html","id":"sec17-4-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.4.2 预测能力和解释的变异的度量","text":"第 3 章 3.12 节总结了预测能力和解释的变异的各种度量。Harrell’s \\(c\\) 统计量可使用 survival 包中的 concordance 函数计算，Gönen Heller 的预测能力度量及其标准误可以使用 CPE 包中的函数 phcpe 计算，如下所示\\(c\\) 统计量也包含在 summary(coxregfit) 的输出中。总结预测能力的 \\(D\\) 统计量以及表示为 \\(R^2_P\\) 和 \\(R^2_D\\) 的解释的变异的度量可以使用 survival 包中的 royston 函数获得。为多发性骨髓瘤数据拟合的包含 \\(Hb\\) 和 \\(Bun\\) 的模型的这些统计量如下所示。在该输出中，前两项是 \\(D\\) 统计量的值及其标准误，以第 3 章 3.12 节的表示法，R.D 为 \\(R^2_D\\)，R.KO 为 \\(R^2_P\\)。此外，R.N 为 Nagelkerke’s \\(R^2\\) 值 (Nagelkerk, 1991)，C.GH 是 Gönen Heller 的一致性度量。这些度量值与第 3 章表 3.20 所示值一致。","code":"> concordance(coxregfit) # Harrell's c 统计量\nCall:\nconcordance.coxph(object = coxregfit)\n\nn= 48 \nConcordance= 0.6716 se= 0.05308\nconcordant discordant     tied.x     tied.y    tied.xy \n       585        286          0         20          0\n\n> phcpe(coxregfit,CPE.SE=TRUE) # Gonen-Heller statistic\n$CPE\n[1] 0.6694815\n\n$CPE.SE\n[1] 0.04128793> royston(coxregfit)\n        D     se(D)       R.D      R.KO       R.N      C.GH \n1.0076162 0.3505868 0.1950951 0.2728951 0.2399530 0.6694815 "},{"path":"chap17.html","id":"sec17-4-3","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.4.3 时依 ROC 曲线","text":"函数 survivalROC（在同名包中）可用于为生存数据拟合模型后估计时依 ROC 曲线。ROC 曲线由拟合模型的风险评分或线性预测器形成，默认情况下，风险评分的唯一值用作计算真阳性率和假阳性率的阈值。由于 survivalROC 仅需要风险评分来估计时依 ROC 曲线，因此该函数可与任何参数生存模型以及 Cox 回归模型一起使用。为多发性骨髓瘤数据拟合 Cox 回归模型后，可以使用以下命令从 coxph 对象 coxregfit 中提取风险评分或线性预测器然而，lp1 中风险评分的结果值基于以均值为中心的变量 Hb 和 Bun 的值。因为 \\(Hb\\) 和 \\(Bun\\) 值的平均值分别为 10.2521 和 33.9167，这意味着线性预测器或风险评分是\\[\\begin{aligned}-0.13364~(Hb-10.2521)+0.01857~(Bun-33.9167)\\end{aligned}\\]基于未转换变量的得分为 \\(-0.13364Hb+0.01857Bun\\)，若要根据以零为中心的变量值计算，可以使用以下代码这样做的效果是将每个变量的系数和样本均值的乘积之和加到由变量的中心值形成的线性预测器中。安装并加载 survivalROC 后，可以通过以下方式使用 survivalROC 函数获得 12 个月时的时依 ROC 曲线的坐标。在该代码中，Stime= 和 status= 指定为骨髓瘤数据框中的生存时间和删失指示符，marker= 设置为 lp0 中的风险评分，时间点使用选项 predict.time=12 设置为 12 个月。使用 method=\"KM\" 指定 Kaplan-Meier 估计方法。利用 survivalROC 对象 mroc，可使用 TP12<-mroc$TP 和 FP12<-mroc$FP 提取每个阈值的真阳性率和假阳性率 以及使用 mroc$AUC 获得 ROC 曲线下面积。之后，可以根据 FP12 绘制 TP12 的图形，得出 12 个月时的 ROC 曲线，如图 3.10 所示。\n还可使用选项 method=\"NNE\" 来实现最近邻估计方法。此外，使用选项 span=0.05，将式 (3.44) 中的平滑参数 \\(\\omega\\) 设为 0.05.","code":"\nlp1<-coxregfit$linear.predictors\nlp0<-lp1+sum(coef(coxregfit)*coxregfit$means)\nmroc<-survivalROC(Stime=myeloma$time,status=myeloma$status,marker=lp0,\n                  predict.time=12,method=\"KM\")"},{"path":"chap17.html","id":"sec17-5","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.5 Cox 回归模型中的模型检查","text":"第 4 章描述的许多模型检查诊断都是基于各种类型的残差。为了说明如何使用 R 获得残差，将再次使用示例 1.3 中首次给出的多发性骨髓瘤患者生存时间数据。","code":""},{"path":"chap17.html","id":"sec17-5-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.5.1 残差分析","text":"通过将 survival 包中的 residuals 函数应用于 survival 对象，可以轻松获得残差。在 17.4 节中，对多发性骨髓瘤数据拟合了 Cox 回归模型，并将结果存储在 survival 对象 coxregfit 中。然后可以得到鞅和偏差残差，并将其分配给变量 martres 和 devres，如下Cox-Snell 和修正的 Cox-Snell 残差可以使用第 4 章的式 (4.6) 和 (4.4) 根据鞅残差计算得分、Schoenfeld 和缩放的 Schoenfeld 残差可分别使用 residuals 函数中的选项 type=c(\"score\"), type=c(\"schoenfeld\") 和 type=c(\"scaledsch\") 获得。鞅和偏差残差对于每个个体都有一个单独的值，并且作为向量提供。然而，得分、Schoenfeld 和缩放的 Schoenfeld 残差是模型中每个个体和每个解释变量的值的矩阵。对于多发性骨髓瘤数据，当 residuals 函数用于获得变量 \\(Hb\\) 和 \\(Bun\\) 的得分残差时，得分残差矩阵具有与数据框相同顺序的 48 行，每行对应每个患者，列对应于 \\(Hb\\) 和 \\(Bun\\) 的得分残差。这些列用数据框中的变量名（即 hb 和 bun）进行标记，但通常可以方便地更改这些名称，以避免与原始数据中的变量混淆。要获得得分残差并将列名更改为 score.hb 和 score.bun，请使用将残差与原始数据一起置与数据框中也很有用，这样就可以很容易地对其进行操作。为此，使用 cbind 函数绑定包含残差的列。例如，若要将利用 residuals 函数计算的包含 Cox-Snell、鞅、偏差和得分残差的列绑定到名为 myeloma 的数据框，请使用可以使用 print(myeloma.res) 检查名为 myloma.res 的对象中变量的值，其中一些变量的前 10 个值如下所示。对于一些诊断图，将生存时间的秩和风险评分与其他残差置于同一数据框中非常有用。通过将 rank 函数应用于生存时间，可以很容易地得出其秩，例如使用 ranktime<-rank(time)。线性预测器 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 可按照 17.4.3 节描述的方式从 coxph 对象获得。所得评分以变量均值为中心，但除了横轴上的这种偏移外，残差与风险分数的关系图将与第 4 章中所示的相同。然而，本书中使用的未中心化的风险评分可以使用如下命令获得然后可将其与数据框 myeloma.res 绑定然后可绘制残差图它给出了如图 4.6 所示的偏差残差与风险评分的关系图。4.2.1 节中描述的 Cox-Snell 残差的累积风险图可以通过使用 survfit 函数并将残差指定为时间变量来获得。即\n累计风险估计可从 survfitc 对象 cskm 中找到，即 cskm$cum，这给出了 2.3.3 节中定义的累积风险函数的 Nelson-Aalen 估计。累积风险函数也可根据 \\(-\\log\\hat{S}(r_{C{}})\\) 估计，其中，\\(\\hat{S}(r_{C{}})\\) 是 Cox-Snell 残差的生存函数的 Kaplan-Meier 估计，这是使用 ch<- -log(cskm$surv) 计算的。然后，可绘制累积风险关于 Cox-Snell 残差（通过 cskm$time 获得）的图形，即 plot(ch ~ cskm$time)。所得图形与图 4.5 相似。\nSchoenfeld 残差矩阵对于数据集中的每个事件时间有一行，每个变量有一列。行按与事件时间相关的变量排序。这些很难与其他残差组合在一起，但 Schoenfeld 残差和缩放的 Schoenfeld 残差的矩阵的行以事件时间作为标签。例如，多发性骨髓瘤数据的 Schoenfeld 残差可使用如下代码获得矩阵 schoenres 的前 10 行为同样，列可以重新命名，将行标签中的列（即事件时间）转换为变量也很有用。然后将矩阵转换为数据框以进行进一步操作，这通过如下代码完成并得到包含变量 time 的数据框 schoenres。获取并操作缩放的 Schoenfeld 残差矩阵也是类似地。这得到了一个数据框，可以轻松地用于生成缩放的 Schoenfeld 残差与事件时间的关系图，以检查比例风险的假设，如第 4 章 4.4.2 节所述。","code":"> martres<-residuals(coxregfit,type=c(\"martingale\"))\n> devres<-residuals(coxregfit,type=c(\"deviance\"))> csres<-myeloma$status-residuals(coxregfit,type=c(\"martingale\")) \n> modcsres<-1-residuals(coxregfit,type=c(\"martingale\"))> scoreres<-residuals(coxregfit,type=c(\"score\")) \n> colnames(scoreres)<-c(\"score.hb\",\"score.bun\")> myeloma.res<-cbind(myeloma,csres,martres,devres,scoreres)   patient time status      csres     martres      devres      score.hb   score.bun\n1        1   13      1 0.23014540  0.76985460  1.18253068  3.2999546008   2.4140876\n2        2   52      0 0.90494858 -0.90494858 -1.34532419 -1.9303609057  13.8875587\n3        3    6      1 0.13748042  0.86251958  1.49783457  1.8290988299  -7.3828723\n4        4   40      1 0.87666446  0.12333554  0.12880543  0.1792547576   1.9590824\n5        5   10      1 0.20639730  0.79360270  1.25247724  2.9277335613  -2.6913044\n6        6    7      0 0.15889219 -0.15889219 -0.56372367 -0.0772011450   6.0619565\n7        7   66      1 1.34525433 -0.34525433 -0.31199757 -3.0274073993   7.0127113\n8        8   10      0 0.27393472 -0.27393472 -0.74018204 -1.2483218431  -0.1676842\n9        9   10      1 0.60622895  0.39377105  0.46200976 -0.8189308283  12.1545183\n10      10   14      1 0.57177193  0.42822807  0.51144310 -0.0216079855  12.5389899> rscore<-coxregfit$linear.predictors+\n  sum(coef(coxregfit)*coxregfit$means)> myeloma.res<-cbind(myeloma.res,rscore)> plot(devres ~ rscore,data=myeloma.res)>  cskm<-survfit(Surv(csres,status) ~ 1,data=myeloma.res)> schoenres<-residuals(coxregfit,type=c(\"schoenfeld\"))> print(schoenres)\n           hb       bun\n1 -0.04266125  78.30817\n1 -4.34266125 -66.69183\n1  1.85733875 -30.69183\n4  0.61182088 100.34294\n4 -2.98817912 -23.65706\n5  0.25208340 -28.41657\n5  0.95208340 -15.41657\n5  0.75208340  88.58343\n5 -0.44791660 -18.41657\n6  2.10211724 -12.21550> colnames(schoenres)<-c(\"schoen.hb\",\"schoen.bun\") \n> schoenres<-cbind(time=rownames(schoenres), \n                   data.frame(schoenres,row.names=NULL)) \n> print(schoenres)"},{"path":"chap17.html","id":"sec17-5-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.5.2 识别有影响的观测","text":"delta-beta，即 \\(\\Delta_i\\hat{\\beta}_j\\) 是模型拟合过程中省略第 \\(\\) 个观测时第 \\(j\\) 个参数估计的近似变化。该量也可以缩放以给出标准化的 delta-beta。这两个量均在第 4 章 4.3.1 节进行了描述，用于探索特定观测如何影响参数估计及其显著性。这两个统计量都可从 survival 包中的 residuals 函数中获得。例如，对于为多发性骨髓瘤数据拟合的 Cox 回归模型中两个变量 \\(Hb\\) 和 \\(Bun\\)，其 delta-beta 和缩放的 delta-beta 可通过如下命令得到这两个函数都会生成一个矩阵，其行对应于 48 名患者，列对应于两个解释变量 \\(Hb\\) 和 \\(Bun\\)。可以更改列名称，并将该矩阵与包含其他诊断的数据框 myeloma.res 合并，方法与 17.5.1 节中的得分残差相同。在第 4 章 4.3.2 节介绍的两个统计量 \\(LD_i\\) 和 \\(|\\boldsymbol{l}_{\\max}|_i\\)，度量了个体观测对参数估计集的影响，可以很容易使用 R 的矩阵代数功能获得。具体而言，似然位移 \\(LD_i\\) 是式 (4.16) 中矩阵 \\(\\boldsymbol B\\) 的第 \\(\\) 个对角元，\\(|\\boldsymbol l_\\max|_i\\) 是与 \\(\\boldsymbol B\\) 的最大特征值相对应的特征向量。对于多发性骨髓瘤数据，这些诊断可从拟合模型中的得分残差、得分和参数估计的方差-协方差阵中获得，该矩阵是从 coxph 对象 coxregfit 的 coxregfit$var 获得的。下面的 R 代码实现了这一点。在此代码中，使用 %*% 运算符执行矩阵乘法，函数 t 用于获得矩阵的转置。矩阵运算 diag 给出 \\(\\boldsymbol B\\) 的对角元，函数 eigen 返回一个分量列表，包括按降序排列的特征值和相应的标准化特征向量。将该列表指定为 e，与最大特征值对应的特征向量是第一个特征向量，对应于特征向量形成的矩阵中的第一列，这可以使用 e$vectors[,1] 来访问。然后将这些值的绝对值指定为 lmax。可以使用 cbind 函数将变量 LD 和 lmax 添加到另一个数据框中，以进行进一步分析。","code":"> db<-residuals(coxregfit,type=c(\"dfbeta\")) \n> dbs<-residuals(coxregfit,type=c(\"dfbetas\"))> B<-scoreres%*%coxregfit$var%*%t(scoreres) \n> LD<-diag(B) \n> e<-eigen(B) \n# 按递减顺序给出特征值\n> lmax<-abs(e$vectors[,1])"},{"path":"chap17.html","id":"sec17-5-3","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.5.3 检验比例风险假设","text":"第 4 章4.4.1 节描述的数据的对数累积风险图可以根据生存函数的 Kaplan-Meier 估计得出。在第 4 章的示例 4.9 中，与血清血红蛋白水平相关的变量 \\(Hb\\) 被重新定义为具有四个水平的因子，并检查了在这些水平上的比例风险假设。可通过如下命令在 myeloma 数据框中为因子 hbfactor 定义四个水平 1, 2, 3, 4并使用如下命令生成 survfit 对象 km1survfit 对象包括变量 km1$time 和生存函数 km1$surv 的 Kaplan-Meier 估计。要绘制对数累积风险，必须将 \\(Hb\\) 的因子水平附加给 km1 对象。由于该对象与原始数据框的长度不同，因此无法直接将 km1 对象与 hblevels 中的因子水平合并。然而，km1 包含了与血红蛋白水平相关的变量 km1$strata，该变量可用于生成 \\(Hb\\) 的因子水平，如下该命令将值 1, 2, 3, 4 分配给 hblevels，并根据四个层中的观测数重复每个水平。对数累积风险图可使用对数累积风险的 Nelson-Aalen 估计或 Kaplan-Meier 估计来获得，通过如下的 plot 函数获得plot 中的选项 pch= 为每个 \\(Hb\\) 水平提供了不同的绘图符号。这两个图非常相似，但第二张图得到了图 4.13.\n事实上第二张图与图 4.13 稍有不同。为复现图 4.13，生存函数估计和 km1 对象中的生存时间需要限制在事件时间内。一种方法是将生存函数估计值、生存时间、变量 hblevels 和每次事件的数量保存到数据框 lchplotdata 中。然后使用如下命令选择 km1$n.event>0 的行的子集\n第 4 章 4.4.2 节描述的缩放的 Schoenfeld 残差与生存时间的关系图也可用于评估比例风险假设的有效性。该图可按照 17.5.1 节末尾描述的方式从缩放的 Schoenfeld 残差矩阵中获得。第 4 章 4.4.3 节描述的检验统计量可使用 coxph 对象应用 survival 包中的函数 cox.zph 得到。例如，对于多发性骨髓瘤数据给出了拟合模型中变量 \\(Hb\\) 和 \\(Bun\\) 的各个 Grambsch Therneau 检验的卡方统计量及其 \\(P\\) 值以及总体 zph 检验。","code":"> myeloma$hbfactor<-as.factor(ifelse(myeloma$hb<=7,\"1\",\n                                     ifelse(myeloma$hb<=10,\"2\",\n                                            ifelse(myeloma$hb<=13,\"3\",\n                                                   ifelse(myeloma$hb>13,\"4\",0)))))> km1<-survfit(Surv(time,status) ~ hbfactor,data=myeloma)> hblevels<-rep(c(1,2,3,4),km1$strata)> plot(log(km1$cum) ~ log(km1$time),pch=hblevels)\n> plot(log(-log(km1$surv)) ~ log(km1$time),pch=hblevels)\nlchplotdata<-data.frame(km1$time,km1$surv,\n                        km1$n.event,hblevels) \nlchplotdata<-subset(lchplotdata, km1$n.event>0)\nplot(log(-log(km1.surv)) ~ log(km1.time),pch=hblevels,\n     data=lchplotdata)> cox.zph(coxregfit)"},{"path":"chap17.html","id":"sec17-6","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.6 参数生存模型","text":"生存数据的参数模型，如第 5 章所述，可以使用 survival 包中的 survreg 函数进行拟合。该函数使用 5.11 节中描述的模型的对数线性表示来拟合加速失效时间模型，并且可用于对假定具有指数, Weibull, lognormal 或 loglogistic 等分布的生存时间进行建模。在与第 \\(\\) 个（共 \\(n\\) 个）生存时间相关的随机变量 \\(T_i\\) 的加速失效时间模型中，\\[\\begin{align}\n\\log T_i=\\mu+\\alpha_1x_i+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i\n\\tag{17.1}\n\\end{align}\\]其中 \\(\\mu\\) 和 \\(\\sigma\\) 分别是截距和尺度参数，\\(\\alpha\\) 是模型中 \\(p\\) 个解释变量的系数，\\(\\epsilon_i\\) 是一个随机变量，其概率分布取决于 \\(T_i\\) 的分布。解释变量对生存的效应可总结为时间比 \\(\\exp(\\alpha)\\)，这是对应解释变量值每增加一个单位时，生存时间所乘的倍数。survreg 函数的语法与 coxph 的语法非常相似，默认情况下拟合 Weibull 模型。例如，以下代码可用于为第 1 章示例 1.3 中首次给出的确诊多发性骨髓瘤后的生存时间数据拟合 Weibull 模型。使用 summary(weibfit) 获得如下输出根据该输出，式 (17.1) 的加速失效时间模型中的参数估计为 \\(\\hat\\mu = 2.704，\\hat\\sigma = 0.899\\)，变量 \\(Hb\\) 和 \\(Bun\\) 的系数估计分别为 0.1146 和 -0.0158. 输出中的 Log(scale) 参数就是 \\(\\log \\hat\\sigma\\)。这部分输出给出了每个参数估计的标准误、Wald 统计量（计算为 \\(z=\\hat{\\alpha}/\\mathrm{se}\\left(\\hat{\\alpha}\\right)\\) ）以及相应的 \\(P\\) 值。\\(Hb\\) 和 \\(Bun\\) 均显著影响生存。\\(Hb\\) 值每增加一个单位，生存时间就会增加为原来的 \\(\\exp(0.1146) = 1.121\\) 倍，即增加 12%，而 \\(Bun\\) 值每增加一个单位，生存时间就会减少 1.4%.模型的对数似然 Loglik(model) 使用第 5 章的式 (5.46) 计算，并且 \\(-2\\log\\hat{L}\\) 统计量的值根据 -2*weibfit$loglik 计算，结果为 306.996. 该统计量用于比较替代模型。仅具有截距的模型的对数似然，标记为 Loglik(intercept ),，是零模型的对数似然，输出中的卡方统计量将拟合模型与该零模型进行比较，这种比较通常为意义不大。输出还给出了拟合模型所需的迭代次数以及数据框中的观测值数 n。Weibull 加速失效时间模型也可表示为比例风险模型，其中第 \\(\\) 个个体在时间 \\(t\\) 的死亡风险为\\[\\begin{aligned}h_{\\boldsymbol{}}(t)=\\exp(\\boldsymbol{\\beta'x}_{\\boldsymbol{}})h_{0}(t)\\end{aligned}\\]假定所有解释变量为零的个体的生存时间具有尺度参数为 \\(\\lambda\\) 和形状参数为 \\(\\gamma\\) 的 Weibull 分布，基线风险函数由 \\(h_0(t)=\\lambda\\gamma t^{\\gamma-1}\\) 给出。加速失效时间的参数与 Weibull 模型的比例风险版本之间的对应关系如第 5 章的式 (5.53) 所示。具体来说，模型比例风险版本中的对数风险比为\\(\\beta=-\\alpha/\\sigma\\)。\\(Hb\\) 和 \\(Bun\\) 值单位变化的对数风险比估计分别为 \\(−0.1146/0.899=−0.1275\\) 和 \\(0.0158/0.899=0.0176\\)，从而风险比分别为 0.88 和 1.02.可以使用 survreg 和选项 dist= 来拟合具有其他生存时间分布的加速失效时间模型，该选项具有 \"exponential\", \"loglogistic\" 或 \"lognormal\" 等值。在每种情况下，均会给出式 (17.1) 中对数线性模型中的截距、尺度和 \\(\\alpha\\) 参数。这些模型和其他模型参数之间的对应关系在第 5 章中进行了描述。在每种情况下，输出都与 Weibull 模型获得的输出非常相似，并且使用 \\(-2\\log\\hat{L}\\) 统计量来比较替代模型。例如，使用以下代码为多发性骨髓瘤数据拟合 loglogistic 加速失效时间模型summary(llfit) 得到Weibull 模型和 loglogistic 模型的时间比和对数似然值非常相似。","code":"> weibfit<-survreg(Surv(time,status) ~ hb+bun,data=myeloma)Call:\nsurvreg(formula = Surv(time, status) ~ hb + bun, data = myeloma)\n               Value Std. Error     z       p\n(Intercept)  2.70425    0.57769  4.68 2.9e-06\nhb           0.11456    0.05375  2.13 0.03306\nbun         -0.01580    0.00423 -3.74 0.00019\nLog(scale)  -0.10644    0.12746 -0.84 0.40365\n\nScale= 0.899 \n\nWeibull distribution\nLoglik(model)= -153.5   Loglik(intercept only)= -159.8\n    Chisq= 12.57 on 2 degrees of freedom, p= 0.0019 \nNumber of Newton-Raphson Iterations: 5 \nn= 48> llfit<-survreg(Surv(time,status) ~ hb+bun,dist=\"loglogistic\", \n                 data=myeloma)Call:\nsurvreg(formula = Surv(time, status) ~ hb + bun, data = myeloma, \n    dist = \"loglogistic\")\n               Value Std. Error     z       p\n(Intercept)  2.05628    0.68561  3.00 0.00271\nhb           0.12619    0.06328  1.99 0.04612\nbun         -0.01392    0.00429 -3.25 0.00116\nLog(scale)  -0.45293    0.13562 -3.34 0.00084\n\nScale= 0.636 \n\nLog logistic distribution\nLoglik(model)= -153.6   Loglik(intercept only)= -159.9\n    Chisq= 12.62 on 2 degrees of freedom, p= 0.0018 \nNumber of Newton-Raphson Iterations: 4 \nn= 48 "},{"path":"chap17.html","id":"sec17-7","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.7 灵活的参数模型","text":"第 6 章中介绍的分段指数模型和基于样条函数的灵活参数模型可以很容易地使用 R 进行拟合。","code":""},{"path":"chap17.html","id":"sec17-7-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.7.1 分段指数模型","text":"第 6 章 6.1 节描述的分段指数模型可使用 eha 包中的 phreg34 函数进行拟合。第 3 章示例 3.4 中关于 36 名肾癌患者生存时间的数据将用于说明该函数，第 6 章示例 6.1 中拟合了分段指数模型。首先输入关于生存时间、生存状态以及变量\\(Age\\) 和 \\(Nephrectomy\\) 的数据，并使用以下代码将变量 \\(Age\\) 定义为水平 <60, 60-70 和 >70 的因子。为拟合基线风险函数具有 22 个区间的模型，使其等价于 Cox 回归模型，使用函数 phreg 可用于拟合许多分布，默认为 Weibull. 使用选项 dist=\"pch\" 拟合分段指数模型，选项 cuts= 指定基线风险函数的分割点。使用 print(pefit) 会生成以下输出输出中标题为 W.mean 的列中的条目是变量的加权平均值或因子水平的相对频率。权重是每个因子水平或变量值的患者所占的总观测生存时间的比例。在这个数据集中，36 名患者的总生存时间是 1340 个月，这在输出中标记为 Total time risk。对于因子 \\(Age\\) 的第 1 水平，有 19 名患者，该组的生存时间总和为 862. 第一年龄组患者所经历的总体生存时间的比例则为 \\(862/1340 = 0.643\\)，如输出所示。类似地，对于变量 \\(Nephrectomy\\)，\\(Nephrectomy=0\\) 的患者的总生存时间是 88 个月，而 \\(Nephrectomy=1\\) 的患者的总生存时间是 1252 个月。该变量的加权平均值则为 \\((88 × 0 + 1252 × 1)/1340 = 0.934\\)，如输出所示。下一个输出块给出模型中每一项的系数和风险比，以及它们的标准误和从统计量 \\(z=\\hat{\\beta}/\\text{se}(\\hat{\\beta})\\) 导出的 Wald \\(P\\) 值。因子的风险比是相对于第一水平的，并且与示例 6.1 中使用的一致。统计量 Max. log. likelihood 是拟合模型的最大对数似然，使用 -2*pefit$loglik 将其乘以 -2 即可获得 \\(-2\\log\\hat{L}\\) 统计量。LR test statistic 和相应的 Overall p-value 是拟合模型和零模型之间的比较。phreg 对象 pefit 包含许多其他变量，包括使用 pefit$hazards 得出的 22 个区间中的基线风险函数值。","code":"> kidney<-read.table(\"Treatment of hypernephroma.dat\",header=TRUE) \n> kidney$agef<-factor(kidney$age) \n> levels(kidney$agef)<-list(\"<60\"=1,\"60-70\"=2,\">70\"=3)> pefit <- phreg(Surv(time,status) ~ agef+nephrectomy, dist=\"pch\",\n                 cuts=c(5,6,8,9,10,12,14,15,17,18,21,26,35,36,38,48,52,56, 68,72,84,108,115),data=kidney)Call:\nphreg(formula = Surv(time, status) ~ agef + nephrectomy, data = kidney, \n    dist = \"pch\", cuts = c(5, 6, 8, 9, 10, 12, 14, 15, 17, 18, \n        21, 26, 35, 36, 38, 48, 52, 56, 68, 72, 84, 108, 115))\n\nCovariate          W.mean      Coef Exp(Coef)  se(Coef)    Wald p\nagef \n             <60    0.643     0         1           (reference)\n           60-70    0.316     0.117     1.124     0.427     0.784 \n             >70    0.041     1.508     4.518     0.608     0.013 \nnephrectomy         0.934    -1.536     0.215     0.530     0.004 \n\n\nEvents                    32 \nTotal time at risk          1340 \nMax. log. likelihood      -124.35 \nLR test statistic         13.95 \nDegrees of freedom        3 \nOverall p-value           0.00296981"},{"path":"chap17.html","id":"sec17-7-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.7.2 风险函数的模型","text":"基线风险函数对数的 B 样条模型在贝叶斯生存分析中得到了更广泛的应用，稍后将在 17.15 节中进行说明。","code":""},{"path":"chap17.html","id":"sec17-7-3","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.7.3 对数累积风险函数的模型","text":"如第 6 章 6.4 节所述，使用限制性立方样条对对数风险风险进行建模的 Royston Parmar 模型可以使用软件包 flexsurv 中的函数 flexsurfsurf 进行拟合。一旦安装并加载了该包，就可以轻松拟合具有不同结数的模型。再次考虑第 1 章示例 1.3 中介绍的多发性骨髓瘤确诊后的生存数据，以及 17.4 - 17.6 节使用的数据。如第 6 章 6.4 节所述，没有内部结的 Royston Parmar 模型对应于 Weibull 模型。选项 k= 用于指定结数，因此包含变量 \\(Hb\\) 和 \\(Bun\\) 的 Weibull 模型也可以使用如下命令拟合这会生成如下输出输出的第一部分给出变量 \\(Hb\\) 和 \\(Bun\\) 的样本均值，后面是模型的参数估计。在第 6 章 6.4 节的表示法中，\\(\\hat{\\gamma}_0=-3.0077,\\hat{\\gamma}_1=1.1123\\)，模型线性部分中两个变量的 \\(\\beta\\) 系数估计分别为 -0.1274 和 0.0176. 由于这里使用 Weibull 模型的比例风险版本，这些系数估计是对数风险比，它们的值与 17.4 节中拟合的 Cox 回归模型得到的值非常相似。\\(\\gamma\\) 与 Weibull 基线风险中的参数 \\(h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\) 相关，并且根据第 6 章 6.4 节，\\(\\gamma_0=\\log\\lambda\\) 且 \\(\\gamma_1 = \\gamma\\)。输出展示了系数的标准误及其 95% 置信限。标题为 exp(est) 的列给出了系数的指数，即风险比及其 95% 置信限。在输出观测数、事件数和删失数的总结后，将生存时间的总和展示为 Total time risk。然后是拟合模型的最大对数似然和自由度数，即未知模型参数的数量，以及模型比较中使用的 AIC 统计量。使用一系列具有不同选项 k= 值的 flexsurvspline 函数可以轻松拟合结数不断增加的模型，并使用 AIC 进行比较。第 6 章 6.5 节中描述的具有限制性立方样条函数的比例几率模型也可以使用带有选项 scale=\"odds\" 的 flexsurvspline 函数进行拟合。输出非常相似，但拟合模型的系数估计现在是对数几率比。","code":"> flexsurvspline(Surv(time,status) ~ hb+bun,k=0,data=myeloma)Call:\nflexsurvspline(formula = Surv(time, status) ~ hb + bun, data = myeloma, \n    k = 0)\n\nEstimates: \n        data mean  est       L95%      U95%      se        exp(est)  L95%      U95%    \ngamma0        NA   -3.00773  -4.57689  -1.43858   0.80060        NA        NA        NA\ngamma1        NA    1.11229   0.83442   1.39015   0.14177        NA        NA        NA\nhb      10.25208   -0.12744  -0.24453  -0.01036   0.05974   0.88034   0.78307   0.98970\nbun     33.91667    0.01758   0.00730   0.02786   0.00525   1.01773   1.00733   1.02825\n\nN = 48,  Events: 36,  Censored: 12\nTotal time at risk: 1122\nLog-likelihood = -153.4981, df = 4\nAIC = 314.9963"},{"path":"chap17.html","id":"sec17-8","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.8 参数模型中的模型检查","text":"第 7 章 7.1 节描述的参数模型的残差很容易获得。survreg 对象包含了加速失效时间模型的线性部分估计，由下式给出\\[\\begin{aligned}\\hat{\\eta}_i=\\hat{\\mu}+\\hat{\\alpha}_1x_i+\\hat{\\alpha}_2x_{2i}+\\cdots+\\hat{\\alpha}_px_{pi}\\end{aligned}\\]从中可以得到标准化残差。为多发性骨髓瘤数据拟合后 Weibull 加速失效时间模型后，survreg 对象 weibfit 在 weibfit$linear.prpredictors 中包含了线性预测器 \\(\\hat{\\eta}_i\\)，以及在 weibfit$scale 中包含了尺度参数 \\(\\hat\\sigma\\)。然后使用如下命令得到标准化残差 \\(r_{Si}\\)Cox-Snell 残差是使用第 7 章的式 (7.3) 和 (7.2) 获得的，其中对于 Weibull 分布的特定情况，\\(S_{\\epsilon_i}(\\epsilon)=\\exp(-e^{\\epsilon})\\)，如式 (7.7) 所示，因此 \\(r_{Ci} = \\exp(r_{Si})\\)。这些残差可简单地使用 csres<-exp(stres) 计算。然后使用如下命令计算鞅和偏差残差偏差残差也可以直接使用来获得。然而，如此得到的偏差残差将与根据鞅残差计算出的偏差残差的符号相反。第 7 章 7.1.4 节解释了这种符号差异的原因。与从拟合的 Cox 回归模型中获得的残差一样，残差列可以与数据框绑定，以便按照 @ref*sec17-5-1) 节所述的方式在绘图和进一步分析中使用。","code":"> stres<-(log(myeloma$time)-weibfit$linear.predictors)/weibfit$scale> martres<-myeloma$status-csres \n> devres=sign(martres)*sqrt(-2*(martres+\n                                  myeloma$status*(log(myeloma$status-martres))))> residuals(weibfit,type=c(\"deviance\"))"},{"path":"chap17.html","id":"sec17-8-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.8.1 有影响的值","text":"可以使用第 7 章 7.4 节描述的 delta-beta 统计量来研究拟合参数生存模型中观测对参数估计 \\(\\hat\\alpha\\) 的影响。可以对 survreg 对象应用 residuals ，带上选项 type=c(\"dfbeta\") 或 type=c(\"dfbetas\") 以提取未缩放和缩放的 delta-beta. 第 7 章 7.4.2 节描述的似然位移统计量可使用选项 type=c(\"ldcase\") 得到。","code":""},{"path":"chap17.html","id":"sec17-8-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.8.2 比较观测的和拟合的生存函数","text":"将基于模型的生存函数估计与观测的 Kaplan-Meier 估计进行比较，提供了一种评估模型拟合的非正式方法，如第 7 章 7.3 节所述。需要进行一些操作，以获得具有不同风险评分水平的个体的生存函数，使用 26 名女性接受两种卵巢癌化疗后的生存时间数据来说明该过程，如第 5 章示例 5.11 所示。数据首先被输入并且被指定为数据框 ovarian。然后为数据拟合包含变量 \\(Age\\) 和 \\(Treat\\) 的 Weibull 模型并保存为 survreg 对象 ofit。这是通过如下命令实现的。然后从 Weibull 模型拟合的加速失效时间版本中提取每个患者的风险评分，并将其保存在变量 eta 中。此外，获得每个评分的秩，此外，还获得了每个评分的秩，以便根据评分的秩是否在 1-8, 9-17 或 18-26 的范围内，将患者分为三个风险组。这个变量被添加到数据框中，并得到了第 7 章表 7.2 中所示的分组。完成此操作的代码如下所示。\n接下来，对于 26 名女性中的每一位，计算 Weibull 模型拟合的生存函数，其生存时间 t 的值从 0 到 1200，步长为 50. 这是通过如下代码完成的。结果是一个新的数据框 sdata，具有 \\(25×26=650\\) 行。最后，使用下式计算生存函数估计\\[\\hat{S}(t_i)=\\exp\\left\\{-\\exp\\left(\\frac{\\log t_i-\\hat{\\eta}_i}{\\hat{\\sigma}}\\right)\\right\\}\\]其中 \\(\\hat{\\eta}_i=\\hat{\\mu}+\\hat{\\alpha}_1Age_i+\\hat{\\alpha}_2\\) 为线性预测器。\\(Age_i\\) 和 \\(Treat_i\\) 是第 \\(\\) 个女性的 \\(Age\\) 和 \\(Treat\\) 的值。此 R 代码基于函数 aggregate 来形成 tt 和 group 中值的组合的组均值，如下所示。然后，数据框 avsurv 包含按风险组 group 和时间 tt 划分的 survest 中生存函数估计的均值。最后，可以使用以下命令轻松获得每个风险组的生存函数的 Kaplan-Meir 估计然后，可以将平均生存函数叠加在每组的 Kaplan-Meier 估计图上，该图是从 survival 对象 KMest 使用如下命令获得的给出的图形类似于图 7.5，但在 plot 函数中使用额外的选项来控制布局会得到一个更令人满意的图。","code":"> ovarian<-read.table(\"Chemotherapy in ovarian cancer patients.dat\",\n                      header=TRUE)\n> ofit<-survreg(Surv(time,status) ~ age+treat,data=ovarian)> ovarian$lp=ofit$linear.predictors > ovarian$ranklp<-rank(ovarian$lp) \n> ovarian$group<-as.factor(ifelse(ovarian$ranklp<=8,\"1\", \n                                  ifelse(ovarian$ranklp<=17,\"2\",\n                                         ifelse(ovarian$ranklp>17,\"3\",0))))> ov1<-ovarian[rep(seq_len(26),each=25),]\n> tt<-data.frame(tt=seq(0,1200,by=50))\n> tt<-tt[rep(seq_len(nrow(tt)),26),]\n> sdata<-cbind.data.frame(ov1,tt)> sdata$survest<-exp(-exp((log(sdata$tt)-sdata$lp)/ofit$scale)) \n> avsurv<-aggregate(survest ~ group+tt,FUN=mean,data=sdata)> KMest<-survfit(Surv(time,status) ~ group,data=ovarian)> plot(KMest,xlab=\"Survival time\",ylab=\"Survivor function\") \n> lines(survest ~ tt,pch=c(\"o\",\"+\",\"*\")[as.numeric(group)],type=\"p\", data=avsurv)"},{"path":"chap17.html","id":"sec17-9","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.9 时依变量","text":"通过以计数过程格式表示数据，可以将时依变量纳入 Cox 回归模型。第 8 章 8.3 节概述了该数据格式，第 13 章13.1 节对其进行了更详细的描述。为了实现这一点，通常需要进行一定量的数据操作，并且需要小心避免代码错误。survival 包中的 R 函数 tmerge 可用于表示计数过程格式的数据集。该函数在关于时依变量的 R vignette中进行了描述 (Therneau, Crowson Atkinson, 2022). 总之，该函数用于指定添加时依变量的基础数据集。然后，在函数的后续调用中定义时依变量，并与基础数据集合并。此过程最好用一个例子来说明，将使用骨髓移植治疗白血病的数据。该数据集在第 8 章的示例 8.2 中进行了描述，数据列于表 8.2 中。当患者在血小板水平恢复正常之前死亡时，这在变量 \\(Ptime\\) 中为缺失值，用 . 表示。因此，选项 na.strings=c(\".\") 附加于 read 语句中，从而为缺失值创建 NA。这里不需要变量 \\(Precovery\\)，因此从数据框中删除。使用以下代码还定义了与三个疾病组相关的因子，并删除了疾病组的原始变量。\n然后使用 tmerge 函数以计数过程格式表示数据这导致三个新变量被添加到基础数据框 leukaemia 中。变量 tstart 和 tstop 分别给出每个区间的开始和停止时间（这里都为零），而变量 \\(Time\\) 中的值代表实际的生存时间。选项 id= 指定用于合并使用 tmerge 创建的数据框的标识符，选项 death=event(time,status) 指定新变量 death 用于表示每个时间区间（tstart 到 tstop）结束时个体的状态。数据框 tdvdata 有 23 行，前 5 行如下所示。接下来，第二次调用 tmerge 函数用于指定 \\(Ptime\\) 是表示血小板恢复时间的变量。然后，从这个变量中导出的时变血小板水平指示符与先前创建的数据框 tdvdata 进行合并。选项 tdc= 指定 Plate 为新的时依变量，并将其添加到第一次调用 tmerge 得到的数据中。以下是执行此操作的代码。现在得到的数据框 tdvdata 中，除了两名血小板没有恢复到正常水平的患者外，每位患者都有两行数据。数据现在处于计数过程格式，前六行如下所示。在这种格式中，第一个患者的血小板水平指示符为零，当他的血小板水平恢复正常（第 29 天），血小板水平指示符变为一，其余患者以此类推。现在，可以拟合包含新时依变量的 Cox 回归模型。为此，coxph 函数中的 Surv 对象用于指定开始和停止时间以及每个时间区间结束时患者的状态。使用以下函数调用拟合包含与疾病组相关的因子和时依变量的模型。下面展示了输出结果的一部分，与前面 17.4 节描述的非常相似。根据该输出，时依变量的系数为 −2.3196. 因子 fgroup 的三个水平分别对应于 、低风险 AML 和高风险 AML，并且由第一个水平 fgroup1 的效应设为零。患者在给定时间相对于低风险 AML 患者的风险比为 \\(\\exp(0+2.0761)=7.97\\)，并且高风险 AML 患者相对于低风险患者在给定时间的风险比是 \\(\\exp(0.3894+2.0761)=11.77\\)，正如示例 8.2 中发现的。为了进一步说明函数 tmerge 的使用，给出了 R 代码用于分析示例 8.4 来自肝硬化治疗假设研究的数据。第一步是将表 8.4 中的基本数据与表 8.5 中的数据结合起来，给出时变的 log(bilirubin) 值。首先使用以下命令输入两个数据集\n要创建的时变变量需要包括时间起点的 log(bilirubin) 值，即表 8.4 中的基线值。这可以通过构建一个包含患者编号、时间起点和基线 log(bilirubin) 值的数据框，然后将其与表 8.5 中的数据结合，并确保合并后的数据集按患者和随访时间顺序排列来实现。以下是实现这一目标的代码。数据框 lbrdata 现在与基线数据合并，以生成计数过程格式的数据集。这可以使用下面两个 tmerge 函数调用来完成。患者 5 和 8 在其死亡的同一天记录了 log(bilirubin) 值。当使用时依变量时，在给定时间记录的值在该时间之后立即应用，因此，在第 341 天为患者 5 记录的 log(bilirubin) 的新值和在第 182 天为患者 8 记录的 log(bilirubin) 的新值将不会出现在分析中。合并后的数据框有 52 个观测，log(bilirubin) 水平的基线值在变量 lbr 中，时依值在 lbrt 中。使用如下命令拟合包括治疗和时依 log(bilirubin) 值的 Cox 回归模型后，使用 summary(coxlbr) 获得以下输出。使用 > -2*logLik(coxlbr) 获得 \\(−2\\log\\hat L\\) 统计量，为这与第 8 章示例 8.4 中引用的值一致。不包含时依变量的模型可以拟合到计数过程格式下的扩展数据集 lbrdata，或者拟合到数据框 liverbase 中的 12 个观测。两者都会得到相同的结果。","code":"> leukaemia<-read.table(\"Bone marrow transplantation in the treatment\n                        of leukaemia.dat\",header=TRUE,na.strings=c(\".\"))\n> leukaemia$fgroup<-as.factor(leukaemia$group)\n> leukaemia<-subset(leukaemia,select=-c(group,precovery))> tdvdata<-tmerge(data1=leukaemia,data2=leukaemia,id=patient, \n                  death=event(time,status))  patient time status page dage ptime fgroup tstart tstop death\n1       1 1199      0   24   40    29      1      0  1199     0\n2       2 1111      0   19   28    22      1      0  1111     0\n3       3  530      0   17   28    34      1      0   530     0\n4       4 1279      1   17   20    22      1      0  1279     1\n5       5  110      1   28   25    49      1      0   110     1> tdvdata<-tmerge(data1=tdvdata,data2=leukaemia,id=patient,\n                  Plate=tdc(ptime))  patient time status page dage ptime fgroup tstart tstop death Plate\n1       1 1199      0   24   40    29      1      0    29     0     0\n2       1 1199      0   24   40    29      1     29  1199     0     1\n3       2 1111      0   19   28    22      1      0    22     0     0\n4       2 1111      0   19   28    22      1     22  1111     0     1\n5       3  530      0   17   28    34      1      0    34     0     0\n6       3  530      0   17   28    34      1     34   530     0     1> tdvmodel<-coxph(Surv(tstart,tstop,death) ~ Plate+fgroup,\n                  ties=\"breslow\",data=tdvdata)Call:\ncoxph(formula = Surv(tstart, tstop, death) ~ Plate + fgroup, \n    data = tdvdata, ties = \"breslow\")\n\n            coef exp(coef) se(coef)      z      p\nPlate   -2.31956   0.09832  1.22938 -1.887 0.0592\nfgroup2 -2.07610   0.12542  1.15105 -1.804 0.0713\nfgroup3  0.38943   1.47614  0.61825  0.630 0.5288> liverbase<-read.table(\"Data from a cirrhosis study (baseline).dat\",\n                        header=TRUE) \n> lbrdata0<-read.table(\"Data from a cirrhosis study (lbr data).dat\", \n                       header=TRUE)> baselbr<-liverbase[c(\"patient\",\"time\",\"lbr\")]\n> baselbr$time<-c(0)\n> lbrdata1<-rbind(baselbr,lbrdata0)\n> lbrdata<-lbrdata1[order(lbrdata1$patient,lbrdata1$time),]> tdvlbr<-tmerge(data1=liverbase,data2=liverbase,id=patient,\n                 death=event(time,status)) \n> tdvlbr<-tmerge(data1=tdvlbr,data2=lbrdata,id=patient,\n                 lbrt=tdc(time,lbr))\ncoxlbr<-coxph(formula = Surv(tstart, tstop, death) ~ lbrt + treat, data = tdvlbr, \n    ties = \"breslow\")Call:\ncoxph(formula = Surv(tstart, tstop, death) ~ lbrt + treat, data = tdvlbr, \n    ties = \"breslow\")\n\n         coef exp(coef) se(coef)      z     p\nlbrt   3.6048   36.7731   2.2449  1.606 0.108\ntreat -1.4791    0.2278   1.3403 -1.104 0.270\n\nLikelihood ratio test=14.45  on 2 df, p=0.0007299\nn= 52, number of events= 8'log Lik.' 10.6762 (df=2)"},{"path":"chap17.html","id":"sec17-9-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.9.1 时变系数","text":"具有时变系数的模型已在第 4 章的 4.4.4 节描述，这与检验比例风险假设有关，并在 11.2 节中描述了通过阶跃函数对治疗效应进行建模。这样的模型也可使用函数 coxph 进行拟合。在第 4 章 4.4.4 节中，Cox 回归模型的系数是时间的函数，用于评估比例风险。coxph 函数的时间变换功能 (time\ntransform facility) 可用于在模型中包含项 \\(\\beta(t)=\\beta t\\)。为此，在 coxph 中定义一个函数 tt以形成变量与某个时间函数的乘积，命令为 tt=function(x,t,...) x*g(t)，其中 g(t) 是 t 的指定函数，如 t, log(t) 甚至是样条函数。为了说明这一点，我们回到第 4 章示例 4.1 中给出的透析患者感染发生率数据。在示例 4.12 中，我们通过为变量 \\(Age\\) 和 \\(Sex\\) 添加时变系数，来扩展包含这两个变量的 Cox 回归模型，以检查年龄和性别效应是否随时间保持不变。将数据输入到名为 dialysis 的 R 数据框后（dialysis <- read.table(\"Infection patients dialysis.dat\", header=TRUE)），可以使用以下代码来拟合包括 \\(Age\\) 和 \\(Sex\\) 以及 \\(Sex\\) 的时变系数的 Cox 回归模型。下面是使用 summary(tdcfit) 的部分输出。对于该模型，使用 -2*logLik(tdcfit) 得出 \\(−2\\log\\hat L\\) 的值为 34.104，并且当省略项 tt(sex) 时，\\(−2\\log\\hat L\\) 增加 0.364 至 34.468，如示例 4.12 所示。拟合的模型具有时变的性别系数，其估计为 \\(\\hat{\\beta}(t)=-1.281-0.074t\\)。这表明性别效应随着时间的推移而增加，但并不显著。在连续时间区间内具有不同系数的项会产生分段 Cox 模型，用于对治疗之间的非比例性进行建模，如第 11 章 11.2.1 节所述。可以使用 survival 包中的 survSplit 函数将时变系数的阶跃函数纳入 Cox 回归模型。此函数用于将时间尺度划分为所需数量的区间，并使用所得数据框来拟合分层模型。使用第 11 章示例 11.2 中给出的前列腺癌患者生存时间数据来说明该过程。在该示例中，假定治疗效应在 1–360, 361–720, 721–1080 天和 1080 天以上的时间区间内是恒定的，但允许它们之间有所不同。数据首先通过如下命令输入以形成 R 数据框 gcancer在所得数据框中，治疗效应由变量 treat 表示，单独化疗为零，联合治疗为一。然后使用 surveSplit 函数对时间段进行分层这段代码得到 survSplit 对象 gcancer1，时间段缩短为 360、720 和 1080 天。选项 episode= 指定用于标记结果数据框中的时间段的变量名称。原始数据框第 50–58 行中患者 32, 33 和 34 的数据如下。数据采用计数过程格式，并使用新变量 tstart 以及原始变量 time 和 status 定义时间段和状态。时变的治疗效应可以通过按时间段分层并包括治疗与时间段的交互作用来建模。治疗与分层变量之间的交互作用在模型公式中表示为 treat:strata(tperiod)，并且使用以下命令拟合包含 treat 和交互项的 Cox 回归模型下面给出了部分输出。根据该输出，在四个时间区间内，联合治疗相对于单独化疗的对数风险比分别为 \\(0.877,0.877 − 1.129 = −0.25,0.877 − 1.978 = −1.10\\) 和 \\(0.877 − 2.060 = −1.18\\)。此外，anova(gcfit) 还可以检验治疗效应在四个时期内是否恒定。该模型过度参数化，这就是为什么没有给出 treat:strata(tperiod)tperiod=1 的项。使用如下命令可获得更易解释的结果。交互项 treat:strata(tperiod) 现在会在每个时间段产生单独的治疗效应，部分输出如下所示。风险比和区间估计可直接从此输出中读取，并且与表 11.3 中列出的一致。","code":"> tdcfit<-coxph(Surv(time,status) ~ age+sex+tt(sex),ties=\"breslow\",\n                tt=function(x,t,...)x*t,data=dialysis)Call:\ncoxph(formula = Surv(time, status) ~ age + sex + tt(sex), data = dialysis, \n    ties = \"breslow\", tt = function(x, t, ...) x * t)\n\n  n= 13, number of events= 12 \n\n            coef exp(coef) se(coef)      z Pr(>|z|)\nage      0.03318   1.03374  0.02686  1.235    0.217\nsex     -1.28076   0.27782  2.53323 -0.506    0.613\ntt(sex) -0.07422   0.92847  0.12190 -0.609    0.543> gcancer<-read.table(\"Survival of patients with gastric cancer.dat\",\n                      header=TRUE)> gcancer1<-survSplit(Surv(time,status) ~ .,data=gcancer,\n                      cut=c(360,720,1080),episode=\"tperiod\")patient treat tstart time status tperiod\n     32     0      0  360      0       1\n     32     0    360  720      0       2\n     32     0    720  778      1       3\n     33     0      0  360      0       1\n     33     0    360  720      0       2\n     33     0    720  786      1       3\n     34     0      0  360      0       1\n     34     0    360  720      0       2\n     34     0    720  797      1       3> gcfit<-coxph(Surv(tstart,time,status) ~ treat+treat:strata(tperiod),\n               ties=\"breslow\",data=gcancer1)                                 coef exp(coef) se(coef)     z Pr(>|z|)\n                         treat  0.877     2.405    0.335  2.62   0.0088\ntreat:strata(tperiod)tperiod=2 -1.129     0.323    0.535 -2.11   0.0348\ntreat:strata(tperiod)tperiod=3 -1.978     0.138    0.870 -2.27   0.0229\ntreat:strata(tperiod)tperiod=4 -2.060     0.128    0.786 -2.62   0.0088> gcfit<-coxph(Surv(tstart,time,status) ~ treat:strata(tperiod),\n               ties=\"breslow\",data=gcancer1)                                  coef exp(coef) se(coef)     z Pr(>|z|) \ntreat:strata(tperiod)tperiod=1   0.877     2.405    0.335  2.62   0.0088\ntreat:strata(tperiod)tperiod=2  -0.251     0.778    0.417 -0.60   0.5464\ntreat:strata(tperiod)tperiod=3  -1.101     0.333    0.802 -1.37   0.1701\ntreat:strata(tperiod)tperiod=4  -1.182     0.307    0.711 -1.66   0.0964"},{"path":"chap17.html","id":"sec17-9-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.9.2 纵向数据和生存数据的联合建模","text":"可以使用 JM 包为纵向数据和生存时间拟合联合模型，但也可以使用其他包，比如 joineR 包。首先使用 nlme 包中的 lme 函数通过线性混合模型对纵向变量进行建模。该函数要求指定模型中的固定效应和随机效应。然后使用 coxph 对生存时间进行建模，以生成生存对象。最后，使用 jointModel 函数将这些单独的纵向模型和生存模型组合成一个联合模型。使用第 8 章示例 8.5 给出的主动脉瓣置换术后患者生存数据来说明该过程。该数据集包括患者生存时间和与左心室质量指数 LVMI 相关的变量的纵向值，以及在研究开始时测量的解释变量。首先使用如下命令将数据输入到数据框 valve。纵向变量将使用与时间的直线关系进行建模，每个患者具有随机截距和斜率。代表患者性别和术前糖尿病状态的变量也将包括在内，因为这些变量在第 8 章的示例 8.8 中被证明是显著的，拟合该模型的 lme 函数如下。在该函数中，random= 选项指定随机效应的模型为 ~ time，分组变量 id 在 | 符号后指定。为了对生存时间进行建模，需要一个数据框，其中每行代表一个患者。为了从包含每个患者多行数据的数据框 valve 中构建该数据框，可以使用以下代码。! 符号用于选择数据框 valve 中变量 id 值不重复的行。使用如下命令删除变量 lvmi 和 time，因为它们不再需要。这会产生一个数据框 lsurv，其前 5 行如下。在示例 8.8 中，患者年龄是显著影响生存的唯一变量。然后以通常的方式拟合仅包含该变量的 Cox 回归模型，但包括选项 x=TRUE，以在模型中保留解释变量的值矩阵以供以后使用。然后，使用函数 jointModel 将 lme 对象 lmefit 与 coxph 对象 coxfit 相结合，并使用 timeVar= 选项指定与纵向测量时间相关的变量。在这个阶段，有许多模型可以用于联合模型中的生存时间，包括 Cox 回归模型、分段指数模型、全参数模型和基于样条的灵活模型。此处将使用基线风险函数对数的样条模型，如第 8 章示例 8.9 所示。生成以下代码35。method= 选项指定使用默认为五个内部结的比例风险样条曲线模型，并使用 Gauss-Hermite 求积进行所需的数值积分。可以使用 lng..kn= 选项设置不同的内部结数。可以类似的方式指定替代的比例风险模型，例如 method=\"Cox-PH-GH\", method=\"piecewise-PH-GH\" 或 method=\"weibull-PH-GH\"。summary(jmod)的部分输出如下。在给出最大化对数似然值 \\(\\log\\hat{L}\\)，AIC 和 BIC 统计量后，随机截距标准差估计 \\(\\hat u_{0i}\\) 和随机斜率标准差估计 \\(\\hat u_{1i}\\) 与残差项的标准差估计 \\(\\hat \\sigma_\\epsilon\\) 在题为 StdDev 的列中给出。下一列给出了截距和斜率之间的相关系数为 −0.582.纵向过程的系数是对 \\(m_i(t)\\) 的拟合模型中的 \\(\\beta\\) 系数的估计，\\(m_i\\) 是第 \\(\\) 名患者的基本响应曲线。这里，拟合模型在时间 \\(t\\) 上是线性的，包括第 \\(\\) 名患者的性别 \\(s_i\\) 和糖尿病状况 \\(d_i\\)，并在式 (8.12) 中给出，其中根据第 8 章示例 8.9：\\[\\begin{aligned}\\hat{m}_i(t)=175.09-1.41t-29.64s_i-20.93d_i\\end{aligned}\\]系数估计的标准误、\\(z\\) 值和 \\(P\\) 值得到了区间估计和假设检验。联合模型的风险函数估计是根据标记为 Event Process 的部分获得的，其中联合模型中的系数估计 \\(m_i(t)\\) 标记为 Assect。与第 8 章的示例 8.9 一样，这是\\[\\begin{aligned}\\hat h_i(t)=\\exp\\{0.0857a_i+0.0051\\hat m_i(t)\\}\\end{aligned}\\]该输出的 Event Process 部分还包含对数基线风险的样条模型指定所需的 9 个立方 B 样条基函数的系数，但这些已被省略。接下来，可以对 jointModel 对象应用许多操作，包括 predict 以获得纵向变量的拟合值，plot 以获得模型的各种图形总结，以及 residuals 以导出拟合的联合模型的各种残差。","code":"> valve<-read.table(\"Survival following aortic valve replacement.dat\",\n                    header=TRUE)> lmefit<-lme(lvmi ~ sex+dm+time,random= ~ time|id,data=valve)> lsurv<-valve[!duplicated(valve$id),]> lsurv<-subset(lsurv,select=-c(lvmi,time))id futime status age sex redo emerg dm type\n 1  4.956      0  75   0    0     0  0    2\n 2  9.663      0  46   0    1     0  0    1\n 3  7.915      0  63   0    0     0  0    1\n 4  4.038      0  61   0    1     0  0    1\n 5  8.816      0  54   0    1     0  0    1> coxfit<-coxph(Surv(futime,status) ~ age,x=TRUE,ties=\"breslow\",\n                data=lsurv)> jmod<-jointModel(lmefit,coxfit,timeVar=\"time\",method=\"spline-PH-GH\")Call:\njointModel(lmeObject = lmefit, survObject = coxfit, timeVar = \"time\", \n    method = \"spline-PH-GH\")\n\nData Descriptives:\nLongitudinal Process        Event Process\nNumber of Observations: 988 Number of Events: 54 (21.1%)\nNumber of Groups: 256\n\nJoint Model Summary:\nLongitudinal Process: Linear mixed-effects model\nEvent Process: Relative risk model with spline-approximated\n        baseline risk function\nParameterization: Time-dependent \n\n   log.Lik      AIC      BIC\n -5437.314 10912.63 10979.99\n\nVariance Components:\n              StdDev    Corr\n(Intercept)  59.6043  (Intr)\ntime          7.4949 -0.5819\nResidual     36.1661        \n\nCoefficients:\nLongitudinal Process\n               Value Std.Err z-value p-value\n(Intercept) 175.0903  5.1812 33.7932 <0.0001\nsex         -29.6409 10.0306 -2.9551  0.0031\ndm          -20.9350 10.2557 -2.0413  0.0412\ntime         -1.4126  0.9104 -1.5516  0.1208\n\nEvent Process\n          Value Std.Err z-value p-value\nage      0.0859  0.0160  5.3598 <0.0001\nAssoct   0.0052  0.0030  1.7325  0.0832"},{"path":"chap17.html","id":"sec17-10","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.10 区间删失数据","text":"如第 9 章 9.1 节所述，精确事件时间、左删失事件时间和右删失事件时间都可以以区间删失数据的形式表示。右删失事件时间具有无限上限的区间，左删失时间具有零下限，而精确事件时间的区间上下限相等。上限为 \\(L\\)、下限为 \\(R\\) 的区间删失数据可以表示为 survival 对象，以便在模型公式 Surv(L,R,type=\"interval2\") 中使用。无限上限可以指定为 Inf 或 NA。本节将使用第 9 章示例 9.1 给出的溃疡复发时间数据进行说明。第一步是输入表 9.1 中的数据并执行必要的操作将其表示为区间删失格式，表 9.2 总结了这一点。变量 \\(Treat\\) 和 \\(Dur\\) 的值也被转换，使得 \\(Treat\\) 对于治疗 \\(B\\) 为 1，否则为 0，并且如果疾病持续时间至少为五年，则 \\(Dur\\) 为 1，否则为 0. “基线”个体是指接受治疗 且疾病持续时间少于五年的个体。这可以通过以下方式来完成。\n数据框 ulcer 的前十行如下。","code":"> ulcer <- read.table(\"Recurrence of an ulcer.dat\",header=TRUE) \n> ulcer$left<-ifelse(ulcer$result==1,ulcer$time, ifelse((ulcer$result==2 & ulcer$time<=6),0,\n                                                        ifelse((ulcer$result==2 & ulcer$time>6),6,0))) \n> ulcer$right<-ifelse(ulcer$result==1,NA,ulcer$time) \n> ulcer$duration<-ulcer$duration-1 \n> ulcer$treatment<-ulcer$treatment-1   patient age duration treatment time result left right\n1        1  48        1         1    7      2    6     7\n2        2  73        0         1   12      1   12    NA\n3        3  54        0         1   12      1   12    NA\n4        4  58        1         1   12      1   12    NA\n5        5  56        0         0   12      1   12    NA\n6        6  49        1         0   12      1   12    NA\n7        7  71        0         1   12      1   12    NA\n8        8  41        0         0   12      1   12    NA\n9        9  23        0         1   12      1   12    NA\n10      10  37        0         1    5      2    0     5"},{"path":"chap17.html","id":"sec17-10-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.10.1 生存函数的非参数最大似然估计","text":"第 9 章 9.2 节描述并说明了区间删失数据生存函数的非参数最大似然估计。可以使用 icfit 函数获得该估计，该函数是 interval 包的一部分，代码如下。译者注：可能需要如下通过命令安装 interval 所依赖的包 Icens：使用 summary(icsurv) 会得到以下输出。如果需要，可以对 Surv 对象 Surv(left,right,type=\"interval2\") ~ 1 应用 icfit 来拟合总体生存函数。summary 函数的输出给出了每个治疗组的 Turnbull 区间中的生存概率。据此，治疗 （\\(Treat=0\\)）患者的生存函数估计在时间起点为 1，对于 2-6 个月之间的复发时间，为 \\(1 − 0.1579 = 0.8421\\)，在 12 个月时为 \\(1 − 0.1579 − 0.0648 = 0.7773\\)，而对于超过 12 个月是未定义的，如第 9 章示例 9.4 所示。interval 包中的函数 getsurv 还可用于获取每种治疗在指定时间的生存函数估计。由于生存函数在 Turnbull 区间内不是唯一定义的，因此该函数使用线性插值从连接 Turnbull 区间开始和结束处的生存估计的线上的点获取估计。以下代码捕获了每个治疗组在事件时间为 \\(0,1, 2,\\ldots,12\\) 时的估计，并将这些值形成一个矩阵 surv_ests，用于打印和进一步分析。这会产生以下输出，该输出可以与从 summary(icsurv) 输出中的生存概率获得的生存函数估计进行核对和统一。icfit 对象 icsurv 也可直接使用 plot(icsurv) 绘制，这会产生类似于图 9.2 所示的图形。\n使用 icenReg 包中的 R 函数 ic_np 也可以得到区间删失数据生存函数的非参数最大似然估计。要使用此函数，必须按以下方式指定区间上下限的矩阵，而不是 Surv 对象。summary 函数的输出内容较少，但 ic_np 对象 icsurv1 中包含了 icsurv1$scurves，可以通过 print(icsurv1$scurves) 进行展示，其产生的输出结果就包括了生存函数估计。","code":"> icsurv<-icfit(Surv(left,right,type=\"interval2\") ~ treatment, data=ulcer)\nif (!require(\"BiocManager\", quietly = TRUE))\n    install.packages(\"BiocManager\")\nBiocManager::install(\"Icens\")treatment=0:\n  Interval Probability\n1    (0,2]      0.1579\n2   (6,12]      0.0648\n3 (12,Inf)      0.7773\ntreatment=1:\n  Interval Probability\n1    (0,5]      0.0833\n2    (6,7]      0.2083\n3 (12,Inf)      0.7083> times<-c(0:12)\n> icsurvests<-getsurv(times,icsurv)\n> surv_ests<-cbind(times,icsurvests[[1]]$S,icsurvests[[2]]$S)\n> colnames(surv_ests)<-c(\"Time\",\"S(0)\",\"S(1)\")\n> print(surv_ests)     Time      S(0)      S(1)\n [1,]    0 1.0000000 1.0000000\n [2,]    1 0.9210526 0.9833333\n [3,]    2 0.8421053 0.9666667\n [4,]    3 0.8421053 0.9500000\n [5,]    4 0.8421053 0.9333333\n [6,]    5 0.8421053 0.9166667\n [7,]    6 0.8421053 0.9166667\n [8,]    7 0.8313090 0.7083333\n [9,]    8 0.8205128 0.7083333\n[10,]    9 0.8097166 0.7083333\n[11,]   10 0.7989204 0.7083333\n[12,]   11 0.7881242 0.7083333\n[13,]   12 0.7773279 0.7083333> icsurv1<-ic_np(cbind(left,right) ~ treatment,data=ulcer)"},{"path":"chap17.html","id":"sec17-10-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.10.2 区间删失数据的半参数模型","text":"第 9 章 9.3 节描述的半参数 Turnbull 模型可以使用 icenReg 包中的 ic_sp 函数拟合区间删失数据。例如，要为溃疡复发时间数据拟合仅包含治疗效应的模型，请使用36选项 bs_samples= 指定在计算拟合模型中参数估计的标准误差的 bootstrap 估计时使用的 bootstrap 样本数。第 9 章的示例 9.5 概述了此过程。可以使用 summary(icfit) 获得输出并给出根据该输出，接受治疗 B 的患者相对于接受治疗 的患者的对数风险比估计为 0.195，标准误为 1.488. 该标准误差是使用 bootstrap 模拟获得的，因此不能完复现。\\(-2\\log\\hat{L}\\) 统计量的值根据 final llk 的值计算为 \\(−2(−31.442) = 62.884\\)，如示例 9.5 所示。getSCurves 函数可用于获取每个治疗组的生存函数估计这将产生以下的简略输出。Turnbull 区间和生存函数估计与第 9 章表 9.4 给出的值相对应。请注意，getSCurves 函数的默认设置是根据拟合模型中变量值的均值来估计生存函数。因此，getSCurves(icfit) 给出了 Treat=0.5881 的生存函数（因为 0.5881 是该变量在 43 名患者中的样本均值），但这没有意义。","code":"> icfit<-ic_sp(Surv(left,right,type=\"interval2\") ~ treatment,\n               bs_samples=10000,data=ulcer)Model:  Cox PH\nDependency structure assumed: Independence\nBaseline:  semi-parametric \nCall: ic_sp(formula = Surv(left, right, type = \"interval2\") ~ treatment, \n    data = ulcer, bs_samples = 10000)\n\n          Estimate Exp(Est) Std.Error z-value      p\ntreatment   0.1953    1.216     1.502    0.13 0.8966\n\nfinal llk =  -31.44204 \nIterations =  6 \nBootstrap Samples =  10000> treatment<-c(0,1)\n> newdata<-data.frame(treatment)\n> getSCurves(icfit,newdata)$Tbull_ints\n       lower upper\n[1,] 1.0e-10 1e-10\n[2,] 1.0e-10 2e+00\n[3,] 6.0e+00 7e+00\n[4,] 1.2e+01   Inf\n\n$S_curves\n$S_curves$`1`\n[1] 1.0000000 0.8957260 0.7585258 0.0000000\n\n$S_curves$`2`\n[1] 1.0000000 0.8747077 0.7146427 0.0000000\n\n\nattr(,\"class\")\n[1] \"sp_curves\""},{"path":"chap17.html","id":"sec17-10-3","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.10.3 区间删失数据的参数模型","text":"利用 survival 包中的 survreg 函数，可以对区间删失数据拟合参数模型。该函数中使用的 Surv 对象与其他用于处理区间删失数据的函数所使用的相同，并且其输出结果与 17.6 节描述的使用survreg拟合参数模型时的情况相似。唯一需要注意的是，对于左删失时间为零的情况，必须将其替换为 NA。例如，要对溃疡复发时间的区间删失数据拟合 Weibull 模型，请使用以下命令：在计算逻辑表达式以给出 True 或 False 的结果时，ifelse 语句中需使用双等号。有关解释此输出的详细信息，请参见 17.6 节。结果与第 9 章示例 9.7 中给出的结果一致。","code":"> ulcer$left1<-ifelse(ulcer$left==0,NA,ulcer$left)\n> icweib<-survreg(Surv(left1,right,type=\"interval2\") ~ treatment,\n                  data=ulcer)"},{"path":"chap17.html","id":"sec17-11","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.11 脆弱模型","text":"包含个体随机效应或组内个体共享的随机效应的生存时间模型称为脆弱模型。这类模型可能是参数化的或半参数化的，并在第 10 章有详细描述。","code":""},{"path":"chap17.html","id":"sec17-11-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.11.1 拟合具有个体脆弱性的参数脆弱模型","text":"时间 \\(t\\) 时事件风险的比例风险模型，其中第 \\(\\) 个个体（共 \\(n\\) 个）的随机效应为 \\(u_i\\) ，为\\[h_i(t)=\\exp(\\boldsymbol{\\beta'x}_i+u_i)h_0(t)\\]其中 \\(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\) 是解释变量 \\(\\boldsymbol x_i\\) 值与系数 \\(\\boldsymbol\\beta\\) 的线性组合，\\(h_0(t)\\) 是基线风险函数。该模型也可写为\\[\\begin{align}\nh_i(t)=z_i\\exp(\\boldsymbol{\\beta'x}_i)h_0(t)\n\\tag{17.2}\n\\end{align}\\]其中 \\(z_i = \\exp(u_i)\\) 称为脆弱性。尽管某些 R 包中使用脆弱性一词指代 \\(u_i\\) 或 \\(z_i\\)，但在后续讨论中，我们将保持随机效应 \\(u_i\\) 与其对应的脆弱项 \\(z_i\\) 之间的这种区分。参数脆弱模型可以使用 parfm 包中的 R 函数 parfm 进行拟合。该函数可为假定有有指数, Weibull, loglogstic 或 lognormal 分布的数据进行建模，其中脆弱性分布包括 gamma 和 lognormal. parfm 函数中的基线分布以与 survreg 函数不同的方式进行参数化。具体来说，Weibull 基线风险表示为 \\(\\text{λρtρ-1}\\)，因此 \\(\\rho\\) 代替了第 5 章式 (5.4) 中的 \\(\\gamma\\)，指数基线风险为 \\(\\rho=1\\)。loglogstic 基线风险的参数化如第 5 章式 (5.8) 所示，但使用 \\(\\alpha\\) 替代了 \\(\\theta\\)，lognormal 分布如第 5 章 5.1.4 节所述。脆弱性分布的参数为 \\(\\theta\\)，它是第 \\(\\) 个个体的模型中脆弱项 \\(z_i\\) 的方差。因此，在 10.2 节描述的 gamma 脆弱性分布中的 \\(\\theta\\) 替换为 \\(\\theta-1\\)，而第 10 章 10.2.1 节中的 lognormal 脆弱性方差 \\(\\text{var }(z_i) = \\theta\\)，因此脆弱效应 \\(u_i\\) 的方差为 \\(e^{\\theta}(e^\\theta − 1)\\)。有关 parfm 中使用的模型范围和参数化的详细信息，请参阅与软件包关联的 R vignette (Munda, Rotolo Legrand, 2017).为了说明 parfm 函数的使用，将使用示例 10.3 中关于等待肺移植的患者的生存数据。首先将数据输入到 R 数据框，将性别声明为一个因子，其水平对应于男性和女性患者，而疾病为四个水平的因子，对应于 COPD、纤维化、化脓性疾病和其他疾病。基线水平设为患有化脓性疾病的男性患者。函数 parfm 的语法与生存数据建模中使用的其他 R 函数的语法相似，模型公式是使用 Surv 对象表示的。此外，dist= 选项用于指定生存时间的参数分布，cluster= 选项指定用于脆弱性的项，该项视为一个因子，而 frailty= 选项用于指定脆弱分布。为了拟合具有 gamma 脆弱性的 Weibull 模型，其中 196 名患者中每个患者都有单独的脆弱性值，使用以下代码。不幸的是，模型拟合程序无法收敛，因为 Weibull 尺度参数的估计变得非常小。这个问题可以通过使用不同的生存时间时间尺度来解决。在这里，在除以 30.44 将生存时间从天转换为月后，模型拟合程序便收敛了。通过这种重新调整，原始 Weibull 基线风险变为 \\(30.44h_0(t/30.44)\\)，即 \\(30\\lambda\\rho(t/30.44)^{\\rho-1}\\)，因此为以月为单位的生存时间拟合的模型的尺度参数估计为 \\(\\lambda^*=30.44^\\rho\\lambda\\)。因此，原始尺度上的 Weibull 尺度参数为 \\(\\lambda^{*}/30.44^{\\rho}\\)。对数似然统计量 \\(−2 \\log \\hat L\\) 的值也会有所不同，但替代模型之间的该值之差不受生存时间的任何缩放的影响。为了将时间尺度从天改为月，并拟合具有 gamma 脆弱性的 Weibull 模型，使用以下代码。print(f_lung) 得到如下输出。根据该输出，在比较嵌套模型时使用的 \\(−2 \\log \\hat L\\) 统计量为 \\(−2(−591.709)=1183.418\\)，这也可以通过 -2*logLik(f lung) 来计算。此外，theta 是指脆弱性方差，即式 (17.2) 中 \\(z_i\\) 的方差估计，rho 和 lambda 指定了 Weibull 基线风险中的形状和尺度参数。请注意，第 10 章表 10.3 中 \\(\\hat\\lambda\\) 的值为 \\(0.023/(30.441.304)=0.00027\\)。这些估计值后面是模型中项的系数估计，它与表 10.3 第四列中的条目一致。然而，由于生存时间进行了缩放，\\(−2 \\log \\hat L\\) 的值有所不同。可以使用 predict 函数获得脆弱效应估计，即 predict(f_lung) 给出 gamma 脆弱的 196 个单独估计 \\(\\hat z_i\\)。通过将 frailty= 选项更改为 frailty=\"lognormal\"，可得到表 10.3 第三列中的条目。","code":"> lung<-read.table(\"Survival of patients registered for a lung transplant.dat\",\n                   header=TRUE)\n> lung$fdisease<-factor(lung$disease)\n> levels(lung$fdisease)<-list(\"COPD\"=1,\"Fib\"=2,\"Supp\"=3,\"Other\"=4)\n> lung$fdisease<-relevel(lung$fdisease,ref=3)\n> lung$fgender<-factor(lung$gender)\n> levels(lung$fgender)<-list(\"male\"=1,\"female\"=2)\n> lung$fgender<-relevel(lung$fgender,ref=2)> f_lung0<-parfm(Surv(time,status) ~ fgender+age+bmi+fdisease,\n                 cluster=\"patient\",dist=\"weibull\",frailty=\"gamma\",data=lung)> lung$time1<-lung$time/30.44\n> f_lung<-parfm(Surv(time1,status) ~ fgender+age+bmi+fdisease,\n              cluster=\"patient\",dist=\"weibull\",frailty=\"gamma\",data=lung)Frailty distribution: gamma \nBaseline hazard distribution: Weibull \nLoglikelihood: -591.709 \n\n              ESTIMATE SE    p-val  \ntheta          3.015   1.063        \nrho            1.304   0.229        \nlambda         0.023   0.025        \nfgendermale    0.433   0.412 0.294  \nage            0.003   0.020 0.867  \nbmi           -0.014   0.047 0.763  \nfdiseaseCOPD  -1.008   0.692 0.145  \nfdiseaseFib    1.383   0.722 0.055 .\nfdiseaseOther -0.076   0.766 0.921  \n---\nSignif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"},{"path":"chap17.html","id":"sec17-11-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.11.2 拟合具有共享脆弱性的参数脆弱模型","text":"函数 parfm 也可用于拟合具有共享脆弱性的参数模型。其代码与个体脆弱性的代码非常相似，只是 cluster= 选项现在指定与具有共享脆弱性的个体组相关的变量。作为说明，请考虑示例 10.4 中有关肾移植后的生存数据。在这里，一名肾脏供体可能会提供一或两个移植，因此两个受体可能有一个共同的供体，从而导致共享脆弱。以下代码用于输入数据、变换时间尺度并拟合具有 gamma 脆弱性的 Weibull 模型。使用 print(f_kidney) 得到以下输出。该输出的解释与个体脆弱模型的解释相同。然而，由于生存时间的缩放，对数似然值再次与示例 10.4 中引用的值不同。gamma 脆弱的拟合模型的输出还包括 Kendall’s \\(\\tau\\) 统计量，这是一种生存时间对之间关联的度量，参见第 10 章 10.8 节。类似的代码可以用于拟合参数分布和脆弱性分布的其他组合。","code":"> tplant<-read.table(\"Survival following kidney transplantation.dat\",\n                     header=TRUE)\n> tplant$time1<-tplant$time/30.44\n> f_kidney<-parfm(Surv(time1,status) ~ age+cit+diabetes,\n                  cluster=\"donor\",dist=\"weibull\",frailty=\"gamma\",data=tplant)Frailty distribution: gamma \nBaseline hazard distribution: Weibull \nLoglikelihood: -433.31 \n\n         ESTIMATE SE    p-val  \ntheta     0.421   0.620        \nrho       0.602   0.068        \nlambda    0.005   0.002        \nage       0.019   0.008 0.013 *\ncit       0.024   0.020 0.229  \ndiabetes -0.258   0.458 0.573  \n---\nSignif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nKendall's Tau: 0.174 "},{"path":"chap17.html","id":"sec17-11-3","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.11.3 拟合具有个体 lognormal 脆弱性的半参数模型","text":"使用同名包中的 coxme 函数可以为生存数据拟合具有 lognormal 脆弱项的模型。该函数使用惩罚偏似然法来拟合包含脆弱效应的模型，如第 10 章 10.5 节所述。再次考虑等待肺移植期间生存时间的数据。第 17.11.1 节使用的 lung 数据框架包含以性别和疾病集为因子的数据。此分析将使用以天为单位的生存时间。为了拟合 Cox 回归模型，该模型包含 \\(Age,Sex,BMI\\) 和 \\(Disease\\)，以及假设具有 lognormal 分布的患者的个体脆弱效应 \\(z_i\\)，使用如下代码来完成。在该代码中，通过在模型公式中添加 (1|patient) 来指定脆弱项，并且脆弱变量自动假定为一个因子。使用 summary(lnfcox) 可得到以下输出。该输出的第一部分给出了三个对数似然值，展示为 NULL, Integrated 和 Fitted。零对数似然是指不包含解释变量或脆弱性的模型。这只是 Cox 回归模型的最大化偏对数似然，该模型对每个个体具有相同的基线风险函数 \\(h_0(t)\\)。积分对数似然是第 10 章式 (10.28) 给出的最大化边际对数似然 \\(\\log L_m(\\hat{\\boldsymbol{\\beta}},\\hat{\\sigma}_u^2)\\)。拟合对数似然是从式 (10.25) 获得的拟合模型的最大偏对数似然 \\(\\log L_p(\\boldsymbol{\\hat{\\beta}},\\hat{\\boldsymbol{u}})\\)。在这三个对数似然值中，积分对数似然是最有用的，因为它用于比较替代模型。输出的下一部分中 Integrated loglik 所在行 给出了卡方值，用于将积分对数似然与零模型的对数似然进行比较。即，\\(2(587.616−578.74)=17.75\\)。标记为 Penalized loglik 的行将拟合或最大化偏对数似然与零模型的似然进行比较，即 \\(2(587.616−529.304)=116.62\\)。自由度是指拟合模型中独立参数的有效数。最大化偏对数似然包括随机效应的估计 \\(\\hat {\\boldsymbol u}\\)，而它们已经从边际对数似然性函数中积分出来。这解释了与两个检验相关的有效自由度数的差异。标记为 AIC 和 BIC 值的列中的 AIC 和 BIC 统计量是根据 Chisq 值计算通过减去自由度的两倍或 \\(q \\log d\\)，其中 \\(q\\) 是自由度，\\(d\\) 是事件数。当关注于替代模型的比较时，这些统计量的用途有限。输出的下一部分给出了参数估计、风险比、标准误、\\(z\\) 以及检验系数为零的假设的 \\(P\\) 值。接下来是对模型中随机效应项的标准差和方差的估计，即 \\(\\widehat{\\text{var }}(u_i)\\)。一旦拟合了脆弱模型，就可以使用 coxme 对象来提取一些量的值。例如，如 10.4 节所述，lnfcox$wear 给出了个体脆弱性估计，可用于识别更脆弱的个体的群体。当使用 lnfcox$loglik 来产生最大化对数似然时，可获得以下输出。这里，Penalized log-likelihood 是拟合模型的惩罚偏对数似然的最大值，即式 (10.27) 中的 \\(\\log\\hat{L}_{pen}(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{u}},\\hat{\\sigma}_u^2)\\)。这是通过从最大化偏对数似然 \\(\\log L_p(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{u}})\\) 中减去惩罚项 \\((2\\hat{\\sigma}_u^2)^{-1}\\sum_i\\hat{u}_i^2\\) 来计算的。该惩罚函数的值可使用 lnfcox$penalty 得出，为 22.8272，因此，如所给出的，最大化惩罚对数似然为 \\(−529.3037−22.8272=−552.1309\\)。","code":"> lnfcox<-coxme(Surv(time,status) ~ fgender+age+bmi+fdisease+\n                  (1|patient),ties=\"breslow\",data=lung)Mixed effects coxme model\n Formula: Surv(time, status) ~ fgender + age + bmi + fdisease + (1 | patient) \n    Data: lung \n\n  events, n = 123, 196\n\nRandom effects:\n    group  variable        sd  variance\n1 patient Intercept 0.7227754 0.5224043\n                   Chisq    df         p   AIC     BIC\nIntegrated loglik  17.75  7.00 1.314e-02  3.75  -15.93\n Penalized loglik 116.62 49.59 2.532e-07 17.44 -122.02\n\nFixed effects:\n                  coef exp(coef) se(coef)     z     p\nfgendermale    0.11401   1.12076  0.23180  0.49 0.623\nage            0.01209   1.01217  0.01312  0.92 0.357\nbmi           -0.02555   0.97477  0.02839 -0.90 0.368\nfdiseaseCOPD  -0.68092   0.50615  0.42471 -1.60 0.109\nfdiseaseFib    0.55321   1.73882  0.39815  1.39 0.165\nfdiseaseOther -0.19793   0.82043  0.44819 -0.44 0.659     NULL Integrated Penalized\n-587.6156  -578.7399 -552.1309"},{"path":"chap17.html","id":"sec17-11-4","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.11.4 拟合具有个体 gamma 脆弱性的半参数模型","text":"具有 gamma 脆弱性分布的模型不能使用 coxme 拟合，但 survival 包中的 frailty 函数可与 coxph 一起使用，以纳入 gamma 脆弱效应。下面给出了为登记进行肺移植的患者的生存时间数据拟合具有 gamma 脆弱性的 Cox 回归模型的 R 代码。在这里，通过将 frailty 函数添加到模型公式中来指定脆弱项，summary(gfcox) 将产生以下输出。该输出给出了模型中项的系数估计及其标准误、计算为 \\(\\{(\\hat{\\beta}/\\sec{(\\hat{\\beta})}\\}^2\\) 的卡方统计量以及相应的 \\(P\\) 值。标记为 se2 的量是对标准误的稳健估计，该标准误解释了模型指定中的不确定性。系数的指数，即风险比，也与 95% 的区间估计一起给出。标记为 frailty.gamma(patient) 的行给出了无脆弱性假设的卡方检验统计量。概括地说，这基于计算为 \\(\\hat{\\boldsymbol{u}}^{\\prime}\\boldsymbol{V}^{-1}(\\hat{\\boldsymbol{u}})\\hat{\\boldsymbol{u}}\\) 的 Wald 检验统计量，其中 \\(\\boldsymbol{V}(\\hat{\\boldsymbol{u}})\\) 为向量 \\(\\widehat{\\boldsymbol{u}}\\) 中脆弱性估计的方差-协方差阵，这是从惩罚偏对数似然的二阶导数矩阵中获得的，如附录 所述。给出拟合模型所需迭代次数的信息后，给出了随机效应的方差估计，即 \\(\\widehat{\\text{var}} \\left ( u _ \\right )\\)。同一行中是拟合模型的积分或边际对数似然，标记为 -likelihood。将其乘以 −2 后，即为用于将替代模型与伽玛脆弱性进行比较的 \\(−2 \\log \\hat L\\) 统计量。似然函数的值包括第 10 章 10.5 节末尾提到的额外项 \\(\\sum_{=1}^n\\delta_i\\)，因此可以更容易地将具有脆弱性的模型与没有脆弱性的模型进行比较。之后给出了模型中每个项（包括随机效应）的有效自由度数，然后是一致性估计，该一致性通过第 3 章 3.12.1 节中描述的 \\(c\\) 统计量来度量。标记为 Likelihood ratio 的统计量将拟合模型与零模型进行比较，其中拟合模型的似然是 在 \\(\\beta\\) 和脆弱效应 \\(u_i\\) 估计处的最大化偏对数似然，但不包含惩罚项，即 \\(\\log L_p(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{u}})\\)，以第 10.5 节表示法。以 frailty.gaussian(patient) 形式的 frailty 函数也可以用于向模型中添加 lognormal 脆弱性。尽管通常认为 coxme 函数更可靠，但这两种方法往往产生相似的结果。","code":"> gfcox<-coxph(Surv(time,status) ~ fgender+age+bmi+fdisease+\n                 frailty.gamma(patient),ties=\"breslow\",data=lung)Call:\ncoxph(formula = Surv(time, status) ~ fgender + age + bmi + fdisease + \n    frailty.gamma(patient), data = lung, ties = \"breslow\")\n\n  n= 196, number of events= 123 \n\n                       coef     se(coef)\nfgendermale             0.30599 0.35412 \nage                     0.00557 0.01812 \nbmi                    -0.02430 0.04257 \nfdiseaseCOPD           -0.88837 0.60317 \nfdiseaseFib             1.22698 0.60721 \nfdiseaseOther          -0.08851 0.66758 \nfrailty.gamma(patient)                  \n                       se2     Chisq \nfgendermale            0.23434   0.75\nage                    0.01198   0.09\nbmi                    0.02786   0.33\nfdiseaseCOPD           0.40313   2.17\nfdiseaseFib            0.39557   4.08\nfdiseaseOther          0.43458   0.02\nfrailty.gamma(patient)         243.82\n                       DF    p      \nfgendermale              1.0 3.9e-01\nage                      1.0 7.6e-01\nbmi                      1.0 5.7e-01\nfdiseaseCOPD             1.0 1.4e-01\nfdiseaseFib              1.0 4.3e-02\nfdiseaseOther            1.0 8.9e-01\nfrailty.gamma(patient) 120.5 2.2e-10\n\n              exp(coef) exp(-coef)\nfgendermale      1.3580     0.7364\nage              1.0056     0.9944\nbmi              0.9760     1.0246\nfdiseaseCOPD     0.4113     2.4312\nfdiseaseFib      3.4109     0.2932\nfdiseaseOther    0.9153     1.0925\n              lower .95 upper .95\nfgendermale      0.6784     2.718\nage              0.9705     1.042\nbmi              0.8979     1.061\nfdiseaseCOPD     0.1261     1.342\nfdiseaseFib      1.0376    11.213\nfdiseaseOther    0.2474     3.387\n\nIterations: 6 outer, 68 Newton-Raphson\n     Variance of random effect= 2.154654   I-likelihood = -576.7 \nDegrees of freedom for terms=   0.4   0.4   0.4   1.4 120.5 \nConcordance= 0.944  (se = 0.008 )\nLikelihood ratio test= 304.5  on 123.2 df,   p=<2e-16"},{"path":"chap17.html","id":"sec17-11-5","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.11.5 拟合具有共享脆弱性的半参数模型","text":"R 函数 coxme 以及带 frailty.gamma 的 coxph 可分别用于对共享 lognormal 和 gamma 脆弱性进行建模。该代码与上一节中描述的个体对若行的代码非常相似。现用肾移植后的生存数据，以说明参数共享脆弱模型。以下代码使用函数 coxme 来拟合供体效应的 lognormal 脆弱性summary(slnfcox) 得到以下输出。该输出与使用 coxme 拟合的个体脆弱性模型的格式相同，并且与第 10 章示例 10.4 中给出的结果一致。带 frailty.gamma 函数的函数 coxph 用于拟合具有共享 gamma 脆弱性的模型，使用模型中解释变量系数的估计结果与使用具有 lognormal 脆弱性的半参数模型时发现的结果非常相似。","code":"> slnfcox<-coxme(Surv(time,status) ~ age+cit+diabetes+(1|donor),\n                 ties=\"breslow\",data=tplant)Mixed effects coxme model\n Formula: Surv(time, status) ~ age + cit + diabetes + (1 | donor) \n    Data: tplant \n\n  events, n = 71, 434\n\nRandom effects:\n  group  variable        sd variance\n1 donor Intercept 0.5268985 0.277622\n                  Chisq    df        p   AIC    BIC\nIntegrated loglik  5.44  4.00 0.245290 -2.56 -11.61\n Penalized loglik 42.36 20.92 0.003677  0.51 -46.84\n\nFixed effects:\n             coef exp(coef) se(coef)     z      p\nage       0.01876   1.01894  0.01037  1.81 0.0706\ncit       0.02357   1.02385  0.02177  1.08 0.2791\ndiabetes -0.25418   0.77555  0.44938 -0.57 0.5716> sgfcox<-coxph(Surv(time,status) ~ age+cit+diabetes+\n                  frailty.gamma(donor),ties=\"breslow\",data=tplant)"},{"path":"chap17.html","id":"sec17-12","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.12 竞争风险","text":"竞争风险模型用于研究中的个体可能经历多个不同终点之一的情况，并在第 12 章进行了描述。在本节中，使用 R 来估计累积发生率函数。并拟合原因别风险和原因别发生率的模型。第 12 章示例 12.1 中描述的肝移植后移植失效时间的数据将用于说明 R 代码和输出。在此数据集中，许多患者的移植失效时间删失，有四个潜在的致命终点，即排异、血栓形成、疾病复发和其他原因。在数据集中，与失效原因相关的变量分别编码为 0, 1, 2, 3 和 4. 数据被输入到 R 数据框架中，性别和肝病都被设为因子，女性和酒精性肝病作为参考水平，这些使用如下代码完成。","code":"> liver<-read.table(\"Survival of liver transplant recipients.dat\", header=TRUE) \n> liver$fdisease<-factor(liver$disease) \n> levels(liver$fdisease)<-list(\"PBC\"=1,\"PSC\"=2,\"ALD\"=3) \n> liver$fdisease<-relevel(liver$fdisease,ref=3) \n> liver$fgender<-factor(liver$gender) \n> levels(liver$fgender)<-list(\"male\"=1,\"female\"=2) \n> liver$fgender<-relevel(liver$fgender,ref=2)"},{"path":"chap17.html","id":"sec17-12-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.12.1 原因别的风险函数的估计和建模","text":"可以按照第 12 章 12.2 节所述的方式，使用每种事件类型的生存函数来总结竞争风险数据。这包括依次使用每个失效原因的事件时间，将所有其他事件的时间视为删失，以提供原因别数 据。这可以通过创建一个新的变量来实现，该变量指示给定肝衰竭原因的事件时间是一个事件，而所有其他原因的事件时间都是删失的。例如，如果死因是血栓，则定义一个变量，对于 liver 数据框中变量 cof 等于 2 的观测，该变量为 1，否则为 0：然后可以在 survfit 函数中使用变量 status2 来获得生存函数估计。例如，当血栓形成是移植失效的原因时，每种肝病的生存函数的 Kaplan-Meier 估计使用如下代码获得。随后，可以使用 coxph 函数拟合每种事件类型的风险的 Cox 回归模型，如 17.4 节所述。例如，要获得第 12 章表 12.5 中的原因别风险比，在以血栓形成引起的移植失败为事件拟合 Cox 回归模型后，使用所得血栓形成的风险比如表 12.5 所示。移植失效的其他原因可以用类似的方式处理。","code":"> liver$status2<-ifelse(liver$cof==2,1,0)> km2<-survfit(Surv(time,status2) ~ fdisease,data=liver)\n> summary(km2)> crfit2<-coxph(Surv(time,status2) ~ age+fgender+fdisease,\n                ties=\"breslow\",data=liver)"},{"path":"chap17.html","id":"sec17-12-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.12.2 估计累计发生率函数","text":"cmprsk 包中的函数 cuminc 可用于估计原因别累积发生率函数，其中选项 ftime= 和 fstatus= 用于指定包含生存时间和状态指示符的变量。例如，为了获得血栓形成的总体累积发生率，使用以下命令。这可以扩展到为每个移植指示符提供累积发生率函数，使用 group= 选项指定分组变量，如在此之后，例如，酒精性肝病的累积发病率和相应的时间点可以从变量 cuminc2$\"ALD 1\"$est 和 cuminc2$\"ALD1\"$time 中获得。这些可以分配变量名称，以便在进一步的分析或图形总结中使用。例如，可以使用plot(cuminc2) 获得累积发生率函数的图形，这类似于图 12.2.","code":"> cuminc2all<-cuminc(ftime=liver$time,fstatus=liver$status2)> cuminc2<-cuminc(ftime=liver$time,fstatus=liver$status2,\n                  group=liver$fdisease)"},{"path":"chap17.html","id":"sec17-12-3","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.12.3 累积发生率的 Fine and Gray 模型","text":"第 12 章 12.5 节中描述的 Fine Gray 模型用于在存在竞争风险的情况下对事件的累积发生率进行建模。该模型可以使用 cmprsk 包中的函数 crr 进行拟合。该函数不允许指定模型公式，相反，必须提供一个包含解释变量值的矩阵，该矩阵将被包含在模型中。对于因子，需要定义指示变量，但可使用 model.matrix 函数来辅助。例如，函数 model.matrix(~+B)[,-1] 将为两个因子 和 B 生成指示变量。最后的 [,-1] 会从函数的输出中移除一个常数项，以避免对指示变量进行过度参数化。例如，对于肝移植后移植失败时间的数据，性别和肝病因素的指标变量的水平在 liver 数据框的 fgender 和 fdisease 列中，使用如下命令。患者的年龄也应包括在模型中，因此必须将其与 indvars 中的指标变量相结合，以给出包含年龄以及性别和疾病的指标变量的矩阵 xvars。生成的矩阵的列也被重命名。这些使用如下代码实现。矩阵 xvars 的前 10 行如下所示。由 model.matrix 函数生成的指标变量是这样的：如果疾病是 PBC（或 PSC），则 PBC（或 PSC）的值为 1，否则为 0；对于男性患者，male 的值为 1，否则为 0.现在可用 crr 函数来拟合特定事件的累积发生率的模型。使用选项 ftime= 和 fstatus= 指定包含每个事件时间以及每种事件类型编码以及删失观测的变量。接下来，使用 cov1= 指定要包含在模型中的解释变量矩阵。可以使用 cencode= 选项指定删失时间的编码，failcode= 选项用于指定要建模的事件类型，所有其他事件都是竞争风险。在 liver 数据框中，变量 cof 包含事件编码，对于删失时间为 0，对于血栓形成为 2. 使用 failcode=2 指定要对血栓形成的发生率进行建模。选项 cencode=0 指定变量 cof 在删失时间为 0，但这是不必要的，因为这是默认值。使用了以下 crr 函数调用，以对血栓形成发生率关于患者年龄、性别和原发性肝病的依赖性进行建模。使用 summary(cifit2) 会生成以下输出。输出在很大程度上是不言自明的，并给出了模型中解释变量系数的估计、相应的子风险比 exp(coeff)、系数的标准误、\\(z\\) 值和 \\(P\\) 值。然后重复输出了子风险比，标记为 2.5% 和 97.5% 的两列是它们的 95% 置信限。这些对应于表 12.6 中 “Thrombosis”（血栓形成）栏中的值。随后是拟合模型的对数似然值。Pseudo Log-likelihood 是根据第 12 章式 (12.12) 获得的最大化偏对数似然，Pseudo likelihood ratio test 将其与零模型（即没有解释变量的模型）进行比较。可以从 crr 对象 cifit2 中提取各种量以用于进一步分析。使用值为 1, 3 和 4 的 failcode 将能够对其他三种事件类型的发生率进行建模。","code":"> indvars<-model.matrix(~liver$fdisease+liver$fgender)[,-1]> xvars<-cbind(liver$age,indvars)\n> colnames(xvars)<-c(\"age\",\"PBC\",\"PSC\",\"male\")   age PBC PSC male\n1   55   0   0    1\n2   63   1   0    1\n3   67   1   0    1\n4   58   0   0    1\n5   59   1   0    1\n6   35   1   0    0\n7   51   1   0    0\n8   61   0   1    0\n9   51   0   0    0\n10  59   0   0    0\ncifit2<-crr(ftime=liver$time,fstatus=liver$cof,cov1=xvars,cencode=0,\n            failcode=2)Competing Risks Regression\n\nCall:\ncrr(ftime = liver$time, fstatus = liver$cof, cov1 = xvars, failcode = 2, \n    cencode = 0)\n\n        coef exp(coef) se(coef)      z p-value\nage  -0.0233     0.977   0.0104 -2.246   0.025\nPBC   0.6057     1.833   0.2798  2.165   0.030\nPSC   0.4648     1.592   0.3086  1.506   0.130\nmale  0.0760     1.079   0.2458  0.309   0.760\n\n     exp(coef) exp(-coef)  2.5% 97.5%\nage      0.977      1.024 0.957 0.997\nPBC      1.833      0.546 1.059 3.171\nPSC      1.592      0.628 0.869 2.914\nmale     1.079      0.927 0.666 1.747\n\nNum. cases = 1761\nPseudo Log-likelihood = -528 \nPseudo likelihood ratio test = 9.28  on 4 df,"},{"path":"chap17.html","id":"sec17-13","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.13 多次事件和事件历史建模","text":"复发事件模型，具体来说，Anderson Gill (AG) 以及 Prentice, Williams Peterson (PWP) 模型，可以在以计数过程格式表达相关数据后进行拟合，如第 13 章示例 13.2 所示。这可以使用 17.9 节中描述的 tmerge 和 surveSplit 函数直接完成。此外，tmerge 中的 cumtdc= 选项可用于枚举每个个体的复发事件数。当使用 coxph 函数拟合 PWP 模型时，需要通过复发次数进行分层。事件历史模型是通过定义与不同转移相关的变量来拟合的，并使用该变量以 tmerge 的计数过程格式形成数据。将数据集转换为所需格式所需的数据操作可能很复杂，这取决于所提供数据的格式。因此，此处不再提供更多详细信息。","code":""},{"path":"chap17.html","id":"sec17-14","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.14 相依删失","text":"14.3 节描述的具有相依删失的 Cox 回归模型可以通过以下方式进行拟合。首先，通过为删失时间拟合生存模型来估计删失概率。这是通过反转通常的事件时间指示符来完成的，使得它对删失时间取值 1，对事件时间取值 0. 如 14.3 节所述，拟合参数模型更方便，因此 survreg 函数用于对删失的风险进行建模。该模型中的参数估计产生线性预测器和尺度参数，它们被保存到数据框中以供以后使用。然后使用 surveSplit 函数以计数过程格式表示事件时间数据。这是通过创建一个具有唯一事件时间的变量来实现的，该变量用于函数的 cuts= 选项。根据扩展的数据框，在每个区间终点计算删失时间的生存函数的估计。它们的倒数是相依删失建模中所需的权重。最后，使用具有选项 weights=（用于指定权重变量）的 coxph 函数为计数过程数据拟合 Cox 回归模型。为了说明所需代码，将使用示例 14.1 中关于等待肝移植时死亡时间的数据来拟合考虑相依删失的 Cox 回归模型。首先输入数据，以给出与表 14.1 匹配的数据帧 livertx。\n然后，使用删失状态变量 cstatus，通过为删失时间拟合 Weibull 分布来对删失概率进行建模。使用以下代码将线性预测器和尺度参数的估计分配给 lp 和 sigma 并保存在 livertx 数据框中。下一步是构造一个变量 survtime，其中包含数据集中事件时间的唯一值，并在 survSplit 函数中使用该变量以计数过程格式给出新的数据框 livertx1。变量 time 现在是每个时间区间的终点。现在可以根据式 (17.1) 中参数模型的对数线性形式找到在这些端点处的生存函数估计。根据第 14 章的式 (14.5)，超过时间 \\(t\\) 的删失概率估计为\\[\\hat{S}_{ci}(t)=\\exp\\left\\{-\\exp\\left[\\frac{\\log t-\\hat{\\eta}_{ci}}{\\hat{\\sigma}_{c}}\\right]\\right\\}\\]其中，模型中的线性预测器是 \\(\\hat{\\eta}_{ci}=\\hat{\\mu}_{c}+\\hat{\\boldsymbol{\\alpha}}_{c}'\\boldsymbol{x}_{}\\)，并且 \\(\\hat{\\boldsymbol{\\mu}}_{c}\\) 是截距，\\(\\hat{\\mathbf{O}}_{c}\\) 是解释变量的系数向量，而 \\(\\hat{\\sigma}_{c}\\) 是 Weibull 模型对数线性形式的尺度参数。用于在计数过程数据中的每个区间的终点处获得的生存函数估计并计算权重的代码如下。不再需要变量 cstatus, lp, sigma 和 csurv，可以使用如下代码从 livertx1 中删除。livertx1 的前 8 行如下所示。现在可使用如下代码拟合加权 Cox 回归模型。下面是 summary(wcoxfit) 的部分输出。该输出中四个解释变量的系数估计及其稳健的标准误与表 14.4 中的加权估计一致。该模型的未加权版本可以使用如下代码实现。\n如果需要，可以通过为每个单独的观测定义聚类标识符并将 cluster(id) 添加到模型公式中来获得该模型中系数标准误的稳健估计，如下所示。该代码的输出给出了表 14.4 中的未加权估计。","code":"> livertx<-read.table(\"Time to death while waiting for a liver transplant.dat\",header=TRUE)> livertx$cstatus<-1-livertx$status\n> wcens<-survreg(Surv(time,cstatus) ~ age+gender+bmi+ukeld,\n                 data=livertx)\n> livertx$lp<-wcens$linear.predictors\n> livertx$sigma<-wcens$scale> survtime<-subset(livertx,status==1)\n> survtime<-unique(survtime[,\"time\"])\n> livertx1<-survSplit(Surv(time,status) ~ .,cut=survtime,data=livertx)> livertx1$csurv<-exp(-exp((log(livertx1$time)-\n                              livertx1$lp)/livertx1$sigma))\n> livertx1$weight<-1/livertx1$csurv> livertx1<-subset(livertx1,select=-c(cstatus,lp,sigma,csurv))  patient age gender   bmi ukeld tstart time status   weight\n1       1  60      0 24.24    60      0    1      0 1.004505\n2       2  66      0 30.53    67      0    2      1 1.011361\n3       3  71      0 26.56    61      0    2      0 1.008534\n4       3  71      0 26.56    61      2    3      0 1.012929\n5       4  65      1 23.15    63      0    2      0 1.012837\n6       4  65      1 23.15    63      2    3      0 1.019468\n7       5  62      0 22.55    64      0    2      0 1.011611\n8       5  62      0 22.55    64      2    3      0 1.017603> wcoxfit<-coxph(Surv(tstart,time,status) ~ age+gender+bmi+ukeld,\n                 weight=weight,ties=\"breslow\",data=livertx1)Call:\ncoxph(formula = Surv(tstart, time, status) ~ age + gender + bmi + \n    ukeld, data = livertx1, weights = weight, ties = \"breslow\")\n\n  n= 8968, number of events= 64 \n\n            coef exp(coef)  se(coef) robust se      z Pr(>|z|)    \nage     0.011805  1.011875  0.007758  0.031582  0.374  0.70858    \ngender -0.990764  0.371293  0.367368  0.655330 -1.512  0.13057    \nbmi    -0.021822  0.978414  0.014422  0.049145 -0.444  0.65702    \nukeld   0.155906  1.168716  0.018695  0.042688  3.652  0.00026 ***> coxph(Surv(tstart,time,status) ~ age+gender+bmi+ukeld,ties=\"breslow\",\n        data=livertx1)> livertx1$id<-1:nrow(livertx1)\n> coxfit<-coxph(Surv(tstart,time,status) ~ age+gender+bmi+ukeld+\n                  cluster(id),ties=\"breslow\",data=livertx1)"},{"path":"chap17.html","id":"sec17-15","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.15 贝叶斯生存分析","text":"rstanarm 包支持使用 Markov\nChain Monte Carlo (MCMC) 方法和 R 建模语法来拟合各种回归模型。该包又是 rstan 包的补充，它提供了 Stan 的 R 接口，Stan 是一个用于贝叶斯建模和推理的 C++ 库。第 16 章描述的贝叶斯生存分析可以使用 rstanarm 中的函数 stan_surv 来实现，该函数在 Brilleman et al. (2020) 的文章中进行了描述。第 16 章示例 16.7 中描述的健康评估和与初级保健联系的 HELP 研究数据将用于展示如何在贝叶斯生存分析中使用函数 stan_surv，并说明结果输出。使用如下命令将数据输入到名为 help 的数据框。安装 rstanarm 包后，可以使用 library(\"rstanarm\") 加载它。rstanarm 最新发布的 CRAN 版本（version 2.32.1，发布日期：2024-01-18）尚无 feature/survival，即无法进行生存分析。要完成下列分析，需使用如下命令安装 rstanarm survival branch 的二进制版本（静态版本）：具体详见 rstanarm 的 Github页面 以及这里和这里的讨论。","code":"> help<-read.table(\"Health evaluation and linkage to primary care.dat\",\n                   header=TRUE)\ninstall.packages(\"rstanarm\", repos = c(\"https://mc-stan.org/r-packages/\", getOption(\"repos\")))"},{"path":"chap17.html","id":"sec17-15-1","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.15.1 贝叶斯参数建模","text":"stan_surv 函数可用于拟合基线风险函数的贝叶斯版本的指数, Weibull 和 Gompertz 模型（如第 5 章所述）以及对数基线风险的 B 样条模型（如第 6 章的 6.3 节所述）。需要指定模型中未知参数的分布以及有关 MCMC 仿真过程的信息。贝叶斯 Weibull 比例风险模型包含数据集中的四个变量（\\(Age, Gender, Housing\\) 和 \\(Help\\)），可以使用以下代码为 HELP 研究的数据进行拟合。该模型是使用 Surv 对象以通常的方式指定的，而 Weibull 基线危险是使用 basehaz=\"weibull\" 指定的。使用 stan_surv，Weibull 比例风险模型参数化为 \\(h_i(t)~=~\\exp(\\boldsymbol{\\beta'x}_i)\\lambda\\gamma t^{\\gamma-1}\\)，其中 \\(\\log \\lambda\\) 称为截距并在输出中表示为 (Intercept)，\\(\\gamma\\) 为形状参数，在输出中标记为 weibull-shape。使用 algorithm=c(\"sampling\") 启动 MCMC 采样过程，但由于这是 stan_surv 函数的默认设置，因此已省略此选项。关于要使用的链的数量、所需的模拟总数以及用于热身的模拟数的详细信息分别使用选项 chain=, iter= 和 warmup= 给出。seed= 选项可用于初始化模拟过程的伪随机数生成器，并使随机数序列能够再现。接下来，指定先验分布。可使用广泛的先验分布，包括正态分布、柯西分布、指数分布和 Laplace 分布。Brilleman et al. (2020) 的 vignette 对这些进行了描述。在上述代码中，为 Weibull 模型的截距 \\(\\log \\lambda\\) 指定了具有均值为零和方差为 102 的正态分布。prior_aux= 选项用于指定形状参数的先验分布，该分布为非负分布。在这种情况下，prior_aux=normal(0,10) 指定 Weibull 形状参数 \\(\\gamma\\) 为 half-normal 分布。prior= 选项用于指定模型线性部分中 \\(\\beta\\) 系数的先验分布，这里它们都分配了 \\(N(0,1)\\) 分布。在第 16 章的示例 16.7 中使用了先验分布的这种选择。如果 \\(\\beta\\) 系数具有不相同的先验分布，则可以使用不同的位置和尺度参数或不同的分布。stan_surv 的函数调用得到以下输出。summary 和 print 函数提供不同的输出信息。summary(hweib) 的输出如下。该输出给出了 10000 次 MCMC 模拟中解释变量系数的均值和标准差，Weibull 截距和形状参数，以及它们分布的 10%, 50% 和 90% 百分位数。输出中对标记为 MCMC diagnostics 的输出内容进行了有益的描述。使用 print(hweib) 的简略输出如下。该输出给出了 MCMC 估计的中位数，以及中位绝对偏差 (median absolute deviation)，标记为 MAD_SD。这是对变异性估计的稳健度量，计算为每个模拟值与总体中位数之差绝对值的中位数。 exp(Median) 列表示中位数的指数，可用作模型中每个变量的风险比估计。函数 prior_summary 提供了一种有用的方法来获得 stan_surv 函数中使用的先验总结，得到以下输出。这证实了 Weibull 模型的截距和形状参数以及变量系数的所选先验。","code":"> hweib<-stan_surv(Surv(days,status) ~ linkage+age+gender+housing,\n                   basehaz=\"weibull\",chains=1,iter=11000,warmup=1000,seed=123,\n                   prior_intercept=normal(0,10),prior_aux=normal(0,10),\n                   prior=normal(0,1),data=help)Model Info:\n\n function:        stan_surv\n baseline hazard: weibull\n formula:         Surv(days, status) ~ linkage + age + gender + housing\n algorithm:       sampling\n sample:          10000 (posterior sample size)\n priors:          see help('prior_summary')\n observations:    447\n events:          167 (37.4%)\n right censored:  280 (62.6%)\n delayed entry:   no\n\n Estimates:\n                 mean     sd     10%     50%     90%\n(Intercept)   -6.3613 0.5235 -7.0404 -6.3580 -5.6853\nlinkage        1.6422 0.1846  1.4043  1.6400  1.8778\nage            0.0239 0.0100  0.0111  0.0239  0.0367\ngender         0.3439 0.1945  0.0985  0.3390  0.5946\nhousing       -0.1458 0.1530 -0.3403 -0.1456  0.0474\nweibull-shape  0.6084 0.0414  0.5549  0.6074  0.6621\n\nMCMC diagnostics\n                mcse   Rhat n_eff\n(Intercept)   0.0063 0.9999  6971\nlinkage       0.0021 0.9999  7710\nage           0.0001 1.0000  9042\ngender        0.0022 1.0000  8033\nhousing       0.0017 0.9999  8243\nweibull-shape 0.0005 1.0004  6472\nlog-posterior 0.0244 1.0000  4865\n\nFor each parameter, mcse is Monte Carlo standard error, n_eff is a\ncrude measure of effective sample size, and Rhat is the potential\nscale reduction factor on split chains (at convergence Rhat=1).               Median MAD_SD exp(Median)\n(Intercept)   -6.3580 0.5191          NA\nlinkage        1.6400 0.1835      5.1552\nage            0.0239 0.0100      1.0242\ngender         0.3390 0.1911      1.4036\nhousing       -0.1456 0.1529      0.8645\nweibull-shape  0.6074 0.0408          NA Priors for model 'hweib'\n ------\n Intercept\n ~ normal(location = 0, scale = 10)\n Coefficients\n ~ normal(location = [0,0,0,...], scale = [1,1,1,...])\n Auxiliary (weibull-shape)\n ~ half-normal(location = 0, scale = 10)"},{"path":"chap17.html","id":"sec17-15-2","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.15.2 贝叶斯半参数建模","text":"stan_surv 函数也可用于拟合基于 B 样条的对数风险函数的模型（在第 6 章的 6.3 节中描述）的贝叶斯版本。在使用零次 B 样条的特殊情况下，该模型等价于分段指数模型，其中在第 \\(j(j=1,2,\\ldots,m+1)\\) 个时间区间中，基线风险函数为 \\(h_0(t)=\\exp(\\alpha_j)\\)，其中 \\(m\\) 是内部结数，即最短和最长事件时间之间的结的数量。然而，R 函数 stan_surv 包含截距项，因此实际拟合的基线风险为 \\(h_0(t)=\\exp(\\mu+\\alpha_j)\\)。由于该模型中现在有 \\(m+2\\) 个未知参数，与 \\(m+1\\) 个时间区间相关，所以该模型被过度参数化，\\(\\alpha_1\\) 被设置为零。在第一个时间区间中，基线风险为 \\(e^\\mu\\)，在其余 \\(m\\) 个时间区间中，则为 \\(\\exp(\\mu+\\alpha_{j-1}),j=2,3,\\ldots,m+1\\)。那么，对于具有 \\(m\\) 个结的模型，将只有 \\(m\\) 个B 样条系数。所需的代码与为 HELP 研究数据拟合参数模型的代码非常相似，只是 basehaz= 选项设置为 bs，代表 B 样条曲线。为了拟合分段指数模型的贝叶斯版本，使用选项 basehaz_ops=list(degree=0,df=5) 来表示 B 样条函数的阶数和基线危险变化处的结的位置。这里，选项 df=5 意味着在最短 (0) 和最长 (456) 事件时间之间有五个内部结，并且时间区间的终点选择为在事件时间的等距百分位数处。这导致在第 18, 32, 42, 74 和 136 天出现内部结。选项 df=5 可以替换为用于内部结的事件时间列表，因此 basehaz_ops=list(degree=0,knots=c(18,32,42,74,136)) 将提供类似的输出。为每个事件时间区间设置不同基线风险的模型将非常接近 Cox 回归模型，这可以通过将结数设置为不同事件时间数，或者在 knots= 选项中列出唯一的事件时间来进行拟合。为了说明贝叶斯半参数建模，以下代码用于为 HELP 研究的数据拟合具有 5 个内部结的贝叶斯分段指数模型。所有四个解释变量均已包含在模型中。\\(N(0, 1)\\) 先验用于解释变量的每个系数，并且截距和每个 B 样条参数的先验分布取为 \\(N(0, 10)\\)。MCMC 模拟过程先进行 1,000 次热身，然后进行 10,000 次模拟。使用 print(bayespe) 得到的参数估计的中位数以及相应的风险比，如下。通过 MCMC 模拟得到的模型中解释变量的系数估计与拟合 Weibull 模型的贝叶斯版本时得到的系数估计非常相似。截距 Intercept 是 \\(\\mu\\) 的估计，标记为 b-splines-coef 的系数是对样条基函数的系数 \\(\\alpha_j,j=2,3,4,5,6\\) 的估计。基线风险函数在第一区间为 \\(\\exp(\\mu)\\)，在其余五个区间为 \\(\\exp{\\mu + \\alpha_j}\\)。这些数值需要从每个单独的 10,000 次 MCMC 模拟中推导出来，而不是通过该输出的中位数得出。对于具有给定特征的个体，posterior_survfit 可用于从 MCMC 模拟中模型参数的单个估计中获取后验预测生存函数和风险函数。具体来说，基线函数可以使用如下代码获得。使用 plot 对它们绘图，例如 plot(basesurv)。使用 waic 函数可以轻松得到使用 stan_surv 函数拟合的模型用于贝叶斯模型比较的 \\(WAIC\\) 统计量，如第 16 章 16.8 节所述。例如，waic(bayespe) 给出其中拟合分段指数模型的 \\(WAIC\\) 统计量为 2237.4，相应的模型复杂度估计为 \\(p_W = 9.6\\)。标记为 elpd_waic 的行是预期对数逐点预测密度 (expected log-pointwise predictive density)，是一种预测准确性的度量，将其乘以 -2 得到 \\(WAIC\\) 统计量。","code":"> bayespe<-stan_surv(Surv(days,status) ~ linkage+age+gender+housing,\n                     basehaz=\"bs\",basehaz_ops=list(degree=0,df=5),\n                     chains=1,iter=11000,warmup=1000,seed=1234,\n                     prior_intercept=normal(0,10),prior_aux=normal(0,10),\n                     prior=normal(0,1),data=help)                 Median MAD_SD exp(Median)\n(Intercept)     -7.6055 0.5038          NA\nlinkage          1.5339 0.1819      4.6362\nage              0.0219 0.0102      1.0222\ngender           0.2586 0.1926      1.2951\nhousing         -0.1165 0.1542      0.8901\nb-splines-coef1  0.1457 0.2733          NA\nb-splines-coef2  1.6314 0.2695          NA\nb-splines-coef3 -0.1793 0.2723          NA\nb-splines-coef4 -0.8054 0.2731          NA\nb-splines-coef5 -1.9390 0.2688          NA\nbasevals<-data.frame(linkage=0,age=0,gender=0,housing=0)\nbasesurv<-posterior_survfit(bayespe,type=\"surv\",newdata=basevals)\nbasehaz<-posterior_survfit(bayespe,type=\"haz\",newdata=basevals)          Estimate    SE\nelpd_waic  -1118.7  61.3\np_waic         9.6   0.5\nwaic        2237.4 122.7"},{"path":"chap17.html","id":"sec17-15-3","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.15.3 风险函数的灵活模型","text":"第6章 6.3 节中描述的对数风险函数的灵活的立方 B 样条模型的贝叶斯版本可以使用类似的代码进行拟合。唯一需要的更改是在 basehaz_ops= 选项中使用 degree=3。例如，可以使用 \\(WAIC\\) 准则来拟合具有越来越多内部结（自由度）的模型，并确定最合适的模型。第 6 章 6.4 节中描述的对数累积风险的限制性立方样条模型不常用于贝叶斯生存分析，因为很难确保对数累积风险是时间的递增函数，这会导致 MCMC 模拟过程出现问题。","code":""},{"path":"chap17.html","id":"sec17-16","chapter":"第 17 章 使用 R 进行生存分析","heading":"17.16 延伸阅读","text":"本章只能介绍一小部分用于生存分析的 R 包，以及展示数据操作、向量和矩阵代数等功能的部分内容。此外，对于 R 软件在数据可视化和图形化表示方面的应用，本章所涉非常有限。然而，有很多书籍都介绍了 R 软件及其在统计分析中的应用。其中包括 Crawley (2013), Dalgaard (2008), Davies (2016), Field, Miles Field (2012), Verzani (2014) 以及 Wickham (2019) 的著作。此外，还有一本名为 R Dummies的书籍 (de Vries Meys, 2015)，以及同一系列中介绍使用 R 进行统计分析的书籍 (Schmuller, 2017).Moore (2016) 描述了生存分析的原则，并说明了使用 R 进行数据分析。Broström (2022) 介绍了生存分析和事件史分析，并提供了使用 R 包 eha 分析社会科学领域数据的实例。所有 R 包都在 CRAN 网站上进行了描述，但其中一些包还提供了更详细的文档，称为 vignette. 这些 vignette 包括 survival 包的文档 (Therneau, 2022)、使用时依变量进行建模的文档 (Therneau, Crowson Atkinson, 2022a)、parfm 包的文档 (Munda, Rotolo Legrand, 2017)以及多状态模型和竞争风险模型的文档 (Therneau, Crowson Atkinson, 2022b). 还可参考 Munda, Rotolo Legrand (2012) 关于 parfm 的早期论文。Rizopoulos (2022) 描述了 JM 包，该包用于纵向和事件发生时间数据的联合建模。Brilleman et al. (2020) 描述了使用 rstanarm 包进行贝叶斯生存分析的方法。","code":""},{"path":"A.html","id":"A","chapter":"A 最大似然估计","heading":"A 最大似然估计","text":"本附录总结了与生存分析相关的最大似然估计结果。给出的结果同样适用于基于偏似然函数的推断，因此可以与第 3 章中介绍的 Cox 回归模型以及第 5 章和第 6 章中描述的全参数模型结合使用。Cox Hinkley (1974) 给出了最大似然估计和似然比检验。","code":""},{"path":"A.html","id":"secA-1","chapter":"A 最大似然估计","heading":"A.1 关于单个未知参数的推断","text":"假设 \\(n\\) 个观察到的生存时间 \\(t_1,t_2,\\ldots,t_n\\) 的似然是单个未知参数 \\(\\beta\\) 的函数，记作 \\(L(\\beta)\\)。\\(\\beta\\) 的最大似然估计 (maximum likelihood estimate) 就是使该函数达到最大值的值 \\(\\hat\\beta\\)。在几乎所有应用中，使用似然函数的自然对数 \\(\\log L(\\beta)\\) 更为方便。使对数似然最大化的值 \\(\\hat\\beta\\) 与使似然函数本身最大化的值相同，通常使用微分来求出。具体来说，\\(\\hat\\beta\\) 是 \\(\\log L(\\beta)\\) 关于 \\(\\beta\\) 的导数等于 0 时 \\(\\beta\\) 的值。换句话说，\\(\\hat\\beta\\) 满足\\[\\frac{\\mathrm{d}\\log L(\\beta)}{\\mathrm{d}\\beta}\\Bigg|_{\\hat{\\beta}}=0\\]\\(\\log L(\\beta)\\) 关于 \\(\\beta\\) 的一阶导数称为 \\(\\beta\\) 的有效得分 (efficient score)，记作 \\(u(\\beta)\\)。因此\\[\\begin{aligned}u(\\beta)&=\\frac{\\mathrm{d}\\log L(\\beta)}{\\mathrm{d}\\beta}\\end{aligned}\\]因此 \\(\\beta\\) 的最大似然估计 \\(\\hat\\beta\\) 满足\\[\\begin{aligned}u(\\hat{\\beta})=0\\end{aligned}\\]\\(\\beta\\) 最大似然估计的渐近方差根据下式得出\\[\\begin{equation}\n\\left(-\\operatorname{E}\\left\\{\\frac{\\operatorname{d}^2\\log L(\\beta)}{\\operatorname{d}\\beta^2}\\right\\}\\right)^{-1}\n\\tag{.1}\n\\end{equation}\\]或等价地根据下式得出\\[\\left(\\text{ E }\\left\\{\\frac{\\mathrm{d}\\log L(\\beta)}{\\mathrm{d}\\beta}\\right\\}^2\\right)^{-1}\\]从这两个式子中得出的方差都可视为 \\(\\hat\\beta\\) 的近似方差，但是使用式 (.1) 通常更直接。当式 (.1) 中导数的期望值难以获得时，通过计算在 \\(\\hat\\beta\\) 处的导数来找到 \\(\\hat\\beta\\) 的方差的进一步近似。这由下式给出\\[\\begin{equation}\n\\text{var }(\\hat{\\beta})\\approx\\left.-\\left(\\frac{\\mathrm{d}^2\\log L(\\beta)}{\\mathrm{d}\\beta^2}\\right)^{-1}\\right|_{\\hat{\\beta}}\n\\tag{.2}\n\\end{equation}\\]对数似然函数的二阶导数有时称为 Hessian，量\\[-\\text{ E }\\left\\{\\frac{\\text{d}^2\\log L(\\beta)}{\\text{d}\\beta^2}\\right\\}\\]称为信息函数。由于信息函数是由 \\(\\log L(\\beta)\\) 二阶导数的期望值形成的，因此有时称为期望信息函数 (expected information function). 相反，对数似然函数本身的负二阶导数称为观测信息函数 (observed information function). 将后者记作 \\((\\beta)\\)，因此\\[(\\beta)=-\\left\\{\\frac{\\mathrm{d}^2\\log L(\\beta)}{\\mathrm{d}\\beta^2}\\right\\}\\]该函数的倒数在 \\(\\hat\\beta\\) 处的值就是式 (.2) 中给出的 \\(\\hat\\beta\\) 的近似方差，即\\[\\mathrm{var~}(\\hat{\\beta})\\approx\\frac1{(\\hat{\\beta})}\\]\\(\\hat\\beta\\) 的标准误，即 \\(\\hat\\beta\\) 方差估计的平方根，为\\[\\begin{aligned}\\operatorname{se}\\left(\\hat{\\beta}\\right)&=\\frac1{\\sqrt{\\{(\\hat{\\beta})\\}}}\\end{aligned}\\]该标准误可用于构造 \\(\\beta\\) 的置信区间。为检验 \\(\\beta=0\\) 的原假设，可以使用三种检验统计量。似然比检验统计量 (likelihood ratio test statistic) 为 \\(-2\\log L(\\hat{\\beta})\\) 和 \\(-2\\log L(0)\\) 之差。Wald 检验 (Wald test) 基于统计量\\[\\hat{\\beta}^2i(\\hat{\\beta})\\]以及得分检验统计量 (score test statistic) 为\\[\\begin{aligned}\\frac{\\{u(0)\\}^2}{(0)}\\end{aligned}\\]在 \\(\\beta=0\\) 的原假设下，这些统计量都渐近服从自由度为一的卡方分布。请注意，Wald 统计量等价于统计量\\[\\begin{aligned}\\frac{\\hat{\\beta}}{\\text{se }(\\hat{\\beta})}\\end{aligned}\\]其渐近分布于标准正态分布。","code":""},{"path":"A.html","id":"secA-2","chapter":"A 最大似然估计","heading":"A.2 关于未知参数向量的推断","text":".1 节中的结果可以扩展到使用 \\(n\\) 个观测值来估计 \\(p\\) 个未知参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p\\) 的值的情况。这些参数可以组装成一个 \\(p×1\\) 的向量 \\(\\beta\\)，相应的似然函数为 \\(L(\\boldsymbol{\\beta})\\)。使 \\(L(\\boldsymbol{\\beta})\\) 最大化的 \\(p\\) 个未知参数的最大似然估计为 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\)。它们是通过同时求解 \\(p\\) 个方程得到的\\[\\left.\\frac{\\mathrm{d}\\log L(\\boldsymbol{\\beta})}{\\mathrm{d}\\beta_j}\\right|_{\\boldsymbol{\\hat{\\beta}}}=0\\]其中 \\(j=1,2,\\ldots,p\\)。由 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 组成的向量记为 \\({\\boldsymbol{\\hat{\\beta}}}\\)，因此最大似然为 \\(L(\\hat{\\boldsymbol{\\beta}})\\)。\\(\\beta_j(j=1,2,\\ldots,p)\\) 的有效得分为\\[u(\\beta_j)=\\frac{\\mathrm{d}\\log L(\\boldsymbol{\\beta})}{\\mathrm{d}\\beta_j}\\]这些量可以组合起来得到有效得分的 \\(p×1\\) 向量，记作 \\(\\boldsymbol{u}(\\boldsymbol{\\beta})\\)。因此，最大似然估计向量满足\\[\\boldsymbol{u}(\\hat{\\boldsymbol{\\beta}})=\\boldsymbol{0}\\]其中 \\(\\boldsymbol 0\\) 为\\(p×1\\) 零向量。现在令矩阵 \\(\\boldsymbol H(\\boldsymbol \\beta)\\) 为对数似然函数 \\(\\log L(\\hat{\\boldsymbol{\\beta}})\\) 的二阶偏导数的 \\(p × p\\) 矩阵。\\(\\boldsymbol H(\\boldsymbol \\beta)\\) 的第 \\((j, k)\\) 个元素为\\[\\begin{aligned}\\frac{\\partial^2\\log L(\\hat{\\boldsymbol{\\beta}})}{\\partial\\beta_j\\partial\\beta_k}\\end{aligned}\\]其中 \\(j=1,2,\\ldots,p,k=1,2,\\ldots,p\\)。\\(\\boldsymbol H(\\boldsymbol \\beta)\\) 称为 Hessian 矩阵。矩阵\\[\\boldsymbol{}(\\boldsymbol{\\beta})=-\\boldsymbol{H}(\\boldsymbol{\\beta})\\]称为观测信息矩阵 (observed information matrix)。相应期望信息矩阵 (expected information matrix) 的第 \\((j, k)\\) 个元素为\\[\\begin{aligned}-\\operatorname{E}\\left(\\frac{\\partial^2\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j\\partial\\beta_k}\\right)\\end{aligned}\\]最大似然估计 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 的方差-协方差阵，写作 \\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\)，可以通过观测信息矩阵的逆在 \\(\\hat{\\boldsymbol\\beta}\\) 处的值来近似，即\\[\\mathrm{var~}(\\hat{\\boldsymbol{\\beta}})\\approx\\boldsymbol{}^{-1}(\\hat{\\boldsymbol{\\beta}})\\]该矩阵第 \\((j, j)\\) 个元素的平方根可视为 \\(\\hat{\\beta}_{j}\\) 的标准误，其中 \\(j=1,2,\\ldots,p\\)。.1 节中给出的检验统计量可以推广到多参数的情况。考虑关于原假设的检验，即拟合模型中的所有 \\(\\beta\\) 参数都等于 0. 似然比检验统计量的值为\\[2\\left\\{\\log L(\\hat{\\boldsymbol{\\beta}})-\\log L(\\mathbf{0})\\right\\}\\]Wald 检验基于\\[\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{}(\\hat{\\boldsymbol{\\beta}})\\hat{\\boldsymbol{\\beta}}\\]得分检验统计量为\\[\\boldsymbol{u}'(\\boldsymbol{0})\\boldsymbol{}^{-1}(\\boldsymbol{0})\\boldsymbol{u}(\\boldsymbol{0})\\]在原假设 \\(\\boldsymbol\\beta = \\boldsymbol0\\) 下，这些统计量中都服从自由度为一的卡方分布。在比较替代模型时，人们的兴趣集中于这样的假设：模型中的某些 \\(\\beta\\) 参数为零。为检验该假设，似然比检验是最合适的，所以我们在这里只考虑这个程序。假设将包含 \\(p + q\\) 个参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p,\\beta_{p+1},\\ldots,\\beta_{p+q}\\) 的模型与仅包含 \\(p\\) 个参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p\\) 的模型进行比较。这相当于检验原假设：具有 \\(p + q\\) 个未知参数的模型中 \\(q\\) 个参数 \\(\\beta_{p+1},\\beta_{p+2},\\ldots,\\beta_{p+q}\\) 均等于 0. 令 \\(\\hat{\\boldsymbol\\beta}_1\\) 表示具有 \\(p + q\\) 个参数的模型的向量估计，\\(\\hat{\\boldsymbol\\beta}_2\\) 表示仅具有 \\(p\\) 参数的模型的向量估计。那么，在具有 \\(p + q\\) 参数的模型中，有关原假设 \\(\\beta_{p+1},\\beta_{p+2},\\ldots,\\beta_{p+q}=0\\) 的似然比检验基于统计量\\[2\\left\\{\\log L(\\hat{\\boldsymbol{\\beta}}_1)-\\log L(\\hat{\\boldsymbol{\\beta}}_2)\\right\\}\\]在原假设下，它服从自由度为 \\(q\\) 的卡方分布。该检验构成了比较替代模型的基础，并在第 3 章 3.5 节中进行了更详细的描述。","code":""},{"path":"B.html","id":"B","chapter":"B 额外数据集","heading":"B 额外数据集","text":"本附录包含若干数据集以及一些分析建议。这些数据集可从出版商的网站下载，其链接在前言中给出。","code":""},{"path":"B.html","id":"secB-1","chapter":"B 额外数据集","heading":"B.1 慢性活动性肝炎","text":"在 Kirk et al.(1980) 描述的一项临床试验中，44 名慢性活动性肝炎患者被随机分配到泼尼松龙药物治疗组或未治疗的对照组。患者入组后的生存时间（以月为单位）是感兴趣的响应变量。这些数据由 Pocock (1983) 给出，并在表 B.1 中列出。\n根据每个治疗组的生存函数估计总结数据。使用 log-rank 检验和 Wilcoxon 检验比较各组。拟合 Cox 和 Weibull 比例风险模型以确定治疗效应的显著性。根据治疗效应的显著性，比较这些不同分析的结果，以及基于模型的风险比估计和相应的 95% 置信限。获取数据的对数累积风险图，并评论哪种分析方法最合适。","code":""},{"path":"B.html","id":"secB-2","chapter":"B 额外数据集","heading":"B.2 膀胱癌的复发","text":"由 Veterans Administration Cooperative Urological Research Group 进行的一项关于膀胱癌的安慰剂对照试验中，患有浅表性膀胱肿瘤的患者首先通过经尿道切除术切除了肿瘤。随后，他们被随机分配到安慰剂组或化疗药物噻替哌组。在随机分组时，记录了每个患者的肿瘤初始数量和其中最大肿瘤的直径。Andrews Herzberg (1985) 中包含的原始数据集给出了最多九次肿瘤复发的时间，但表 B.2 中的数据指的是第一次复发的时间，以月为单位。在随访期结束时仍未复发的患者记录为删失观测。数据集中的变量如下：\\(Patient\\)：患者编号（1-86）\\(Time\\)：生存时间（月）\\(Status\\)：患者状态（0 = 删失，1 = 复发）\\(Treat\\)：治疗组（1 = 安慰剂，2 = 噻替哌）\\(Init\\)：肿瘤初始数量\\(Size\\)：最大初始肿瘤直径（厘米）\n使用 Cox 比例风险模型确定复发时间是否依赖于解释变量 \\(Init\\) 和 \\(Size\\)。在调整相关变量后，考察治疗效应的显著性。考察是否有证据表明治疗组和两个解释变量之间存在相互作用。利用模型检查诊断，评论拟合模型的适用性。具体来说，通过拟合一个合适的时依变量，检验关于治疗的比例风险假设。估计治疗效应的风险比，并给出该比值的 95% 置信区间。将该估计与拟合 Weibull 比例风险模型得到的估计进行比较。","code":""},{"path":"B.html","id":"secB-3","chapter":"B 额外数据集","heading":"B.3 黑鸭的生存","text":"US Fish Wildlife Service 进行了一项关于黑鸭（学名 Anas rubripes）迁徙和越冬生存情况的研究。在第一年的研究中，研究人员在 New Jersey 的两个地点捕获了 50 只雌性黑鸭，并为它们装上了无线电发射器。这些鸭子是在 1983 年 11 月 8 日至 1983 年 12 月 14 日大约四周时间内捕获的，其中包括 31 只当年孵化的幼鸭（即在前一个繁殖季节出生的鸭子）和 19 只至少一岁大的鸭子。研究人员测量了每只鸭子的体重和翼长。从鸭子被释放之日起，研究人员每天记录每只鸭子的状态，即存活、失踪还是死亡，直到 1984 年 2 月 15 日研究结束。该数据集包含在 Hand et al. (1994) 的著作中，包含以下变量：\\(Time\\)：生存时间（天）\\(Status\\)：鸟的状态（ 0 = 存活或失踪，1 = 死亡）\\(Age\\)：年龄组（0 = 当年孵化的幼鸭，1 = 年龄大于等于 1 年的鸟）\\(Weight\\)：鸟的重量（克）\\(Length\\)：翼长（毫米）研究中鸭子的每个变量的值如表 B.3 所示。\n使用比例风险模型，考察年龄、体重和翼长对生存时间的影响。探究解释变量体重和翼长的系数在每个年龄组的鸭子中是否存在差异。是否有证据表明模型中需要体重和翼长的非线性函数？","code":""},{"path":"B.html","id":"secB-4","chapter":"B 额外数据集","heading":"B.4 骨髓移植","text":"白血病治疗后，患者通常会接受骨髓移植，以帮助将血细胞恢复到正常水平。这种治疗的一个潜在致命的副作用是移植物抗宿主病 (graft-versus-host disease)，即移植细胞攻击宿主细胞。在 Bagot et al. (1988) 描述的一项研究中，37 名患有急性髓细胞白血病（AML）或急性淋巴细胞白血病（）并已达到完全缓解状态，或是处于慢性粒细胞白血病（CML）慢性期的患者接受了非耗竭异基因骨髓移植 (non-depleted allogeneic bone marrow transplant). 记录了骨髓供体的年龄、供体是否曾怀孕，以及受体的年龄、白血病类型、混合表皮淋巴细胞反应指数，以及受体是否出现移植物抗宿主病。该数据集中的变量如下：\\(Patient\\)：患者编号（1-37）\\(Time\\)：存活天数\\(Status\\)：患者状态（0 = 存活，1 = 死亡）\\(Rage\\)：患者年龄\\(Dage\\)：供体年龄\\(Type\\)：白血病类型（1 = AML，2 = ，3 = CML）\\(Preg\\)：供体妊娠（0 = 否，1 = 是）\\(Index\\)：细胞-淋巴细胞反应指数\\(GVHD\\)：移植物抗宿主病（0 = 否，1 = 是）Altman (1991) 中也给出了这些数据，如表 B.4 所示。\n使用 Weibull 加速失效时间模型研究生存时间对预后变量的依赖性。估计并绘制基线生存函数。拟合包含相同解释变量的 loglogistic 和 lognormal 模型，并估计在这些模型下的基线生存函数。将这些估计与从 Cox 比例风险模型拟合得到的基线生存函数估计进行比较。然后，请评论哪种参数模型最合适，并使用模型检查诊断进一步检查该模型的充分性。","code":""},{"path":"B.html","id":"secB-5","chapter":"B 额外数据集","heading":"B.5 慢性肉芽肿病","text":"慢性肉芽肿病 (chronic granulomatous disease, CGD) 是一组免疫系统的遗传性疾病，这些疾病使患者容易受到反复感染以及慢性炎症的影响，例如牙龈炎、淋巴结肿大或非恶性的肿瘤样肿块（称为肉芽肿）。这些肉芽肿会阻碍食物通过消化系统的通道，并可能抑制尿液从肾脏和膀胱的流动。该病通常使用抗生素进行治疗，但 Genentech 公司开展的一项多中心试验比较了抗病毒药物干扰素与安慰剂的效果。研究人员收集了一系列预后变量的数据，而关注的终点是随机分组后首次出现严重感染的时间。Therneau Grambsch (2000) 描述的数据集包含以下变量：\\(Patient\\)：患者编号（1-128）\\(Time\\)：第一次感染的时间（天）\\(Status\\)：患者状态（0 = 删失，1 = 感染）\\(Center\\)：中心（1 = Harvard Medical School，2 = Scripps Institute, California，3 = Copenhagen，4 = National Institutes Health, Maryland，5 = Los Angeles Children’s Hospital，6 = Mott Children’s Hospital, Michigan，7 = University Utah，8 = Children’s Hospital Philadelphia, Pennsylvania，9 = University Washington，10 = University Minnesota，11 = University Zurich，12 = Texas Children’s Hospital，13 = Amsterdam，14 = Mount Sinai Medical Center）\\(Treat\\)：治疗组（0 = 安慰剂，1 = 干扰素）\\(Age\\)：年龄（年）\\(Sex\\)：性别（1 = 男性，2 = 女性）\\(Height\\)：身高（厘米）\\(Weight\\)：体重（公斤）\\(Pattern\\)：遗传模式（1 = X连锁，2 = 常染色体隐性）\\(Cort\\)：试验开始时使用皮质类固醇（1 = 使用，2 = 未使用）\\(Anti\\)：试验结束时使用抗生素为首次感染的时间确定一个合适的模型，并调查该模型的充分性。是否有任何证据表明不同中心的治疗效应不一致？根据相关的点估计和相应的置信区间总结治疗差异。现在假设实际的感染时间是区间删失的，并且任何个体的感染状态只能在 90 天、180 天、270 天和 360 天记录。根据生存时间构造一个新的观测，该观测给出了感染或删失发生的区间。对于未感染或在 360 天后发生感染的个体，其观测视为删失。对于这个构造的数据集，使用第 9 章描述的方法分析区间删失数据。将治疗效应估计与根据原始数据得到的估计进行比较。为这些数据拟合具有共享脆弱性的参数模型和 Cox 回归模型，其中中心是随机脆弱效应。比较和对比两组结果并评论中心变异的程度。确定每个中心在前 180 天内首次感染的患者数。通过为首次感染时间拟合 Cox 回归模型，使用第 11 章描述的方法，估计每个中心 180 天风险调整的首次感染率。将中心视为固定或随机的，计算该率的相应区间估计，并评论任何差异的程度。研究这些数据中相依删失的影响。首先，拟合删失概率的 Weibull 模型，并使用该模型获得与删失成反比的权重。以计数过程格式表示感染时间数据，拟合加权 Cox 回归模型以考虑任何相依删失。将其结果与未加权 Cox 回归分析获得的结果进行比较。","code":""},{"path":"bib.html","id":"bib","chapter":"参考书目","heading":"参考书目","text":"Aalen, O.O. (1978a) Nonparametric estimation partial transition probabilities multiple decrement models. Annals Statistics, 6, 534–545.Aalen, O.O. (1978b) Nonparametric inference family counting processes. Annals Statistics, 6, 701–726.Aalen, O.O. (1994) Effects frailty survival analysis. Statistical Methods Medical Research, 3, 227–243.Aalen, O.O. (1998) Frailty models. : Statistical Analysis Medical Data: New Developments (eds. B.S. Everitt G. Dunn), Arnold, London.Aalen, O.O. Johansen, S. (1978) empirical transition matrix non-homogeneous Markov chains based censored observations. Scandinavian Journal Statistics, 5, 141–150.Aalen, O.O., Borgan, Ø. Gjessing, H. (2008) Survival Event History Analysis: Process Point View, Springer, New York.Aitkin, M., Anderson, D.., Francis, B. Hinde, J.P. (1989) Statistical Modelling GLIM, Clarendon Press, Oxford.Aitkin, M., Laird, N. Francis, B. (1983) reanalysis Stanford heart transplant data (comments). Journal American Statistical Association, 78, 264–292.Akaike, H. (1974) new look statistical model identification. IEEE Transactions Automatic Control, 19, 716–723.Akritas, M.G. (1994) Nearest neighbor estimation bivariate distribution random censoring. Annals Statistics, 22, 1299–1327.Allison, P.D. (2010) Survival Analysis Using SAS⃝R: Practical Guide, 2nd ed., SAS Institute Inc., Cary, North Carolina.Altman, D.G. (1991) Practical Statistics Medical Research, Chapman & Hall/CRC, London.Altman, D.G. De Stavola, B.L. (1994) Practical problems fitting proportional hazards model data updated measurements covariates. Statistics Medicine, 13, 301–341.Altshuler, B. (1970) Theory measurement competing risks animal experiments. Mathematical Biosciences, 6, 1–11.Andersen, P.K. (1982) Testing goodness fit Cox’s regression life model. Biometrics, 38, 67–77.Andersen, P.K. (1988) Multistate models survival analysis: study nephropathy mortality diabetes. Statistics Medicine, 7, 661–670.Andersen, P.K. (1992) Repeated assessment risk factors survival analysis. Statistical Methods Medical Research, 1, 297–315.Andersen, P.K. Borgan, Ø. (1985) Counting process models life history data: review. Scandinavian Journal Statistics, 12, 97–158.Andersen, P.K. Gill, R.D. (1982) Cox’s regression model counting processes: large sample study. Annals Statistics, 10, 1100–1120.Andersen, P.K. Keiding, N. (2002) Multi-state models event history analysis. Statistical Methods Medical Research, 11, 91–115.Andersen, P.K. Perme, M.P. (2010) Pseudo-observations survival analysis. Statistical Methods Medical Research, 19, 71–99.Andersen, P.K., Borgan, Ø., Gill, R.D. Keiding, N. (1993) Statistical Methods Based Counting Processes, Springer, New York.Andersen, P.K., Hansen, M.G. Klein, J.P. (2004) Regression analysis restricted mean survival time based pseudo-observations. Lifetime Data Analysis, 10, 335–350.Andrews, D.F. Herzberg, .M. (1985) Data, Springer, New York.Arjas, E. (1988) graphical method assessing goodness fit Cox’s proportional hazards model. Journal American Statistical Association, 83, 204–212.Armitage, P., Berry, G. Matthews, J.N.S. (2002) Statistical Methods Medical Research, 4th ed., Blackwells Science Ltd, Oxford.Atkinson, .C. (1985) Plots, Transformations Regression, Clarendon Press, Oxford.Bagot, M., Mary, J.Y., Heslan, M., Kuentz, M., Cordonnier, C., Vernant, J.P., Dubertret, L. Levy, J.P. (1988) mixed epidermal cell lymphocyte-reaction predictive factor acute graft-versus-host disease bone marrow graft recipients. British Journal Haematology, 70, 403–409.Balan, T.. Putter, H. (2020) tutorial frailty models. Statistical Methods Medical Research, 29, 3424–3454.Barlow, W.E. Prentice, R.L. (1988) Residuals relative risk regression. Biometrika, 75, 65–74.Barnett, V. (1999) Comparative Statistical Inference, 3rd ed., Wiley, Chichester.Bennett, S. (1983a) Analysis survival data proportional odds model. Statistics Medicine, 2, 273–277.Bennett, S. (1983b) Log-logistic regression models survival data. Applied Statistics, 32, 165–171.Bernardo, J.M. Smith, .F.M. (1994) Bayesian Theory, John Wiley & Sons, Inc., Hoboken, New Jersey.Bernstein, D. Lagakos, S.W. (1978) Sample size power determination stratified clinical trials. Journal Statistical Computation Simulation, 8, 65–73.Beyersmann, J., Allignol, . Schumacher, M. (2012) Competing Risks Multistate Models R, Springer, New York.Bogaerts, K., Komarek, . Lesaffre, E. (2018) Survival Analysis Interval-Censored Data: Practical Approach Examples R, SAS, BUGS, Chapman & Hall/CRC Press, Boca Raton, Florida.Bolstad, W.M. Curran, J.M. (2016) Introduction Bayesian Statistics, 3rd ed., John Wiley & Sons, Inc., Hoboken, New Jersey.Box, G.E.P. Tiao, G.C. (1973) Bayesian Inference Statistical Analysis, Wiley, New York.Box, G.E.P. Tidwell, P.W. (1962) Transformation independent variables. Technometrics, 4, 531–550.Box-Steffensmeier, J.M. Jones, B.S. (2004) Event History Modeling: Guide Social Scientists, Cambridge University Press, Cambridge.Breslow, N.E. (1972) Contribution discussion paper D.R. Cox. Journal Royal Statistical Society, B, 34, 216–217.Breslow, N.E. (1974) Covariance analysis censored survival data. Biometrics, 30, 89–100.Breslow, N.E. Crowley, J. (1974) large sample study life table product limit estimates random censorship. Annals Statistics, 2, 437–453.Breslow, N.E. Day, N.E. (1987) Statistical Methods Cancer Research. 2: Design Analysis Cohort Studies, ..R.C., Lyon, France.Brilleman, S.L., Elci, E.M., Novik, J.B. Wolfe, R. (2020) Bayesian survival analysis using rstanarm R package. https://arxiv.org/abs/2002.09633.Brookmeyer, R. Crowley, J. (1982) confidence interval median survival time. Biometrics, 38, 29–41.Brooks, S.P. Gelman, . (1998) General methods monitoring convergence iterative simulations. Journal Computational Graphical Statistics, 7, 434–455.Broström, G. (2022) Event History Analysis R, 2nd ed., Chapman & Hall/CRC, Boca Raton, Florida.Brown, H. Prescott, R.J. (2000) Applied Mixed Models Medicine, Wiley, Chichester.Burdette, W.J. Gehan, E.. (1970) Planning Analysis Clinical Studies, Charles C. Thomas, Springfield, Illinois.Byar, D.P. (1982) Analysis survival data: Cox Weibull models covariates. : Statistics Medical Research (eds. V. Mike K.E. Stanley), Wiley, New York.Cai, T. Betensky, R.. (2003). Hazard regression interval-censored data penalized spline. Biometrics, 59, 570–579.Cain, K.C. Lange, N.T. (1984) Approximate case influence proportional hazards regression model censored data. Biometrics, 40, 493–499.Casella, G. George, E.. (1992) Explaining Gibbs sampler. American Statistician, 46, 167–174.Chan, P.H., Xu, R. Chambers, C.D. (2018) study R2 measure accelerated failure time models. Communications Statistics–Simulation Computation, 47, 380–391.Chatfield, C. (1995) Problem Solving: Statisticians Guide, 2nd ed., Chapman & Hall/CRC, London.Chatfield, C. Xing, H. (2019) Analysis Time Series, 7th ed., Chapman & Hall/CRC, Boca Raton, Florida.Chen, D.G., Sun, J. Peace, K.E. (2012) Interval-Censored Time--Event Data: Methods Applications, Chapman & Hall/CRC, Boca Raton, Florida.Chhikara, S. Folks, J.L. (1989) Inverse Gaussian Distribution, Marcel Dekker, New York.Choodari-Oskooei, B., Royston, P. Parmar, M.K.B. (2012) simulation study predictive ability measures survival model : Explained variation measures. Statistics Medicine, 31, 2627–2643.Choodari-Oskooei, B., Royston, P. Parmar, M.K.B. (2012) simulation study predictive ability measures survival model II: Explained randomness predictive accuracy. Statistics Medicine, 31, 2644–2659.Christensen, E. (1987) Multivariate survival analysis using Cox’s regression model. Hepatology, 7, 1346–1358.Christensen, E., Schlichting, P., Andersen, P.K., Fauerholdt, L., Schou, G., Pedersen, B.V., Juhl, E., Poulsen, H., Tygstrup, N. Copenhagen Study Group Liver Diseases (1986) Updating prognosis therapeutic effect evaluation cirrhosis Cox’s multiple regression model time-dependent variables. Scandinavian Journal Gastroenterology, 21, 163–174.Ciampi, . Etezadi-Amoli, J. (1985) general model testing proportional hazards accelerated failure time hypotheses analysis censored survival data covariates. Communications Statistics, , 14, 651–667.Claeskens, G., Nguti, R. Janssen, P. (2008) One-sided tests shared frailty models. Test, 17, 69–82.Cleveland, W.S. (1979) Robust locally weighted regression smoothing scatterplots. Journal Americal Statistical Association, 74, 829–836.Cleves, M., Gould, W. Marchenko, Y.V. (2016) Introduction Survival Analysis Using Stata, revised 3rd ed., Stata Press, Texas.Cohen, . Barnett, O. (1995) Assessing goodness fit parametric regression models lifetime data–graphical methods. Statistics Medicine, 14, 1785–1795.Collett, D. (2003) Modelling Binary Data, 2nd ed., Chapman & Hall/CRC, Boca Raton, Florida.Commenges, D. (1999) Multi-state models epidemiology. Lifetime Data Analysis, 5, 315–327.Cook, R.D. (1986) Assessment local influence (discussion). Journal Royal Statistical Society, B, 48, 133–169.Cook, R.D. Weisberg, S. (1982) Residuals Influence Regression, Chapman & Hall/CRC, London.Cook, R.J. Lawless, J.F. (2007) Statistical Analysis Recurrent Events, Springer, New York.Cook, R.J. Lawless, J.F. (2018) Multistate Models Analysis Life History Data, Chapman & Hall/CRC, Boca Raton, Florida.Copas, J.B. Heydari, F. (1997) Estimating risk reoffending using exponential mixture models. Journal Royal Statistical Society, , 160, 237–252.Cox, D.R. (1972) Regression models life tables (discussion). Journal Royal Statistical Society, B, 74, 187–220.Cox, D.R. (1975) Partial likelihood. Biometrika, 62, 269–276.Cox, D.R. (1979) note graphical analysis survival data. Biometrika, 66, 188–190.Cox, D.R. Hinkley, D.V. (1974) Theoretical Statistics, Chapman & Hall/CRC, London.Cox, D.R. Oakes, D. (1984) Analysis Survival Data, Chapman & Hall/CRC, London.Cox, D.R. Snell, E.J. (1968) general definition residuals (discussion). Journal Royal Statistical Society, , 30, 248–275.Cox, D.R. Snell, E.J. (1981) Applied Statistics: Principles Examples, Chapman & Hall/CRC, London.Crawley, M.J. (2013) R Book, 2nd ed., John Wiley & Sons Ltd, Chichester.Crowder, M.J. (2001) Classical Competing Risks, Chapman & Hall/CRC, Boca Raton, Florida.Crowder, M.J. (2012) Multivariate Survival Analysis Competing Risks, Chapman & Hall/CRC, Boca Raton, Florida.Crowder, M.J. Hand, D.J. (1990) Analysis repeated measures, Chapman & Hall/CRC, Boca Raton, Florida.Crowder, M.J., Kimber, .C., Smith, R.L. Sweeting, T.J. (1991) Statistical Analysis Reliability Data, Chapman & Hall/CRC, London.Crowley, J. Hu, M. (1977) Covariance analysis heart transplant survival data. Journal American Statistical Association, 72, 27–36.Crowley, J. Storer, B.E. (1983) Comment paper M. Aitkin et al. Journal American Statistical Association, 78, 277–281.Crowther, M.J., Abrams, K.R. Lambert, P.C. (2012) Flexible parametric joint modelling longitudinal survival data. Statistics Medicine, 31, 4456–4471.Crowther, M.J., Andersson, T.M.L., Lambert, P.C., Abrams, K.R. Humphreys, K. (2016) Joint modelling longitudinal survival data: incorporating delayed entry assessment model misspecification. Statistics Medicine, 35, 1193–1209.Dalgaard, P. (2008) Introductory Statistics R, 2nd ed., Springer, New York.David, H.. Moeschberger, M.L. (1978) Theory Competing Risks, Lubrecht & Cramer Ltd, New York.Davies, T.M. (2016) Book R: First Course Programming Statistics, Starch Press, Inc., San Francisco, California.Davis, H. Feldstein, M. (1979) generalized Pareto law model progressively censored survival data. Biometrika, 66, 299–306.Day, L. (1985) Residual analysis Cox’s proportional hazards model. : Proceedings STATCOM-MEDSTAT ‘85’, MacQuarie University, Sydney.de Boor, C. (2001) Practical Guide Splines, Springer-Verlag, New York.Demidenko, E. (2013) Mixed Models: Theory Applications R, 2nd ed., John Wiley & Sons, Hoboken, New Jersey.Dempster, .P., Laird, N.M. Rubin, D.B. (1977) Maximum likelihood incomplete data via EM Algorithm. Journal Royal Statistical Society, B, 39, 1–38.de Vries, . Meys, J. (2015) R Dummies, 2nd ed., John Wiley & Sons, Hoboken, New Jersey.Diggle, P.J., Heagerty, P., Liang, K.-Y. Zeger, S. (2002) Analysis Longitudinal Data, 2nd ed., Oxford University Press, New York.Dinse, G.E. (1991) Constant risk differences analysis animal tumourigenicity data. Biometrics, 47, 681–700.Draper, N.R. Smith, H. (1998) Applied Regression Analysis, 3rd ed., Wiley, New York.Duchateau, L. Janssen, P. (2008) Frailty Model, Springer, New York.Durrleman, S. Simon, R. (1989) Flexible regression models cubic splines. Statistics Medicine, 8, 551–561.Edmunson, J.H., Fleming, T.R., Decker, D.G., Malkasian, G.D., Jorgenson, E.O., Jeffries, J.., Webb, M.J. Kvols, L.K. (1979) Different chemotherapeutic sensitivities host factors affecting prognosis advanced ovarian carcinoma versus minimal residual disease. Cancer Treatment Reports, 63, 241–247.Efron, B. (1977) efficiency Cox’s likelihood function censored data. Journal American Statistical Association, 72, 557–565.Efron, B. (1981) Censored data bootstrap. Journal American Statistical Association, 76, 312–319.Efron, B., Hastie, T., Johnstone, . Tibshirani, R. (2004) Least angle regression. Annals Statistics, 32, 407–451.Eilers, P.H.C. Marx, B.D. (1996) Flexible smoothing B-splines penalties. Statistical Science, 11, 89–102.Elashoff, J.D. (1983) Surviving proportional hazards. Hepatology, 3, 1031–1035.Emerson, J.D. (1982) Nonparametric confidence intervals median presence right censoring. Biometrics, 38, 17–27.Elashoff, R.M., Li, G. Li, N. (2017) Joint Modeling Longitudinal Time--Event Data, Chapman & Hall/CRC, Boca Raton, Florida.Escobar, L.. Meeker, W.Q. (1992) Assessing influence regression analysis censored data. Biometrics, 48, 507–528.Everitt, B.S. (1987) Introduction Optimisation Methods, Chapman & Hall/CRC, London.Farewell V.T. (1982) use mixture models analysis survival data long-term survivors. Biometrics, 38, 1041–1046.Farrington, C.P. (2000) Residuals proportional hazards models interval-censored data. Biometrics, 56, 473–482.Fay, M.P. (1996) Rank invariant tests interval censored data grouped continuous model. Biometrics, 52, 811–822.Fay, M.P. Shaw, P.. (2010) Exact asymptotic weighted logrank tests interval censored data: interval R package. Journal Statistical Software, 36, 1–34.Field, ., Miles, J. Field, Z. (2012) Discovering Statistics Using R, Sage Publications Ltd., London.Fine, J.P. Gray, R.J. (1999) proportional hazards model subdistribution competing risk. Journal American Statistical Association, 94, 496–509.Finkelstein, D.M. (1986) proportional hazards model interval-censored failure time data. Biometrics, 42, 845–854.Fisher, L.D. (1992) Discussion paper L.J. Wei. Statistics Medicine, 11, 1881–1885.Fitzmaurice, G.M., Laird, N.M. Ware, J.H. (2011) Applied Longitudinal Analysis, 2nd ed., Wiley, Hoboken, New Jersey.Fleming, T.R. Harrington, D.P. (2005) Counting Processes Survival Analysis, John Wiley & Sons, Hoboken, New Jersey.Ford, ., Norrie, J. Ahmadi, S. (1995) Model inconsistency, illustrated Cox proportional hazards model. Statistics Medicine, 14, 735–746.Freedman, L.S. (1982) Tables number patients required clinical trials using logrank test. Statistics Medicine, 1, 121–129.Friedman, M. (1982) Piecewise Exponential Models Survival Data Covariates. Annals Statistics, 10, 101–113.Friedman, L.M., Furberg, C.D. DeMets, D.L. (2010) Fundamentals Clinical Trials, 4th ed., Springer, New York.Fyles, .W., McCready, D.R., Manchul, L.., Trudeau, M.E., Merante, P., Pintilie, M., Weir, L. Olivotto, .. (2004) Tamoxifen without breast irradiation women 50 years age older early breast cancer. New England Journal Medicine, 351, 963–970.Gail, M.H., Santner, T.J. Brown, C.C. (1980) analysis comparative carcinogenesis experiments based multiple times tumor. Biometrics, 36, 255–266.Gamerman, D. Lopes, H.F. (2006) Markov Chain Monte Carlo: Stochastic Simulation Bayesian Inference, 2nd ed., Chapman & Hall/CRC, Boca Raton, Florida.Gaver, D.P. Acar, M. (1979) Analytical hazard representations use reliability, mortality simulation studies. Communications Statistics, 8, 91–111.Geerdens, C., Claeskens, G. Janssen, P. (2013) Goodness--fit tests frailty distribution proportional hazards models shared frailty. Biostatistics, 14, 433–446.Gehan, E.. (1969) Estimating survival functions life table. Journal Chronic Diseases, 21, 629–644.Gelfand, .E. Smith, .F.M. (1990) Sampling based approaches calculating marginal densities. Journal American Statistical Association, 85, 398–409.Gelman, ., Carlin, J.B., Stern, H.S., Dunson, D.B., Vehtari, . Rubin, D.B. (2013) Bayesian Data Analysis, 3rd ed., Chapman & Hall/CRC, Boca Raton, Florida.Gelman, ., Hwang, J. Vehtari, . (2014) Understanding predictive information criteria Bayesian models. Statistics Computing, 24, 997–1016.Gelman, . Rubin, D.B. (1992) Inference iterative simulation using multiple sequences (discussion). Statistical Science, 7, 457–511.Geman, S. Geman, D. (1984) Stochastic relaxation, Gibbs distributions Bayesian restoration images. IEEE Transactions Pattern Analysis Machine Intelligence, 6, 721–741.George, S.L. Desu, M.M. (1974) Planning size duration clinical trial studying time critical event. Journal Chronic Diseases, 27, 15–24.Gilks, W.R., Richardson, S. Spiegelhalter, D. (1996) Markov Chain Monte Carlo Practice, Chapman & Hall/CRC, Boca Raton, Florida.Gill, R.D. (1984) Understanding Cox’s regression model: martingale approach. Journal American Statistical Association, 79, 441–447.Gill, R.D. Schumacher, M. (1987) simple test proportional hazards assumption. Biometrika, 74, 289–300.Glidden, D.V. (1999) Checking adequacy gamma frailty model multivariate failure times. Biometrika, 86, 381–393.Goeman, J.J. (2010) L1 penalized estimation Cox proportional hazards model. Biometrical Journal, 52, 70–84.Goeman, J.J., Meijer, R. Chaturvedi, N. (2022) L1 (lasso fused lasso) L2 (ridge) penalized estimation GLMs Cox model. https://cran.r-project.org/web/packages/penalized/penalized.pdf.Goldstein, H. Spiegelhalter, D.J. (1996) League tables limitations: statistical issues comparisons institutional performance, Journal Royal Statistical Society, , 159, 385–443.Gómez, G., Calle, M.L., Oller, R. Langohr, K. (2009) Tutorial methods intervalcensored data implementation R. Statistical Modelling, 9, 259–297.Gönen, M. Heller, G. (2005) Concordance probability discriminatory power proportional hazards regression. Biometrika, 92, 965–970.Goodall, R.L., Dunn, D.T. Babiker, .G. (2004) Interval-censored survival time data: confidence intervals non-parametric survivor function. Statistics Medicine, 23, 1131–1145.Gore, S.M., Pocock, S.J. Kerr, G.R. (1984) Regression models nonproportional hazards analysis breast cancer survival. Applied Statistics, 33, 176–195.Grambsch, P.M. Therneau, T.M. (1994) Proportional hazards tests diagnostics based weighted residuals. Biometrika, 81, 515–526.Gray, R. (1990) diagnostic methods Cox regression models hazard smoothing. Biometrics, 46, 93–102.Gray, R.J. (1988) class k-sample tests comparing cumulative incidence competing risk. Annals Statistics, 16, 1141–1154.Gray, R.J. (1992) Flexible methods analyzing survival data using splines, applications breast cancer prognosis. Journal American Statistical Association, 87, 942–951.Greenwood, M. (1926) errors sampling survivorship tables. Reports Public Health Statistical Subjects, number 33, Appendix 1, HMSO, London.Groeneboom, P. Wellner, J.. (1992) Information Bounds Nonparametric Maximum Likelihood Estimation, Springer, Basel.Grønnesby, J.K. Borgan, Ø. (1996) method checking regression models survival analysis based risk score. Lifetime Data Analysis, 2, 315–328.Hall, W.J. Wellner, J.. (1980) Confidence bands survival curve censored data. Biometrika, 67, 133–143.Hall, W.J., Rogers, W.H. Pregibon, D. (1982) Outliers matter survival analysis. Rand Corporation Technical Report P–6761, Santa Monica, California.Hanagal, D.D. (2019) Modeling Survival Data Using Frailty Models, 2nd ed., Springer Nature Singapore Pte Ltd.Hand, D.J. Crowder, M.J. (1996) Practical Longitudinal Data Analysis, Chapman & Hall/CRC, Boca Raton, Florida.Hammer, S.M., Katzenstein, D.., Hughes, M.D., Gundacker, H., Schooley, R.T., Haubrich, R.H., Henry, W.K., Lederman, M.M., Phair, J.P., Niu, M., Hirsch, M.S. Merigan, T.C. (1996) trial comparing nucleoside monotherapy combination therapy HIVinfected adults CD4 cell counts 200 500 per cubic millimeter. New England Journal Medicine, 335, 1081–1090.Hand, D.J., Daly, F., Lunn, .D., McConway, K.J. Ostrowski, E. (1994) Handbook Small Data Sets, Chapman & Hall/CRC, London.Harrell, F.E. (2015) Regression Modeling Strategies: Applications Linear Models, Logistic Ordinal Regression, Survival Analysis, 2nd ed., Springer, Switzerland.Harrell, F.E., Lee, K.L. Mark, D.B. (1996) Multivariable prognostic models: issues developing models, evaluating assumptions adequacy, measuring reducing errors. Statistics Medicine, 15, 361–387.Harrington, D.P. Fleming, T.R. (1982) class rank test procedures censored survival data. Biometrika, 69, 553–566.Hastie, T. Tibshirani, R. (1990) Generalized Additive Models, Chapman & Hall/CRC, London.Heagerty, P.J., Lumley, T. Pepe, M.S. (2000) Time dependent ROC curves censored survival data diagnostic marker. Biometrics, 56, 337–344.Hedeker, D. Gibbons, R.D. (2006) Longitudinal Data Analysis, John Wiley & Sons, Inc., Hoboken, New Jersey.Heinzl, H. (2000) Using SAS calculate Kent O’Quigley measure dependence Cox proportional hazards regression model. Computer Methods Programs Biomedicine, 63, 71–76.Henderson, R., Diggle, P.J. Dobson, . (2000) Joint modelling longitudinal measurements event time data. Biostatistics, 1, 465–480.Henderson, R. Milner, . (1991) residual plots relative risk regression. Biometrika, 78, 631–636.Hielscher, T., Zucknick, M., Werft, W. Benner, . (2010) prognostic value survival models application gene expression signatures. Statistics Medicine, 30, 818–829.Hinchcliffe, S.R. Lambert, P.C. (2013) Flexible parametric modelling cause-specific hazards estimate cumulative incidence functions. BMC Medical Research Methodology, 13, 1–14.Hinkley, D.V., Reid, N. Snell, E.J. (1991) Statistical Theory Modelling, Chapman & Hall/CRC, London.Hjorth, U. (1980) reliability distribution increasing, decreasing bathtub-shaped failure rate. Technometrics, 22, 99–107.Hoel, D.G. (1972) representation mortality data competing risks. Biometrics, 28, 475–488.Hoff, P.D. (2009) First Course Bayesian Statistical Methods, Springer, New York.Hollander, M. Proschan, F. (1979) Testing determine underlying distribution using randomly censored data. Biometrics, 35, 393–401.Hosmer, D.W., Lemeshow, S. May, S. (2008) Applied Survival Analysis: Regression Modeling Time Event Data, 2nd ed., John Wiley & Sons, Hoboken, New Jersey.Hougaard, P. (1995) Frailty models survival data. Lifetime Data Analysis, 1, 255–273.Hougaard, P. (1999) Multi-state models: review. Lifetime Data Analysis, 5, 239–264.Hougaard, P. (2000) Analysis Multivariate Survival Data, Springer, New York.Hougaard, P. Madsen, E.B. (1985) Dynamic evaluation short-term prognosis myocardial infarction. Statistics Medicine, 4, 29–38.Huang, J., Lee, C. Yu, Q. (2008) generalized log-rank test interval-censored failure time data via multiple imputation. Statistics Medicine, 27, 3217–3226.Ibrahim, J.G., Chen, M.-H. Sinha, D. (2001) Bayesian Survival Analysis, SpringerVerlag, New York.Jennison, C. Turnbull, B.W. (2000) Group Sequential Methods Applications Clinical Trials, Chapman & Hall/CRC, Boca Raton, Florida.Jeong, J.-H. Fine, J.P. (2007) Parametric regression cumulative incidence function. Biostatistics, 8, 184–196.Jewell, N.P. van der Laan, M.J. (2004) Current status data: review, recent developments open problems. Advances Survival Analysis, Chapter 35, 625–643 (eds. N.Balakrishnan C.R. Rao), Handbook Statistics, Elsevier, North Holland.Johnson, N.L., Kotz, S. Balakrishnan, N. (1994) Distributions Statistics: Continuous Univariate Distributions, Volume 1, 2nd ed., John Wiley & Sons, Hoboken, New Jersey.Johnson, N.L., Kotz, S. Kemp, .W. (2005) Univariate Discrete Distributions, 2nd ed., John Wiley & Sons, Hoboken, New Jersey.Julious, S.. (2010) Sample Sizes Clinical Trials, Chapman & Hall/CRC, Boca Raton, Florida.Kalbfleisch, J.D. Prentice, R.L. (1972) Contribution discussion paper D.R. Cox. Journal Royal Statistical Society, B, 34, 215–216.Kalbfleisch, J.D. Prentice, R.L. (1973) Marginal likelihoods based Cox’s regression life model. Biometrika, 60, 267–278.Kalbfleisch, J.D. Prentice, R.L. (2002) Statistical Analysis Failure Time Data, 2nd ed., Wiley, New York.Kamarudin, .N., Cox, T. Kolamunnage-Dona, R. (2017) Time-dependent ROC curve analysis medical research: current methods applications. BMC Medical Research Methodology, 17, 53.Kaplan, E.L. Meier, P. (1958) Nonparametric estimation incomplete observations. Journal American Statistical Association, 53, 457–481.Kass, R.E. Raftery, .E. (1995) Bayes factors. Journal American Statistical Association, 90, 773–795.Kay, R. (1977) Proportional hazard regression models analysis censored survival data. Applied Statistics, 26, 227–237.Kay, R. (1984) Goodness fit methods proportional hazards model. Revue Epidemiologie et de Sant´e Publique, 32, 185–198.Keiding, N., Klein, J.P. Horowitz, M.M. (2001) Multistate models outcome prediction bone marrow transplantation. Statistics Medicine, 20, 1871–1885.Kelly, P.J. Lim, L.L.-Y. (2000) Survival analysis recurrent event data: application childhood infectious diseases. Statistics Medicine, 19, 13–33.Kent, J.T. O’Quigley, J. (1988) Measures dependence censored survival data. Biometrika, 75, 525–534.Khmaladze, E.V. (2013) Statistical Methods Applications Demography Life Insurance. Chapman & Hall/CRC, Boca Raton, Florida.Kirk, .P., Jain, S., Pocock, S., Thomas, H.C. Sherlock, S. (1980) Late results Royal Free Hospital prospective controlled trial prednisolone therapy hepatitis B surface antigen negative chronic active hepatitis. Gut, 21, 78–83.Klein, J.P. (1991) Small-sample moments estimators variance KaplanMeier Nelson-Aalen estimators. Scandinavian Journal Statistics, 18, 333–340.Klein, J.P. (1992) Semiparametric estimation random effects using Cox model based EM algorithm. Biometrics, 48, 795–806.Klein, J.P. Moeschberger, M.L. (1988) Bounds net survival probabilities dependent competing risks. Biometrics, 44, 529–538.Klein, J.P. Moeschberger, M.L. (2005) Survival Analysis: Techniques Censored Truncated Data, 2nd ed., Springer, New York.Klein, J.P. Shu, Y. (2002) Multi-state models bone marrow transplantation studies. Statistical Methods Medical Research, 11, 117–139.Klein, J.P., Gerster, M., Andersen, P.K., Tarima, S. Perme, M.P. (2008) SAS R functions compute pseudo-values censored data regression. Computer Methods Programs Biomedicine, 89, 289–300.Kleinbaum, D.G. Klein, J.P. (2012) Survival Analysis: Self-Learning Text, 3rd ed., Springer, New York.Kodell, R.L. Nelson, C.J. (1980) illness-death model study carcinogenic process using survival/sacrifice data. Biometrics, 36, 267–277.Kohler, U. Kreuter, F. (2012) Data Analysis Using Stata, 3rd ed., Stata Press, Texas.Krall, J.M., Uthoff, V.. Harley, J.B. (1975) step-procedure selecting variables associated survival. Biometrics, 31, 49–57.Kuk, .Y.C. Chen, C. (1992) mixture model combining logistic regression proportional hazards regression. Biometrika, 79, 531–541.Lachin, J.M. (1981) Introduction sample size determination power analysis clinical trials. Controlled Clinical Trials, 2, 93–113.Lachin, J.M. Foulkes, M.. (1986) Evaluation sample size power analyses survival allowance nonuniform patient entry, losses follow-, noncompliance, stratification. Biometrics, 42, 507–519.Lagakos, S.W. (1981) graphical evaluation explanatory variables proportional hazards models. Biometrika, 68, 93–98.Lakatos, E. (1988) Sample sizes based log-rank statistic complex clinical trials. Biometrics, 44, 229–241.Lakatos, E. Lan, K.K.G. (1992) comparison sample size methods log-rank statistic. Statistics Medicine, 11, 179–191.Lambert, B. (2018) Student’s Guide Bayesian Statistics, SAGE publications Ltd., London.Lambert, P., Collett, D., Kimber, . Johnson, R. (2004) Parametric accelerated failure time models random effects application kidney transplant survival. Statistics Medicine, 23, 3177–3192.Latouche, ., Beyersmann, J. Fine, J.P. (2007) Letter editor: Comments ‘Analysing interpreting competing risk data’ M. Pintilie. Statistics Medicine, 26, 3676–3680.Latouche, ., Porcher, R. Chevret, S. (2004) Sample size formula proportional hazards modelling competing risks. Statistics Medicine, 23, 3263–3274.Lawless, J.F. (2002) Statistical Models Methods Lifetime Data, 2nd ed., Wiley, New York.Leathem, .J. Brooks, S.. (1987) Predictive value lectin binding breast-cancer recurrence survival. Lancet, 329, 1054–1056.Lee, E.T. Wang, J.W. (2013) Statistical Methods Survival Data Analysis, 4th ed., Wiley, New York.Lesaffre, E., Kom´arek, . Declerck, D. (2005) overview methods intervalcensored data emphasis applications dentistry. Statistical Methods Medical Research, 14, 539–552.Lim, E., Ali, ., Theodorou, P., Sousa, ., Ashrafian, H., Chamageorgakis, T., Duncan, M., Diggle, P. Pepper, J. (2008) Longitudinal study profile predictors left ventricular mass regression stentless aortic valve replacement. Annals Thoracic Surgery, 85, 2026–2029.Lin, D.Y. (1997) Non-parametric inference cumulative incidence functions competing risks studies. Statistics Medicine, 16, 901–910.Lin, D.Y. Wei, L.J. (1989) robust inference Cox proportional hazards model. Journal American Statistical Association, 84, 1074–1078.Lin, D.Y. Wei, L.J. (1991) Goodness--fit tests general Cox regression model. Statistica Sinica, 1, 1–17.Lin, D.Y., Wei, L.J. Ying, Z. (1993) Checking Cox model cumulative sums martingale-based residuals. Biometrika, 80, 557–572.Lindley, D.V. Scott, W.F. (1984) New Cambridge Elementary Statistical Tables, Cambridge University Press, Cambridge.Lindsey, J.C. Ryan, L.M. (1993) three state multiplicative model rodent tumourigenicity experiments. Applied Statistics, 42, 283–300.Lindsey, J.C. Ryan, L.M. (1998) Methods interval-censored data. Statistics Medicine, 17, 219–238.Lindsey, J.K. (1998) study interval censoring parametric regression models. Lifetime Data Analysis, 4, 329–354.Long, J.D. Mills, J.. (2018) Joint modeling multivariate longitudinal data survival data several observational studies Huntington’s disease. BMC Medical Research Methodology, 18, 138.Lunn, D., Jackson, C., Best, N., Thomas, . Spiegelhalter, D. (2012) BUGS Book: Practical Introduction Bayesian Analysis, Chapman & Hall/CRC, Boca Raton, Florida.Machin, D., Campbell, M.J., Tan, S.B. Tan, S.H. (2009) Sample Sizes Clinical Trials, 3rd ed., John Wiley & Sons Ltd, Chichester.Machin, D., Cheung, Y.B. Parmar, M.K.B. (2006) Survival Analysis: Practical Approach, Wiley, New York.Maller, R.. Zhao, X. (2002) Analysis parametric models competing risks. Statistica Sinica, 12, 725–750.Mantel, N. (1966) Evaluation survival data two new rank order statistics arising consideration. Cancer Chemotherapy Reports, 50, 163–170.Mantel, N. Haenszel, W. (1959) Statistical aspects analysis data retrospective studies disease. Journal National Cancer Institute, 22, 719–748.Marubini, E. Valsecchi, M.G. (1995) Analysing Survival Data Clinical Trials Observational Studies, Wiley, New York.Matthews, J.N.S. (2006) Introduction Randomized Controlled Clinical Trials, 2nd ed., Chapman & Hall/CRC, Boca Raton, Florida.May, S. Hosmer, D.W. (1998) simplified method calculating overall goodnessof-fit test Cox proportional hazards model. Lifetime Data Analysis, 4, 109–120.McCrink, L.M., Marshall, .H. Cairns, K.J. (2013) Advances joint modelling: review recent developments application survival end stage renal disease patients. International Statistical Review, 81, 249–269.McCullagh, P. Nelder, J.. (1989) Generalized Linear Models, 2nd ed., Chapman & Hall/CRC, London.McCulloch, C.E., Searle, S.R. Neuhaus, J.M. (2008) Generalized, Linear, Mixed Models, 2nd ed., John Wiley & Sons, Hoboken, New Jersey.McGilchrist, C.. Aisbett, C.W. (1991) Regression frailty survival analysis. Biometrics, 47, 461–466.McKnight, B. Crowley, J. (1984) Tests differences tumour incidence based animal carcinogenesis experiments. Journal American Statistical Association, 79, 639–648.McElreath, R. (2020) Statistical Rethinking: Bayesian Course Examples R STAN, 2nd ed., Chapman & Hall/CRC, Boca Raton, Florida.Meeker, W.Q., Escobar, L.. Pascual, F.G. (2022) Statistical Methods Reliability Data, 2nd ed., John Wiley & Sons, Hoboken, New Jersey.Meier, P. (1975) Estimation distribution function incomplete observations. : Perspectives Probability Statistics (ed. J. Gani), Academic Press, London, 67–87.Meira-Machado, L., de Uña-Alvarez, J., Cadarso-Suárez, C. Andersen, P.K. (2009) Multi-state models analysis time--event data. Statistical Methods Medical Research, 18, 195–222.Metcalfe, C.R. Thompson, S.G. (2007) Wei, Lin Weissfeld’s marginal analysis multivariate failure time data: applied recurrent events outcome?Statistical Methods Medical Research, 16, 103–122. Miller, .J. (2002) Subset Selection Regression, 2nd ed., Chapman & Hall/CRC, Boca Raton, Florida.Mills, M. (2010) Introducing Survival Event History Analysis. SAGE Publications Ltd, London.Moeschberger, M.L. Klein, J.P. (1995) Statistical methods dependent competing risks. Lifetime Data Analysis, 1, 195–204.Molenberghs, G. Verbeke, G. (2005) Models Discrete Longitudinal Data, SpringerVerlag, New York.Montgomery, D.C., Peck, E.. Vining, G. (2021) Introduction Linear Regression Analysis, 6th ed., Wiley, New York.Moore, D.F. (2016) Applied Survival Analysis Using R, Springer, Switzerland.Moreau, T., O’Quigley, J. Mesbah, M. (1985) global goodness--fit statistic proportional hazards model. Applied Statistics, 34, 212–218.Munda, M., Rotolo, F. Legrand, C. (2012) parfm: Parametric frailty models R.Journal Statistical Software, 51, 1–20. Munda, M., Rotolo, F. Legrand, C. (2017) parfm: Parametric frailty models R. https://cran.r-project.org/web/packages/parfm/vignettes/parfm.pdf.Nagelkerke, N.J.D. (1991). note general definition coefficient determination. Biometrika 78, 691—692.Nagelkerke, N.J.D., Oosting, J. Hart, ..M. (1984) simple test goodness fit Cox’s proportional hazards model. Biometrics, 40, 483–486.Nair, V.N. (1984) Confidence bands survival functions censored data: comparative study. Technometrics, 26, 265–275.Nardi, . Schemper, M. (1999) New residuals Cox regression application outlier screening. Biometrics, 55, 523–529.Nelder, J.. (1977) reformulation linear models (discussion). Journal Royal Statistical Society, , 140, 48–77.Nelson, K.P., Lipsitz, S.R., Fitzmaurice, G.M., Ibrahim, J., Parzen, M. Strawderman, R. (2006) Use probability integral transformation fit nonlinear mixed-effects models nonnormal random effects. Journal Computational Graphical Statistics, 15, 39–57.Nelson, W. (1972) Theory applications hazard plotting censored failure data. Technometrics, 14, 945–965.Neuberger, J., Altman, D.G., Christensen, E., Tygstrup, N. Williams, R. (1986) Use prognostic index evaluation liver transplantation primary biliary cirrhosis. Transplantation, 4, 713–716.Nieto, F.J. Coresh, J. (1996) Adjusting survival curves confounders: review new method. American Journal Epidemiology, 143, 1059–1068.O’Hagan, . Forster, J.J. (2004) Kendall’s Advanced Theory Statistics, volume 2B: Bayesian Inference, 2nd ed., Arnold, London.O’Quigley, J. Pessione, F. (1989) Score tests homogeneity regression effect proportional hazards model. Biometrics, 45, 135–144.Ohlssen, D., Sharples, L.D. Spiegelhalter, D.J. (2007) hierarchical modelling framework identifying unusual performance health care providers. Journal Royal Statistical Society, , 170, 865–890.Pan, W. (1999) Extending iterative convex minorant algorithm Cox model interval-censored data. Journal Computational Graphical Statistics, 8, 109–120.Park, M.Y. Hastie, T. (2007) L1-regularization path algorithm generalized linear models. Journal Royal Statistical Society, B, 69, 659–677.Peng, Y. Dear, K.B.G. (2000) nonparametric mixture model cure rate estimation. Biometrics, 56, 237–243.Pepe, M.S., Leisenring, W. Rutter, C. (1999) Evaluating diagnostic tests public health. Handbook Biostatistics, Volume 18, (eds. C.R. Rau P.K. Sen), Elsevier Scientific, New York, 397–422.Pepe, M.S., Longton, G. Janes, H. (2009) Estimation comparison receiver operating characteristic curves. Stata Journal, 9, 1–16.Pepe, M.S. Mori, M. (1993) Kaplan-Meier, marginal conditional probability curves summarizing competing risks failure time data? Statistics Medicine, 12, 737–751.Perperoglou, ., Sauerbrei, W., Abrahamowicz, M. Schmid, M. (2019) review spline function procedures R. BMC Medical Research Methodology, 19, 46.Petersen, T. (1986) Fitting parametric survival models time-dependent covariates. Applied Statistics, 35, 281–288.Peterson, .V. (1976) Bounds joint distribution function fixed sub-distribution functions: application competing risks. Proceedings National Academy Sciences, 73, 11–13.Peto, R. (1972) Contribution discussion paper D.R. Cox. Journal Royal Statistical Society, B, 34, 205–207.Peto, R. Peto, J. (1972) Asymptotically efficient rank invariant test procedures (discussion). Journal Royal Statistical Society, , 135, 185–206.Peto, R., Pike, M.C., Armitage, P., Breslow, N.E., Cox, D.R., Howard, S.V., Mantel, N., McPherson, K., Peto, J. Smith, P.G. (1977) Design analysis randomized clinical trials requiring prolonged observation patient. II. Analysis examples. British Journal Cancer, 35, 1–39.Pettitt, .N. Bin Daud, . (1989) Case-weighted measures influence proportional hazards regression. Applied Statistics, 38, 51–67.Pettitt, .N. Bin Daud, . (1990) Investigating time dependence Cox’s proportional hazards model. Applied Statistics, 39, 313–329.Pintilie, M. (2006) Competing Risks: Practical Perspective, John Wiley & Sons, Chichester.Pintilie, M. (2007a) Analysing interpreting competing risk data. Statistics Medicine, 26, 1360–1367.Pintilie, M. (2007b) Authors reply letter editor . Latouche, J. Beyersmann J.P. Fine. Statistics Medicine, 26, 3679–3680.Pocock, S.J. (1983) Clinical Trials: Practical Approach, Wiley, Chichester.Prentice, R. Marek, P. (1979) qualitative discrepancy censored data rank tests. Biometrics, 35, 861–867.Prentice, R.L. Kalbfleisch, J.D. (1979) Hazard rate models covariates. Biometrics, 35, 25–39.Prentice, R.L., Williams, B.J. Peterson, .V. (1981) regression analysis multivariate failure time data. Biometrika, 68, 373–379.Putter, H. (2011) Special issue competing risks multi-state models. Journal Statistical Software, 38, 1–4.Putter, H., Fiocco, M. Geskus, R.B. (2007) Tutorial biostatistics: competing risks multi-state models. Statistics Medicine, 26, 2389–2430.Quantin, C., Moreau, T., Asselain, B., Maccario, J. Lellouch, J. (1996) regression survival model testing proportional hazards hypothesis. Biometrics, 52, 874–885.R Core Team (2021) R: language environment statistical computing. R Foundation Statistical Computing, Vienna, Austria. http://www.R-project.org/.Racine, J.S. (2021) primer regression splines. https://cran.r-project.org/web/packages/crs/vignettes/spline_primer.pdf.Raftery, .E. (1995) Bayesian model selection social research. Sociological Methodology,25, 111–163.Raftery, .E. Lewis, S. (1992) many iterations Gibbs sampler? Bayesian Statistics (eds. J.M. Bernardo, J. Berger, .P. Dawid .F.M. Smith), Oxford University Press, Oxford, 763–773.Ramlau-Hansen, H. (1983) Smoothing counting process intensities means kernel functions. Annals Statistics, 11, 453–466.Rancel, M.M.S. Sierra, M..G. (2001) Regression diagnostic using local influence: review. Communications Statistics–Theory Methods, 30, 799–813.Reid, N. Crépeau, H. (1985) Influence functions proportional hazards regression. Biometrika, 72, 1–9.Ripatti, S. Palmgren, J. (2000) Estimation multivariate frailty models using penalised partial likelihood. Biometrics, 56, 1016–1022.Ritchie, . Ö., Kalra, P.. Diggle, P.J. (2015) Joint modelling repeated measurement time--event data: introductory tutorial. International Journal Epidemiology, 44, 334–344.Rizopoulos D. (2010) JM: R package joint modelling longitudinal timeto-event data. Journal Statistical Software, 35, 1—33.Rizopoulos, D. (2012) Joint Models Longitudinal Time--Event Data: Applications R, Chapman & Hall/CRC, Boca Raton, Florida.Robins, J.M. (1993) Information recovery bias adjustment proportional hazards regression analysis randomized trials using surrogate markers. Proceedings Biopharmaceutical Section, American Statistical Association, Virginia, 24–33.Robins, J.M. Finkelstein, D.M. (2000) Correcting non-compliance dependent censoring AIDS clinical trial inverse probability censoring weighted (IPCW) log rank tests. Biometrika, 56, 779–788.Robins, J.M. Rotnitzky, . (1992) Recovery information adjustment dependent censoring using surrogate markers. AIDS Epidemiology–Methodological Issues (eds. N. Jewell, K. Dietz V.T. Farewell), Birkhäuser, Boston, 297–331.Rosenberg, P.S. (1995) Hazard function estimation using B-splines. Biometrics, 51, 874–887.Royston, P. (2006) Explained variation survival models. Stata Journal, 6, 83–96.Royston, P. Altman, D.G. (1994) Regression using fractional polynomials continuous covariates: parsimonious parametric modelling (discussion). Applied Statistics, 43, 429–467.Royston, P. Lambert, P.C. (2011) Flexible Parametric Survival Analysis Using Stata: Beyond Cox Model, Stata Press, Texas.Royston, P. Parmar, M.K.B. (2002) Flexible proportional-hazards proportionalodds models censored survival data, application prognostic modelling estimation treatment effects. Statistics Medicine, 21, 2175–2197.Royston, P. Parmar, M.K.B. (2011) use restricted mean survival time estimate treatment effect randomized clinical trials proportional hazards assumption doubt. Statistics Medicine, 30, 2409–2421.Royston, P. Sauerbrei, W. (2004) new measure prognostic separation survival data. Statistics Medicine, 23, 723–748.Rubinstein, L.V., Gail, M.H. Santner, T.J. (1981) Planning duration comparative clinical trial loss follow-period continued observation. Journal Chronic Diseases, 34, 469–479.Sahu, S. (2022) Bayesian Modeling Spatio-Temporal Data R, Chapman & Hall/CRC, Boca Raton, Florida.Samet, J.H., Larson, M.J., Horton, N.J., Doyle, K., Winter, M. Saitz, R. (2003) Linking alcohol drug-dependent adults primary medical care: randomized controlled trial multi-disciplinary health intervention detoxification unit. Addiction, 98, 509–516.Satten, G.., Datta, S. Robins, J.M. (2001) Estimating marginal survival function presence time dependent covariates. Statistics Probability Letters, 54, 397–403.Sauerbrei, W. Royston, P. (1999) Building multivariate prognostic diagnostic models: transformations predictors using fractional polynomials. Journal Royal Statistical Society, , 162, 71–94.Scharfstein, D.O. Robins, J.M. (2002). Estimation failure time distribution presence informative censoring. Biometrika, 89, 617–634.Schemper, M. (1992) Cox analysis survival data non-proportional hazard functions. Statistician, 41, 455–465.Schemper, M. Stare, J. (1996) Explained variation survival analysis. Statistics Medicine, 15, 1999–2012.Schemper, M., Wakounig, S. Heinze, G. (2009) estimation average hazard ratios weighted Cox regression. Statistics Medicine, 28, 2473–2489.Schlucter, M.D. (1992) Methods analysis informatively censored longitudinal data. Statistics Medicine, 11, 1861–1870.Schmuller, J. (2017) Statistical Analysis R Dummies, John Wiley & Sons, Inc., Hoboken, New Jersey.Schoenfeld, D.. (1980) Chi-squared goodness fit tests proportional hazards regression model. Biometrika, 67, 145–153.Schoenfeld, D.. (1981) asymptotic properties comparative tests comparing survival distributions. Biometrika, 68, 316–319.Schoenfeld, D.. (1982) Partial residuals proportional hazards regression model. Biometrika, 69, 239–241.Schoenfeld, D.. (1983) Sample-size formula proportional-hazards regression model. Biometrics, 39, 499–503.Schoenfeld, D.. Richter, J.R. (1982) Nomograms calculating number patients needed clinical trial survival endpoint. Biometrics, 38, 163–170.Schumacher, M., Bastert, G., Bojar, H., H¨ubner, K., Olschewski, M., Sauerbrei, W., Schmoor, C., Beyerle, C., Neumann, R.L.. Rauschecker, H.F. (1994) Randomized 2 × 2 trial evaluating hormonal treatment duration chemotherapy node-positive breast cancer patients. Journal Clinical Oncology, 12, 2086–2093.Searle, S.R., Casella, G. McCulloch, C.E. (2006) Variance Components, John Wiley & Sons, Hoboken, New Jersey.Sellke, T. Siegmund, D. (1983) Sequential analysis proportional hazards model. Biometrika, 70, 315–326.Shih, J.H. (1998) goodness--fit test association bivariate survival model. Biometrika, 85, 189–200.Shih, J.H. Louis, T.. (1995) Inferences association parameter copula models bivariate survival data. Biometrics, 51, 1384–1399.Siannis, F. (2004) Applications parametric model informative censoring. Biometrics, 60, 704–714.Siannis, F. (2011) Sensitivity analysis multiple right censoring processes: investigating mortality psoriatic arthritis. Statistics Medicine, 30, 356–367.Siannis, F., Copas, J. Lu, G. (2005) Sensitivity analysis informative censoring parametric survival models. Biostatistics, 6, 77–91.Simon, R. (1986) Confidence intervals reporting results clinical trials. Annals Internal Medicine, 105, 429–435.Simon, R. Lee, Y.J. (1982) Nonparametric confidence limits survival probabilities median survival time. Cancer Treatment Reports, 66, 37–42.Sleeper, L.. Harrington, D.P. (1990) Regression splines Cox model application covariate effects liver disease. Journal American Statistical Association, 85, 941–949.Slud, E.V. Rubinstein, L.V. (1983) Dependent competing risks summary survival curves. Biometrika, 70, 643–649.Slud, E.V., Byar, D.P. Green, S.B. (1984) comparison reflected versus test-based confidence intervals median survival time based censored data. Biometrics, 40, 587–600.Spiegelhalter, D.J. (2005) Funnel plots comparing institutional performance. Statistics Medicine, 24, 1185–1202.Spiegelhalter, D.J., Aylin, P., Best, N.G., Evans, S.J.W. Murray, G.D. (2002) Commissioned analysis surgical performance using routine data: lessons Bristol inquiry (discussion). Journal Royal Statistical Society, , 162, 191–231.Spiegelhalter, D.J., Best, N.G., Carlin, B.P. Van Der Linde, . (2002). Bayesian measures model complexity fit (discussion). Journal Royal Statistical Society, B, 64, 583–639.Spiegelhalter, D.J., Best, N.G., Carlin, B.P. Van Der Linde, . (2014). deviance information criterion: 12 years (discussion). Journal Royal Statistical Society, B, 76, 485–493.Spiegelhalter, D.J., Sherlaw-Johnson, C., Bardsley, M., Blunt, ., Wood, C. Grigg, O. (2012) Statistical methods healthcare regulation: rating, screening surveillance (discussion). Journal Royal Statistical Society, , 175, 1–47.Stablein, D.M. Koutrouvelis, .. (1985) two-sample test sensitive crossing hazards uncensored singly censored data. Biometrics, 41, 643–652.Stablein, D.M., Carter, W.H., Jr. Novak, J.W. (1981) Analysis survival data nonproportional hazard functions. Controlled Clinical Trials, 2, 148–159.Stare, J., Perme, M.P. Henderson, R. (2011) measure explained variation event history data. Biometrics, 67, 750–759.Storer, B.E. Crowley, J. (1985) diagnostic Cox regression general conditional likelihoods. Journal American Statistical Association, 80, 139–147.Stroup, W. (2013) Generalized Linear Mixed Models: Modern Concepts, Methods Applications, Chapman & Hall/CRC, Boca Raton, Florida.Sun, J. (1996) nonparametric test interval-censored failure time data application AIDS studies. Statistics Medicine, 15, 1387–1395.Sun, J. (2001). Variance estimation survival function interval-censored survival data, Statistics Medicine, 20, 1249–1257.Sun, J. (2006) Statistical Analysis Interval-Censored Failure Time Data, Springer, New York.Sun, J., Ono, Y. Takeuchi, Y. (1996) simple method calculating exact confidence interval standardized mortality ratio SAS function. Journal Occupational Health, 38, 196–197.Sun, L., Liu, J., Sun, J. Zhang, M.-J. (2006) Modeling subdistribution competing risk. Statistica Sinica, 16, 1367–1385.Sy, J.P. Taylor, J.M.G. (2000) Estimation Cox proportional hazards cure model. Biometrics, 56, 227–236.Tableman, M. Kim, J.S. (2004) Survival Analysis Using S: Analysis Time--Event Data, Chapman & Hall/CRC, Boca Raton, Florida.Tai, B.-C., Machin, D., White, . Gebski, V. (2001) Competing risks analysis patients osteosarcoma: comparison four different approaches. Statistics Medicine, 20, 661–684.Taylor, J.M.G. (1995) Semi-parametric estimation failure time mixture models. Biometrics, 51, 899–907.Therneau, T.M. (1986) COXREGR Procedure. : SAS SUGI Supplemental Library\nUser’s Guide, version 5 ed., SAS Institute Inc., Cary, North Carolina.Therneau, T. (2022) package survival analysis R. https://cran.r-project.org/web/packages/survival/vignettes/survival.pdf.Therneau, T., Crowson, C. Atkinson, E. (2022a) Using time dependent covariates time dependent coefficients Cox model. https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf.Therneau, T., Crowson, C. Atkinson, E. (2022b) Multi-state models competing risks. https://cran.r-project.org/web/packages/survival/vignettes/compete.pdf.Therneau, T.M. Grambsch, P.M. (2000) Modelling Survival Data: Extending Cox Model, Springer, New York.Therneau, T.M., Grambsch, P.M. Fleming, T.R. (1990) Martingale-based residuals survival models. Biometrika, 77, 147–160.Therneau, T.M., Grambsch, P.M. Pankratz, V.S. (2003) Penalized survival models frailty. Journal Computational Graphical Statistics, 12, 156–175.Thisted, R.. (1988) Elements Statistical Computing, Chapman & Hall/CRC, London.Thomas, N., Longford, N.T. Rolph, J.E. (1994) Empirical Bayes methods estimating hospital-specific mortality rates. Statistics Medicine, 13, 889–903.Thomsen, B.L., Keiding, N. Altman, D.G. (1991) note calculation expected survival, illustrated survival liver transplant patients. Statistics Medicine, 10, 733–738.Tibshirani, R. (1982) plain man’s guide proportional hazards model. Clinical Investigative Medicine, 5, 63–68.Tibshirani, R. (1996) Regression shrinkage selection via lasso. Journal Royal Statistical Society, B, 58, 267–288.Tibshirani, R. (1997) lasso method variable selection Cox model. Statistics Medicine, 16, 385–395.Tierney, L. (1994) Markov chains exploring posterior distributions (discussion). Annals Statistics, 22, 1701–1762.Tseng, Y.K., Hsieh, F. Wang J.-L. (2005) Joint modeling accelerated failure time longitudinal data. Biometrika, 92, 587–603.Tsiatis, .. (1975) nonidentifiability aspect problem competing risks. Proceedings National Academy Sciences, 72, 20–22.Tsiatis, .. Davidian, M. (2004) Joint modeling longitudinal time--event data: overview. Statistica Sinica, 14, 809–834.Turnbull, B.W. (1976) empirical distribution function arbitrarily grouped, censored, truncated data, Journal Royal Statistical Society, B, 38, 290–295.Venables, W.N. Ripley, B.D. (2002) Modern Applied Statistics S, 4th ed., Springer, New York.Verbeke, G. Molenberghs, G. (2000). Linear Mixed Models Longitudinal Data, Springer-Verlag, New York.Verweij, P.J.M., van Houwelingen, H.C. Stijnen, T. (1998) goodness--fit test Cox’s proportional hazards model based martingale residuals. Biometrics, 54, 1517–1526.Verzani, J. (2014) Using R Introductory Statistics, 2nd ed., Chapman & Hall/CRC, Boca Raton, Florida.Volinsky, C.T. Raftery, .E. (2000) Bayesian information criterion censored survival models. Biometrics, 56, 256–262.Special Programme Research, Development Research Training Human\nReproduction (1987) Vaginal bleeding patterns–problem example data set. Applied Stochastic Models Data Analysis, 3, 27–35.Wang, L., McMahan, C.S., Hudgens, M.G. Qureshi, Z.P. (2016) flexible, computationally efficient method fitting proportional hazards model interval-censored data. Biometrics, 72, 222–231.Watanabe, S. (2010) Asymptotic equivalence Bayes cross validation widely applicable information criterion singular learning theory. Journal Machine Learning Research, 11, 3571–3594.Watanabe, S. (2013) widely applicable Bayesian information criterion. Journal Machine Learning Research, 14, 867–897.Wei, L.J. (1992) accelerated failure time model: useful alternative Cox regression model survival analysis. Statistics Medicine, 11, 1871–1879.Wei, L.J. Glidden, D.V. (1997) overview statistical methods multiple failure time data clinical trials. Statistics Medicine, 16, 833–839.Wei, L.J., Lin, D.Y. Weissfeld, L. (1989) Regression-analysis multivariate incomplete failure time data modeling marginal distributions. Journal American Statistical Association, 84, 1065–1073.Weiss, R.E. (2010) Modeling Longitudinal Data, Springer, New York.Weissfeld, L.. (1990) Influence diagnostics proportional hazards model. Statistics Probability Letters, 10, 411–417.Weissfeld, L.. Schneider, H. (1990) Influence diagnostics Weibull model fit censored data. Statistics Probability Letters, 9, 67–73.Weissfeld, L.. Schneider, H. (1994) Residual analysis parametric models fit censored data. Communications Statistics–Theory Methods, 23, 2283–2297.Wellner, J.. Zahn, Y. (1997) hybrid algorithm computation nonparametric maximum likelihood estimator censored data. Journal American Statistical Association, 92, 945–959.West, B.T., Welch, K.B. Galecki, .T. (2007) Linear Mixed Models: Practical Guide Using Statistical Software, Chapman & Hall/CRC, Boca Raton, Florida.White, .R., Royston, P. Wood, .M. (2011) Multiple imputation using chained equations: issues guidance practice. Statistics Medicine, 30, 377–399.Whitehead, J.R. (1989) analysis relapse clinical trials, application comparison two ulcer treatments. Statistics Medicine, 8, 1439–1454.Whitehead, J.R. (1997) Design Analysis Sequential Clinical Trials, 2nd ed., Wiley, Chichester.Wickham, H. (2019) Advanced R, 2nd ed., Chapman & Hall/CRC, Boca Raton, Florida.Wienke, . (2011) Frailty Models Survival Analysis, Chapman & Hall/CRC, Boca Raton, Florida.Wolbers, M. Koller, M.T. (2007) Letter editor: Comments ‘Analysing interpreting competing risk data’ M. Pintilie (original article author’s reply). Statistics Medicine, 26, 3521–3523.Wolbers, M., Koller, M.T., Witteman, J.C.M. Steyerberg, E.W. (2009) Prognostic models competing risks: methods application coronary risk prediction. Epidemiology, 20, 555–561.Wolf, ., Hulmes, J. Hopkins, S. (2021) Lateral flow device specificity phase 4 (post marketing) surveillance. Department Health Social Care, https://www.gov.uk/government/publications/lateral-flow-device-specificity--phase-4-postmarketing-surveillance.Woodward, M. (2014) Epidemiology: Study Design Data Analysis, 3rd ed., Chapman & Hall/CRC, Boca Raton, Florida.Wu, M.C. Carroll, R.J. (1988) Estimation comparison changes presence informative right censoring modelling censoring process. Biometrics, 44, 175–188.Yang, S. Prentice, R.L. (1999) Semiparametric inference proportional odds regression model. Journal American Statistical Association, 94, 124–136.Yuan, M. Lin, Y. (2006) Model selection estimation regression grouped variables. Journal Royal Statistical Society, B, 68, 49–67.Zahl, P.H. (1997) Letter editor: Comments ‘Adjusting survival curves confounders: review new method’ F.J. Nieto J. Coresh. American Journal Epidemiology, 146, 605.Zeng, D., Mao, L. Lin, D.Y. (2016) Maximum likelihood estimation semiparametric transformation models interval-censored data. Biometrika, 103, 253–271.Zhang, X., Loberiza, F.R., Klein, J.P. Zhang, M.-J. (2007) SAS macro estimation direct adjusted survival curves based stratified Cox regression model. Computer Methods Programs Biomedicine, 88, 95–101.Zhang, Z. Sun, J. (2010) Interval censoring. Statistical Methods Medical Research, 19, 53–70.Zhang, Z., Sun, L., Sun, J. Finkelstein, D.M. (2007) Regression analysis failure time data informative interval censoring. Statistics Medicine, 26, 2533–2546.Zhao, Q. Sun, J. (2004) Generalized log-rank test mixed interval-censored failure time data. Statistics Medicine, 23, 1621–1629.","code":""},{"path":"exm.html","id":"exm","chapter":"示例索引","heading":"示例索引","text":"停用宫内节育器的时间：示例 1.1, 2.2, 2.4, 2.5, 2.7, 2.8, 2.9, 2.10, 5.1, 5.2, 5.3, 5.4, 16.1, 16.2, 16.3乳腺癌妇女的预后：示例 1.2, 2.11, 2.12, 2.13, 2.14, 3.1, 3.3, 5.5, 5.6, 5.7, 5.8, 5.13, 5.14, 5.17, 10.1, 10.2, 16.4, 16.5, 16.6多发性骨髓瘤患者的生存：示例 1.3, 2.2, 2.6, 3.2, 3.5, 3.7, 3.8, 3.9, 3.15, 3.17, 3.19, 3.20, 4.5, 4.8, 4.9, 5.16前列腺癌两种疗法的比较：示例 1.4, 3.6, 3.12, 3.16, 5.15肺转移：示例 2.1黑色素瘤患者的生存时间：示例 2.15, 2.16肾癌的治疗：示例 3.4, 3.10, 3.11, 3.13, 3.14, 5.10, 6.1, 6.4侧流装置检测 COVID-19 的性能：示例 3.18透析患者的感染：示例 4.1, 4.2, 4.3, 4.4, 4.7, 4.10, 4.11, 4.12数值说明：示例 5.9卵巢癌患者的化疗：示例 5.11, 5.12, 7.1, 7.2, 7.3, 7.4, 8.3一个样条函数的说明：示例 6.2, 5.12乳腺癌患者的无复发生存：示例 6.5, 6.6计数过程格式说明：示例 8.1, 13.1骨髓移植治疗白血病：示例 8.2肝硬化研究数据：示例 8.4主动脉瓣置换术后的生存：示例 8.5, 8.6, 8.7, 8.8, 8.9溃疡复发 示例 9.1, 9.4, 9.5, 9.6, 9.7, 11.1人造区间删失数据：示例 9.2, 9.3肺移植登记患者的生存：示例 10.3胃癌患者的生存：示例 11.2, 11.3肾移植中心之间的比较：示例 11.4, 11.5, 11.6, 11.7, 11.8实验小鼠的生存：示例 12.7雌性大鼠乳腺肿瘤的复发：示例 13.2他莫昔芬治疗乳腺癌患者的临床试验：示例 13.3骨髓移植后的患者结局：示例 13.4等待肝移植的死亡时间：示例 14.1, 14.3相依删失的数据格式：示例 14.2慢性活动性肝炎的生存：示例 15.1, 15.2, 15.3健康评估及其初级保健的连接：示例 16.7","code":""}]
