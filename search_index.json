[["index.html", "医学研究中的生存数据建模 前言 原书前言", " 医学研究中的生存数据建模 Wang Zhen 2024-03-28 前言 本书为 Modelling Survival Data in Medical Research 4th Edition, by David Collett 的翻译。翻译的目的有二： 现有的生存分析中文专著屈指可数，其中能与本书在内容的广度和深度方面对标的数量为 \\(\\log1\\)； 在人类彻底被 AI 取代之前，或至少翻译的工作被 AI 取代之前，或至少专著翻译的工作被 AI 取代之前，译者希望能有所贡献。 可以说，对于那些愿意付出必要努力来为生存数据适当建模的研究者，本书是难得的宝藏。 “There are no routine statistical questions, only questionable statistical routines.” - D. R. Cox 可点击带 \\(\\blacktriangleright\\) 的标题以展开图表，例如 点我看本书封面 排版说明： 由于第 3 章和第 5 章篇幅较长、公式较多，为减少渲染时间，已将这两章划分为两个页面。尽管如此，每次打开页面仍需加载一段时间。 丰富的示例贯穿全书，为方便跳转，示例均给出了交叉引用； 图表一般都在上下文中，不给出交叉引用；对于所跨章节较多的图表，会在上下文中重复给出； 为保持阅读的连贯性，图表均已折叠（如上面的封面图片）。 水平不足，能力有限。Email: 1210683652@qq.com 原书前言 本书使用生物医学研究中的大量例子描述并说明了生存数据分析的建模方法。我在介绍这一主题的许多入门级和高级讲座和课程，以及提供生存数据分析建议方面的经验，对其内容产生了很大影响。其结果是对中等水平的生存分析进行了全面的实践说明，我希望这将继续满足制药行业和生物医学研究中心的统计学家、正在分析自己数据的科学家和临床医生以及学习生存分析本科生或研究生课程的学生的需求。 本版有一个关于贝叶斯生存分析的新章节，以反映这种方法越来越受欢迎。其他章节已被改写或广泛修订，以考虑到可用于实施现代统计方法的计算机软件。特别是，对关于参数模型的第 5 章进行了修订，并在新的第 6 章中描述了基于样条的风险和累积风险函数的参数模型。已重写关于区间删失生存数据的第 ?? 章，以提供分析这类数据的现代方法。在其他地方，新材料已被纳入评估拟合模型的预测能力、纵向和生存数据的联合建模以及分段指数模型。R 软件现在被广泛用于生存数据的分析，尤其是因为该软件跟上了统计发展的步伐，并且每个人都可以免费使用。新增的最后一章展示了如何使用 R 语言实现本书中描述的方法，以及如何解释和协调之前章节中使用的说明性示例的输出结果。 这本书的主要部分由第 1 章到第 7 章组成。在第 1 章中介绍了生存分析之后，第 2 章描述了总结生存数据和比较两组或两组以上生存时间的方法。第 3 章介绍了建模方法，其中详细介绍了 Cox 回归模型。接下来的一章介绍了检查拟合模型的充分性的方法。第 7 章介绍了参数比例风险模型和加速失效时间模型。在第 6 章关于灵活参数模型之后，第 7 章介绍了参数模型的模型检查诊断。 其余章节描述了基本模型的一些扩展。第 8 章介绍了时间相关变量的使用，第 ?? 章考虑了区间删失数据的分析。允许使用随机效应对个体或个体的总体之间的差异进行建模的脆弱模型在第 ?? 章。第 ?? 章总结了在无法做出比例风险假设时可以使用的技术，并展示了如何使用这些模型来比较多个机构的生存结果。第 ?? 章介绍了包含不同死因的竞争风险模型，而第 ?? 章则描述了 Cox 回归模型的扩展，以应对相同或不同类型的多次事件，包括事件历史分析。第 ?? 章总结了当存在相依删失时分析数据的方法，第 ?? 章介绍了如何确定结局变量为生存时间的研究的样本量要求。第 ?? 章和第 ?? 章分别介绍了贝叶斯方法和 R 软件的使用。 每一章都包含足够的方法细节，以传达对技术及其所基于的假设的良好理解，并帮助调整方法来处理非标准问题。前面几章中的一些例子基于的观察比生物医学研究项目中通常遇到的要少。这使得分析方法能够更容易地被说明，并且允许结果的表格表示与从计算机软件获得的输出进行比较。附录中给出了一些额外的数据集，可用于更全面地了解该方法，或作为学生练习。本书中使用的所有数据集均可以电子形式从出版商的网站 https://www.routledge.com 获取。 在撰写本书时，我假设读者具有统计方法的基本知识，并且对线性回归分析有一定的了解。有时会使用矩阵代数，但了解线性代数并不是必要条件。每章末尾都给出了参考书目注释和进一步阅读的建议，但为了不中断流程，文本本身的参考文献已保持在最低限度。 我感谢已故的 Doug Altman, James Gallagher, Alan Kimber, Sandro Leidi, Mike Patefield, Anne Whitehead 和 John Whitehead 在准备本书当前版本和早期版本时提供的帮助，并感谢 NHS 血液和移植部门的允许在许多示例中使用来自英国移植登记处的数据。我特别感谢所有不厌其烦地告诉我早期版本中的错误的人。尽管这些内容已得到纠正，但我很高兴获悉本版本中的任何进一步错误、歧义和遗漏：d.collett@btinternet.com。最后，我要感谢我的妻子 Janet 在本书写作期间的支持和鼓励。 David Collett, October 2022 "],["作者介绍.html", "作者介绍", " 作者介绍 David Collett 在 University of Leicester 获得其首个学位，之后在 University of Newcastle 完成了统计学硕士学位，在 University of Hull 完成了统计博士学位。David 在 University of Reading 应用统计学系担任讲师和高级讲师超过 25 年，其中 8 年担任该系主任。2003 年，他被任命为英国国家医疗服务体系血液与移植部 (NHS Blood and Transplant) 统计与临床研究副主任。这包括监督 30 多名工作人员的统计工作，以及与移植临床医生和研究科学家的合作。David 后来成为 NHS Blood and Transplant 临床试验部主任，负责移植和输血医学临床试验的设计、实施和分析。他在退休前担任 Southampton Statistical Sciences Research Institute, University of Southampton。他现在喜欢呆在高尔夫球场上。 "],["chap1.html", "第 1 章 生存分析 1.1 生存分析的应用 1.2 生存数据的特殊特征 1.3 一些示例 1.4 生存函数，风险函数和累积风险函数 1.5 用于生存分析的计算机软件 1.6 延伸阅读", " 第 1 章 生存分析 生存分析 (survival analysis) 是一种分析数据的术语，该数据以时间为形式，用于描述从定义明确的时间起点 (time origin) 到某个特定事件或终点的发生。在医学研究中，时间起点通常对应于将个体招募到实验研究中，例如比较两种或多种治疗的临床试验。这又可能与特定疾病的诊断、治疗方案的开始或某些不良事件的发生相吻合。如果终点是患者的死亡，那么得出的数据就是实际的生存时间。然而，当终点不是致命的，例如疼痛减轻或症状复发时，也可以获得类似形式的数据。 1.1 生存分析的应用 这本书的重点是生物医学中事件发生时间 (time-to-event) 数据的分析，在生物医学中，生存分析这一术语被广泛使用，即使终点不是死亡。然而，同样的技术也可用于许多其他应用领域，在这些领域中，它们被不同地称为事件历史分析 (event history analysis)、持续时间分析 (duration analysis)、转移分析 (transition analysis)、可靠性分析 (reliability analysis) 或失效时间建模 (failure-time modelling) 。生存分析在许多领域有所应用，本节概述了其中的一些。 在犯罪学中，获释的囚犯可能会继续犯罪，从获释到随后犯罪的时间就是生存时间。这里，由于可能犯下的罪行不同，可能存在多种终点。对不同罪行发生时间及其影响因素的比较，将有助于对释放到社区的罪犯进行辅导。该领域的其他应用还包括犯罪生涯的持续时间、从犯罪到随后被捕的时间以及假释的持续时间。 在工程学中，从器械（如洗碗机或洗衣机）出现机械问题到该器械再次正常工作的这段时间，对于维护客户满意度至关重要。有些物品可能无法修复，因此无法记录修复时间。同时，调查与维修时间相关的因素也很重要，比如物品的使用年限、使用程度以及保养状况等。 在实验性农业中，种子发芽的时间、植物发病的时间以及农作物收获的时间都是事件发生时间。通常有很多因素可能会影响这些持续时间，确定最重要的因素将使实践得以完善。例如，用除草剂处理一块土地后，化学品首次出现效果的时间就是生存时间，影响这一时间的因素可能有助于确定产品的特性。此时，很难记录除草剂出现效果的确切时间，只有在一定的时间段内才能知道是否产生了效果。 在金融领域，从提交申请到获得批准，处理抵押贷款申请所需的时间产生了事件发生时间的数据。有些申请没有进行到终点，可能是因为房屋销售失败，或者申请人安排了其他资金来源。然而，这也可能是因为申请流程已经花费了很长时间，因此必须考虑这些因撤销申请而删失 (censored) 的时间。同样，一家公司偿还贷款所花费的时间也会产生生存数据，其中因贷款违约而产生的删失时间也包含在内。信贷公司可能非常关心诸如公司规模、年龄以及贷款规模等因素如何影响还款时间。 在人力资源领域，雇主可能会调查在特定时间段内开始工作的员工的在职时长。在分析时，许多员工可能仍在工作，因此他们只能提供关于在职时间的部分信息。特别令人感兴趣的是影响在职期的因素，如初始工资、工资涨幅、员工的资质等。填补招聘职位所需的时间或首次晋升所需的时间都是该领域生存时间的进一步实例。在大型组织的不同部门之间，对这些事件发生时间的比较可能特别有助于识别好的管理规范。 在市场营销领域，客户流失率是一个重要的业务指标，它指的是在特定时间段内停用公司产品或服务的客户比例。之所以这一指标如此重要，很大程度上是因为获取新客户的成本往往远高于留住现有客户的成本。生存分析在该领域有众多应用，例如客户离开公司的时间、取消服务协议的时间、升级产品（如 iPhone 或电脑）的时间，以及计算机软件或 iCloud 存储服务的订阅时长等。在所有这些情况下，客户流失的原因可能有很多，如服务不佳、产品质量低劣以及成本问题等。流失时间还可能取决于一些其他因素，比如客户是否是通过其他客户推荐获得的、客户在客服电话上花费的时间以及是否有优惠活动可用等。对这些因素对客户留存时间的影响进行分析，有助于公司了解如何留住客户。 在政治学领域，在选举过程后组建政府的时间有时可能很短，但在其他情况下，各政党之间可能需要长时间的谈判。政府组建的延误可能会对政治或经济产生不利影响。研究相关因素，如参与谈判的政党数量、最大政党所占的多数席位以及各参与政党在意识形态上的冲突等，都有助于确定政府组建的时间。此外，在政治学领域，事件发生时间分析的其他应用还包括政治生涯的长度、内阁政府的任期以及美国参议员的任期。在国际关系领域，战争的持续时间、贸易协定的期限以及政府的任期等，都适用于生存分析的方法。 在心理学领域，心理治疗疗程结束与行为发生临床显著变化之间的时间区间与潜在问题的治疗有关。例如，在治疗酒精滥用问题时，识别与戒酒所需时间相关的因素至关重要。这些因素可能包括家族酒精依赖史、社会经济地位、个性问题、在就业保障和维持方面的困难，以及个体交往对象的吸烟和饮酒习惯。识别导致戒酒的因素可能有助于相关患者的管理。 本书的重点是生存分析在医学研究数据中的应用，因此，大部分一般性讨论将以个体患者从进入研究到死亡或其他终点的生存时间来表述。 1.2 生存数据的特殊特征 我们必须首先考虑为什么生存数据不适用于数据分析中使用的标准统计程序。其中一个原因是生存数据通常不是对称分布的。通常，由一组相似个体的生存时间构建的直方图会倾向于正偏态分布，也就是说，直方图在包含最多观测的区间的右侧会有一个较长的“尾巴”。因此，假设这类数据具有正态分布是不合理的。这个问题可以通过首先对数据进行转换以获得更对称的分布来解决，例如取对数。然而，更好的方法是采用其他分布。 生存数据的主要特征是生存时间经常是删失的 (censored)。这使得标准方法不适用。下一节将描述删失的具体内容。 1.2.1 删失 个体的生存时间称为删失，是指对该个体而言，感兴趣的终点尚未观察到。这可能是因为研究的数据要在一些人还活着的时候进行分析。或者在分析时个体的生存状态可能未知，因为该个体已经失访 (lost to follow-up). 例如，假设某患者在被招募参加临床试验后，搬到国内的另一个地区或另一个国家，无法再追踪到。关于该患者的生存经历，唯一可获得的信息是他或她最后一次被确认存活的日期。这个日期可能是患者最后一次到诊所进行常规检查的日期。 当已知死亡原因与治疗无关时，实际的生存时间也可视为删失。然而，很难确定患者的死亡是否与他正在接受的特定治疗有关。例如，考虑一位参加前列腺癌替代疗法临床试验的患者，他遭遇了致命的交通事故。这场事故可能是由于眩晕发作导致的，而眩晕可能是分配给该患者的治疗方案的副作用。如果是这样的话，那么死亡就与治疗有关。在这种情况下，所有原因导致的死亡的生存时间，或患者正在接受治疗的主要疾病以外的其他原因导致的死亡时间，也可能需要进行生存分析。 在每种情况下，在时间 \\(t_0\\) 进入研究的患者在时间 \\(t_0+t\\) 死亡。然而，\\(t\\) 是未知的，要么是因为此人还活着，要么是由于他或她已失访。如果个体最后的已知生存时间为 \\(t_0+c\\)，则时间 \\(c\\) 称为删失生存时间 (censored survival time). 这种删失发生在个体进入研究之后，即最后已知生存时间的右侧，因此称为右删失 (right censoring). 右删失生存时间小于实际但未知的生存时间。研究观察期结束时发生的右删失通常称为行政删失 (administrative censoring). 另一种形式的审查是左删失 (left censoring)，当个体的实际生存时间小于观测时间时就会遇到这种情况。考虑一项研究以说明这种形式的删失，该研究的兴趣集中在手术切除原发肿瘤后特定癌症的复发时间。术后三个月对患者进行检查以确定癌症是否复发，这时可能会发现部分患者出现了复发。对于此类患者，实际复发时间不到三个月，这些患者的复发时间是左删失。左删失的发生率远低于右删失，因此本书的重点将放在右删失生存数据的分析中。 另一种类型的删失是区间删失 (interval censoring). 此时，已知个体在一段时间内经历过某个事件。再次考虑上述左删失讨论中使用的有关肿瘤复发时间的例子。如果患者在三个月后观察到疾病已痊愈，但在术后六个月检查时发现疾病复发，则该患者的实际复发时间在三个月至六个月之间。观测复发时间称为区间删失。我们将在第 ?? 章讨论区间删失。 1.2.2 独立删失 在分析删失的生存数据时，一个重要的假设是，个体的实际生存时间 \\(t\\) 不依赖于任何导致该个体的生存时间在时间 \\(c\\) 删失的机制，其中 \\(c&lt;t\\)。这种类型的删失称为独立删失或无信息删失 (independent or non-informative censoring). 这意味着，如果我们考虑一组具有相同相关预后变量值的个体，则生存时间在时间 \\(c\\) 处删失的个体必须代表该组中生存到该时间的所有其他个体。如果删失过程随机进行，则生存时间删失的患者将代表删失时处于风险中的患者。类似地，当要在日历时间中的预定点或在每个患者的时间起点之后的固定时间区间分析生存数据时，仍然活着的个体的预后可视为与删失独立，只要在检查数据之前指定分析时间即可。然而，如果个体的生存时间因身体状况恶化而停止治疗导致删失，则不能做出这一假设。此类删失称为相依删失或信息删失 (dependent or informative censoring). 本书中大多数章节介绍的生存分析方法仅在独立性删失的假设下才有效，但第 ?? 章将介绍能够考虑相依删失的技术。 1.2.3 研究时间和患者时间 在典型的研究中，患者并非都在同一时间招募，而是在数月甚至数年的时间内陆续招募。招募完成后，将对患者进行跟踪调查，直至其去世，或者直至研究结束，此时将分析数据。尽管可以观察到一些患者的实际生存时间，但一些患者可能会在招募后失去联系，而其他患者在研究结束时可能仍然健在。个体参与研究的时间段称为研究时间 (study time). 临床试验中八个人的研究时间如图 1.1 所示，其中进入研究的时间用“•”表示。该图显示，个体 1, 4, 5 和 8 在研究过程中死亡 (D)，个体 2 和 7 失访 (L)，个体 3 和 6 在观察期结束时仍然活着 (A). 就每个患者而言，试验在 \\(t_0\\) 开始。图 1.1 所示的八个个体的相应生存时间如图 1.2 所示。患者在研究中经历的时间段，从其时间起点开始测量，通常称为患者时间 (patient time). 从时间起点到患者死亡 (D) 的时间段即为生存时间，这是为个体 1, 4, 5 和 8 记录的。剩余个体的生存时间是右删失的 (C). 图 1.1 图 1.2 在实践中，记录的实际数据将是每个个体进入研究的日期，以及每个个体死亡或最后已知存活的日期。然后可以计算生存时间，以天、周或月为单位，以最合适的为准。大多数用于生存分析的计算机软件包都可以根据日期形式的数据执行此类计算。 1.3 一些示例 在本节中，通过许多示例说明生存数据的基本特征。这些示例中的数据将用于说明后续章节中介绍的一些统计技术。 示例 1.1 (停用宫内节育器的时间) 在涉及避孕措施的试验中，预防怀孕是评估可接受性的一个明显标准。然而，现代避孕措施的失败率非常低，因此，诸如闭经（长期无出血）、不规则或延长出血等出血障碍的发生情况，在评估某种避孕方法时变得尤为重要。为了推动对分析避孕试验中女性月经出血数据方法的研究，世界卫生组织提供了涉及多种不同类型避孕方法的临床试验数据 (WHO, 1987). 这些数据集的一部分涉及女性开始使用某种避孕方法到停用该方法的时间，如果已知停用原因，则记录停用原因。表 1.1 中的数据指的是从开始使用一种特定类型的宫内节育器 (intrauterine device, IUD)，称为 Multiload 250，到因月经出血问题而停用该设备所经历的周数。这些数据来自 18 名女性，她们的年龄都在 18 至 35 岁之间，且都有过两次怀孕经历。删失的停用时间用星号标记。 表 1.1 在此示例中，时间起点对应于女性使用宫内节育器的第一天，终点是因出血问题导致的停用。研究中的一些女性因为想要怀孕或不再需要避孕药而停用宫内节育器，而其他女性则只是失访。这些原因导致了 13, 18, 23, 38, 54 和 56 周的删失停用时间。该研究方案要求记录每位女性的月经出血经历，为期两年。出于实际原因，每个女性在招募后两年内都无法接受检查以确定她们是否仍在使用宫内节育器，这就是为什么有 3 个停用时间大于 104 周的右删失时间。 分析这些数据的一个目的是总结停用时间的分布。然后我们可能希望估计停用宫内节育器的中位时间，或者估计女性在特定时间段后停用该设备的概率。事实上，以时间为函数的这种估计概率图将为数据提供一个有用的总结。 示例 1.2 (患乳腺癌妇女的预后) 乳腺癌是西方国家女性最常见的癌症形式之一。然而，肿瘤的生物学行为往往难以预测，许多研究集中在肿瘤是否可能已经转移或扩散到身体的其他器官。大约 80% 的原发性乳腺癌女性患者可能患有已经转移到其他部位的肿瘤。如果能确定这些患者，可以针对她们进行辅助治疗，而剩下的 20% 可以通过手术治愈。 Middlesex Hospital 开展了一项调查，相关记录可见 Leathem and Brooks (1987). 该调查旨在评估一种组织化学标志物，用以区分已经发生转移和未发生转移的原发性乳腺癌。研究中的标志物是一种来自罗马蜗牛 Helix pomatia 的白蛋白腺凝集素，即 Helix pomatia agglutinin (HPA). 这种标志物与发生局部淋巴结转移的乳腺癌细胞结合，而经 HPA 染色的细胞可以通过显微镜检查来识别。为了探究 HPA 染色是否可用于预测罹患乳腺癌女性的生存状况，研究者开展了一项回顾性研究，研究对象为接受乳腺癌手术治疗的女性的病历记录。对这些女性的肿瘤切片进行 HPA 处理，随后将每个肿瘤分为阳性染色和阴性染色，其中阳性染色表示肿瘤具有转移潜力。该研究于 1987 年 7 月结束，此时计算了死于乳腺癌的女性的生存时间。对于 1987 年 7 月时生存状态未知的女性，从手术日期到她们最后一次被确认存活的日期之间的时间视为删失生存时间。死于乳腺癌以外原因的女性的生存时间也视为右删失。表 1.2 中的数据指的是 1969 年 1 月至 1971 年 12 月期间接受单纯或根治性乳房切除术治疗的 II 级、III 级或 IV 级肿瘤的女性的生存月数。在表中，每位女性的生存时间根据其肿瘤是否为阳性染色进行分类。 表 1.2 在分析这项研究的数据时，我们特别感兴趣的是，这两组女性的生存经历是否存在差异。如果有证据表明，那些 HPA 染色阴性的女性在术后往往比那些染色阳性的女性活得更长，我们将得出结论，癌症患者的预后取决于染色程序的结果。 示例 1.3 (多发性骨髓瘤患者的生存率) 多发性骨髓瘤是一种恶性疾病，其特征是异常浆细胞（一种白细胞）在骨髓中积聚。骨内异常浆细胞的增殖导致疼痛和骨组织的破坏。多发性骨髓瘤患者也会出现贫血、出血、反复感染和虚弱。这种情况总是致命的，除非接受治疗。Medical Center of the University of West Virginia, USA 进行了一项研究，其目的是检验某些解释变量或协变量的值与患者生存时间之间的关系。在这项研究中，主要响应变量是多发性骨髓瘤从诊断到死亡的时间，以月为单位。 表 1.3 中的数据来自 Krall, Uthoff and Harley (1975)，涉及 48 名患者，他们的年龄都在 50 至 80 岁之间。到研究完成时，部分患者还未死亡，因此他们的生存时间是右删失的。表中个体生存状态的编码规则为：0 表示删失观测，1 表示多发性骨髓瘤死亡。 表 1.3 在诊断时，记录了每位患者的许多解释变量的值。这些包括患者的年龄（岁）、性别（1 = 男性，2 = 女性）、血尿素氮 (Bun) 水平、血清钙 (Ca)、血红蛋白 (Hb)、骨髓中血浆细胞的百分比 (Pcells) 和一个指示变量 (Protein)，用于指示尿液中是否存在 Bence-Jones 蛋白（0 = 不存在，1 = 存在）。 分析这些数据的主要目的是研究风险因素 Bun, Ca, Hb, Pcells 和 Protein 对多发性骨髓瘤患者生存时间的影响。这些风险因素的影响可能会因患者的年龄或性别而改变，因此，还需要研究生存时间与重要风险因素之间的关系在每个性别以及不同年龄组中的一致性程度。 示例 1.4 (两种癌症疗法的比较) 1967年，Veteran’s Administration Cooperative Urological Research Group 开始了一项随机对照临床试验，以比较前列腺癌的疗法。该试验是双盲的，研究中使用的两种疗法是安慰剂和 1.0 毫克己烯雌酚 (DES)。每天口服治疗。研究的时间起点是患者被随机分配接受治疗的日期，终点是患者死于前列腺癌的日期。 完整的数据集在 Andrews and Herzberg (1985) 中给出，但本例中使用的数据来自患有 III 期癌症的患者，即有证据表明这些患者的肿瘤局部扩展至前列腺包膜之外，但血清前列腺酸性磷酸酶未升高。此外，这些患者没有心血管病史，在试验开始时心电图结果正常，白天没有卧床休息。除了记录研究中每个患者的生存时间外，还记录了许多其他预后因素的信息。其中包括患者进入试验时的年龄、他们的血清血红蛋白水平（单位：g/100 ml）、原发肿瘤大小（单位：cm2）以及肿瘤分期和分级的综合指数值。这个指数称为 Gleason 指数；越晚期，该指数的值就越大。 表 1.4 给出了 38 名患者的记录数据，其中生存时间以月为单位。因其他原因死亡或失访的患者的生存时间视为删失。研究结束时，若患者死于前列腺癌，则与个体状态相关的变量的值为 1，若生存时间删失，则为 0。当个体接受 DES 治疗时，与治疗组别相关的变量取值为 2，而当个体接受安慰剂治疗时，变量取值为 1. 表 1.4 本研究的主要目的是确定是否有证据表明接受 DES 治疗的患者比接受安慰剂治疗的患者生存时间更长。由于本例所依据的数据来自一项随机试验，人们可能会期望两组治疗患者中预后因素（即患者年龄、血清血红蛋白水平、肿瘤大小和 Gleason 指数）的分布是相似的。然而，依赖这一假设并不明智。例如，结果表明安慰剂组患者的肿瘤平均大小可能大于接受 DES 治疗的患者。如果大肿瘤患者的预后比小肿瘤患者差，那么治疗效果就会被高估，除非在分析中充分考虑肿瘤的大小。因此，首先有必要确定是否有任何协变量与生存时间相关。若如此，在比较两个治疗组患者的生存时间时，需要考虑这些变量的效应。 1.4 生存函数，风险函数和累积风险函数 在总结生存数据时，主要关注三个函数，即生存函数 (survival or survivor function)、风险函数 (hazard function) 和累积风险函数 (cumulative hazard function). 因此，这些函数在第一章中定义。 1.4.1 生存函数 个体的实际生存时间 \\(t\\) 可以视为变量 \\(T\\) 的观测，其中 \\(T\\) 可以取任意非负值。\\(T\\) 可取的值具有概率分布，我们将 \\(T\\) 称为与生存时间相关的随机变量。现假设该随机变量具有概率密度函数为 \\(f(t)\\) 的概率分布。\\(T\\) 的分布函数由下式给出 \\[\\begin{equation} F(t)=\\mathrm{P}(T&lt;t)=\\int_0^tf(u)\\mathrm{d}u \\tag{1.1} \\end{equation}\\] 表示生存时间小于某个值 \\(t\\) 的概率。该函数也称为累积发生率函数 (cumulative incidence function)，因为它总结了在时间 \\(t\\) 之前发生的死亡的累积概率 生存函数 \\(S(t)\\) 定义为生存时间大于等于 \\(t\\) 的概率，因此根据式 (1.1) \\[\\begin{equation} S(t)=\\text{P}(T\\geqslant t)=1-F(t) \\tag{1.2} \\end{equation}\\] 因此，生存函数可以用来表示一个个体在任何给定时间之后生存的概率。 1.4.2 风险函数 风险函数 (hazard function) 广泛用于表示某个时间 \\(t\\) 发生的事件（如死亡）的风险或危险 (hazard or risk). 该函数是从一个个体在时间 \\(t\\) 死亡的概率中获得的，前提是这个个体已经生存到了这个时间。为了正式定义等下函数，考虑与个体生存时间相关的随机变量 \\(T\\) 在 \\(t\\) 和 \\(t+\\delta t\\) 之间的概率，条件是 \\(T\\) 大于等于 \\(t\\)，即 \\(P(t \\le T &lt; t + \\delta t | T \\ge t)\\)。风险函数 \\(h(t)\\) 是该量的极限值，因为 \\(\\delta t\\) 趋于零，所以 \\[\\begin{equation} h(t)=\\lim_{\\delta t\\to0}\\left\\{\\frac{\\text{P}(t\\leqslant T&lt;t+\\delta t\\mid T\\geqslant t)}{\\delta t}\\right\\} \\tag{1.3} \\end{equation}\\] 函数 \\(h(t)\\) 也称为风险率 (hazard rate)、瞬时死亡率 (instantaneous death rate)、强度率 (intensity rate) 或死亡作用力 (force of motality). 根据式 (1.3) 中风险函数的定义，\\(h(t)\\) 是时间 \\(t\\) 处的事件率，前提是事件在 \\(t\\) 之前没有发生。具体而言，如果生存时间以天为单位，\\(h(t)\\) 是在第 \\(t\\) 天开始时有事件发生风险的个体在该天经历事件的近似概率。时间 \\(t\\) 的风险函数也可以视为个体在单位时间内经历的预期事件数，假设在此之前没有发生过事件，并假设风险在该时间段内是恒定的。 根据式 (1.3) 中风险函数的定义，生存函数和风险函数之间存在一些有用的关系。根据概率论，以事件 \\(B\\) 的发生为条件，事件 \\(A\\) 的概率由 \\(\\text{P}(A|B)=\\text{P}(AB)/\\text{P}(B)\\) 给出，其中 \\(\\text{P}(AB)\\) 是 \\(A\\) 和 \\(B\\) 共同发生的概率。使用该关系，式 (1.3) 风险函数定义中的条件概率 \\[\\begin{aligned}\\frac{\\mathrm{P}(t\\leqslant T&lt;t+\\delta t)}{\\mathrm{P}(T\\geqslant t)}\\end{aligned}\\] 等于 \\[\\begin{aligned}\\frac{F(t+\\delta t)-F(t)}{S(t)}\\end{aligned}\\] 其中 \\(F(t)\\) 为 \\(T\\) 的分布函数。那么 \\[h(t)=\\lim_{\\delta t\\to0}\\left\\{\\frac{F(t+\\delta t)-F(t)}{\\delta t}\\right\\}\\frac{1}{S(t)}\\] 现在 \\[\\lim_{\\delta t\\to0}\\left\\{\\frac{F(t+\\delta t)-F(t)}{\\delta t}\\right\\}\\] 是 \\(F(t)\\) 关于 \\(t\\) 的导数的定义式，也就是 \\(f(t)\\)，因此 \\[\\begin{equation} h(t)=\\frac{f(t)}{S(t)} \\tag{1.4} \\end{equation}\\] 总之，式 (1.1), (1.2) 和 (1.4) 表明，利用 \\(f(t),S(t),h(t)\\) 中的任何一个可以确定其他两个。 1.4.3 累积风险函数 根据式 (1.4) 可以得出 \\[\\begin{equation} h(t)=-\\frac{\\mathrm{d}}{\\mathrm{d}t}\\{\\log S(t)\\} \\tag{1.5} \\end{equation}\\] 因此 \\[\\begin{equation} S(t)=\\exp\\left\\{-H(t)\\right\\} \\tag{1.6} \\end{equation}\\] 其中 \\[\\begin{equation} H(t)=\\int_0^th(u)\\mathrm{d}u \\tag{1.7} \\end{equation}\\] 函数 \\(H(t)\\) 在生存分析中作用广泛，称为集成或累积风险函数 (intergrated or cummulative hazard function). 根据式 (1.6)，累积风险函数也可根据生存函数得到，因为 \\[\\begin{equation} H(t)=-\\log S(t) \\tag{1.8} \\end{equation}\\] 累积风险函数 \\(H(t)\\) 是直到时间 \\(t\\) 时发生事件的累积风险。如果事件是死亡，则 \\(H(t)\\) 总结了截至时间 \\(t\\) 的死亡风险，前提是死亡在 \\(t\\) 之前尚未发生。时间 \\(t\\) 处的累积风险函数也可解释为从时间起点到 \\(t\\) 的时间区间内发生事件的预期数量。 累积风险函数有可能大于 1. 使用式 (1.8)，当 \\(-\\log S(t)\\geqslant1\\) 即 \\(S(t)\\leqslant e^{-1}=0.37\\) 时，\\(H(t)\\geqslant1\\)。当时间 \\(t\\) 之后发生事件的概率小于 0.37 时，累积风险大于 1，这意味着在时间区间 \\((0, t)\\) 内预计会发生多个事件。因此生存函数 \\(S(t)\\) 可以更准确地定义为时间 \\(t\\) 之后发生一个或多个事件的概率。将累积风险函数解释为预期事件数仅在事件可能重复发生的情况下是合理的，例如当事件是感染、偏头痛或癫痫发作的发生；而当感兴趣的事件是死亡时，这种解释依赖于个体在死亡发生后立即复活！分析事件多次发生时间的方法将在第 ?? 章讨论，并且当可能发生多次事件时，对风险和累积风险函数更数学的解释包含在该章的 ?? 节中。 在生存数据分析中，根据生存时间估计生存函数、风险函数和累积风险函数。第 2 章和第 3 章描述了不需要指定 \\(T\\) 的概率密度函数形式的估计方法，而第 5 章介绍了基于特定生存时间分布假设的方法。 1.5 用于生存分析的计算机软件 本书将要介绍的大多数生存数据分析技术都需要合适的计算机软件来实施。目前已有许多用于生存分析的计算机软件包，但商业软件包，例如，SAS (SAS Institute Inc.)、Stata (StataCorp) 和 S-PLUS (TIBCO Software Inc.) 具有最广泛的功能。此外，R 统计计算环境 (R Core Team, 2021) 是一款免费软件，根据 GNU General Public License 条款发布。S-PLUS 和 R 都是 S 统计编程语言的现代实现，并包含一系列全面的用于生存分析的模块。本书后续章节描述的任何分析都可以使用这四个软件包中的任何一个来执行。由于 R 的广泛使用且易于获取，因此第 ?? 章详细描述了其在生存分析中的应用。 在某些情况下，软件包生成的输出中的数值结果可能有所不同。这通常是由于使用不同的默认计算方法造成的。当数据集包含两个或多个具有相同生存时间的个体时，就会出现一个特别重要的例子。在这种情况下，SAS phreg 程序和 R 函数 coxph (Theerneau, 2022) 默认采用不同的方法来处理这些相关观测，从而导致输出存在差异。默认设置当然可以更改，第 3 章第 3.3.2 节描述了生存时间结 (tied survival times) 的处理。有关使用 R 函数 coxph 的更多详细信息可以在第 ?? 章第 ?? 节中找到。数值上的差异也可能是由于控制某些迭代过程收敛的参数使用不同的设置以及用于数值优化的不同方法造成的。 1.6 延伸阅读 许多关于医学研究统计的一般书籍都介绍了生存数据分析中使用的技术，例如 Altman (1991) 和 Armitage, Berry and Matthews (2002) 的书籍。 Machin, Cheung and Parmar (2006) 提供了使用非技术语言分析临床试验生存数据的实用指南。 有许多教科书介绍了生存分析的方法，并通过实例加以说明。Lee and Wang (2013) 从生物学和医学的角度提供了广泛的主题概述，而 Marubini and Valsecchi (1995) 则描述了临床试验和观察性研究中生存数据的分析。Hosmer、Lemeshow和May（2008）对生存分析进行了平衡的阐述，其中包括模型开发和拟合模型中参数估计的解释等优秀章节。Kleinand Moeschberger (2005) 在其综合教科书中包含了许多示例数据集和练习，而 Kleinbaum and Klein (2012) 则提供了一本关于生存分析的自学教材。Mills (2010) 也提供了一本使用 R 和 Stata 的生存和事件历史分析实用指南。Breslow and Day (1987) 以及 Woodward (2014) 描述了生存分析在流行病学数据分析中的应用。Crowder et al. (1991) 和 Meeker, Escobar amd Pascual (2022) 介绍了生存分析在其他领域的应用，他们重点关注可靠性数据的分析，而 Box-Steffensmeier and Jones (2004) 则从非数学的角度介绍了社会科学中的事件发生时间分析。 Kalbfleisch and Prentice (2002) 以及 Lawless (2002) 对该主题进行了全面描述。这些书是为研究生统计学家或研究工作者编写的，通常视为参考书，而不是介绍性文本。Cox and Oakes (1984) 的研究专著以及 Hinkley, Reid and Snell (1991) 专门讨论生存分析的章节对生存分析进行了简要回顾。Hougaard (2000) 关于多变量生存数据的书在介绍了生存分析的基本特征后，讨论了更先进的主题。Aalen, Borgan and Gjessing (2008) 展示了如何使用随机过程分析删失数据，结合了医学实际例子。Therneau and Grambsch (2000) 将生存分析的介绍建立在计数过程方法的基础上，从而使材料更加数学化。Harrell (2015) 详细介绍了其他文本中没有的统计模型开发过程中出现的许多问题，包括对案例研究的广泛讨论。 有很多关于特定软件包在数据分析中的使用的一般性书籍，其中一些书籍详细描述了这些软件包在生存数据分析中的应用。Allison (2010) 为 SAS 软件在生存分析中的应用提供了全面的指南。Cleves, Gould and Marchenko (2016) 介绍了 Stata 在生存分析中的应用，而 Kohler and Kreuter (2012) 则提供了 Stata 在数据分析中使用的一般介绍。Therneau and Grambsch (2000) 详细描述了如何使用 SAS 和 S-PLUS 来拟合 Cox 回归模型及其扩展。该书还描述了一些 SAS 宏和 S-PLUS 函数，这些函数补充了这些软件包中可用的标准函数。Tableman and Kim (2004) 也描述了 S-PLUS 在生存分析中的应用，而 Broström (2022) 和 Moore (2016) 则展示了 R 在生存数据分析中的应用。Venables 和 Ripley (2002) 描述了如何在 S 环境中进行图形和数值数据分析，这种环境在 R 和 S-PLUS 中都可实现；请注意，S 代码通常可以在 R 下运行。关于 R 的更多参考文献见第 ?? 章末尾。 "],["chap2.html", "第 2 章 一些非参数程序 2.1 估计生存函数 2.2 生存函数估计的标准误 2.3 估计风险函数 2.4 估计生存时间的中位数和百分位数 2.5 中位数和百分位数的置信区间 2.6 两组生存数据的比较 2.7 三组或更多组生存数据的比较 2.8 分层检验 2.9 Log-rank 趋势检验 2.10 延伸阅读", " 第 2 章 一些非参数程序 分析一组生存数据的第一步是呈现特定总体中个体生存时间的数字或图形总结。这些总结本身可能令人感兴趣，或作为对数据进行更详细分析的前奏。通过生存函数和风险函数的估计，可以方便地总结生存数据。第 2.1 节和第 2.3 节描述了从单个生存数据样本估计这些函数的方法。这些方法被认为是非参数的或无分布的 (distribution-free)，因为它们不需要对生存时间的分布做出特定的假设。 一旦找到生存函数的估计，就可以估计生存时间分布的中位数和其他百分位数，如第 2.4 节所示。数据的数字总结，基于对数据的概率分布假设得出，将在第 5 章考虑。 当比较两组患者的生存时间时，可以使用生存函数估计对每组个体的生存经历进行非正式比较。然而，有更正式的程序可以比较两组生存数据。第 2.6 节描述了用于比较两组或多组生存时间的三种非参数程序，即 log-rank, Wilcoxon 和 Peto-Peto 检验。 2.1 估计生存函数 首先假设我们有一个生存时间样本，其中没有任何删失的观测。生存函数 \\(S(t)\\) 由式 (1.2) 定义，是个体生存时间大于等于 \\(t\\) 的概率。该函数可以通过经验生存函数 (empirical survival function) 来估计，由下式给出 \\[\\begin{equation} \\hat S(t)=\\frac{\\text{生存时间 }\\ge t \\text{ 的个体数量}}{\\text{数据集中的个体数量}} \\tag{2.1} \\end{equation}\\] 等价地，\\(\\hat S(t)=1 − \\hat F(t)\\)，其中 \\(\\hat F(t)\\) 是经验分布函数 (empirical distribution function)，即研究中在 \\(t\\) 时刻生存的个体总数与该组个体总数的比值。请注意，经验生存函数在第一个死亡时间 \\(t\\) 之前等于 1，在最终死亡时间之后等于 0. 假设生存函数估计 \\(\\hat S(t)\\) 在两个相邻死亡时间之间是恒定的，因此 \\(\\hat S(t)\\) 关于 \\(t\\) 的图像是阶跃函数 (step function). 在每个生存时间之后，函数立即下降。 示例 2.1 (肺转移) 恶性骨肿瘤或骨肉瘤患者治疗中的一项并发症是肿瘤经常扩散到肺部。这种肺部转移会危及生命。在一项有关治疗骨肉瘤引起的肺转移的研究中，Burdette and Gehan (1970) 给出了 11 名男性患者的以下生存时间（以月为单位）：11 13 13 13 13 13 14 14 15 15 17. 使用式 (2.1)，生存函数在第 11, 13, 14, 15 和 17 个月时的估计值为 1.000, 0.909, 0.455, 0.273 和 0.091. 生存函数的估计值从时间起点到 11 个月为 1，在 17 个月后为 0. 图 2.1 给出了生存函数估计的图示。 图 2.1 当存在删失观测时，上述示例中所示的估计生存函数的方法无法使用。原因是该方法不允许将在时间 \\(t\\) 之前生存时间删失的个体的信息用于计算时间 \\(t\\) 处的生存函数估计。以下部分描述了可用于存在删失生存时间情况下估计 \\(S(t)\\) 的非参数方法。 2.1.1 生存函数的生命表估计 生存函数的生命表估计 (life-table estimate)，也称为生存函数的精算估计 (actuarial estimate)，是通过首先将观察期划分为一系列时间区间而获得的。这些区间不一定是等长的，尽管它们通常是等长的。使用的区间数量取决于研究中的人数，但通常在 5 到 15 之间。假设有 \\(m\\) 个这样的区间，第 \\(j(=1,2,\\cdots,m)\\) 个区间的时间范围为 \\([t^\\prime_{j-1},t^\\prime_j)\\)，我们取 \\(t_0 = 0\\) 且 \\(t_m = \\infty\\)。另外，令 \\(d_j\\) 和 \\(c_j\\) 分别表示该时间区间内的死亡人数和删失生存时间数，令 \\(n_j\\) 为在第 \\(j\\) 个区间开始时存活且面临死亡风险的个体数量。我们现在假设删失程序是这样的，即删失生存时间在第 \\(j\\) 个时间区间内均匀出现，因此在该时间区间内处于风险的平均人数为 \\[\\begin{equation} n&#39;_j=n_j-c_j/2 \\tag{2.2} \\end{equation}\\] 该假设有时称为精算假设 (actuarial assumption). 在第 \\(j\\) 个区间内，死亡概率可以通过 \\(d_{j}/n_{j}^{\\prime}\\) 来估计，因此对应的生存概率为 \\((n&#39;_j-d_j)/n&#39;_j\\) 。现考虑个体在时间 \\(t_{j-1}^{\\prime},j=2,3,\\ldots,m\\) 之后生存的概率，即生存到第 \\(j\\) 个区间开始后的某个时间。这将是个体在前 \\(j − 1\\) 个区间中生存的概率的乘积，因此生存函数的生命表估计由下式给出 \\[\\begin{equation} S^*(t)=\\prod_{i=1}^{j-1}\\left(\\frac{n_i&#39;-d_i}{n_i&#39;}\\right) \\tag{2.3} \\end{equation}\\] 其中 \\(t&#39;_{j-1}\\leqslant t&lt;t&#39;_j,j=2,3,\\ldots,m\\). 在第一个区间 \\(t&#39;_0\\) 开始之后的生存概率估计当然是 1，而在 \\(t&#39;_m\\) 之外的生存概率估计为 0. 生存函数的图形估计将是一个阶跃函数，在每个时间区间内函数值恒定。 示例 2.2 (多发性骨髓瘤患者的生存情况) 为了说明生命表估计值的计算，请考虑表 1.3 中给出的 48 名多发性骨髓瘤患者的生存时间数据。在此示例中，将忽略为每个个体收集的关于其他解释变量的信息。 首先对生存时间进行分组，得出研究前五年和随后三年的死亡患者人数 \\(d_j\\) 和删失人数 \\(c_j\\). 然后计算每个区间开始时处于死亡风险的人数 \\(n_j\\)，以及调整后的处于风险数 \\(n′_j\\). 最后，估计每个区间的生存概率，使用式 (2.3) 获得生存函数估计。计算如表 2.1 所示，其中时间段以月为单位。第 \\(j\\) 个区间从时间 \\(t^\\prime_{j−1}\\) 开始，在时间 \\(t^\\prime_{j}\\) 之前结束，表示为 \\(t_{j−1}^{\\prime}-\\)，其中 \\(j=1,2,\\cdots,m\\)。 表 2.1 生存函数的生命表估计图如图 2.2 所示。 图 2.2 使用这种方法得到的生存函数估计的形式对其构造中使用的区间选择很敏感，正如直方图的形状取决于类别区间的选择一样。另一方面，生命表估计特别适用于实际死亡时间未知的情况，这时唯一可用的信息是在一系列连续时间区间内发生的死亡数和删失观测数。在实践中，这种区间删失的生存数据相当常见。 当实际生存时间已知时，仍然可以使用生命表估计，如例 2.2 所示，但生存时间的分组确实会导致一些信息丢失。使用其他方法来估计生存函数会更为合适，例如生存函数的 Kaplan-Meier 估计。 2.1.2 生存函数的 Kaplan-Meier 估计 分析未分组的删失生存数据的第一步通常是获得生存函数的 Kaplan-Meier 估计。因此，这一估计是经过详细考虑的。为了获得 Kaplan-Meier 估计，需要构建一系列时间区间，就像生命表估计一样。然而，每个这样的区间都被设计成只包含一个死亡时间，且这个死亡时间被认为发生在该区间的开始时刻。 作为说明，假设 \\(t_{(1)},t_{(2)}, t_{(3)}\\) 是按秩次 (rank order) 排列的三个生存时间，即 \\(t_{(1)}&lt;t_{(2)}&lt;t_{(3)}\\)，并且 \\(c\\) 是介于 \\(t_{(2)}\\) 和 \\(t_{(3)}\\) 之间的删失生存时间。然后，构建的区间从时间 \\(t_{(1)},t_{(2)}\\) 和 \\(t_{(3)}\\) 开始，每个区间包含一个死亡时间，尽管在任何特定死亡时间可能有多个个体死亡。请注意，没有区间从删失时间 \\(c\\) 开始。现在假设有 2 个人在 \\(t_{(1)}\\) 死亡，1 个人在 \\(t_{(2)}\\) 死亡，3 个人在 \\(t_{(3)}\\) 死亡。如图 2.3 所示，其中 D 代表死亡，C 代表删失生存时间。 图 2.3 时间起点用 \\(t_0\\) 表示，因此有一个从 \\(t_0\\) 开始的初始时间段，在 \\(t_{(1)}\\)（第一次死亡时间）之前结束。这意味着从 \\(t_0\\) 到 \\(t_{(1)}\\) 的区间将不包括死亡时间。第一个构造的区间的范围从 \\(t_{(1)}\\) 延伸到 \\(t_{(2)}\\) 之前，并且由于第二次死亡时间为 \\(t_{(2)}\\)，因此该区间包括 \\(t_{(1)}\\) 处的单个死亡时间。第二个区间从时间 \\(t_{(2)}\\) 开始，在 \\(t_{(3)}\\) 之前结束，包括 \\(t_{(2)}\\) 处的死亡时间和删失时间 \\(c\\)。还有从 \\(t_{(3)}\\) 开始的第三个区间，其中包含最长的生存时间 \\(t_{(3)}\\)。 一般来说，假设有 \\(n\\) 个个体，生存时间为 \\(t_1, t_2,...,t_n\\)。其中一些观测可能是右删失的，并且也可能有多个个体具有相同的生存时间。因此，我们假设个体中有 \\(r\\) 个死亡时间，其中 \\(r \\le n\\)。将这些死亡时间按升序排列后，第 \\(j\\) 个死亡时间记为 \\(t_{(j)}\\)，其中 \\(j = 1, 2,...,r\\)，因此 \\(r\\) 个死亡时间依次为 \\(t_{(1)} &lt; t_{(2)} &lt; \\cdots &lt; t_{(r)}\\)。在时间 \\(t_{(j)}\\) 之前还存活的个体数量，包括此时即将死亡的个体数量，表示为 \\(n_j\\)，并且 \\(d_j\\) 表示此时死亡的数量，其中 \\(j = 1, 2,...,r\\)。从 \\(t_{(j)} − \\delta\\) 到 \\(t_{(j)}\\) 的时间区间（其中 \\(\\delta\\) 是无穷小的时间区间）包含一次死亡时间。由于在 \\(t_{(j)}\\) 之前有 \\(n_j\\) 个个体还存活，并且在 \\(t_{(j)}\\) 时有 \\(d_j\\) 个个体死亡，因此个体在 \\(t_{(j)} − \\delta\\) 到 \\(t_{(j)}\\) 的时间区间内死亡的概率估计为 \\(d_j/n_j\\)。在该时间区间内相应的生存概率估计为 \\((n_j − d_j )/n_j\\)。 有时删失生存时间与一个或多个死亡时间同时出现的情况，导致死亡时间和删失生存时间看似同时发生。在这种情况下计算 \\(n_j\\) 值时，删失生存时间视为在死亡时间之后立即发生。 从构建时间区间的方式来看，从 \\(t_{(j)}\\) 到 \\(t_{(j+1)} − \\delta\\)（下一次死亡时间之前）的区间不包含任何死亡。因此，从 \\(t_{(j)}\\) 到 \\(t_{(j+1)} − \\delta\\) 的生存概率为 1，并且从 \\(t_{(j)}-\\delta\\) 到 \\(t_{(j)}\\) 以及从 \\(t_{(j)}\\) 到 \\(t_{(j+1)} − \\delta\\) 的联合生存概率可估计为 \\((n_j − d_j )/n_j\\)。当 \\(\\delta\\) 趋于零时，\\((n_j − d_j )/n_j\\) 就是 \\(t_{(j)}\\) 到 \\(t_{(j+1)}\\) 区间的生存概率估计。 我们现在假设样本中个体的死亡是相互独立发生的。那么，在构造的第 \\(k\\) 个时间区间 \\([t_{(k)}, t_{(k+1)})\\)（其中 \\(k=1, 2,...,r\\)，且 \\(t_{(r+1)}\\) 定义为 \\(\\infty\\)）中的任意时间 \\(t\\) 处生存函数的估计将是生存到 \\(t_{(k)}\\) 之后的概率的估计。这实际上是生存到 \\([t_{(k)}, t_{(k+1)})\\) 这个区间以及所有之前区间的概率，并由此得到 Kaplan-Meier 生存函数估计，其表达式为： \\[\\begin{equation} \\hat{S}(t)=\\prod_{j=1}^k\\left(\\frac{n_j-d_j}{n_j}\\right) \\tag{2.4} \\end{equation}\\] 其中 \\(t_{(k)}\\leqslant t&lt;t_{(k+1)},k=1,2,\\ldots,r\\)，对于 \\(t&lt;t_{(1)}\\) 有 \\(\\hat S(t)=1\\)，且 \\(t_{(r+1)}\\) 取 \\(\\infty\\)。如果最大的观测是删失生存时间 \\(t ^*\\)，则对于 \\(t &gt; t^*\\)，\\(\\hat S(t)\\) 是未定义的。另一方面，如果最大生存时间 \\(t_{(r)}\\) 是右删失观测，则 \\(n_r = d_r\\)，对于 \\(t \\ge t_{(r)}\\)，\\(\\hat S(t)\\) 为 0. 生存函数的 Kaplan-Meier 估计图是一个阶跃函数，其中生存概率估计在相邻死亡时间之间保持恒定，并在每个死亡时间减少。 式 (2.4) 表明，对于式 (2.3) 中生存函数的生命表估计，Kaplan-Meier 估计是由一系列概率估计的乘积得到的。事实上，Kaplan-Meier 估计是式 (2.3) 中生命表估计的极限值，因为区间数量趋于无穷大且宽度趋于零。因此，Kaplan-Meier 估计也称为生存函数的乘积极限估计 (product-limit estimate). 请注意，如果数据集中没有删失生存时间，则式 (2.4) 中的 \\(n_j − d_j = n_{j+1}, j = 1, 2,...,k\\)，并且展开乘积可以得到 \\[\\hat{S}(t)=\\frac{n_2}{n_1}\\times\\frac{n_3}{n_2}\\times\\cdots\\times\\frac{n_{k+1}}{n_k}\\] 对于 \\(k = 1, 2,...,r − 1\\)，这可简化为 \\(n_{k+1}/n_1\\)。对于 \\(t&lt;t_{(1)}\\) 有 \\(\\hat S(t) = 1\\)；对于 \\(t \\ge t_{(r)}\\) 有 \\(\\hat S(t) = 0\\)。现在，\\(n_1\\) 是在第一次死亡时间之前处于风险中的个体数量，即样本的个体数量，\\(n_{k+1}\\) 是生存时间大于等于 \\(t_{(k+1)}\\) 的个体数量。因此，在没有删失的情况下，\\(\\hat S(t)\\) 只是式 (2.1) 中定义的经验生存函数。因此，Kaplan-Meier 估计是经验生存函数的推广，该函数用于适应删失观测。 示例 2.3 (停用宫内节育器的时间) 表 1.1 给出了 18 名妇女停用宫内节育器的时间数据。对于这些数据，生存函数 \\(S(t)\\) 表示妇女在任何时间 \\(t\\) 后停用避孕装置的概率。使用式 (2.4) 可以很容易地获得生存函数的 Kaplan-Meier 估计，所需的计算如表 2.2 所示。 表 2.2 生存函数估计如图 2.4 所示。请注意，由于最大停用时间 107 天是删失的，因此在 \\(t=107\\) 之后无法定义 \\(\\hat S(t)\\)。 图 2.4 2.1.3 生存函数的 Nelson-Aalen 估计 基于单个事件时间生存函数的另一种估计是 Nelson-Aalen 估计，由下式给出 \\[\\begin{equation} \\tilde{S}(t)=\\prod_{j=1}^k\\exp(-d_j/n_j) \\tag{2.5} \\end{equation}\\] 如第 2.3.3 节所示，可以从累积风险函数估计中获得该估计。此外，生存函数的 Kaplan-Meier 估计可以看作是 Nelson-Aalen 估计的近似。为了证明这一点，利用如下结果 \\[\\begin{aligned}e^{-x}&amp;=1-x+\\frac{x^2}{2}-\\frac{x^3}{6}+\\cdots\\end{aligned}\\] 当 \\(x\\) 很小时，该式近似于 \\(1−x\\)。因此只要 \\(d+j\\) 相对于 \\(n_j\\) 很小（除非在最长的生存时间），就有 \\(\\exp ({-d_j/n_j})\\approx1-(d_j/n_j)=(n_j-d_j)/n_j\\)。因此，式 (2.4) 中的 Kaplan-Meier 估计 \\(\\hat S(t)\\) 近似于式 (2.5) 中的 Nelson-Aalen 估计 \\(\\tilde S(t)\\)。 生存函数的 Nelson-Aalen 估计，也称为 Altshuler 估计，在任何给定时间都始终大于 Kaplan-Meier 估计，因为对于 \\(x\\) 的所有值，\\(e−x\\ge 1−x\\)。尽管已证明 Nelson-Allen 估计在小样本中比 Kaplan-Meiser 估计表现更好，但在许多情况下，估计值将非常相似，特别是在较早的生存时间。由于 Kaplan-Meier 估计是经验生存函数的一般形式，因此具有许多值得推荐的地方。 示例 2.4 (停用宫内节育器的时间) 表 2.2 所示的值给出了停用宫内节育器数据的生存函数的 Kaplan-Meier 估计，可用于计算 Nelson-Aalen 估计。这一估计如表 2.3 所示。 表 2.3 从该表中我们可以看出，Kaplan-Meier 和 Nelson-Aalen 对生存函数的估计相差小于 0.04。然而，当我们在第 2.2 节中考虑这些估计的精度时，我们发现 0.04 的差异没有实际意义。 2.2 生存函数估计的标准误 解释任何量的估计的重要辅助手段是估计的精度，这反映在估计的标准误中。其定义为估计的方差估计的平方根，并且可用于构造感兴趣的量的区间估计。本节给出了生存函数估计的标准误。 由于 Kaplan-Meier 估计是生存函数最重要和最广泛使用的估计，因此本节将详细介绍 \\(\\hat S(t)\\) 标准误的推导。这种推导的细节可以在第一次阅读时省略。 2.2.1 Kaplan-Meier 估计的标准误 对于 \\([t_{(k)},t_{(k+1)})\\) 区间中的任何 \\(t\\) 值，生存函数的 Kaplan-Meier 估计可以写为 \\[\\begin{aligned}\\hat{S}(t)=\\prod_{j=1}^k\\hat{p}_j\\end{aligned}\\] 其中 \\(k=1,2,\\cdots,r\\)，\\(\\hat p_j=(n_j−d_j)/n_j\\) 是个体在开始于 \\(t_{(j)}\\) 的时间区间内生存的概率估计，\\(j=1,2,\\cdots,r\\)。取对数 \\[\\log\\hat{S}(t)=\\sum_{j=1}^k\\log\\hat{p}_j\\] 因此 \\(\\log \\hat S(t)\\) 的方差由下式给出 \\[\\begin{equation} \\text{var }\\left\\{\\log\\hat{S}(t)\\right\\}=\\sum_{j=1}^k\\text{ var }\\left\\{\\log\\hat{p}_j\\right\\} \\tag{2.6} \\end{equation}\\] 现在，可以假设在开始于 \\(t_{(j)}\\) 的区间中生存的个体数量服从参数为 \\(n_j\\) 和 \\(p_j\\) 的二项分布 (binomial distribution)，其中 \\(p_j\\) 是在该区间中生存的真实概率。生存数为 \\(n_j−d_j\\)，利用参数为 \\(n,p\\) 的二项随机变量的方差为 \\(np(1−p)\\) 这一结果，\\(n_j−d_j\\) 的方差由下式给出 \\[\\text{var}\\,\\,(n_j-d_j)=n_jp_j(1-p_j)\\] 由于 \\(\\hat p_j=(n_j-d_j)/n_j\\)，\\(\\hat p_j\\) 的方差为 \\(\\text{var}\\,(n_j-d_j)/n_j^2\\)，即 \\(p_j(1-p_j)/n_j\\)。那么 \\(\\hat p_j\\) 的方差可估计为 \\[\\begin{equation} \\hat p_j(1-\\hat p_j)/n_j \\tag{2.7} \\end{equation}\\] 为了获得 \\(\\log \\hat p_j\\) 的方差，我们需利用随机变量函数近似方差的一般结果。根据这个结果，随机变量 \\(X\\) 的函数 \\(g(X)\\) 的方差由下式给出 \\[\\begin{equation} \\text{var }\\{g(X)\\}\\approx\\left\\{\\frac{\\text{d}g(X)}{\\text{d}X}\\right\\}^2\\text{ var}\\left(X\\right) \\tag{2.8} \\end{equation}\\] 这称为随机变量函数方差的泰勒级数近似 (Taylor series approximation). 使用式 (2.8)，\\(\\log \\hat p_j\\) 的近似方差为 \\(\\mathrm{var}\\left(\\hat{p}_j\\right)/\\hat{p}_j^2\\)，再使用式 (2.7)，\\(\\log \\hat p_j\\) 的近似方差为 \\(\\left(1-\\hat{p}_j\\right)/\\left(n_j\\hat{p}_j\\right)\\)，替换 \\(\\hat p_j\\) 后简化为 \\[\\begin{equation} \\frac{d_j}{n_j(n_j-d_j)} \\tag{2.9} \\end{equation}\\] 那么，根据式 (2.6) \\[\\begin{equation} \\text{var }\\left\\{\\log\\hat{S}(t)\\right\\}\\approx\\sum_{j=1}^k\\frac{d_j}{n_j(n_j-d_j)} \\tag{2.10} \\end{equation}\\] 再次应用式 (2.8) 中的结果，给出 \\[\\text{var }\\left\\{\\log\\hat{S}(t)\\right\\}\\approx\\frac{1}{[\\hat{S}(t)]^2}\\text{var }\\left\\{\\hat{S}(t)\\right\\}\\] 因此 \\[\\begin{equation} \\text{var }\\left\\{\\hat{S}(t)\\right\\}\\approx[\\hat{S}(t)]^2\\sum_{j=1}^k\\frac{d_j}{n_j(n_j-d_j)} \\tag{2.11} \\end{equation}\\] 最后，生存函数的 Kaplan-Meier 估计的标准误，定义为估计的方差估计的平方根，由下式给出 \\[\\begin{equation} \\text{se }\\left\\{\\hat{S}(t)\\right\\}\\approx\\hat{S}(t)\\left\\{\\sum_{j=1}^k\\frac{d_j}{n_j(n_j-d_j)}\\right\\}^{\\frac{1}{2}} \\tag{2.12} \\end{equation}\\] 其中 \\(t_{(k)}\\le t&lt;t_{(k+1)}\\)。这个结果称为 Greenwood 公式。 如果没有删失生存时间，则 \\(n_j-d_j=n_{j+1}\\)，式 (2.9) 成为 \\((n_j-n_{j+1})/n_jn_{j+1}\\)。现在 \\[\\begin{aligned}\\sum_{j=1}^k\\frac{n_j-n_{j+1}}{n_jn_{j+1}}&amp;=\\sum_{j=1}^k\\left(\\frac{1}{n_{j+1}}-\\frac{1}{n_j}\\right)=\\frac{n_1-n_{k+1}}{n_1n_{k+1}}\\end{aligned}\\] 在无删失时，对于 \\(t_{(k)}\\le t&lt;t_{(k+1)},k=1,2,\\cdots,r-1\\) 有 \\(\\hat S(t)=n_{k+1}/n_1\\)，因此上式可写作 \\[\\frac{1-\\hat S(t)}{n_1\\hat S(t)}\\] 因此，根据式 (2.11)，\\(\\hat S(t)\\) 的方差估计为 \\(\\hat{S}(t)[1-\\hat{S}(t)]/n_1\\)。这是式 (2.1) 中给出的经验生存函数方差的估计，其假设在时间 \\(t\\) 处于风险中的个体数量服从参数为 \\(n_1,S(t)\\) 的二项分布。 2.2.2 其他估计的标准误 生存函数的生命表估计在形式上类似于 Kaplan-Meier 估计，因此该估计的标准误是以类似的方式获得的。沿用 2.1.1 节的记号，生命表估计的标准误由下式给出 \\[\\text{se }\\left\\{S^*(t)\\right\\}\\approx S^*(t)\\left\\{\\sum_{j=1}^k\\frac{d_j}{n_j^\\prime(n_j^\\prime-d_j)}\\right\\}^{\\frac{1}{2}}\\] Nelson-Aalen 估计的标准误为 \\[\\text{se }\\left\\{\\tilde{S}(t)\\right\\}\\approx\\tilde{S}(t)\\left\\{\\sum_{j=1}^k\\frac{d_j}{n_j^2}\\right\\}^{\\frac12}\\] 但也存在其他表达式。 2.2.3 生存函数的置信区间 一旦计算出生存函数的的标准误估计，就可以找到生存函数在给定时间 \\(t\\) 处的置信区间。置信区间是生存函数的区间估计，其以预设的概率包含真实生存函数值。以这种方式构建的区间有时称为逐点置信区间 (pointwise confidence intervals)，因为它们适用于特定的生存时间。 通过在给定时间 \\(t\\) 假设生存函数的估计服从均值为 \\(S(t)\\)，方差由式 (2.11) 给出的正态分布，我们可以获得生存函数在 \\(t\\) 时刻真实值的置信区间。该区间是根据标准正态分布的百分位点计算得出的。因此，如果 \\(Z\\) 是一个具有标准正态分布的随机变量，则该分布的上（单侧）\\(\\alpha/2\\) 分位点或双侧 \\(\\alpha\\) 分位点为 \\(z_{\\alpha/2}\\)，满足 \\(\\text P(Z&gt;z_{\\alpha/2})=\\alpha/2\\)。该概率是标准正态曲线在下 \\(z_{\\alpha/2}\\) 右侧的面积，如图 2.5 所示。例如，标准正态分布的双侧 5% 和 1% 分位点 \\(z_{0.025}\\) 和 \\(z_{0.005}\\) 分别为 1.96 和 2.58. 图 2.5 对于给定的 \\(t\\) 值，\\(S(t)\\) 的 \\(100(1−\\alpha)\\%\\) 置信区间为 \\(\\left[\\hat S(t)-z_{\\alpha/2}\\,\\text{se}\\,\\{\\hat S(t)\\},\\,\\,\\hat S(t)+z_{\\alpha/2}\\,\\text{se}\\,\\{\\hat S(t)\\}\\right]\\)，其中，\\(\\text{se}\\,\\{\\hat S(t)\\}\\) 可根据式 (2.12) 得出。\\(S(t)\\) 的这些区间可以叠加在生存函数估计的图中，如示例 2.5 所示。 该方法的问题在于其置信区间是对称的。当生存函数估计接近 0 或 1 时，对称区间是不合适的，因为它们可能导致生存函数的置信区间超出 (0, 1) 区间。一个务实的解决方案是将任何大于 1 的上限替换为 1.0，将任何小于 0 的下限替换为 0.0. 另一种方法是先将 \\(\\hat S(t)\\) 转换为 \\((−\\infty, \\infty)\\) 范围内的一个值，然后为转换后的值获得一个置信区间。接着，将得到的置信区间反向转换，以给出 \\(S(t)\\) 本身的置信区间。可能的转换方法包括 logistic 转换，即 \\(\\log[S(t)/\\{1 − S(t)\\}]\\)，以及互补对数对数 (complementary log-log) 转换，即 \\(\\log\\{− \\log S(t)\\}\\)。注意到，根据式 (1.8)，后一个量是累积风险函数的对数。在任何情况下，都可以使用式 (2.8) 中的近似来获得 \\(\\hat S(t)\\) 转换值的标准误。 例如，\\(\\log\\{-\\log\\hat{S}(t)\\}\\) 的方差是从式 (2.10) 中 \\(\\text{var}\\left\\{\\log\\hat{S}(t)\\right\\}\\) 的表达式获得的。使用式 (2.8) 中的一般结果， \\[\\mathrm{var}\\left\\{\\log(-X)\\right\\}\\approx\\frac1{X^2}\\operatorname{var}\\left(X\\right)\\] 令 \\(X=\\log\\hat{S}(t)\\) 得到 \\[\\begin{aligned}\\text{var }\\left[\\log\\{-\\log\\hat{S}(t)\\}\\right]\\approx\\frac1{\\{\\log\\hat{S}(t)\\}^2}\\sum_{j=1}^k\\frac{d_j}{n_j(n_j-d_j)}\\end{aligned}\\] \\(\\log\\{-\\log\\hat{S}(t)\\}\\) 的标准误为此量的平方根，得到如下形式的 \\(100(1 − \\alpha)\\%\\) 置信限 \\[\\hat{S}(t)^{\\exp[\\pm z_{\\alpha/2}\\operatorname{se}\\{\\log[-\\log\\hat{S}(t)]\\}]}\\] 其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。 进一步的问题是，在生存时间分布的尾部，即当 \\(\\hat S(t)\\) 接近于 0 或 1 时，使用 Greenwood 公式获得的 \\(\\hat S(t)\\) 的方差可能会低估实际方差。在这些情况下，可以使用 \\(\\hat S(t)\\) 标准误的替代表达式。Peto et al. (1977) 提出 \\(\\hat S(t)\\) 的标准误应根据下式获得 \\[\\text{se}\\left\\{\\hat{S}(t)\\right\\}=\\frac{\\hat{S}(t)√\\{1-\\hat{S}(t)\\}}{√(n_k)}\\] 其中 \\(t_{(k)}\\leqslant t&lt;t_{(k+1)},k=1,2,\\ldots,r,\\hat S(t)\\) 为 \\(S(t)\\) 的 Kaplan-Meier 估计，\\(n_k\\) 为在 \\(t_{(k)}\\) 处于风险的个体数，\\(t_{(k)}\\) 为第 \\(k\\) 个构造区间的起点。 \\(\\hat S(t)\\) 标准误的这种表达式是保守的，因为获得的标准误往往会大于应有的值。因此，建议一般使用 Greenwood 估计。 示例 2.5 (停用宫内节育器的时间) 表 2.4 给出了例 1.1 中关于停用宫内节育器时间数据的生存函数估计的标准误以及该函数相应真值的 95% 置信限。在此表中，位于范围 (0, 1) 之外的置信限已替换为 0 或 1. 表 2.4 从该表中我们可以看出，一般来说，生存函数估计的标准误随着停止时间的增加而增加。这是因为晚期生存函数是基于较少个体来估计的。图 2.6 给出了生存函数估计图，其中 95% 置信限显示为虚线。 图 2.6 需要注意的是，图 2.6 中所示生存函数的置信限仅对给定时间有效。需要不同的方法来生成置信带 (confidence bands)，使得生存函数对于所有 \\(t\\) 值以给定概率（例如 0.95）包含在带中。这些置信带通常会比由逐点置信限形成的带更宽。不再赘述细节，但本章最后一节会给出这些方法的参考文献。还要注意，这些区间的宽度远大于生存函数的 Kaplan-Meier 和 Nelson-Aalen 估计之间的差异，如表 2.2 和 2.3 所示。基于生命表和生存函数 Nelson-Aalen 估计的置信限可通过类似计算获得。 2.3 估计风险函数 单个生存数据样本也可使用风险函数进行总结，该函数显示了瞬时死亡风险与时间之间的依赖关系。有多种方法可以估计该函数，本节将描述其中的两种方法。 2.3.1 风险函数的生命表估计 假设生存时间已被划分成一系列 \\(m\\) 个区间，就像在构建生存函数生命表估计时那样。在每个区间内，单位时间内平均死亡风险合适的估计是该区间内死亡人数除以该区间内平均生存时间。后者是区间内平均风险人数的乘积，再乘以区间的长度。设第 \\(j\\) 个时间区间内的死亡人数为 \\(d_j,j=1,2,\\cdots,m\\)，并假设 \\(n^\\prime_j\\) 是该时间区间内面临死亡风险的平均人数，其中 \\(n^\\prime_j\\) 由式 (2.2) 给出。假设第 \\(j\\) 个时间区间内死亡率恒定，则该时间区间内的平均生存时间为 \\((n^\\prime_j-d_j/2)\\tau_j\\)，其中 \\(\\tau_j\\) 是第 \\(j\\) 个时间区间的长度。第 \\(j\\) 个时间区间内风险函数的生命表估计由下式给出 \\[\\begin{aligned}h^*(t)&amp;=\\frac{d_j}{(n_j^\\prime-d_j/2)\\tau_j}\\end{aligned}\\] 其中 \\(t&#39;_{j-1}\\leqslant t&lt;t&#39;_j,j=1,2,\\ldots,m\\)，因此 \\(h^*(t)\\) 是阶跃函数。 Gehan (1969) 表明该估计的渐近标准误为 \\[\\begin{aligned}\\text{se}\\left\\{h^*(t)\\right\\}&amp;=\\frac{h^*(t)\\surd\\{1-[h^*(t)\\tau_j/2]^2\\}}{\\surd(d_j)}\\end{aligned}\\] \\(m\\) 个时间区间中每个时间区间内相应真实风险的置信区间可以按照 2.2.3 节中描述的方式获得。 示例 2.6 (多发性骨髓瘤患者的生存) 表 2.1 给出了示例 1.3 中 48 名多发性骨髓瘤患者生存时间数据生存函数的生命表估计。使用与示例 2.2 中相同的时间区间，表 2.5 中给出了风险函数生命表估计的计算结果。 表 2.5 风险函数估计如图 2.7 所示，为阶跃函数。一般的模式是，在确诊后的头两年内，风险大致保持不变，之后风险会下降，然后逐渐增加。然而，在解释这一估计时需要谨慎，因为确诊两年后很少有人死亡。 图 2.7 2.3.2 Kaplan-Meier 型估计 对于未分组的生存数据，估计风险函数的一种自然方法是，将给定死亡时间的死亡人数与该时间点处于风险的人数之比作为风险函数的估计。如果假设相邻死亡时间之间的风险函数是恒定的，那么可进一步通过将风险值除以时间区间的长度来找到单位时间的风险。因此，如果在第 \\(j\\) 个死亡时间 \\(t_{(j)}\\) 有 \\(d_j\\) 人死亡，\\(j=1,2,...,r\\)，且在时间 \\(t_{(j)}\\) 处于风险的人数为 \\(n_j\\)，那么区间 \\([t_j,t_{(j+1)})\\) 内的风险函数的估计为： \\[\\begin{equation} \\hat{h}(t)=\\frac{d_j}{n_j\\tau_j} \\tag{2.13} \\end{equation}\\] 其中 \\(t_j\\le t&lt;t_{(j+1)},\\tau_j=t_{(j+1)}-t_j\\)。请注意，无法使用式 (2.13) 来估计以最终死亡时间为起点的区间的风险，因为该区间是开的 (open-ended)。 式 (2.13) 中的估计称为 Kaplan-Meier 型估计，因为从中得出的生存函数估计为 Kaplan-Meier 估计。为了证明这一点，请注意，由于 \\(\\hat{h}(t),t_{(j)}\\leqslant t&lt;t_{(j+1)}\\) 是对第 \\(j\\) 个区间中每单位时间的死亡风险的估计，因此该区间中的死亡概率为 \\(\\hat{h}(t)\\tau_j\\)，即 \\(d_j/n_j\\)。因此，该区间中相应生存概率的估计为 \\(1−(d_j/n_j)\\)，生存函数估计如式 (2.4) 所示。 可以根据 \\(d_j\\) 的方差得到 \\(\\hat h(t)\\) 的近似标准误，根据 2.2.1 节，可以假设 \\(d_j\\) 服从参数为 \\(n_j,p_j\\) 的二项分布，其中 \\(p_j\\) 是长度为 \\(\\tau\\) 的区间内的死亡概率。因此 \\(\\text{var}\\left(d_j\\right)=n_jp_j\\left(1-p_j\\right)\\)，使用 \\(d_j/n_j\\) 估计 \\(p_j\\)，从而给出 \\[\\text{se}\\left\\{\\hat{h}(t)\\right\\}=\\hat{h}(t)\\sqrt{\\frac{n_j-d_j}{n_jd_j}}\\] 然而当 \\(d_j\\) 很小时，使用该标准误构建的置信区间太宽，实际无法使用。 示例 2.7 (停用宫内节育器的时间) 再次考虑示例 1.1 中给出的 18 名妇女停用宫内节育器的时间数据。表 2.2 给出了这些数据的生存函数的 Kaplan-Meier 估计，表 2.6 给出了根据式 (2.13) 计算的风险函数的相应 Kaplan-Meier 型估计。还给出了 \\(\\hat h(t)\\) 的近似标准误。 表 2.6 图 2.8 显示了风险函数估计图。从这个图像来看，有一些证据表明，宫内节育器使用的时间越长，停用的风险就越大，但情况并不十分清楚。风险函数估计在不同时间的近似标准误对解释该图几乎没有帮助。 图 2.8 在实践中，通过这种方式获得的风险函数估计往往会相当不规则。因此，可以对风险函数图进行“平滑” (smoothed) 处理，以便更清楚地看到任何模式。有多种方法可以平滑风险函数，这些方法会得到在 \\(t\\) 邻域内的死亡时间点上估计风险函数 \\(\\hat h(t)\\) 的加权平均值。例如，基于 \\(r\\) 个有序的死亡时间 \\(t_{(1)}, t_{(2)},...,t_{(r)}\\)，在时间 \\(t_{(j)}\\) 有 \\(d_j\\) 人死亡以及 \\(n_j\\) 人处于风险中，可以通过以下方式找到基于核函数平滑的风险函数估计： \\[h^\\dagger(t)=b^{-1}\\sum_{j=1}^r0.75\\left\\{1-\\left(\\frac{t-t_{(j)}}{b}\\right)^2\\right\\}\\frac{d_j}{n_j}\\] 其中 \\(b\\) 的值需要选择。函数 \\(h^\\dagger (t)\\) 定义在从 \\(b\\) 到 \\(t_{(r)}−b\\) 区间所有的 \\(t\\) 值上，其中 \\(t_{(r)}\\) 是最大的死亡时间。对于这个区间内的任何 \\(t\\) 值，区间 \\((t−b,t+b)\\) 内的死亡时间都会对该加权平均值有所贡献。参数 \\(b\\) 称为带宽 (bandwidth)，其值控制着图形的形状；\\(b\\) 的值越大，平滑程度就越高。有公式可以导出“最优”的 \\(b\\) 值，但这些公式往往相当繁琐。有关详情可以在本章最后一节提供的参考文献中找到。在本书中，我们提倡使用建模方法分析生存数据，因此，后续章节将考虑基于模型的风险函数估计。 2.3.3 估计累积风险函数 如第 1 章 1.4.3 节所述，根据在给定时间内发生的预期事件数对累积风险函数进行解释，该函数在识别生存数据模型方面很重要，这将在 4.4 节和 5.2 节中看到。此外，由于累积风险函数的导数是风险函数本身，因此累积风险函数斜率提供了有关潜在风险函数形状的信息。例如，在某个时间区间内的线性累积风险函数表明，风险在该时间区间内是恒定的。现在描述可用于估计该函数的方法。 时间 \\(t\\) 的累积风险 \\(H(t)\\) 在式 (1.7) 中定义为风险函数的积分，但使用式 (1.8) 来求解更为简便。根据这一结果，我们有 \\(H(t) = -\\log S(t)\\)，其中 \\(S(t)\\) 表示生存函数，即在时间 \\(t\\) 仍然生存的概率。 现在使用式 (2.4) \\[\\begin{aligned}\\hat{H}(t)&amp;=-\\sum_{j=1}^k\\log\\left(\\frac{n_j-d_j}{n_j}\\right)\\end{aligned}\\] 其中 \\(t_{(k)}\\leqslant t&lt;t_{(k+1)},k=1,2,\\ldots,r\\) 且 \\(t_{(1)},t_{(2)},\\ldots,t_{(r)}\\) 为 \\(t\\) 个有序的死亡时间且 \\(t_{(r+1)}=\\infty\\)。 若使用风险函数的 Nelson-Aalen 估计，则累积风险函数估计 \\(\\tilde{H}(t)=-\\log\\tilde{S}(t)\\) 由下式给出 \\[\\begin{aligned}\\tilde{H}(t)=\\sum_{j=1}^k\\frac{d_j}{n_j}\\end{aligned}\\] 这是从第一个时间区间到第 \\(k\\) 个时间区间的死亡概率估计的累积和，\\(k=1,2,\\ldots r\\)。 因此，这个量作为累积风险的估计是直观的。 如果数据中最长的生存时间是右删失的，则生存函数的 Kaplan-Meier 估计在该时间之后为 0，并且无法确定 \\(\\hat{H}(t)=-\\operatorname{log}\\hat{S}(t)\\) 的值。然而，当使用 Nelson-Aalen 估计 \\(\\tilde H(t)\\) 时，可以在最晚的事件时间估计累积风险函数。 对累积风险函数的估计也可以推导出相应风险函数的估计，因为将估计的累积风险函数相邻值之差除以时间区间长度后，就能得到风险估计。具体来说，Nelson-Aalen 累积风险估计相邻值之差可以直接推导出 2.3.2 节中风险函数的估计。 2.4 估计生存时间的中位数和百分位数 由于生存时间的分布往往呈正偏态，因此中位数是分布位置首选的总结性度量。一旦估计了生存函数，就可以直接获得中位生存时间的估计。这是所研究总体中 50% 的个体预期生存的时间，由值 \\(t{(50)}\\) 给出，即 \\(S\\{t(50)\\} = 0.5\\)。 因为 \\(S(t)\\) 的非参数估计是阶跃函数，所以通常无法得到使生存函数恰好等于 0.5 的生存时间估计。相反，中位生存时间估计 \\(\\hat t (50)\\) 定义为生存函数估计小于 0.5 的最小观测生存时间。 在数学形式上 \\[\\begin{aligned}\\hat{t}(50)=\\min\\{t_i\\mid\\hat{S}(t_i)&lt;0.5\\}\\end{aligned}\\] 其中 \\(t_i\\) 是第 \\(i\\) 个个体的生存时间，\\(i=1,2,\\ldots,n\\)。由于生存函数估计只在死亡时发生变化，这相当于定义 \\[\\begin{aligned}\\hat{t}(50)=\\min\\{t_{(j)}\\mid\\hat{S}(t_{(j)})&lt;0.5\\}\\end{aligned}\\] 其中 \\(t_{(j)}\\) 为第 \\(j\\) 个死亡时间，\\(j=1,2,\\ldots,r\\)。 在特定情况下，当生存函数估计在 \\(t_{(j)}\\) 到 \\(t_{(j+1)}\\) 的区间内的值恰好等于 0.5 时，中位数取该区间的中点，即 \\((t_{(j)} + t_{(j+1)})/2\\)。当不存在删失生存时间时，中位生存时间估计将是样本中超过 50% 的个体能够生存的最短时间。 示例 2.8 (停用宫内节育器的时间) 表 2.2 中给出了示例 1.1 中关于停用宫内节育器时间数据生存函数的 Kaplan-Meier 估计。这些数据的生存函数估计，\\(\\hat S(t)\\)，示于图 2.4 中。根据生存函数估计，停用概率估计小于 0.5 的最小停用时间为 93 周。因此，这是该研究中停用宫内节育器的中位时间估计。 图 2.4 可以使用与上述描述类似的方法来估计生存时间分布的其他百分位数。生存时间分布的第 \\(p\\) 个百分位数定义为值 \\(t(p)\\)，使得对于 0 到 100 之间的任何 \\(p\\) 值有 \\(F\\{t(p)\\} = p/100\\)。就生存函数而言，\\(t(p)\\) 是使得 \\(S\\{t(p)\\} = 1 − (p/100)\\) 的值，因此第 10 和第 90 百分位数由下式给出： \\[\\begin{aligned}S\\{t(10)\\}=0.9,\\quad S\\{t(90)\\}=0.1\\end{aligned}\\] 利用生存函数估计，第 \\(p\\) 个百分位数的估计是最小的观测生存时间 \\(\\hat t (p)\\)，其满足 \\(\\hat S\\{\\hat t(p)\\} &lt; 1 − (p/100)\\)。 有时，对于所有的 \\(t\\) 值，生存函数估计都大于 0.5，此时无法估计中位生存时间，因此自然会用生存时间分布的其他百分位数或特定时间点的生存概率估计来总结数据。 生存数据样本离散 (dispersion) 的估计并未广泛使用，但若需要这样的估计，则可以计算半四分位距 (semi-interquartile range, SIQR)。这定义为生存时间分布的第 75 百分位数和第 25 百分位数之差的一半。即 \\[\\begin{aligned}SIQR=\\frac{1}{2}\\left\\{t(75)-t(25)\\right\\}\\end{aligned}\\] 其中 \\(t(25)\\) 和 \\(t(75)\\) 是生存时间分布的第 25 个和第 75 个百分位数。这两个百分位数也分别称为第一个和第三个四分位数。相应的基于样本的 \\(SIQR\\) 估计为 \\(\\{\\hat{t}(75)-\\hat{t}(25)\\}/2\\)。与方差一样，\\(SIQR\\) 值越大，生存时间分布离散程度越大。 示例 2.9 (停用宫内节育器的时间) 根据表 2.2 中给出的示例 1.1 数据生存函数的 Kaplan-Meier 估计，停止时间分布的第 25 和第 75 百分位数分别为 36 周和 107 周。因此，分布的 \\(SIQR\\) 估计为 35.5 周。 表 2.2 2.5 中位数和百分位数的置信区间 一旦获得百分位数估计的方差，就可以得到生存时间分布的中位数和其他百分位数的近似置信区间。百分位数近似方差的表达式可以通过直接应用式 (2.8) 中随机变量函数方差的一般结果来导出。使用这个结果 \\[\\begin{equation} \\mathrm{var}\\left[\\hat{S}\\{t(p)\\}\\right]=\\left(\\frac{\\mathrm{d}\\hat{S}\\{t(p)\\}}{\\mathrm{d}t(p)}\\right)^2\\mathrm{var}\\left\\{t(p)\\right\\} \\tag{2.14} \\end{equation}\\] 其中 \\(t(p)\\) 是分布的第 \\(p\\) 个百分位数，\\(\\hat{S}\\{t(p)\\}\\) 是生存函数在 \\(t(p)\\) 处的 Kaplan-Meier 估计。现在 \\[-\\frac{\\mathrm{d}\\hat{S}\\{t(p)\\}}{\\mathrm{d}t(p)}=\\hat{f}\\{t(p)\\}\\] 为 \\(t(p)\\) 时生存时间的概率密度函数的估计，将其代入式 (2.14) 并整理后，我们得到 \\[\\mathrm{var}\\left\\{t(p)\\right\\}=\\left(\\frac1{\\hat{f}\\{t(p)\\}}\\right)^2\\mathrm{var}\\left[\\hat{S}\\{t(p)\\}\\right]\\] 因此，估计的第 \\(p\\) 个百分位数 \\(\\hat t(p)\\) 的标准误由下式给出 \\[\\begin{equation} \\mathrm{se}\\left\\{\\hat{t}(p)\\right\\}=\\frac1{\\hat{f}\\{\\hat{t}(p)\\}}\\operatorname{se}\\left[\\hat{S}\\{\\hat{t}(p)\\}\\right] \\tag{2.15} \\end{equation}\\] 使用式 (2.12) 中给出的生存函数 Kaplan-Meier 估计的标准误的 Greenwood 公式，可以得到 \\(\\hat{S}\\{t(p)\\}\\) 的标准误，而 \\(\\hat t(p)\\) 的概率密度函数的估计为 \\[\\hat{f}\\{\\hat{t}(p)\\}=\\frac{\\hat{S}\\{\\hat{u}(p)\\}-\\hat{S}\\{\\hat{l}(p)\\}}{\\hat{l}(p)-\\hat{u}(p)}\\] 其中 \\[\\begin{aligned}\\hat{u}(p)&amp;=\\max\\left\\{t_{(j)}\\mid\\hat{S}(t_{(j)})\\geqslant1-\\frac p{100}+\\epsilon\\right\\}\\\\\\hat{l}(p)&amp;=\\min\\left\\{t_{(j)}\\mid\\hat{S}(t_{(j)})\\leqslant1-\\frac p{100}-\\epsilon\\right\\}\\end{aligned}\\] 其中 \\(j=1,2,\\ldots,r\\) 和较小的 \\(\\varepsilon\\) 值。在许多情况下，取 \\(\\varepsilon=0.05\\) 可满足要求，但如果事实证明 \\(\\hat u(p)\\) 和 \\(\\hat l(p)\\) 相等，则需要更大的 \\(\\varepsilon\\) 值。特别地，根据式 (2.15)，中位生存时间的标准误由下式给出 \\[\\begin{equation} \\operatorname{se}\\left\\{\\hat{t}(50)\\right\\}=\\frac1{\\hat{f}\\{\\hat{t}(50)\\}}\\operatorname{se}\\left[\\hat{S}\\{\\hat{t}(50)\\}\\right] \\tag{2.16} \\end{equation}\\] 其中 \\(\\hat{f}\\{\\hat{t}(50)\\}\\) 为 \\[\\begin{equation} \\hat{f}\\{\\hat{t}(50)\\}=\\frac{\\hat{S}\\{\\hat{u}(50)\\}-\\hat{S}\\{\\hat{l}(50)\\}}{\\hat{l}(50)-\\hat{u}(50)} \\tag{2.17} \\end{equation}\\] 在此表达式中，\\(\\hat u(50)\\) 是生存函数的 Kaplan-Meier 估计超过 0.55 的最大生存时间，\\(\\hat l(50)\\) 是生存函数小于等于 0.45 的最小生存时间。 一旦得到第 \\(p\\) 个百分位数的标准误估计，\\(t(p)\\) 的 \\(100(1 − \\alpha)\\%\\) 置信限为 \\[\\begin{aligned}\\hat{t}(p)\\pm z_{\\alpha/2}\\text{se}\\{\\hat{t}(p)\\}\\end{aligned}\\] 其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上（单侧）\\(\\alpha/2\\) 分位点。 此区间估计只是近似值，因为该区间包含真实百分位数的概率不会恰好为 \\(1 − \\alpha\\)。虽然有许多其他方法来构建具有优良特性的中位置信区间，但这些方法比本节考虑的区间估计更难计算。 示例 2.10 (停用宫内节育器的时间) 使用示例 1.1 中给出的宫内节育器使用者停用时间的数据来说明中位停用时间置信区间的计算。根据示例 2.8，该组女性中位停用时间估计为 \\(\\hat t(50) = 93\\) 周。另外，从表 2.4 可以看出，此时生存函数的 Kaplan-Meier 估计的标准误为 \\([\\hat{S}\\{\\hat{t}(50)\\}]=0.1452\\)。 为了使用式 (2.16) 获得 \\(\\hat t(50)\\) 的标准误，我们需要估计中位停止时间处的密度函数。这是从式 (2.16) 获得的。该方程中所需的量 \\(\\hat u(50),\\hat l(50)\\) 为： \\[\\begin{aligned}\\hat{u}(50)&amp;=\\max\\{t_{(j)}\\mid\\hat{S}(t_{(j)})\\geqslant0.55\\}\\\\\\hat{l}(50)&amp;=\\min\\{t_{(j)}\\mid\\hat{S}(t_{(j)})\\leqslant0.45\\}\\end{aligned}\\] 其中 \\(t_{(j)}\\) 为第 \\(j\\) 个停用时间，\\(j=1,2,\\ldots,9\\)。使用表 2.4，\\(\\hat u(50)=75,\\hat l(50)=97\\)，因此 \\[\\hat{f}\\{\\hat{t}(50)\\}=\\frac{\\hat{S}(75)-\\hat{S}(97)}{97-75}=\\frac{0.5594-0.3729}{22}=0.0085\\] 那么中位数的标准误由下式给出 \\[\\mathrm{se}\\left\\{\\hat{t}(50)\\right\\}=\\frac1{0.0085}\\times0.1452=17.13\\] 中位停用时间的 95% 置信限为 \\[93\\pm1.96\\times17.13\\] 因此中位数区间估计范围为 59 到 127 天。 2.6 两组生存数据的比较 比较根据两组个体获得的生存时间的最简单方法是将两个生存函数的相应估计绘制在同一张图中。生成的图像可以提供非常丰富的信息，如下例所示。 示例 2.11 (患乳腺癌妇女的预后) 示例 1.2 给出了乳腺癌妇女的生存时间数据，根据肿瘤切片是否被 HPA 阳性染色分组。图 2.9 显示了两组生存时间的 Kaplan-Meier 生存函数估计。注意，在该图中，Kaplan-Meier 估计延伸至每组最大删失观测的时间。 该图显示，肿瘤染色阴性的女性的生存函数估计总是大于肿瘤染色阳性的女性。这意味着在任何时间 \\(t\\)，肿瘤染色阴性的女性在 \\(t\\) 后的生存概率估计都更大，这表明 HPA 染色程序的结果可能是一个有用的预后指标：那些肿瘤阳性染色的妇女的预后似乎比那些肿瘤阴性染色的妇女的预后差。 图 2.9 对于两个生存函数估计之间的差异有两种可能的解释，如示例 2.11。一种解释是两组个体的生存时间之间存在真实的差异，所以一组人的生存经历与另一组人不同。另一种解释是，每组的生存时间之间没有真正的差异，差异只是偶然的变异导致的。我们使用了一种称为假设检验 (hypothesis test) 的程序。 由于假设检验的概念在生存数据的分析中起着核心作用，因此在以下部分中详细描述了该程序的底层逻辑。 2.6.1 假设检验 假设检验是一个程序，使我们能够评估数据集与特定假设（称为工作假设或原假设, working or null hypothesis）一致的程度。原假设通常代表数据生成过程的简化视图 (simplified view)，其代表指定两组生存数据之间没有差异的假设，或者生存时间与年龄或血清胆固醇水平等解释变量之间没有关系的假设，诸如此类。原假设就是将被采用并随后采取行动的假设，除非数据表明它是站不住脚的。 下一步是制定检验统计量 (test statistic)，衡量数据偏离原假设的程度。一般来说，检验统计量的构造使得统计量的值越大，与原假设的偏离就越大。因此，如果原假设是两组之间没有差异，则检验统计量的相对较大值将成为反对原假设的证据。 一旦从观测数据中获得了检验统计量的值，当原假设成立时，我们计算获得与观测一样极端或比观测更极端的值的概率。该量总结了样本数据反对原假设的证据的强度，简称为概率值或 \\(P\\) 值。如果 \\(P\\) 值很大，我们会得出结论，数据很可能是在原假设成立时获得的，并且没有证据拒绝原假设。另一方面，如果 \\(P\\) 值很小，这成为反对原假设的证据；\\(P\\) 值越小，证据就越有力。 为了获得假设检验的 \\(P\\) 值，当原假设为真时，检验统计量必须具有已知或至少近似已知的概率分布。这种概率分布称为检验统计量的原分布 (null distribution)。更确切地说，考虑一个检验统计量 \\(W\\)，它使得检验统计量的观测值 \\(w\\) 越大，观测数据与原假设下预期数据的偏差就越大。如果 \\(W\\) 具有连续概率分布，则 \\(P\\) 值为 \\(\\text{P}(W\\ge w)=1−F(w)\\)，其中 \\(F(w)\\) 为在原假设成立的情况下 \\(W\\) 的分布函数在 \\(w\\) 处的值。 在一些应用中，最自然的检验统计量为：大的正值对应于在一个方向上偏离原假设，而小的负值对应于在相反方向上的偏离。例如，假设患有特定疾病的患者被随机分配接受标准疗法或新疗法，并记录他们的生存时间。在这种情况下，一个令人感兴趣的原假设是，两组患者的生存经历没有差异。数据与该原假设一致的程度可以通过检统计量来总结，其中正值表示新疗法优于标准疗法，而负值表示标准疗法优于新疗法。当在任何一个方向上偏离原假设都同等重要时，称原假设具有双侧备择 (two-sided alternative)，而该假设检验称为双侧检验 (two-sided test). 若 \\(W\\) 是这样的检验统计量：大的正观测值或小的负观测值将拒绝原假设，则可以定义新的检验统计量，例如 \\(|W|\\) 或 \\(W^2\\)，使得只有大的新统计量的正值具有拒绝原假设的证据。例如，假设 \\(W\\) 是一个检验统计量，在原假设下服从标准正态分布。如果 \\(w\\) 是 \\(W\\) 的观测值，则适当的 \\(P\\) 值是 \\(\\text{P}(W\\leqslant-|w|)+\\text{P}(W\\geqslant|w|)\\)。或者，我们可以利用这样的结果：若 \\(W\\) 服从标准正态分布，则 \\(W^2\\) 服从自由度为 \\(1\\) 的卡方分布，记为 \\(\\chi^2_1\\)。因此，基于统计量 \\(W\\) 的双侧假设检验的 \\(P\\) 值是随机变量 \\(\\chi^2_1\\) 超过 \\(w^2\\) 的概率。因此可从标准正态分布函数或卡方分布函数得到所需的 \\(P\\) 值。 当兴趣集中在特定方向的偏离上时，假设检验是单侧的 (one-sided). 例如，在比较两组患者的生存时间时，其中一组接受标准疗法，另一组接受新疗法，可能会认为新疗法不劣于标准疗法。那么，对于声称没有治疗差异的原假设，唯一相关的备择假设是新疗法优于标准疗法。如果检验统计量 \\(W\\) 的正值反映了新疗法的优效性，则 \\(P\\) 值为 \\(\\text P(W\\ge w)\\)。如果 \\(W\\) 服从标准正态分布，则该 \\(P\\) 值是相应双侧备择假设所得 \\(P\\) 值的一半。 单侧假设检验只在如下情况下适用：对与单侧备择假设指定方向相反的原假设没有任何兴趣。例如，再次考虑新疗法与标准疗法的比较，并假设检验统计量的观测值为正或为负，具体取决于新疗法是优于还是劣于标准疗法。如果声称无治疗差异的原假设的备择是新疗法更优，那么检验统计量小的负值将无法成为拒绝原假设的证据。相反，可以假设这个小的负值只是偶然变异的结果。一般来说，在医学研究中很少有理由使用单侧检验，因此本书将使用双侧检验。 如果 \\(P\\) 值小于某个值 \\(\\alpha\\)，我们就说假设在 \\(100\\alpha\\%\\) 显著性水平上被拒绝。检验统计量的观测值在此水平上认为是显著的。但是我们如何根据 \\(P\\) 值决定是否应该真正拒绝原假设呢？传统上，\\(0.05\\) 或 \\(0.01\\) 的 \\(P\\) 值用于决定是否应拒绝原假设，因此，例如，若 \\(P &lt; 0.05\\)，则在 \\(5\\%\\) 显着性水平下拒绝原假设。诸如此类的指导方针并不是硬性规定，不应严格解释。例如，\\(0.046\\) 和 \\(0.056\\) 的 \\(P\\) 值之间实际上没有差异，尽管只有前者表明检验统计量的观测值在 \\(5\\%\\) 的水平上显著。 更令人满意的策略是报告实际 \\(P\\) 的值，而不是报告在某个指定的显著性水平上拒绝或无法拒绝原假设。可以使用取决于 \\(P\\) 值所在范围的词汇，将此 \\(P\\) 值解释为反对原假设的证据强度的度量。因此，如果 \\(P &gt; 0.1\\)，则表示没有证据拒绝原假设；如果 \\(0.05 &lt; P ⩽ 0.1\\)，则有轻微证据反对原假设；如果 \\(0.01 &lt; P ⩽ 0.05\\)，则有中等证据反对原假设；如果 \\(0.001 &lt; P ≤ 0.01\\)，则有强有力的证据反对原假设；如果 \\(P ≤ 0.001\\)，则反对原假设的证据是压倒性的。 除了引用与假设检验相关的确切 \\(P\\) 值外，另一种方法是当原假设为真时，将检验统计量的观测值与对应于特定 \\(P\\) 值的那些值进行比较。在特定显著性水平下导致拒绝原假设的检验统计量的值可以从该统计量的原分布的分位点中找到。例如，如果 \\(W\\) 是一个具有标准正态分布的检验统计量，对于双侧检验，分布的上 \\(\\alpha/2\\) 分位点（如图 2.5 所示）是检验统计量的值，其 \\(P\\) 值为 \\(\\alpha\\)。例如，检验统计量的值 1.96, 2.58 和 3.29 分别对应于 0.05, 0.01 和 0.001 的 \\(P\\) 值。因此，如果 \\(W\\) 的观测值在 1.96 和 2.58 之间，我们会声称在 0.01 的显著性水平下，结果是有意义的，但不足以拒绝原假设。 图 2.5 对于常见的概率分布，例如正态分布和卡方分布，其百分位点在很多统计学入门教科书中都有表格列出，或者在 Lindley and Scott (1984) 的统计表中也可以找到。用于基于计算机的生存数据统计分析的统计软件包通常会提供与假设检验相关的精确 \\(P\\) 值。请注意，当这些 \\(P\\) 值被四舍五入到小数点后三位时，应将 0.000 的 \\(P\\) 值解释为 \\(P &lt; 0.001\\)。 在决定采取行动时，例如是否拒绝两种疗法之间没有差异的假设，假设检验 \\(P\\) 值中总结的统计证据只是决策过程的一个部分。除了统计证据外，还需要考虑科学证据。例如，这可能涉及治疗效应的大小是否具有临床意义。特别是在大型试验中，当治疗效应很小并不能表明重大科学突破时，也可能会发现两种疗法之间的显著差异（例如在 \\(5\\%\\) 的水平下）。另一方面，可能有新的疗法将寿命延长两倍，但由于研究中使用的样本量较小，因此可能与标准疗法没有显著差异。 与其根据假设检验程序的结果来报告发现，不如提供任何治疗差异大小的估计，并由该差异的置信区间来支持，这更具信息性。不幸的是，本章中考虑的生存数据分析的非参数方法不适用于这种方法。因此，当我们考虑生存数据的模型时，我们将在随后的章节中考虑这个主题。 在两组生存时间的比较中，有许多方法可以用来量化组间差异的程度。现在将考虑三种非参数程序，即 log-rank 检验、Wilcoxon 检验和 Peto-Peto 检验。 2.6.2 log-rank 检验 为了构建 log-rank 检验，我们首先分别考虑两组生存数据中的每个死亡时间。组别记为 Group I 和 Group II。假设在两组中有 \\(r\\) 个不同的死亡时间，记为 \\(t(1)&lt;t(2)&lt;\\cdots&lt;t(r)\\)，并且在时间 \\(t(j)\\)，Group I 中有 \\(d_{1j}\\) 个个体、Group I 中有 \\(d_{2j}\\) 个个体死亡，其中 \\(j=1,2,\\ldots,r\\)。除非一组中有两个或两个以上的个体具有相同的记录死亡时间，\\(d_{1j}\\) 和 \\(d_{2j}\\) 的值要么为 0，要么为 1。进一步假设，在时间 \\(t_{(j)}\\) 之前，Group I 中有 \\(n_{1j}\\) 个个体面临死亡风险，Group II 中有 \\(n_{2j}\\) 个个体面临死亡风险。因此，在时间 \\(t_{(j)}\\)，总共有 \\(d_j = d_{1j} + d_{2j}\\) 个死亡个体，而处于风险的个体总数为 \\(n_j = n_{1j} + n_{2j}\\)。表 2.7 总结了这一情况。 表 2.7 现在考虑一个原假设，即两组个体的生存经历没有差异。评估这一假设有效性的一个方法是考虑在每个死亡时间点上，两组中死亡个体数量与在原假设下预期的数量之间的差异程度。然后，可以将这些差异程度的信息在每个死亡时间点上进行合并。 如果表 2.7 中的边际总数被视为固定的，并且生存率与分组无关的原假设为真，则该表中的四个条目仅由 \\(d_{1j}\\) 的值决定。因此，我们可以将 \\(d_{1j}\\) 视为一个随机变量，它可以取从 \\(0\\) 到 \\(d_j\\) 和 \\(n_{1j}\\) 的最小值中的任何值。事实上，\\(d_{1j}\\) 服从超几何分布 (hypergeometric distribution)，根据该分布，与第一组死亡人数相关的随机变量取值 \\(d_{1j}\\) 的概率为 \\[\\begin{equation} \\frac{\\left(\\begin{array}{c}d_j\\\\d_{1j}\\end{array}\\right)\\left(\\begin{array}{c}n_j-d_j\\\\n_{1j}-d_{1j}\\end{array}\\right)}{\\left(\\begin{array}{c}n_j\\\\n_{1j}\\end{array}\\right)} \\tag{2.18} \\end{equation}\\] 在这个公式中，表达式 \\[\\left.\\left(\\begin{array}{c}d_j\\\\d_{1j}\\end{array}\\right.\\right)\\] 表示可以从 \\(d_j\\) 个时间中选择 \\(d_{1j}\\) 个时间的不同方式的数量，读作 “\\(d_j \\,C\\, d_{1j}\\)”，它的值为 \\[\\left.\\left(\\begin{array}{c}d_j\\\\d_{1j}\\end{array}\\right.\\right)=\\frac{d_j!}{d_{1j}!(d_j-d_{1j})!}\\] 其中 \\(d_j!\\) 读作 “\\(d_j\\) 的阶乘”，有 \\[\\begin{aligned}d_j!=d_j\\times(d_j-1)\\times\\cdots\\times2\\times1\\end{aligned}\\] 式 (2.18) 中的其他两项是类似的。 超几何随机变量 \\(d_{1j}\\) 的均值由下式给出 \\[\\begin{equation} e_{1j}=n_{1j}d_j/n_j \\tag{2.19} \\end{equation}\\] \\(e_{1j}\\) 是在 Group I 在时间 \\(t_{(j)}\\) 死亡的个体的预期数量。该值在直观上很有吸引力，因为在原假设下在时间 \\(t_{(j)}\\) 死亡的概率不取决于个体所在的组别，其中在时间 \\(t_{(j)}\\) 死亡的概率为 \\(d_j/n_j\\)。将其乘以 \\(n_{1j}\\)，得到的 \\(e_{1j}\\) 为时间 \\(t_{(j)}\\) 时 Group I 的预期死亡人数。 下一步是将每个死亡时间的 2 × 2 表格中的信息组合起来，给出 \\(d_{1j}\\) 观测值与其预期值偏差的总体度量。最简单的方法是在两组中将差值 \\(d_{1j}−e_{1j}\\) 关于两组死亡时间总数 \\(r\\) 相加。得出的统计量由下式给出 \\[\\begin{equation} U_L=\\sum_{j=1}^r(d_{1j}-e_{1j}) \\tag{2.20} \\end{equation}\\] 注意到这等于 \\(\\sum d_{1j}-\\sum e_{1j}\\)，也就是 Group I 总死亡人数和预期死亡人数之差。此统计量的均值为 0，因为 \\(\\mathrm{E}\\left(d_{1j}\\right)=e_{1j}\\)。此外，由于死亡时间彼此独立，\\(U_L\\) 的方差就是 \\(d_{1j}\\) 的方差之和。现在，由于 \\(d_{1j}\\) 服从超几何分布，\\(d_{1j}\\) 的方差由下式给出 \\[\\begin{equation} v_{1j}=\\frac{n_{1j}n_{2j}d_j(n_j-d_j)}{n_j^2(n_j-1)} \\tag{2.21} \\end{equation}\\] 因此 \\(U_L\\) 的方差为 \\[\\begin{equation} \\operatorname{var}\\left(U_L\\right)=\\sum_{j=1}^rv_{1j}=V_L \\tag{2.22} \\end{equation}\\] 此外可以表明，当死亡时间数不太小时，\\(U_L\\) 近似服从正态分布。因此，\\(U_L/√V_L\\) 具有零均值和单位方差的正态分布，记作 \\(N(0,1)\\)。因此我们写 \\[\\begin{aligned}\\frac{U_L}{\\sqrt{V_L}}\\sim N(0,1)\\end{aligned}\\] 符号 “\\(\\sim\\)” 读作“分布于” (distributed as) 。标准正态随机变量的平方服从自由度为一的卡方分布，记作 \\(\\chi^2_1\\)，因此我们有 \\[\\begin{equation} \\frac{U_L^2}{V_L}\\sim\\chi_1^2 \\tag{2.23} \\end{equation}\\] 这种在多个 \\(2 × 2\\) 表中组合信息的方法是由 Mantel and Haenszel (1959) 提出的，称为 Mantel-Haenszel 程序。事实上，基于这一统计量的检验有各种各样的名字，包括 Mantel Cox 和 Peto Mantel Haenszel，但最为人所知的是 log-rank 检验。之所以取这个名字，是因为检验统计量可以从两组生存时间的秩中推导出来，而得到的秩检验统计量是基于生存函数 Nelson-Aalen 估计的对数。 统计量 \\(W_L = U^2_L/V_L\\) 总结了两组数据中生存时间与无组间差异原假设下预期生存时间的偏离程度。该统计量的值越大，反对原假设的证据就越多。由于 W 的原分布近似为一个自由度的卡方，因此可以从卡方随机变量的分布函数获得与检验统计量相关的 \\(P\\) 值。或者，可以使用卡方分布的百分位点来确定 \\(P\\) 值所在的范围。下面的示例 2.12 给出了 log-rank 检验的说明。 示例 2.12 (患乳腺癌妇女的预后) 在此示例中，我们回到有关乳腺癌妇女生存时间的数据，根据肿瘤染色呈阳性还是阴性进行分组。我们将使用 log-rank 检验来检验两组的生存经历无差异的原假设。所需的计算列于表 2.8。 表 2.8 我们首先对两组女性的死亡时间进行排序；这些时间在表 2.8 的第 1 列中给出。然后计算每组在每个死亡时间下死亡的女性人数以及每个时间处于风险的人数。\\(d_{1j},n_{1j},d_{2j}\\) 和 \\(n_{2j}\\) 的值在表中第 2 至 5 列给出。第 6 列和第 7 列包含在每个死亡时间的死亡总数和处于风险的人数的总数。最后两列给出 \\(e_{1j}\\) 和 \\(v_{1j}\\) 的值，分别根据式 (2.19) 和 (2.21) 计算。将第 2 列和第 8 列中的条目相加得出 \\(d_{1j}\\) 和 \\(e_{1j}\\)，可以根据 \\(U_L = d_{1j} − e_{1j}\\) 计算 log-rank 统计量。值 \\(V_L = v_{1j}\\) 可以通过对最后一列中的条目求和来获得。我们发现 \\(U_L = 5 − 9.565 = −4.565\\) 且 \\(V_L = 5.929\\)，因此 log-rank 检验统计量的值为 \\(W_L = (−4.565)^2/5.929 = 3.515\\)。相应的 \\(P\\) 值是根据自由度为一的卡方变量大于等于 3.515 的概率来计算的，结果 0.061，记作 \\(P = 0.061\\)。该 \\(P\\) 值足够小，足以对两组女性生存函数没有差异的原假设产生怀疑。事实上，反对原假设的证据在 6% 的水平上几乎是显著的。因此，我们得出结论，这些数据确实提供了一些证据，表明乳腺癌患者的预后取决于染色程序的结果。 2.6.3 Wilcoxon 检验 Wilcoxon 检验，有时称为 Breslow 检验或 Gehan-Breslow 检验，也用于检验两组生存数据的生存函数没有差异的原假设。Wilcoxon 检验基于统计量 \\[\\begin{aligned}U_W=\\sum_{j=1}^rn_j(d_{1j}-e_{1j})\\end{aligned}\\] 其中，如上一节所述，\\(d_{1j}\\) 是第一组中时间 \\(t_{(j)}\\) 的死亡人数，\\(e_{1j}\\) 如式 (2.19) 定义。\\(U_W\\) 和 \\(U_L\\) 之间的区别在于，在 Wilcoxon 检验中，每个差异 \\(d_{1j} − e_{1j}\\) 的权重均为 \\(n_j\\)（时间 \\(t_{(j)}\\) 时处于风险的个体总数）。这样做的效果是，在仍然生存的个体总数较小时，即在最长生存时间时，对 \\(d_{1j}\\) 与 \\(e_{1j}\\) 之差给予较小的权重。因此，与 log-rank 统计量相比，该统计量对生存时间分布尾部的 \\(d_{1j}\\) 与 \\(e_{1j}\\) 的偏差不太敏感。 Wilcoxon 统计量 \\(U_W\\) 的方差由下式给出 \\[V_W=\\sum_{j=1}^rn_j^2v_{1j}\\] 其中 \\(v_{1j}\\) 由式 (2.21) 给出，因此 Wilcoxon 检验统计量为 \\[\\begin{aligned}W_W=U_W^2/V_W\\end{aligned}\\] 当原假设为真时，它服从自由度为一的卡方分布。因此，Wilcoxon 检验进行的方式与 log-rank 检验相同。 2.6.4 Peto-Peto 检验 当两组生存时间的删失模式不同时，Wilcoxon 检验表现不佳。如果将 Wilcoxon 统计量中的权重 \\(n_j\\)（即在时间 \\(t_{(j)}\\) 时处于风险的个体总数）替换为在时间 \\(t_{(j)}\\) 时生存函数的估计，则可以缓解这个问题。由于检验统计量是在原假设下计算的，即每组的生存函数之间没有差异，因此使用的是基于两组数据的合并数据的 Kaplan-Meier 生存函数估计。以 \\(\\hat S_{KM}(t)\\) 表示该估计，则 Peto-Peto 统计量为 \\[\\begin{aligned}U_P=\\sum_{j=1}^r\\hat{S}_{KM}(t_{(j)})(d_{1j}-e_{1j})\\end{aligned}\\] 其中 \\(d_{1j}\\) 和 \\(e_{1j}\\) 是第一组中在时间 \\(t_{(j)}\\) 观察到的和预期的死亡人数。与 Wilcoxon 检验一样，这样做的效果是在最长生存时间（当 \\(\\hat S_{KM}(t)\\) 很小时），对 \\(d_{1j}\\) 与 \\(e_{1j}\\) 之差给予较小的权重。 Peto-Peto 统计量 \\(U_P\\) 的方差由下式给出 \\[V_P=\\sum_{j=1}^r\\hat{S}_{KM}(t_{(j)})^2v_{1j}\\] 其中 \\(v_{1j}\\) 由式 (2.21) 给出，因此 Peto-Peto 检验统计量为 \\[W_P=U_P^2/V_P\\] 在声称无总体差异的原假设下，它服从自由度为一的卡方分布。Peto-Peto 检验统计量 \\(W_P\\) 通常与 Wilcoxon 检验统计量非常相近。 示例 2.13 (患乳腺癌妇女的预后) 对于阳性或阴性染色的肿瘤女性的生存时间数据，Wilcoxon 统计量的值为 \\(U_W = -159\\)，统计量的方差为 \\(V_W = 6048.136\\)。卡方统计量 \\(U^2_W /V_W\\) 的值为 4.180，相应的 \\(P\\) 值为 0.041。这略小于 log-rank 检验的 \\(P\\) 值，根据该结果，我们可以声明两组之间的差异在 5% 的水平上显著。对于 Peto-Peto 检验，\\(U_P = 3.603,V_P = 3.155\\)，因此 \\(W_P = U^2_P /V_P = 4.115\\)，\\(P\\) 值 0.043 ，这与 Wilcoxon 检验发现的结果相同。 2.6.5 log-rank 检验、Wilcoxon 检验和 Peto-Peto 检验的比较 在这三种检验中，当备择假设为某一组个体在任何给定时间的死亡风险与另一组相似个体的风险成比例时，log-rank 检验更适合。这是比例风险 (proportional hazards) 假设，是许多分析生存数据方法的基础。对于偏离原假设的其他类型，Wilcoxon 检验比 log-rank 检验更适合用于比较两个生存函数。然而，当组间删失模式不同时，Peto-Peto 检验确实表现得更好，并且在其他情况下与 Wilcoxon 检验的结果非常相似。因此，当比例风险假设存疑时，Peto-Peto 检验是 log-rank 检验的首选替代方案。 为了确定在给定情况下哪种检验方法更适用，我们利用以下结果：如果风险函数成比例，则两组生存数据的生存函数不会相互交叉。为了证明这一点，假设 \\(h_1(t)\\) 是 Group I 中个体在时间 \\(t\\) 的死亡风险，\\(h_2(t)\\) 是 Group II 中个体在同一时间的死亡风险。如果这两个风险成比例，那么我们可以有 \\(h_1(t) = \\psi h_2(t)\\)，其中 \\(\\psi\\) 是一个不依赖于时间 \\(t\\) 的常数。对这个表达式的两边进行积分，乘以 -1 并取指数，得到 \\[\\begin{equation} \\exp\\left\\{-\\int_0^th_1(u)\\mathrm{d}u\\right\\}=\\exp\\left\\{-\\int_0^t\\psi h_2(u)\\mathrm{d}u\\right\\} \\tag{2.24} \\end{equation}\\] 根据式 (1.6) \\[S(t)=\\exp\\left\\{-\\int_0^th(u)\\mathrm{d}u\\right\\}\\] 因此，如果 \\(S_1(T)\\) 和 \\(S_2(T)\\) 是两组生存数据的生存函数，则根据式 (2.24) \\[S_1(t)=\\left\\{S_2(t)\\right\\}^\\psi \\] 由于生存函数的取值范围在 0 到 1 之间，这一结果表明，在任何时间 \\(t\\)，\\(S_1(t)\\) 大于还是小于 \\(S_2(t)\\) 取决于 \\(\\psi\\) 是小于还是大于 1。这意味着如果两个风险函数成比例，那么真实的生存函数不会交叉。这是比例风险的必要条件，但不是充分条件。 通过绘制两组生存数据的生存函数估计图（如图 2.9 所示），可以对比例风险假设的有效性进行非正式评估。如果两个生存函数估计没有交叉，那么比例风险假设可能是合理的，log-rank 检验也是适用的。当然，即使对应的真实风险函数成比例，基于样本的生存函数估计也可能交叉，因此在解释此类图形时需要谨慎。第 4 章 4.4.1 节介绍了一种更满意的图形方法，用于评估比例风险假设的有效性。 总之，应使用 log-rank 检验来检验两个生存函数相等的假设，除非生存函数估计的曲线图或先前的数据表明有充分的理由怀疑比例风险假设。 示例 2.14 (患乳腺癌妇女的预后) 从图 2.9 中的两个生存函数估计的曲线图中，我们可以看到，染色阴性的女性的生存函数始终高于染色阳性的女性的生存函数。这表明比例风险假设是适当的，并且 log-rank 检验比 Wilcoxon 或 Peto-Peto 检验更合适。然而，在这个例子中，三种假设检验的结果差别很小。 2.7 三组或更多组生存数据的比较 log-rank, Wilcoxon 和 Peto-Peto 检验都可以扩展到能够比较三组或更多组生存数据。假设要比较 \\(g\\ge 2\\) 组生存数据的生存分布。我们定义类似于 \\(U\\) 的统计量，用于将组 \\(1,2,\\ldots,g−1\\) 的观测死亡人数与它们的期望值进行比较。例如，使用 2.6 节中的记号，log-rank 统计量的一个明显的扩展为 \\[\\begin{aligned}U_{Lk}=\\sum_{j=1}^r\\left(d_{kj}-\\frac{n_{kj}d_j}{n_j}\\right)\\end{aligned}\\] 其中 \\(k=1,2,\\ldots,g-1\\)。这些量以具有 \\((g−1)\\) 个分量的向量的形式表示，记作 \\(\\boldsymbol U_L\\)。 我们还需要 \\(U_{LK}\\) 的方差和协方差的表达式。其中，\\(U_{LK}\\) 和 \\(U_{LK^\\prime}\\) 之间的协方差由下式给出 \\[V_{Lkk&#39;}=\\sum_{j=1}^r\\frac{n_{kj}d_j(n_j-d_j)}{n_j(n_j-1)}\\left(\\delta_{kk&#39;}-\\frac{n_{k&#39;j}}{n_j}\\right)\\] 其中 \\(k,k&#39;=1,2,\\ldots,g-1\\)，以及 \\[\\left.\\delta_{kk^{\\prime}}=\\left\\{\\begin{array}{l}1\\mathrm{~if~}k=k^{\\prime},\\\\0\\text{ otherwise.}\\end{array}\\right.\\right.\\] 然后将这些项以方差-协方差阵 \\(\\boldsymbol V_L\\) 的形式组装，该矩阵是一个对称阵，其中 \\(U_{Lk}\\) 的方差位于对角线，协方差项位于非对角线。例如，在比较三组生存数据时，该矩阵为 \\[\\boldsymbol{V}_L=\\begin{pmatrix}V_{L11}&amp;V_{L12}\\\\V_{L12}&amp;V_{L22}\\end{pmatrix}\\] 其中 \\(V_{L11}\\) 和 \\(V_{L22}\\) 分别是 \\(U_{L1}\\) 和 \\(U_{L2}\\) 的方差，\\(V_{L12}\\) 是它们的协方差。 类似地，Wilcoxon 统计量的方差-协方差阵是矩阵 \\(\\boldsymbol V_W\\) ，其第 \\((k, k^′)\\) 个元素为 \\[V_{Wkk^{\\prime}}=\\sum_{j=1}^rn_j^2\\frac{n_{kj}d_j(n_j-d_j)}{n_j(n_j-1)}\\left(\\delta_{kk^{\\prime}}-\\frac{n_{k^{\\prime}j}}{n_j}\\right)\\] 其中 \\(k,k&#39;=1,2,\\ldots,g-1\\)。而 Peto-Peto 检验统计量的相应元素为 \\[\\begin{aligned}V_{Pkk&#39;}=\\sum_{j=1}^r\\hat{S}_{KM}(t_j)^2\\frac{n_{kj}d_j(n_j-d_j)}{n_j(n_j-1)}\\left(\\delta_{kk&#39;}-\\frac{n_{k&#39;j}}{n_j}\\right)\\end{aligned}\\] 最后，为了检验组间无差异的原假设，我们利用检验统计量 \\(\\boldsymbol{U}_L^{\\prime}\\boldsymbol{V}_L^{-1}\\boldsymbol{U}_L\\) 在原假设为真时服从自由度为 \\(g − 1\\) 的卡方分布这一结果。其他两个检验也是如此。 用于分析生存数据的统计软件通常采用这种方法，并且由于对所得卡方统计量的解释很简单，因此这里不再给出示例。 2.8 分层检验 在许多情况下，在考虑到记录在每个个体上的其他变量之后，需要比较两组或多组生存数据。考虑一项多中心临床试验，比较两种化疗对肺癌病人生存时间的影响。每个中心都会提供有关每个治疗组患者生存时间的信息。由此产生的数据称为按中心分层 (stratified by center)。 基于每个中心数据的单独的 log-rank, Wilcoxon 或 Peto-Peto 检验将提供丰富的信息，但结合了所有中心治疗差异信息的检验可以提供更精确的治疗效果的总结。当根据年龄组、性别、表现状态和所研究疾病的其他潜在风险因素等变量对患者进行分层时，在试图检验治疗差异时，也会出现类似的情况。 在上述情况下，可以采用 log-rank 的分层版本或其他检验。从本质上讲，这涉及到计算每层的 \\(U\\) 和 \\(V\\) 统计量，然后将这些值跨层合并。本节将描述分层 log-rank 检验，但也可以以类似的方式获得 Wilcoxon 和 Peto-Peto 检验的分层版本。第 11 章 ?? 节描述了基于生存时间模型的等价分析。 设 \\(U_{Lk}\\) 是用于比较两个治疗组的 log-rank 统计量的值，这是使用式 (2.20) 从第 \\(k\\) 层中计算得出的。此外，用 \\(V_{Lk}\\) 表示第 \\(k\\) 层的统计量的方差，这是使用式 (2.21) 计算的。那么分层 log-rank 检验基于统计量 \\[\\begin{equation} W_S=\\frac{\\left(\\sum_{k=1}^sU_{Lk}\\right)^2}{\\sum_{k=1}^sV_{Lk}} \\tag{2.25} \\end{equation}\\] 在无治疗差异的原假设下，它服从自由度为一的卡方分布。将该统计量的观测值与卡方分布的百分位点进行比较，可以检验无总体治疗差异的假设。 示例 2.15 (黑色素瘤患者的生存时间) University of Oklahoma Health Sciences Center 进行了一项研究，旨在比较两种免疫疗法延长黑色素瘤患者生存期的能力，黑色素瘤是一种发生于皮肤的高度恶性肿瘤。对于每位患者，在分配卡介苗 (Bacillus Calmette-Gu´erin, BCG) 疫苗或基于短棒状杆菌 (Corynebacterium parvum, C. parvum) 的疫苗之前，均通过手术切除肿瘤。 各治疗组患者的生存时间根据患者年龄组进一步分类，Lee and Wang (2013) 给出的数据如表 2.9 所示。 表 2.9 通过首先计算 log-rank 统计量来分析这些数据，以比较两个治疗组中每个年龄组患者的生存时间。使用式 (2.20), (2.22) 和 (2.23) 得出的 \\(U,V,W\\) 统计量的值总结于表 2.10 中。 表 2.10 分层 log-rank 检验可进行扩展以比较两个以上的治疗组。得出的公式不适合手工计算，可以使用计算机软件进行生存分析。然而，这种考虑额外变量的方法不如下一章介绍的基于建模方法的灵活，因此此处不提供更多细节。 2.9 Log-rank 趋势检验 在许多要比较三组或更多组生存数据的应用中，这些组是以某种方式排序的。例如，这些组可以对应于治疗剂量的增加、疾病的阶段或个体的年龄组。在使用前几节中描述的 log-rank 检验对这些组进行比较时，即使各组之间的死亡风险增加或减少，也可能得不到各组之间有显著差异的结果。使用有关组别顺序信息的检验程序比标准的 log-rank 检验更易识别显著的趋势。 跨 \\(g\\) 个有序组别的 log-rank 趋势检验基于统计量 \\[\\begin{equation} U_T=\\sum_{k=1}^gw_k(d_{k.}-e_{k.}) \\tag{2.26} \\end{equation}\\] 其中 \\(w_k\\) 是分配给第 \\(k\\) 组的编码 (code)，\\(k=1,2,\\ldots,g\\) 以及 \\[\\begin{aligned}d_{k.}=\\sum_{j=1}^{r_k}d_{kj},\\quad\\quad e_{k.}=\\sum_{j=1}^{r_k}e_{kj}\\end{aligned}\\] 是第 \\(k\\) 组观察到的和预期的死亡人数，其中求和是对该组中 \\(r_k\\) 个死亡时间进行的。注意 \\(d_{k.}\\) 和 \\(e_{k.}\\) 中的点下标表示点所替换的下标的总和。编码通常认为是等距的，对应于各组之间的线性趋势。例如，如果有三组，则代码可以取 1, 2 和 3，不过 −1, 0 和 1 这组等价的选择可在一定程度上简化计算。\\(U_T\\) 的方差由下式给出 \\[\\begin{equation} V_T=\\sum_{k=1}^g(w_k-\\bar{w})^2e_k. \\tag{2.27} \\end{equation}\\] 其中 \\(\\bar w\\) 是量 \\(w_k\\) 的加权和，权重为预期死亡人数，即 \\[\\bar{w}=\\frac{\\sum_{k=1}^gw_ke_{k.}}{\\sum_{k=1}^ge_{k.}}\\] 统计量 \\(W_T = U^2_T /V_T\\) 在跨 \\(g\\) 组无趋势的原假设下服从自由度为一的卡方分布。 示例 2.16 (黑色素瘤患者的生存时间) 将使用示例 2.15 中有关黑色素瘤患者生存时间的数据来说明 log-rank 趋势检验。出于说明目的，将仅使用分配了 BCG 疫苗的患者的数据。比较三个年龄组患者生存时间的 log-rank 统计量为 3.739。与自由度为二的卡方分布的百分位点相比，这并不显著 (\\(P = 0.154\\))。 现在使用 log-rank 趋势检验来考察随年龄变化是否存在线性趋势。为此，我们将采用等间距的编码 \\(w_k\\)，其值为 -1, 0 和 1。表 2.11 总结了 log-rank 趋势检验所需的计算。 表 2.11 Log-rank 趋势检验基于式 (2.26) 中的统计量，其值为 \\[\\begin{aligned}U_T=(d_{3.}-e_{3.})-(d_{1.}-e_{1.})=2.5692\\end{aligned}\\] 使用表 2.11 中给出的每组的预期死亡人数，编码 \\(w_k\\) 的加权平均值为 \\[\\begin{aligned}\\bar{w}&amp;=\\frac{e_{3.}-e_{1.}}{e_{1.}+e_{2.}+e_{3.}}=-0.5138\\end{aligned}\\] \\((w_k-\\bar{w})^2\\) 的三个值为 0.2364, 0.2640 和 2.2917，并且根据式 (2.27)，\\(V_T = 2.4849\\)。最后，检验统计量为 \\[W_T=\\frac{U_T^2}{V_T}=2.656\\] 根据自由度为一卡方分布进行判断，在 10% 水平上几乎显著 (\\(P = 0.103\\))。因此，我们得出结论，有轻微证据表明各年龄组之间存在线性趋势。 下一章的 3.8.1 节描述了考察有序分类变量的各个水平是否存在趋势的另一种方法，是一种基于生存数据分析的建模方法。 2.10 延伸阅读 生命表是生存函数生命表估计计算的基础，广泛用于流行病学研究和人口学数据分析。更详细的信息可以在 Armitage, Berry and Matthews (2002) 以及有关人口学和流行病学统计方法的书籍中找到，例如 Khmaladze (2013) 和 Woodward (2014). 生存函数的乘积极限估计自 20 世纪初开始使用。Kaplan and Meier (1958) 使用最大似然法得出了该估计，这就是为什么该估计以他们的名字命名。Breslow and Crowley (1974) 以及 Meier (1975) 进一步探讨了生存函数 Kaplan-Meier 估计的性质。Nelson-Aalen 估计是由 Altshuler (1970), Nelson (1972) 和 Aalen (1978b) 得出的。 Greenwood (1926) 首先给出了 Kaplan-Meier 估计的标准误表达式，但 Aalen and Johansen (1978) 给出了另一个结果。Klein (1991) 比较了累积风险函数的 Nelson-Aalen 估计的方差表达式。尽管 2.2.3 节显示了如何使用 Greenwood 公式得到生存函数特定时间的置信区间，但需要其他程序来构建完整生存函数的置信区间。Hall and Wellner (1980) 以及 Efron (1981) 展示了如何计算这些带宽。 Brookmeyer and Crowley (1982), Emerson (1982), Nair (1984), Simon and Lee (1982) 以及 Slud, Byar and Green (1984) 描述了构建中位生存时间置信区间的方法。Simon (1986) 强调了置信区间在报告临床试验结果中的重要性，并举例说明了 Slud, Byar and Green (1984) 中描述的方法。Klein and Moeschberger (2005) 对风险函数的核平滑估计进行了全面的综述。 在许多统计文本中都涵盖了频率学派推断方法中假设检验程序的制定。例如，在非技术性医学背景下呈现相关思想的著作包括 Altman (1991) 和 Armitage, Berry and Matthews (2002. Log-rank 检验源于 Mantel and Haenszel (1959), Mantel (1966) 以及 Peto and Peto (1972) 的工作。关于秩检验制定的细节，请参阅 Lawless (2002)。在 2.6.2 节中推导 log-rank 检验时使用的超几何分布的全面综述，参见 Johnson, Kotz and Kemp (2005). Peto-Peto 检验由 Peto and Peto (1972) 提出，而 Prentice and Marek (1979) 给出了一个 Wilcoxon 检验表现不佳的示例。Harrington and Fleming (1982) 介绍了一个用于比较两个或更多组的一系列检验。log-rank 趋势检验源于 Armitage, Berry and Matthews (2002)中给出的 2 × k 列联表趋势检验，并在 Altman (1991) 中也有描述。 "],["chap3.html", "第 3 章 Cox 回归模型 3.1 风险函数建模 3.2 模型的线性部分 3.3 拟合 Cox 回归模型 3.4 置信区间和假设检验 3.5 比较替代模型 3.6 模型选择策略 3.7 使用 lasso 进行变量选择 3.8 非线性项", " 第 3 章 Cox 回归模型 第 2 章描述的非参数方法在分析单一生存数据样本或比较两个或多个生存时间组时可能很有用。然而，在大多数产生生存数据的医学研究中，还会记录每个个体的补充信息。一个典型的例子是比较接受两种不同治疗的患者的生存时间的临床试验。在这类研究中，患者的年龄和性别等人口学变量、血清血红蛋白水平和心率等生理学变量的值，以及与患者生活方式相关的因素，如吸烟史和饮食习惯，都可能对患者的生存时间产生影响。因此，这些称为解释变量的值会在研究开始时被记录下来。由此产生的数据集将比第 2 章考虑的数据集更为复杂，而该章描述的方法通常将不适用。为了探索患者的生存经历与解释变量之间的关系，可以采用基于统计建模的方法。本章开发的特定模型，即 Cox 回归模型，既统一又扩展了第 2 章的非参数程序。 3.1 风险函数建模 通过分析生存数据的建模方法，我们可以探讨一组患者的生存经历如何依赖于一个或多个解释变量的值，这些变量的值在起始时间对每位患者都有记录。例如，在示例 1.3 给出的多发性骨髓瘤研究中，目的是确定七个解释变量中哪些对患者的生存时间有影响。示例 1.14 涉及两种前列腺癌疗法的临床试验中患者的生存时间，主要目的是确定两个治疗组的患者是否有不同的生存经历。在这个例子中，患者的年龄和肿瘤大小等变量可能会影响生存时间，因此在评估任何治疗差异的程度时，考虑这些变量是很重要的。此外，通过建模方法，我们不仅可以了解哪些变量对生存时间有影响，还能估计这些影响的具体大小。这使得我们能够更准确地理解各因素对生存经历的贡献，并为临床决策提供有力依据。在生存分析的研究中，选择适当的模型和解释变量是关键步骤，因为它们直接影响结果的准确性和可靠性。因此，在进行分析时，我们需要仔细考虑并选择合适的模型，以确保结果的准确性和有效性。 在生存数据分析中，兴趣集中在研究开始后任何时间的死亡风险或危险 (hazard or risk). 因此，在生存分析中，直接对第 1 章 1.4.2 节中定义的风险函数建模。所得模型在形式上与回归分析和设计实验数据分析中遇到的线性模型有些不同，后者对平均响应或其某些函数关于某些解释变量的依赖性进行建模。然而，线性模型中使用的许多原理和程序都适用于生存数据的建模。 对生存数据进行建模的原因主要有两个。建模过程的一个目标是确定哪些潜在解释变量的组合会影响风险函数的形式。具体来说，可以研究治疗对死亡风险的影响，以及其他解释变量对风险函数的影响程度。对风险函数进行建模的另一个原因是为了获得某个个体风险函数本身的估计值。其本身可能就是人们感兴趣的，此外，根据式 1.6 描述的生存函数与风险函数之间的关系，还可以得到生存函数的估计值。这反过来又能得出对诸如中位生存时间等量的估计，这些量是模型中解释变量的函数。然后，可以根据这些解释变量的特定值，为当前或未来的患者估计中位生存时间。所得估计在制定治疗方案或向患者提供预后咨询时可能特别有用。 本章描述的生存数据模型基于第 2 章 2.6.5 节中介绍的比例风险假设，称为比例风险模型 (proportional hazard model). 我们首先开发模型来比较两组个体的风险函数。 3.1.1 两组比较的模型 假设两组患者分别接受标准疗法或新疗法，并设 \\(h_S(t)\\) 和 \\(h_N(t)\\) 分别为接受标准疗法和新疗法的患者在时间 \\(t\\) 的死亡风险。根据这两组患者生存时间的简单模型，接受新疗法的患者在时间 \\(t\\) 的风险与接受标准疗法的患者在同一时间的风险成比例。这种比例风险模型可以表示为 \\[\\begin{equation} h_N(t)=\\psi h_S(t) \\tag{3.1} \\end{equation}\\] 其中 \\(t\\) 为任何非负值，\\(\\psi\\) 为常数。这一假设的含义是，如 2.6.5 节所示，新疗法和标准疗法中个体相应的真实生存函数不会交叉。 参数 \\(\\psi\\) 的值是新疗法患者相对于标准疗法患者在任何时间的死亡风险的比值，因此 \\(\\psi\\) 称为相对风险 (relative hazard) 或风险比 (hazard ratio). 如果 \\(\\psi&lt;1\\)，则相对于接受标准疗法的患者，接受新疗法的患者在时间 \\(t\\) 的死亡风险更小。这时，新疗法相对于标准疗法是一个改进。另一方面，如果 \\(\\psi&gt;1\\)，则接受新疗法的患者在时间 \\(t\\) 的死亡风险更大，标准疗法更优。 以另一种方式表示式 3.1 中的模型可以得到一个更容易推广的模型。假设有 \\(n\\) 个个体的生存数据，用 \\(h_i(t)\\) 表示第 \\(i\\) 个个体的风险函数，其中 \\(i = 1, 2,...,n\\)。同时，用 \\(h_0(t)\\) 表示接受标准疗法的个体的风险函数。那么，接受新疗法的个体的风险函数就是 \\(\\psi h_0(t)\\)。相对风险 \\(\\psi\\) 不能为负值，因此，将 \\(\\psi\\) 设为 \\(\\exp(\\beta)\\) 更为方便。这样，参数 \\(\\beta\\) 就是风险比的对数，即 \\(\\beta=\\log \\psi\\)，且 \\(\\beta\\) 在\\((−\\infty, \\infty)\\) 范围内的任何值都能得到正的 \\(\\psi\\)。请注意，当风险比 \\(\\psi&gt;1\\)，即新疗法不如标准疗法时，\\(\\beta\\) 为正。 现令 \\(X\\) 是一个指示变量，如果一个个体接受标准治疗，它的值为 0，如果一个个体接受新治疗，它的值为 1. 如果 \\(x_i\\) 是研究中第 \\(i\\) 个个体的 \\(X\\) 值，\\(i=1,2,\\ldots,n\\)，该个体的风险函数可以写为 \\[\\begin{equation} h_i(t)=e^{\\beta x_i}h_0(t) \\tag{3.2} \\end{equation}\\] 其中如果第 \\(i\\) 个个体接受新疗法，则 \\(x_i=1\\)，否则 \\(x_i＝0\\)。这是用于比较两个治疗组的比例风险模型。 3.1.2 一般的比例风险模型 上一节中的模型现在被推广，某一特定时间的死亡风险取决于 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 的值 \\(x_1, x_2,...,x_p\\)。假设这些变量的值在研究的起始时间就已经被记录。在第 8 章中，我们会考虑将模型扩展至若干解释变量随时间变化的情况。 在比例风险模型中，解释变量的值由向量 \\(\\boldsymbol x\\) 表示，即 \\(\\boldsymbol x=(x_1,x_2,\\ldots,x_p)^\\prime\\)。设 \\(h_0(t)\\) 是构成向量 \\(\\boldsymbol x\\) 的所有解释变量的值为 0 的个体的风险函数。函数 \\(h_0(t)\\) 称为基线风险函数 (baseline hazard function)。那么，第 \\(i\\) 个个体的风险函数可以写为 \\[h_i(t)=\\psi(\\boldsymbol{x}_i)h_0(t)\\] 其中 \\(\\psi(\\boldsymbol x_i)\\) 是 \\(\\boldsymbol x_i\\) 的函数，\\(\\boldsymbol x_i\\) 是第 \\(i\\) 个个体的解释变量的值的向量，其分量为 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\)。函数 \\(\\psi(\\cdot)\\) 可以解释为解释变量向量为 \\(\\boldsymbol x_i\\) 的个体在时间 \\(t\\) 的风险与 \\(\\boldsymbol x=0\\) 的个体的风险的相对风险。 同样，由于相对风险 \\(\\psi(\\boldsymbol x_i)\\) 不可能是负的，因此可以方便地将其写成 \\(\\exp(\\eta _i)\\)，其中 \\(\\eta _i\\) 是 \\(\\boldsymbol x_i\\) 中 \\(p\\) 个解释变量值的线性组合。因此 \\[\\begin{aligned}\\eta_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\end{aligned}\\] 即 \\(\\eta_i=\\sum_{j=1}^p\\beta_jx_{ji}\\)。用矩阵表示为 \\(\\eta_i=\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i\\)，其中 \\(\\boldsymbol{\\beta}=(\\beta_1,\\beta_2,\\ldots,\\beta_p)&#39;\\) 为模型中 \\(p\\) 个解释变量的系数向量。量 \\(\\eta_i\\) 称为模型的线性部分 (linear component)，也称为第 \\(i\\) 个个体的风险评分 (risk score) 或预后指数 (prognostic index)。函数 \\(\\psi(\\boldsymbol x_i)\\) 还有其他可能的形式，但选择 \\(\\psi(\\boldsymbol{x}_i)=\\exp(\\boldsymbol{\\beta}&#39;\\boldsymbol{x}_i)\\) 能得出最常用的生存数据模型。那么，一般的比例风险模型为 \\[\\begin{equation} h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})h_0(t) \\tag{3.3} \\end{equation}\\] 请注意，在这个比例风险模型的线性部分中没有常数项。例如，如果包括常数项 \\(\\beta_0\\)，则可以通过将 \\(h_0(t)\\) 除以 \\(\\exp (\\beta_0)\\) 来重新缩放基线风险函数，并且常数项将抵消。式 (3.3) 中的模型也可以重新表示为 \\[\\log\\left\\{\\frac{h_i(t)}{h_0(t)}\\right\\}=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\] 这给出了关于风险比对数的线性模型。 Cox (1972) 提出了式 (3.3) 中的模型，该模型没有对基线风险函数 \\(h_0(t)\\) 的实际形式做出任何假设，因此该模型称为 Cox 回归模型或 Cox 比例风险模型。由于未对生存时间的概率分布做出特定的假设，Cox 回归模型是一个半参数模型，3.3 节将展示如何估计该模型中的 \\(\\beta\\) 系数。当然，我们往往还需要估计 \\(h_0(t)\\) 本身，我们将在 3.10 节中看到如何做到这一点。关于基线风险函数 \\(h_0(t)\\) 的形式做出特定假设的模型将在第 5 章和第 6 章中描述。 3.2 模型的线性部分 风险函数可能依赖于两种类型的 variables，即 variates 和因素。variate （以下称为变量）是一种 variable，它采用的数值通常是连续的测量尺度，如年龄或收缩压。因素是另一种 variable，它取一组有限的值，这些值称为因素的水平。例如，性别是一个有两个水平的因素，肿瘤类型也可能是一个因素，其水平对应于不同的组织，如鳞状细胞、腺细胞或小细胞。我们现在考虑如何将变量、因素以及结合变量和因素的项组合到 Cox 回归模型的线性部分中。 3.2.1 纳入一个变量 变量，无论是单独的还是组合的，都可以很容易地纳入 Cox 回归模型中。每个变量都以相应的 \\(\\beta\\) 系数出现在模型中。作为说明，请考虑风险函数取决于两个变量 \\(X_1\\) 和 \\(X_2\\) 的情况。第 \\(i\\) 个个体的这些变量的值分别为 \\(x_1i\\) 和 \\(x_2i\\)，\\(n\\) 个个体中第 \\(i\\) 个个体的 Cox 回归模型可写为 \\[\\begin{aligned}h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i})h_0(t)\\end{aligned}\\] 在这样的模型中，基线风险函数 \\(h_0(t)\\) 是模型中包含的所有变量均为 0 的个体的风险函数。 3.2.2 纳入一个因素 假设要建立一个风险函数仅依赖于单一因素 \\(A\\) 的模型，其中 \\(A\\) 有 \\(a\\) 个水平。那么，对于 \\(A\\) 的水平为 \\(j\\) 的个体，模型需纳入 \\(\\alpha_j\\) 这个项，它代表该因素水平 \\(j\\) 的效应。\\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_a\\) 称为因素 \\(A\\) 的主效应 (main effects). 根据 Cox 回归模型，\\(A\\) 的水平为 \\(j\\) 的个体的风险函数为 \\(\\exp(\\alpha_j)h_0(t)\\)。现在，基线风险函数 \\(h_0(t)\\) 定义为所有解释变量值均为 0 的个体的风险。为了与这一定义保持一致，其中一个 \\(\\alpha_j\\) 必须设为零。一种方法是采用约束条件 \\(\\alpha_1 = 0\\)，这对应于将基线风险视为 \\(A\\) 处于第一个水平的个体的风险。这将是后续分析中使用的约束条件。 通过为每个因素定义指示或虚拟变量 (indicator or dummy variable)，可以将包含与因素相对应的项的模型表示为解释变量的线性组合。当使用不允许直接拟合因素的计算机软件进行生存分析时，将需要这个步骤。 如果因素 \\(A\\) 的第一个水平设置为零，此时它成为该因素的基线水平，可以通过定义 \\(a−1\\) 个指标变量 \\(X_2,X_3,\\ldots,X_a\\) 以将项 \\(\\alpha_j\\) 纳入模型。这些指示变量的取值如表 3.1 所示。 表 3.1 通过包含 \\(a − 1\\) 个解释变量 \\(X_2,X_3,\\ldots,X_a\\) 以及系数 \\(\\alpha_2,\\alpha_3,\\ldots,\\alpha_a\\)，可以将项 \\(\\alpha_j\\) 纳入 Cox 回归模型的线性部分中。换句话说，模型中的项 \\(\\alpha_j\\) 被替换为 \\(\\alpha_{2}x_{2}+\\alpha_{3}x_{3}+\\cdots+\\alpha_{a}x_{a}\\)，其中 \\(x_j\\) 是 \\(A\\) 处于第 \\(j\\) 个水平的个体的 \\(X_j\\) 值，\\(j = 2, 3,...,a\\)。那么有 \\(a−1\\) 个参数与因素 \\(A\\) 的主效应相关，并且称 \\(A\\) 具有 \\(a − 1\\) 个自由度。 3.2.3 纳入一个交互作用 当模型中需要包含对应于多个因素的项时，可以像上面展示的那样，为每个因素定义一组指示变量。在这种情况下，在模型中纳入对应于两个或更多因素水平组合的个体效应的项也可能是合适的。这种效应称为交互作用 (interactions). 例如，假设这两个因素是患者的性别和肿瘤分级。如果肿瘤分级对不同性别患者死亡风险的效应不同，我们可以说这两个因素之间存在交互作用。风险函数将取决于这两个因素水平的组合。 一般来说，如果 \\(A\\) 和 \\(B\\) 是两个因素，并且死亡风险取决于 \\(A\\) 和 \\(B\\) 水平的组合，则称 \\(A\\) 和 \\(B\\) 发生了交互 (interact). 如果 \\(A\\) 和 \\(B\\) 分别具有 \\(a\\) 和 \\(b\\) 个水平，则表示这两个因素之间交互作用的项用 \\((\\alpha\\beta)_{jk}\\) 表示，其中 \\(j = 1, 2,...,a\\) 且 \\(k = 1, 2,...,b\\)。 在统计建模中，只能通过将交互作用项添加到已包含相应主效应的模型中来研究交互作用的效应。如果从模型中排除 \\(\\alpha_j\\) 或 \\(\\beta_k\\)，则项 \\((\\alpha\\beta)_{jk}\\) 表示一个因素嵌套 (nested) 在另一个因素中的效应。例如，如果模型中包含 \\(\\alpha_j\\)，但不包含 \\(\\beta_k\\)，则 \\((\\alpha\\beta)_{jk}\\) 是嵌套在 \\(A\\) 中的 \\(B\\) 的效应。如果 \\(\\alpha_j\\) 和 \\(\\beta_k\\) 均被排除，则项 \\((\\alpha\\beta)_{jk}\\) 表示 \\(A\\) 的水平 \\(i\\) 和 \\(B\\) 的水平 \\(j\\) 的组合对响应变量的效应。这意味着只有当 \\(\\alpha_j\\) 和 \\(\\beta_k\\) 同时包含在模型中时（这对应于 \\(A\\) 和 \\(B\\) 的主效应），\\((\\alpha\\beta)_{jk}\\) 才能被解释为交互效应。当我们在 3.6 节中考虑模型构建策略时，我们会回到这一点。 为了将项 \\((\\alpha\\beta)_{jk}\\) 包含在模型中，需要计算与主效应相关的指示变量的乘积。例如，如果 \\(A\\) 和 \\(B\\) 分别有 2 个和 3 个水平，则指示变量 \\(U_2\\) 和 \\(V_2,V_3\\) 的定义如表 3.2 所示。 表 3.2 令 \\(u_j\\) 和 \\(v_k\\) 分别为给定个体的 \\(U_j\\) 和 \\(V_k\\) 的值，其中 \\(j = 2, k = 2, 3\\)。然后通过在模型中包含由 \\(U_j\\) 和 \\(V_k\\) 的乘积形成的变量来拟合项 \\((\\alpha\\beta)_{jk}\\)。给定个体的乘积的相应值是 \\(u_jv_k\\)。该乘积的系数表示为 \\((\\alpha\\beta)_{jk}\\)，因此项 \\((\\alpha\\beta)_{jk}\\) 拟合为 \\[(\\alpha\\beta)_{22}u_2v_2+(\\alpha\\beta)_{23}u_2v_3\\] 因此，有两个与 \\(A\\) 和 \\(B\\) 交互作用相关的参数。一般来说，如果 \\(A\\) 和 \\(B\\) 分别具有 \\(a\\) 和 \\(b\\) 个水平，则双因素交互作用 \\(AB\\) 有 \\((a − 1)(b − 1)\\) 个与其相关的参数，换句话说 \\(AB\\) 有 \\((a − 1)(b − 1)\\) 个自由度。此外，只要 \\(A\\) 或 \\(B\\) 处于第一个水平，即 \\(j = 1\\) 或 \\(k = 1\\) 时，项 \\((\\alpha\\beta)_{jk}\\) 就等于 0. 3.2.4 纳入一个混合项 模型中可能需要的另一种项是由因素和变量构成的混合项 (mixed term). 当模型中某个变量的系数可能因因素的不同水平而有所差异时，会使用这种类型的项。例如，考虑一个避孕试验，其中对闭经期开始的时间（即长时间没有月经出血）进行建模。闭经的风险可能与女性的体重有关，但该变量的系数可能因女性以往怀孕次数的不同水平而有所不同。 变量 \\(X\\) 的系数与因素 \\(A\\) 水平之间的依赖关系可以通过在 Cox 回归模型的线性部分中包含项 \\(\\alpha_jx\\) 来表示，其中 \\(x\\) 是因素 \\(A\\) 处于第 \\(j\\) 水平的某个特定个体的 \\(X\\) 值，\\(j = 1, 2,...,a\\)。为了包含这样的项，我们为因素 \\(A\\) 定义指示变量 \\(U_j\\)，并将这些变量与每个个体的 \\(X\\) 值相乘。乘积 \\(U_jX\\) 的结果值为 \\(u_jx\\)，而模型中 \\(u_jx\\) 的系数为 \\(\\alpha_j\\)，其中 \\(j\\) 为因素 \\(A\\) 水平的索引。 如果使用与先前讨论中相同的指示变量定义，那么 \\(\\alpha_1\\)（即因素 \\(A\\) 为第一个水平的个体的 \\(X\\) 的系数）将为零。因此，必须将变量 \\(X\\) 以及乘积同时包含在模型中，否则无法对因素 \\(A\\) 第一水平的个体对 \\(X\\) 的依赖关系进行建模。一个例子可以使这一点更加清晰。 假设一项研究中共有九个个体，每个个体的变量 \\(X\\) 的值以及因素 \\(A\\) 的水平都已被记录。设 \\(A\\) 有三个水平，其中前三个个体的 \\(A\\) 处于第一水平，接下来三个个体的 \\(A\\) 处于第二水平，最后三个个体的 \\(A\\) 处于第三水平。为了对变量 \\(X\\) 的系数与因素 \\(A\\) 的水平之间的依赖关系进行建模，我们定义了两个指示变量 \\(U_2\\) 和 \\(U_3\\)，如表 3.3 所示。然后，将形成的解释变量 \\(U_2X\\) 和 \\(U_3X\\)（在表 3.3 的最后两列中给出）与变量 \\(X\\) 一起包含在模型的线性部分中。 表 3.3 设乘积 \\(U_2X\\) 和 \\(U_3X\\) 的值的系数分别为 \\(\\alpha^\\prime_2\\) 和 \\(\\alpha^\\prime_3\\)，设变量 \\(X\\) 的值在模型中的系数为 \\(\\beta\\)。那么，模型包含项 \\(\\beta x + \\alpha^\\prime_2(u_2x) + \\alpha^\\prime_3(u_3x)\\)。从表 3.3 中可以看出，对于因素 \\(A\\) 第一水平的个体，\\(u_2 = 0\\) 且 \\(u_3 = 0\\)，因此这些个体的 \\(x\\) 的系数仅为 \\(\\beta\\)。对于因素 \\(A\\) 第二水平的个体，\\(u_2 = 1\\) 且 \\(u_3 = 0\\)，\\(x\\) 的系数则为 \\(\\beta + \\alpha^\\prime_2\\)。类似地，在因素 \\(A\\) 的第三水平，\\(u_2 = 0\\) 且 \\(u_3 = 1\\)，\\(x\\) 的系数则为 \\(\\beta + \\alpha^\\prime_3\\)。 请注意，如果从模型中省略项 \\(\\beta x\\) ，个体 1, 2 和 3 的 \\(x\\) 的系数将为零，那么对于因素 \\(A\\) 第一水平的个体，就没有关于风险函数和变量 \\(X\\) 之间关系的信息。 通过以不同的方式定义指标变量可以避免前面段落中描述的操作。如果因素 \\(A\\) 有 \\(a\\) 个水平，并且希望在模型中包含项 \\(\\alpha_jx\\)，而不一定包含项 \\(\\beta x\\)，那么可以为 \\(A\\) 定义指示变量 \\(Z_1, Z_2,...,Z_a\\)，其中 \\(Z_j\\) 在 \\(A\\) 第 \\(j\\) 水平时为 1，否则为 0. 对应于个体的这些乘积 \\(z_1x, z_2x, ..., z_ax\\) 及其系数 \\(\\alpha_1, \\alpha_2,...,\\alpha_a\\) 一起纳入模型。这些是在 \\(A\\) 每个水平下 \\(x\\) 的系数。 现在，如果变量 \\(X\\) 与 \\(a\\) 个形如 \\(Z_jX\\) 的乘积一起纳入模型，那么将有 \\(a+1\\) 个项与 \\(a\\) 个系数相对应。因此，不可能获得这些 \\(\\alpha\\) 系数的唯一估计值，并且该模型是过度参数化的 (overparameterised). 可以通过强制 \\(a+1\\) 个系数中的一个为零来处理这种过度参数化问题。特别地，取 \\(\\alpha_1 = 0\\) 将相当于对指示变量进行重新定义：取 \\(Z_1\\) 为零。这将得到与已经讨论过的模型相同的公式。 在我们了解了如何拟合 Cox 回归模型之后，这些思想在实际数据集分析中的应用将在 3.4 节中进行说明。 3.3 拟合 Cox 回归模型 为一组生存数据拟合由式 (3.3) 定义的 Cox 回归模型，需要估计模型线性部分的解释变量 \\(X_1,X_2,...,X_p\\) 的未知系数 \\(\\beta_1,\\beta_2,...,\\beta_p\\)。同时，基线风险函数 \\(h_0(t)\\) 也可能需要进行估计。事实证明，模型的这两个部分可以分别进行估计。首先估计这些 \\(\\beta\\)，然后使用这些估计来构建基线风险函数的估计。这是一个重要的结果，因为这意味着为了对 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 对相对风险 \\(h_i(t)/h_0(t)\\) 的效应进行推断，我们不需要估计 \\(h_0(t)\\)。因此，\\(h_0(t)\\) 的估计方法将推迟到 3.10 节。 Cox 回归模型中的 \\(\\beta\\) 系数是模型中的未知参数，可以使用最大似然法 (method of maximum likelihood) 进行估计。为了操作这种方法，我们首先获得样本数据的似然 (likelihood). 这是观测数据的联合概率，被视为假设模型中未知参数的函数。对于 Cox 回归模型，这是模型线性部分中生存时间和未知 \\(\\beta\\) 参数的函数。\\(\\beta\\) 的估计是根据观测数据最有可能 (most likely) 得到的值。因此，这些最大似然估计是使似然函数最大化的值。从计算的角度来看，最大化似然函数的对数更方便。此外，可以从对数似然函数的二阶导数获得最大似然估计的方差的近似值。这里不提供细节，但附录 A 包含了最大似然估计理论的相关结果的总结。 假设有 \\(n\\) 个个体的可用数据，其中有 \\(r\\) 个不同的死亡时间和 \\(n−r\\) 个右删失生存时间。目前，我们假设在每个死亡时间只有一个人死亡，因此数据中不存在结 (ties). 结的处理将在 3.3.2 节中进行讨论。\\(r\\) 个有序死亡时间表示为 \\(t_{(1)}&lt;t_{(2)}&lt;\\cdots&lt;t_{(r)}\\)，因此 \\(t_{(j)}\\) 是第 \\(j\\) 个有序死亡时间。在时间 \\(t_{(j)}\\) 处于风险的个体集合由 \\(R(t_{(j)})\\) 表示，因此 \\(R(t_{(j)})\\) 是在 \\(t_{(j)}\\) 之前的时刻活着且未删失的个体的集合。量 \\(R(t_{(j)})\\) 称为风险集 (risk set). Cox (1972) 表明，与式 (3.3) 中的模型相关的似然函数由下式给出 \\[\\begin{equation} L(\\boldsymbol{\\beta})=\\prod_{j=1}^r\\frac{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_{(j)})}{\\sum_{l\\in R(t_{(j)})}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)} \\tag{3.4} \\end{equation}\\] 其中 \\(\\boldsymbol{x}_{(j)}\\) 是在第 \\(j\\) 个有序死亡时间 \\(t_{(j)}\\) 处死亡的个体的协变向量 (vector of covarites). 该似然函数分母中的求和运算是对在时间 \\(t_{(j)}\\) 处于风险中的所有个体的 \\(\\exp(\\boldsymbol \\beta^\\prime \\boldsymbol x)\\) 进行的。请注意，乘积运算是对所有有死亡时间记录的个体进行的。生存时间删失的个体对对数似然函数的分子没有贡献，但它们参与了发生在删失之前的死亡时间风险集的求和运算。 所得似然函数不是真正的似然，因为它没有直接使用实际的删失和未删失的生存时间。因此，它称为偏似然函数 (partial likelihood function). 式 (3.4) 中的似然函数仅取决于死亡时间的排序，因为这决定了每个死亡时间的风险集。因此，关于解释变量对风险函数效应的推断仅取决于生存时间的秩次。 现在假设数据由 \\(n\\) 个生存时间组成，用 \\(t_1, t_2,...,t_n\\) 来表示，\\(\\delta_i\\) 是一个事件指示符，如果第 \\(i\\) 个生存时间 \\(t_i, i = 1, 2,...,n\\) 是右删失的，则 \\(\\delta_i\\) 为 0，否则为 1。式 (3.4) 中的偏似然函数可以表示为以下形式 \\[\\begin{equation} \\prod_{i=1}^n\\left\\{\\frac{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)}{\\sum_{l\\in R(t_i)}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)}\\right\\}^{\\delta_i} \\tag{3.5} \\end{equation}\\] 其中 \\(R(t_{(j)})\\) 是在时间 \\(t_i\\) 处的风险集。根据式 (3.5) ，相应的偏对数似然函数由下式给出 \\[\\begin{equation} \\log L(\\boldsymbol{\\beta})=\\sum_{i=1}^n\\delta_i\\left\\{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i-\\log\\sum_{l\\in R(t_i)}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)\\right\\} \\tag{3.6} \\end{equation}\\] Cox 回归模型中 \\(\\boldsymbol \\beta\\) 参数的最大似然估计可以通过使用数值方法最大化此对数似然函数来得到。这种最大化通常是使用下面 3.3.3 节描述的 Newton-Raphson 程序来完成的。 幸运的是，大多数用于生存分析的统计软件都可以拟合 Cox 回归模型。通常软件还会给出拟合模型中参数估计的标准误。 3.3.1 节给出了使用式 (3.4) 作为似然函数的理由以及似然函数结构的进一步细节。然后，3.3.2 节讨论了绑定生存时间的处理，3.3.3 节概述了 Newton-Raphson 程序。这三个部分可以省略而不失阅读的连贯性。 3.3.1 模型的似然函数 在 Cox 回归模型中，第 \\(i(i=1,2,\\ldots,n)\\) 个个体在时间 \\(t\\) 的死亡风险为 \\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)h_0(t)\\end{aligned}\\] 其中 \\(\\boldsymbol \\beta\\) 是 \\(p\\) 个解释变量系数的向量，其值为 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\)。第 \\(i\\) 个个体的 \\(h_0(t)\\) 是未指定形式的基线风险函数。 构建该模型的似然函数的思想是，连续死亡时间之间的区间并不提供关于解释变量对死亡风险效应的信息。这是因为基线风险函数具有任意形式，因此可以想象，在没有死亡的那些时间区间内，\\(h_0(t)\\) 以及 \\(h_i(t)\\) 都是零。这反过来意味着这些区间不提供有关 \\(\\beta\\) 参数值的任何信息。因此，我们考虑第 \\(i\\) 个个体在某个时间 \\(t_{(j)}\\) 死亡的概率，前提是 \\(t_{(j)}\\) 是 \\(r\\) 个死亡时间 \\(t_{(1)},t_{(2)},\\ldots,t_{(r)}\\) 中的一个。如果将在 \\(t_{(j)}\\) 时死亡的个体的解释变量值表示为 \\(\\boldsymbol x_{(j)}\\)，则该概率为 \\[\\begin{equation} \\text{P}(\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }t_{(j)}\\mid t_{(j)}\\text{ 发生一个死亡}) \\tag{3.7} \\end{equation}\\] 而在事件 \\(B\\) 已发生的条件下，事件 \\(A\\) 发生的概率由下式给出 \\[\\begin{aligned}\\mathrm{P}(A\\mid B)=\\mathrm{P}(A\\text{ and }B)/\\mathrm{P}(B)\\end{aligned}\\] 因此式 (3.7) 成为 \\[\\begin{equation} \\frac{\\mathrm{P}(\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }t_{(j)})}{\\mathrm{P}(t_{(j)}\\text{ 发生一个死亡})} \\tag{3.8} \\end{equation}\\] 假设死亡时间彼此独立，因此该表达式的分母是在时间 \\(t_{(j)}\\) 时所有有死亡风险的个体的死亡概率之和。如果这些个体由 \\(l\\) 索引，其中 \\(R(t_{(j)})\\) 表示在时间 \\(t_{(j)}\\) 处于风险的个体集，则式 (3.8) 变为 \\[\\begin{equation} \\frac{\\mathrm{P}\\left(\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }t_{(j)}\\right)}{\\sum_{l\\in R(t_{(j)})}\\mathrm{P}\\left(\\text{个体 }l\\text{ 死于 }t_{(j)}\\right)} \\tag{3.9} \\end{equation}\\] 现在以区间 \\((t_{(j)},t_{(j)}+\\delta t)\\) 中的死亡概率代替式 (3.9) 中时间 \\(t_{(j)}\\) 处的死亡概率，再将分子和分母同时除以 \\(\\delta t\\)，我们得到 \\[\\frac{\\mathrm{P}\\left(\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }(t_{(j)},t_{(j)}+\\delta t)\\right)\\big/\\delta t}{\\sum_{l\\in R(t_{(j)})}\\mathrm{P}\\left(\\text{个体 }l\\text{ 死于 }(t_{(j)},t_{(j)}+\\delta t)\\right)\\big/\\delta t}\\] 当 \\(\\delta t\\) 趋近于 0 时，这个表达式的极限值就是式 (3.8) 中概率的比值。根据式 (1.3) ，这个极限也是时间 \\(t_{(j)}\\) 时相应死亡风险的比值，即 \\[\\frac{\\text{变量为 }\\boldsymbol x_{(j)}\\text{ 的个体死于 }t_{(j)}\\text{ 的风险}}{\\sum_{l\\in R(t_{(j)})}\\{\\text{个体 }l\\text{ 死于 }t_{(j)}\\text{ 的风险}\\}}\\] 如果在 \\(t_{(j)}\\) 死亡是第 \\(i\\) 个个体，则该表达式分子中的风险函数可以写成 \\(h_i(t_{(j)})\\)。同样，分母是在时间 \\(t_{(j)}\\) 时所有有死亡风险的个体的死亡风险的总和。这是在时间 \\(t_{(j)}\\) 的风险集 \\(R(t_{(j)})\\) 中的所有个体的 \\(h_l(t_{(j)})\\) 的总和。因此，式 (3.7) 中的条件概率变为 \\[\\frac{h_i(t_{(j)})}{\\sum_{l\\in R(t_{(j)})}h_l(t_{(j)})}\\] 在使用式 (3.8) 时，分子和分母中的基线风险函数被抵消，剩下 \\[\\frac{\\exp(\\boldsymbol{\\beta&#39;x}_{(j)})}{\\sum_{l\\in R(t_{(j)})}\\exp(\\boldsymbol{\\beta&#39;x}_l)}\\] 最后，取这些条件概率关于 \\(r\\) 个死亡时间的乘积，得到式 (3.4) 中的偏似然函数。 为了进一步阐明偏似然的结构，考虑由五个个体构成的生存数据样本，编号从 1 到 5. 生存数据如图 3.1 所示。个体 2 和 5 的生存时间是右删失的，并且三个有序的死亡时间表示为 \\(t_{(1)}&lt;t_{(2)}&lt;t_{(3)}\\)。那么，\\(t_{(1)}\\) 是个体 3 的死亡时间，\\(t_{(2)}\\) 是个体 1 的死亡时间并且 \\(t_{(1)}\\) 是个体 4 的死亡时间。 图 3.1 在三个有序死亡时间中，在每个死亡时间下的风险集由在每个死亡时间之前活着且未删失的个体组成。因此，风险集 \\(R(t_{(1)})\\) 由所有 5 个个体组成，风险集 \\(R(t_{(2)})\\) 由个体 1, 2 和 4 组成，而风险集 \\(R(t_{(3)})\\) 仅包括个体 4. 现在记 \\(\\psi(i)=\\exp(\\boldsymbol{\\beta&#39;x}_i),i=1,2,\\ldots,5\\)，其中 \\(\\boldsymbol{x}_i\\) 为第 \\(i\\) 个个体的解释变量。时间 \\(t_{(1)},t_{(2)}\\) 和 \\(t_{(3)}\\) 处的偏似然函数的分子分别为 \\(\\psi(3),\\psi(2)\\) 和 \\(\\psi(4)\\)，因为个体 3, 1 和 4 分别死于在这三个有序的死亡时间。跨这三个死亡时间的偏似然函数为 \\[\\begin{aligned}\\frac{\\psi(3)}{\\psi(1)+\\psi(2)+\\psi(3)+\\psi(4)+\\psi(5)}\\times\\frac{\\psi(1)}{\\psi(1)+\\psi(2)+\\psi(4)}\\times\\frac{\\psi(4)}{\\psi(4)}\\end{aligned}\\] 结果表明，在最大似然估计中使用的标准结果无需修改即可直接应用于最大偏似然估计。具体来说，附录 A 中给出的 \\(\\beta\\) 估计的方差-协方差矩的结果可以使用，与似然比检验相关的分布结果也可以使用，这些将在 3.5 节中讨论。 3.3.2 结的处理 生存数据的 Cox 回归模型假设风险函数是连续的，在这个假设下，生存时间结 (tied survival times) 是不可能存在的。当然，生存时间通常记录到最接近的天、月或年，因此这种四舍五入的过程可能会导致生存时间结的出现。事实上，第一章中的示例 1.2, 1.3 和 1.4 都包含了观测结 (tied observations). 除了可能在某特定时间有多个死亡外，在死亡时间可能还存在一个或多个删失观测值。当在某特定时间同时存在删失和死亡时，我们假设删失发生在所有死亡之后。需要考虑如下问题：哪些个体应被纳入该死亡时间的风险集，并且使用式 (3.4) 计算似然函数时，如何处理删失观测结 (tied censored observations) 以防止带来进一步的计算困难。因此，我们需要考虑在拟合 Cox 回归模型时如何处理生存时间结。 为了处理观测结，必须对式 (3.4) 中的似然函数进行某种修改。Kalbfleisch and Prentice (2002) 已经给出了存在观测结时合适的似然函数。然而，该似然函数的形式非常复杂，这里不再赘述。此外，该似然函数的计算可能非常耗时，尤其是在一个或多个死亡时间存在大量结的情况时。幸运的是，似然函数有一些近似计算方法，它们在计算上比精确方法更具优势。但在给出这些近似方法之前，还需要引入一些额外的记号。 设 \\(\\boldsymbol{s}_{j}\\) 为在第 \\(j\\) 个死亡时间 \\(t_{(j)}\\) 死亡的个体的 \\(p\\) 个协变向量之和，其中 \\(j = 1, 2,...,r\\)。如果在 \\(t_{(j)}\\) 有 \\(d_j\\) 个死亡事件，\\(\\boldsymbol{s}_{j}\\) 的第 \\(h\\) 个元素为 \\(s_{{h}j}=\\sum_{{k}=1}^{{d}_j}x_{{h}jk}\\)，其中 \\(x_{hjk}\\) 是死于第 \\(j\\) 个死亡时间 \\(t_{(j)}\\) 的 \\(d_j\\) 个个体中第 \\(k\\) 个个体的第 \\(h\\) 个解释变量的值，其中 \\(h = 1, 2,...,p,k = 1, 2,...,d_j,j = 1, 2,...,r\\)。 似然函数最简单的近似是由 Breslow (1974) 提出的近似似然函数 \\[\\begin{equation} \\prod_{j=1}^r\\frac{\\exp(\\boldsymbol{\\beta&#39;s}_j)}{\\left\\{\\sum_{l\\in R(t_{(j)})}\\exp(\\boldsymbol{\\beta&#39;x}_l)\\right\\}^{d_j}} \\tag{3.10} \\end{equation}\\] 在这个近似中，我们认为在时间 \\(t_{(j)}\\) 发生的 \\(d_j\\) 个死亡是不同的且按顺序发生的。然后，将所有可能的死亡序列的概率求和，以得到式 (3.10) 中的似然函数。Peto (1972) 也提出了类似的近似方法，区别只在一个比例常数。该似然函数计算起来相当直接，当任何一个死亡时间的观测结数量不是太大时，它是一个充分的近似。出于这些原因，这种方法通常是用于生存分析统计软件处理结的默认程序，会在本书中给出的示例中使用。 Efron (1977) 提出 \\[\\begin{equation} \\prod_{j=1}^r\\frac{\\exp(\\boldsymbol{\\beta}^{\\prime}s_j)}{\\prod_{k=1}^{d_j}\\left[\\sum_{l\\in R(t_{(j)})}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)-(k-1)d_j^{-1}\\sum_{l\\in D(t_{(j)})}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_l)\\right]} \\tag{3.11} \\end{equation}\\] 作为 Cox 回归模型的近似似然函数，其中 \\(D(t_{(j)})\\) 是在时间 \\(t_{(j)}\\) 死亡的所有个体的集合。这比 Breslow 的近似更接近于合适的似然函数，尽管这两种近似在实践中往往给出相似的结果。 Cox (1972) 建议如下近似 \\[\\begin{equation} \\prod_{j=1}^r\\frac{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{s}_j)}{\\sum_{l\\in R(t_{(j)};d_j)}\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{s}_l)} \\tag{3.12} \\end{equation}\\] 其中 \\(R(t_{(j)};d_j)\\) 表示从 \\(R(t_{(j)})\\) 抽取的一组 \\(d_j\\) 个个体，其中 \\(R(t_{(j)})\\) 为 \\(t_{(j)}\\) 处的风险集。分母中的求和运算是对风险集中所有可能的含 \\(d_j\\) 个个体的集合进行的，其中的抽样是无放回的。式 (3.12) 中的近似基于时间尺度是离散的这一情况的模型，因此在这个模型下，允许存在观测结。现在，根据第 1 章 1.4.2 节，解释变量向量为 \\(\\boldsymbol x_i\\) 的个体的风险函数, \\(h_i(t)\\) 是单位时间区间 \\((t, t + 1)\\) 内的死亡概率，前提是以生存到了时间 \\(t\\)。式 (3.3) 的 Cox 回归模型的离散版本为 \\[\\frac{h_i(t)}{1-h_i(t)}=\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)\\frac{h_0(t)}{1-h_0(t)}\\] 其似然函数如式 (3.12) 所示。事实上，在离散时间区间长度趋于零的极限下，该模型趋于式 (3.3) 的 Cox 回归模型。 当没有结时，即在每个死亡时间有 \\(d_j = 1\\) 时，式 (3.10), (3.11) 和 (3.12) 中的近似都简化为式 (3.4) 中的似然函数。 3.3.3 Newton-Raphson 程序 含删失生存数据的模型通常通过使用 Newton-Raphson 程序来最大化偏似然函数来拟合，本节概述了该程序。 令 \\(\\boldsymbol{u}(\\boldsymbol{\\beta})\\) 为式 (3.6) 中对数似然函数关于 \\(\\boldsymbol \\beta\\) 参数的一阶导数，为 \\(p × 1\\) 向量。这个量称为有效得分向量 (vector of efficient scores). 此外，设 \\(\\boldsymbol{I}(\\boldsymbol{\\beta})\\) 是对数似然二阶导数负数的 \\(p × p\\) 矩阵，则 \\(\\boldsymbol{I}(\\boldsymbol{\\beta})\\) 的第 \\((j,k)\\) 元素为 \\[-\\frac{\\partial^2\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j\\partial\\beta_k}\\] 矩阵 \\(\\boldsymbol{I}(\\boldsymbol{\\beta})\\) 称为观测信息矩阵 (observed information matrix). 根据 Newton-Raphson 程序，第 \\((s + 1)\\) 轮迭代的 \\(\\boldsymbol\\beta\\) 参数向量估计 \\(\\hat {\\boldsymbol \\beta}_{s+1}\\) 为 \\[\\hat{\\boldsymbol{\\beta}}_{s+1}=\\hat{\\boldsymbol{\\beta}}_s+\\boldsymbol{I}^{-1}(\\hat{\\boldsymbol{\\beta}}_s)\\boldsymbol{u}(\\hat{\\boldsymbol{\\beta}}_s)\\] 其中 \\(s=0,1,2,\\ldots\\)。\\(\\boldsymbol{u}(\\hat{\\boldsymbol{\\beta}}_s)\\) 为有效得分向量，\\(\\boldsymbol{I}^{-1}(\\hat{\\boldsymbol{\\beta}}_{s})\\) 为信息矩阵的逆，这两个量都在 \\(\\hat {\\boldsymbol \\beta}_{s}\\) 处计算。该程序可以以 \\(\\hat {\\boldsymbol \\beta}_{0}=\\boldsymbol 0\\) 开始。当对数似然函数的变化足够小时，或者当参数估计的最大相对变化足够小时，该程序终止。 当迭代程序收敛时，参数估计的方差-协方差阵可以通过信息矩阵的逆来近似，在 \\(\\hat {\\boldsymbol \\beta}\\) 处计算，即 \\(\\boldsymbol{I}^{-1}(\\hat{\\boldsymbol{\\beta}})\\)。该矩阵对角元的平方根就是 \\(\\beta_{1},\\beta_{2},\\ldots,\\beta_{p}\\) 估计的标准误。 3.4 置信区间和假设检验 当使用统计软件拟合 Cox 回归模型时，提供的参数估计值通常附带其标准误。这些标准误可用于获取未知 \\(\\beta\\) 参数的近似置信区间。具体来说，参数 \\(\\beta\\) 的 \\(100(1 − \\alpha)\\%\\) 置信区间是上下限为 \\(\\hat{\\beta}\\pm z_{\\alpha/2}\\operatorname{se}\\left(\\hat{\\beta}\\right)\\) 的区间，其中 \\(\\hat{\\beta}\\) 是 \\({\\beta}\\) 的估计，\\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。 如果 \\({\\beta}\\) 的 \\(100(1 − \\alpha)\\%\\) 置信区间不包括零，则这是 \\({\\beta}\\) 的值不为零的证据。更具体地说，可以通过计算统计量 \\(\\hat{\\beta}/\\operatorname{se}{(\\hat{\\beta})}\\) 的值来检验声称 \\(\\beta = 0\\) 的原假设。然后将该统计量的观测值与标准正态分布的百分位点进行比较，以获得相应的 \\(P\\) 值。等价地，该统计量的平方可以与自由度为一的卡方分布的百分位点进行比较。这一程序有时称为 Wald 检验，该检验的 \\(P\\) 值通常与计算机输出中的参数估计及其标准误一起给出。 当试图解释给定参数 \\(\\beta_j\\) 的 \\(P\\) 值时，重要的是要认识到正在检验的假设是在模型中其他所有项都存在的情况下的 \\(\\beta_j = 0\\)。例如，假设一个模型包含三个解释变量 \\(X_1,X_2,X_3\\)，并且它们的真实系数是 \\(\\beta_1,\\beta_2,\\beta_3\\)。然后使用检验统计量 \\(\\hat{\\beta}_2/\\text{ se }(\\hat{\\beta}_2)\\) 来检验在存在 \\(\\beta_1\\) 和 \\(\\beta_3\\) 的情况下 \\(\\beta_2=0\\) 的原假设。如果没有证据拒绝这一假设，我们将得出结论，在存在 \\(X_1\\) 和 \\(X_3\\) 的情况下，模型不需要 \\(X_2\\) 的存在。 一般来说，Cox 回归模型中各个 \\(\\beta\\) 的单独估计并不是相互独立的。这意味着检验模型中关于 \\(\\beta\\) 参数的单独假设的结果可能不容易解释。例如，再次考虑有三个解释变量 \\(X_1,X_2,X_3\\) 的情况。如果与它们的标准误相比，\\(\\hat \\beta_1\\) 和 \\(\\hat \\beta_2\\) 未发现与零有显著差异，我们不能得出模型中只需要包含 \\(X_3\\) 的结论。这是因为，例如，当 \\(X_2\\) 从模型中排除时，\\(X_1\\) 的系数可能会发生变化，反之亦然。如果 \\(X_1\\) 和 \\(X_2\\) 存在相关性，这种情况肯定会发生。 由于难以解释模型中解释变量系数的检验结果，因此需要使用替代方法来比较不同的 Cox 回归模型。事实证明，3.5 节中描述的方法比 Wald 检验更令人满意。因此，应谨慎对待基于计算机的生存数据分析中给出的 Wald 检验结果。 3.4.1 风险比的标准误和置信区间 我们已经看到，在存在两组生存数据的情况下，Cox 回归模型中的参数 \\(\\beta\\) 是一组个体在时间 \\(t\\) 相对于另一组个体的死亡风险比的对数。风险比本身是 \\(\\psi=e^{\\beta}\\)。风险比的相应估计为 \\(\\hat{\\psi}=\\exp(\\hat{\\beta})\\)，并且使用第 2 章式 (2.8) 给出的结果，可以从 \\(\\hat \\beta\\) 的标准误中获得 \\(\\hat \\psi\\) 的标准误。根据这一结果，作为 \\(\\hat \\beta\\) 的函数，\\(\\hat \\psi\\) 的近似方差为 \\[\\left\\{\\exp(\\hat{\\beta})\\right\\}^2\\mathrm{~var~}(\\hat{\\beta})\\] 也就是 \\(\\hat{\\psi}^2\\text{ var }(\\hat{\\beta})\\)，则 \\(\\hat{\\psi}\\) 的标准误为 \\[\\begin{equation} \\text{se }(\\hat{\\psi})=\\hat{\\psi}\\text{ se }(\\hat{\\beta}) \\tag{3.13} \\end{equation}\\] 一般来说，真实风险比的置信区间比风险比估计的标准误更具信息性。真实风险比 \\(\\psi\\) 的 \\(100(1 − \\alpha)\\%\\) 置信区间可以通过对 \\(\\beta\\) 的置信限进行指数运算来找到。以这种方式获得的区间估计优于使用 \\(\\hat{\\psi}\\pm z_{\\alpha/2}\\operatorname{se}\\left(\\hat{\\psi}\\right)\\) 获得的估计。这是因为风险比估计的对数的分布比风险比本身的分布更接近正态分布。 下面的示例 3.1 说明了风险比置信区间的构造。3.9 节给出了 Cox 回归模型线性部分中参数解释的更详细信息。 3.4.2 两个示例 在本节中，我们将用第 1 章中介绍的两个示例的数据拟合一个 Cox 回归模型。 示例 3.1 (患乳腺癌妇女的预后) 在示例 1.2 中给出了按肿瘤切片是否呈阳性染色分类的乳腺癌患者生存时间数据。指示染色结果的变量可视为具有两个水平的因素。根据 3.2.2 节中的论述，这个因素可以通过使用指示变量 \\(X\\) 来表示染色结果，其中 \\(X = 0\\) 对应于阴性染色，\\(X = 1\\) 对应于阳性染色。在 Cox 回归模型下，对于指示变量值为 \\(x_i\\) 的第 \\(i\\) 名女性，她在时间 \\(t\\) 的死亡风险是 \\[h_i(t)=e^{\\beta x_i}h_0(t)\\] 其中 \\(x_i\\) 为 0 或 1. 基线风险函数 \\(h_0(t)\\) 是肿瘤染色阴性的女性的风险函数。这本质上是 3.1.1 节中考虑的模型，并由式 (3.2) 给出。 在肿瘤染色呈阳性的女性群体中，有两人在第 26 个月时死亡。使用似然函数的 Breslow 近似来处理这个结。该模型是通过找到使式 (3.10) 中的似然函数最大化的 \\(\\beta\\) 值，即 \\(\\hat \\beta\\)，来拟合的。\\(\\beta\\) 的最大似然估计值是 \\(\\hat \\beta=0.908\\)。该估计的标准误也可以从用于拟合 Cox 回归模型的统计软件中获得，结果是 \\(\\text{se}\\left(\\hat{\\beta}\\right)=0.501\\)。 量 \\(e^\\beta\\) 是 \\(X = 1\\) 的女性与 \\(X = 0\\) 的女性的风险函数之比，因此 \\(\\beta\\) 是阳性染色女性相对于阴性染色女性在任意时间 \\(t\\) 的死亡风险比的对数。这个风险比的估计是 \\(e^0.908 = 2.48\\)。由于这个值大于 1，我们得出结论，肿瘤呈阳性染色的女性在任何给定时间的死亡风险将高于肿瘤呈阴性染色的女性。因此，阳性染色的乳腺癌患者的预后较差。 使用式 (3.13) 中的结果，可以从 \\(\\beta\\) 的标准误中找到风险比的标准误。由于相对风险估计为 \\(\\hat{\\psi}=\\exp(\\hat{\\beta})=2.480\\)，并且 \\(\\hat \\beta\\) 的标准误为 0.501，因此 \\(\\hat{\\psi}\\) 的标准误由下式给出 \\[\\mathrm{se}\\left(\\hat{\\psi}\\right)=2.480\\times0.501=1.242\\] 我们可以进一步为这个风险比构造一个置信区间。第一步是为风险比的对数 \\(\\beta\\) 获得一个置信区间。例如，\\(\\beta\\) 的 95% 置信区间为 \\(\\hat{\\beta}-1.96\\text{se}(\\hat{\\beta})\\) 到 \\(\\hat{\\beta}+1.96\\text{se}(\\hat{\\beta})\\)，即从 −0.074 到 1.890 的区间。对这些置信限进行指数运算，得到风险比本身的 95% 置信区间为 \\((0.93, 6.62)\\)。请注意，这个区间几乎不包含 1，有证据表明两组女性的生存经历不同。 示例 3.2 (多发性骨髓瘤患者的生存率) 在示例 1.3 中给出了 48 名患有多发性骨髓瘤的患者的生存时间数据。数据中还包含了为每位患者记录的七个其他变量的值。为方便起见，描述患者性别的变量的值已被重新定义，其中男性为 0 ，女性为 1。患者的性别和与 Bence-Jones 蛋白出现情况相关的变量是具有两个水平的因素，这些项通过使用指示变量 Sex 和 Protein 进行拟合。建模过程中使用的变量如下 \\(Age\\)：患者的年龄 \\(Sex\\)：患者的性别（0 = 男性，1 = 女性） \\(Bun\\)：血尿素氮 \\(Ca\\)：血清钙 \\(Hb\\)：血清血红蛋白 \\(Pcells\\)：浆细胞百分比 \\(Protein\\)：Bence Jones 蛋白（0 = 不存在，1 = 存在） 第 \\(i\\) 个个体的 Cox 回归模型为 \\[\\begin{aligned}h_i(t)=\\exp&amp;(\\beta_1Age_i+\\beta_2Sex_i+\\beta_3Bun_i+\\beta_4Ca_i+\\beta_5Hb_i+\\beta_6Pcells_i\\\\&amp;+\\beta_7Protein_i)h_0(t)\\end{aligned}\\] 其中解释变量下标 \\(i\\) 表示该变量对于第 \\(i\\) 个个体的值。基线风险函数是指这七个变量的值都为 0 的个体的风险函数，即，该函数对应于一个年龄为 0 的男性，其 Bun, Ca, Hb 和 Pcells 的值都为 0，并且没有 Bence-Jones 蛋白。鉴于该函数在解释上的明显困难，通过减去平均患者 (average patient) 的值来重新定义 Age, Bun, Ca, Hb 和 Pcells 变量可能更为合理。例如，如果我们用 Age - 60 代替 Age，那么基线风险就会对应于一个 60 岁的男性。这个程序也避免了引入一个描述年龄与研究中患者年龄范围相差较大的个体的风险函数。尽管这使基线风险函数具有更自然的解释，但不会影响关于解释变量对死亡风险影响的推断。因此，在这个例子中，我们使用未转换的变量。在拟合模型后，解释变量的系数及其标准误的估计如表 3.4 所示。 表 3.4 我们从表 3.4 中看到，一些估计接近于零。事实上，如果为七个变量的系数单独计算 95% 置信区间，则只有 Bun 和 Hb 的置信区间不包含零。这表明风险函数并不依赖于所有七个解释变量。 我们不能由此推断 Bun 和 Hb 是有意义的变量，因为拟合模型中七个解释变量的系数估计并不是相互独立的。这意味着如果七个解释变量中的一个从模型中排除，剩余六个变量的系数可能与表 3.4 中的系数不同。例如，如果排除 Bun，剩余的六个解释变量 Age, Sex, Ca, Hb, Pcells 和 Protein 的系数估计分别为 -0.009, -0.301, -0.036, -0.140, -0.001 和 -0.420. 与表 3.4 中的值进行比较，这六个变量的系数估计都存在差异，尽管差异不是很大。 一般来说，为了确定风险函数依赖于七个解释变量中的哪些，需要拟合许多不同的模型，并对结果进行比较。本章后续部分将讨论比较不同模型拟合优度的方法以及模型构建的策略。 3.5 比较替代模型 在分析生存数据的建模方法中，会建立一个模型来描述风险函数关于一个或多个解释变量的依赖关系。在建模过程中，会拟合包含不同项集的线性部分的 Cox 回归模型，并对它们进行比较。 以一个具体例子来说，考虑有两组生存时间的情况，这两组分别对应接受新疗法和接受标准疗法的个体。在没有治疗差异的模型下的共同风险函数可以表示为 \\(h0_(t)\\)。这个模型是式 (3.3) 中一般比例风险模型的特例，其中模型的线性部分没有解释变量。因此，这个模型称为零模型 (null model). 现在，设 \\(X\\) 为一个指示变量，对于接受标准治疗的个体，其取值为 0，否则取值为 1. 在比例风险模型下，对于 \\(X\\) 取值为 \\(x\\) 的个体，其风险函数为 \\(e^{\\beta x}h_0(t)\\)。因此，接受标准疗法和新疗法的个体的风险函数分别为 \\(h_0(t)\\) 和 \\(e^\\beta h_0(t)\\)。这个模型与零模型的区别在于，后者的线性部分包含了额外的项 \\(\\beta x\\)。由于 \\(\\beta=0\\) 对应于没有治疗效果，因此可以通过比较这两个 Cox 回归模型对生存数据的拟合情况，来研究治疗差异的程度。 更一般地，假设对于特定的数据集，我们考虑了两个模型，即模型 (1) 和模型 (2). 其中，模型 (1) 包含模型 (2) 中的一部分项。那么模型 (1) 称为以参数方式嵌套 (parametrically nested) 在模型 (2) 内。具体来说，假设在模型 (1) 中拟合了 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\)，因此该模型的风险函数可以写为 \\[\\exp\\{\\beta_1x_1+\\beta_2x_2+\\cdots+\\beta_px_p\\}h_0(t)\\] 还假设在模型 (2) 中拟合了 \\(p+q\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p,X_{p+1},\\ldots,X_{p+q}\\)，该模型的风险函数为 \\[\\exp\\{\\beta_1x_1+\\cdots+\\beta_px_p+\\beta_{p+1}x_{p+1}+\\cdots+\\beta_{p+q}x_{p+q}\\}h_0(t)\\] 模型 (2) 包含 \\(q\\) 个额外的解释变量 \\(x_{p+1},x_{p+2},\\ldots,x_{p+q}\\)。由于模型 (2) 比模型 (1) 具有更多的项，因此模型 (2) 一定对观测数据拟合得更好。因此，统计问题是要确定模型 (2) 中额外的个 \\(q\\) 项是否显著提高了模型的解式释能力。如果不是，它们可能被省略，并认为模型 (1) 是充分的。 在 3.2 节的例子中，我们了解到当存在多个可能对问题有意义的解释变量时，每个项的效应不能独立于其他效应进行研究。因此，任何给定项的效应都取决于当前模型中包含的其他项。例如，在模型 (1) 中，任何 \\(p\\) 个解释变量对风险函数的效应都取决于已拟合的 \\(p-1\\) 个变量，而认为 \\(X_p\\) 的效应是经剩余的 \\(p-1\\) 个变量调整的 (adjusted). 具体来说，\\(X_p\\) 的效应经 \\(X_1,X_2,\\ldots,X_{p-1}\\) 的调整，但我们也会说 \\(X_p\\) 的效应消除了或考虑了 (eliminating or allowing for) \\(X_1,X_2,\\ldots,X_{p-1}\\) 的效应。类似地，当 \\(q\\) 个变量 \\(X_{p+1},X_{p+2},\\ldots,X_{p+q}\\) 加入到模型 (1) 中时，认为这些变量对风险函数的效应是经已拟合的 \\(p\\) 个变量 \\(X_1,X_2,\\ldots,X_p\\) 的调整的。 3.5.1 \\(-2\\log\\hat{L}\\) 统计量 为比较为同一组生存数据拟合的不同模型，我们需要一个能够衡量特定模型对数据拟合程度的统计量。由于似然函数总结了数据中关于给定模型中未知参数的信息，因此一个合适的总结统计量是似然函数在其最大似然估计处的值。这得到了假设模型下的最大化似然，或在 Cox 回归模型的情况下是最大化偏似然。这个统计量可以通过将式 (3.4) 中的 \\(\\beta\\) 替换为模型下的最大似然估计来计算。对于给定的一组数据，最大似然值越大，模型与数据之间的一致程度就越好。 出于后续讨论的原因，在比较不同模型时，使用负二倍对数最大似然更为方便。如果给定模型的最大似然值用 \\(\\hat L\\) 表示，那么模型与数据之间一致程度的总结度量就是 \\(-2\\log\\hat L\\)。根据 3.3.1 节，\\(\\hat L\\) 实际上是一系列条件概率的乘积，因此这个统计量将小于 1. 因此，\\(-2\\log\\hat L\\) 总是正的，对于给定的数据集，\\(-2\\log\\hat L\\) 的值越小，模型就越好。 统计量 \\(-2\\log\\hat L\\) 不能单独用作衡量模型充分性的指标。原因在于 \\(\\hat L\\) 以及由此得到的 \\(-2\\log\\hat L\\) 的值，取决于数据集中的观测数量。因此，如果在对一组数据拟合模型后，又获得了其他数据，且这些新数据适用于使用原始数据建立的模型。那么扩充后的数据集的 \\(-2\\log\\hat L\\) 值将与原始数据的值不同。因此，\\(-2\\log\\hat L\\) 的值仅在比较为相同数据集拟合的不同模型时才有用。 3.5.2 比较嵌套模型 再次考虑之前定义的模型 (1) 和模型 (2)，其中模型 (1) 包含 \\(p\\) 个解释变量，模型 (2) 包含额外的 \\(q\\) 个解释变量。将每个模型的最大化偏似然函数值分别表示为 $L(1) $和 \\(\\hat L(2)\\) 表示，然后，可以基于模型的 \\(-2\\operatorname{log}\\hat{L}\\) 之差来比较这两个模型。具体来说，\\(-2\\log\\hat{L}(1)\\) 和 \\(-2\\log\\hat{L}(1)\\) 之间的较大差异将得出模型 (2) 中的 \\(q\\) 个变量（这是在模型 (1) 的基础上附加的 \\(q\\) 个变量）确实提高了模型拟合优度的结论。自然地，当项添加到模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 的值的变化量将取决于哪些项已包括在内。具体来说，\\(-2\\log\\hat{L}(1)\\) 和 \\(-2\\log\\hat{L}(1)\\) 值之差，即，\\(-2\\log\\hat{L}(1)+2\\log\\hat{L}(2)\\)，反映了将变量 \\(X_{p+1},X_{p+2},\\ldots,X_{p +q}\\) 添加到已包含 \\(X_1,X_2,\\ldots,X_p\\) 的模型中的组合效应。这称为经 \\(X_1,X_2,\\ldots,X_p\\) 的调整后，因拟合 \\(X_{p+1},X_{p+2},\\ldots,X_{p +q}\\) 而导致的 \\(-2\\operatorname{log}\\hat{L}\\) 值的变化 。 统计量 \\(-2\\log\\hat{L}(1)+2\\log\\hat{L}(2)\\) 可写为 \\[-2\\log\\{\\hat{L}(1)/\\hat{L}(2)\\}\\] 这就是对数似然比统计量 (log-likelihood ratio statistic)，用于检验声称模型 (2) 中 \\(q\\) 个参数 \\(\\beta_{p+1},\\beta_{p+2},\\ldots,\\beta_{p+q}\\) 全部为零的原假设。根据似然比检验理论的相关结果（见附录 A），在附加变量系数为零的原假设下，该统计量服从渐近卡方分布。该卡方分布的自由度等于两个模型下拟合的独立 \\(\\beta\\) 参数数量之差。因此，为比较模型 (1) 和模型 (2) 的 \\(-2\\operatorname{log}\\hat{L}\\) 值，我们利用以下事实：在 \\(\\beta_{p+1},\\beta_{p+2},\\ldots,\\beta_{p+q}\\) 全部为零的原假设下，统计量 \\(-2\\log\\hat{L}(1)+2\\log\\hat{L}(2)\\) 服从自由度为 \\(q\\) 的卡方分布。如果统计量的观测值不是很大，那么将判定这两个模型同等适用。在其他条件相同的情况下，将优先选用更简单的模型，即包含更少项的模型。另一方面，如果两个模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值差异显著，我们会认为需要这些附加的项，并会采用更复杂的模型。 两个嵌套模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值之差有一个与之相关的自由度数量，但 \\(-2\\operatorname{log}\\hat{L}\\) 统计量本身却没有。这是因为特定模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值并不服从卡方分布。有时，\\(-2\\operatorname{log}\\hat{L}\\) 称为偏差 (deviance). 然而这是不恰当的，因为与广义线性模型中的偏差不同，\\(-2\\operatorname{log}\\hat{L}\\) 并不衡量与数据完美拟合的模型之间的偏差。 示例 3.3 (患乳腺癌妇女的预后) 再次考虑示例 1.2 中关于乳腺癌患者生存时间的数据。在拟合不包含解释变量的 Cox 回归模型，即零模型时，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 173.968. 与示例 3.1 类似，指示变量 \\(X\\) 将用于表示染色程序的结果，因此，对于肿瘤呈阴性染色的女性，\\(X\\) 的值为 0，否则为 1。 当变量 \\(X\\) 包含在模型的线性部分时，\\(-2\\operatorname{log}\\hat{L}\\) 的值减小为 170.096. 替代模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值可以方便地以表格形式总结，如表 3.5 所示。 表 3.5 零模型与包含 \\(X\\) 的模型之间的 \\(-2\\operatorname{log}\\hat{L}\\) 值之差可用于评估两组女性风险函数之间的差异是否显著。由于一个模型比另一个模型多一个 \\(\\beta\\) 参数，因此 \\(-2\\operatorname{log}\\hat{L}\\) 值之差服从自由度为一的卡方分布。这两个 \\(-2\\operatorname{log}\\hat{L}\\) 值的差值为 \\(173.968-170.096 = 3.872\\)，这在 5% 的水平上刚刚显著（\\(P = 0.049\\)）。因此，我们可以得出结论，有证据表明两组女性的风险函数在 5% 的水平上存在显著差异。 在示例 2.12 中，我们使用 log-rank 检验研究了两组女性生存时间差异的程度。该检验的卡方值为 3.515（\\(P = 0.061\\)）。这个值与我们之前得到的 3.872（\\(P = 0.049\\)）相差不大。这两个相似 \\(P\\) 值意味着，关于数据为无组别差异的原假设提供证据的程度，得出的结论基本上是一样的。从实际的角度来看，一个结果在 5% 的水平上刚好显著，而另一个结果在该水平上并不完全显著，这一点并不重要。 尽管本例中使用的基于模型的方法在操作上不同于 log-rank 检验，但这两个程序实际上是密切相关的，这种关系将在 3.13 节中进行更详细的探讨。 示例 3.4 (肾癌的治疗) 在 University of Oklahoma Health Sciences Center 进行的一项研究中，获得了 36 名肾脏恶性肿瘤患者的生存时间数据。这些患者都接受了化疗和免疫疗法的联合治疗，但一些患者还接受了肾切除术（手术切除肾脏）。令人感兴趣的是，患者的生存时间是否取决于诊断时的年龄以及是否接受了肾切除术。研究中获得的数据如下：Lee and Wang (2013) 给出了研究中获得的数据，但在本例中，患者的年龄根据患者是否小于 60 岁、60 岁至 70 岁或大于 70 岁进行了分类。表 3.6 给出了患者的生存时间（以月为单位）。 表 3.6 在这个示例中，有一个名为年龄组的因素，包含三个水平 (&lt;60, 60-70, &gt;70)，以及一个与是否进行肾切除术相关的因素。根据风险函数是否与这两个因素中的一个或两个有关，有多种可能的模型，分别记作模型 (1) 至模型 (5). 在模型 (1) 下，死亡的风险既不受这两个因素中任何一个的影响，对于研究中所有 36 个个体来说也是相同的。在模型 (2) 和 (3) 中，风险只取决于年龄组或是否进行肾切除术。在模型 (4) 中，风险取决于这两个因素，其中肾切除术对风险的效应独立于患者的年龄组。模型 (5) 考虑了年龄组和肾切除术之间的交互作用，因此在该模型下，肾切除术对死亡风险的效应取决于患者的年龄组。 假设第 \\(j\\) 个年龄组的效应用 \\(\\alpha_j,j=1,2,3\\) 表示，而肾切除术状态的效应用 \\(\\nu_k,k=1,2\\) 表示。那么，可以将项 \\(\\alpha_j\\) 和 \\(\\nu_k\\) 包含在 Cox 模型的风险函数 \\(h_i(t)\\) 中，这是研究中第 \\(i\\) 个个体的风险函数。五种可能的模型如下 模型 (1)：\\(h_{i}(t) =h_0(t)\\) 模型 (2)：\\(h_i(t) =\\exp\\{\\alpha_j\\}h_0(t)\\) 模型 (3)：\\(h_{i}(t) =\\exp\\{\\nu_k\\}h_0(t\\) 模型 (4)：\\(h_{i}(t) =\\exp\\{\\alpha_j+\\nu_k\\}h_0(t)\\) 模型 (5)：\\(h_i(t) =\\exp\\{\\alpha_{j}+\\nu_{k}+(\\alpha\\nu)_{jk}\\}h_{0}(t)\\) 为拟合项 \\(\\alpha_j\\)，定义了两个指示变量 \\(A_2\\) 和 \\(A_3\\)，其值如表 3.7 所示。 表 3.7 通过定义变量 \\(N\\) 来拟合项 \\(\\nu_k\\)，当没有进行肾切除术时，变量 \\(N=1\\)，当进行了肾切除术时 \\(N=0\\)。通过选择这一指示变量，基线风险函数将对应于未进行肾切除术的最年轻年龄组的个体。 通过在模型中包含变量 \\(A_2\\) 和 \\(A_3\\) 来拟合包含项 \\(\\alpha_j\\) 的模型，而项 \\(\\nu_k\\) 则通过包含 \\(N\\) 来拟合。通过在模型中包含乘积 \\(A_2N=A_2×N\\) 和 \\(A_3N=A_3×N\\) 来拟合交互作用。拟合的解释变量以及所考虑的五个模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值如表 3.8 所示。当用于建模生存数据的计算机软件允许在模型中包含因素而无需定义适当的指示变量时，可以直接获得表 3.8 中的 \\(-2\\operatorname{log}\\hat{L}\\) 值。 表 3.8 比较这些不同模型的第一步是确定肾切除术状态和年龄组之间是否存在交互作用。为此，将模型 (4) 与模型 (5) 进行比较。在包含年龄组和肾切除术状态主效应的模型中加入交互项后，\\(-2\\operatorname{log}\\hat{L}\\) 值减少了 \\(165.508 - 162.479 = 3.029\\)，这对应于 2 个自由度。这并不显著（\\(P = 0.220\\)），因此我们得出结论，年龄组与是否进行肾切除术之间不存在交互作用。 我们现在确定风险函数是否与年龄组和肾切除状态这两个因素存在相关性，有三种可能，与两个都不相关，与其中一个相关，与两个都相关。在包含 \\(\\nu_k\\) 的模型中包含项 \\(\\alpha_j\\)，\\(-2\\operatorname{log}\\hat{L}\\) 值的变化在 2 个自由度上为 \\(170.247 − 165.508 = 4.739\\)。这在 10% 的水平下显著 (\\(P=0.094\\))，因此有一些证据表明包含 \\(\\nu_k\\) 的模型也需要包含 \\(\\alpha_j\\)。当 \\(\\nu_k\\) 添加到包含 \\(\\alpha_j\\) 的模型时，\\(-2\\operatorname{log}\\hat{L}\\) 的变化在 1 个自由度上为 \\(172.172 − 165.508 = 6.664\\)，在 1% 水平上显著 (\\(P = 0.010\\))。将这两个结果放在一起，项 \\(\\alpha_j\\) 可能会向包含 \\(\\nu_k\\) 的模型添加一些信息，并且包含 \\(\\alpha_j\\) 的模型中肯定需要包含 \\(\\nu_k\\)。这意味着这两项都是必需的，因此风险函数取决于患者的年龄组以及是否进行了肾切除术。 在结束这个例子之前，让我们考虑五个模型比较的其他可能结果，以及这些结果将如何影响我们选择最合适的模型的结论。如果在模型中除了与肾切除术状态相关的项 \\(\\nu_k\\) 外，还需要与年龄组相关的项 \\(\\alpha_j\\)，但在存在 \\(\\alpha_j\\) 的情况下，\\(\\nu_k\\) 并不需要，那么只包含 \\(\\alpha_j\\) 的模型 (2) 可能是最合适的。为了确保确实需要 \\(\\alpha_j\\)，我们还需要将模型 (2) 与零模型（模型 (1)）进行比较。类似地，如果除了与年龄组相关的项 \\(\\alpha_j\\) 外，还需要与肾切除术状态相关的项 \\(\\nu_k\\)，但在存在 \\(\\nu_k\\) 的情况下，\\(\\alpha_j\\) 并不需要，那么只包含 \\(\\nu_k\\) 的模型 (3) 可能是令人满意的。我们还需要通过将模型 (2) 与模型 (1) 进行比较来检验 \\(\\nu_k\\) 的显著性。如果在另一个因素存在的情况下，与年龄组和肾切除术状态相关的项都不需要，那么最多只需要一个变量。为了确定这两个变量中哪一个是必要的，我们会将模型 (2) 与模型 (1) 以及模型 (3) 与模型 (1) 进行比较。如果这两个结果在统计上都是显著的，我们将采用相比零模型，\\(-2\\operatorname{log}\\hat{L}\\) 值减少得最多的模型。如果模型 (2) 和模型 (3) 都不优于模型 (1)，我们将得出结论：年龄组和肾切除术状态都不会对风险函数产生影响。 分析生存数据的建模方法还有两个进一步的步骤。首先，我们需要严格检查模型对观测数据的拟合度，以确保拟合的 Cox 回归模型确实合适。其次，我们需要解释所选模型中参数估计的含义，以便量化解释变量对风险函数的效应。3.9 节将讨论拟合模型中参数的解释，而第 4 章将考虑评估拟合模型充分性的方法。但首先，我们来讨论模型选择的可能策略。 3.6 模型选择策略 模型选择过程的第一步是确定一组有可能包含在 Cox 回归模型线性部分中的解释变量。该集合将包含已为每个个体记录的变量和因素，但也可能需要与因素之间或变量与因素之间的交互作用相对应的额外项。 一旦确定了一组潜在的解释变量，就需要确定用于风险函数建模的变量组合。在实践中，风险函数不会依赖于唯一的变量组合。相反，可能存在许多同样好的模型，而不是单一的“最佳”模型。因此，需要考虑多种可能的模型。 模型选择策略在一定程度上取决于研究目的。在某些应用中，已经获得了关于多个变量的信息，目的可能是确定哪些变量对风险函数有影响，就像多发性骨髓瘤的示例 1.3 那样。在其他情况下，可能存在一个或多个主要关注的变量，例如对应于治疗效应的项。建模过程的目的是评估这些变量对风险函数的效应，就像前列腺癌的示例 1.4 那样。由于已记录的其他变量也可能影响治疗效应的大小，因此需要在建模过程中考虑这些变量。 统计建模的一个重要原则是，当模型中包含与两个因素之间交互作用相对应的项时，还应包含相应的低阶项。该规则称为层次原则 (hierarchical principle)，这意味着不应拟合两个因素之间的交互作用，除非存在相应的主效应。不遵循层次原则的模型很难解释。 3.6.1 变量选择程序 我们首先考虑所有解释变量处于平等地位的情况，目的是确定风险函数所依赖的变量子集。当潜在的解释变量（包括交互作用、非线性项等）的数量不太大时，在适当考虑层次原则的情况下，拟合所有可能的项组合可能是可行的。可以通过检查在向模型中添加项或从模型中删除项时 \\(-2\\operatorname{log}\\hat{L}\\) 值的变化来比较嵌套模型。 也可以根据 Akaike’s Information criterion (AIC) 对一些可能的模型进行比较，这些模型不一定需要嵌套，其公式为 \\[\\begin{equation} AIC=-2\\operatorname{log}\\hat{L}+2q \\tag{3.14} \\end{equation}\\] 其中 \\(q\\) 是模型中未知参数 \\(\\beta\\) 的数量。该统计量值越小，模型越好，但与 \\(-2\\operatorname{log}\\hat{L}\\) 统计量不同，当向模型中添加不必要的项时，AIC 的值往往会增加。 AIC 统计量的一个替代方案是 Bayesian Information Criterion (BIC)，由下式给出 \\[BIC=-2\\log\\hat{L}+q\\log d\\] 其中 \\(q\\) 是模型中未知参数 \\(\\beta\\) 的数量，\\(d\\) 是数据集中未删失观测值的数量。BIC 统计量也称为 Schwarz Bayesian Criterion (SBC). BIC 是 \\(-2\\operatorname{log}\\hat{L}\\) 统计量的调整，它考虑了拟合模型中未知参数的数量和模型已拟合的观测值的数量。与 AIC 统计量一样，BIC 的值越小，模型更好。 当然，一些项可能会以特定模型中项的替代项被识别出来，从而得到多个同等适用的子集。关于哪个子集最为合适的决定，不能仅仅基于统计依据。当模型选择没有主题依据时，从一系列候选模型中初步考虑选择的模型，可能是使得 \\(-2\\operatorname{log}\\hat{L},AIC\\) 或 \\(BIC\\) 的值最小的那个模型。然后使用第 4 章描述的模型检验方法以确认该模型确实适合数据，这一点很重要。 在某些应用中，可能会记录多个变量的信息，所有这些变量都与同一总体特征相关。例如，身高、体重、身体质量指数（体重/身高²）、头围、臂长等等，都与个体的尺寸有关。考虑到这些变量之间的内在关系，关于这些个体生存时间的模型可能不需要包含所有变量。因此，应确定需在模型中包含这组变量中的哪些，尽管具体选择哪些变量可能并不重要。 当变量数量相对较大时，拟合所有可能的模型的计算成本可能会很高。具体来说，如果有 \\(p\\) 个潜在解释变量，则有 \\(2^p\\) 种可能的项的组合，因此，如果 \\(p &gt; 10\\)，则解释变量的可能组合有一千多种。在这种情况下，许多软件包中提供的用于变量选择的自动程序似乎是一个有吸引力的前景。这些程序基于前向选择 (forward selection)、后向消除 (backward elimination) ，或两者的组合，称为逐步程序 (stepwise procedure). 在前向选择中，一次将一个变量添加到模型中。在该过程的每个阶段，添加的变量是在包含该变量时使 \\(-2\\operatorname{log}\\hat{L}\\) 值减小最多的变量。当模型中包含的下一个候选变量不会使 \\(-2\\operatorname{log}\\hat{L}\\) 的值减少超过预先指定的量时，该过程结束。这称为停机准则 (stopping rule). 当将变量添加到模型中时，此规则通常以 \\(-2\\operatorname{log}\\hat{L}\\) 值差异的显著性水平来表示，因此当下一候选项在预先指定的水平上不再显著时，选择过程结束。 在向后消除中，首先拟合包含所考虑变量数量最多的模型。然后一次排除一个变量。在每一阶段，排除的变量是使 \\(-2\\operatorname{log}\\hat{L}\\) 的值增加其排除的最小量的变量。当下一个要排除的候选项将 \\(-2\\operatorname{log}\\hat{L}\\) 的值增加超过预先指定的量时，该过程结束。 逐步程序的操作方式与正向选择相同。但是，可以考虑在后续阶段排除模型中包含的变量。因此，在向模型添加变量后，该过程将检查是否可以删除以前包含的任何变量。这些决定同样是根据预先指定的停机准则做出的。 这些自动程序有许多缺点。通常，它们会导致识别一个特定的子集，而不是一组同样好的子集。这些程序找到的子集通常取决于所使用的变量选择程序，即是前向选择、后向消除还是逐步过程，并且通常倾向于不考虑分层原则。它们还依赖于用来确定一个项是否应该包含在模型中或排除在外的停机准则。由于所有这些原因，这些自动程序在模型选择中起着有限的作用，并且绝对不应该不加批判地使用。 建议采用以下模型选择的一般策略，而不是使用自动变量选择程序。 第一步是一次拟合包含一个变量的模型。然后将这些模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值与零模型的值进行比较，以确定哪些变量本身显著减小了该统计量的值。 然后将第一步中看起来很重要的变量组合起来并拟合模型。在某些变量存在的情况下，其他变量可能就不再重要了。因此，当这些变量从模型中省略时，如果不显著增加 \\(-2\\operatorname{log}\\hat{L}\\) 的值，那么它们现在就可以被丢弃。因此，我们计算当每个变量单独从集合中省略时，\\(-2\\operatorname{log}\\hat{L}\\) 值的变化。只有那些（在省略后）导致 \\(-2\\operatorname{log}\\hat{L}\\) 值显著增加的变量才会被保留在模型中。一旦一个变量被丢弃，就应该依次检查省略每个剩余变量的影响。 那些在单独考虑时不重要的变量（因此在第二步中没有被考虑），可能在其他变量的存在下变得重要。因此，这些变量将逐一添加到第二步的模型中，任何能显著减小 \\(-2\\operatorname{log}\\hat{L}\\) 的变量都将保留在模型中。这一过程可能会导致第二步确定的模型中的项不再具有显著性。 最后进行一次检查，以确保模型中的任何一项都不能被省略，否则会导致 \\(-2\\operatorname{log}\\hat{L}\\) 的值显著增加，并且确保未包括的任何一项都不会显著减小 \\(-2\\operatorname{log}\\hat{L}\\) 的值。 在使用这种选择程序时，应避免刻板地应用特定的显著性水平。为了指导是否包含或省略某个项的决策，显著性水平不应设置得太小，否则会导致选择的变量太少；一般建议将显著性水平设置为 15%. 在某些应用中，可能需要考虑将少量交互项和其他高阶项（如某些变量的幂）纳入模型。在确保根据层次原则必需的所有项都包含在模型中之后，这些项将添加到上述第三步确定的模型中。如果任何高阶项能显著减小 \\(-2\\operatorname{log}\\hat{L}\\) 的值，那么该项将包含在模型中。 现通过一个示例说明这种模型选择策略。 示例 3.5 (多发性骨髓瘤患者的生存率) 在示例 3.2 中，对多发性骨髓瘤患者生存时间数据的分析表明，Cox 回归模型中并非所有七个解释变量（Age、Sex、Bun、Ca、Hb、Pcells 和 Protein）都是必需的。我们现在确定这些变量中最合适的子集。在本例中，我们将不考虑原始变量的变换以及它们之间的交互作用。我们还进一步假设在模型中包含特定变量没有医学依据。表 3.9 给出了将要考虑的所有模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值的总结。第一步是拟合零模型和分别包含七个解释变量的模型。在这些变量中，Bun 导致 \\(-2\\operatorname{log}\\hat{L}\\) 的减小量最大，它将统计量的值从 215.940 减小为 207.453. 与具有 1 个自由度的卡方分布的百分位点相比，8.487 的减小在 1% 的水平上是显著的（\\(P = 0.004\\)）。将 Hb 添加到零模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 的减小量为 4.872，这在 5% 的水平上也是显著的（\\(P = 0.027\\)）。最后一个本身具有一定解释能力的变量是 Protein，它导致 \\(-2\\operatorname{log}\\hat{L}\\) 的减小量在 15% 的水平上几乎显著（\\(P = 0.152\\)）。尽管这个 \\(P\\) 值相对较高，但我们暂时会考虑将其纳入模型中。 下一步是拟合包含 Bun, Hb 和 Protein 的模型，该模型得到的 \\(-2\\operatorname{log}\\hat{L}\\) 的值为 200.503。从该模型中依次省略这三个变量中每个变量的影响如表 3.9 所示。具体来说，当省略 Bun 时，\\(-2\\operatorname{log}\\hat{L}\\) 的增加量为 9.326，当省略 Hb 时增加量为 3.138，当省略 Protein 时增加量为 2.435. 这些 \\(-2\\operatorname{log}\\hat{L}\\) 值的变化都可以与具有 1 个自由度的卡方分布的百分位点进行比较。由于在 Hb 和 Bun 存在的情况下，Protein 似乎不是模型所必需的，因此不再考虑将其纳入模型中。 表 3.9 如果从包含 Hb 和 Bun 这两个变量的模型中排除排除其中一个，则 \\(-2\\operatorname{log}\\hat{L}\\) 的增加值分别为 4.515 和 8.130. 这两个增量在 5% 的水平上都显著，因此在不显著增加 \\(-2\\operatorname{log}\\hat{L}\\) 统计值的情况下，Hb 和 Bun 都不能从模型中排除。 最后，我们考察是否应将变量 Age、Sex、Ca 和 Pcells 中的任何一个包含在包含 Bun 和 Hb 的模型中。表 3.9 显示，当添加这四个变量中的任何一个时，\\(-2\\operatorname{log}\\hat{L}\\) 的减小量都小于 0.5，因此不需要将它们包含在模型中。因此我们得出结论，最令人满意的模型是包含 Bun 和 Hb 的模型。 我们现在转向具有首要意义的变量的研究，比如治疗效应。此时，我们将按照以下方式进行。 首先选择重要的预后变量，忽略治疗效应。当变量的数量不是非常大时，可以拟合包含所有可能变量组合的模型。或者可以遵循之前的步骤 1 至 4 中描述的类似步骤来进行变量选择过程。 然后将治疗效应纳入模型中。如此一来，因每个治疗组中预后变量分布的差异而导致的两组之间的任何差异都不会归因于治疗。 如果无法排除在治疗和其他解释变量之间存在交互作用，那么在解释治疗效应之前，必须考虑这些交互作用。 此外，拟合仅包含治疗效应的模型通常会很有趣。这使得能够评估预后变量对治疗效应大小的影响。 在讨论模型选择策略时，我们强调了使用统计标准来指导选择过程。此外，还必须充分考虑应用领域。具体来说，在某些主题领域包含特定的变量组合可能是不合适的。另一方面，即使某些变量在为特定数据集建模时看似不需要，但从模型中省略它们可能并不明智。实际上，在模型构建中总是需要考虑非统计因素。 示例 3.6 (前列腺癌两种疗法的比较) 在示例 1.4 中，关于 38 名前列腺癌患者生存时间的数据，有四个预后变量可能对生存时间产生影响。这些变量包括患者的年龄 (Age) 、血清血红蛋白水平 (Hb) 、肿瘤大小 (Size) 和 Gleason 指数 (Index). 在 Cox 回归模型中拟合了这些变量的所有可能组合，并计算了 \\(-2\\operatorname{log}\\hat{L}\\) 的值。这些值以及利用 \\(AIC=-2\\operatorname{log}\\hat{L}+2q\\) 得到的 Akaike 信息准则的值以及利用 \\(BIC = -2\\operatorname{log}\\hat{L} + q\\log(6)\\) 得到的贝叶斯信息准则的值一起显示在表 3.10 中，其中 \\(q\\) 是为包含 6 个死亡时间的数据集拟合的模型中项的个数。 表 3.10 单独考虑时，最重要的两个解释变量是 Size 和 Index. 通过比较从包含这两个变量的模型中分别省略它们时 \\(-2\\operatorname{log}\\hat{L}\\) 值的变化，我们推断出 Cox 回归模型中需要这两个变量。当在包含 Size 和 Index 的模型中添加 Age 和 Shb 时，\\(-2\\operatorname{log}\\hat{L}\\) 的值仅略有减小。因此我们得出结论，只有 Size 和 Index 是重要的预后变量。 从表 3.10 中 Akaike 信息准则的值来看，具有 Size 和 Index 的模型得出的统计量最小，证明这是所尝试的模型中最合适的模型。另请注意，没有其他解释变量组合能得出相似的 AIC 统计量的值，这表明在模型中使用 Size 和 Index 没有明显的替代方案。贝叶斯信息准则的值也能得出相同的结论。 我们现在考虑治疗效应。设 Treat 为一个变量，对于分配到安慰剂组的个体，其值为 0；对于分配到己烯雌酚组的个体，其值为 1. 当将 Treat 添加到包含 Size 和 Index 的模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 的值减小为 22.572. 此减小量 0.961 在 1 个自由度上并不显著（\\(P = 0.327\\)）。这表明没有治疗效应，但首先我们应该检查模型中两个解释变量的系数是否依赖于治疗。为此，我们形成乘积 Tsize = Treat × Size 和 Tindex = Treat × Index，并将它们添加到包含 Size、Index 和 Treat 的模型中。当将 Tsize 和 Tindex 添加到模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 分别减小为 20.829 和 20.792. 在添加这两个混合项后，\\(-2\\operatorname{log}\\hat{L}\\) 变为 19.705. 将这些项添加到模型后，\\(-2\\operatorname{log}\\hat{L}\\) 的减小并不显著，因此没有证据表明治疗效应依赖于 Size 和 Index. 这意味着我们对治疗效应大小的原始解释是有效的，并且基于这些数据，使用己烯雌酚进行治疗似乎并不影响死亡风险。这种治疗效应大小的估计将在示例 3.12 中进一步考虑。 在结束这个例子之前，我们注意到，当 Tsize 或 Tindex 添加到模型中时，它们的系数估计和 Treat 的系数估计都会变大。这些标准误估计也很大。具体来说，在包含 Size, Index, Treat 和 Tsize 的模型中，Treat 的系数估计为 -11.28，标准误为 18.50. 对于包含 Size, Index, Treat 和 Tindex 的模型，Treat 和 Tindex 的系数分别为 -161.52 和 14.66，而这些的标准误估计分别为 18476 和 1680！这是过拟合 (overfitting) 的证据。 在过拟合模型中，一些 \\(\\beta\\) 系数的估计将高度依赖于实际数据。这些变量值的一个非常微小的变化，可能会对相应系数的估计产生很大影响。这就是这类估计具有较大标准误的原因。在这个例子中，由于数据集中事件数量较少（38 名患者中只有 6 人死亡），因此发生了过拟合。 相比数据所能证明的模型，过拟合的模型是更复杂的模型，它无法提供数据的有用总结。这也是在前列腺癌死亡风险的模型中不包含混合项的另一个原因。 3.7 使用 lasso 进行变量选择 变量选择的一个特别有用的辅助工具是 Least Absolute Shrinkage and Selection Operator，简称为 lasso. 使用 lasso 的效果是将模型中解释变量的系数向零收缩，并在这一过程中，一些估计值将自动设置为正好是零。在 lasso 程序中系数变为零的解释变量是那些解释能力很小或没有解释能力，或者与其他变量高度相关的变量。然后，选择纳入模型中的变量是具有非零系数的变量。这种收缩还提高了模型的预测能力，因为收缩后的参数估计对样本数据的变化不太敏感，因此更稳定。 3.7.1 Cox 回归中的 lasso 考虑一个包含 \\(p\\) 个解释变量的 Cox 回归模型，其中第 \\(i\\) 个（共 \\(n\\) 个）个体在时间 \\(t\\) 发生事件的风险函数为 \\(h_i(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)h_0(t)\\)，其中 \\(\\boldsymbol{\\beta&#39;x}_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\)，\\(h_0(t)\\) 是基线风险函数。在 lasso 过程中，该模型中的 \\(\\beta\\) 参数是通过最大化式 (3.5) 中的偏似然函数来估计的，同时限制其绝对值的和小于等于某个值 \\(s\\)。用 \\(R(t_{{i}})\\) 表示在时间 \\(t_i\\)（第 \\(i\\) 个个体的观测生存时间）处于事件风险的个体集合，令 \\(\\delta_i\\) 为事件指示符，当 \\(t_i\\) 为删失生存时间时，其值为 0，否则为 1. 具有 \\(p\\) 个解释变量的模型的偏似然函数为 \\[\\begin{equation} L(\\boldsymbol{\\beta})=\\prod_{i=1}^n\\left\\{\\frac{\\exp(\\boldsymbol{\\beta&#39;x}_i)}{\\sum_{l\\in R(t_i)}\\exp(\\boldsymbol{\\beta&#39;x}_l)}\\right\\}^{\\delta_i} \\tag{3.15} \\end{equation}\\] 其根据约束 \\(\\sum_{j=1}^p|\\beta_j|\\leqslant s\\) 来最大化。量 \\(\\sum_{j=1}^p|\\beta_j|\\) 称为向量 \\(\\boldsymbol \\beta\\) 的 L1 范数，常记作 \\(||\\boldsymbol \\beta||_1\\)。使约束偏似然函数 (constrained likelihood function) 最大化的估计 \\(\\hat{\\boldsymbol \\beta}\\) 也是使下式最大化的值 \\[\\begin{equation} L_\\lambda(\\boldsymbol{\\beta})=L(\\boldsymbol{\\beta})-\\lambda\\sum_{j=1}^{p}|\\beta_j| \\tag{3.16} \\end{equation}\\] 其中 \\(\\lambda\\) 称为 lasso 参数。式 (3.16) 中的似然函数称为惩罚 (penalized) 似然，因为对极端的 \\(\\beta\\) 值施加了惩罚。由此产生的估计将更接近于零，并且比拟合 Cox 模型的标准估计具有更高的精度，但代价是在估计中引入一定程度的偏差。 为了了解这种收缩 (shrinkage) 的影响，对 lasso 参数的一系列值，计算了可能包含在最终模型中的所有解释变量的系数估计。这些估计关于 \\(\\lambda\\) 的曲线图，称为 lasso 轨迹，提供了估计对 \\(\\lambda\\) 值依赖性的总结。当 \\(\\lambda\\) 较小时，模型中只有少数变量的系数为零，解释变量的数量不会减少太多。另一方面，较大的 \\(\\lambda\\) 值会导致太多变量被排除在外，模型可能不会令人满意。 虽然 lasso 轨迹是一种图形辅助工具，可用于识别建模过程中合适 \\(\\lambda\\) 值，这通常还需要通过其他技术来确定 lasso 参数的最优值。这个值可以是最大化式 (3.16) 中惩罚似然函数 \\(L_\\lambda(\\boldsymbol\\beta)\\) 的值，或者等价地，是最小化 \\(-2\\log L_\\lambda(\\boldsymbol\\beta)\\) 的 \\(\\lambda\\) 值。然而，通常更倾向于使用其他方法来确定 \\(\\lambda\\) 的最优值，例如交叉验证 (cross-validation) 法。在这种方法中，\\(\\lambda\\) 的最优值是使交叉验证偏对数似然函数 (cross-validated partial log-likelihood function) 最大化的值。为定义这一点，设 \\(\\hat{\\boldsymbol{\\beta}}_{(-i)}(\\lambda)\\) 是在省略第 \\(i\\) 个个体的数据后，最大化式 (3.16) 中的惩罚偏似然函数的参数估计向量，其中 \\(i = 1, 2,...,n\\)，对于给定的 lasso 参数 \\(\\lambda\\) 值。设 \\(\\log L(\\boldsymbol{\\beta})\\) 为式 (3.15) 中定义的偏似然函数的对数， \\(L_{(-i)}(\\boldsymbol{\\beta})\\) 是在排除第 \\(i\\) 个个体的数据后的偏对数似然。那么，交叉验证偏对数似然函数为 \\[\\begin{aligned}\\log\\hat{L}_{CV}(\\lambda)=\\sum_{i=1}^n\\left\\{\\log L[\\hat{\\boldsymbol{\\beta}}_{(-i)}(\\lambda)]-\\log L_{(-i)}[\\hat{\\boldsymbol{\\beta}}_{(-i)}(\\lambda)]\\right\\}\\end{aligned}\\] 选择最大化该函数的 \\(\\lambda\\) 值作为 lasso 参数的最优值。选择包含在模型中的变量是在该 \\(\\lambda\\) 值处具有非零系数的变量。 使用 lasso 程序后，通常不会显示参数估计的标准误或这些估计的函数（例如风险比）。其原因之一是它们难以计算，但主要原因是参数估计将偏向于零。因此，标准误意义不大，并且往往会低估估计的精度。如果需要标准误，则可以使用 lasso 程序来确定应包含在模型中的变量，即在 lasso 参数的最佳值处具有非零系数的变量。然后拟合包含这些变量的标准 Cox 回归模型，但如此就失去了 lasso 的优势。 3.7.2 数据准备 在使用 lasso 程序之前，解释变量必须具有相似的测量尺度。若情况并非如此，则首先需要标准化每个解释变量：将每个解释变量减去其样本均值并除以其标准差，从而得到均值为 0 和方差为 1 的标准化变量。 lasso 程序也可以应用于分类变量，但需要首先对与该因素相关的指示变量进行标准化。这种方法意味着一个因素不会被视为单一实体，lasso 程序可能会导致相关的指示变量子集被设置为零。lasso 程序识别的变量将取决于如何对相应的指示变量进行编码。例如，如 3.2 节所示，如果具有 \\(m\\) 个水平的因素有相应的 \\(m - 1\\) 个指示变量，这些指示变量在因素第一水平时都是 0，则这些指示变量将测量每个因素水平相对于第一水平的效应。这可用于识别与基线水平没有差异的水平，但不适用于因素水平是有序的情况。在这种情况下，一种反映因素水平差异的编码方法，即前向差分编码 (forward difference coding) 将更有用。在 lasso 程序中被设置为零的系数，将对应于与具有非零系数的相邻水平具有相似效应的水平。 为了说明这种编码，假设有序分类变量 \\(A\\) 有四个水平，该因素可以用表 3.11 中定义的三个指示变量 \\(A_1,A_2,A_3\\) 表示。 表 3.11 当这三个变量以系数 \\(α_1,α_2,α_3\\) 的形式包含在一个模型中时，\\(A\\) 第一水平的效应是 \\((3α_1 + 2α_2 + α_3)/4\\)，第二水平的效应是 \\((−α_1 + 2α_2 + α_3)/4\\)。因此，\\(A_1\\) 的系数 \\(α_1\\) 代表 \\(A\\) 第一水平和第二水平之间的差异。类似地，\\(A_2\\) 的系数代表 \\(A\\) 第二水平和第三水平之间的差异，而 \\(A_3\\) 的系数代表 \\(A\\) 第三水平和第四水平之间的差异。在一般情况下，对于具有 \\(m\\) 个水平的因素 \\(A\\)，\\(m - 1\\) 个指示变量是这样的：\\(A_1\\) 的值为 \\((m-1)/m, -1/m, -1/m,..., -1/m\\)；\\(A_2\\) 的值为 \\((m-2)/m, (m-2)/m, -2/m, -2/m,..., -2/m\\)；\\(A_3\\) 的值为 \\((m-3)/m, (m-3)/m, (m-3)/m, -3/m,..., -3/m\\)；以此类推，直到 \\(A_{m-1}\\) 的值为 \\(1/m, 1/m,..., 1/m, -(m-1)/m\\)。分类变量也可以通过 group lasso 进行处理，它允许一组变量被完全包含或排除，但这里不会给出更多细节。 示例 3.7 (多发性骨髓瘤患者的生存率) 以第 1 章示例 1.3 中首次给出的 48 名多发性骨髓瘤患者的生存时间数据来说明 lasso 程序在变量选择中的使用。七个潜在的解释变量包括五个连续变量（Age、Bun、Ca、Hb、Pcells）和两个二元变量（Sex、Protein）。所有七个变量的测量尺度都有较大差异，因此它们首先被标准化为均值为 0 和标准差为 1. 例如，48 个年龄的均值为 62.90，标准差为 6.96，因此标准化值为 (Age − 62.90)/6.96. 为了应用 lasso 程序，通过在 \\(\\lambda\\) 的值范围内最大化式 (3.16) 中的惩罚似然函数来获得七个 \\(\\beta\\) 系数的估计。图 3.2 显示了每个变量的系数相对于 \\(\\lambda\\) 的结果轨迹。在该图中，所呈现的系数是原始变量的系数：使约束似然函数最大化的标准化解释变量的系数估计除以该变量的标准差。 图 3.2 \\(\\lambda=0\\) 时的估计是包含所有七个解释变量的 Cox 回归模型的参数估计。随着 \\(\\lambda\\) 的增加，这些估计逐渐接近于零，但速度有所不同。当 \\(\\lambda=0.5\\) 时，Ca 的系数估计为零，而当 \\(\\lambda=0.75\\) 时，Pcells 的系数估计为零。\\(\\lambda=2.5\\) 时，Age 和 Sex 的系数估计均为零。该图还说明了 lasso 的另一个性质，即 lasso 轨迹是由许多直线段组成的，因此它是分段线性的 (piecewise linear). 为了确定 \\(\\lambda\\) 的最佳值，针对一系列 \\(\\lambda\\) 值计算交叉验证偏对数似然 \\(\\log\\hat{L}_{CV}(\\lambda)\\)，并确定使该似然函数最大化的值。交叉验证偏对数似然为 lasso 参数 \\(\\lambda\\) 的函数，如图 3.3 所示。 图 3.3 当 \\(\\lambda=3.90\\) 时，该函数达到最大值，在该 \\(\\lambda\\) 值下，有三个变量具有非零系数：Hb, Bun 和 Protein. 因此，lasso 程序产生了一个包含这三个变量的模型。在本例中，图 3.3 中所示的交叉验证偏对数似然函数在其最大值附近非常平坦，即在\\(\\lambda\\) 值处于 3 和 5 之间时函数值非常相似。此外，根据图 3.2，对于 3 和 5 之间的任何 \\(\\lambda\\) 值，将选择相同的变量纳入模型，尽管系数估计会有所不同。 在 \\(λ=3.90\\) 的模型中，Hb, Bun 和 Protein 系数分别为 −0.080, 0.015 和 −0.330. 具有这三个变量的 Cox 模型的相应估计值分别为 -0.110, 0.020 和 -0.617. 请注意，lasso 程序中模型的系数估计都比 Cox 模型中的相应估计更接近于零，这表明了收缩效应。在 Cox 模型中，Protein 系数与零没有显著差异（\\(P=0.13\\)），尽管 lasso 程序表明该变量应保留在模型中。最后，人们可能希望将 Protein 纳入模型，以免错过任何内容。 3.8 非线性项 当要对一个取值范围广泛的解释变量与风险函数之间的依赖关系进行建模时，我们应考虑将该变量以线性项的形式纳入 Cox 回归模型是否适合。如果有理由不假设变量是线性的，那么我们需要考虑如何对非线性关系进行建模。 3.8.1 非线性检验 检查是否需要非线性项的一种直接方法是向模型添加二次项或三次项，并考察 \\(-2\\operatorname{log}\\hat{L}\\) 统计量值因此的减小值。如果包含这些项会显著减小该统计量的值，我们就会得出存在非线性的结论。那么可以将多项式项纳入模型。然而在许多情况下，解释变量中的非线性不能通过在 Cox 回归模型中包含多项式项来充分表示。因此，建议一般使用以下程序。 为了确定变量是否表现出非线性，首先将可能的非线性变量的值分为四类或五类，其中每类包含大致相等数量的观测值。然后定义一个因素，其水平对应于该分组。例如，反映肿瘤大小的变量可以拟合为一个因素，其水平对应于非常小、小、中和大。 更具体地说，设 \\(A\\) 是一个由连续变量形成的具有 \\(m\\) 个水平的因素，设 \\(X\\) 是一个变量，当 \\(A\\) 处于水平 \\(j\\) 时，\\(X\\) 取值为 \\(j\\)，其中 \\(j = 1, 2,...,m\\)。原始变量的线性关系对应于 \\(A\\) 水平之间存在线性趋势。这种线性趋势可以通过单独拟合 \\(X\\) 来建模。现在，拟合 \\(m-1\\)个项 \\(X, X^2,...,X^{(m-1)}\\) 相当于在模型中将 \\(A\\) 作为因素进行拟合，使用如 3.2.2 节中的指示变量。因此，包含 \\(X\\) 的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值与包含 \\(A\\) 的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值之间的差异，是衡量 \\(A\\) 水平之间非线性的指标。如果这个差异不显著，我们可以得出不存在非线性的结论，并且将拟合原始变量。另一方面，如果有非线性的证据，则可以从与 \\(A\\) 对应的指示变量的系数中进一步研究这种非线性的实际形式。绘制这些系数的图可能有助于确定因素 \\(A\\) 水平之间这种趋势的性质。 示例 3.8 (多发性骨髓瘤患者的生存率) 在示例 3.5 中，我们发现包含解释变量 Bun 和 Hb 的 Cox 回归模型似乎适用于多发性骨髓瘤患者生存时间的数据。我们现在考虑血清血红蛋白水平 (Hb) 是否存在非线性证据，并检查包含 Bun 和 Hb 的模型中是否需要二次项。当向该模型添加 Hb2 项时，\\(-2\\operatorname{log}\\hat{L}\\) 的值从 202.938 减小为 202.917. 在 1 个自由度上减小 0.021 显然并不显著，这表明在 Hb 中使用线性项就足够了。 检查非线性程度的另一种方法是使用一个因素为 Hb 对风险函数的效应进行建模。假设定义了一个具有四个水平的因素，其中水平 1 对应于小于等于 7 的 Hb 值，水平 2 对应于 7 到 10 之间的值，水平 3 对应于 10 到 13 之间的值，水平 4 对应于大于 13 的值。这种水平的选择大致对应于 Hb 分布的四分位数。可以通过定义三个指示变量 Hb2, Hb3 和 Hb4 来拟合该因素，这三个指示变量的值如表 3.12 所示。 表 3.12 当拟合包含 Bun, Hb2, Hb3 和 Hb4 的模型时，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 200.417. 将指示变量 Hb2, Hb3 和 Hb4 添加到仅包含 Bun 的模型后，该统计量在 3 个自由度上的变化为 7.036，在 10% 的水平上显著（\\(P = 0.071\\)）。然而，很难确定各因素水平之间的任何模式。 与血红蛋白水平相对应的因素水平的线性趋势可以通过拟合变量 \\(X\\) 来建模，变量 \\(X\\) 根据因素水平取值 1, 2, 3, 4. 当拟合包含 Bun 和 \\(X\\) 的模型时，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 203.891，在 2 个自由度上，由于任何非线性导致的 \\(-2\\operatorname{log}\\hat{L}\\) 的值变化为 \\(203.891-200.417=3.474\\)。与具有 2 个自由度的卡方分布的百分位点相比，这并不显著（\\(P=0.176\\)）。因此我们得出结论，血红蛋白水平对这组患者死亡风险的效应可以通过使用线性项 Hb 进行充分建模。 3.8.2 非线性建模 如果使用 3.8.1 节中描述的程序检测出非线性，则可能会在建模过程中使用与变量对应的系数。然而，这意味着连续变量被阶跃函数所取代。从主题的角度来看，这样的一个固有连续变量被如此表示通常无法令人信服。此外，该过程需要选择分类边界，而分类过程会导致信息丢失。通常也不建议使用多项式项来表示解释变量中的非线性行为。这是因为低阶多项式，例如二次或三次表达式，可能不适合数据，而高阶多项式通常不能很好地拟合解释变量范围的极值。此外，具有极限值或渐近线的变量不能使用多项式表达式进行充分建模。一个简单而灵活的解决方案是使用包含相同变量的不同幂次的模型，这些幂次可能是分数，称为分数多项式 (fractional polynomials). 3.8.3 分数多项式 一个关于变量 \\(X\\) 的 \\(m\\) 阶分数多项式包含 \\(X\\) 的 \\(m\\) 个不同的幂次。将表达式 \\(\\beta_1X^{p_1}+\\beta_2X^{p_2}+\\cdots+\\beta_mX^{p_m}\\) 纳入模型，其中每个幂次 \\(p_j(j=1,2,\\ldots,m)\\) 都是集合 \\(\\{−2, −1, −0.5, 0, 0.5, 1, 2, 3\\}\\) 中的一个值，\\(X^0\\) 被视为 \\(\\log X\\)。将 \\(X\\) 的 0 次幂表示为 \\(\\log X\\) 称为 \\(X\\) 的 Box-Tidwell 变换。仅使用变量的两个不同幂次即可实现解释变量对死亡风险效应建模的极大灵活性，因此 \\(m\\) 通常取 1 或 2. 当 m = 2 时，我们可以不失一般性地取 \\(p_1 &lt; p_2\\)，因为具有幂次 \\(p_1,p_2\\) 的模型与具有幂次 \\(p_2,p_1\\) 的模型是相同的，并且具有 \\(p_1 = p_2\\) 的模型与 \\(m = 1\\) 对于的模型是等价的。 当 \\(m = 1\\) 时，将拟合具有 8 个可能幂次的模型，在考虑其他变量的存在下，具有最小 \\(-2\\operatorname{log}\\hat{L}\\) 值的模型是最佳拟合模型。当 \\(m = 2\\) 时，在集合中的 8 个幂次有 28 种可能的组合（这不包括变量以相同幂出现两次的 8 种情况），最合适的组合将是使得 \\(-2\\operatorname{log}\\hat{L}\\) 最小化的组合。在比较不同阶数的非嵌套模型时，例如一个具有两个幂次的模型和一个仅有一个幂次的模型，且两个模型没有共同的幂次，可以使用 AIC 或 BIC 统计量。 示例 3.9 (多发性骨髓瘤患者的生存率) 在这个例子中，我们调查了关于多发性骨髓瘤患者生存时间的数据集中，血清血红蛋白水平是否存在非线性的证据。除了变量 Bun 外，还拟合了 Hb 的 1 阶和 2 阶分数多项式。因此，Hb 以幂次 \\(p_1\\) 的单个项和以幂次为 \\(p_1 &lt; p_2\\) 的两个项纳入模型，其中 \\(p_1\\) 和 \\(p_2\\) 取自值集 \\(\\{−2, −1, −0.5, 0, 0.5, 1, 2, 3\\}\\)，且 Hb 的 0 次幂视为 \\(\\log Hb\\)。如下 Cox 回归模型 \\[\\begin{aligned}h_i(t)&amp;=\\exp(\\beta_1Hb_i^{p_1}+\\beta_2Bun_i)h_0(t),\\\\h_i(t)&amp;=\\exp(\\beta_1Hb_i^{p_1}+\\beta_2Hb_i^{p_2}+\\beta_3Bun_i)h_0(t)\\end{aligned}\\] 的 \\(-2\\operatorname{log}\\hat{L}\\) 的值展示在表 3.13 中。 表 3.13 根据这张表，只具有一个 Hb 幂次的最佳模型 (\\(m = 1\\))，是包含 Hb 线性项或二次项的模型，其中仅包含 Hb 线性项的模型最简单。 当拟合具有两个 Hb 幂次的模型时，\\(p_1 = −2,p_2 = −1\\) 和 \\(p_1 = −2,p_2 = −0.5\\) 的模型得到的 \\(-2\\operatorname{log}\\hat{L}\\) 的值最小，但这两种模型相对于仅有一个 Hb 幂次的模型并没有显著改进。如果要向仅包含 Hb 的模型中添加另一个 Hb 的幂次，我们会添加 Hb−2，但同样没有必要这样做，因为具有两个 Hb 幂次的模型相对于仅包含 Hb 的模型并没有显著改进。我们得出结论，Hb 的线性项就足够了，这证实了示例 3.8 中分析的结果。 "],["cox-回归模型.html", "►Cox 回归模型 3.9 参数估计的解释 3.10 估计风险函数和生存函数 3.11 风险调整的生存函数 3.12 一致性，预测能力和解释的变异 3.13 时依 ROC 曲线 3.14 比例风险建模和 log-rank 检验 3.15 延伸阅读", " ►Cox 回归模型 3.9 参数估计的解释 当 Cox 回归模型用于生存数据分析时，模型中解释变量的系数可以解释为死亡风险与基线风险之比的对数。这意味着，可以很容易地从拟合模型中找到该风险比的估计值和相应的置信区间。以下各节描述了 Cox 回归模型中不同类型的项对应的参数解释。 3.9.1 具有一个变量的模型 假设 Cox 回归模型包含单个连续变量 \\(X\\)，则第 \\(i\\) 个个体（\\(X\\) 的值为 \\(x_i\\)）的风险函数为 \\[h_{\\boldsymbol{i}}(t)=e^{\\boldsymbol{\\beta}x_{\\boldsymbol{i}}}h_{\\boldsymbol{0}}(t)\\] 该模型中 \\(x_i\\) 的系数可以解释为风险比的对数。具体来说，考虑在 \\(X\\) 上的记录值为 \\(x + 1\\) 的个体的死亡风险，与记录值为 \\(x\\) 的个体的死亡风险的之比。即 \\[\\begin{aligned}\\frac{\\exp\\{\\beta(x+1)\\}}{\\exp(\\beta x)}=e^{\\beta}\\end{aligned}\\] 因此拟合的 Cox 回归模型中的 \\(\\hat \\beta\\) 是当 \\(X\\) 的值增加 1 个单位时对数风险比估计的变化。 使用类似的论点，当变量 \\(X\\) 的值增加 \\(r\\) 个单位时，对数风险比估计的变化为 \\(r \\hat \\beta\\)，相应的风险比估计为 \\(\\exp(r \\hat \\beta)\\)。对数风险比估计的标准误将为 \\(r\\, \\text{se}\\,(\\hat \\beta)\\)，从中可以得出真实风险比的置信区间。 上述论证表明，当连续变量 \\(X\\) 包含在 Cox 回归模型中时，\\(X\\) 的值改变 \\(r\\) 个单位前后的风险比并不依赖于 \\(X\\) 的实际值。例如，如果 \\(X\\) 指的是个体的年龄，那么 70 岁的个体相对于 65 岁的个体的风险比与 20 岁的个体相对于 15 岁的个体的风险比是相同的。这一特征是直接将 \\(X\\) 作为 Cox 回归模型中的线性项进行拟合的直接结果。如果对线性假设存疑，可以使用 3.8.1 节中描述的程序进行检查。然后可以在建模过程中使用 \\(X\\) 的分数多项式或 \\(X\\) 的非线性变换。 3.9.2 具有一个因素的模型 当个体属于 \\(m(m\\ge 2)\\) 组中的一组，这对应于解释变量的类别时，这些组可以通过因素的水平进行索引。在 Cox 回归模型下，第 \\(j(j=1,2,\\ldots,m)\\) 组中个体的风险函数为 \\[\\begin{aligned}h_j(t)=\\exp(\\gamma_j)h_0(t)\\end{aligned}\\] 其中 \\(\\gamma_j\\) 是因素的第 \\(j\\) 个水平的效应，\\(h_0(t)\\) 是基线风险函数。该模型过度参数化了，因此，如 3.2.2 节所示，我们取 \\(\\gamma_1=0\\)。基线风险函数对应于第一组中的个体在时间 \\(t\\) 的死亡风险。第 \\(j(j\\ge 2)\\) 组中的个体在时间 \\(t\\) 的风险比相对于第一组中的个体的风险比为 \\(\\exp(\\gamma_j)\\)。因此，参数 \\(\\gamma_j\\) 是该相对风险的对数，即 \\[\\begin{aligned}\\gamma_j=\\log\\{h_j(t)/h_0(t)\\}\\end{aligned}\\] 可以通过定义 \\(m-1\\) 个指示变量 \\(X_2,X_3,...,X_m\\)（如 3.2.2 节所示）来拟合包含 \\(\\gamma_j(j = 1,2,...,m)\\) 且 \\(\\gamma_1 = 0\\) 的模型。拟合该模型会得出估计值 \\(\\hat\\gamma_2,\\hat\\gamma_3,\\ldots,\\hat\\gamma_m\\) 及其标准误。那么，，第 j 组的个体相对于第 1 组的个体的相对风险比的对数估计值为 \\(\\hat\\gamma_j\\)。真实对数风险比的 \\(100(1 − \\alpha)\\%\\) 置信区间是从 \\(\\hat{\\gamma}_j-z_{{\\alpha}/2}\\text{se}\\left(\\hat{\\gamma}_j\\right)\\) 到 \\(\\hat{\\gamma}_j+z_{{\\alpha}/2}\\text{se}\\left(\\hat{\\gamma}_j\\right)\\) 的区间，其中 \\(z_{{\\alpha}/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位数。通过对这些置信限进行指数运算，可以得到风险比本身的相应置信区间。 示例 3.10 (肾癌的治疗) 表 3.6 给出了肾癌患者的生存时间数据。在本例中，我们将只考虑表 3.6 第 4 - 6 列中所示的那些接受过肾切除术的患者的数据。这组患者的生存时间是根据他们的年龄组进行分类的。如果第 \\(j\\) 个年龄组的效应用 \\(\\alpha_j\\) 表示，\\(j=1,2,3\\)，则第 \\(j\\) 个年龄段患者在时间 \\(t\\) 的风险的 Cox 回归模型如下 \\[\\begin{aligned}h_j(t)=\\exp(\\alpha_j)h_0(t)\\end{aligned}\\] 该模型可以通过定义两个指示变量 \\(A_2\\) 和 \\(A_3\\) 来拟合，其中，如果患者年龄在 60 岁到 70 岁之间，\\(A_2\\) 为 1，如果患者超过 70 岁，\\(A_3\\) 为 1，如示例 3.4 所示。这对应于 \\(\\alpha_1=0\\)。 零模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值为 128.901，当添加项 \\(\\alpha_j\\) 时，该统计量的值减小为 122.501。在 2 个自由度上减小了 6.400. 在 5% 水平上显著 (\\(P = 0.041\\))，因此我们得出结论，风险函数确实取决于患者所处的年龄组。 指示变量 \\(A_2\\) 和 \\(A_3\\) 的系数分别是 \\(\\alpha_2\\) 和 \\(\\alpha_3\\) 的估计，见表 3.14. 由于使用了约束 \\(\\alpha_1 = 0\\)，因此 \\(\\hat\\alpha_1 = 0\\)。 表 3.14 60 - 70 岁患者相对于 60 岁以下患者的风险比为 \\(e^{-0.065}=0.94\\)，而 70 岁以上患者相对于 60 岁以下患者的风险比为 \\(e^{1.824}=6.20\\)。这些结果表明，在任何给定时间，70 岁以上患者的死亡风险最大，但其他两个年龄组患者的风险函数几乎没有差异。 表 3.14 中参数估计的标准误可用于获得真实风险比的置信区间。对于年龄在 60 - 70 岁之间的患者，相对于年龄在 60 岁以下的患者，其对数风险比的 95% 置信区间是 \\(−0.065 ± (1.96 × 0.498)\\)，即区间 \\((−1.041, 0.912)\\)。对于风险比本身，相应的 95% 置信区间是 \\((0.35, 2.49)\\)。该置信区间包含 1，这表明年龄在 60 - 70 岁之间的个体的风险函数与年龄小于 60 岁的患者相似。同样地，年龄在 70 岁以上的患者相对于年龄在 60 岁以下的患者，其风险比的 95% 置信区间为 \\((1.63, 23.59)\\)。该区间不包含 1，因此，在任何给定时间，年龄超过 70 岁的个体的死亡风险显著高于年龄在 60 岁以下的患者。 在某些应用中，可能需要计算除第一个水平以外的其他因素水平的风险比。在这种情况下，可以重新定义该因素的水平以及相关的指示变量，使该因素的某个其他水平对应于所需的基线水平，然后重新拟合模型。虽然这比较困难，但也可以直接从以原始因素的第一个水平为基线时获得的估计值中直接找到所需的估计值。 因素水平 \\(j\\) 和 \\(j^\\prime\\) 的个体的风险函数分别为 \\(\\exp(\\alpha_j)h_0(t)\\) 和 \\(\\exp(\\alpha_{j^\\prime})h_0(t)\\)，因此水平 \\(j\\) 的个体相对于水平 \\(j^\\prime\\) 的个体的风险比为 \\(\\exp(\\alpha_j-\\alpha_{j&#39;})\\)。对数风险比为 \\(\\alpha_j-\\alpha_{j&#39;}\\)，其估计为 \\(\\hat\\alpha_j-\\hat\\alpha_{j&#39;}\\)。为了获得该估计的标准误，我们使用差值 \\(\\hat\\alpha_j-\\hat\\alpha_{j&#39;}\\) 方差的如下结果 \\[\\begin{aligned}\\text{var}\\left(\\hat{\\alpha}_j-\\hat{\\alpha}_{j&#39;}\\right)&amp;=\\text{ var}\\left(\\hat{\\alpha}_j\\right)+\\text{ var}\\left(\\hat{\\alpha}_{j&#39;}\\right)-2\\text{ cov}\\left(\\hat{\\alpha}_j,\\hat{\\alpha}_{j&#39;}\\right)\\end{aligned}\\] 鉴于此，需要估计 \\(\\hat\\alpha_j\\) 和 \\(\\hat\\alpha_{j&#39;}\\) 之间的协方差以及它们的方差估计来计算 \\(\\hat\\alpha_j-\\hat\\alpha_{j&#39;}\\) 的标准误。计算如示例 3.11 所示。 示例 3.11 (肾癌的治疗) 再次考虑示例 3.4 中的数据子集，这对应于那些接受过肾切除术的患者。假设需要估计 70 岁以上个体相对于 60 - 70 岁个体的风险比。使用表 3.14 中的估计，对数风险比估计为 \\(\\hat{\\alpha}_3-\\hat{\\alpha}_2=1.824+0.065=1.889\\)，因此风险比估计为 \\(e^{1.889}=6.61\\)。这表明，70 岁以上的人在任何时间的死亡风险是 60 - 70 岁的人的 6.5 倍以上。 \\(\\hat{\\alpha}_3-\\hat{\\alpha}_2\\) 的方差为 \\[\\begin{aligned}\\operatorname{var}\\left(\\hat{\\alpha}_3\\right)+\\operatorname{var}\\left(\\hat{\\alpha}_2\\right)-2\\operatorname{cov}\\left(\\hat{\\alpha}_3,\\hat{\\alpha}_2\\right)\\end{aligned}\\] 参数估计的方差-协方差阵给出了所需的方差和协方差。该矩阵可以从用于拟合 Cox 回归模型的统计软件中获得，为 \\[\\begin{array}{cc}A_2\\\\A_3\\\\\\,\\end{array}\\begin{array}{cc}0.2484&amp;0.0832\\\\0.0832&amp;0.4649\\\\A_2&amp;A_3\\end{array}\\] 其中 \\(\\text{var}\\left(\\hat{\\alpha}_2\\right)=0.2484,\\text{var}\\left(\\hat{\\alpha}_3\\right)=0.4649\\) 以及 \\(\\mathrm{cov}\\left(\\hat{\\alpha}_2,\\hat{\\alpha}_3\\right)=0.0832\\)。当然，方差只是表 3.14 中标准误的平方。那么 \\[\\begin{aligned}\\text{var}\\left(\\hat{\\alpha}_3-\\hat{\\alpha}_2\\right)=0.4649+0.2484-(2\\times0.0832)=0.5469\\end{aligned}\\] 因此 \\(\\hat{\\alpha}_3-\\hat{\\alpha}_2\\) 的标准误为 0.740。因此，对数风险比的 95% 置信区间为 \\((0.440, 3.338)\\)，风险比本身的 95% 置信区间为 \\((1.55, 28.18)\\)。 获取年龄大于 70 岁的个体相对于年龄在 60 - 70 岁之间的个体的风险比估计及其估计的标准误的一种更简单的方法，是重新定义与年龄组相关的因素的水平。假设数据现在是这样安排的：因素的第一水平对应于 60 - 70 岁的患者，第二水平对应于年龄大于 70 岁的患者，第三水平对应于年龄小于 60 岁的患者。选择指示变量使得重新定义的因素的第一水平的效应等于零，从而得到表 3.15 中定义的变量 \\(B_2\\) 和 \\(B_3\\)。现在，所需对数风险比估计就是 \\(B_2\\) 的系数估计，而其标准误可以直接从标准计算机输出中读取。 表 3.15 指示变量系数的解释方式在很大程度上取决于它们所使用的编码。这意味着，当使用能够直接拟合因素的统计软件包来拟合 Cox 回归模型时，必须了解软件包中使用的指示变量是如何定义的。 为进一步说明，假设个体属于 \\(m\\) 个组中的一个，并且用于 \\(m − 1\\) 个指示变量 \\(X_2, X_3,...,X_m\\) 的编码使得 \\(A\\) 的主效应之和 \\(\\sum_{j=1}^m\\alpha_j\\) 等于 0。具有 \\(m\\) 个水平的因素 \\(A\\) 对应的指示变量值如表 3.16 所示。 表 3.16 通过选择指示变量，包含该因素的 Cox 回归模型可以表示为以下形式 \\[\\begin{aligned}h_j(t)=\\exp(\\alpha_2x_2+\\alpha_3x_3+\\cdots+\\alpha_mx_m)h_0(t)\\end{aligned}\\] 其中 \\(x_j\\) 是因素 \\(A\\) 处于第 \\(j\\) 水平的个体的 \\(X_j\\) 值，\\(j = 2, 3,...,m\\)。处于因素第一水平的个体在给定时间的死亡风险为 \\[\\begin{aligned}\\exp\\{-(\\alpha_2+\\alpha_3+\\cdots+\\alpha_m)\\}h_0(t)\\end{aligned}\\] 而对于第 \\(j\\) 水平因素的个体，其风险比为 \\(\\exp(\\alpha_j)h_0(t)\\)，其中 \\(j \\ge 2\\)。组 \\(j\\) 中的个体的风险比相对于第一组中的个体的风险比为 \\[\\begin{aligned}\\exp(\\alpha_j+\\alpha_2+\\alpha_3+\\cdots+\\alpha_m)\\end{aligned}\\] 例如，如果 \\(m = 4\\) 且 \\(j = 3\\)，则风险比为 \\(\\exp(\\alpha_2+2\\alpha_3+\\alpha_4)\\)，相应对数风险比估计的方差为 \\[\\begin{aligned}\\operatorname{var}\\left(\\hat{\\alpha}_2\\right)+4\\operatorname{var}\\left(\\hat{\\alpha}_3\\right)+\\operatorname{var}\\left(\\hat{\\alpha}_4\\right)+4\\operatorname{cov}\\left(\\hat{\\alpha}_2,\\hat{\\alpha}_3\\right)\\\\+4\\operatorname{cov}\\left(\\hat{\\alpha}_3,\\hat{\\alpha}_4\\right)+2\\operatorname{cov}\\left(\\hat{\\alpha}_2,\\hat{\\alpha}_4\\right)\\end{aligned}\\] 该表达式中的每一项都可以在拟合 Cox 回归模型后从参数估计的方差-协方差阵中找到，并获得风险比的置信区间。然而，指示变量的这种特殊编码使拟合模型各个参数估计的解释变得更加复杂。 在前面的部分中，我们仅考虑了包含单个项的 Cox 回归模型参数估计的解释。更一般地，拟合模型将包含与多个变量、因素或两者的组合相对应的项。通过对与模型中的因素相对应的指标变量进行适当的编码，参数估计可以再次解释为风险比的对数。 当一个模型包含一个以上的变量时，与特定效应相关的参数估计被认为是经模型中其他变量调整的 (adjusted)，因此这些估计是经模型其他项调整的对数风险比。因此，考虑模型中包含的其他变量，Cox 回归模型可用于估计风险比。 当拟合因素之间的交互作用，或涉及因素和变量的混合项时，特定因素的对数风险比估计将因任何因素的水平或与之交互的任何变量的值而异。在这种情况下研究感兴趣因素的风险比估计时，需要明确任何此类因素水平或变量的值。 我们不会详细介绍在拟合具有不同项的组合的模型后如何估计风险比的代数细节，而是将通过两个例子来说明一般方法。第一个例子涉及因素和变量，而第二个例子包括两个因素之间的交互作用。 示例 3.12 (前列腺癌两种疗法的比较) 在示例 3.6 中，发现在前列腺癌患者的生存研究中最重要的预后变量是肿瘤大小 (Size) 和肿瘤分期的 Greason index (Index). 代表治疗效应的指示变量 Treat 也包含在 Cox 回归模型中，因为研究的目的是量化治疗效应。第 \\(i\\) 个个体的模型可以表示为以下形式 \\[\\begin{aligned}h_i(t)=\\exp\\{\\beta_1Size_i+\\beta_2Index_i+\\beta_3Treat_i\\}h_0(t)\\end{aligned}\\] 其中 \\(i=1,2,\\ldots,38\\)。该模型的 \\(\\beta\\) 系数估计及其标准误如表 3.17 所示。 表 3.17 对于接受 DES 治疗 (Treat = 1) 的个体，与接受安慰剂 (Treat = 0) 的个体相比，在 Size 和 Index 值相同的情况下，其对数风险比估计为 \\(\\hat{\\beta}_3=-1.113\\)。因此，风险比估计为 \\(e^{-1.113}=0.329\\)。这个风险比的值不受 Size 和 Index 实际值的影响。然而，由于这两个解释变量被纳入了模型，因此估计的风险比已经针对这些变量进行了调整。 作为比较，如果拟合仅包含 Treat 的模型，则 Treat 的系数估计为 -1.978. 相对于使用安慰剂的个体，使用 DES 的个体的风险比估计（未经 Size 和 Index 调整）现在为 \\(e^{-1.978}=0.14\\)。这表明，除非适当考虑肿瘤大小和肿瘤分级指数的影响，否则会高估治疗效应。 现在考虑某接受特定治疗的个体，在变量 Index 值一定且肿瘤大小一定的情况下，与接受相同治疗、Index 值相同但肿瘤大小小一个单位的个体相比的风险比。该风险比为 \\(e^{0.083}=1.09\\)。因为这个值大于 1，我们可以得出结论，在其他条件相同的情况下，肿瘤越大，在任何给定时间的死亡风险就越大。类似地，某接受特定治疗且 Size 值一定的个体，与接受相同治疗、Size 值相同但 Index 值小一个单位的个体相比的风险比为 \\(e^{0.710}=2.03\\)。这也意味着，Gleason 指数的值越大，在任何给定时间的死亡风险就越大。具体来说，Index 值增加一个单位会使死亡风险加倍。 示例 3.12 (肾癌的治疗) 再次考虑表 3.6 中给出的肾癌治疗后生存时间的完整数据集。在示例 3.4 中，发现最合适的 Cox 回归模型包含对应于年龄组的项 \\(\\alpha_j, j = 1, 2, 3\\)，以及对应于是否进行肾切除术的项 \\(\\nu_k, k = 1, 2\\)。出于说明目的，在本示例中，我们将考虑还包含这两个因素之间交互作用的模型，尽管该模型并不显著。在此模型下，第 \\(j\\) 个年龄组和第 \\(k\\) 个肾切除状态水平的个体的风险函数为 \\[\\begin{equation} h(t)=\\exp\\{\\alpha_j+\\nu_k+(\\alpha\\nu)_{jk}\\}h_0(t) \\tag{3.17} \\end{equation}\\] 其中 \\((\\alpha\\nu)_{jk}\\) 为交互作用项。 考虑第 \\(j(j = 1, 2, 3)\\) 个年龄组、第 \\(k(k = 1, 2)\\) 个肾切除状态水平的患者相对于第一个年龄组、接受肾切除术的患者在时间 \\(t\\) 的死亡风险比 \\[\\begin{aligned}\\exp\\{\\alpha_j+\\nu_k+(\\alpha\\nu)_{jk}\\}\\\\\\exp\\{\\alpha_1+\\nu_1+(\\alpha\\nu)_{11}\\}\\end{aligned}\\] 如示例 3.4 所示，式 (3.17) 中的模型是通过在模型中包含指示变量 \\(A_2,A_3\\) 和 \\(N\\) 以及乘积 \\(A_2N\\) 和 \\(A_3N\\) 来拟合的。这些变量的系数估计分别为 \\(\\alpha_2,\\alpha_3,\\nu_2,(\\alpha\\nu)_{22}\\) 和 \\((\\alpha\\nu)_{32}\\)。根据所使用的指示变量的编码，估计值 \\(\\hat{\\alpha}_{2},\\hat{\\alpha}_{3},\\hat{\\nu}_{2},\\widehat{\\left(\\alpha\\nu\\right)}_{22}\\) 和 \\(\\widehat{\\left(\\alpha\\nu\\right)}_{32}\\) 均为零。第 \\(j(j = 1, 2, 3)\\) 个年龄组、第 \\(k(k = 1, 2)\\) 个肾切除状态水平的患者相对于第一个年龄组、接受肾切除术的患者的死亡风险比估计，为 \\[\\exp\\{\\hat{\\alpha}_j+\\hat{\\nu}_k+\\widehat{(\\alpha\\nu)}_{jk}\\}\\] 非零参数估计值为 \\(\\hat{\\alpha}_2=0.005,\\hat{\\alpha}_3=0.065,\\hat{\\nu}_2=-1.943,\\widehat{(\\alpha\\nu)}_{22}=-0.051\\) 和 \\(\\widehat{\\left(\\alpha\\nu\\right)_{32}}=2.003\\)，风险比估计总结于表 3.18 中。 表 3.18 在表 3.18 中，包含了风险比估计为 1.000 的因素水平组合，这强调了风险是相对于第一年龄组中没有接受过肾切除手术的个体而言的。该表显示，与其他年龄组的个体以及未接受肾切除手术的个体相比，年龄小于等于 70 岁且接受过肾切除手术的个体死亡风险要小得多。 可以使用 3.9.2 节中描述的方法找到相应真实风险比的置信区间。作为进一步说明，将获得接受过肾切除术的第二年龄组中的个体相对于第一年龄组中的个体的风险比的置信区间。对数风险比估计现在为 \\(\\hat{\\alpha}_2+\\widehat{(\\alpha\\nu)}_{22}\\)，因此风险比估计为 0.955。该估计的方差由下式给出 \\[\\begin{aligned}\\operatorname{var}\\left(\\hat{\\alpha}_2\\right)+\\operatorname{var}\\left\\{\\widehat{\\left(\\alpha\\nu\\right)}_{22}\\right\\}+2\\operatorname{cov}\\left\\{\\hat{\\alpha}_2,\\widehat{\\left(\\alpha\\nu\\right)}_{22}\\right\\}\\end{aligned}\\] 根据式 (3.17) 拟合模型，从其参数估计的方差-协方差阵可得，\\(\\operatorname{var}\\left(\\hat{\\alpha}_2\\right)=0.697,\\operatorname{var}\\left\\{\\widehat{\\left(\\alpha\\nu\\right)}_{22}\\right\\}=0.942\\)，协方差项为 \\(\\mathrm{cov}\\left\\{\\hat{\\alpha}_2,\\widehat{(\\alpha\\nu)}_{22}\\right\\}=-0.695\\)。因此，对数风险比估计的方差为 0.248，因此真实对数风险比的 95% 置信区间范围为 -0.532 到 0.441. 真实风险比的相应置信区间为 \\((0.59, 1.55)\\)。该区间包含 1，因此风险比 0.955 在 5% 水平下与 1 没有显著差异。表 3.18 中风险比的置信区间可以用类似的方式得出。 3.10 估计风险函数和生存函数 到目前为止，在本章中，我们只考虑了 Cox 回归模型中线性部分的 \\(\\beta\\) 参数的估计。正如我们所见，为了推断模型中解释变量对风险函数的影响，我们只需要进行这些步骤。一旦确定了适用于一组生存数据的合适模型，就可以估计风险函数和相应的生存函数。然后，这些估计值可用于总结研究中个体的生存经历。 假设 Cox 回归模型的线性部分包含 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\)，并且这些变量的估计系数为 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\)。研究中 \\(n\\) 个个体的第 \\(i\\) 个风险函数估计由下式给出 \\[\\begin{equation} \\hat{h}_i(t)=\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol x_i)\\hat{h}_0(t) \\tag{3.18} \\end{equation}\\] 其中 \\(\\boldsymbol x_i\\) 是第 \\(i\\) 个个体的解释变量的值向量，\\(i = 1, 2,...,n\\)，\\(\\hat {\\boldsymbol \\beta}\\) 是系数向量的估计，\\(\\hat h_0(t)\\) 是基线风险函数估计。使用该方程，一旦得到 \\(h_0(t)\\) 的估计，就可以得到个体风险函数估计。然后可以使用风险、累积风险和生存函数之间的关系来给出累积风险函数和生存函数的估计。 Kalbfleisch and Prentice (1973) 使用基于最大似然法的方法得出了基线风险函数的估计。假设有 \\(r\\) 个不同的死亡时间，按升序排列时，为 \\(t_{(1)}&lt;t_{(2)}&lt;\\cdots&lt;t_{(j)}\\)，并且在时间 \\(t\\) 有 \\(d_j\\) 个人死亡，\\(n_j\\) 个人处于风险之中。时间 \\(t_{(j)}\\) 处的基线风险函数估计由下式给出 \\[\\begin{equation} \\hat{h}_0(t_{(j)})=1-\\hat{\\xi_j} \\tag{3.19} \\end{equation}\\] 其中 \\(j=1,2,\\ldots,r\\)。\\(\\widehat{\\xi}_j\\) 为下式的解 \\[\\begin{equation} \\sum_{l\\in D(t_{(j)})}\\frac{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}{1-\\hat{\\xi}_j^{\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol x_l)}}=\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l) \\tag{3.20} \\end{equation}\\] 在式 (3.20) 中，\\(D(t_{(j)})\\) 是在第 \\(j\\) 个有序死亡时间 \\(t_{(j)}\\) 处死亡的所有 \\(d_j\\) 个个体的集合，以及如 3.3 节所示，\\(R(t_{(j)})\\) 是在时间 \\(t_{(j)}\\) 处于风险中的所有 \\(n_j\\) 个人的集合。那些 \\(\\beta\\) 的估计构成了向量 \\(\\hat{\\boldsymbol \\beta}\\)，就是那些使式 (3.4) 中的似然函数达到最大化的值。\\(h_0(t)\\) 的估计的推导相当复杂，此处不再赘述。 在没有死亡时间结的情况下，即对于 \\(j=1,2,\\ldots,r\\) 有 \\(d_j=1\\)，式 (3.20) 的左侧将成为单个项（直接省去求和号）。那么可以求解该方程，得到 \\[\\begin{equation} \\hat{\\xi_j}=\\left(1-\\frac{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_{(j)})}{\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}\\right)^{\\exp(-\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_{(j)})} \\end{equation}\\] 其中 \\(\\boldsymbol{x}_{(j)}\\) 是在时间 \\(t_{(j)}\\) 死亡的个体的解释变量向量。 当存在观测结时，即当一个或多个 \\(d_j&gt;1\\) 时，式 (3.20) 左侧的求和是一系列分数之和，其中，在分母中出现了 \\(\\widehat{\\xi}_{j}\\)，并具有不同的幂次。则式 (3.20) 无法显式求解，需要迭代计算。 我们现在假设相邻死亡时间之间的死亡风险是恒定的。然后，通过将式 (3.19) 中的风险估计除以时间区间长度，从而得到该区间内基线风险函数的合适估计，这是一个阶跃函数 \\[\\begin{equation} \\hat{h}_0(t)=\\frac{1-\\hat{\\xi}_j}{t_{(j+1)}-t_{(j)}} \\tag{3.21} \\end{equation}\\] 其中 \\(t_{(j)}\\leqslant t&lt;t_{(j+1)},j=1,2,\\ldots,r-1\\)，且对于 \\(t&lt;t_{(1)}\\) 有 \\(\\hat{h}_0(t)=0\\)。 量 \\(\\hat{\\xi}_j\\) 可视为个体在 \\(t_{(j)}\\) 到 \\(t_{(j+1)}\\) 区间内生存概率的估计。那么基线生存函数可估计为 \\[\\begin{equation} \\hat{S}_0(t)=\\prod_{j=1}^k\\hat{\\xi}_j \\tag{3.22} \\end{equation}\\] 其中 \\(t_{(k)}\\leqslant t&lt;t_{(k+1)},k=1,2,\\ldots,r-1\\)，该估计也为阶跃函数。且对于 \\(t&lt;t_{(1)}\\)，基线生存函数的估计为 1；对于 \\(t\\geqslant t_{(r)}\\)，估计为 0，除非有大于 \\(t_{(r)}\\) 的删失生存时间，如果是这种情况，则在最大删失时间之前可以将 \\(\\hat{S}_0(t)\\) 取为 \\(\\hat{S}_0(t_{(r)})\\)，但在该时间之后生存函数估计是未定义的。 根据式 (1.8)，基线累积风险函数为 \\(H_0(t)=-\\log S_0(t)\\)，该函数的估计为 \\[\\begin{equation} \\hat{H}_0(t)=-\\log\\hat{S}_0(t)=-\\sum_{j=1}^k\\log\\hat{\\xi}_j \\tag{3.23} \\end{equation}\\] 其中 \\(t_{(k)}\\leqslant t&lt;t_{(k+1)},k=1,2,\\ldots,r-1\\)，且对于 \\(t&lt;t_{(1)}\\) 有 \\(\\hat{H}_0(t)=0\\)。 式 (3.21), (3.22) 和 (3.23) 中的基线风险函数、生存函数和累积风险函数的估计可用于得到具有解释变量向量 \\(\\boldsymbol{x}_{i}\\) 的个体的相应估计。具体来说，根据式 (3.18) ，通过 \\(\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol x_i)\\hat{h}_0(t)\\) 来估计风险函数。接下来，对式 (3.18) 两边进行积分，我们得到 \\[\\begin{equation} \\int_0^t\\hat{h}_i(u)\\mathrm{d}u=\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i)\\int_0^t\\hat{h}_0(u)\\mathrm{d}u \\tag{3.24} \\end{equation}\\] 因此第 \\(i\\) 个个体的累积风险函数估计为 \\[\\begin{equation} \\hat{H}_{\\boldsymbol{i}}(t)=\\operatorname{exp}(\\hat{\\boldsymbol \\beta}&#39;\\boldsymbol x_{{i}})\\hat{H}_{0}(t) \\tag{3.25} \\end{equation}\\] 将式 (3.24) 的两边乘以 −1 后进行指数运算，并利用式 (1.6)，我们得到第 \\(i\\) 个个体的生存函数估计 \\[\\begin{equation} \\hat{S}_i(t)=\\left\\{\\hat{S}_0(t)\\right\\}^{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i)} \\tag{3.26} \\end{equation}\\] 其中 \\(t_{(k)}\\leqslant t&lt;t_{(k+1)},k=1,2,\\ldots,r-1\\)。请注意，一旦获得了生存函数估计 \\(\\hat{S}_i(t)\\)，累积风险函数的估计就简单地是 \\(-\\operatorname{log}\\hat{S}_{{i}}(t)\\)。 3.10.1 无协变量的特例 当不存在协变量时，因此我们只有一个生存时间样本，式 (3.20) 变为 \\[\\begin{aligned}\\frac{d_j}{1-\\hat{\\xi}_j}&amp;=n_j\\end{aligned}\\] 其中 \\[\\hat{\\xi_j}=\\frac{n_j-d_j}{n_j}\\] 那么，在时间 \\(t_{(j)}\\) 处的基线风险函数估计为 \\(1-\\hat{\\xi}_j\\)，也就是 \\(d_j/n_j\\)。式 (3.22) 中生存函数的相应估计为 \\(\\prod_{j=1}^k\\hat{\\xi}_j\\)，即 \\[\\prod_{j=1}^k\\left(\\frac{n_j-d_j}{n_j}\\right)\\] 这正是之前在式 (2.4) 中给出的生存函数的 Kaplan-Meier 估计。这表明，式 (3.26) 给出的生存函数估计将 Kaplan-Meier 估计推广到风险函数取决于解释变量的情况。 此外，式 (3.21) 中的风险函数估计简化为 \\(d_j/\\{n_j(t_{(j+1)}-t_{(j)})\\}\\)，这是第 2 章式 (2.13) 中给出的风险函数估计。 3.10.2 基线函数估计的一些近似 当存在生存时间结时，只能通过使用迭代方法求解式 (3.20) 来得到的基线风险估计。但可以通过使用式 (3.20) 左侧求和的近似来绕过这种迭代过程。 在式 (3.20) 左侧分母中的项 \\[\\hat{\\xi}_j^{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}\\] 可写为 \\[\\exp\\left\\{e^{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l}\\log\\hat{\\xi}_j\\right\\}\\] 取指数展开中的前两项，得到 \\[\\exp\\left\\{e^{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l}\\log\\hat{\\xi}_j\\right\\}\\approx1+e^{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l}\\log\\hat{\\xi}_j\\] 将使用该近似在时间 \\(t_{\\left(j\\right)}\\) 处获得的基线风险估计记作 \\(1-\\tilde{\\xi}_j\\)，并在式 (3.20) 中用 \\(1+e^{\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l}\\log\\widetilde{\\xi}_{j}\\) 替换 \\(\\hat{\\xi}_j^{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}\\)，我们发现 \\(\\tilde{\\xi}_j\\) 满足 \\[-\\sum_{l\\in D(t_{(j)})}\\frac1{\\log\\tilde{\\xi}_j}=\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)\\] 因此 \\[\\begin{aligned}\\frac{-d_j}{\\log\\widetilde{\\xi_j}}&amp;=\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)\\end{aligned}\\] 由于 \\(d_j\\) 是第 \\(j\\) 个有序死亡时间 \\(t_{(j)}\\) 处的死亡人数，因此 \\[\\begin{equation} \\tilde\\xi_j=\\exp\\left(\\frac{-d_j}{\\sum_{l\\in R(t_{(j)})}\\exp(\\hat\\boldsymbol\\beta&#39;\\boldsymbol{x}_l)}\\right) \\tag{3.27} \\end{equation}\\] 根据式 (3.22) ，基于 \\(\\tilde{\\xi}_j\\) 的值，生存函数的估计为 \\[\\begin{equation} \\tilde{S}_0(t)=\\prod_{j=1}^k\\exp\\left(\\frac{-d_j}{\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_l)}\\right) \\tag{3.28} \\end{equation}\\] 其中 \\(t_{(k)}\\leqslant t&lt;t_{(k+1)},k=1,2,\\ldots,r-1\\)。根据该定义，与式 (3.22) 中的估计不同，当最长生存时间未删失时，生存函数估计不一定为 0. 根据 \\(\\tilde{S}_0(t)\\) 得出的基线累积风险函数的估计为 \\[\\begin{equation} \\tilde{H}_0(t)=-\\log\\tilde{S}_0(t)=\\sum_{j=1}^k\\frac{d_j}{\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol x_l)} \\tag{3.29} \\end{equation}\\] 其中 \\(t_{(k)}\\leqslant t&lt;t_{(k+1)},k=1,2,\\ldots,r-1\\)。该估计通常称为基线累积风险函数的 Nelson-Aalen 估计或 Breslow 估计。 当不存在协变量时，由于 \\(n_j\\) 是在时间 \\(t_{(j)}\\) 处于风险的个体数量，式 (3.28) 中的基线生存函数估计变为 \\[\\begin{equation} \\prod_{j=1}^k\\exp(-d_j/n_j) \\tag{3.30} \\end{equation}\\] 这是第 2 章式 (2.5) 中给出的生存函数的 Nelson-Aalen 估计，基线累积风险函数的相应估计为 \\(\\sum_{j=1}^kd_j/n_j\\) ，如第 2 章 2.3.3 节所示。 注意到表达式 \\[\\frac{-d_j}{\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)}\\] 是式 (3.27) 的指数部分，该值往往很小，除非在特定死亡时间有大量的结。取此指数展开的前两项，将这个关于 \\(\\xi_j\\) 的新的近似记为 \\(\\xi_j^*\\)，得到 \\[\\xi_j^*=1-\\frac{d_j}{\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)}\\] 利用式 (3.21)，从 \\(t_{(j)}\\) 到 \\(t_{(j+1)}\\) 的区间的基线风险函数估计由下式给出 \\[\\begin{equation} h_0^*(t)=\\frac{d_j}{(t_{(j+1)}-t_{(j)})\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)} \\tag{3.31} \\end{equation}\\] 其中 \\(t_{(j)}\\leqslant t&lt;t_{(j+1)},j=1,2,\\ldots,r-1\\)。使用 \\(\\xi_{j}^{*}\\) 替换式 (3.22) 中的 \\(\\xi_{j}\\)，相应的基线生存函数估计为 \\[\\begin{aligned}S_0^*(t)=\\prod_{j=1}^k\\left(1-\\frac{d_j}{\\sum_{l\\in R(t_{(j)})}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)}\\right)\\end{aligned}\\] 以及，基线累积风险函数估计的进一步近似为 \\(H^*_0(t)=-\\log S_0^*(t)\\)。请注意，式 (3.29) 中在时间 \\(t\\) 处 的累积风险函数可以表示为 \\[\\begin{aligned}\\tilde{H}_0(t)=\\sum_{j=1}^k(t_{(j+1)}-t_{(j)})h_0^*(t)\\end{aligned}\\] 其中 \\(h^*_0(t)\\) 由式 (3.31) 给出。因此，式 (3.29) 中基线累积风险函数估计的连续值之差提供了在时间 \\(t_{(1)},t_{(2)},\\ldots,t_{(r)}\\) 处的基线风险函数的近似，这很容易计算。 在无协变量的特例中，估计 \\(h_0^*(t),S_0^*(t)\\) 和 \\(H_0^*(t)\\) 与 3.10.1 节中给出的相同。类似于式 (3.25) 和 (3.26) 的方程可用于估计解释变量向量为 \\(\\boldsymbol x_i\\) 的个体的累积风险和生存函数。 在实践中，使用 \\(\\tilde{S}_0(t)\\) 或 \\(S_0^*(t)\\) 代替 \\(\\hat{S}_0(t)\\) 通常在计算上是有利的。当生存时间结的数量很小时，三种估计往往非常相似。此外，由于估计通常用作生存数据的描述性总结，因此估计之间的微小差异不太可能具有实际意义。 示例 3.13 (肾癌的治疗) 在示例 3.4 中，利用 Cox 回归模型拟合了高肾瘤患者的生存时间数据。研究发现，风险函数取决于患者的年龄组，以及是否进行了肾切除术。第 \\(i\\) 名患者的风险函数估计为 \\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{0.013A_{2i}+1.342A_{3i}-1.412N_i\\}\\hat{h}_0(t)\\end{aligned}\\] 其中，如果患者年龄在 60 - 70 岁之间，则 \\(A_{2i}\\) 为 1，否则为 0；如果患者年龄超过 70 岁，则 \\(A_{3i}\\) 为 1，否则为 0，并且如果患者进行了肾切除术，则 \\(N_i\\) 为 1，反之为 0. 因此基线风险函数估计是年龄小于 60 且未进行肾切除术的个体在时间 \\(t\\) 时死亡的风险估计。 分别使用式 (3.19), (3.23) 和 (3.22) 得到的基线风险函数估计 \\(\\hat{h}_0(t)\\)、累积风险函数估计 \\(\\hat{H}_0(t)\\) 和 生存函数估计 \\(\\hat{S}_0(t)\\)，列于表 3.19 中。 表 3.19 根据该表，我们可以看出，基线风险函数估计的总体趋势是随着时间的推移而增加。根据基线风险函数估计的计算方式，该估计仅适用于研究中患者的死亡时间。然而，如果假设在每个时间区间内存在恒定的风险，通过将估计的风险除以相应的时间区间长度，可以得到每单位时间的死亡风险。这得到了式 (3.21) 中的估计。该风险函数如图 3.4 所示。 图 3.4 该图显示，在研究期间，每单位时间的死亡风险大致恒定。表 3.19 还显示，正如预期的那样，\\(\\hat{H}_{0}(t)\\) 的连续观测之差与 \\(\\hat{h}_{0}(t)\\) 非常相似。 我们现在考虑中位生存时间估计，其定义为生存函数估计小于 0.5 的最小观测生存时间。根据表 3.19，年龄在 60 岁以下且未进行肾切除术的患者的中位生存时间估计为 12 个月。 通过将基线生存函数估计的指定合适的幂，可以使用式 (3.26) 获得其他年龄组患者以及接受过肾切除术患者的生存函数估计。因此，第 \\(i\\) 个个体的生存函数估计由下式给出 \\[\\hat{S}_i(t)=\\left\\{\\hat{S}_0(t)\\right\\}^{\\exp\\{0.013A_{2i}+1.342A_{3i}-1.412N_i\\}}\\] 对于一个年龄小于 60 岁、接受过肾切除术的个体，有 \\(A_2=0,A_3=0\\) 以及 \\(N_=1\\)，因此该个体的生存函数估计成为 \\[\\left\\{\\hat{S}_0(t)\\right\\}^{\\exp\\{-1.412\\}}\\] 该函数与同一年龄组但未接受肾切除术个体的基线生存函数估计一起绘制在图 3.5 中。此图表明，接受肾切除术的患者相比未接受肾切除术的患者，在任何给定时间的生存概率都更大，从而证实肾切除术能够改善肾癌患者的预后。 图 3.5 请注意，由于假设了比例风险，图 3.5 中的两个生存函数估计不会交叉。此外，那些接受过肾切除的患者的生存函数估计高于那些没有接受过肾切除的患者。这是接受过手术的人相对于未接受手术的人风险比估计小于 1 的直接结果。 此类患者的中位生存时间估计可以从生存函数估计的表格或图 3.5 中获得。我们发现，年龄小于 60 岁、接受肾切除术的患者的中位生存时间估计为 36 个月。可以使用类似的方法估计生存时间分布的其他百分位数。 以类似的方式，可以比较不同年龄组患者的生存函数，无论是否接受过肾切除术。例如，对于接受过肾切除术的患者，三个年龄组患者的生存函数估计分别为 \\(\\{\\hat{S}_0(t)\\}^{\\exp\\{-1.412\\}},~\\{\\hat{S}_0(t)\\}^{\\exp\\{-1.412+0.013\\}}\\) 和 \\(\\{\\hat{S}_0(t)\\}^{\\exp\\{-1.412+1.342\\}}\\)。这些生存函数估计如图 3.6 所示，它清楚地表明 70 岁以上的患者的预后比其他两个年龄组的患者更差。 图 3.6 3.11 风险调整的生存函数 一旦拟合了 Cox 回归模型，就可以获得每个个体的生存函数估计。接下来可能会关注拟合的生存函数与未经调整的 Kaplan-Meier 估计的生存函数有何差异。这样就可以确定风险调整的影响。为此，通过在每个事件时间点上对个体生存函数估计进行平均来获得风险调整的生存函数 (risk-adjusted survival function). 正式地说，假设 Cox 回归模型拟合了 \\(n\\) 个个体的生存数据，其中第 \\(i(i=1,2,\\ldots,n)\\) 个个体在时间 \\(t\\) 的死亡风险为 \\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)h_0(t)\\end{aligned}\\] 其中 \\(\\boldsymbol\\beta&#39;\\boldsymbol{x}_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\)。\\(x_{1i},x_{2i},\\ldots,x_{pi}\\) 为每个个体的 \\(p\\) 个解释变量的值，\\(h_0(t)\\) 为基线风险函数。第 \\(i\\) 个个体相应的生存函数为 \\[S_i(t)=\\{S_0(t)\\}^{\\exp(\\boldsymbol{\\beta&#39;x_i})}\\] 模型拟合过程会得出 \\(p\\) 个 \\(\\beta\\) 参数 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 以及基线生存函数 \\(\\hat{S}_0(t)\\) 的估计。然后，在给定时间 \\(t\\) 处的平均生存函数 (average survivor function) 为 \\[\\begin{equation} \\hat{S}(t)=\\frac{1}{n}\\sum_{i=1}^n\\hat{S}_i(t) \\tag{3.32} \\end{equation}\\] 其中 \\[\\hat{S_i}(t)=\\left\\{\\hat{S_0}(t)\\right\\}^{\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol x_i)}\\] 为第 \\(i\\) 个个体的生存函数估计。那么可以根据 \\(\\hat{S_i}(t)\\) 获得生存率（生存时间分布中位数和其他百分位数）的风险调整估计。 示例 3.14 (多发性骨髓瘤患者的生存率) 在示例 3.5 中，发现包含解释变量 Hb 和 Bun 的 Cox 回归模型适合对示例 1.3 中介绍的多发性骨髓瘤患者生存时间数据进行建模。第 \\(i\\) 个患者 \\(i = 1, 2,..., 48\\) 的生存函数估计为 \\[\\hat{S_i}(t)=\\left\\{\\hat{S_0}(t)\\right\\}^{\\exp(\\hat{\\eta_i})}\\] 其中风险评分 \\(\\hat{\\eta}_{{i}}\\) 为 \\(\\hat{\\eta}_i=-0.134Hb_i+0.019Bun_i\\)。那么可以在数据集中的每个事件时间获取 48 名患者的生存函数估计。对每个事件时间的 48 名患者的估计进行平均，得出风险调整的生存函数。图 3.7 绘制了该函数以及生存函数未经调整的 Kaplan-Meier 估计。这两种生存函数估计非常接近，因此在本例中，风险调整过程对生存率或中位生存时间的估计几乎没有影响。 图 3.7 3.11.1 分组风险调整的生存函数 在许多情况下，对个体的某些特定组别进行风险调整以调整这些分组之间因解释变量值的不同而产生的差异，并估计调整的生存函数是有意义的。例如，考虑一项关于采用两种不同治疗方案的无病生存 (disease-free survival) 的研究。若这项研究是以随机对照试验的方式进行，那么很可能各治疗组之间解释变量的值会均衡分配。这时，可以使用未经调整的 Kaplan-Meier 方法对每个组别估计生存函数，辅以未经调整和经过调整的治疗效应的风险比，从而充分总结数据。然而，如果数据来源于观察性研究，在该研究中，解释变量的值在两个治疗组之间不一定均衡分布。在这种情况下，对两个组别未经调整的生存函数估计可能会产生误导。此时，在得出关于治疗效应的结论之前，需要先进行风险调整过程，以便考虑到两个组别内个体特征之间不均衡的情况。 如果可以假设治疗组之间的差异与时间无关，则可以将组别效应添加到生存模型中，并利用式 (3.32) 计算每个治疗组中个体的风险调整的生存函数。然而，在许多应用中，例如在第 ?? 章中要考虑的比较机构之间的生存率时，不能做出这种假设。此时，就需要将 Cox 回归模型扩展：每组具有不同的基线风险函数。 假设在一项比较 \\(g\\) 组个体生存率的研究中，已拟合了一个包含有意义的解释变量的 Cox 回归模型，但不包含组别效应。那么在第 \\(j(j=1,2,\\ldots,g)\\) 组中，第 \\(i(i=1,2,\\ldots,n_j)\\) 个个体在时间 \\(t\\) 处的死亡风险模型可表示为 \\[\\begin{aligned}h_{ij}(t)=\\exp(\\boldsymbol{\\beta&#39;x}_{ij})h_{0j}(t)\\end{aligned}\\] 其中 \\(\\boldsymbol{\\beta&#39;x_{ij}}=\\beta_1x_{1ij}+\\beta_2x_{2ij}+\\cdots+\\beta_px_{pij}\\)。\\(x_{1{i}j},x_{2{i}j},\\ldots,x_{{pi}j}\\) 为对每个个体测量的 \\(p\\) 个解释变量的值。\\(h_{0j}(t)\\) 是第 \\(j\\) 组的基线风险函数。在该模型中，\\(p\\) 个解释变量的系数，\\(\\beta_1,\\beta_2,\\ldots,\\beta_p\\) 在 \\(g\\) 个组中是恒定的，但每组的基线风险函数不同。这是一个分层 Cox 回归模型 (stratified Cox regression model)，其中 \\(g\\) 个组定义了单独的分层。这些模型将在第 ?? 章中进行更详细的讨论。 在拟合分层模型时，第 \\(j\\) 组中第 \\(i\\) 名患者的相应生存函数估计为 \\[\\hat{S}_{{i}{j}}(t)=\\left\\{\\hat{S}_{{0}{j}}(t)\\right\\}^{\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_{ij})}\\] 其中，\\(\\hat{S}_{0j}(t)\\) 是第 \\(j\\) 组中个体的基线生存函数估计。 如果假定各组对风险函数的效应呈比例关系，则将拟合一个公共基线风险，并在模型中包含组别效应。那么 \\(h_{0{j}}(t)\\) 被 \\(\\exp(g_j)h_0(t)\\) 代替，其中 \\(g_j\\) 是第 \\(j\\) 组的效应。一般来说，通过使用分层模型，允许组别效应随时间变化的限制较少。 在分层模型中，可以通过对各组别内的个体在每个事件时间点上的生存函数估计值进行平均，从而求得每个组别的风险调整的生存函数。因此，在时间 \\(t\\) 处的平均风险调整生存函数为 \\[\\hat{S}_j(t)=\\frac1{n_j}\\sum_{i=1}^{n_j}\\hat{S}_{ij}(t)\\] 这对应于第 \\(j\\) 组中的个体。 另一种方法是对每个组中个体的每个解释变量的值进行平均，然后使用这些值来估计特定于组的生存函数。令 \\({\\bar{\\boldsymbol{x}}}_j\\) 为第 \\(j\\) 组中个体的 \\(p\\) 个变量的平均值向量，则组 \\(j\\) 中“平均个体”的相应生存函数估计为 \\[\\tilde{S}_j(t)=\\left\\{\\hat{S}_{0j}(t)\\right\\}^{\\exp(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\bar{\\boldsymbol{x}}_j)}\\] 尽管这种方法被广泛应用，但它也受到了广泛的批评。对于分类变量而言，对其值进行平均并不恰当。例如，假设与糖尿病有无相关的某个变量有两个水平，分别编码为 1 和 0，且数据中有 10% 的个体患有糖尿病。将指示变量的平均值设为 0.1，在糖尿病状态以该值定义时，并不能得到生存函数有意义的解读。另外，即使对于连续型解释变量，在一个组别内部的解释变量平均值集合可能并不对应于真实组合的值，而且平均个体的生存函数可能与各个个体生存函数的模式大相径庭。 示例 3.15 (前列腺癌两种疗法的比较) 考虑示例 1.4 中关于两个治疗组 38 名前列腺癌患者生存时间的数据。在示例 3.6 中，发现解释变量 Size 和 Index 会影响死亡风险，因此现在拟合包含这两个变量的分层 Cox 回归模型。对于 \\(j = 1\\)（安慰剂）和 \\(2\\)（DES），第 \\(j\\) 个治疗组中第 \\(i\\) 个患者的生存函数估计为 \\[\\hat{S}_{{i}{j}}(t)=\\left\\{\\hat{S}_{0{j}}(t)\\right\\}^{\\exp(\\hat{\\eta}_{{i}{j}})}\\] 其中 \\[\\begin{aligned}\\hat{\\eta}_{ij}=0.0673Size_{ij}+0.6532Index_{ij}\\end{aligned}\\] \\(\\hat{S}_{0{j}}(t)\\) 是第 \\(j\\) 个治疗组的基线生存函数估计。对每组患者在每个事件时间的生存函数估计进行平均，得到风险调整的生存函数，如图 3.8 所示。该图还显示了每组生存函数未经调整的 Kaplan-Meier 估计。 图 3.8 该图显示了风险调整过程如何缩小治疗差异。当然，通过将 DES 组相对于安慰剂组的未调整的风险比 (0.14) 与根据肿瘤大小和 Gleason 指数调整的相应值 (0.33) 进行比较（这两个值见示例 3.12），也能看出这一点，但这种分析假设了两种疗法的风险成比例。 3.12 一致性，预测能力和解释的变异 已经提出了许多指标用于：度量生存时间和基于模型的预测之间的一致性、解释变量在多大程度上解释了生存数据中的变异。这些指标量化了拟合模型的预测能力。在本节中，我们将介绍其中一些最有用的指标。 3.12.1 一致性的度量 生存时间与预测的生存时间的排序之间的一致性 (agreement or concordance)，通过区分生存时间较长和较短的个体，总结了拟合的模型区分个体的能力。一致性度量值介于 0 和 1 之间，分别对应于完全不一致和完全一致。当模型没有预测能力时，一致性度量值约为 0.5；而具有合理预测能力的模型往往具有大于 0.7 的值。 Harrell, Lee and Mark (1996) 描述的 \\(c\\) 统计量是一种特殊的一致性度量。该统计量是对以下概率的估计：对于任何两个个体，生存时间较短者是死亡风险较大者。要计算此统计量，请考虑所有可能的这样的生存时间对 (pairs)：要么两个个体均已死亡，要么其一的生存时间小于另一个的删失生存时间。这样的对子不包括在内：两个个体的生存时间都删失，或者其一的生存时间大于另一个的删失生存时间。如果在两个个体均已死亡的对子中，基于模型的预测生存时间对于实际生存更久的个体而言更长，则称这两个个体是一致的 (concordant). 在比例风险模型中，预测生存时间最长的个体将会是：在给定时间下死亡风险较低、在给定时间下生存函数估计较高，或风险评分较低的个体。对于其一死亡且另一人的生存时间在其之后删失的对子，具有删失时间的个体生存时间超过了另一名成员，因此可以确定这种配对的两个成员是否一致。\\(c\\) 统计量是通过将一致的配对数除以所考虑的所有可能的配对数来获得的。 对于只有一名个体死亡且另一名个体的删失生存时间大于此死亡时间的对子，具有删失生存时间的个体比另一名个体生存时间更长，因此可以判断这样的对子中的两名成员是否一致。通过将一致的对子数除以所有可能的对子数，可以得到 \\(c\\) 统计量。 由于两名个体都删失或其中一名个体的删失生存时间小于另一名个体死亡时间的对子不会对 \\(c\\) 统计量做出贡献，因此 \\(c\\) 统计量会受到删失模式的影响。Gönen and Heller (2005) 提出了一个统计量克服了这一重大缺陷。他们对一致性的度量是在任何两个人中，其一的生存时间超过另一人生存时间的概率的估计，条件是生存时间较长的个体的风险评分较低。 为了获得该统计量，令 \\(\\hat{\\eta}_i=\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 为第 \\(i\\) 个个体的风险评分。如果风险评分较低的个体具有较长的生存时间，则一对生存时间 \\((T_i,T_j)\\) 是一致的。则一致性概率为 \\(K=\\mathrm{P}(T_i&gt;T_j\\mid\\eta_i\\leqslant\\eta_j)\\)，并且该一致性概率的估计值 \\(\\hat K\\) 是模型预测值的 Gönen and Heller 度量。该估计由下式给出 \\[\\hat{K}=\\frac{2}{n(n-1)}\\mathop{\\sum\\sum}\\limits_{i &lt; j}\\left\\{\\frac{I\\{(\\hat{\\eta}_j-\\hat{\\eta}_i)&lt;0\\}}{1+\\exp(\\hat{\\eta}_j-\\hat{\\eta}_i)}+\\frac{I\\{(\\hat{\\eta}_i-\\hat{\\eta}_j)&lt;0\\}}{1+\\exp(\\hat{\\eta}_i-\\hat{\\eta}_j)}\\right\\} \\] 其中指示函数 \\(I(\\cdot)\\) 满足：若 \\(X &lt; 0\\)，则 \\(I\\{X &lt; 0\\} = 1\\)，否则为 0. 另外，还可以得到 \\(\\hat K\\) 的标准误，从而评估 \\(\\hat K\\) 的精度，这里不再赘述。 3.12.2 预测能力 评估模型根据风险评分值对个体或群体进行区分的能力的一个度量指标是 Royston and Sauerbrei (2004) 提出的 \\(D\\) 统计量。该统计量还总结了模型的预测能力，并且与风险评分的方差紧密相关。 为了得到该统计量，首先按照从小到大的顺序排列根据 Cox 回归模型得到的风险评分值 \\(\\hat{\\eta_i}=\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\)，如此一来，第 \\(i\\) 个有序值便是 \\(\\hat{\\eta}_{(i)}=\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_{(i)}\\)，其中 \\(\\hat{\\eta}_{(1)}&lt;\\hat{\\eta}_{(2)}&lt;\\cdots&lt;\\hat{\\eta}_{(n)}\\)。然后，将这些有序值中的第 \\(i\\) 个值与量 \\(z_{(i)}\\) 关联起来，该量是对样本量为 \\(n\\) 的观测值在标准正态分布中第 \\(i\\) 个顺序统计量期望的一种近似。该量通常称为正态得分 (normal score)，使用最广泛的得分公式为 \\(z_{(i)}=\\Phi^{-1}\\{(i-3/8)/(n+1/4)\\}\\)，其中 \\(\\Phi^{-1}(\\cdot)\\) 是标准正态分布函数的逆。然后，一个包含由标准化正态得分 \\(z_{(i)}/√(8/π)\\) 形成的变量的 Cox 回归模型用于拟合生存数据。所得该变量的系数估计就是 \\(D\\) 统计量，同时拟合模型还会给出 \\(D\\) 的标准误。 3.12.3 Cox 回归模型解释的变异 在线性回归分析中，解释变量所占的响应变量变异的比例广泛用于总结模型的解释能力。该统计量通常用 \\(R^2\\) 表示。对于具有 \\(p\\) 个解释变量的一般线性模型 (general linear model)，响应变量 \\(Y\\) 的第 \\(i(i=1,2,\\ldots,n)\\) 个值为 \\[\\begin{equation} y_i=\\beta_0+\\beta_1x_{1i}+\\cdots+\\beta_px_{pi}+\\epsilon_i \\tag{3.33} \\end{equation}\\] 其中 \\(\\beta_0\\) 为常数，\\(\\beta_1,\\beta_2,\\ldots,\\beta_p\\)为 \\(p\\) 个解释变量 \\(x_{ji},j=1,2,\\ldots,p\\) 的系数，以及 \\(\\epsilon\\) 为残差或误差项。拟合该模型时，\\(R^2\\) 统计量定义为 \\[\\begin{aligned}R^2&amp;=\\frac{\\text{模型平方和}}{\\text{总平方和}} = \\frac{\\text{模型平方和}}{\\text{模型平方和}+\\text{残差平方和}}\\end{aligned}\\] 在此方程中，由模型解释的响应变量的变异总结在模型平方和 (Model Sum of Squares, Model SS) \\(\\sum_{{i}}(\\hat{y}_i-\\bar{y})^2\\) 中，并表示为数据总变异的比例，后者由总平方和 (Total Sum of Squares, Total SS) \\(\\sum_{{i}}(y_{{i}}-\\bar{y})^2\\) 表示，其中 \\(\\bar{y}=n^{-1}\\sum_iy_i\\) 且 \\(\\hat y_i\\) 是第 \\(i\\) 个由下式给出的拟合值 \\[\\begin{equation} \\hat{y}_i=\\hat{\\beta}_0+\\hat{\\beta}_1x_{1i}+\\cdots+\\hat{\\beta}_px_{pi} \\tag{3.34} \\end{equation}\\] 总平方和可分解为模型平方和与残差平方和 \\(\\sum_{{i}}(y_{{i}}-\\hat{y_{i}})^{2}\\)，后者表示无法解释的变异。\\(R^2\\) 的值越大，模型所能解释的响应变量变异的比例就越大。 一般线性模型的 \\(R^2\\) 统计量也可表示为以下形式 \\[\\begin{equation} R^2=\\frac{\\hat{V}_M}{\\hat{V}_M+s^2} \\tag{3.35} \\end{equation}\\] 其中 \\(\\hat{V}_M=\\text{模型平方和}/(n-1)\\) 为由模型解释的数据变异的估计，是式 (3.34) 中 \\(n\\) 个拟合值 \\(\\hat y_i\\) 的样本方差。此外，\\(s^2\\) 是残差变异的估计，其中 \\(s^2 = 残差平方和/(n − 1)\\)，而不是除数为 \\(n − p − 1\\) 的通常的无偏估计。量 \\(\\hat{V}_{M}\\) 也可用矩阵形式表示为 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{S}\\hat{\\boldsymbol{\\beta}}\\)，其中 \\(\\hat{\\boldsymbol{\\beta}}\\) 是拟合的回归模型中 \\(p\\) 个解释变量的系数估计向量，\\(\\boldsymbol S\\) 是解释变量的方差-协方差阵。\\(p\\) 个解释变量的样本方差 \\((n-1)^{-1}\\sum_i(x_{ij}-\\bar{x}_j)^2\\) 组成了该矩阵的对角元，其样本协方差 \\((n-1)^{-1}\\sum_i(x_{ij}-\\bar{x}_j)(x_{ij&#39;}-\\bar{x}_{j&#39;})\\) 组成了该矩阵的非对角元，其中 \\(i=1,2,\\ldots,n\\)，\\(j,j^\\prime=1,2,\\ldots,p,j\\ne j^\\prime\\) 且 \\(\\bar x_j\\) 为第 \\(j\\) 个变量的样本均值。 在生存数据的分析中，已经提出了大量的度量方法，用以衡量由 Cox 回归模型解释的数据变异的比例。然而，基于大量模拟研究的综述表明，有三种特定的统计量具有理想的性质。它们的取值都在 0 到 1 之间，在很大程度上与删失的程度无关，并且不受生存数据尺度的影响，随着解释变量数量的增加，它们的值也会增加。这些将在下一节描述。 3.12.4 解释的变异的度量 考虑用于第 \\(i\\) 个个体在时间 \\(t\\) 的死亡风险的 Cox 回归模型 \\(h_i(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)h_0(t)\\)，其中 \\(x_i\\) 是 \\(p\\) 个解释变量的值向量，\\(\\boldsymbol\\beta\\) 是其未知系数的向量，\\(h_0(t)\\) 是基线风险函数。Kent and O’Quigley (1988) 提出了关于 \\(R^2\\) 型统计量的最早建议之一，在形式上与式 (3.35) 中用于线性回归分析的 \\(R^2\\) 统计量相似。此统计量定义为 \\[\\begin{equation} R_P^2=\\frac{\\hat V_P}{\\hat V_P+\\pi^2/6} \\tag{3.36} \\end{equation}\\] 其中 \\(\\hat{V}_P=\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{S}\\hat{\\boldsymbol{\\beta}}\\) 为风险评分 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 在 \\(n\\) 个个体间的变异的估计。\\(\\hat{\\boldsymbol{\\beta}}\\) 为拟合的 Cox 回归模型的参数估计向量，\\(\\boldsymbol{S}\\) 为解释变量的方差-协方差阵。量 \\(\\hat{V}_P\\) 最简便的计算方法是根据拟合的 Cox 回归模型中得到的 \\(n\\) 个风险评分的样本方差。将 \\(π^2/6\\) 包含在式 (3.36) 中以代替式 (3.35) 中的 \\(s^2\\) 的原因将在后面的第 5 章 5.14 节中解释。 Royston and Sauerbrei (2004) 提出的 \\(R^2_D\\) 统计量也是基于对个体间风险评分变异的估计，并与他们的 \\(D\\) 统计量密切相关，后者是第 3.12.2 节中定义的预测能力的度量。为了获得这一统计量，对 \\(D\\) 值进行缩放得到 \\(D_0=D/\\sqrt{(8/\\pi)}\\)。由 Cox 回归模型解释的变异的 \\(R^2_D\\) 度量为 \\[\\begin{equation} R_D^2=\\frac{D_0^2}{D_0^2+\\pi^2/6} \\tag{3.37} \\end{equation}\\] 这形似 \\(R_P^2\\) 统计量。事实上，\\(D^2_0\\) 也可视为风险评分值之间变异的估计。如果要直接获得 \\(R^2_D\\)，则可以在 Cox 回归模型中使用 3.12.2 节中的未缩放的正态分数 \\(z_{(i)}\\)，所得回归系数即为式 (3.37) 中的 \\(D_0\\)。 Kent and O’Quigley (1988) 提出的另一个统计量基于感兴趣的模型与无解释变量的模型之间的“距离”。后一个模型称为零模型，因此每个个体的风险函数只是基线风险 \\(h_{0}(t)\\)。该统计量为 \\[\\begin{aligned}R_W^2=1-\\exp(-\\tilde{W})\\end{aligned}\\] 其中距离的度量 \\(\\tilde W\\) 是似然比统计量期望值的估计，该期望值定义为 \\(W=-2\\mathrm{E}\\,\\{\\log L(0)-\\log L(\\hat{\\boldsymbol{\\beta}})\\}\\)，用于比较拟合模型的最大对数似然 \\(\\operatorname{log}L(\\hat{\\boldsymbol{\\beta}})\\) 与零模型的最大对数似然 \\(\\log L(0)\\)。\\(\\tilde W\\) 由下式给出 \\[\\begin{aligned}\\tilde{W}&amp;=2\\left[(1-\\tilde{\\omega})\\Psi(1)+\\log\\Gamma(\\tilde{\\omega})+\\log\\left\\{n^{-1}\\sum_{i=1}^n\\exp(-\\tilde{\\omega}z_i)\\right\\}\\right]\\end{aligned}\\] 其中 \\(z_i=\\hat{\\boldsymbol{\\beta}}^{\\prime}(\\boldsymbol{x}_i-\\boldsymbol{\\bar{x}})\\)，\\(\\hat{\\boldsymbol{\\beta}}\\) 为拟合的 Cox 回归模型中的参数估计向量，\\(\\bar {\\boldsymbol x}\\) 是 \\(p\\) 个解释变量的平均值向量，\\(\\Gamma(\\tilde{\\omega})=\\int_0^\\infty u^{\\tilde{\\omega}-1}e^{-u}\\mathrm{d}u\\) 为 gamma 函数。此外，\\(\\tilde \\omega\\) 是满足如下非线性方程的 \\(\\omega\\) 的值 \\[\\begin{aligned}\\Psi(1)-\\Psi(\\omega)+\\sum_{i=1}^n\\frac{\\exp(-\\omega z_i)}{\\sum_{l=1}^n\\exp(-\\omega z_l)}z_i&amp;=0\\end{aligned}\\] 其中 \\(\\Psi(\\omega)\\) 为 digamma 函数，定义为如下的级数展开 \\[\\begin{aligned}\\Psi(\\omega)&amp;=-\\lambda+\\sum_{j=0}^\\infty\\frac{\\omega-1}{(1+j)(\\omega+j)}\\end{aligned}\\] 使得 \\(\\Psi(1)=-\\lambda\\)，其中 \\(\\lambda=0.577216\\) 为欧拉常数。这是一个计算起来非常复杂的统计量，但由于它表现良好，因此被包括在这里，并且可以使用几个用于生存分析的软件包来获得。 3.12.5 模型验证 3.12.1 节至 3.12.4 节所描述的方法总结了 Cox 回归模型的预测能力，以及拟合模型对一组生存数据变异的解释程度。然而，如果同一组数据既用于构建模型又用于验证模型，那么这些方法可能会导致对模型能力过于乐观的评估。因此，最佳的做法是使用未参与建模过程的数据来确定预测能力和解释变异的指标。如果有来自其他地区或国家的独立数据集可用，则应将这些数据用于验证过程。这一过程称为外部验证 (external validation). 在许多情况下，外部验证是不可能的。那么可以使用基于将数据随机划分为建模数据集和验证数据集的数据分割程序。首先根据建模数据集确定模型，并使用剩余数据进行验证，此为内部验证 (internal validation). 根据数据集的大小，最多可以留出 50% 的数据用于验证，但对于较小的数据集，这一比例可能在 20% 至 40% 之间。无论如何，验证数据集应包含足够数量的事件，一般建议至少需要 100 个事件。 示例 3.16 (多发性骨髓瘤患者的生存率) 在本示例中，将对示例 1.3 中所示的多发性骨髓瘤患者生存时间数据的预测能力和解释的变异的各种度量进行比较。在示例 3.5 中，最令人满意的 Cox 回归模型包含解释变量 Hb（血清血红蛋白）和 Bun（血尿素氮）。 对于模型和数据之间的一致性，用 \\(c\\) 统计量总结，选定模型为 0.67 (se = 0.053)，全模型为 0.71 (se = 0.048). 关于 Gönen and Heller 的一致性度量，对于所选模型为 0.67 (se = 0.041)，对于全模型为 0.68 (se = 0.040). 在这个例子中，由于只有相对较少的删失，大部分生存时间对可用于 \\(c\\) 统计量的计算，因此两个模型区分能力 (discriminatory power) 的度量非常接近。同时，所选模型和全模型在这两种统计量上的数值差异也非常小，进一步证实了所选模型的预测能力与全模型相当。然而，Gönen and Heller 统计量的值为 0.67，表明该模型在区分本研究中个体的生存时间方面并不是特别好。 拟合模型的 \\(D\\) 统计量为 1.008 (se = 0.351). 该统计量的值约为其标准误的三倍，表明拟合模型实现了一定的预后分离。全模型该统计量值仅稍大一些，为 1.236 (se = 0.346)，这表明额外变量对提高模型质量几乎没有作用。 现在转向解释的变异的度量，表 3.20 中显示了包含 Hb 和 Bun 的选定模型以及包含 Age, Sex, Bun, Ca, Hb, Pcells 和 Protein 的全模型的各种统计量。 表 3.20 针对这两种模型，三个不同解释的变异的度量大体上具有相似的值。基于这些统计量，我们得出结论：大约 30% 的生存时间变异可由血清血红蛋白和血液尿素氮水平解释。相应地，模型未能解释的变异比例约为 70%，这表明模型还有很大的改进空间。例如，可能需要测量并纳入更多的解释变量以改进模型。 3.13 时依 ROC 曲线 3.12.1 节中描述的一致性度量提供了对拟合模型中生存时间与风险评分之间关联的总体评估。然而，模型对短期生存的预测能力不一定与长期生存的预测能力相同，因此需要时依度量 (time-dependent measures). 受试者工作特征 (Receiver operating characteristic, ROC) 曲线广泛用于总结拟合的 logistic 回归模型中的预测准确性。因此，本节首先简要总结它们在这种情况下的使用，然后再开发可用于生存数据的时依版本。 3.13.1 灵敏度和特异度 在利用诊断程序结果区分患某种疾病的人群与未患病人群时，可能出现两种类型的错误。首先，检测程序可能导致实际患病的人被误判为未患病。其次，未患病的人可能被误判为患病。对于临床准确 (clinically accurate) 的诊断测试程序，这两种错误发生的概率将会很小。正确识别出患病个体的概率称为测试的灵敏度 (sensitivity)，而正确识别出未患病个体的概率称为特异度(specificity). 灵敏度有时也称为真阳性率 (true positive rate)，而 (1 - 特异度)，即未患病个体被误判为患病的概率，称为假阳性率 (false positive rate). 这些概念通过以下示例加以阐明。 示例 3.17 (侧流装置检测 COVID-19 的性能) 本示例使用用于识别 COVID-19 感染的 Innova 侧流装置 (lateral flow device, LFD) 的性能数据。这些数据来自 Wolf, Hulmes and Hopkins (2021) 报告的一项上市后监测研究，该研究由 Public Health England 和 Oxford University 在 2020 年 11 月至 2021 年 1 月期间进行。共有 8223 名个体根据他们在逆转录聚合酶链反应 (RT-PCR) 测试（这是诊断 COVID-19 的最优测试或“金标准”测试）中是否获得阳性结果进行分类，还根据使用 LFD 的测试（更快、更便宜）是否给出阳性结果对这些人进行了分类，总结数据显示在表 3.21 中。 表 3.21 根据该表，LFD 测试的灵敏度为 339/677，即 50.1%。特异度为 7525/7546，即 99.7%，假阳性率为 0.3%，极低。根据这些总结数据，LFD 设备在正确识别 COVID-19 感染方面的效率仅为约 50%，但在识别某人是否无病方面的效率接近 100%。 3.13.2 疾病概率建模 个体是否患有某种特定疾病或症状，或者在未来患该疾病的风险，通常可以通过使用生物标志物 (biological marker or biomarker) 来评估疾病的存在或进展。许多生物标志物广泛应用于筛查或诊断程序的一部分被，例如血清胆红素水平作为肝脏疾病的指标、前列腺特异性抗原 (prostate-specific antigen, PSA) 水平用于前列腺癌筛查、血糖水平作为糖尿病的标志物。这些生物标志物可以精确测量，并且是在连续测量尺度上的观察值，其中更高的生物标志物值表明存在疾病的可能性更大。诊断测试的结果基于标志物值是否超过阈值，若超过，则将个体归类为患有该疾病。 当生物标志物用作诊断辅助时，可以使用线性 logistic 模型总结疾病概率对生物标志物值的依赖性。在此过程中，响应变量是二元的，表示个体是否患有相关疾病，如果个体没有疾病，则记录值为 0，否则记录为 1. 将 \\(n\\) 个个体中的第 \\(i\\) 个个体的疾病概率写作 \\(p_i\\)，\\(p_i\\) 的线性 logistic 模型为 \\[\\begin{equation} \\text{logit }(p_i)=\\log\\left(\\frac{p_i}{1-p_i}\\right)=\\beta_0+\\beta_1x_i \\tag{3.38} \\end{equation}\\] 其中 \\(x_i\\) 是第 \\(i\\) 个个体的生物标志物的值。为二元响应变量拟合该模型会得到模型的参数估计 \\(\\hat{\\beta}_0,\\hat{\\beta}_1\\)。那么，基于模型的对第 \\(i\\) 个个体患有该疾病的概率的 logisic 变换估计为 \\(\\hat{\\beta}_0+\\hat{\\beta}_1x_i\\)，并且第 \\(i\\) 个个体患病的相应概率估计 \\(\\hat p_i\\) 由下式给出 \\[\\begin{aligned}\\hat{p}_i=\\frac{\\exp(\\hat{\\beta}_0+\\hat{\\beta}_1x_i)}{1+\\exp(\\hat{\\beta}_0+\\hat{\\beta}_1x_i)}\\end{aligned}\\] 对于具有不同 \\(x_i\\) 值的患病和无病个体，这些疾病概率估计会有所不同。对于基于二元疾病标志物的诊断测试，例如示例 3.18 中侧流测试的结果，式 (3.38) 中的 \\(x_i\\) 值将为 0 或 1，分别对应于阴性或阳性侧流测试结果。那么，拟合的概率将等于具有阳性测试结果的患病和无病个体的比例，从而直接估计测试的灵敏度和特异度。 当使用如血清胆红素水平这样的具有连续值的生物标志物时，需要设定一个阈值 \\(x_i\\)，以便根据测试结果判断个体是否患病。在诊断测试中选用的阈值应参考该生物标志物在不同阈值下的灵敏度和特异度。理想测试的阈值将使灵敏度和特异度值都很低，但实践中往往需要在这两者之间做出一定的权衡。例如，在类似于示例 3.18 的情况下，如果不误诊患病的人是非常重要的，可能就需要牺牲一定的特异度来换取较高的灵敏度。 疾病风险的度量可以基于个体的特征，而不是使用单一的生物标志物。其中包括人口统计学变量，如年龄和性别、健康的临床指标和生物标志物。然后将其他解释变量包含在式 (3.38) 中的模型中。模型的线性部分变为 \\(\\boldsymbol{\\beta&#39;x}_i=\\beta_0+\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_kx_{ki}\\)，其中 \\(x_{1i},x_{2i},\\ldots,x_{ki}\\) 是 \\(k\\) 个变量的值，包括任何生物标志物。拟合模型 \\(\\log\\{p_i/(1-p_i)\\}=\\boldsymbol{\\beta&#39;x}_i\\) 得到对第 \\(i\\) 个个体的疾病概率的估计 \\(\\hat p_i\\) 和他们风险评分的估计 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\)。同样，为了确定个体是否患有某种疾病，也需要设定疾病概率或风险评分的阈值。随后，可以根据生物标志物值或风险评分在各阈值处的估计，来评估基于这些值的诊断程序的灵敏度和特异度。 3.13.3 ROC 曲线 一旦针对一系列阈值估计了生物标志物或风险评分的灵敏度和特异度，绘制灵敏度与 (1 - 特异度) 在不同的阈值处的图形就形成了一个有用的图形总结。这就是所谓的受试者工作特征曲线 (Receiver Operating Characteristic Curve) 或 ROC 曲线，这个名字最初由二战期间的无线电工程师创造。ROC 曲线总结了诊断测试、生物标志物或风险评分区分患病个体与非患病个体的能力。当比较不同的阈值时，该曲线对于展示灵敏度和特异度之间的权衡特别有用。 最优阈值应具有 100% 的灵敏度和特异度，这对应于完美的真阳性率和假阳性率，在 ROC 曲线上表现为左上角的一个点。相反，若灵敏度与 (1 - 特异度) 之间呈现直线关系，则表明该测试具有相等的真阳性率和假阳性率，即不具备预测能力。图 3.9 展示了几个理想化的 ROC 曲线。 图 3.9 在该图中，直线代表一个不具备区分能力的模型。这条线上方的曲线是可能的生物标志物或风险评分的 ROC 曲线，其区分患有和不患有疾病个体的能力越来越强。 一个用于 ROC 曲线的整体总结指标是曲线下的面积 (area under the curve, AUC)，它可以用来比较不同模型对疾病概率的预测能力。ROC 曲线下的面积衡量的是二元响应变量与基于模型拟合概率之间的符合程度。AUC值越大，说明测试在区分患者与非患者方面的效果越好。AUC 值始终介于 0 到 1 之间，两个极值对应于预测总是错误或正确的模型。值 0.5 对应于没有区分能力的模型。 ROC 曲线提供了一种公认的方法，用于总结模型在依赖生物标志物或风险评分值来预测个体患病概率方面的预测能力。然而，如今 ROC 曲线的应用远远超出了诊断测试范畴，因为它们提供了一种方便的方式来总结二元响应变量观测值与拟合值之间的一致性。 3.13.4 时依 ROC 曲线 生物标志物区分可能发展出特定疾病的个体和不会发展出这种疾病的个体的能力，是一个重要的考虑因素。在结局是事件发生时间的情况下，例如特定疾病的发生或死亡，诊断测试的灵敏度和特异度可能会在个体接受随访的时间段内发生变化。那么 ROC 曲线是时依的 (time-dependent)，需要在随访期的特定时间进行估计。还必须考虑到疾病发生或死亡等事件的时间删失的可能性。 时依结局的灵敏度和特异度的估计可以通过以下方式获得。令 \\(T\\) 为与事件发生时间（例如疾病或死亡的发生）相关的变量，令 \\(D(t)\\) 为个体在时间 \\(t\\) 时的状态，其中如果 \\(T &lt;t\\) 则 \\(D(t) = 0\\)，如果 \\(T \\ge t\\)，则 \\(D(t) = 1\\)。将变量 \\(D(t)\\) 称为疾病状态，其中 \\(D(t) = 0\\) 表示在时间 \\(t\\) 时无病的个体。然而，\\(D(t)\\) 也可以表示一个人是否已经发展出某种特征，或者在时间 \\(t\\) 是生或死。 与生物标志物或风险评分相关的变量由 \\(X\\) 表示，其中较大的 \\(X\\) 值更能指示疾病的存在。用 \\(c\\) 值作为生物标志物或风险评分的阈值，诊断测试在时间 \\(t\\) 的灵敏度是在时间 \\(t\\) 时对于患有疾病的个体，\\(X&gt;c\\) 的概率，即 \\[\\begin{aligned}\\text{sens}(t,c)=\\text{P}(X&gt;c\\mid D(t)=1)\\end{aligned}\\] 类似地，灵敏度为 \\[\\begin{aligned}\\operatorname{spec}(t,c)&amp;=\\operatorname{P}(X\\leqslant c\\mid D(t)=0)\\end{aligned}\\] 这两个概率可以使用条件概率的结论来计算，根据条件概率，以事件 \\(B\\) 为条件，事件 \\(A\\) 的概率为 \\[\\begin{equation} \\mathrm{P}(A\\mid B)=\\frac{\\mathrm{P}(B\\mid A)\\mathrm{P}(A)}{\\mathrm{P}(B)} \\tag{3.39} \\end{equation}\\] 这个结果称为贝叶斯定理 (Bayes’ theorem)，它是 ?? 章中描述的生存数据分析的贝叶斯方法（在该章的 ?? 节中推导）的基础。利用式 (3.39)，可以写出诊断程序的灵敏度 \\[\\begin{aligned}\\mathrm{P}(X&gt;c\\mid D(t)=1)&amp;=\\frac{\\mathrm{P}(D(t)=1\\mid X&gt;c)\\mathrm{P}(X&gt;c)}{\\mathrm{P}(D(t)=1)}\\end{aligned}\\] 概率 \\(\\mathrm{P}(D(t)=1|X&gt;c)\\) 和 \\(\\mathrm{P}(D(t)=1)\\) 可以从关于 \\(T\\) 的生存函数 \\(S(t)=\\operatorname{P}(T\\geqslant t)\\) 中获得。那么灵敏度就是 \\[\\begin{equation} \\frac{\\{1-S(t\\mid X&gt;c)\\}\\text{P}(X&gt;c)}{1-S(t)} \\tag{3.40} \\end{equation}\\] 其中 \\(S(t\\mid X&gt;c)\\) 是那些 \\(X&gt;c\\) 的个体的生存函数。同理，特异度为 \\[\\begin{equation} \\frac{S(t\\mid X\\leqslant c)\\text{P}(X\\leqslant c)}{S(t)} \\tag{3.41} \\end{equation}\\] 灵敏度和特异度可以使用生存函数的 Kaplan-Meier 估计 \\(\\hat S(t)\\) 来估计，该生存函数是根据这些个体可能删失的事件时间以及其中 \\(X&gt;c\\) 或 \\(X\\le c\\) 的子集来获得的。此外，\\(\\mathrm{P}(X\\leqslant c)\\) 可以根据标志物值小于等于 \\(c\\) 的个体比例 \\(\\hat{p}_X(c)\\) 进行估计，\\(P(X&gt;c)\\) 则是通过 \\(1−\\hat{p}_X(c)\\) 来估计的。所得灵敏度和特异度的估计为 \\[\\begin{align} &amp;\\widehat{\\text{sens}}(t,c)=\\frac{\\{1-\\hat{S}(t\\mid X&gt;c)\\}\\{1-\\hat{p}_X(c)\\}}{1-\\hat{S}(t)} \\tag{3.42}\\\\ &amp;\\widehat{\\text{spec}}(t,c)=\\frac{\\hat{S}(t\\mid X\\leqslant c)\\hat{p}_X(c)}{\\hat{S}(t)} \\tag{3.43} \\end{align}\\] 这些估计现在可用于构建选定疾病或死亡时间值的时依 ROC 曲线。 时依 ROC 曲线下的面积提供了模型在给定时间区分患病个体和无病个体总体能力的总结。该面积值越大，模型的预后性能越好。该统计量可用于识别模型预测能力最大化的时间点，并基于不同的生物标志物或风险评分的不同形式来比较模型。 示例 3.18 (前列腺癌两种疗法的比较) 对于第一章示例 1.3 中首次提到的关于诊断为多发性骨髓瘤患者生存时间的研究，第三章示例 3.5 发现有意义的解释变量为血清血红蛋白水平 (Hb) 和血尿素氮 (Bun). 风险评分将作为标志物变量 \\(X\\)，用于式 (3.42) 和 (3.43)，其中第 \\(i\\) 个个体的分数值为 \\(-0.1336~Hb_i+0.0186~Bun_i\\)。可以为 48 名患者计算该值，用作生物标志物变量 \\(X\\)。将评估标志物在 6 个月、12 个月、18 个月和 24 个月时的预测能力，将阈值 \\(c\\) 设为 48 个风险评分值。然后，针对这 48 名患者的集合，以及每个给定的阈值 \\(c\\) 下风险评分大于 \\(c\\) 或小于等于 \\(c\\) 的患者子集，确定其生存函数的 Kaplan-Meier 估计。随后，根据式 (3.42) 和 (3.43) 计算灵敏度和特异度估计，从而得出所选时间点的时依 ROC 曲线。这些曲线以及 灵敏度与 (1 - 特异度) 的等值线一起展示在图 3.10 中。 图 3.10 该图显示，风险评分的预测能力随时间推移而减弱，因为 ROC 曲线估计越来越接近“灵敏度 = (1 - 特异度)”的线。风险评分对诊断后 6 个月死亡的预测最佳。ROC 曲线下的面积证实了这一点：在 6 个月、12 个月、18 个月和 24 个月时分别为 0.793、0.730、0.686 和 0.600. 基于生存函数的 Kaplan-Meier 估计的时依 ROC 曲线存在两个问题。首先，通过式 (3.42) 和 (3.43) 估计出的灵敏度与 (1 - 特异度) 并不一定是标志物值的单调递减函数，这一点可以在图 3.10 中观察到。其次，对于 \\(X&gt;c\\) 条件下生存函数的 Kaplan-Meier 估计，假设了删失与 \\(X\\) 无关。如果患者随访的严格程度受到标志物值的影响，该假设可能就不成立了。因此，在实践中经常使用基于估计 \\(X\\) 和 \\(T\\) 的联合分布的替代程序。 令 \\(x_i\\) 表示生存时间为 \\(t_i\\) 的第 \\(i\\) 个个体的生物标志物值，并令 \\(\\delta_i\\) 为删失指标，使得如果 \\(t_i\\) 是事件时间，则 \\(\\delta_i=1\\)，否则为 \\(0\\). 联合概率 \\(S(t, c) = \\mathrm{P}(T &gt; t, X &gt; c)\\) 可估计为 \\[\\begin{aligned}\\hat{S}_\\omega(t,c)&amp;=n^{-1}\\sum_{i=1}^n\\hat{S}_\\omega(t\\mid X=x_i)I(x_i&gt;c)\\end{aligned}\\] 其中指示函数 \\(I(\\cdot)\\) 满足：如果 \\(x_i &gt; c\\)，则 \\(I(x_i &gt; c) = 1\\)，否则为 \\(0\\). \\(\\hat{S}_{{\\omega}}(t|X=x_{{i}})\\) 是条件生存函数的平滑估计，取决于平滑参数 \\(\\omega\\)。合适的平滑估计是加权 Kaplan-Meier 估计，其中 \\[\\begin{equation} \\hat{S}_\\omega(t\\mid X=x_i)=\\prod_s\\left\\{1-\\frac{\\sum_jK_\\omega(x_i,x_j)I(t_j=s)\\delta_j}{\\sum_jK_\\omega(x_i,x_j)I(t_j\\geqslant s)}\\right\\} \\tag{3.44} \\end{equation}\\] 该乘积是对所有小于等于 \\(t\\) 的唯一事件时间计算得到的。在此表达式中，\\(K_{\\boldsymbol{\\omega}}(x_{i},x_{j})\\) 是最近邻核平滑函数 (nearest-neighbour kernel smoothing function)，它给予相近的标志物变量值 \\(x_i,x_j\\) 更大的权重。该函数由下式给出 \\[\\left.K_\\omega(x_i,x_j)=\\left\\{\\begin{array}{ll}1&amp;\\text{ if }|\\hat{p}_X(x_i)-\\hat{p}_X(x_j)|&lt;\\omega,\\\\0&amp;\\text{ otherwise.}\\end{array}\\right.\\right.\\] 其中 \\(p_X(x)=\\text{P}(X\\leqslant x)\\)，\\(\\hat p_X(x)\\) 是其估计，因此，\\(\\hat p_X(x)\\) 是 \\(X\\) 值小于等于 \\(x_i\\) 的比例。此外，\\(0&lt;2\\omega&lt;1\\)，这意味着标志物值在近邻 (near neighbour) 中的比例为 \\(2\\omega\\)，其中 \\(\\omega\\) 必须小于 0.5. 事实上，为了确保估计 \\(\\hat{S}_{\\omega}(t,c)\\) 的一致性，\\(\\omega\\) 必须小于 \\(n^{-1/3}\\)。\\(\\omega\\) 的值越大，平滑度就越大，通常使用 0.05. 然后利用 \\(S(t\\mid X&gt;c)\\text{P}(X&gt;c)=S(t,c),S(t\\mid X\\leqslant c)\\text{P}(X\\leqslant c)=\\text{P}(T&gt;t,X\\leqslant c)\\) 以及 \\(\\text{P}(T&gt;t\\mid X\\leqslant c)=S(t)-S(t,c)\\) 这一结果，灵敏度和特异度可以根据式 (3.40) 和 (3.41) 得到，即 \\[\\begin{align} &amp;\\widehat{\\operatorname{sens}}(t,c)=\\frac{1-\\hat{p}_X(c)-\\hat{S}_\\omega(t,c)}{1-\\hat{S}_\\omega(t,-\\infty)}\\tag{3.45}\\\\ &amp;\\widehat{\\operatorname{spec}}(t,c)=1-\\frac{\\hat{S}_\\omega(t,c)}{\\hat{S}_\\omega(t,-\\infty)}\\tag{3.46} \\end{align}\\] 其中 \\(\\hat{S}_\\omega(t,-\\infty)=\\hat{S}_\\omega(t)=n^{-1}\\sum_i\\hat{S}_\\omega(t\\mid X=x_i)\\)。现在可以使用式 (3.45) 和 (3.46) 构建时依 ROC 曲线。 示例 3.19 (多发性骨髓瘤患者的生存率) 在示例 3.19 中，Kaplan-Meier 方法用于获得多发性骨髓瘤生存数据的时依 ROC 曲线。现在说明最近邻估计方法。使用由式 (3.44) 给出的生存函数的平滑加权 Kaplan-Meier 估计，取 \\(\\omega = 0.05\\)，所得的时依 ROC 曲线估计见图 3.11. 图 3.11 在该图中，灵敏度和 (1 - 特异度) 严格递增，但这些曲线与图 3.10 所示的曲线没有实质性差异。相应的曲线下面积为 0.753, 0.683, 0.690 和 0.609. 这些面积略小于图 3.10 中时依 ROC 曲线的面积，但风险评分仍然对 6 个月内死亡的预测是最佳的。 尽管时依 ROC 曲线的使用是在诊断测试背景下开发的，但它们提供了一种有用的方法来总结不同时间范围内事件时间与拟合模型之间的一致性。 3.14 比例风险建模和 log-rank 检验 Cox 回归模型可用于检验两组生存时间的风险函数之间无差异的原假设，如示例 3.3 所示。因此在这种情况下，这种建模方法为 log-rank 检验提供了一种替代方法。然而，这两个程序之间有着密切的联系，本节将对此进行更详细的探讨。 使用 2.6.2 节中使用的符号（总结于表 2.7 中），两个组将分别标记为 Group I 和 Group II. 两组在第 \\(j\\) 个有序死亡时间 \\(t_{(j)}, j = 1, 2,...,r\\) 处死亡的个体数量分别用 \\(d_{1j}\\) 和 \\(d_{2j}\\) 表示。类似地，在时间 \\(t_{(j)}\\) 时两组处于风险的个体数量，即在此时间之前存活且未删失的数量，分别表示为 \\(n_{1j}\\) 和 \\(n_{2j}\\)。 现在令 \\(X\\) 为一指示变量，当个体处于 Group I 时，该变量为 1；当个体处于 Group II 时，该变量为 0. 第 \\(i\\) 个个体的 Cox 回归模型可写为 \\[h_i(t)=e^{\\boldsymbol{\\beta}x_i}h_0(t)\\] 其中 \\(x_i\\) 是第 \\(i\\) 个个体的 \\(X\\) 值，\\(i＝1,2,\\ldots,n\\)。当不存在观测结时，即当 \\(d_j=d_{1j}+d_{2j}=1\\) 时，可以通过最大化式 (3.4) 中的似然函数来拟合该模型。以 \\(x_{(j)}\\) 表示死于 \\(t_{(j)}\\) 的个体的 \\(X\\) 值。由于在时间 \\(t_{(j)}\\) 的风险集 \\(R(t_{(j)})\\) 中有 \\(n_j＝n_{1j}+n_{2j}\\) 个个体，似然函数为 \\[\\begin{equation} L(\\beta)=\\prod_{j=1}^{r}\\frac{\\exp(\\beta x_{(j)})}{\\sum_{l=1}^{n_{j}}\\exp(\\beta x_{l})} \\tag{3.47} \\end{equation}\\] 相应的对数似然函数为 \\[\\begin{equation} \\log L(\\beta)=\\sum_{j=1}^r\\beta x_{(j)}-\\sum_{j=1}^r\\log\\left\\{\\sum_{l=1}^{n_j}\\exp(\\beta x_l)\\right\\} \\end{equation}\\] 由于 Group II 中的个体的 \\(x_{(j)}\\) 为 0，因此该表达式中的第一个求和运算是关于 Group I 的死亡时间进行的，因此简单地为 $d_{1}$，其中 \\(d_1=\\sum_{j=1}^rd_{1j}\\) 是 Group I 中的死亡总数。此外， \\[\\begin{aligned}\\sum_{l=1}^{n_j}\\exp(\\beta x_l)&amp;=n_{1j}e^\\beta+n_{2j}\\end{aligned}\\] 因此 \\[\\begin{equation} \\log L(\\beta)=d_1\\beta-\\sum_{j=1}^r\\log\\left\\{n_{1j}e^\\beta+n_{2j}\\right\\}\\tag{3.48} \\end{equation}\\] 可以通过针对 \\(\\beta\\) 最大化该表达式来找到 \\(\\beta\\) 的最大似然估计，这需要非线性优化算法。那么，声称 \\(\\beta=0\\) 的原假设可以通过比较 \\(-2\\log L(\\hat{\\beta})\\) 和 \\(-2\\log L(0)\\) 的值来检验。后者其实简单地为 \\(2\\sum_{j=1}^r\\log n_j\\)。 可以通过对声称 \\(\\beta=0\\) 的原假设进行得分检验 (score test) 来避免计算 \\(\\hat\\beta\\)。该检验程序在附录 A 中有概述，它基于检验统计量 \\(u^2(0)/i(0)\\)，其中 \\[\\begin{aligned}u(\\beta)&amp;=\\frac{\\partial\\log L(\\beta)}{\\partial\\beta}\\end{aligned}\\] 为有效得分，且 \\[\\begin{aligned}i(\\beta)=-\\frac{\\partial^2\\log L(\\beta)}{\\partial\\beta^2}\\end{aligned}\\] 是 Fisher（观测）信息函数。在 \\(\\beta = 0\\) 的原假设下，\\(u^2(0)/i(0)\\) 服从自由度为一的卡方分布。现在，根据式 (3.48)，有 \\[\\begin{aligned}\\frac{\\partial\\log L(\\beta)}{\\partial\\beta}=\\sum_{j=1}^r\\left(d_{1j}-\\frac{n_{1j}e^\\beta}{n_{1j}e^\\beta+n_{2j}}\\right)\\end{aligned}\\] 以及 \\[\\begin{gathered} \\begin{aligned}\\frac{\\partial^2\\log L(\\beta)}{\\partial\\beta^2}\\end{aligned} \\begin{aligned}=-\\sum_{j=1}^r\\frac{(n_{1j}e^\\beta+n_{2j})n_{1j}e^\\beta-(n_{1j}e^\\beta)^2}{(n_{1j}e^\\beta+n_{2j})^2}\\end{aligned} \\\\ =-\\sum_{j=1}^r\\frac{n_{1{j}}n_{2{j}}e^\\beta}{(n_{1{j}}e^\\beta+n_{2{j}})^2} \\end{gathered}\\] 因此，在 \\(\\beta = 0\\) 处计算的有效得分和信息函数为 \\[\\begin{aligned}u(0)=\\sum_{j=1}^r\\left(d_{1j}-\\frac{n_{1j}}{n_{1j}+n_{2j}}\\right)\\end{aligned}\\] 和 \\[\\begin{aligned}i(0)&amp;=\\sum_{j=1}^r\\frac{n_{1j}n_{2j}}{(n_{1j}+n_{2j})^2}\\end{aligned}\\] 这些恰好是第 2 章的式 (2.20) 和 (2.22) 中给出的 \\(U_L\\) 和 \\(V_L\\) 的表达式，适用于没有生存时间结的特殊情况，即，对于 \\(j=1,2,\\ldots,r\\) 有 \\(d_j = 1\\)。 当存在观测结时，式 (3.47) 中的似然函数需替换为能够处理结的函数。具体来说，如果使用式 (3.12) 中的似然函数，则有效得分函数和信息函数恰好是式 (2.20) 和 (2.22) 中给出的那些函数。因此，当存在生存时间结时，log-rank 检验对应于使用 Cox (1972) 提出的离散比例风险模型 (discrete proportional hazards model) 的得分检验。在实践中，比较两个模型（含与不含治疗效应项）的 \\(-2\\log\\hat{L}\\) 统计量所得的 \\(P\\) 值，与该得分检验给出的 \\(P\\) 值通常没有太大差异。这一点在讨论示例 3.3 时已注意到这一点。当然，使用 Cox 回归模型分析这类数据的一个优点是，它可以直接得到风险比的估计。 3.15 延伸阅读 Draper and Smith (1998) 以及 Montgomery, Peck and Vining (2021) 对线性回归分析中的统计建模进行了全面介绍。McCullagh and Nelder (1989) 在其关于广义线性模型百科全书式的综述中包含了关于生存数据模型的章节。 Cox (1972) 提出了生存数据的比例风险模型，其中未指定基线风险函数。该文引入了偏似然的概念，随后 Cox (1975) 对其进行了更详细的研究。另见 Kalbfleisch and Prentice (1972) 以及 Breslow (1972) 关于 Cox (1972) 的讨论所作的贡献。Therneau and Grambsch (2000) 对该模型及其扩展进行了详细的回顾。 Christensen (1987), Elashoff (1983) 和 Tibshirani (1982) 为医学研究人员介绍了 Cox 回归模型。较近的论述可见第 1 章 1.6 节引用的教科书。特别是，Hosmer, Lemeshow and May (2008) 对模型发展和基于模型的参数估计的解释进行了仔细的讨论。 Kalbfleisch and Prentice (2002) 以及 Lawless (2002) 对生存数据中的结进行了细致的处理；另见 Breslow (1972) 和 Peto (1972). 在 3.10 节中用 \\(\\hat S_0(t)\\) 表示的基线生存函数，其估计由 Kalbfleisch and Prentice (1973) 引入，在 Kalbfleich and Prentise (2002) 中也进行了描述。估计 \\(S_{0}^{*}(t)\\) 由 Breslow (1972, 1974) 提出，但它使用了不同于 3.10.2 节的论点。 有关线性回归分析的书籍中讨论了模型制定和模型选择策略。 Harrell (2015) 解决了模型构建中的许多实际问题，并使用大量涉及生存数据的案例研究说明了该过程。另请参见 Chatfield (1995) 的第 5 章以及 Cox and Snell (1981) 的第 4 章。 Miller (2002) 描述了一系列用于识别线性回归模型中合适的变量子集的程序。Akaike (1974) 提出了后来称为 Akaike 信息准则的概念。它广泛用于时间序列分析，并在有关该主题的书籍中进行了描述，例如 Chatfield 和 Xing (2019). Volinsky and Raftery (2000) 描述了 BIC 统计量在生存数据建模中的使用。 Nelder (1977) 以及 McCullagh and Nelder (1989) 的第 3 章充分讨论了层次原则。 Lasso 首先由 Tibshirani (1996) 提出，Tibshirani (1997) 展示了如何将该方法用于 Cox 模型中的变量选择。Goeman (2010) 描述了一种计算 lasso 估计的有效算法。该算法现已在 R 包 penalized 中实现，用于拟合惩罚 Cox 回归模型；参见 Goeman, Meijer 和 Chaturvedi (2022). Efron et al. (2004) 建立了 lasso 的分段线性性质，Yuan and Lin (2006) 引入了组 lasso 来处理分类变量。 Royston and Altman (1994) 描述了分数多项式在回归建模中的使用；另见 Sauerbrei and Royston (1999). Box and Tidwell (1962) 引入了在分数多项式背景下的 Box-Tidwell 变换。 Nieto and Coresh (1996) 回顾了调整的生存函数的计算方法，Zahl (1997) 在对该文的评论中概述了一些相关方法。Zhang et al. (2007) 也描述了该方法，他们给出了一个 SAS 宏来实现该方法。Neuberger et al. (1986) 使用基于解释变量平均值的方法来总结肝移植项目的观测数据，随后 Thomsen, Keiding and Altman (1991) 引用了该方法。 已经提出了相当多的解释的变异的度量，并有几篇综述对这些方法的性质进行了比较和对比。其中最为详尽的综述来自 Schemper and Stare (1996), Hielscher et al. (2010) 以及 Choodari-Oskooei, Royston and Parmar (2012) 的两篇连续论文。本章中描述的 \\(R^2\\) 度量是由 Kent and O’Quigley (1988) 以及 Royston and Sauerbrei (2004) 引入的。Royston (2006) 还描述了这些度量与其他解释的变异的度量之间的联系。Heinzl (2000) 给出了用于计算 Kent and O’Quigley 的 \\(R^2_W\\) 统计量的 SAS 宏。Harrell 的 \\(c\\) 统计量在 Harrell, Lee and Mark (1996) 中有所描述，而 Gönen and Heller (2005) 则介绍了一种更受欢迎的一致性度量。Stare, Perme and Henderson (2011) 提出的另一种解释的变异的度量可用于比例风险模型，其优势在于适用于后面章节中介绍的一些其他模型。该统计量基于解释观测值排序的变异，且可在 R 软件中计算。 Heagerty, Lumley and Pepe (2000) 是有关时依 ROC 曲线的关键论文，他们给出了 3.13 节中描述的两种估计该曲线的方法。 Akritas (1994) 提供了最近邻平滑方法。 Kamarudin, Cox and Kolamunnage-Dona (2017) 全面回顾了许多估计时依 ROC 曲线的方法。Collett (2003) 详细描述了 logistic 回归模型，评估诊断测试和时依预测能力的教程包括 Pepe, Leisenring and Rutter (1999) 以及 Pepe, Longton and Janes (2009). 本章未讨论的一个问题是如何处理解释变量的缺失值。基于完全条件规范 (fully conditional specification) 的多重插补 (multiple imputation) 法，也称为链式方程多重插补 (multiple imputation by chained equations)，是处理这一常见问题广泛使用的技术。多重插补过程涉及为每个具有缺失值的解释变量生成多组插补值。然后为待插补数据集拟合给定模型，将所得参数估计进行组合，以得到总体估计，其标准误考虑了插补值的不确定性。软件开发的进步意味着这种技术现在可以与常用的软件包结合使用，包括 SAS, Stata 和 R. White, Royston and Wood (2011) 的教程描述了该方法、其局限性和可能的危险，另附一个全面的参考列表。 "],["chap4.html", "第 4 章 Cox 回归模型的模型检查 4.1 Cox 回归模型的残差 4.2 模型拟合的评估 4.3 识别有影响的观测 4.4 检验比例风险假设 4.5 建议 4.6 延伸阅读", " 第 4 章 Cox 回归模型的模型检查 为一组观察到的生存数据拟合模型后，需要评估模型的充分性 (adequacy). 事实上，使用诊断程序进行模型检查是建模过程的重要组成部分。 在某些情况下，仔细检查观察到的数据集可能会识别出某些特征，例如生存时间异常长或短的个体。然而，对数据的目视检查可能不会很有启发，除非只有一两个解释变量。删失使情况变得更加复杂，因为即使在最简单的情况下，删失生存时间的出现也使得判断模型充分性的各个方面变得困难。因此，应通过诊断程序来补充数据的目视检查，以检测拟合模型的不足之处。 一旦模型被拟合，就需要研究拟合的许多方面。例如，模型必须包括研究中测量的一组适当的解释变量，我们需要检查是否使用了这些变量的正确函数形式。确定观察到的生存时间比预期的要长，或者其解释变量对特定风险比有不当影响的个体可能很重要。此外，可能需要一些方法来考察比例风险假设。 许多模型检查程序都是基于称为残差 (residuals) 的量。这些值可以为研究中的每个个体计算，其特征是，当拟合模型令人满意时，他们的表现是已知的，至少是近似的。已经提出了用于 Cox 回归模型的多种残差，本章从对其中一些残差的回顾开始。随后的章节将讨论残差在评估模型充分性特定方面的使用。 4.1 Cox 回归模型的残差 在本节中，我们将假设有 \\(n\\) 个个体的生存时间，其中有 \\(r\\) 个死亡时间，其余的 \\(n−r\\) 个是右删失的。我们进一步假设已为这些生存时间拟合了 Cox 回归模型，并且模型的线性部分包含 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\)。因此，第 \\(i\\) 个个体 \\(i = 1, 2,...,n\\) 的风险函数拟合为 \\[\\hat{h}_i(t)=\\exp(\\hat{\\boldsymbol{\\beta}}&#39;x_i)\\hat{h}_0(t)\\] 其中 \\(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i=\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi}\\) 为相应个体的风险评分值，\\(\\hat{h}_0(t)\\) 为基线风险函数估计。 4.1.1 Cox-Snell 残差 在生存数据分析中最广泛使用的残差是 Cox-Snell 残差，之所以这么称，是因为它是 Cox and Snell (1968) 给出的残差一般定义中的一个特例。 第 \\(i\\) 个个体的 Cox-Snell 残差，\\(i=1,2,\\ldots,n\\)，为 \\[\\begin{equation} r_{Ci}=\\exp(\\hat{\\boldsymbol{\\beta}}&#39;x_i)\\hat{H}_0(t_i) \\tag{4.1} \\end{equation}\\] 其中 \\(\\hat{H}_0(t_i)\\) 是基线累积风险函数在时间 \\(t_i\\) （观察到的该个体的生存时间） 处的估计。在实践中，通常使用式 (3.29) 中给出的 Nelson-Aalen 估计。请注意，根据式 (3.25)，Cox-Snell 残差 \\(r_{Ci}\\) 是 \\(\\hat{H}_{{i}}(t_{{i}})=-\\operatorname{log}\\hat{S}_{{i}}(t_{{i}})\\) 的值，其中 \\(\\hat{H}_{{i}}(t_{{i}})\\) 和 \\(\\hat{S}_{{i}}(t_{{i}})\\) 是第 \\(i\\) 个个体的累积风险函数和生存函数在 \\(t_i\\) 处的估计值。 该残差可以根据数理统计中关于随机变量函数分布的一般结果中导出。根据该结果，如果 \\(T\\) 是与个体生存时间相关的随机变量，\\(S{(t)}\\) 是相应的生存函数，无论 \\(S{(t)}\\) 的形式如何，随机变量 \\(Y = − \\log S{(T)}\\) 服从均值为一的指数分布。下一段概述了这一结果的证明，可以省略而不失阅读的连续性。 点我看证明 根据一般结果，若 \\(f_X(x)\\) 是随机变量 \\(X\\) 的概率密度函数，则随机变量 \\(Y=g(X)\\) 的密度由下式给出 \\[f_Y(y)=f_X\\{g^{-1}(y)\\}\\Big/\\left|\\frac{\\mathrm{d}y}{\\mathrm{d}x}\\right|\\] 其中 \\(f_X\\{g^{-1}(y)\\}\\) 为用 \\(y\\) 表示的 \\(X\\) 的密度。使用该结果，随机变量 \\(Y=-\\log S(T)\\) 的概率密度函数为 \\[\\begin{equation} f_Y(y)=f_T\\left\\{S^{-1}(e^{-y})\\right\\}\\Big/\\left|\\frac{\\mathrm{d}y}{\\mathrm{d}t}\\right| \\tag{4.2} \\end{equation}\\] 其中 \\(f_{T}(t)\\) 是 \\(T\\) 的概率密度函数。现在 \\[\\begin{aligned}\\frac{\\mathrm{d}y}{\\mathrm{d}t}&amp;=\\frac{\\mathrm{d}\\{-\\log S(t)\\}}{\\mathrm{d}t}=\\frac{f_T(t)}{S(t)}\\end{aligned}\\] 当该函数的绝对值用 \\(y\\) 表示时，导数变为 \\[\\frac{f_T\\left\\{S^{-1}(e^{-y})\\right\\}}{S\\left\\{S^{-1}(e^{-y})\\right\\}}=\\frac{f_T\\left\\{S^{-1}(e^{-y})\\right\\}}{e^{-y}}\\] 最后，代入式 (4.2) 中的导数，我们发现 \\[f_Y(y)=e^{-y}\\] 根据第 5 章的式 (5.3) ，这就是具有单位均值的指数随机变量 \\(Y\\) 的概率密度函数。 论证的下一个关键步骤如下。如果拟合观测数据的模型令人满意，则基于模型对第 \\(i\\) 个个体在 \\(t_i\\)（该个体的生存时间）处的生存函数估计将接近相应的真实值 \\(S_i(t_i)\\)。这表明，如果拟合了正确的模型，则值 \\(\\hat{S}_{{i}}(t_{{i}})\\) 将具有与 \\({S}_{{i}}(t_{{i}})\\) 类似的性质。那么，生存函数估计的对数的负数为 \\(-\\operatorname{log}\\hat{S_{i}}(t_{i}),i=1,2,\\ldots,n\\) 应表现为单位指数分布的 \\(n\\) 个观测。这些估计值是 Cox-Snell 残差。 如果个体生存时间是右删失的，则残差的相应值也是右删失。因此，残差将是单位指数分布的删失样本，对这一假设的检验提供了对模型充分性的检验，我们将在 4.2.1 节回到这一点。 Cox-Snell 残差 \\(r_{Ci}\\) 的性质与线性回归分析中使用的残差非常不同。具体来说，它们不关于零对称分布，并且它们不可能是负的。此外，由于 Cox-Snell 残差在拟合适当的模型时被假设为具有指数分布，因此它们的分布是高度偏斜的，并且第 \\(i\\) 个残差的均值和方差都为 1. 4.1.2 修正的 Cox-Snell 残差 不能将删失观测得到的残差与未删失观测得到的残差同等对待。因此，我们可能会设法修正 Cox-Snell 残差，以便明确考虑删失。 假设第 \\(i\\) 个生存时间是一个删失观测 \\(t^*_i\\)，并且设 \\(t_i\\) 是满足 \\(t_i&gt;t^*_i\\) 的实际但未知的生存时间。在该个体删失生存时间计算的 Cox-Snell 残差为 \\[\\begin{aligned}r_{Ci}=\\hat{H}_i(t_i^*)=-\\log\\hat{S}_i(t_i^*)\\end{aligned}\\] 其中 \\(\\hat{H}_{{i}}(t_{{i}}^*)\\) 和 \\(\\hat{S}_{{i}}(t_{{i}}^*)\\) 分别为第 \\(i\\) 个个体的累积风险函数和生存函数在删失生存时间 \\(t_i^*\\) 处的估计值。 如果拟合的模型是正确的，则可任务 \\(r_{Ci}\\) 服从单位指数分布。该分布的累积风险函数随时间线性增加，因此第 \\(i\\) 个个体的生存时间 \\(t_i\\) 值越大，该个体的 Cox-Snell 残差值就越大。因此，第 \\(i\\) 个个体在实际（未知）生存时间的残差 \\(\\hat{H}_{\\boldsymbol{i}}(t_{\\boldsymbol{i}})\\) ，将大于在删失生存时间计算的残差。 考虑到这一点，可以通过添加正的常数 \\(\\Delta\\) 来修正 Cox-Snell 残差，该常数可称为超额残差 (excess residual). 因此，修正的 Cox-Snell 残差形如 \\[\\left.r&#39;_{Ci}=\\left\\{\\begin{array}{ll}r_{Ci}&amp;\\text{对于未删失观测},\\\\r_{Ci}+\\Delta&amp;\\text{对于删失观测},\\end{array}\\right.\\right.\\] 其中 \\(r&#39;_{Ci}\\) 是第 \\(i\\) 个观测的 Cox-Snell 残差，由式 4.1 定义。现在需要确定合适的 \\(\\Delta\\) 值。为此，我们利用指数分布的无记忆性 (lack of memory property). 为了证明这一性质，假设随机变量 \\(T\\) 服从均值为 \\(\\lambda−1\\) 的指数分布，并考虑 \\(T\\) 超过 \\(t_0+t_1,t_1 \\ge 0\\) 的概率，条件是 \\(T\\) 至少为 \\(t_0\\)。根据 3.3.1 节中给出的条件概率的标准结果，该概率为 \\[\\begin{aligned}\\mathrm{P}(T\\geqslant t_0+t_1\\mid T\\geqslant t_0)&amp;=\\frac{\\mathrm{P}(T\\geqslant t_0+t_1\\text{ and }T\\geqslant t_0)}{\\mathrm{P}(T\\geqslant t_0)}\\end{aligned}\\] 该表达式的分子简单地为 \\(\\mathrm{P}(T\\geqslant t_0+t_1)\\)，因此所需概率是生存时间超过 \\(t_0+t_1\\) 的概率与超过 \\(t_0\\) 的概率之比，即 \\(S(t_0+t_1)/S(t_0)\\)。指数分布的生存函数由 \\(S(t)=e^{-\\lambda t}\\) 给出，如第 5 章式 (5.2) 所示，因此 \\[\\begin{aligned}\\mathrm{P}(T\\geqslant t_0+t_1\\mid T\\geqslant t_0)&amp;=\\frac{\\exp\\{-\\lambda(t_0+t_1)\\}}{\\exp(-\\lambda t_0)}=e^{-\\lambda t_1}\\end{aligned}\\] 它是指数随机变量在时间 \\(t_1\\) 的生存函数，即 \\(\\mathrm{P}(T\\geqslant t_{1})\\)。这一结果意味着，在生存到时间 \\(t_0\\) 的条件下，超过 \\(t_0\\) 的超额生存时间也具有指数分布，均值为 \\(\\lambda^{−1}\\)。换言之，生存时间超过 \\(t_0\\) 的概率不受个体已经生存到时间 \\(t_0\\) 这一信息的影响。 根据该结果，由于 \\(r&#39;_{Ci}\\) 具有单位指数分布，因此超额残差 \\(\\Delta\\) 也将具有单位指数分布。因此，\\(\\Delta\\) 的期望值是 1，提示 \\(\\Delta\\) 可视为 1，这得出了修正的 Cox-Snell 残差，为 \\[\\begin{align} \\left.r&#39;_{Ci}=\\left\\{\\begin{array}{ll}r_{Ci}&amp;\\text{对于未删失观测},\\\\r_{Ci}+1&amp;\\text{对于删失观测},\\end{array}\\right.\\right. \\tag{4.3} \\end{align}\\] 第 \\(i\\) 个修正的 Cox-Snell 残差可通过引入事件指示符 \\(\\delta_i\\) 以另一种形式表示，如果第 \\(i\\) 个个体的观测生存时间删失，则 \\(\\delta_i\\) 取 0，如果未删失则取 1. 那么根据式 (4.3)，修正的 Cox-Snell 残差由下式给出 \\[\\begin{align} r&#39;_{Ci}=1-\\delta_i+r_{Ci} \\tag{4.4} \\end{align}\\] 注意，根据这种类型残差的定义，对于删失观测 \\(r&#39;_{Ci}\\) 必须大于 1. 此外，对于未修正的残差，\\(r&#39;_{Ci}\\) 可以取零到无穷大之间的任何值，并且它们具有偏斜分布。 Crowley and Hu (1977) 根据经验性证据发现，为删失观测的 Cox-Snell 残差添加 1 会使残差过度膨胀。因此，他们建议使用超额残差的中位数而不是平均值。对于单位指数分布，生存函数为 \\(S(t)=e^{-t}\\)，中位数 \\(t(50)\\) 满足 \\(e^{-t(50)}=0.5\\)，因此 \\(t(50)=\\log2=0.693\\)。因此，修正的 Cox-Snell 残差的第二个版本为 \\[\\begin{align} \\left.r&#39;&#39;_{Ci}=\\left\\{\\begin{array}{ll}r_{Ci}&amp;\\text{对于未删失观测},\\\\r_{Ci}+0.693&amp;\\text{对于删失观测},\\end{array}\\right.\\right. \\tag{4.5} \\end{align}\\] 然而，如果删失观测的比例不太大，则来自式 (4.3) 和 式 (4.5) 的修正残差集不会有太大差异。 4.1.3 鞅残差 式 (4.4) 定义的修正残差 \\(r&#39;_{Ci}\\) 对于未删失观测具有单位均值。因此，这些残差可以通过重新定义 (relocate) \\(r&#39;_{Ci}\\) 来进一步细化，使得在未删失观测时它们的均值为零。此外，如果将所得值乘以 \\(−1\\)，则可获得残差 \\[\\begin{align} r_{Mi}=\\delta_i-r_{Ci} \\tag{4.6} \\end{align}\\] 这些残差称为鞅残差 (martingale residuals)，因为它们也可以使用所谓的鞅法 (martingale methods) 导出，稍后将在第 13 章 ?? 节中提及。在这一推导中，\\(r_{Ci}\\) 基于累积风险函数的 Nelson-Aalen 估计。 鞅残差取值在 \\(-∞\\) 和 \\(1\\) 之间，删失观测的残差为负，其中 \\(\\delta_i=0\\)。还可以证明，这些残差之和为零，并且在大样本中，鞅残差彼此不相关，并且期望为零。在这方面，它们的性质类似于线性回归分析中的残差。 观察鞅残差另一种方式为，式 (4.6) 中的 \\(r_{Mi}\\) 是区间 \\((0,t_i)\\) 内第 \\(i\\) 个个体的死亡数与基于拟合模型的相应估计期望数之差。要理解这一点，请注意，如果生存时间 \\(t_i\\) 未删失，观察到的死亡数就是 1，如果删失了则为 0，也就是 \\(\\delta_i\\)。式 (4.6) 中的第二项是 \\(H_i(t_i)\\) 的估计值，即第 \\(i\\) 个个体在区间 \\((0,t_i)\\) 内的累积死亡风险。根据第 1 章 1.4.3 节，这可以解释为该区间内预期的死亡数。这体现了鞅残差和其他数据分析领域的残差之间的另一个相似之处。 4.1.4 偏差残差 尽管鞅残差与其他情况（例如线性回归分析）中遇到的残差具有许多相同的性质，但即使拟合模型正确，它们也不会关于零对称分布。这种偏性使得残差图难以解释。Therneau, Grambsch and Fleming (1990) 引入的偏差残差 (deviance residuals) 则更接近于关于零对称分布，其定义为 \\[\\begin{align}r_{Di}=\\operatorname{sgn}(r_{Mi})\\left[-2\\left\\{r_{Mi}+\\delta_i\\log(\\delta_i-r_{Mi})\\right\\}\\right]^{\\frac{1}{2}} \\tag{4.7} \\end{align}\\] 其中 \\(r_{Mi}\\) 是第 \\(i\\) 个个体的鞅残差，函数 \\(\\operatorname{sgn}(\\cdot)\\) 是符号函数 (sign function)：如果其参数为正，则取值 \\(+1\\)，如果参数为负，则取值 \\(−1\\)。因此，\\(\\operatorname{sgn}(r_{Mi})\\) 确保偏差残差与鞅残差具有相同的符号。 这些残差的原始动机是它们是偏差 (deviance) 的组成部分。偏差是一种统计量，用于总结当前感兴趣的模型的拟合程度以及与数据完美拟合的模型的拟合程度之间偏差。后者称为饱和模型或全模型 (saturated or full model)，是允许每个个体的 \\(\\beta\\) 系数不同的模型。偏差统计量由下式给出 \\[D=-2\\left\\{\\log\\hat{L}_c-\\log\\hat{L}_f\\right\\}\\] 其中 \\(\\hat{L}_c\\) 是当前模型的最大偏似然，\\(\\hat{L}_f\\) 是全模型的最大偏似然。偏差值越小，模型越好。偏差可视为将正态数据建模中使用的残差平方和推广到非正态数据的分析，在广义线性建模中具有突出的特征。请注意，两模型的偏差之差与第 3 章中介绍的统计量 \\(-2\\log\\hat{L}\\) 值之差相同。偏差残差满足 \\(D=\\sum r_{D{i}}^2\\)，因此，与相对较大的偏差残差对应的观测是那些没有被模型很好地拟合的观测。 观察偏差残差的另一种方式为，当拟合的模型合适时，它们是通过变换得到的鞅残差，其值关于零对称。为了理解这一点，首先回顾一下，鞅残差 \\(r_{Mi}\\) 可以取在区间 \\((−∞, 1)\\) 内的任何值。对于 \\(r_{Mi}\\) 的较小负值，式 (4.7) 中方括号内的项主要由 \\(r_{Mi}\\) 决定。对该量取平方根的作用是将残差拉近到零。因此，范围在 \\((−∞, 1)\\) 内的鞅残差会向零收缩。现考虑区间 \\((0, 1)\\) 内的鞅残差。式 (4.7) 中的项 \\(\\delta_i\\log(\\delta_i-r_{Mi})\\) 仅在未删失观测中才非零，且其值为 \\(\\log(1-r_{Mi})\\)。随着 \\(r_{M i}\\) 接近 1，\\(1−r_{M i}\\) 接近 0，\\(\\log(1-r_{Mi})\\) 会取较小的负值。此时，式 (4.7) 中方括号内主要由这个对数项决定，因此当鞅残差达到其上限 \\(1\\) 时，偏差残差会向 \\(+∞\\) 延展。 最后需要注意的一点是，当拟合了适当的模型时，可以预期这些残差在零附近对称分布，但它们的总和不一定为零。 4.1.5 Schoenfeld 残差 4.1.1 节至第 4.1.4 节中描述的残差的两个缺点是，它们在很大程度上取决于观察到的生存时间，并且需要对累积风险函数进行估计。Schoenfeld (1982) 提出的残差克服了这两个缺点。这些残差最初被称为部分残差 (partial residuals)（原因在后续给出），但现在通常被称为 Schoenfeld 残差。该残差与之前考虑的残差在一个重要方面不同：每个个体不是只有一个残差值，而是一组值，每个值对应于拟合的 Cox 回归模型中包含的每个解释变量。 模型中的第 \\(j\\) 个解释变量 \\(X_j\\) 的第 \\(i\\) 个 Schoenfeld 残差由下式给出 \\[\\begin{align} r_{Sji}=\\delta_i\\{x_{ji}-\\hat{a}_{ji}\\} \\tag{4.8} \\end{align}\\] 其中 \\(x_{ji}\\) 是第 \\(j\\) 个解释变量的值，\\(j=1,2,\\ldots,p\\)，对于研究中的第 \\(i\\) 个个体 \\[\\begin{align} \\hat{a}_{ji}=\\frac{\\sum_{l\\in R(t_i)}x_{jl}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)}{\\sum_{l\\in R(t_i)}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)} \\tag{4.9} \\end{align}\\] \\(R(t_{{i}})\\) 为时间 \\(t_i\\) 的风险集。 请注意，这些残差的非零值只出现在未删失观测中。此外，如果生存时间样本中的最大观测未删失，则根据式 (4.9)，该观测的 \\(\\hat{a}_{j\\textit{i}}\\) 的值将等于 \\(x_{ji}\\)，因此 \\(r_{Sji}=0\\)。为了区分真正为零的残差与从删失观测中获得的残差，后者通常表示为缺失值。 对于解释变量 \\(X_j\\)，第 \\(i\\) 个 Schoenfeld 残差是对数偏似然函数关于 \\(\\beta_j\\) 的一阶导数的第 \\(i\\) 个分量的估计，根据式 (3.6)，其由下式给出： \\[\\begin{align} \\frac{\\partial\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j}&amp;=\\sum_{i=1}^n\\delta_i\\{x_{ji}-a_{ji}\\} \\tag{4.10} \\end{align}\\] 其中 \\[\\begin{align} a_{ji}=\\frac{\\sum_{l}x_{jl}\\exp(\\boldsymbol{\\beta&#39;x_l})}{\\sum_{l}\\exp(\\boldsymbol{\\beta&#39;x_l})} \\tag{4.11} \\end{align}\\] 该求和中的第 \\(i\\) 项在 \\(\\hat{\\boldsymbol\\beta}\\) 处计算，是 \\(X_j\\) 的 Schoenfeld 残差，如式 (4.8) 所示。由于 \\(\\beta\\) 的估计满足 \\[\\left.\\frac{\\partial\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j}\\right|_{\\boldsymbol{\\hat{\\beta}}}=0\\] 因此 Schoenfeld 残差之和必须为零。这些残差还具有这样的性质：在大样本中，\\(r_{Sji}\\) 的期望值为零，并且它们彼此不相关。 事实证明，Grambsch and Therneau (1994) 提出的 Schoenfeld 残差的缩放 (scaled) 版本在检测与假设模型的偏差方面更有效。令第 \\(i\\) 个个体的 Schoenfeld 残差向量表示为 \\(\\boldsymbol{r}_{Si}=(r_{S1i},r_{S2i},\\ldots,r_{Spi}){&#39;}\\)。缩放或加权的 Schoenfeld 残差 \\(r_{Sji}^{*}\\) 为如下向量的分量 \\[\\begin{aligned}\\boldsymbol{r}_{S{i}}^*=d\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{r}_{S{i}}\\end{aligned}\\] 其中 \\(d\\) 是 \\(n\\) 个个体中的死亡人数，\\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\) 是拟合的 Cox 回归模型中参数估计的方差协方差阵。因此，这些缩放 Schoenfeld 残差的计算非常简单。 4.1.6 得分残差 还有另一种类型的残差在模型检查的某些方面很有用，它与 Schoenfeld 残差一样，是从对数偏似然函数关于参数 \\(\\beta_j\\) 的的一阶导数获得的，\\(j = 1, 2,\\ldots,p\\)。然而，式 (4.10) 中的导数现在以完全不同的形式表示，即 \\[\\begin{align} \\frac{\\partial\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j}=\\sum_{i=1}^n\\left\\{\\delta_i(x_{ji}-a_{ji})+\\exp(\\boldsymbol{\\beta}&#39;\\boldsymbol{x}_i)\\sum_{t_r\\leqslant t_i}\\frac{(a_{jr}-x_{ji})\\delta_r}{\\sum_{l\\in R(t_r)}\\exp(\\boldsymbol{\\beta}&#39;\\boldsymbol{x}_l)}\\right\\} \\tag{4.12} \\end{align}\\] 其中 \\(x_{ji}\\) 是第 \\(j\\) 个解释变量的第 \\(i\\) 个值，\\(\\delta_i\\) 是事件指示：对于删失观测为 0，否则为 1. \\(a_{ji}\\) 由式 (4.11) 给出，\\(R(t_{{r}})\\) 为在时间 \\(t_r\\) 处的风险集。在该公式中，第 \\(i\\) 个观测对导数的贡献仅取决于时间 \\(t_i\\) 之前的信息。换句话说，如果研究实际上在时间 \\(t_i\\) 结束，导数的第 \\(i\\) 个分量不会受影响。那么残差就是导数的 \\(n\\) 个分量的估计值。根据附录 A，对数偏似然函数关于 \\(\\beta_j\\) 的一阶导数是 \\(\\beta_j\\) 的有效得分 (efficient score)，记为 \\(u(\\beta_j)\\)。因此，这些残差称为得分残差 (score residuals)，用 \\(r_{Uji}\\) 表示。 根据式 (4.12)，模型中第 \\(j\\) 个解释变量 \\(X_j\\) 的第 \\(i(i=1,2,\\ldots,n)\\) 个得分残差由下式给出： \\[\\begin{aligned}r_{Uji}&amp;=\\delta_i(x_{ji}-\\hat{a}_{ji})+\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i)\\sum_{t_r\\leqslant t_i}\\frac{(\\hat{a}_{jr}-x_{ji})\\delta_r}{\\sum_{l\\in R(t_r)}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)}\\end{aligned}\\] 使用式 (4.8) 后，上式可以写为以下形式： \\[\\begin{align} r_{Uji}=r_{Sji}+\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i)\\sum_{t_r\\leqslant t_i}\\frac{(\\hat{a}_{jr}-x_{ji})\\delta_r}{\\sum_{l\\in R(t_r)}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_l)} \\tag{4.13} \\end{align}\\] 这表明得分残差是 Schoenfeld 残差的修改。与 Schoenfeld 残差一样，得分残差的总和为零，但观测删失时，得分残差不一定为零。 本节定义了许多残差。我们用一个示例来说明这些不同类型的残差的计算，并显示它们之间的相似性和差异。这个示例将在本章的许多说明中使用，主要是因为相对较少的观测使得残差值和其他诊断值可以很容易地制成表格。然而，本章的方法通常在较大的数据集中提供更多信息。 示例 4.1 (透析患者的感染) 在治疗某些肾脏疾病时，可以使用透析来清除血液中的废物。透析患者可能出现的一个问题是在导管插入的部位发生感染。如果发生任何此类感染，必须取出导管并清除感染。在 McGilchrist and Aisbett (1991) 描述的一项调查感染发生率的研究中，记录了一组肾病患者从插入导管到感染的时间。有时因感染之外的原因必须拔除导管，从而产生右删失观察结果。此示例中的数据涉及 13 名患有在该论文中编码为 3 型的肾病患者。 表 4.1 给出了从插入导管到第一次发生感染后拔除导管的天数，以及指示个体感染状态的变量值。如果因感染之外的原因拔除导管，则该变量取值为 0，否则取值为 1. 数据集还包括每个患者的年龄（以年为单位）以及表示性别的变量 （1 = 男性，2 = 女性）。 表 4.1 当对这些数据拟合 Cox 回归模型时，第 \\(i\\) 个患者 \\(i = 1, 2,..., 13\\) 的风险函数估计为 \\[\\begin{align} \\hat{h}_i(t)=\\exp\\left\\{0.030Age_i-2.711Sex_i\\right\\}\\hat{h}_0(t) \\tag{4.14} \\end{align}\\] 其中 \\(Age_i\\) 和 \\(Sex_i\\) 表示第 \\(i\\) 个患者的年龄和性别。 变量 Sex 当然很重要，因为当将 Sex 添加到仅包含 Age 的模型中时，在 \\(-2\\log\\hat{L}\\) 统计量在一个自由度上的减小了 6.445. 这种变化非常显著（\\(P=0.011\\)）。另一方面，没有统计证据表明在需模型中包括变量 Age，将 Age 添加到包含 Sex 的模型中后 \\(-2\\log\\hat{L}\\) 统计量在一个自由度上的变化为 1.320（\\(P=0.251\\)）。但是从临床角度来看，感染的风险很可能取决于年龄。因此，这两个变量都将保留在模型中。 式 (4.14) 中模型的不同类型的残差值如表 4.2 所示。在此表中，\\(r_{Ci},r_{Mi}\\) 和 \\(r_{Di}\\) 分别是 Cox-Snell 残差、鞅残差和偏差残差。\\({r_{S1i}}\\) 和 \\({r_{S2i}}\\) 分别是变量 Age 和 Sex 的 Schoenfeld 残差值，\\(r_{S1i}^{*}\\) 和 \\(r_{S2i}^{*}\\) 是相应的缩放 Schoenfeld 残差，\\(r_{U1i},r_{U2i}\\) 为得分残差。 该表中的值是使用式 (3.29) 中给出的基线累积风险函数的 Nelson-Aalen 估计来计算的。如果使用式 (3.23) 中的估计 \\(\\hat H_0(t)\\)，则除 Schoenfeld 残差之外的所有残差都将获得不同的值。此外，由于生存函数的相应估计在最长拔除时间处为零，这对应 13 号患者，因此不会为该患者定义 Cox-Snell、鞅和偏差残差的值，并且鞅残差将不再为零。 表 4.2 在此数据集中，只有一个删失观测，即针对 6 号患者的观测。除 6 号患者之外的所有患者，修正的 Cox-Snell 残差将与 Cox-Snell 残差相同。对于该患者，修正残差的两种形式的值为 \\(r&#39;_{C6}=1.265\\) 和 \\(r&#39;&#39;_{C6}= 0.958\\)。此外，对于具有删失拔出时间的患者，Schoenfeld 是未定义的，对于拔出导管时间最长的患者，Schoenfeld 残差为零。 表 4.2 清楚地显示了 Cox-Snell 残差和鞅残差的偏度，因为 Cox-Snell 残差以 1 为中心，而鞅残差和偏差残差以 0 为中心。另请注意，鞅、Schoenfeld 和得分残差之和为零，并且它们理应如此。 表 4.2 中残差的一个不寻常的特征是与 Sex 对应的 Schoenfeld 残差值有大量的 0. 其原因是，对于大于 30 天的感染时间，变量性别的值总是等于 2. 这意味着，对于大于 30 天的生存时间，式 (4.9) 中的 Schoenfeld 残差等于 2，因此式 (4.8) 中定义的 Schoenfeld 残差为 0. 我们现在考虑如何使用拟合 Cox 回归模型后获得的残差来阐明拟合模型在多大程度上提供了对观测数据的适当描述，然后我们将更详细地研究示例 4.1 中得到的残差。 4.2 模型拟合的评估 许多基于残差的图形可以作为评估拟合模型充分性的图形。不幸的是，许多类似于线性回归分析中使用的残差图的图形程序并未被证明是非常有用的。这是因为，即使已拟合了正确的模型，残差与观测生存时间或这些时间的秩次之间的图形也往往会呈现出明确的模式。传统上，残差图基于 Cox-Snell 残差或 4.1.2 节中描述的其调整版本。下一节将回顾这些残差的使用，然后描述如何使用其他类型的残差来对模型拟合进行图形评估。 4.2.1 基于 Cox-Snell 残差的图形 在 4.1.1 节中，如果拟合的模型是正确的，Cox-Snell 残差将显示为具有单位均值的指数分布。因此，它们均值和方差都为 1，并且不对称地分布在均值附近。这意味着，简单的残差图，如残差关于观测的图形，称为索引图 (index plots)，不会是对称的。残差也与生存时间相关 (correlated)，因此这些残差与生存时间或这些时间的秩次的图形也是无用的。 这些残差的一个特定图形可用于评估模型的整体拟合，从而评估残差是否为来自单位指数分布的合理样本。该图形基于以下事实：如果随机变量 \\(T\\) 服从单位均值的指数分布，则 \\(T\\) 的生存函数为 \\(e^{−t}\\) ；请参见第 5 章 5.1.1 节。因此，累积风险函数 \\(H(t) = − \\log S(t)\\) 关于 \\(t\\) 的图形，称为累积风险图 (cumulative hazard plot)，将给出一条通过原点、单位斜率的直线。 该结果可用于检验残差是否具有单位指数分布。在计算 Cox-Snell 残差 \\(r_{Ci}\\) 之后，可以得到这些值的生存函数的 Kaplan-Meier 估计。该估计的计算方式与生存时间的 生存函数的 Kaplan-Meier 估计类似，只不过现在所依据的数据是残差 \\(r_{Ci}\\)。从删失生存时间获得的残差也视为删失的。用 \\(\\hat{S}(r_{Ci})\\) 表示估计值，绘制 \\(\\hat{H}(r_{Ci})=-\\operatorname{log}\\hat{S}(r_{Ci})\\) 关于 \\(r_{Ci}\\) 的图形。这给出了残差的累积风险图。一条具有单位斜率和零截距的直线将表明拟合的生存模型是令人满意的。另一方面，如果图形系统性地偏离直线，或者得到的直线斜率不近似为 1 或截距不近似为 0，这可能意味着模型需要以某种方式进行修改。等价地，也可以使用残差的对数累积风险图 (log-cumulative hazard plot)，即 \\(\\hat{H}(r_{Ci})=-\\operatorname{log}\\hat{S}(r_{Ci})\\) 关于 \\(\\log r_{Ci}\\) 的图形。关于该图形详细的讨论见 4.4.1 节。 示例 4.2 (透析患者的感染) 再次考虑有关肾病患者感染发生时间的数据，如示例 4.1 所述。在这个例子中，我们首先检查 Cox-Snell 残差是否为单位指数分布的合理样本。为此，首先获得 Cox-Snell 残差的生存函数的 Kaplan-Meier 估计 \\(\\hat{S}(r_{C{i}})\\)。然后绘制残差的累积风险函数 \\(\\hat{H}(r_{Ci})=-\\log\\hat{S}(r_{C\\boldsymbol{i}})\\) 关于相应残差的图形，得到残差的累积风险图。表 4.3 总结了该计算的具体情况，图 4.1 显示了累积风险图形。6 号患者的残差没有相应的 \\(\\hat{S}(r_{C{6}}),\\hat{H}(r_{C6})\\) 的值，因为该观测是删失的。 表 4.3 图 4.1 该数据集中的观测相对较少，因此很难解释残差的图形。然而，图 4.1 中的散点相当接近一条通过原点的直线，这条直线的斜率约为 1. 这可能表明，为表 4.1 中给出的数据拟合的模型是令人满意的。 从表面上看，这一程序似乎有一些优点，但 Cox-Snell 残差的累积风险图在实践中并没有被证明是非常有用的。有人认为，在前面的一节中，由于值 \\(-\\log S(t_i)\\) 具有单位指数分布，因此当拟合模型是正确的时，Cox-Snell 残差作为这些量的估计，应该近似服从单位指数分布。然后在解释残差的累积风险图时使用这一结果。不幸的是，这种近似不是很可靠，尤其是在小样本中。这是因为在计算 \\(r_{Ci}\\) 时需要估计 \\(\\beta\\) 以及基线累积风险函数 \\(H_0(t)\\)。由于使用了估计值，因此残差的实际分布并不一定是单位指数分布，而且其确切分布是未知的。事实上，Lagakos (1981) 的研究表明，当 \\(n=3\\) 时，Cox-Snell 残差的分布与单位指数分布相去甚远。 在其他情况下，即使已知拟合的模型不正确，也可能得到一条直线图。事实上，实践经验表明，在 Cox-Snell 残差的累积风险图中，不太可能看到除单位斜率的直线以外的其他图形，除非拟合的模型存在严重错误。 在零模型——即不包含解释变量的模型——的特殊情况下，累积风险图恰好是一条单位斜率和零截距的直线，虽然应将一些解释变量纳入模型中。其原因是，当不包括协变量时，第 \\(i\\) 个个体的 Cox-Snell 残差减小为 \\(-\\log\\hat{S}_0(t_i)\\)。根据第 3 章的式 (3.30)，在不存在结的情况下，在第 \\(k(k=1,2,\\ldots,r-1)\\) 个未删失生存时间，该值约为 \\(\\sum_{j=1}^k1/n_j\\)，其中 \\(n_j\\) 是在时间 \\(t_j\\) 处于风险中的人数。该总和简单地为 \\(\\sum_{j=1}^{k}1/(n-j+1)\\)，这是单位指数分布中样本大小为 \\(n\\) 的样本中第 \\(k\\) 个顺序统计量 (order statistic) 的期望。 鉴于 Cox-Snell 残差在评估模型充分性方面的局限性，下一节将介绍实用的基于其他类型残差的诊断程序。 4.2.2 基于鞅和偏差残差的图形 4.1.3 节中介绍的鞅残差可解释为第 \\(i\\) 个个体在时间区间 \\((0,t_i)\\) 内的观测死亡数与预期死亡数之差。因此，这些残差突出显示了根据假设模型死亡过早或寿命过长的个体。较小的负残差将对应于生存时间较长的个体，但协变量值表明他们应该更早死亡。另一方面，当个体的生存时间出乎意料地短时，将获得接近于 1 的残差，即鞅残差的上限。鞅残差的索引图将突出显示模型未能很好拟合生存时间的个体。此类观测可称为离群值 (outliers). 残差绝对值异常大的个体的数据需要进一步检查。这些残差与生存时间、生存时间的秩次或解释变量的图形，可以指示是否存在模型拟合不佳的特定时间或解释变量的值。 由于偏差残差比鞅残差的分布更对称，因此基于这些残差的图形往往更容易解释。因此，偏差残差的索引图也可用于识别生存时间拟合不佳的个体。 在拟合的 Cox 回归模型中，第 \\(i\\) 个个体在任何时间的死亡风险通过函数 \\(\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i)\\) 取决于该个体的解释变量 \\(\\boldsymbol x_i\\) 的值。这意味着 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 具有较小负值的个体的死亡风险低于平均值，具有较大正值的个体的风险高于平均值。量 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\) 是第 3 章 3.1 节中介绍的风险评分，提供了关于个体是否可能生存较短时间或较长时间的信息。通过协调生存时间与其风险评分值不一致的个体的信息，可以获得关于模型拟合不佳的观测特征的有用信息。在这种情况下，绘制偏差残差关于风险评分的图形是一种特别有用的诊断方法。 示例 4.3 (透析患者的感染) 再次考虑肾病患者感染时间的数据。从表 4.2 中给出的鞅和偏差残差值中，我们看到患者 2 具有最大的正残差，这表明该患者移除导管的时间比基于拟合模型的预期更短。该表还显示，这两种类型的残差对观测的排序不相同。例如，患者 12 有第二小的负鞅残差，而患者 6 有第二小的负偏差残差。然而，正如本示例所示，具有最极端鞅残差和偏差残差的观测往往是相同的。图 4.2 展示了鞅残差和偏差残差的索引图。 图 4.2 这些图非常相似，但偏差残差的分布更加对称。这些图还显示，没有患者的残差绝对值异常地大。图 4.3 给出了偏差残差与风险评分的关系图，这些风险评分根据 \\(0.030Age_i-2.711Sex_i\\) 计算得出，其中 \\(i = 1, 2,..., 13\\)。 图 4.3 该图显示偏差残差最大的患者风险评分较低。这表明这些患者早期拔除导管的风险相对较低，但拔除时间比预期的要早。 4.2.3 检查协变量的函数形式 尽管第 3 章中描述的基于模型的生存数据分析方法确定了风险函数所依赖的一组特定协变量，但检查这些变量是否采用了正确的函数形式非常重要。通过使用变量的变换值而不是原始值，可能会很好地改善模型的拟合。例如，通过使用个体基线年龄的非线性函数或血清胆红素等生化变量的对数，可能会得到拟合效果更好的模型。类似地，有的解释变量（如血清胆固醇水平）只有超过某个阈值时才开始对生存产生影响，在此之后，死亡风险可能会随着该变量的值的增加而增加。 评估模型充分性的一种直接方法基于零模型（即不包含协变量的模型）的鞅残差。然后绘制这些残差关于模型中每个协变量值的图形。Therneau, Grambsch and Fleming (1990) 已经证明，该图形应该显示协变量所需的函数形式。具体来说，直线图表明需要线性项。 作为该方法的扩展，如果可以假设某些协变量的函数形式是已知的，则可以从仅包含这些协变量的 Cox 回归模型中计算鞅残差。然后，绘制得到的鞅残差关于需要确定其函数形式的协变量的图形。 以这种方式获得的图形通常相当“嘈杂” (noisy)，通过叠加为散点拟合的平滑曲线，将有助于其解释。有许多常用的平滑器 (smoothers)，包括平滑样条 (smoothing splines). 然而，使用最广泛的平滑器是局部加权散点平滑 (locally weighted scatterplot smoothing, LOWESS) 和局部估计散点平滑 (locally estimated scatterplot smoothing, LOESS)法，它们由 Cleveland (1979) 引入并在许多软件包中都有实现。 即使使用了平滑器，在图形中观察到非线性模式时，也很难分辨出特定的函数形式。如果提出了特定的变换，比如对数变换，可以对协变量进行这样的变换，并绘制零模型的鞅残差关于变换变量的图形。如果出现一条直线，则可以确认这就是适当的变换。 示例 4.4 (透析患者的感染) 在此示例中，我们说明了如何使用鞅残差来评估年龄效应在示例 4.1 数据的 Cox 回归模型中是否呈线性。首先，获得零模型的鞅残差，并绘制残差关于患者年龄相应值的图形，如图 4.4 所示。关于该图形，数据太少以至于不能多做评价，但平滑曲线表明，对于年龄，除了作为线性项，没有其他合适的选择。事实上，年龄效应并不显著，因此平滑曲线大致呈水平状也就不足为奇了。 图 4.4 以另一个示例结束本节。 示例 4.5 (多发性骨髓瘤患者的生存率) 在本例中，我们回到示例 1.3 中描述的 48 例多发性骨髓瘤患者的生存时间数据。示例 3.5 已发现，包含解释变量 Hb （血清血红蛋白）和 Bun （血尿素氮）的 Cox 回归模型是适用于该风险函数的模型。我们现在对残差进行分析，以研究该拟合模型的充分性。 首先，Cox-Snell 残差的累积风险图如图 4.5 所示。由该图中绘制的点所形成的线相当直，具有单位斜率和零截距。根据该图，没有理由怀疑拟合模型的充分性。然而，如 4.2.1 节所述，该图对拟合模型的偏差不是很敏感。 图 4.5 为进一步评估模型的拟合，绘制偏差残差关于其相应的风险评分的图形，如图 4.6 所示。该图显示患者 41 和 38 具有最大的偏差残差值，但这些值与其他一些患者的残差值相差不大。具有三个最大风险评分的患者的残差接近于零，这表明这些观测与模型非常吻合。同样，没有理由怀疑拟合模型的有效性。 图 4.6 为研究变量 Hb 和 Bun 是否使用了正确的函数形式，计算了零模型的鞅残差，并绘制其关于这些变量值的图形。如图 4.7 和 4.8 所示，其中叠加了平滑曲线以帮助解释。这些图证实了模型中需要这两个变量的线性项。请注意，图 4.7 中 Hb 图形的斜率为负，对应于拟合模型中 Hb 的负系数，而图 4.8 中 Bun 图形的斜率为正。 图 4.7 图 4.8 在该数据集中，Bun 的值在 6 到 172 之间，其值在 48 名受试者中呈正偏态分布。为了防止该变量的极值对 Bun 系数产生不当影响，在建模过程中可能会使用该变量的对数。尽管图 4.8 中没有提出该建议，但出于说明目的，我们将使用此类图形来研究包含 log Bun 而不是 Bun 的模型是否可以接受。图 4.9 显示了零模型鞅残差关于 log Bun 值的图形。 图 4.9 该图的平滑曲线确实表明，使用 log Bun 的线性项是不合适的。事实上，如果决定在模型中使用 log Bun，图 4.9 表明可能需要 log Bun 的二次项。事实上，将此二次项添加到包含 Hb 和 log Bun 的模型中会导致 \\(-2\\operatorname{log}\\hat{L}\\) 的值显著减小，但此统计量的结果值 201.458 仅略小于包含 Hb 和 Bun 的模型的相应值 (202.938). 本分析证实，模型应包含与血红蛋白和血尿素氮水平相应变量的线性项。 4.3 识别有影响的观测 在评估模型充分性时，重要的是确定任何特定观察是否会对拟合模型所做的推断产生不当影响。对基于模型的推断确实有影响 (effect) 的观测被认为是有影响的 (influential). 作为一个例子，考虑一项生存研究，其中将新疗法与标准疗法进行比较。在这样的比较中，重要的是确定新疗法的死亡风险相对于标准疗法的死亡风险是否受到任何个体的显著影响。具体来说，当某个个体的数据从数据集中删除时，相对风险可能会大幅增加或减少。如果发生这种情况，来自该个体的数据将需要接受特别的审查。 生存分析得出的结论通常是对相对风险和中位生存时间等量的估计来确定的，这取决于拟合的 Cox 回归模型中 \\(\\boldsymbol \\beta\\) 参数的估计。因此，检查每个观测对这些估计的影响特别重要。我们可以通过依次省略研究中每个个体的数据记录来检查拟合模型中的估计参数受影响的程度来做到这一点。在某些情况下，参数子集的估计可能具有特殊重要性，例如与治疗效应相关的参数。那么关于影响的研究可能仅限于这些参数。在许多情况下，每个观测对风险函数估计的影响都是令人感兴趣的，因此，识别出对模型完整参数估计集产生影响的观测就显得尤为重要。以下各节将讨论这两个方面的影响。 与分析其他类型数据时使用的模型（例如一般线性模型）相比，从一组生存数据中删除一个观察的影响并不容易研究。这主要是因为 Cox 回归模型的对数似然函数不能表示为一系列项的和，其中每项是每个观测对对数似然函数的贡献。相反，删除一个观测会影响风险集中以 \\(\\exp(\\boldsymbol{\\beta&#39;x})\\) 形式进行求和的量。这意味着影响诊断非常难以推导，因此本章以下各节仅给出相关结果。本章最后一节包含与这些推导相关的文献。 4.3.1 观测对参数估计的影响 假设我们想要确定在拟合的 Cox 回归模型中，是否有任何特定的观测对第 \\(j(j=1,2,\\ldots,p)\\) 个参数估计 \\(\\hat{\\beta}_j\\) 产生不利影响。一种方法是使用数据集中的所有 \\(n\\) 个观测来拟合模型，然后依次省略每个观测来拟合相同的模型。然后可以确定省略每个观测对参数估计的实际影响。该程序计算成本很高，除非观测数量不大，因此我们使用一种近似方法来计算当省略第 \\(i\\) 个观测时 \\(\\hat{\\beta}_j\\) 的变化量，其中 \\(i=1,2,\\ldots,n\\)。假设省略第 \\(i\\) 个观测时第 \\(j\\) 个参数估计值为 \\(\\hat{\\beta}_{{j}(i)}\\)。Cain and Lange (1984) 表明，\\(\\hat{\\beta}_{{j}}-\\hat{\\beta}_{{j}(\\boldsymbol{i})}\\) 的近似值基于得分残差（在 4.1.6 节中描述）。 设 \\(\\boldsymbol{r}_{U{i}}\\) 表示第 \\(i\\) 个观测的得分残差向量，因此 \\(\\boldsymbol{r}_{Ui}^{\\prime}=(r_{U1i},r_{U2i},\\ldots,r_{Upi})\\)，其中 \\(r_{Uji},j=1,2,\\ldots,p\\) 为第 \\(j\\) 个解释变量的第 \\(i\\) 个得分残差，由式 (4.13) 给出。\\(\\hat{\\beta}_j-\\hat{\\beta}_{j(i)}\\) 的近似，即省略第 \\(i\\) 个观测时 \\(\\hat{\\beta}_j\\) 的变化，为如下向量的第 \\(j\\) 个分量 \\[\\boldsymbol{r}_{U{i}}^{\\prime}\\operatorname{var}\\left(\\hat{\\boldsymbol{\\beta}}\\right)\\] \\(\\operatorname{var}\\left(\\hat{\\boldsymbol{\\beta}}\\right)\\) 为拟合的 Cox 模型参数估计向量的方差-协方差阵。该向量第 \\(j\\) 个元素称为 delta-beta，记作 \\(\\Delta_i\\hat{\\beta}_j\\)，因此 \\(\\Delta_{i}\\hat{\\beta}_{j}\\approx\\hat{\\beta}_{j}-\\hat{\\beta}_{j(i)}\\)。使用这种近似意味着可以在为完整数据集拟合模型后，根据可用的量 (quantities available) 来计算 \\(\\Delta_i\\hat{\\beta}_j\\) 的值。 影响特定参数估计的观测，例如第 \\(j\\) 个观测，将具有这样的特性：该观测的 \\(\\Delta_i\\hat{\\beta}_j\\) 值（即这些观测的 delta-betas）的绝对值比数据集中其他观测相应的绝对值更大。那么，模型中每个解释变量的 delta-betas 的索引图将揭示是否有观测对任何特定解释变量的参数估计产生不当影响。此外，将 \\(\\Delta_i\\hat{\\beta}_j\\) 的值关于生存时间的秩次作图，可以获取生存时间与影响之间关系的信息。 可以将 delta-betas 标准化，即将 \\(\\Delta_i\\hat{\\beta}_j\\) 除以 \\(\\hat{\\beta}_j\\) 的标准误，得到标准化 (standardized) delta-beta。标准化 delta-beta 可以解释为在省略第 \\(i\\) 个观测后，统计量 \\(\\hat{\\beta}/\\text{ se }(\\hat{\\beta})\\) 值的变化。由于该统计量可用于评估某个参数的值是否显著不同于零（参见第 3 章 3.4 节），因此标准化 delta-beta 可用于提供：从数据集中删除第 \\(i\\) 个观测如何影响参数估计的显著性的信息。同样，索引图是展示标准化 delta-betas 最有用的方式。 统计量 \\(\\Delta_i\\hat{\\beta}_j\\) 是省略第 \\(i\\) 个观测后参数估计实际变化的近似值。这种近似通常是足够的，因为对参数估计有影响的观测将被突出显示。然而，省略任何特定观测对基于模型的推断的实际影响仍需进一步研究。特定情况下实际 delta-betas 与近似 delta-betas 之间的一致性在示例 4.6 中加以说明。 示例 4.6 (透析患者的感染) 在本例中，我们再次回到透析后感染时间的数据。为了研究 13 例患者的数据对拟合的 Cox 回归模型线性部分中变量 Age 和 Sex 的系数估计的影响，得到了近似的未标准化的 \\(\\Delta_{i}\\hat{\\beta}_{1}\\) 和 \\(\\Delta_{i}\\hat{\\beta}_{2}\\)，如表 4.4 所示。 表 4.4 对于 Age，最大的 delta-beta 出现在 13 号患者身上，但也有其他相近的 delta-betas 值。省略该患者数据后参数估计的实际变化为 0.0195，因此相对于基线风险省略该观测降低了感染风险。在整个数据集中，Age 参数估计的标准误为 0.026，因此，当删除一个观测时，该估计的最大变化量约为标准误的四分之三。当省略患者 13 的数据时，Age 效应变得不那么显著，但这种差异不太可能具有实际重要性。 对于 Sex，有两个较大的 delta-beta，它们非常接近，对应于来自患者 2 和 4 的观测。当依次省略每个观测时，参数估计的实际变化分别为 0.820 和 0.818，因此近似的 delta-betas 低估了实际变化。完整数据集中的 Sex 估计系数的标准误为 1.096，因此删除观测时估计的变化也小于一个标准误。删除这两个观测中的任何一个都会增加男性相对于女性的风险，从而性别效应的显著性略有增加。 近似的 delta-betas 可以与实际值进行比较。在本例中，虽然参数估计 的实际变化有被近似值低估的趋势，但总体而言一致性相当好。实际值和近似值之间的最大差异，对于 Age 为 0.010，这出现在 9 号患者身上；对于 Sex 为 0.276，这出现在 2 号患者身上。这些差异大约是每个参数估计的标准误的四分之一。 4.3.2 观测对参数估计集的影响 拟合模型的结构可能对数据集中的一个或多个观测特别敏感。可以使用诊断来检测此类观察结果，该诊断旨在突出显示影响风险评分中完整参数估计集的观测。因此，这些诊断反映了个体观测对风险评分的影响，并提供了 delta-beta 所提供信息之外的信息。具体来说，从数据集中删除给定观测可能不会对任何特定参数估计产生很大影响，因此不会从 delta-beta 统计量的研究中揭示出来。然而，参数估计集的变化可能会导致风险函数估计的形式或基于拟合模型的总结统计量在删除该观测时发生显著变化。用于评估观测对参数估计集影响的统计还具有一个优势：每个观测都有一个诊断值。这使得它们比 delta-betas 等诊断更容易使用。 已经提出了许多用于评估每个观测对参数估计集影响的诊断方法。本节将描述其中两个，但本章的结论部分将提供其他的参考文献。 评估每个观测对模型整体拟合影响的一种方法为：当依次忽略每个观测时，检查在拟合的模型中 \\(-2\\operatorname{log}\\hat{L}\\) （负二倍最大对数偏似然）的变化量。将为所有 \\(n\\) 个观测拟合的模型的最大对数似然值记作 \\(\\log L(\\hat{\\boldsymbol{\\beta}})\\)，当在从拟合中省略第 \\(i\\) 个观测后计算参数估计时，\\(n\\) 个观测的最大对数似然值记作 \\(\\log L(\\hat{\\boldsymbol{\\beta}}_{(i)})\\)。诊断 (diagnostic) \\[2\\left\\{\\log L(\\hat{\\boldsymbol{\\beta}})-\\log L(\\hat{\\boldsymbol{\\beta}}_{(i)})\\right\\}\\] 可用于影响研究。 Pettitt and Bin Daud (1989) 表明该似然位移 (likelihood displacement) 的近似为 \\[\\begin{align} LD_{{i}}=\\boldsymbol{r}&#39;_{U{i}}\\operatorname{var}\\left(\\hat{\\boldsymbol{\\beta}}\\right){\\boldsymbol r}_{U{i}} \\tag{4.15} \\end{align}\\] 其中 \\({\\boldsymbol r}_{U{i}}\\) 是第 \\(i\\) 个观测的得分残差的 \\(p×1\\) 向量，\\(i=1,2,\\ldots,n\\)，其第 \\(j\\) 个分量在式 (4.13) 中给出，并且 \\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\) 是参数估计向量 \\(\\hat{\\boldsymbol{\\beta}}\\) 的方差-协方差阵。因此，该统计量的值可以直接从用于计算模型中每个解释变量的 delta-betas 的项中获得。索引图，或似然位移关于生存时间的秩次的图形，提供了诊断值的直观总结。诊断值相对较大的观测是有影响的。但其关于解释变量的图形不推荐使用，因为正如 Pettitt and Bin Daud (1989) 所证明的那样，即使拟合模型正确，这些图形也可能具有确定的模式。 另一个可用于评估每个观测对参数估计集的影响的诊断基于 \\(n × n\\) 对称矩阵 \\[\\begin{align} \\boldsymbol{B}=\\boldsymbol{U}\\mathrm{~var~}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{U}&#39; \\tag{4.16} \\end{align}\\] 其中 \\(\\boldsymbol{U}\\) 是得分残差的 \\(n×p\\) 矩阵，行由 \\(\\boldsymbol{r}_{U{i}}^{\\prime}\\) 组成，\\(i = 1,2,\\ldots,n\\)。 因此，\\(\\boldsymbol B\\) 的对角元为 \\(LD_{i}\\)。 根据线性代数的论证，与矩阵 \\(\\boldsymbol{B}\\) 最大特征值相关的 \\(n×1\\) 维特征向量的元素绝对值，在通过将每个分量除以该特征向量所有分量平方和的平方根，从而将该向量标准化为单位长度后，可以度量模型对数据集中 \\(n\\) 个观测拟合的敏感度。将该特征向量记作 \\(\\boldsymbol{l}_{\\mathrm{max}}\\)，其第 \\(i\\)个元素即为第 \\(i\\) 个观测对参数估计集影响的度量。该诊断的符号无关紧要，因此一般建议使用基于其绝对值 \\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 的图形。将 \\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 的第 \\(i\\) 个元素表示为 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\)，其中 \\(i = 1, 2,...,n\\)，这些值的索引图、关于生存时间的秩次的图形以及关于模型中的解释变量的图形，都可用于影响的评估。 标准化为单位长度意味着值 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 的平方和必为 1.0. 特征向量元素的平方在平方和总和 (1) 中占很大比例的观测将是最具影响力的观测。因此，该特征向量的较大元素将对应于对似然函数值影响最大的观测。最后要注意的一点是，与其他诊断不同，如果拟合模型正确，\\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 值关于解释变量的图形将不会具有确定的模式。这意味着 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 关于解释变量的图形可用于评估是否存在模型不能很好拟合的变量值的特定范围。 示例 4.7 (透析患者的感染) 示例 4.1 中首次给出的数据将用于阐明诊断的使用，该诊断旨在揭示影响参数估计集的观测。表 4.5 给出了近似似然位移（依据式 (4.15)）以及 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 的值。 表 4.5 对最大对数似然函数值影响最大的观测对应于患者 2 和患者 4. 对于患者 13，似然位移诊断值也相当大。这意味着从数据集中删除这三个患者中的任何一个，参数估计集都会受到最大影响。 \\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 的第四个元素 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_4\\)，其绝对值是最大的，也表明省略 4 号患者的数据对参数估计集具有最大的影响。与患者 2 和 13 对应的元素相比其他观测也较大，这表明这些患者的数据也有影响。\\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 第 2, 4 和 13 个元素的平方和为 0.70，而元素平方和的总和为 1.00，因此患者 2, 4 和 13 占 \\(|\\boldsymbol{l}_{\\mathrm{max}}|_i\\) 变异的近四分之三。注意，对示例 4.6 中的 delta-betas 的分析表明，患者 2 和 4 的观测对 Sex 的参数估计影响最大，而患者 13 的观测则对 Age 的参数估计影响更大。 总之，患者 2, 4 和 13 的观测对风险函数的形式影响最大。依次省略其一，可以得到风险函数中线性部分的估计： 省略患者 2： \\(0.031Age_{{i}}-3.530Sex_{{i}}\\) 省略患者 4： \\(0.045Age_{{i}}-3.529Sex_{{i}}\\) 省略患者 13：\\(0.011Age_{{i}}-2.234Sex_{{i}}\\) 作为比较，整个数据集的线性部分为 \\[\\begin{aligned}0.030Age_i-2.711Sex_i\\end{aligned}\\] 为了说明风险比估计的变化幅度，请考虑 50 岁患者相对于 40 岁患者在时间 \\(t\\) 感染的相对风险。对于完整数据集，这是 \\(e^{0.304} = 1.355\\)。当省略患者 2 和 4 时，该值分别增加为 1.365 和 1.564；当省略患者 13 时，该值减小为 1.114. 因此，从数据集中删除这些患者对风险函数的影响并不特别明显。 同理，在完整数据集中，男性患者 (Sex = 1) 相对于女性患者 (Sex = 2) 在时间 \\(t\\) 感染的风险为 \\(e^{2.711}\\)，即 15.041. 当依次省略观测 2, 4 和 13 时，男性相对于女性的风险比分别为 34.138, 34.097 和 9.334. 省略这三名患者中任何一个的数据都会对风险比估计产生很大影响。然而，在解释这一结果时需要谨慎。由于数据集中的男性非常少，风险比估计是不精确的。事实上，当省略患者 13 的数据时，风险比的 95% 置信区间为 0.012 到 82.96! 4.3.3 有影响观测的处理 若发现观测有强影响，很难就应该如何处理这些观测提供任何坚定的建议。这很大程度上取决于研究的科学背景。 如果可能，应检查有影响观测的来源。转录和记录分类数据和数值数据时经常出现错误。如果发现任何错误，则需要更正数据并重复分析。如果发现生存时间或其他解释变量的观测不切实际，并且无法校正，则在重新分析之前应从数据集中删除相应的观测。 在许多情况下，无法确认与有影响的观测对应的数据是否有效。当然，在这种情况下，不应直接删除有影响的观测。最恰当的做法是确定这些观测对分析得出的推断产生的实际影响。例如，如果使用中位生存时间来总结生存数据，或者使用相对风险来总结治疗效应，那么可以对比包含和不包含有影响观测的这些统计量的值。如果结果之间的差异小到没有实际意义，则可以保留存疑的观测。相反，如果删除有影响观测的影响大到具有实际意义，则需要报告基于完整数据集和简化数据集的分析结果。随后，与参与研究的科学家进行协商，其结果将是决定未来行动方向的关键要素。 示例 4.8 (多发性骨髓瘤患者的生存率) 现在研究个体观测对为示例 1.3 的数据拟合的 Cox 回归模型参数估计的影响。图 4.10 和 4.11 显示了 Hb 和 Bun 的近似非标准化 delta-betas 关于生存时间的秩次的图形。 图 4.10 图 4.11 根据图 4.10，没有一个观测的 Hb 的 delta-beta 与其他观测不同。然而，图 4.11 显示，生存时间最短的两个观测的 Bun 的 delta-beta 与其他观测差别较大。他们对应于患者 32 和 38 （在表 1.3 中给出的数据中）。 患者 32 的生存时间仅为一个月，具有 Bun 的第二大值。从数据集中删除此观测会降低 Bun 的参数估计。患者 38 在进入试验后也只生存了一个月，但 Bun 值对于生存这么短时间的其他患者来说相当低。如果省略该患者数据，则模型中 Bun 的系数会增加。 为了确定影响参数估计集的观测，图 4.12 显示了诊断 \\(\\boldsymbol{l}_{\\mathrm{max}}\\) 的元素的绝对值关于生存时间秩次的图形。 图 4.12 具有最大 \\(|\\boldsymbol{l}_{\\mathrm{max}}|\\) 的观测对应于患者 13. 对于一个生存了 65 个月之久的患者来说，该患者的 Hb 值异常低，Bun 值有点高。如果从数据集中省略该观测，Bun 的系数保持不变，但 Hb 的系数从 −0.134 减小为 −0.157. Hb 对死亡风险的影响更显著一点。但总之，患者 13 的记录对风险函数估计的形式几乎没有影响。 4.4 检验比例风险假设 到目前为止，本章我们主要讨论如何检查生存模型线性部分的充分性。使用 Cox 回归模型时做出的一个关键假设是比例风险。如果风险比与时间无关，则称风险是成比例的。如果模型中存在一个或多个解释变量的系数随时间变化，或者存在时依解释变量，则将违反比例风险假设。因此，在考虑到已知或预期独立于时间的解释变量的影响后，我们需要可用于检测特定协变量是否存在某种形式的时依性的技术。 本节首先描述了一个可在模型拟合之前使用的直观图形，然后描述了如何使用从拟合模型导出的诊断和检验统计量来考察比例风险假设。 4.4.1 对数累积风险图 在 Cox 回归模型中，第 \\(i\\) 个个体在任何时间 \\(t\\) 的死亡风险由下式给出 \\[\\begin{align} h_i(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)h_0(t) \\tag{4.17} \\end{align}\\] 其中，\\(\\boldsymbol x_i\\) 是该个体解释变量的值向量，\\(\\boldsymbol \\beta\\) 是相应的系数向量，\\(h_0(t)\\) 是基线风险函数。将该式两边关于 \\(t\\) 积分得到 \\[\\begin{aligned}\\int_0^th_i(u)\\mathrm{d}u&amp;=\\exp(\\boldsymbol{\\beta&#39;x}_i)\\int_0^th_0(u)\\mathrm{d}u\\end{aligned}\\] 因此，使用式 (1.7) \\[\\begin{aligned}H_i(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)H_0(t)\\end{aligned}\\] 其中 \\(H_i(t),H_0(t)\\) 为累积风险函数。对上式两边取对数 \\[\\begin{aligned}\\log H_{{i}}(t)=\\boldsymbol{\\beta&#39;x}_{\\boldsymbol{i}}+\\log H_{0}(t)\\end{aligned}\\] 由此可知，对数累积风险函数的差异不取决于时间。这意味着，如果绘制具有不同解释变量值的个体的对数累积风险函数关于时间的图形，则如果式 (4.17) 中的比例风险模型有效，则该曲线将是平行的。这为评估比例风险假设的有效性提供了广泛使用的诊断基础。事实证明，在参数建模中，将对数累积风险函数关于 \\(t\\) 的对数而不是 \\(t\\) 本身进行绘图是一种有用的诊断，因此通常使用这种形式的图形；有关使用该对数累积风险图形的更多详细信息，请参见第 5 章 5.2 节。 要使用此图，首先根据一个或多个因素的水平对生存数据进行分组。如果要在此分析中使用连续变量，则首先需要以某种方式对它们的值进行分组以得到分类变量。然后获得每组数据的生存函数的 Kaplan-Meier 估计。对数累积风险图，即对数累积风险函数估计关于对数生存时间的图形，如果不同组之间的风险成比例，则将产生平行曲线。该方法信息丰富。并且当因素数量较少且每个水平上的观测数量合理时易于操作。然而，对于晚期生存时间，图形基于较少观测数据，而在结构更复杂的数据集中，需要采用不同的方法。 示例 4.9 (多发性骨髓瘤患者的生存率) 我们再次使用 48 名多发性骨髓瘤患者的生存时间数据来说明对数累积风险图。具体来说，我们将研究变量 Hb （血清血红蛋白）的比例风险假设是否有效。因为这是一个连续变量，我们首先需要对 Hb 的值进行分类。这将以与第 3 章示例 3.8 中相同的方式完成，其中用 Hb 值定义四个组，\\(Hb\\leqslant7,7&lt;Hb\\leqslant10,10&lt;Hb\\leqslant13\\) 以及 \\(Hb&gt;13\\)。然后根据患者的血清血红蛋白水平对患者进行分组，并获得四组患者的生存函数的 Kaplan-Meier 估计。根据该估计，使用第 1 章式 (1.8) 中的关系式 \\(\\tilde{\\hat{H}}(t)=-\\operatorname{log}\\hat{S}(t)\\) 得到对数累积风险估计，并关于 \\(\\log t\\) 绘制图形。由此产生的对数累积风险图如图 4.13 所示。 图 4.13 该图表明 \\(Hb\\leqslant7,7&lt;Hb\\leqslant10\\) 和 \\(Hb&gt;13\\) 的图大致平行。\\(10 &lt; Hb \\leqslant 13\\) 的图与其他图不一致，但这种印象是由该组患者中生存时间最长的患者相对较大的累积风险估计造成的。该图没有考虑另一个变量 Bun 的值，第三组 Hb 中个体的生存时间可能受到其 Bun 值的影响。总体而言，几乎没有理由怀疑比例风险假设。 4.4.2 使用 Schoenfeld 残差 4.1.5 节中定义的 Schoenfeld 残差在拟合 Cox 回归模型后评估比例风险假设时特别有用。Grambsch and Therneau (1994) 表明，模型中第 \\(j(j=1,2,\\ldots,p)\\) 个解释变量第 \\(i(i=1,2,\\ldots,n)\\) 个缩放 Schoenfeld 残差 \\(r_{Sji}^{*}\\) 的期望，为 \\[\\begin{align} \\operatorname{E}\\left(r_{Sji}^*\\right)\\approx\\beta_j(t_i)-\\hat{\\beta}_j \\tag{4.18} \\end{align}\\] 其中 \\(\\beta_j(t)\\) 为 \\(X_j\\) 的时变 (time-varying) 系数，\\(\\beta_j(t_i)\\) 为该系数在第 \\(i\\) 个个体生存时间 \\(t_i\\) 的值，\\(\\hat{\\beta}_j\\) 为拟合的 Cox 回归模型中 \\({\\beta}_j\\) 的估计。请注意，这些残差仅在事件时间有定义。 式 (4.18) 表明 \\(r_{S{j}i}^{*}+\\hat{\\beta}_{j}\\) 的值（或等价的缩放 Schoenfeld 残差 \\(r_{Sji}^{*}\\)）关于观测生存时间的图形应该给出有关 \\(X_j\\) 时依系数 \\(\\beta_j(t)\\) 的形式的信息。特别的，水平线表明 \\(X_j\\) 的系数是常数，并且满足比例风险假设。可以在该图上叠加一条平滑曲线以帮助解释，如 4.2.3 节所述的鞅残差关于解释变量值的图形。 示例 4.10 (透析患者的感染) 示例 4.1 中首次给出的透析患者导管拔除时间的数据现在用于说明缩放 Schoenfeld 残差在评估非比例风险中的用途。表 4.2 给出了变量 Age 和 Sex 的缩放 Schoenfeld 残差，将这些值关于拔除时间作图得出图形 4.14. 平滑曲线与水平线的偏差很小，在这两张图中都没有任何非比例风险的迹象。 图 4.14 4.4.3 非比例风险的检验 4.4.2 节中描述的评估比例风险假设的图形方法可得到正式的检验程序。根据式 (4.18) 给出的结果，对于第 \\(j(j=1,2,\\ldots,p)\\) 个解释变量 \\(X_j\\)，第 \\(i(i=1,2,\\ldots,n)\\) 个缩放 Schoenfeld 残差的期望值取决于 \\(\\beta_{j}(t_{{i}})\\)，即 \\(X_j\\) 的时变系数在时间 \\(t_i\\) 处的值。那么，比例风险假设的检验可基于 \\(\\operatorname{E}\\left(r_{Sji}^*\\right)\\) 与某时间函数之间是否存在线性关系的检验。如果有证据表明 \\(\\operatorname{E}\\left(r_{Sji}^*\\right)\\) 是时依的，则将拒绝比例风险假设。 对于特定的解释变量 \\(X_j\\)，\\(X_j\\) 的系数对时间的线性依赖性可以通过取 \\(\\beta_j(t_i)=\\beta_j+\\nu_j(t_i-\\bar{t})\\) 来表示，其中 \\(\\nu_j\\) 是未知的回归系数。这得到了一个线性回归模型，其中 \\(\\operatorname{E}(r_{Sji}^*)=\\nu_j(t_i-\\bar{t})\\)，关于斜率 \\(\\nu_j\\) 是否为零的检验将得到关于 \\(X_j\\) 的系数是否时依的检验，因此得到风险是否关于 \\(X_j\\) 成比例的检验。令 \\(\\tau_i,\\tau_2,\\ldots,\\tau_d\\) 为数据集中所有 \\(n\\) 个个体观察到的 \\(d\\) 个死亡时间，Grambsch and Therneau (1994) 表明，适当的检验统计量为 \\[\\begin{align} \\frac{\\{\\sum_{i=1}^d(\\tau_i-\\bar{\\tau})r_{Sji}^*\\}^2}{d\\operatorname{var}(\\hat{\\beta_j})\\sum_{i=1}^d(\\tau_i-\\bar{\\tau})^2} \\tag{4.19} \\end{align}\\] 其中 \\(\\bar{\\tau}=d^{-1}\\sum_{i=1}^d\\tau_i\\) 是观测死亡时间的样本均值。在斜率为零的原假设下，该统计量服从自由度为一的卡方分布，并且式 (4.19) 的显著的大值将拒绝第 \\(j\\) 个解释变量的比例风险假设。 通过聚合式 (4.19) 中的各个检验统计量，可以获得 Cox 回归模型中包含的所有 p 个解释变量的比例风险假设的总体或全局 (overall or global) 检验。统计量 \\[\\begin{align} \\frac{(\\boldsymbol{\\tau}-\\bar{\\tau})^{\\prime}\\boldsymbol{S}\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\boldsymbol{S&#39;}(\\boldsymbol{\\tau}-\\bar{\\tau})}{\\sum_{i=1}^d(\\tau_i-\\bar{\\tau})^2/d} \\tag{4.20} \\end{align}\\] 其中 \\(\\boldsymbol{\\tau}=(\\tau_1,\\tau_2,\\ldots,\\tau_d)&#39;\\) 是由 \\(d\\) 个事件时间形成的向量，\\(\\boldsymbol S\\) 为 \\(d × p\\) 矩阵，其列是第 \\(j\\) 个解释变量的（未缩放）Schoenfeld 残差，即 \\(\\boldsymbol S\\) 的第 \\(j\\) 列为 \\((r_{Sj1},r_{Sj2},\\ldots,r_{Sjd})&#39;\\)，\\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\) 为拟合的 Cox 回归模型中解释变量系数估计的方差-协方差阵。式 (4.20) 中的检验统计量，在所有 \\(p\\) 个解释变量的比例风险假设为真时，服从自由度为 \\(p\\) 的卡方分布。该检验称为比例风险的 Grambsch and Therneau 检验，有时更神秘地称为 zph 检验。 式 (4.19) 和 (4.20) 中的检验统计量可以通过用死亡时间 \\(\\tau_i(i=1,2,\\ldots,d)\\) 的变换值替换以适应其他时间尺度。例如，使用死亡时间的对数，而不是时间本身，将允许在对数尺度上评估 \\(X_j\\) 系数的线性度。\\(\\tau_i\\) 也可以用死亡时间的秩次或在每个事件时间下生存函数的 Kaplan-Meier 估计来代替。4.4.2 节中讨论的缩放 Schoenfeld 残差关于时间的图形可能表明这些选项中哪一个是最合适的。 示例 4.11 (透析患者的感染) 我们现在使用透析患者导管移除时间的数据来说明比例风险检验。在拟合的 Cox 回归模型中，变量 Age 和 Sex 的系数估计的方差分别为 0.000688 和 1.20099，12 个事件时间的平方和为 393418.92，式 (4.19) 的分子由表 4.2 中的缩放 Schoenfeld 残差计算得出。Age 和 Sex 的检验统计量分别为 0.811 (\\(P=0.368\\)) 和 0.224 (\\(P=0.636\\)). 在这两种情况下，都没有证据反对比例风险假设，正如示例 4.10 中的图形分析所预期的那样。 需要进行矩阵乘法才能获得式 (4.20) 中比例风险全局检验的分子，这得到 26578.805，由此 Grambsch and Therneau 检验统计量为 0.811，服从自由度为二的卡方分布。\\(P\\) 值为 0.667. 同样，没有理由怀疑比例风险假设的有效性。 4.4.4 添加时依变量 可以通过向 Cox 回归模型添加时依变量来研究偏离比例风险的具体形式。第 8 章给出了在生存数据建模中使用时依变量的完整细节，但在本节中，该程序是在特定的背景中描述的。 考虑一项生存研究，将患者分配为两组，对应于标准疗法和新疗法。那么，人们的兴趣可能集中在一个治疗组在时间 \\(t\\) 时的死亡风险相对于另一组的比是否独立于生存时间。那么，研究中第 \\(i\\) 个个体的风险函数的比例风险模型是 \\[\\begin{align} h_{\\boldsymbol{i}}(t)=\\exp(\\beta_{1}x_{1{i}})h_{{0}}(t) \\tag{4.21} \\end{align}\\] 其中 \\(x_{1i}\\) 是指示变量 \\(X_1\\) 的值，该值对于标准疗法为 0 而对于新疗法为 1. 相对于标准疗法，接受新疗法的患者在任何时候的相对死亡风险为 \\(e^{\\beta _1}\\)，与生存时间无关。 现在定义一个时依解释变量 \\(X_2\\)，其中 \\(X_2=X_1t\\). 如果将该变量添加到式 (4.21) 中的模型中，则第 \\(i\\) 个个体在时间 \\(t\\) 的死亡风险变为 \\[\\begin{align} h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i})h_0(t) \\tag{4.22} \\end{align}\\] 其中 \\(x_{2{i}}=x_{1{i}}t\\) 为个体 \\(i\\) 的 \\(X_1t\\) 的值。因为在新疗法下 \\(X_2=t\\) 而在标准疗法下 \\(X_2=0\\)，则时间 \\(t\\) 处的相对风险现在为 \\[\\begin{align} \\exp(\\beta_1+\\beta_2t) \\tag{4.23} \\end{align}\\] 该风险比取决于 \\(t\\)，并且式 (4.22) 中的模型不再是比例风险模型。具体来说，如果 \\(\\beta_2&lt;0\\)，相对风险会随着时间的推移而降低。这意味着，相对于标准疗法，新疗法的死亡风险会随着时间的推移而降低。如果 \\(\\beta_1&lt;0\\)，随着时间的推移，新疗法的优越性变得更加明显。另一方面，如果 \\(\\beta_2&gt;0\\)，新疗法死亡的相对风险随着时间的增加而增加，反映出新疗法的死亡风险相对于标准疗法是增加的。在 \\(\\beta_2=0\\) 的特殊情况下，相对风险为恒定的 \\(e^{\\beta_1}\\)。这意味着对假设 \\(\\beta_2=0\\) 的检验是对比例风险假设的检验。这种情况如图 4.15 所示。 图 4.15 为帮助计算和解释式 (4.22) 模型的参数，可根据与某个时间 \\(t_0\\) 的偏差来定义变量 \\(X_2\\)。那么，\\(\\beta_1\\) 和 \\(\\beta_2\\) 的估计往往不那么高度相关，并且最大化适当似然函数的数值算法将更加稳定。如果将 \\(X_2\\) 取为 \\(X_2=X_1(t−t_0)\\)，则对于新疗法，\\(X_2=t-t_0\\)，对于标准疗法，\\(X_2=0\\)。相对风险现在变成 \\[\\begin{aligned}\\exp\\{\\beta_1+\\beta_2(t-t_0)\\}\\end{aligned}\\] 在式 (4.22) 的模型中，当 \\(x_{2i}=x_{1i}(t−t-0)\\) 时，量 \\(e^{\\beta_1}\\) 是在时间 \\(t_0\\) 时，接受新疗法的个体相对于接受标准疗法的个体的死亡风险。在实际应用中，通常会对 \\(t_0\\) 的值进行选择，以便为相对风险适用的时间提供一个方便的解释。例如，将 \\(t_0\\) 取为平均或中位生存时间意味着 \\(\\exp(\\hat{\\beta}_1)\\) 是此时的相对死亡风险估计。 可以使用类似的模型来检测连续变量的系数是否具有时依系数。假设 \\(X\\) 是这样一个变量，我们希望检查是否有任何证据表明 \\(X\\) 的系数与时间线性相关。为此，将项 \\(Xt\\) 添加到包含 \\(X\\) 的模型中。第 \\(i\\) 个个体在时间 \\(t\\) 的死亡风险为 \\[\\begin{aligned}h_i(t)=\\exp(\\beta_1x_i+\\beta_2x_it)h_0(t)\\end{aligned}\\] 其中 \\(x_i\\) 是该个体的 \\(X\\) 值。\\(X = x_i + 1\\) 的个体相对于 \\(X = x_i\\) 的个体，在时间 \\(t\\) 的死亡风险为 \\(\\exp(\\beta_1+\\beta_2t)\\)，如式 (4.23) 所示。 本节中考虑的时依变量具有与时间线性相关的系数。当系数是时间的非线性函数时，也可以使用类似的方法。例如，在式 (4.22) 中使用的时依变量 \\(X_2\\) 的定义中，可以使用 \\(\\log t\\) 代替 \\(t\\)。在这个模型版本中，对假设 \\(\\beta_2 = 0\\) 的检验是对比例风险的检验，其中备择假设是风险比依赖时间的对数。当生存时间的数值很大时，例如当长期研究中的生存以天为单位时，在时依变量的定义中使用 \\(\\log t\\) 也很有帮助。然后，可能存在与计算式 (4.22) 中 \\(\\exp(\\beta_2x_{2{i}})\\) 的值相关的计算问题，这些问题可以通过在 \\(X_2\\) 的定义中使用 \\(\\log t\\) 代替 \\(t\\) 来解决。 在包含时依变量 \\(X_2\\) 的模型的拟合中，不能将 \\(X_2\\) 以与其他解释变量相同的方式进行处理 。其原因是，该变量在不同的死亡时间具有不同的值，使得式 (3.4) 中偏似然函数分母的计算更加复杂。关于拟合过程的全部细节将推迟到第 8 章。然而，关于时依变量对风险函数影响的推断可以像其他变量一样进行评估。具体来说，可以将 \\(-2\\log\\hat{L}\\) 统计量的变化与卡方分布的百分位点进行比较，以检验变量的显著性。因此，这是对比例风险的正式检验。 示例 4.12 (透析患者的感染) 现在利用示例 4.10 和 4.11 中使用的导管拔除时间数据以说明如何使用时依变量来检验比例风险假设。 我们首先拟合仅包含 Age 和 Sex 的 Cox 回归模型，得到 \\(-2\\log\\hat{L}\\) 的值为 34.468. 我们现在定义这些变量与时间的乘积，即 \\(Tage=Age\\times t\\) 和 \\(Tsex=Sex\\times t\\)。然后将这些变量添加到模型中。请注意，我们不能简单地根据患者生存时间来形成这些乘积，因为模型拟合过程需要针对不同的\\(t\\) 值来计算这些值；详见第 8 章。 当变量 Tage 添加到包含 Age 和 Sex 的模型中时，\\(-2\\log\\hat{L}\\) 的值减小为 32.006，但在 5% 的水平上这种减小并不显著（\\(P=0.117\\)）。 当将 Tsex 添加到包含 Age 和 Sex 的模型中时，\\(-2\\log\\hat{L}\\) 的减小仅为 0.364（\\(P=0.546\\)）。这一分析证实，没有理由怀疑 Age 和 Sex 变量的比例风险假设。 4.5 建议 本章介绍了各种诊断方法。哪些应作为常规使用，而哪些在需在对模型充分性进行更全面的评估时使用呢？ 在评估模型的整体拟合度方面，偏差残差关于风险评分的图形提供了模型未很好拟合的观测的信息，以及它们与解释变量值集的关系。该诊断通常比 Cox-Snell 残差的累积或对数累积风险图提供更多信息。残差关于生存时间、生存时间的秩次或解释变量的图形也可能有用。 残差图可辅以影响诊断。当从模型中得出的推断集中于一个或两个特定参数时，这些参数的 delta-beta 统计量将是最有意义的。那么，绘制这些值关于生存时间的秩次的图形会很有用。为了研究是否有观测对参数估计集或风险评分有影响，基于 \\(\\boldsymbol{l}_{\\mathrm{max}}\\) 元素绝对值的诊断可能是最合适的。绘制这些值关于生存时间的秩次的图形将是有意义的，但关于特定解释变量的图形也可能具有启发性。可以通过对数累积风险图对比例风险假设的有效性进行初步评估。然而，基于标准化 Schoenfeld 残差的图形以及与之相关的非比例的检验更有帮助。Grambsch and Therneau 检验可用于比例风险假设的总体检验。 一旦确定了合适的模型，并从模型检查过程中获得了令人满意的结果，模型构建过程的最后阶段就是与主题专家一起批判性地审查模型。这可能会导致对模型的进一步修订，以确保它可作为生存数据的适当总结。 4.6 延伸阅读 Draper and Smith (1998) 以及 Montgomery, Peck and Vining (2021) 包含了线性模型中模型检查的一般介绍。Cook and Weisberg (1982) 对许多情况下的残差和影响诊断的理论进行了更详细的说明。Atkinson (1985) 从实际角度描述了线性模型中的模型检查，McCullagh and Nelder (1989) 以及 Aitkin et al. (1989) 在广义线性模型的背景下讨论了这个主题。 许多致力于生存数据分析的教科书，例如 Cox and Oakes (1984), Hosmer, Lemeshow and May (2008), Lawless (2002) 以及 Kalbfleisch and Prentice (2002) 的教科书，都包含有关残差使用的章节。Hinkley, Reid and Snell (1991) 以及 Hastie and Tibshirani (1990) 还简要讨论了评估符合生存数据的模型的充分性的方法。 关于残差在检验生存模型的充分性方面的早期文章包括 Kay (1977), Crowley and Hu (1977). 这些论文包括对 Cox-Snell 残差的讨论，这是基于 Cox and Snell (1968) 给出的残差的一般定义. Crowley and Storer (1983) 根据经验表明，残差的累积风险图在识别拟合模型的不充分方面不是特别好。另见Crowley and Storer (1983) 以了解这些方法的实际应用。Kay (1984) and Day (1985) 在 20 世纪 80 年代中期对生存分析中的诊断程序进行了回顾。 Barlow and Prentice (1988) 提出了鞅残差。Lagakos (1981) 提出了基本相同的残差，Therneau, Grambsch and Fleming (1990) 以及 Henderson and Milner (1991) 讨论了它们的使用。Therneau, Grambsch and Fleming (1990) 也引入了偏差残差。Cox 模型的 Schoenfeld 残差是由 Schoenfield (1982) 提出的。在基于计数过程理论的生存分析中，Fleming and Harrington (2005) 以及 Therneau and Grambsch (2000) 展示了如何使用不同类型的残差，并给出了详细的实例。Nardiand Schemper (1999) 引入的另外两种残差特别适用于检测异常生存时间。 许多作者已经研究了 Cox 回归模型的影响诊断，但主要的论文有 Cain and Lange (1984), Reid and Crépeau (1985), Storer and Crowley (1985), Pettitt and Bin Daud (1989) 以及 Weissfeld (1990) 。Pettitt and Bin Daud (1990) 展示了如何通过平滑 Schoenfeld 残差来检验 Cox 比例风险模型中的时依性。LOWESS 平滑器由 Cleveland (1979) 引入。 Cox (1979) 和 Arjas (1988) 提出了一些本章未提及的其他评估生存模型的方法。Gray (1990) 描述了在评估 Cox 模型的拟合时使用累积风险函数的平滑估计。Lin, Wei and Ying (2003) 描述了基于鞅残差的累积和，这是用于检验 Cox 回归模型充分性的图形和数值方法。 本章介绍的大多数诊断程序都依赖于对特定统计量的表格或图形表示的非正式评估。除了这些程序之外，还有可用于评估模型的拟合优度的各种显著性检验。实例包括 Schoenfeld (1980), Andersen (1982), Nagelkerke, Oosting and Hart (1984), Ciampi and Etezadi Amoli (1985), Moreau, O’Quigley and Mesbah (1985), Gill and Schumacher (1987), O’Quigley and Pesione (1989), Quantin et al. (1996), Grønnesby and Borgan (1996) 以及 Verweij, van Houwelingen and Stijnen (1998) 的方法。Lin and Wei (1991) 以及 Quantin et al. (1996) 对 Cox 回归模型的一些拟合优度检验进行了综述。这些检验中的许多都涉及相当复杂的统计量，而且这些程序在用于生存分析的计算机软件中并不广泛。May and Hosmer (1998) 提出了一种更简单的方法来评估模型的整体拟合。 "],["chap5.html", "第 5 章 参数回归模型 5.1 风险函数的模型 5.2 评估参数模型的适用性 5.3 为单样本拟合参数模型 5.4 拟合指数和 Weibull 模型 5.5 用于两组比较的 Weibull 模型 5.6 Weibull 比例风险模型 5.7 比较替代的 Weibull 比例风险模型 5.8 Gompertz 比例风险模型 5.9 模型选择", " 第 5 章 参数回归模型 当 Cox 回归模型用于生存数据分析时，不需要假设生存时间特定形式的概率分布。因此，风险函数不局限于特定的函数形式，该模型具有灵活性和广泛的适用性。另一方面，如果特定概率分布的假设对于数据是有效的，基于这种假设的推断将更加精确。具体来说，相对风险和中位生存时间等量的估计往往比没有分布假设的情况下具有更小的标准误。假设生存时间具有特定概率分布的模型称为参数模型 (parametric models)，是本章的主题。 在生存数据分析中起核心作用的概率分布是 Weibull 分布，由 W. Weibull 于 1951 年在工业可靠性测试中引入。事实上，就像正态分布在线性模型中的核心地位一样，Weibull 分布是生存数据参数分析的核心。因此，5.5 节至 5.7 节对基于 Weibull 分布的模型进行了详细讨论。 尽管比例风险模型在生存数据分析中具有广泛的应用，但能与该模型一起使用的生存时间概率分布却相对较少。此外，现有的分布，主要是 Weibull 分布和 Gompertz 分布，会导致风险函数随着时间的推移而增加或减少。一个涵盖更广泛生存时间分布的模型是加速失效时间模型 (accelerated failure time model)，这在 5.10 节至 5.13 节中描述。在比例风险假设不成立的情况下，基于该系列的模型可能是富有成效的。同样，加速失效时间模型中的生存时间分布可以采用 Weibull 分布，也可以使用其他一些概率分布。因此，本章首先对可能用于参数模型的生存数据分布进行简要概述。另一个生存模型系列，称为比例几率模型 (proportional odds model)，在某些情况下可能很有用。该模型在 5.15 节中描述。 5.1 风险函数的模型 一旦根据概率密度函数指定了生存时间分布的模型，就可以从以下关系式中获得相应的生存函数和风险函数 \\[\\begin{aligned}S(t)&amp;=1-\\int_0^tf(u)\\mathrm{d}u\\end{aligned}\\] 以及 \\[\\begin{aligned}h(t)=\\frac{f(t)}{S(t)}=-\\frac{\\mathrm{d}}{\\mathrm{d}t}\\{\\log S(t)\\}\\end{aligned}\\] 其中 \\(f(t)\\) 是生存时间的概率密度函数。这些关系在 1.4 节推导过。另一种方法是为风险函数指定一种函数形式，然后可根据以下式子确定生存函数和概率密度函数 \\[\\begin{align} S(t)=\\exp\\left\\{-H(t)\\right\\} \\tag{5.1} \\end{align}\\] 以及 \\[\\begin{aligned}f(t)=h(t)S(t)=-\\frac{\\mathrm{d}S(t)}{\\mathrm{d}t}\\end{aligned}\\] 其中 \\[\\begin{aligned}H(t)&amp;=\\int_0^th(u)\\mathrm{d}u\\end{aligned}\\] 为累积风险函数。 5.1.1 指数分布 风险函数最简单的模型是假设它随着时间的推移保持不变。因此，无论经过多长时间，研究开始后任何时间的死亡风险都是相同的。在该模型下，风险函数可写为 \\[\\begin{aligned}h(t)=\\lambda\\end{aligned}\\] 其中 \\(0\\le t&lt;\\infty\\)。参数 \\(\\lambda\\) 是一个正的常数，可以通过为观测生存数据拟合模型来估计。由式 (5.1) 可知，相应的生存函数为 \\[\\begin{align} S(t)&amp;=\\exp\\left\\{-\\int_0^t\\lambda\\mathrm{d}u\\right\\}\\\\ &amp;=e^{-\\lambda t} \\tag{5.2} \\end{align}\\] 因此生存时间隐含的概率密度函数是 \\[\\begin{align} f(t)=\\lambda e^{-\\lambda t} \\tag{5.3} \\end{align}\\] 其中 \\(0\\le t&lt;\\infty\\)。这是均值为 \\(\\lambda^{-1}\\) 的指数分布随机变量 \\(T\\) 的概率密度函数。有时可以方便地写成 \\(\\mu = \\lambda^{-1}\\)，从而风险函数为 \\(\\mu^{−1}\\)，生存时间分布的均值为 \\(\\mu\\)。然而，本书通常会使用前一个风险函数指定。 指数分布的中位数 \\(t(50)\\) 满足 \\(S\\{t(50)\\}＝0.5\\)，即 \\[\\exp\\{-\\lambda t(50)\\}=0.5\\] 从而 \\[\\begin{aligned}t(50)=\\frac1\\lambda\\log2\\end{aligned}\\] 更一般地说，生存时间分布的第 \\(p\\) 个百分位数是值 \\(t(p)\\)，满足 \\(S\\{t(p)\\}=1−(p/100)\\)，使用式 (5.2)，这是 \\[\\begin{aligned}t(p)&amp;=\\frac{1}{\\lambda}\\log\\left(\\frac{100}{100-p}\\right)\\end{aligned}\\] 图 5.1 给出了三个 \\(\\lambda\\) 值（即 1.0, 0.1 和 0.01）的风险函数图，相应的概率密度函数如图 5.2 所示。对于这些 \\(\\lambda\\) 值，相应指数分布的均值分别为 1, 10 和 100，中位生存时间分别为 0.69, 6.93 和69.31. 图 5.1 图 5.2 ### Weibull 分布 {#sec5-1-2} 在实践中，恒定风险函数的假设（或等价的，指数分布生存时间的假设）很少是成立的。风险函数的一种更通用的形式是 \\[\\begin{align} h(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1} \\tag{5.4} \\end{align}\\] 其中 \\(0\\le t&lt;\\infty\\)，这是一个具有双参数 \\(\\lambda,\\gamma\\) 的函数，参数均大于零。在 \\(\\gamma=1\\) 的特殊情况下，风险函数取恒定值 \\(\\lambda\\)，生存时间呈指数分布。对于 \\(\\gamma\\) 的其他值，风险函数单调增加或减少，即不改变方向。风险函数的形状主要取决于 \\(\\gamma\\) 的值，因此 \\(\\gamma\\) 被称为形状参数 (shape parameter)，而参数 \\(\\lambda\\) 是一个尺度参数 (scale parameter). 图 5.3 展示了不同 \\(\\gamma\\) 值的风险函数。 图 5.3 对于这种特定的风险函数，生存函数由下式给出 \\[\\begin{align} S(t)=\\exp\\left\\{-\\int_0^t\\lambda\\gamma u^{\\gamma-1}\\mathrm{d}u\\right\\}=\\exp(-\\lambda t^\\gamma) \\tag{5.5} \\end{align}\\] 相应的概率密度函数为 \\[\\begin{aligned}f(t)=\\lambda\\gamma t^{\\gamma-1}\\exp(-\\lambda t^{\\gamma})\\end{aligned}\\] 其中 \\(0\\le t&lt;\\infty\\)，这是尺度参数为 \\(\\lambda\\)、形状参数为 \\(\\gamma\\) 的 Weibull 分布随机变量的密度。该分布表示为 \\(W(\\lambda, \\gamma)\\)。该分布的右尾比左尾长，因此该分布呈正偏态。 服从 \\(W(\\lambda, \\gamma)\\) 分布的随机变量 \\(T\\) 的均值或期望为 \\[\\begin{aligned}\\operatorname{E}\\left(T\\right)=\\lambda^{-1/\\gamma}\\Gamma(\\gamma^{-1}+1)\\end{aligned}\\] 其中 \\(\\Gamma(c)\\) 是由如下积分定义的 gamma 函数 \\[\\begin{align} \\Gamma(x)&amp;=\\int_0^\\infty u^{x-1}e^{-u}\\mathrm{d}u \\tag{5.6} \\end{align}\\] 该积分的值为 \\((x-1)!\\)，因此对于 \\(x\\) 的整数值，该积分易于计算。该函数也为 \\(x\\) 的非整数值有定义，可在许多软件包中计算。 由于 Weibull 分布是偏态的，因此对分布位置的更合适且更容易处理的总结是中位生存时间。这是值 \\(t(50)\\)，满足 \\(S\\{t(50)\\} = 0.5\\)，即 \\[\\exp\\left\\{-\\lambda[t(50)]^{\\gamma}\\right\\}=0.5\\] 以及 \\[t(50)=\\left\\{\\frac{1}{\\lambda}\\log2\\right\\}^{1/\\gamma}\\] 更一般地，Weibull 分布第 \\(p\\) 个百分位 \\(t(p)\\) 满足 \\[\\begin{align} t(p)=\\left\\{\\frac{1}{\\lambda}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\gamma} \\tag{5.7} \\end{align}\\] 因此，Weibull 分布的中位数和其他百分位数比分布的均值更容易计算。 中位数为 20、形状参数 \\(\\gamma = 0.5, 1.5\\) 和 \\(3.0\\) 的 Weibull 分布的风险函数和相应概率密度函数分别如图 5.4 和 5.5 所示。这三个 Weibull 分布的尺度参数 \\(\\lambda\\) 的相应值分别为 0.15, 0.0078 和 0.000087. 图 5.4 图 5.5 由于 Weibull 风险函数可以根据形状参数 \\(\\gamma\\) 采取多种形式，并且可以轻松获得适当的总结总统计量，因此该分布广泛应用于生存数据的参数分析。 5.1.2 log-logistic 分布 Weibull 风险函数的一个局限性为：它是时间的单调函数。但是，可能会出现风险函数改变方向的情况。例如，心脏移植后，患者在移植后的头十天左右，在身体适应新器官的同时，死亡风险越来越大的。随着患者的康复，这种风险会随着时间的推移而减小。在这种情况下，单峰 (unimodal) 风险函数可能是合适的。 单峰风险的一种特殊形式是函数 \\[\\begin{align} h(t)=\\frac{e^\\theta\\kappa t^{\\kappa-1}}{1+e^\\theta t^\\kappa} \\tag{5.8} \\end{align}\\] 其中 \\(0\\leqslant t&lt;\\infty,\\kappa&gt;0\\)。若 \\(\\kappa&gt;1\\)，风险函数单调递减，但若 \\(\\kappa\\le1\\)，风险是单峰的。对应于式 (5.8) 风险函数的生存函数由下式给出 \\[\\begin{align} S(t)=\\left\\{1+e^\\theta t^\\kappa\\right\\}^{-1} \\tag{5.9} \\end{align}\\] 概率密度函数为 \\[\\begin{aligned}f(t)&amp;=\\frac{e^\\theta\\kappa t^{\\kappa-1}}{(1+e^\\theta t^\\kappa)^2}\\end{aligned}\\] 这是 log-logistic 分布随机变量 \\(T\\) 的密度，参数为 \\(\\theta,\\kappa\\)。该分布之所以如此称，是因为变量 \\(\\log T\\) 服从 logistic 分布，这是一种对称分布，其概率密度函数与正态分布的概率密度函数非常相似。 log-logistic 分布的第 \\(p\\) 个百分位数为 \\[t(p)=\\left(\\frac{pe^{-\\theta}}{100-p}\\right)^{1/\\kappa}\\] 所以分布的中位数为 \\[\\begin{aligned}t(50)=e^{\\large-\\theta/\\kappa}\\end{aligned}\\] 中位数为 20 且 \\(\\kappa=0.5, 2.0\\) 和 \\(5.0\\) 的 log-logistic 分布的风险函数如图 5.6 所示。这些分布对应的 \\(θ\\) 值分别为 −1.5, −6.0 和 −15.0. 图 5.6 ### log-normal 分布 {#sec5-1-4} log-normal 分布对应的随机变量也取正值，因此可以用作生存数据的模型。如果 \\(\\log T\\) 服从均值为 \\(\\mu\\)、方差为 \\(\\sigma^2\\) 的正态分布，则称随机变量 \\(T\\) 服从参数为 \\(\\mu\\) 和 \\(\\sigma\\) 的 log-normal 分布。\\(T\\) 的概率密度函数由下式给出 \\[\\begin{aligned}f(t)=\\frac{1}{\\sigma\\surd(2\\pi)}t^{-1}\\exp\\left\\{-(\\log t-\\mu)^2/2\\sigma^2\\right\\}\\end{aligned}\\] 其中 \\(0\\leqslant t&lt;\\infty,\\sigma&gt;0\\)，从中可以得到生存函数和风险函数。log-normal 分布的生存函数为 \\[\\begin{align} S(t)=1-\\Phi\\left(\\frac{\\log t-\\mu}\\sigma\\right) \\tag{5.10} \\end{align}\\] 其中 \\(\\Phi(\\cdot)\\) 为标准正态分布函数，由下式给出 \\[\\begin{aligned}\\Phi(z)&amp;=\\frac{1}{\\surd(2\\pi)}\\int_{-\\infty}^{z}\\exp\\left(-u^2/2\\right)\\mathrm{d}u\\end{aligned}\\] 该分布的第 \\(p\\) 个百分位数为 \\[t(p)=\\exp\\left\\{\\sigma\\Phi^{-1}(p/100)+\\mu\\right\\}\\] 其中 \\(\\Phi^{-1}(p/100)\\) 为标准正态分布的第 \\(p\\) 个百分位数，有时也称为 \\(p/100\\) 的 probit. 特别是，在这种分布下的中位生存时间简单地为 \\(t(50)=e^{\\mu}\\)。 风险函数可以根据关系式 \\(h(t)=f(t)/S(t)\\) 得到。当 \\(t=0\\) 时，此函数为 0，在 \\(t\\) 趋于无穷大的过程中，该函数增大到最大值，然后减小为 0. 生存函数和风险函数只能用积分表示，这一事实限制了该模型的实用性。此外，考虑到正态分布和 logistic 分布的相似性，log-normal 模型往往与 log-logistic 模型非常相似。 5.1.3 Gompertz 分布 Gompertz 分布由 Gompertz 作为人类死亡率的模型于 1825 年引入，现在用于人口学和生物科学。该分布的风险函数由下式给出 \\[h(t)=\\lambda e^{\\theta t}\\] 其中 \\(0\\leqslant t&lt;\\infty\\) 以及 \\(\\lambda&gt;0\\)。在 \\(\\theta = 0\\) 的特殊情况下，风险函数具有恒定值 \\(\\lambda\\)，并且生存时间服从指数分布。参数 \\(\\theta\\) 决定了风险函数的形状，正值导致风险函数随时间递增。风险函数也可以表示为 \\(h(t)=\\exp(\\alpha+\\theta t)\\)，这表明其对数风险函数关于 \\(t\\) 是线性的。另一方面，根据式 (5.4) ，Weibull 对数风险函数关于 \\(\\log t\\) 呈线性。与 Weibull 风险函数类似，Gompertz 风险函数单调增加或减少。 Gompertz 分布的生存函数由下式给出 \\[S(t)=\\exp\\left\\{\\frac{\\lambda}{\\theta}(1-e^{\\theta t})\\right\\}\\] 相应的密度函数为 \\[f(t)=\\lambda e^{\\theta t}\\exp\\left\\{\\frac\\lambda\\theta(1-e^{\\theta t})\\right\\}\\] 第 \\(p\\) 个百分位数满足 \\[\\begin{aligned}t(p)=\\frac{1}{\\theta}\\log\\left\\{1-\\frac{\\theta}{\\lambda}\\log\\left(\\frac{100-p}{100}\\right)\\right\\}\\end{aligned}\\] 中位生存时间为 \\[\\begin{aligned}t(50)=\\frac{1}{\\theta}\\log\\left\\{1+\\frac{\\theta}{\\lambda}\\log2\\right\\}\\end{aligned}\\] 图 5.7 显示了中位数为 \\(20\\) 且 \\(\\theta = −0.2, 0.02\\) 和 \\(0.05\\) 的分布的 Gompertz 风险函数图。对应的 \\(\\lambda\\) 值为 0.141, 0.028 和 0.020. 图 5.7 ### gamma 分布 {#sec5-1-6} 均值为 \\(\\rho/\\lambda\\) 且方差为 \\(\\rho/\\lambda^2\\) 的 gamma 分布的概率密度函数为 \\[\\begin{align} f(t)=\\frac{\\lambda^\\rho t^{\\rho-1}e^{-\\lambda t}}{\\Gamma(\\rho)} \\tag{5.11} \\end{align}\\] 其中 \\(0\\leqslant t&lt;\\infty,\\lambda&gt;0\\) 以及 \\(\\rho&gt;0\\)。如同 log-normal 分布，gamma 分布的生存函数只能表示为积分，写作 \\[S(t)=1-\\Gamma_{\\lambda t}(\\rho)\\] 其中 \\(\\Gamma_{\\lambda t}(\\rho)\\) 为不完全 gamma 函数，由下式给出 \\[\\begin{aligned}\\Gamma_{\\lambda t}(\\rho)&amp;=\\frac{1}{\\Gamma(\\rho)}\\int_{0}^{\\lambda t}u^{\\rho-1}e^{-u}\\mathrm{d}u\\end{aligned}\\] gamma 分布的风险函数为 \\(h(t) = f(t)/S(t)\\)。如果 \\(\\rho &gt; 1\\)，则该风险函数单调增加；如果 \\(ρ &lt; 1\\)，则该风险函数单调减少，并且当 \\(t\\) 趋于 \\(\\infty\\) 时趋于 \\(\\lambda\\)。 当 \\(\\rho = 1\\) 时，gamma 分布简化为 5.1.1 节中描述的指数分布，因此该分布与 Weibull 分布一样，都以指数分布为特例。事实上，gamma 分布与 Weibull 分布非常相似，并且基于模型的推断通常非常相似。 gamma 分布的推广实际上比 gamma 分布本身更有用，因为它以 Weibull 和 log-normal 分布为特例。因此，这样的模型称为广义 gamma 分布，可用于区分生存数据的替代参数模型。 广义 gamma 分布的概率密度函数是式 (5.11) 中 gamma 密度的扩展，包括一个额外参数 \\(\\theta&gt;0\\)，定义为 \\[\\begin{aligned}f(t)=\\frac{\\theta\\lambda^{\\rho\\theta}t^{\\rho\\theta-1}\\exp\\{-(\\lambda t)^\\theta\\}}{\\Gamma(\\rho)}\\end{aligned}\\] 其中 \\(0\\leqslant t&lt;\\infty\\)。该分布的生存函数也由不完全 gamma 函数定义，并由下式给出 \\[\\begin{aligned}S(t)=1-\\Gamma_{(\\lambda t)^\\theta}(\\rho)\\end{aligned}\\] 然后根据 \\(h(t)=f(t)/S(t)\\) 得到风险函数。这种分布导致风险函数的形状范围很广，由形状参数 \\(\\theta\\) 决定。当 \\(\\rho=1\\) 时，分布变为 Weibull；当 \\(\\theta=1\\) 时，为 gamma；当 \\(\\rho\\rightarrow\\infty\\) 时成为 lognormal。 5.1.4 逆高斯分布 逆高斯分布 (inverse gaussian distribution) 是一个灵活的模型，具有一些重要的理论性质。具有均值 \\(\\mu\\) 和尺度参数 \\(\\lambda\\) 的分布的概率密度函数由下式给出 \\[\\begin{aligned}f(t)=\\left(\\frac{\\lambda}{2\\pi t^3}\\right)^{\\frac{1}{2}}\\exp\\left\\{\\frac{\\lambda(t-\\mu^2)}{2\\mu^2t}\\right\\}\\end{aligned}\\] 其中 \\(0\\leqslant t&lt;\\infty\\) 以及 \\(\\lambda&gt;0\\)。相应的生存函数为 \\[\\begin{aligned}S(t)=\\Phi\\left\\{\\left(1-t\\mu^{-1}\\right)\\surd\\left(\\lambda t^{-1}\\right)\\right\\}-\\exp(2\\lambda/\\mu)\\Phi\\left\\{-\\left(1+t\\mu^{-1}\\right)\\surd\\left(\\lambda t^{-1}\\right)\\right\\}\\end{aligned}\\] 然后根据 \\(h(t)=f(t)/S(t)\\) 得到风险函数。然而，如此复杂的生存函数形式使这种分布难以处理。 5.1.5 一些其他的分布 尽管已详细考虑了生存数据的许多分布，但还有其他分布在特定情况下可能有用。 当死亡风险预计在短期内随着时间的推移而增加或减少，然后变为常数时，服从一般指数曲线 (general exponential curve) 或 Mitscherlich 曲线的风险函数可能是合适的。那么我们将风险函数设为 \\[\\begin{aligned}h(t)=\\theta-\\beta e^{-\\gamma t}\\end{aligned}\\] 其中 \\(\\theta&gt;0,\\beta&gt;0\\) 以及 \\(\\gamma&gt;0\\)。这本质上是 5.1.3 节中定义的 Gompertz 风险函数，但带有一个额外常数。该函数的总体形状如图 5.8 所示。当 \\(t=0\\) 时，该函数的值为 \\(\\theta-\\beta\\)，并递增至接近 \\(\\theta\\) 的水平渐近线。类似地，函数 \\[\\begin{aligned}h(t)=\\theta+\\beta e^{-\\gamma t}\\end{aligned}\\] 其中 \\(\\theta&gt;0,\\beta&gt;0\\) 以及 \\(\\gamma&gt;0\\) 可用于为这样的风险进行建模：从 \\(\\theta + \\beta\\) 递减至接近 \\(\\theta\\) 的水平渐近线。 图 5.8 使用式 (1.6) 可以求出相应的生存函数，由此可以得到概率密度函数。与该风险函数指定相对应的概率分布称为 Gompertz-Makeham 分布。 为了对关于最小值对称地先减少后增加的风险函数进行建模，二次风险函数可能是合适的。因此，如果对于下式，\\(\\theta,\\beta\\) 和 \\(\\gamma\\) 给出了所需的风险形状 \\[\\begin{aligned}h(t)=\\theta+\\beta t+\\gamma t^2\\end{aligned}\\] 并确保 \\(h(t)\\ge 0\\)，可以获得生存函数和概率密度函数的显式表达。 另一种形式的风险函数是“浴缸” (bathtub) 风险，它会先减小到一个最小值，然后再增加。模型 \\[\\begin{aligned}h(t)&amp;=\\alpha t+\\frac{\\beta}{1+\\gamma t}\\end{aligned}\\] 提供了这种形式的风险的直接表达，并且可以找到生存函数和密度函数的相应表达式。 5.2 评估参数模型的适用性 在根据假设的风险函数参数形式拟合模型之前，应对该假设的有效性进行初步研究。一种方法是使用 2.3 节中概述的方法来估计风险函数。如果风险函数随着时间的推移是较为恒定的，这将表明指数分布可能是数据的合适模型。另一方面，如果风险函数随着生存时间的增加而单调增加或减少，则表明应使用基于 Weibull 分布的模型。 评估生存时间的特定分布是否合理的一种富有信息的方法是将数据的生存函数与所选模型的生存函数进行比较。如果假设的模型是合适的，通过转换生存函数将产生一条直线图形。 假设有单个生存数据样本，并且考虑了生存时间的 Weibull 分布。由于具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布的生存函数为 \\[\\begin{aligned}S(t)=\\exp\\left\\{-\\lambda t^{\\gamma}\\right\\}\\end{aligned}\\] 取其对数，乘以负一，然后再取对数，得到 \\[\\begin{align} \\log\\left\\{-\\log S(t)\\right\\}=\\log\\lambda+\\gamma\\log t \\tag{5.12} \\end{align}\\] 现在，我们用生存函数的 Kaplan-Meier 估计 \\(\\hat S(t)\\) 代替式 (5.12) 中的 \\(S(t)\\)。如果 Weibull 假设成立，则 \\(\\hat S(t)\\) 将“接近” \\(S(t)\\)，并且 \\(\\log\\{-\\log\\hat{S}(t)\\}\\) 关于 \\(\\log t\\) 的图形将给出一条近似的直线。根据式 (1.8)，累积风险函数 \\(H(t)=− \\log S(t)\\)，因此 \\(\\log\\{-\\log S(t)\\}\\) 是对数累积风险。\\(\\log\\{-\\log\\hat{S}(t)\\}\\) 关于 \\(\\log t\\) 的图形是对数累积风险图，这在第 4 章 4.4.1 节介绍过。 示例 5.1 (停用宫内节育器的时间) 在示例 2.3 中，获得了关于停用宫内节育器时间数据的生存函数的 Kaplan-Meier 估计 \\(\\hat S(t)\\)。这些数据的对数累积风险图，即 \\(\\log\\{-\\log\\hat{S}(t)\\}\\) 关于 \\(\\log t\\) 的图，如图 5.9 所示。 图 5.9 该图表明对数累积风险与 \\(\\log t\\) 之间存在直线关系，证实 Weibull 分布是停用时间的合适模型。从图中可以看出，直线的截距约为 -6.0，斜率约为 1.25. 因此， Weibull 分布参数的近似估计为 \\(\\lambda^* = \\exp(−6.0) = 0.002\\) 和 \\(\\gamma^* = 1.25\\). Weibull 分布形状参数 \\(\\gamma\\) 的估计非常接近于 1，这表明停用时间可以使用指数分布建模。 可用类似的程序评估 log-logistic 分布的适用性，使用生存函数的变换来生成直线图。根据式 (5.9)，生存超过时间 \\(t\\) 的几率 (odds) 为 \\[\\begin{aligned}\\frac{S(t)}{1-S(t)}&amp;=e^{-\\theta}t^{-\\kappa}\\end{aligned}\\] 因此生存超过 \\(t\\) 的对数几率 (log-odds) 可以表示为 \\[\\begin{aligned}\\log\\left\\{\\frac{S(t)}{1-S(t)}\\right\\}&amp;=-\\theta-\\kappa\\log t\\end{aligned}\\] 如果使用 Kaplan-Meier 估计来估计数据的生存函数，并绘制生存超过 \\(t\\) 的对数几率关于 \\(\\log t\\) 的图形，如果生存时间的 log-logistic 模型合适，将获得直线图。log-logistic 分布的参数 \\(\\theta\\) 和 \\(\\kappa\\) 的估计可以从直线图的截距和斜率获得。 其他参数模型的适用性可以按照类似的思路进行研究。例如，根据式 (5.10) 给出的 log-normal 分布的生存函数， \\[\\begin{aligned}\\Phi^{-1}\\{1-S(t)\\}&amp;=\\frac{\\log t-\\mu}{\\sigma}\\end{aligned}\\] 因此如果 log-normal 模型是合适的，\\(\\Phi^{-1}\\{1-S(t)\\}\\) 关于 \\(\\log t\\) 的图形将给出一条直线。该线的斜率和截距分别提供了 \\(\\sigma^{−1}\\) 和 \\(−\\mu/\\sigma\\) 的估计。 示例 5.2 (停用宫内节育器的时间) 在示例 5.1 中，使用对数累积风险图来评估 Weibull 分布对示例 1.1 给出的宫内节育器停用时间数据的拟合度。我们现在考虑 log-logistic 分布是否合适。图 5.10 显示了宫内节育器停用时间数据的 \\(\\log\\{\\hat{S}(t)/[1-\\hat{S}(t)]\\}\\) 关于 \\(\\log t\\) 的图形。 图 5.10 根据该图，时间 \\(t\\) 后停用宫内节育器的对数几率估计与 \\(\\log t\\) 之间有合理的直线关系。这表明可以使用 log-logistic 模型对观测数据进行建模。 请注意，图 5.9 和 5.10 图中偏离线性的程度几乎没有差异。这意味着 Weibull 分布和 log-logistic 分布可能都令人满意，即使在这两种分布下风险函数估计可能非常不同。事实上，当只有相对较少数量个体的生存数据时，如本例所示，通常在数据的替代分布模型之间几乎没有选择余地。然后采用最方便的模型。 使用图形方法获得的生存时间概率分布中未知参数的非正式估计也可以用于估计这些参数的函数，例如分布的中位数。然而，这并不能度量所估量的精度。下一节将开发一种更正式的方法：为生存数据拟合参数模型。 5.3 为单样本拟合参数模型 可以使用第 3 章 3.3 节概述的最大似然方法为观测生存数据集拟合参数模型。首先考虑无删失观测情况，我们有 \\(n\\) 个个体的实际观测生存时间。若与生存时间相关的随机变量的概率密度函数为 \\(f(t)\\)，\\(n\\) 个观测 \\(t_1,t_2,\\ldots,t_n\\) 的似然简单地为乘积 \\[\\prod_{i=1}^nf(t_i)\\] 该似然是概率密度函数中未知参数的函数，这些参数的最大似然估计是使似然函数达到最大值的那些值。在实践中，使用对数似然函数通常更方便。使对数似然达到最大的未知参数值当然与使似然函数本身达到最大的值相同。 我们现在考虑一种更常见的情况，其中生存数据包包含若干个删失生存时间。具体来说，假设 \\(r\\) 个个体在时间 \\(t_1, t_2,...,t_r\\) 处死亡，剩余 \\(n − r\\) 个个体的生存时间 \\(t_1^*,t_2^*,\\ldots,t_{n-r}^*\\) 为右删失的。\\(r\\) 个死亡时间为总体似然函数贡献了以下形式的项 \\[\\prod_{j=1}^rf(t_j)\\] 当然，我们不能忽视 \\(n − r\\) 个个体的生存经历的信息，这些个体的删失生存时间已被记录。如果在时间 \\(t^*\\) 处生存时间删失，那么我们知道个体的生命至少为 \\(t^*\\)，并且该事件的概率为 \\(\\mathrm{P}(T\\geqslant t^*)\\)，即 \\(S(t^*)\\)。因此，每个删失观测为似然函数贡献了一个如此形式的项。因此，总似然函数为 \\[\\begin{align} \\prod_{j=1}^rf(t_j)\\prod_{l=1}^{n-r}S(t_l^*) \\tag{5.13} \\end{align}\\] 其中第一个乘积运算关于 \\(r\\) 个死亡时间进行，第二个乘积运算关于 \\(n−r\\) 个删失生存时间进行。 或者以另一种方式，假设数据被视为 \\(n\\) 对观测值，其中第 \\(i\\) 个个体的观测对是 \\((t_i, \\delta_i),i = 1, 2,...,n\\)。在这种表示中，\\(\\delta_i\\) 是一个指示变量，当生存时间 \\(t_i\\) 删失时，\\(δ_i=0\\)；当 \\(t_i\\) 是未删失的生存时间时，\\(δ_i=1\\)。似然函数可以写为 \\[\\begin{align} \\prod_{i=1}^n\\left\\{f(t_i)\\right\\}^{\\delta_i}\\left\\{S(t_i)\\right\\}^{1\\boldsymbol{-}\\delta_i} \\tag{5.14} \\end{align}\\] 该函数等价于式 (5.13) 中的函数，然后可以关于密度函数和生存函数中的未知参数来最大化。 可以通过将式 (5.14) 写为以下形式来获得该似然函数的另一种表达 \\[\\prod_{i=1}^n\\left\\{\\frac{f(t_i)}{S(t_i)}\\right\\}^{\\delta_i}S(t_i)\\] 因此，根据第 1 章的式 (1.4)，这成为 \\[\\begin{align} \\prod_{{i}=1}^{{n}}\\left\\{h(t_i)\\right\\}^{{\\delta}_i}S(t_i) \\tag{5.15} \\end{align}\\] 当概率密度函数具有复杂的形式（通常如此）时，如此形式的似然函数特别有用。然后通过最大化对数似然函数的来得到该似然函数中未知参数的估计。 5.3.1 随机删失数据的似然函数 本节给出了式 (5.14) 中似然函数更仔细的推导，它涉及第 1 章 1.2.1 节中提到的独立删失假设。 假设 \\(n\\) 个个体样本的生存数据是事件时间和右删失观测的混合。用 \\(t_i\\) 表示第 \\(i\\) 个个体的观测时间，\\(\\delta_i\\) 为相应的事件指示，\\(i=1,2,\\ldots,n\\)。 如果 \\(t_i\\) 是事件时间，则 \\(\\delta_i=1\\)，如果时间是删失的，则 \\(\\delta_i=0\\)。 与第 \\(i\\) 个个体的事件时间相关的随机变量将由 \\(T_i\\) 表示。假设删失时间为随机的，用 \\(C_i\\) 表示与删失时间相关的变量。那么，值 \\(t_i\\) 是随机变量 \\(Y_i=\\min(T_i,C_i)\\) 的观测值。\\(T_i\\) 的密度函数和生存函数分别用 \\(f_{T_i}(t)\\) 和 \\(S_{T_i}(t)\\) 表示。此外，用 \\(f_{C_i}(t)\\)和 \\(S_{C_i}(t)\\) 表示与删失时间 \\(C_i\\) 相关的随机变量的密度和生存函数。 现在，我们分别考虑删失和未删失观测对 \\((Y_i,\\delta_i)\\) 的概率分布。首先考虑删失观测，因此 \\(\\delta_i=0\\)。\\(Y_i\\) 和 \\(\\delta_i\\) 的联合分布为 \\[\\begin{aligned}\\mathrm{P}(Y_i=t,\\delta_i=0)=\\mathrm{P}(C_i=t,T_i\\geqslant t)\\end{aligned}\\] 该联合概率是连续分量和离散分量的混合，但为了简化表示，例如，将 \\(P(T_i=t)\\) 理解为 \\(T_i\\) 的概率密度函数。现在假设事件时间 \\(T_i\\) 的分布与删失时间 \\(C_i\\) 的分布独立。那么 \\[\\begin{aligned} \\begin{aligned}\\mathrm{P}(C_i=t,T_i\\geqslant t)\\end{aligned}&amp; \\begin{aligned}=\\text{ P}(C_i=t)\\text{ P}(T_i\\geqslant t)\\end{aligned} \\\\ &amp;=\\left.f_{C_i}(t)S_{T_i}(t)\\right. \\end{aligned}\\] 因此 \\[\\begin{aligned}\\mathrm{P}(Y_i=t,\\delta_i=0)=f_{C_i}(t)S_{T_i}(t)\\end{aligned}\\] 类似地，对于未删失观测 \\[\\begin{aligned} \\mathrm{P}(Y_i=t,\\delta_i=1)&amp; \\begin{aligned}=\\text{ P}(T_i=t,C_i\\geqslant t)\\end{aligned} \\\\ &amp;=\\text{ P}(T_i=t)\\text{ P}(C_i\\geqslant t) \\\\ &amp;=\\left.f_{T_i}(t)S_{C_i}(t)\\right. \\end{aligned}\\] 再次假设 \\(C_i\\) 与 \\(T_i\\) 的分布是独立的。把这两个结果放在一起，\\(n\\) 个观测 \\(t_1,t_2,\\ldots,t_n\\) 的联合概率或似然为 \\[\\begin{aligned}\\prod_{i=1}^n\\{f_{T_i}(t_i)S_{C_i}(t_i)\\}^{\\delta_i}\\{f_{C_i}(t_i)S_{T_i}(t_i)\\}^{1{-}\\delta_i}\\end{aligned}\\] 可写为 \\[\\begin{aligned}\\prod_{i=1}^nf_{C_i}(t_i)^{1-\\delta_i}S_{C_i}(t_i)^{\\delta_i}\\times\\prod_{i=1}^nf_{T_i}(t_i)^{\\delta_i}S_{T_i}(t_i)^{1-\\delta_i}\\end{aligned}\\] 在独立删失假设下，该表达式中的第一个乘积项将不涉及任何与生存时间分布相关的参数，因此可以视为常数。观测数据的似然与下式成比例 \\[\\prod_{i=1}^nf_{T_i}(t_i)^{\\delta_i}S_{T_i}(t_i)^{1\\boldsymbol{-}\\delta_i}\\] 这是式 (5.14)。 还可以证明，当研究具有固定的持续时间时，从而到研究结束时没有经历过事件的个体被删失，可以获得相同的似然函数。此处不给出具体细节，但可参阅 Klein and Moeschberger (2005) 或 Lawless (2002). 5.4 拟合指数和 Weibull 模型 我们现在考虑为单个生存数据样本拟合指数分布和 Weibull 分布。 5.4.1 拟合指数分布 假设 \\(n\\) 个个体的生存时间 \\(t_1, t_2,...,t_n\\) 呈均值为 \\(\\lambda^{-1}\\) 的指数分布。进一步假设 \\(r\\) 个个体的生存时间未删失，其余 \\(n − r\\) 个是右删失的。 对于指数分布 \\[\\begin{aligned}f(t)=\\lambda e^{-\\lambda t},\\quad\\quad S(t)=e^{-\\lambda t}\\end{aligned}\\] 代入式 (5.14)，\\(n\\) 个观测的似然函数由下式给出 \\[\\begin{aligned}L(\\lambda)&amp;=\\prod_{i=1}^n\\left(\\lambda e^{-\\lambda t_i}\\right)^{\\delta_i}\\left(e^{-\\lambda t_i}\\right)^{1-\\delta_i}\\end{aligned}\\] 其中，如果第 \\(i\\) 个个体的生存时间删失，则 \\(\\delta_i=0\\)，否则为 1. 经过一些简化后， \\[\\begin{align} L(\\lambda)&amp;=\\prod_{i=1}^n\\lambda^{\\delta_i}e^{-\\lambda t_i} \\tag{5.16} \\end{align}\\] 相应的对数似然函数为 \\[\\begin{aligned}\\log L(\\lambda)=\\sum_{i=1}^n\\delta_i\\log\\lambda-\\lambda\\sum_{i=1}^nt_i\\end{aligned}\\] 由于数据包含 \\(r\\) 次死亡，则 \\(\\sum_{i=1}^n\\delta_i=r\\)，对数似然函数成为 \\[\\begin{aligned}\\log L(\\lambda)&amp;=r\\log\\lambda-\\lambda\\sum_{i=1}^nt_i\\end{aligned}\\] 现在我们需要确定使对数似然函数达到最大值的 \\(\\hat\\lambda\\)。将其关于 \\(\\lambda\\) 微分，得到 \\[\\begin{aligned}\\frac{\\mathrm{d}\\log L(\\lambda)}{\\mathrm{d}\\lambda}&amp;=\\frac{r}{\\lambda}-\\sum_{i=1}^{n}t_i\\end{aligned}\\] 并令导数等于零，得到 \\(\\lambda\\) 的最大似然估计 \\[\\begin{align} \\hat{\\lambda}=r/\\sum_{i=1}^nt_i \\tag{5.17} \\end{align}\\] 指数分布的均值为 \\(\\mu = \\lambda^{−1}\\)，因此 \\(\\mu\\) 的最大似然估计为 \\[\\hat{\\mu}=\\hat{\\lambda}^{-1}=\\frac1r\\sum_{i=1}^nt_i\\] \\(\\mu\\) 的估计是数据集中 \\(n\\) 个个体的总生存时间除以观测死亡人数。因此，该估计具有直观的吸引力，可以作为删失生存数据中平均寿命的估计。 使用附录 A 给出的最大似然估计理论的结果，可以从对数似然函数的二阶导数中获得标准误。\\(\\log L(\\lambda)\\) 的二阶导数给出 \\[\\begin{aligned}\\frac{\\mathrm{d}^2\\log L(\\lambda)}{\\mathrm{d}\\lambda^2}&amp;=-\\frac r{\\lambda^2}\\end{aligned}\\] 因此，\\(\\hat \\lambda\\) 的渐近方差为 \\[\\begin{aligned}\\operatorname{var}\\left(\\hat{\\lambda}\\right)=\\left\\{-\\operatorname{E}\\left(\\frac{\\mathrm{d}^2\\log L(\\lambda)}{\\mathrm{d}\\lambda^2}\\right)\\right\\}^{-1}=\\frac{\\lambda^2}r\\end{aligned}\\] 因此，\\(\\hat \\lambda\\) 的标准误为： \\[\\begin{align} \\text{se }(\\hat{\\lambda})=\\hat{\\lambda}/√r \\tag{5.18} \\end{align}\\] 该结果可用于获得平均生存时间的置信区间。具体来说，\\(\\lambda\\) 的 \\(100(1−\\alpha)\\%\\) 置信区间的上下限为：\\(\\hat{\\lambda}\\pm z_{\\alpha/2}\\text{se}(\\hat{\\lambda})\\)，其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。 在呈现生存分析的结果时，生存函数和风险函数的估计，以及生存时间分布的中位数和其他百分位数是有用的。一旦得到 \\(\\lambda\\) 的估计，就可以使用 5.1.1 节中给出的结果来估计所有这些函数。具体来说是，在假设的指数分布下，风险函数估计为 \\(\\hat{h}(t)=\\hat{\\lambda}\\)，而生存函数估计为 \\(\\hat{S}(t)=\\exp(-\\hat{\\lambda}t)\\)。此外，第 \\(p\\) 个百分位数估计为 \\[\\begin{align} \\hat{t}(p)&amp;=\\frac{1}{\\hat{\\lambda}}\\log\\left(\\frac{100}{100-p}\\right) \\tag{5.19} \\end{align}\\] 中位生存时间估计为 \\[\\begin{align} \\hat{t}(50)=\\hat{\\lambda}^{-1}\\log2 \\tag{5.20} \\end{align}\\] 使用第 2 章式 (2.8) 给出的随机变量函数近似方差的结果，可以得到生存时间分布第 \\(p\\) 个百分位数估计的标准误。根据该结果，对 \\(\\hat \\lambda\\) 的函数 \\(g(\\hat{\\lambda})\\) 的方差的近似为 \\[\\begin{align} \\text{var}\\left\\{g(\\hat{\\lambda})\\right\\}\\approx\\left\\{\\frac{\\text{d}g(\\hat{\\lambda})}{\\text{d}\\hat{\\lambda}}\\right\\}^2\\text{ var}\\left(\\hat{\\lambda}\\right) \\tag{5.21} \\end{align}\\] 使用该结果，第 \\(p\\) 个百分位数估计的近似方差为 \\[\\begin{aligned}\\operatorname{var}\\left\\{\\hat{t}(p)\\right\\}&amp;\\approx\\left\\{-\\frac{1}{\\hat{\\lambda}^2}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^2\\operatorname{var}\\left(\\hat{\\lambda}\\right)\\end{aligned}\\] 开平方得到 \\[\\begin{aligned}\\text{se}\\left\\{\\hat{t}(p)\\right\\}&amp;=\\frac{1}{\\hat{\\lambda}^{2}}\\log\\left(\\frac{100}{100-p}\\right)\\text{ se}\\left(\\hat{\\lambda}\\right)\\end{aligned}\\] 代入式 (5.18) 中的 \\(\\text{se}\\left(\\hat{\\lambda}\\right)\\) 和式 (5.19) 中的 \\(\\widehat{t}(p)\\)，得到 \\[\\begin{align} \\text{se }\\{\\hat{t}(p)\\}=\\hat{t}(p)/√r \\tag{5.22} \\end{align}\\] 特别地，中位生存时间估计的标准误为 \\[\\begin{align} \\text{se}\\left\\{\\hat{t}(50)\\right\\}=\\hat{t}(50)/√r \\tag{5.23} \\end{align}\\] 真实百分位数的置信区间最好通过对对数百分位数的置信限进行指数运算来获得。该程序确保百分位数的置信限非负。再次利用式 (5.21) 的结果，\\(\\log\\hat{t}(p)\\) 的标准误由下式给出 \\[\\begin{aligned}\\text{se}\\left\\{\\log\\hat{t}(p)\\right\\}=\\hat{t}(p)^{-1}\\text{ se}\\left\\{\\hat{t}(p)\\right\\}\\end{aligned}\\] 然后带入式 (5.22) 中的 \\(\\mathrm{se}\\left\\{\\hat{t}(p)\\right\\}\\)，该标准误成为 \\[\\begin{aligned}\\text{se}\\left\\{\\log\\hat{t}(p)\\right\\}=1/√r\\end{aligned}\\] 使用此结果，第 \\(p\\) 个百分位数的 \\(100(1 − \\alpha)\\%\\) 置信限为 \\(\\exp\\{\\log\\hat{t}(p)\\pm z_{\\alpha/2}/√r\\}\\)，即 \\(\\hat{t}(p)\\exp\\{\\pm z_{\\alpha/2}/√r\\}\\)，其中 \\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。 示例 5.3 (停用宫内节育器的时间) 在此示例中，假设停用风险恒定，对示例 1.1 中关于 18 名女性宫内节育器停用时间数据进行了分析。使用指数分布拟合停用时间。对于这些数据，观测的和右删失的停用时间总和为 1046 天，未删失时间数为 9. 因此，使用式 (5.17)，\\(\\hat{\\lambda}=9/1046=0.0086\\)，根据式 (5.18)，标准误为 \\(\\text{se}\\left(\\hat{\\lambda}\\right)=0.0086/\\sqrt{9}=0.0029\\)。因此，风险函数估计为 \\(\\hat{h}(t)=0.0086,t&gt;0\\)，生存函数估计为 \\(\\hat{S}(t)=\\exp(-0.0086t)\\)。风险函数估计和生存函数估计分别如图 5.11 和 5.12 所示。 图 5.11 图 5.12 停用时间分布的中位数和其他百分位数的估计可以从图 5.12 中找到，但更准确的估计可以从式 (5.20) 中获得。具体来说，使用式 (5.17)，中位停用时间为 81 天，根据式 (5.19)，停用时间分布的第 90 个百分位的估计值为 \\(\\hat t(90) = \\log 10/0.0086 = 267.61\\) 。这意味着，假设停用宫内节育器的风险与时间无关，则 90% 的女性停用宫内节育器的时间将小于 268 天。 根据式 (5.23)，停用时间估计的标准误为 \\(80.56/√9\\)，即 26.85 天。真实中位停用时间的 95% 置信区间的上下限为 \\[80.56\\exp\\{\\pm1.96/√9\\}\\] 所以区间是 42 天到 155 天。其他百分位数的置信区间可以以类似的方式计算。 5.4.2 拟合 Weibull 分布 现在将 \\(n\\) 个个体的生存时间视为来自具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布的删失样本。假设 \\(n\\) 个个体中有 \\(r\\) 次死亡，\\(n−r\\) 个右删失生存时间。我们可以再次使用式 (5.14) 来获得样本数据的似然。 \\(W(\\lambda,\\gamma)\\) 分布的概率密度、生存和风险函数由下式给出 \\[\\begin{aligned}f(t)=\\lambda\\gamma t^{\\gamma-1}\\exp(-\\lambda t^\\gamma),\\quad S(t)=\\exp(-\\lambda t^\\gamma),\\quad h(t)=\\lambda\\gamma t^{\\gamma-1}\\end{aligned}\\] 因此，根据式 (5.14)，\\(n\\) 个生存时间的似然为 \\[\\begin{aligned}\\prod_{i=1}^n\\left\\{\\lambda\\gamma t_i^{\\gamma-1}\\exp(-\\lambda t_i^\\gamma)\\right\\}^{\\delta_i}\\left\\{\\exp(-\\lambda t_i^\\gamma)\\right\\}^{1-\\delta_i}\\end{aligned}\\] 其中，若第 \\(i\\) 个生存时间删失，则 \\(\\delta_i\\) 为 0，否则为 1。等价地，根据式 (5.15)，似然函数为 \\[\\prod_{i=1}^n\\left\\{\\lambda\\gamma t_i^{\\gamma-1}\\right\\}^{\\delta_i}\\exp(-\\lambda t_i^\\gamma)\\] 这被视为 Weibull 分布中未知参数 \\(\\lambda\\) 和 \\(\\gamma\\) 的函数，因此可以写为 \\(L(\\lambda,\\gamma)\\)。相应的对数似然函数为 \\[\\begin{aligned}\\log L(\\lambda,\\gamma)=\\sum_{i=1}^n\\delta_i\\log(\\lambda\\gamma)+(\\gamma-1)\\sum_{i=1}^n\\delta_i\\log t_i-\\lambda\\sum_{i=1}^nt_i^\\gamma\\end{aligned}\\] 注意到 \\(\\sum_{i=1}^n\\delta_i=r\\)，对数似然函数成为 \\[\\begin{aligned}\\log L(\\lambda,\\gamma)=r\\log(\\lambda\\gamma)+(\\gamma-1)\\sum_{i=1}^n\\delta_i\\log t_i-\\lambda\\sum_{i=1}^nt_i^\\gamma\\end{aligned}\\] \\(\\lambda\\) 和 \\(\\gamma\\) 的最大似然估计是通过将该函数关于 \\(\\lambda\\) 和 \\(\\gamma\\) 微分，将导数设为零得出的。所得方程为 \\[\\begin{align} \\frac r{\\hat{\\lambda}}-\\sum_{i=1}^nt_i^{\\hat{\\gamma}}=0 \\tag{5.24} \\end{align}\\] 以及 \\[\\begin{align} \\frac{r}{\\hat{\\gamma}}+\\sum_{i=1}^n\\delta_i\\log t_i-\\hat{\\lambda}\\sum_{i=1}^nt_i^{\\hat{\\gamma}}\\log t_i&amp;=0 \\tag{5.25} \\end{align}\\] 根据式 (5.24)， \\[\\begin{align} \\hat{\\lambda}=r/\\sum_{i=1}^nt_i^{\\hat{\\gamma}} \\tag{5.26} \\end{align}\\] 代入式 (5.25) 中的 \\(\\hat\\lambda\\)，我们得到方程 \\[\\begin{align} \\frac{r}{\\hat{\\gamma}}+\\sum_{i=1}^n\\delta_i\\log t_i-\\frac{r}{\\sum_it_i^{\\hat{\\gamma}}}\\sum_{i=1}^nt_i^{\\hat{\\gamma}}\\log t_i=0 \\tag{5.27} \\end{align}\\] 这是 \\(\\hat\\gamma\\) 的非线性方程，只能使用迭代程序进行数值求解。一旦找到满足式 (5.27) 的估计 \\(\\hat\\gamma\\)，就可以使用式 (5.26) 来获得 \\(\\hat\\lambda\\)。 在实践中，使用数值方法（例如 Newton-Raphson 程序）来同时得到最大化似然函数的 \\(\\hat\\gamma\\) 和 \\(\\hat\\gamma\\) 的值。该过程在第 3 章 3.3.3 节中描述，与 Cox 回归模型的拟合有关。在该节中，注意到 Newton-Raphson 程序的一个重要副产品是参数估计的方差-协方差阵的近似，从中可以获得它们的标准误。 一旦从 Weibull 分布对观测数据的拟合中找到了参数 \\(\\lambda\\) 和 \\(\\gamma\\) 的估计，就可以使用式 (5.7) 来估计生存时间分布的百分位数。该分布的第 \\(p\\) 个百分位数估计为 \\[\\begin{align} \\hat{t}(p)=\\left\\{\\frac{1}{\\hat{\\lambda}}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\hat{\\gamma}} \\tag{5.28} \\end{align}\\] 中位生存时间估计为 \\[\\begin{align} \\hat{t}(50)=\\left\\{\\frac{1}{\\hat{\\lambda}}\\log2\\right\\}^{1/\\hat{\\gamma}} \\tag{5.29} \\end{align}\\] 5.4.3 节导出了 Weibull 分布百分位数标准误的表达式以及相应的置信区间。 5.4.3 Weibull 分布百分位数的标准误 具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布的第 \\(p\\) 个百分位数估计的标准误 \\(\\hat{t}(p)\\) 最容易从 \\(\\log\\hat t(p)\\) 的方差中得到。现在，根据式 (5.28) \\[\\begin{aligned}\\log\\hat{t}(p)=\\frac1{\\hat{\\gamma}}\\log\\left\\{\\hat{\\lambda}^{-1}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}\\end{aligned}\\] 因此 \\[\\begin{aligned}\\log\\hat{t}(p)=\\frac{1}{\\hat{\\gamma}}\\left\\{c_p-\\log\\hat{\\lambda}\\right\\}\\end{aligned}\\] 其中 \\[\\begin{aligned}c_p=\\log\\log\\left(\\frac{100}{100-p}\\right)\\end{aligned}\\] 这是两个参数估计 \\(\\hat\\lambda,\\hat\\gamma\\) 的函数。 为获取 \\(\\log\\hat{t}(p)\\) 的方差，我们利用两个参数估计函数 \\(g(\\hat{\\theta}_1,\\hat{\\theta}_2)\\) 的近似方差的一般结果 \\[\\begin{align} \\left(\\frac{\\partial g}{\\partial\\hat{\\theta}_1}\\right)^2\\operatorname{var}\\left(\\hat{\\theta}_1\\right)+\\left(\\frac{\\partial g}{\\partial\\hat{\\theta}_2}\\right)^2\\operatorname{var}(\\hat{\\theta}_2)+2\\left(\\frac{\\partial g}{\\partial\\hat{\\theta}_1}\\frac{\\partial g}{\\partial\\hat{\\theta}_2}\\right)\\operatorname{cov}\\left(\\hat{\\theta}_1,\\hat{\\theta}_2\\right) \\tag{5.30} \\end{align}\\] 这是第 2 章式 2.8 中关于单个随机变量函数的近似方差结果的推广。使用式 (5.30) \\[\\begin{aligned}\\text{var }\\left\\{\\log\\hat{t}(p)\\right\\}\\approx&amp;\\,\\left(\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\lambda}}\\right)^2\\text{var}\\left(\\hat{\\lambda}\\right)+\\left(\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\gamma}}\\right)^2\\text{var}\\left(\\hat{\\gamma}\\right)\\\\&amp;+2\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\lambda}}\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\gamma}}\\text{cov}\\left(\\hat{\\lambda},\\hat{\\gamma}\\right)\\end{aligned}\\] 现在，\\(\\log\\hat{t}(p)\\) 关于 \\(\\hat\\lambda,\\hat\\gamma\\) 的导数为 \\[\\begin{aligned}\\frac{\\partial\\log\\hat t(p)}{\\partial\\hat\\lambda}&amp;=-\\frac{1}{\\hat\\lambda\\hat\\gamma}\\\\\\frac{\\partial\\log\\hat t(p)}{\\partial\\hat\\gamma}&amp;=-\\frac{c_p-\\log\\hat\\lambda}{\\hat\\gamma^2}\\end{aligned}\\] 因此 \\(\\log\\hat{t}(p)\\) 的近似方差为 \\[\\begin{align} \\frac1{\\hat{\\lambda}^2\\hat{\\gamma}^2}\\operatorname{var}\\left(\\hat{\\lambda}\\right)+\\frac{\\left(c_p-\\log\\hat{\\lambda}\\right)^2}{\\hat{\\gamma}^4}\\operatorname{var}\\left(\\hat{\\gamma}\\right)+\\frac{2\\left(c_p-\\log\\hat{\\lambda}\\right)}{\\hat{\\lambda}\\hat{\\gamma}^3}\\operatorname{cov}\\left(\\hat{\\lambda},\\hat{\\gamma}\\right) \\tag{5.31} \\end{align}\\] \\(\\hat{t}(p)\\) 本身的方差根据第 2 章式 2.8 的结果中得到，即 \\[\\begin{align} \\text{var}\\left\\{\\hat{t}(p)\\right\\}&amp;\\approx\\hat{t}(p)^2\\text{var}\\left\\{\\log\\hat{t}(p)\\right\\} \\tag{5.32} \\end{align}\\] 使用式 (5.31) \\[\\begin{aligned}\\mathrm{var}\\left\\{\\hat{t}(p)\\right\\}\\approx&amp;\\,\\frac{\\hat{t}(p)^2}{\\hat{\\lambda}^2\\hat{\\gamma}^4}\\left\\{\\hat{\\gamma}^2\\operatorname{var}(\\hat{\\lambda})+\\hat{\\lambda}^2\\left(c_p-\\log\\hat{\\lambda}\\right)^2\\operatorname{var}(\\hat{\\gamma})\\right.\\\\&amp;+\\left.2\\hat{\\lambda}\\hat{\\gamma}\\left(c_p-\\log\\hat{\\lambda}\\right)\\text{ cov}\\left(\\hat{\\lambda},\\hat{\\gamma}\\right)\\right\\} \\end{aligned}\\] \\(\\hat{t}(p)\\) 的标准误是该式的平方根，由下式给出 \\[\\begin{align} \\mathrm{se}\\left\\{\\hat{t}(p)\\right\\}\\approx&amp;\\,\\frac{\\hat{t}(p)}{\\hat{\\lambda}\\hat{\\gamma}^2}\\left\\{\\hat{\\gamma}^2\\operatorname{var}(\\hat{\\lambda})+\\hat{\\lambda}^2\\left(c_p-\\log\\hat{\\lambda}\\right)^2\\operatorname{var}(\\hat{\\gamma})\\right.\\\\&amp;+\\left.2\\hat{\\lambda}\\hat{\\gamma}\\left(c_p-\\log\\hat{\\lambda}\\right)\\text{ cov}\\left(\\hat{\\lambda},\\hat{\\gamma}\\right)\\right\\}^{\\frac12} \\tag{5.33} \\end{align}\\] 注意，对于指数分布的特殊情况，其中形状参数 \\(\\gamma=1\\)，根据式 (5.33) ，第 \\(p\\)个百分位数估计的标准误为 \\[\\frac{\\widehat{t}(p)}{\\widehat{\\lambda}}\\text{ se }(\\hat{\\lambda})\\] 现在使用式 (5.18) \\[\\begin{aligned}\\text{se }(\\hat{\\lambda})=\\hat{\\lambda}/\\sqrt{r}\\end{aligned}\\] 其中 \\(r\\) 是数据集中的死亡数，因此 \\[\\begin{aligned}\\text{se}\\left\\{\\hat{t}(p)\\right\\}=\\hat{t}(p)/√r\\end{aligned}\\] 如式 (5.22) 中所示。 根据 \\(\\operatorname{log}t(p)\\) 的相应置信限，可以找到 Weibull 分布第 \\(p\\) 个百分位的 \\(100(1−\\alpha)\\%\\) 置信区间。上下限为 \\[\\begin{aligned}\\log\\hat{t}(p)\\pm z_{\\alpha/2}\\text{se}\\{\\log\\hat{t}(p)\\}\\end{aligned}\\] 其中 \\(\\text{se}\\left\\{\\log\\hat{t}(p)\\right\\}\\) 根据式 (5.32)，为 \\[\\begin{align} \\text{se}\\left\\{\\log\\hat{t}(p)\\right\\}&amp;=\\frac{1}{\\hat{t}(p)}\\text{ se}\\left\\{\\hat{t}(p)\\right\\} \\tag{5.34} \\end{align}\\] \\(z_{\\alpha/2}\\) 是标准正态分布的上 \\(\\alpha/2\\) 分位点。第 \\(p\\) 个百分位数 \\(t(p)\\) 对应的 \\(100(1−\\alpha)\\%\\) 置信区间为 \\(\\hat{t}(p)\\exp\\left[\\pm z_{\\alpha/2}\\text{ se}\\{\\log\\hat{t}(p)\\}\\right]\\)。 示例 5.4 (停用宫内节育器的时间) 在示例 5.1 中，发现指数分布为 18 名宫内节育器使用者的停用时间数据提供了令人满意的模型。为了进行比较，为该数据拟合 Weibull 分布。使用计算机软件对该分布进行拟合，从结果输出中，发现分布的尺度参数估计为 \\(\\hat{\\lambda}=0.000454\\) ，而形状参数估计为 \\(\\hat{\\gamma}=1.676\\)。这些估计的标准误分别为 \\(\\text{se}(\\hat{\\lambda})=0.000965\\) 和 \\(\\text{se}\\left(\\hat{\\gamma}\\right)=0.460\\)。值得注意的是，形状参数 \\(\\gamma\\) 的近似置信限 \\(\\hat{\\gamma}\\pm1.96\\text{se}\\left(\\hat{\\gamma}\\right)\\) 包括 1，这表明指数分布将为停用时间提供一个满意的模型。 通过将这些估计代入式 (5.4) 和 (5.5)，可以获得风险函数和生存函数的估计，其中 \\[\\hat{h}(t)=\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}\\boldsymbol{-}1}\\] 以及 \\[\\hat{S}(t)=\\exp\\left(-\\hat{\\lambda}t^{\\boldsymbol{\\hat{\\gamma}}}\\right)\\] 这两个函数如图 5.13 和 5.14 所示。 图 5.13 图 5.14 尽管停用时间的百分位数可以从图 5.14 中的生存函数估计中读取，但使用式 (5.28) 可以更好地估计它们。在 Weibull 分布下，可以使用式 (5.29) 估计中位停用时间，并由下式给出 \\[\\hat{t}(50)=\\left\\{\\frac{1}{0.000454}\\log2\\right\\}^{1/1.676}=79.27\\] 作为检查，请注意这与图 5.14 中 \\(\\hat{S}(t)=0.5\\) 对应的停用时间值完全一致。经过大量算术后，根据式 (5.33) 中得到该估计的标准误为 \\[\\begin{aligned}\\text{se}\\left\\{\\hat{t}(50)\\right\\}=15.795\\end{aligned}\\] 为了获得中位停用时间的 95% 置信区间，需要 \\(\\log \\widehat{t}(50)\\) 的标准误。根据式 (5.34)， \\[\\begin{aligned}\\text{se}\\left\\{\\log\\hat{t}(50)\\right\\}=\\frac{15.795}{79.272}=0.199\\end{aligned}\\] 因此，所需的对数中位停用时间置信限为 \\(\\log 79.272\\pm 1.96\\times 0.199\\)，即 \\((3.982, 4.763)\\)。通过对这些限值求指数得出的真实中位停用时间的相应区间估计为 \\((53.64, 117.15)\\)。这意味着 54 天到 117 天的区间有 95% 的可能性包含中位停用时间的真实值。由于数据集中实际停用次数较少，因此该区间相当宽。 将这些结果与示例 5.3 中发现的结果进行比较十分有趣，后者使用指数分布对停用时间进行建模。两模型的中位生存时间估计非常相似，指数模型为 80.6 天，Weibull 模型为 79.3 天。然而，当生存时间假设为指数分布时，中位生存时间估计的标准误为 26.8 天，在 Weibull 模型下仅为 15.8 天。因此，当假设停用时间具有 Weibull 分布时，可以更精确地估计中位数。 停用时间分布的其他百分位数及其标准误和置信区间，可以以类似的方式得到。例如，第 90 个百分位（即研究中 10% 的受试者继续使用宫内节育器的时间）为 162.23 天，真实百分位数的 95% 置信限为 95.41 至 275.84 天。请注意，此置信区间的宽度大于中位停用时间的宽度，这反映出中位数的估计比其他百分位更精确。 5.5 用于两组比较的 Weibull 模型 我们在 3.1 节中看到，比较两组生存时间的一个方便的通用模型是比例风险模型。在这里，这两组记为 Group I 和 Group II，\\(X\\) 是一个指标变量，如果一个个体在 Group I 则取值为 0，如果一个个体在 Group II 则取值为 1. 在比例风险模型下，第 \\(i\\) 个个体在时间 \\(t\\) 的死亡风险由下式给出 \\[\\begin{align} h_i(t)=e^{\\boldsymbol{\\beta}x_i}h_0(t) \\tag{5.35} \\end{align}\\] 因此，Group I 个体在时间 \\(t\\) 的风险为 \\(h_0(t)\\)，Group II 个体的风险为 \\(\\psi h_{0}(t)\\)，其中 \\(\\psi=\\exp(\\beta)\\)。量 \\(\\beta\\) 是 Group II 个体的风险与 Group I 个体风险之比的对数。 我们现在将做出额外的假设，即 Group I 个体的生存时间具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布。使用式 (5.35)，该组个体的风险函数为 \\(h_0(t)\\)，其中 \\(h_0(t)=\\lambda\\gamma t^{\\gamma-1}\\)。现在，同样根据式 (5.35)，Group II 的风险函数为 \\(\\psi h_0(t)\\)，即 \\(\\psi\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\)。这是具有尺度参数 \\(\\psi\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布的风险函数。因此，我们得出的结果是，如果 Group I 个体的生存时间具有形状参数为 \\(\\gamma\\) 的 Weibull 分布，并且 Group II 个体的死亡风险与 Group I 个体的死亡风险在时间 \\(t\\) 成比例，Group II 的生存时间也将服从形状参数为 \\(\\gamma\\) 的 Weibull 分布。称 Weibull 分布具有比例风险性 (proportional hazards property). 这一性质是 Weibull 分布在生存数据分析中如此重要的另一个原因。 5.5.1 探索性分析 当生存时间的单个样本具有 Weibull 分布 \\(W(\\lambda, \\gamma)\\) 时，5.2 节中描述的对数累积风险图将给出一条截距为 \\(\\log\\lambda\\) 以及斜率为 \\(\\gamma\\) 的直线。因此，如果 Group II 的生存时间具有 \\(W(\\psi\\lambda, \\gamma)\\) 分布，正如在式 (5.35) 中的比例风险模型下一样，对数累积风险图将给出一条直线，斜率也为 \\(\\gamma\\)，但截距为 \\(\\log \\psi + \\log \\lambda\\)。 如果在两组中绘制对数累积风险函数估计关于对数生存时间的图形，若得到平行直线，则意味着比例风险模型以及 Weibull 生存时间的假设是成立的。两条线的垂直间隔提供了相对风险的对数 \\(\\beta=\\log \\psi\\) 的估计。 如果对数累积风险图中的两条线基本上是直的，但不平行，则意味着两组中的形状参数 \\(\\gamma\\) 不同，并且风险不再成比例。如果线不是特别直，则 Weibull 模型可能不合适。然而，如果曲线可认为是平行的，这将意味着比例风险模型是有效的，那么第 3 章中讨论的 Cox 回归模型可能更令人满意。 示例 5.5 (患乳腺癌妇女的预后) 在本例中，我们研究 Weibull 比例风险模型是否适用于示例 1.2 中乳腺癌症患者生存时间的数据。这些数据根据肿瘤是阳性染色还是阴性染色进行了分类。各组女性生存函数的 Kaplan-Meier 估计如图 2.9 所示。根据这些估计，可以估计对数累积风险，并绘制关于 \\(\\log t\\) 的图形。由此产生的对数累积风险图如图 5.15 所示。 图 2.9 图 5.15 在该图中，对应于两个染色组的线相当直。这意味着每组女性生存时间的 Weibull 分布假设是非常合理的。而且，两条线的斜率非常相似，这意味着比例风险模型是有效的。两条线的垂直间隔提供了对数相对风险的估计。根据图 5.15，两条直线之间的垂直距离约为 1.0，因此粗略地估计风险比为 \\(e^{1.0} = 2.72\\)。与阴性染色组相比，阳性染色组中的女性在任何时候的死亡风险似乎是阴性组的近三倍。在后续的示例 5.6 和示例 5.7 中，为该数据拟合指数模型和 Weibull 模型，可以获得更准确的相对风险估计。 5.5.2 拟合模型 式 (5.35) 中的比例风险模型可以使用最大似然法进行拟合。为了说明这一程序，我们考虑每组生存时间呈指数分布的情况。 假设 Group I 中的 \\(n_1\\) 个个体的观测结果可以表示为 \\((t_{i1},\\delta_{i1}),i=1,2,\\ldots,n_1\\)，如果该组中第 \\(i\\) 个个体的生存时间删失，则 \\(\\delta_{i1}=0\\)，如果该时间是死亡时间，则 \\(\\delta_{i&#39;1}=1\\)。类似地，设 \\((t_{i&#39;2},\\delta_{i&#39;2}),i&#39;=1,2,\\ldots,n_2\\) 是来自 Group II 中的 \\(n_2\\) 个个体的观测结果。对于 Group I 中的个体，风险函数取为 \\(\\lambda\\)，概率密度函数和生存函数由下式给出 \\[\\begin{aligned}f(t_{i1})=\\lambda e^{-\\lambda t_{i1}},\\quad\\quad S(t_{i1})=e^{-\\lambda t_{i1}}\\end{aligned}\\] 而对于 Group II，风险函数为 \\(\\psi\\lambda\\)，概率密度函数和生存函数为 \\[\\begin{aligned}f(t_{i&#39;2})=\\psi\\lambda e^{-\\psi\\lambda t_{i&#39;2}},\\quad\\quad S(t_{i&#39;2})=e^{-\\psi\\lambda t_{i&#39;2}}\\end{aligned}\\] 使用式 (5.14)，\\(n_1+n_2\\) 个观测的似然 \\(L(\\psi,\\lambda)\\) 为 \\[\\begin{aligned}\\prod_{i=1}^{n_1}\\left\\{\\lambda e^{-\\lambda t_{i1}}\\right\\}^{\\delta_{i1}}\\left\\{e^{-\\lambda t_{i1}}\\right\\}^{1-\\delta_{i1}}\\prod_{i&#39;=1}^{n_2}\\left\\{\\psi\\lambda e^{-\\psi\\lambda t_{i&#39;2}}\\right\\}^{\\delta_{i&#39;2}}\\left\\{e^{-\\psi\\lambda t_{i&#39;2}}\\right\\}^{1-\\delta_{i&#39;2}}\\end{aligned}\\] 可简化为 \\[\\begin{aligned}\\prod_{i=1}^{n_1}\\lambda^{\\delta_{i1}}e^{-\\lambda t_{i1}}\\prod_{i&#39;=1}^{n_2}(\\psi\\lambda)^{\\delta_{i&#39;2}}e^{-\\psi\\lambda t_{i&#39;2}}\\end{aligned}\\] 如果两组的实际死亡数分别为 \\(r_1\\) 和 \\(r_2\\)，那么 \\(r_1=\\sum_i\\delta_{{i}1}\\) 以及 \\(r_2=\\sum_i\\delta_{{i}2}\\)，对数似然函数为 \\[\\begin{aligned} \\operatorname{log} L(\\psi,\\lambda)=r_{1}\\operatorname{log}\\lambda-\\lambda\\sum_{i=1}^{n_1} t_{i1}+r_{2}\\operatorname{log}(\\psi\\lambda)-\\psi\\lambda\\sum_{i&#39;=1}^{n_2} t_{i^{\\prime}2} \\\\ \\end{aligned}\\] 现在将 Group I 和 Group II 中个体的总的已知生存时间分别记作 \\(T_1,T_2\\)。那么，\\(T_1,T_2\\) 是每组中未删失和删失生存时间的总和，因此对数似然函数变为 \\[\\begin{aligned}\\log L(\\psi,\\lambda)=(r_1+r_2)\\log\\lambda+r_2\\log\\psi-\\lambda(T_1+\\psi T_2)\\end{aligned}\\] 为了获得该函数为最大值的参数估计，关于 \\(\\psi\\) 和 \\(\\lambda\\) 微分，并将导数设为零。由此得到的方程组为 \\[\\begin{align} \\frac{r_2}{\\hat\\psi}-\\hat\\lambda T_2&amp;=0\\tag{5.36}\\\\\\frac{r_1+r_2}{\\hat\\lambda}-(T_1+\\hat\\psi T_2)&amp;=0\\tag{5.37} \\end{align}\\] 根据式 (5.36) \\[\\hat{\\lambda}=\\frac{r_2}{\\hat{\\psi}T_2}\\] 并代入式 (5.37) 中的 \\(\\hat\\lambda\\)，我们得到 \\[\\begin{align} \\hat{\\psi}=\\frac{r_2T_1}{r_1T_2} \\tag{5.38} \\end{align}\\] 那么，根据式 (5.36) \\[\\begin{aligned}\\hat{\\lambda}&amp;=r_1/T_1\\end{aligned}\\] 这两个估计都有直观的理由。\\(\\hat \\lambda\\) 的估计是 Group I 个体平均生存时间的倒数，而相对风险估计 \\(\\hat \\psi\\) 为两组个体的平均生存时间之比。 参数估计的渐近方差-协方差阵是信息矩阵的逆矩阵，其元素是从对数似然函数的二阶导数中得到的；见附录 A。我们有 \\[\\begin{aligned}\\frac{\\mathrm{d}^2\\log L(\\psi,\\lambda)}{\\mathrm{d}\\psi^2}&amp;=-\\frac{r_2}{\\psi^2},\\quad\\frac{\\mathrm{d}^2\\log L(\\psi,\\lambda)}{\\mathrm{d}\\lambda^2}=-\\frac{r_1+r_2}{\\lambda^2},\\quad\\frac{\\mathrm{d}^2\\log L(\\psi,\\lambda)}{\\mathrm{d}\\lambda\\mathrm{d}\\psi}=-T_2\\end{aligned}\\] 并且信息矩阵是由这些偏导数期望值的负数组成的矩阵。唯一需要得到期望的二阶导数是关于 \\(\\lambda\\) 和 \\(\\psi\\) 的导数，这需要 \\(\\text{E}(T_2)\\)。当生存时间具有指数分布时，这很简单，但具有 Weibull 分布生存时间的预期值较难计算，如 ?? 节所示。由于这个原因，通常通过使用负二阶偏导数的观测作为信息矩阵的近似。因此，观测信息矩阵为 \\[\\left.\\boldsymbol{I}(\\psi,\\lambda)=\\left(\\begin{array}{cc}r_2/\\psi^2&amp;T_2\\\\T_2&amp;(r_1+r_2)/\\lambda^2\\end{array}\\right.\\right)\\] 该矩阵的逆为 \\[\\left.\\frac1{(r_1+r_2)r_2-T_2^2\\psi^2\\lambda^2}\\left(\\begin{array}{cc}(r_1+r_2)\\psi^2&amp;-T_2\\psi^2\\lambda^2\\\\-T_2\\psi^2\\lambda^2&amp;r_2\\lambda^2\\end{array}\\right.\\right)\\] \\(\\hat\\psi\\) 和 \\(\\hat \\lambda\\) 的标准误是通过将该矩阵中的 \\(\\psi\\) 和 \\(\\lambda\\) 替换为 \\(\\hat\\psi\\) 和 \\(\\hat \\lambda\\) 并取平方根来求出的。因此，\\(\\hat\\psi\\) 的标准误由下式给出 \\[\\begin{aligned}\\text{se}\\left(\\hat{\\psi}\\right)&amp;=\\sqrt{\\frac{(r_1+r_2)\\hat{\\psi}^2}{(r_1+r_2)r_2-T_2^2\\hat{\\psi}^2\\hat{\\lambda}^2}}\\end{aligned}\\] 带入表达式分母中的 \\(\\hat\\psi\\) 和 \\(\\hat \\lambda\\) 后，该标准误简化为 \\[\\begin{align} \\hat{\\psi}\\sqrt{\\frac{r_1+r_2}{r_1r_2}} \\tag{5.39} \\end{align}\\] 类似地，\\(\\hat \\lambda\\) 的标准误为 \\[\\text{se }(\\hat{\\lambda})=\\hat{\\lambda}/√r_1\\] 这些标准误估计不能直接用于 \\(\\psi\\) 和 \\(\\lambda\\) 的置信区间的构建。原因是这两个参数的值都必须是正的，它们的估计往往具有偏态分布。这意味着，在构建置信区间时使用的正态性假设是不合理的。\\(\\psi\\) 和 \\(\\lambda\\) 估计的对数分布更有可能是对称的，因此使用参数估计的对数的标准误可以找到参数对数的置信限。然后对所得的置信限进行指数运算，以给出参数本身的区间估计。 参数估计的对数的标准误可以使用式 (5.21) 中给出的一般结果来找到。因此，\\(\\log \\hat \\psi\\) 的近似方差为 \\[\\begin{aligned}\\operatorname{var}\\left(\\log\\hat{\\psi}\\right)&amp;\\approx\\hat{\\psi}^{-2}\\operatorname{var}\\left(\\hat{\\psi}\\right)\\end{aligned}\\] 因此 \\(\\log \\hat \\psi\\) 的标准误为 \\[\\begin{align} \\text{se}(\\log\\hat{\\psi})\\approx\\hat{\\psi}^{-1}\\text{se}(\\hat{\\psi})=\\sqrt{\\frac{r_1+r_2}{r_1r_2}} \\tag{5.40} \\end{align}\\] 相对风险对数的 \\(100(1−\\alpha)\\%\\) 置信区间的上下限为 \\(\\operatorname{log}\\hat{\\psi}\\pm z_{\\alpha/2}\\operatorname{se}\\left(\\operatorname{log}\\hat{\\psi}\\right)\\)，通过对 \\(\\log \\psi\\) 的这些限进行指数运算，可以得到风险比 \\(\\psi\\) 的置信限。如果需要，可以以类似的方式得到 \\(\\lambda\\) 的置信区间。 示例 5.6 (患乳腺癌妇女的预后) 现在使用癌症患者生存时间数据说明本节的理论结果。假设每组女性的生存时间呈指数分布，因此，在任何时候，阴性染色组女性的死亡风险为恒定值 \\(\\lambda\\)，而阳性染色组女性为 \\(\\psi\\lambda\\)，其中 \\(\\psi\\) 为风险比。 根据第 1 章表 1.2 给出的数据，阴性染色组和阳性染色组的死亡数分别为 \\(r_1=5\\) 和 \\(r_2=21\\)。此外，各组的总生存时间分别为 \\(T_1=1652\\)和 \\(T_2=2679\\) 个月。使用式 (5.38)，相对于阴性染色组，阳性染色组女性的死亡风险估计为 \\[\\begin{aligned}\\hat{\\psi}=\\frac{21\\times1652}{5\\times2679}=2.59\\end{aligned}\\] 因此，阳性染色组的女性在任何特定时间的死亡风险约为阴性染色组的 2.5 倍。这与示例 5.5 中使用的图形程序中 \\(\\psi\\) 的估计 2.72 一致。 接下来，使用式 (5.39)，风险比估计的标准误由下式给出 \\[\\begin{aligned}\\text{se}\\left(\\hat{\\psi}\\right)=2.59\\sqrt{\\frac{5+21}{5\\times21}}=1.289\\end{aligned}\\] 为了获得真实相对风险的 95% 置信区间，需要 \\(\\log \\hat\\psi\\) 的标准误。使用式 (5.40)，得到 \\(\\text{se }(\\log\\hat{\\psi})=0.498\\)，因此 \\(\\log{\\psi}\\) 的 95% 置信限为 \\(\\log(2.59)\\pm1.96\\text{se}(\\log\\hat{\\psi})\\)，即 \\((0.98,6.87)\\)。对数相对风险的置信区间为 \\((−0.024,1.927)\\) ，相对风险本身的区间估计为 \\(\\log(2.59)\\pm1.96\\text{se}(\\log\\hat{\\psi})\\)，即 \\((0.98,6.87)\\)。该区间仅刚刚包括 1，表明肿瘤阳性染色的女性预后比肿瘤阴性染色的女性差。该结果与示例 2.12 中的 log-rank 检验的结果一致，其中在检验无组间差异的假设时获得的 \\(P\\) 值为 0.061. 在实践中，我们使用计算机软件来拟合两组生存数据的参数模型，并假设比例风险。当拟合式 (5.35) 中的模型时，可以从输出结果中获得 \\(\\beta,\\lambda\\) 和 \\(\\gamma\\) 的估计及其标准误。然后可能需要进行进一步的计算，以获得相对风险的估计以及该估计值的标准误。具体来说，风险比估计可以通过 \\(\\hat{\\psi}=\\exp(\\hat{\\beta})\\) 获得，并且可以根据下式得到 \\(\\mathrm{se}\\left(\\hat{\\psi}\\right)\\) \\[\\operatorname{se}\\left(\\hat{\\psi}\\right)=\\exp(\\hat{\\beta})\\operatorname{se}\\left(\\hat{\\beta}\\right)\\] 这是式 (5.21) 得出的结果。 两组生存时间分布的中位数和其他百分位数可以根据 \\(\\hat\\psi\\) 和 \\(\\hat\\lambda\\) 的值来估计。例如，根据式 (5.28)，Group I 第 \\(p\\) 个百分位数估计为 \\[\\hat{t}(p)=\\left\\{\\frac{1}{\\hat{\\lambda}}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\hat{\\gamma}}\\] 对于 Group II 则为 \\[\\hat{t}(p)=\\left\\{\\frac{1}{\\hat{\\psi}\\hat{\\lambda}}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\hat{\\gamma}}\\] 一旦得出模型中参数估计的方差和协变量，就可以使用类似于式 (5.33) 中的表达式来获得每组百分位数估计的标准误。将不会给出每组生存时间分布百分位数标准误的具体结果。相反，可以使用式 (5.33) 中给出的拟合 Weibull 模型后第 \\(p\\) 个百分位数的标准误的一般表达式。 示例 5.7 (患乳腺癌妇女的预后) 在示例 5.5 中，发现 Weibull 比例风险模型适用于两组乳腺癌患者的生存时间数据。在此模型下，在时间 \\(t\\) 时，对于肿瘤染色呈阴性的患者，死亡风险为 \\(\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\)，对于肿瘤染色呈阳性的患者，死亡风险为 \\(\\psi\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\)。 拟合的 Weibull 分布的形状参数估计为 \\(\\hat\\gamma = 0.937\\)。Group I 女性的尺度参数估计为 \\(\\hat\\lambda = 0.00414\\)，Group II 女性的尺度参数估计为 \\(\\hat\\lambda\\hat\\psi = 0.0105\\)。该 Weibull 模型下的风险比估计为 \\(\\hat \\psi = 2.55\\)，这与例 5.6 中假设生存时间呈指数分布获得的值相差不大。 将 \\(\\hat\\gamma = 0.937\\) 和 \\(\\hat\\lambda = 0.00414\\) 代入式 (5.29)，得出 Group I 女性的中位生存时间为 235.89. Group II 女性的中位生存时间估计可通过将 \\(\\hat\\gamma = 0.937\\) 和 \\(\\hat\\lambda = 0.0105\\) 代入该方程得出，并给出中位生存时间估计为 87.0. 肿瘤呈阳性染色的女性中位生存时间约为肿瘤呈阴性染色的女性的三分之一。 使用式 (5.33) 中给出的中位生存时间标准误的一般结果，通过取 \\(p = 50,\\hat\\gamma = 0.937\\) 并依次取 \\(\\hat\\lambda = 0.00414\\) 和 \\(0.0105\\) 来找到两个中位的标准误。结果分别为 114.126 和 20.550. 如 5.4.3 节中所述，每组女性的真实中位生存时间的 95% 置信限最好通过使用中位对数来获得。\\(\\log\\hat{t}(50)\\) 的标准误可使用式 (5.34) 求得，其中 \\[\\begin{aligned}\\text{se}\\left\\{\\log\\hat{t}(50)\\right\\}=\\frac{1}{\\hat{t}(50)}\\text{se}\\left\\{\\hat{t}(50)\\right\\}\\end{aligned}\\] 然后对 \\(\\log t(50)\\) 的置信限进行指数运算以给出 \\(t(50)\\) 本身的相应置信限。 在本示例中，两组女性的真实中位生存时间的 95% 置信区间分别为 \\((91.4, 608.9)\\) 和 \\((54.8, 138.3)\\)。请注意，阳性染色患者的中位生存时间的置信区间比阴性染色女性的中位生存时间的置信区间窄得多。这是因为肿瘤呈阴性染色的女性未删失生存时间相对较少。 5.6 Weibull 比例风险模型 式 (5.35) 中用于比较两组生存数据的模型可以很容易地推广为形似 3.1.2 节中描述的 Cox 回归模型的模型。假设为 \\(n\\) 个个体记录了 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 的值 \\(x_1, x_2,...,x_p\\)。在比例风险模型下，第 \\(i(i=1,2,\\ldots,n)\\) 个个体在 \\(t\\) 时刻的死亡风险为 \\[\\begin{align} h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})h_0(t) \\tag{5.41} \\end{align}\\] 尽管该模型形似式 (3.3) 中给出的模型，但有一个根本的区别：基线风险函数 \\(h_0(t)\\) 的指定。在 Cox 回归模型中，\\(h_0(t)\\) 的形式是未指定的，函数的形状本质上由实际数据决定。在本节考虑的模型中，假设生存时间具有 Weibull 分布，这对 \\(h_0(t)\\) 施加了特定的参数形式。 考虑一个个体，其在式 (5.41) 模型中的 \\(p\\) 个解释变量的值均为零。该个体的风险函数是 \\(h_0(t)\\)。如果该个体的生存时间服从尺度参数为 \\(\\lambda\\) 和形状参数为 \\(\\gamma\\) 的 Weibull 分布，那么风险函数为 \\[h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma-}1}\\] 使用式 (5.41)，研究中第 \\(i\\) 个个体的风险函数由下式给出 \\[\\begin{align} h_{\\boldsymbol{i}}(t)=\\exp(\\boldsymbol{\\beta&#39;x}_{{i}})\\lambda\\gamma t^{\\gamma-1} \\tag{5.42} \\end{align}\\] 其中 \\(\\boldsymbol{\\beta&#39;x}_{{i}}\\) 代表 \\(\\beta_{1}x_{1i}+\\beta_{2}x_{2i}+\\cdots+\\beta_{p}x_{pi}\\)。从该风险函数的形式可以看出，研究中第 \\(i\\) 个个体的生存时间服从尺度参数为 \\(\\lambda\\exp(\\boldsymbol{\\beta&#39;x_i})\\) 和形状参数为 \\(\\gamma\\) 的 Weibull 分布。这也是 Weibull 分布比例风险性的体现。该结果表明，模型中解释变量的作用是改变分布的尺度参数，而形状参数保持不变。 使用式 (1.6) 得到与式 (5.42) 中给出的风险函数相对应的生存函数，结果是 \\[\\begin{align} S_i(t)=\\exp\\left\\{-\\exp(\\boldsymbol{\\beta&#39;x}_i)\\lambda t^\\gamma\\right\\} \\tag{5.43} \\end{align}\\] 5.6.1 拟合模型 Weibull 比例风险模型是通过构建 \\(n\\) 个观测的似然函数来拟合的，并使该函数关于未知参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p,\\lambda\\) 和 \\(\\gamma\\) 最大化。由于每个个体的风险函数和生存函数不同，因此式 (5.15) 中的似然函数现在写为 \\[\\begin{align} \\prod_{i=1}^n\\left\\{h_i(t_i)\\right\\}^{\\delta_i}S_i(t_i) \\tag{5.44} \\end{align}\\] 将对数似然函数（而不是似然本身）关于未知参数最大化。根据式 (5.44)，对数似然为 \\[\\begin{aligned}\\sum_{i=1}^n[\\delta_i\\log h_i(t_i)+\\log S_i(t_i)]\\end{aligned}\\] 将式 (5.42) 和 (5.43) 中的 \\(h_i(t_i)\\) 和 \\(S_i(t_i)\\) 代入后，对数似然变为 \\[\\begin{aligned}\\sum_{i=1}^n\\left[\\delta_i\\{\\boldsymbol{\\beta&#39;x}_i+\\log(\\lambda\\gamma)+(\\gamma-1)\\log t_i\\}-\\lambda\\exp(\\boldsymbol{\\beta&#39;x}_i)t^\\gamma\\right]\\end{aligned}\\] 可以写成 \\[\\begin{align} \\sum_{i=1}^n\\left[\\delta_i\\{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i+\\log(\\lambda\\gamma)+\\gamma\\log t_i\\}-\\lambda\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)t^\\gamma\\right]-\\sum_{i=1}^n\\delta_i\\log t_i \\tag{5.45} \\end{align}\\] 该表达式中的最后一项 \\(-\\sum_{i=1}^n\\delta_i\\log t_i\\) 不涉及任何未知参数，并且可以从似然中省略。所得对数似然函数为 \\[\\begin{align} \\sum_{i=1}^n\\left[\\delta_i\\{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i+\\log(\\lambda\\gamma)+\\gamma\\log t_i\\}-\\lambda\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)t^\\gamma\\right] \\tag{5.46} \\end{align}\\] 它与根据式 (5.45) 中给出的完全对数似然获得的值相差 \\(\\sum_{i=1}^n\\delta_i\\log t_i\\)。当使用计算机软件拟合 Weibull 比例风险模型时，对数似然通常根据式 (5.46) 计算。该表达式也将用于本书给出的示例中。 拟合参数比例风险模型的计算机输出通常包括参数估计的标准误，从中可以得到相对风险的置信区间以及生存时间分布的中位数和其他参数。 具体而言，假设式 (5.42) 模型中参数估计为 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p,\\hat{\\lambda}\\) 和 \\(\\hat\\gamma\\)，则研究中第 \\(i\\) 个个体（其在模型中解释变量的值为 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\)）的生存函数估计为 \\[\\begin{aligned}\\hat{S}_i(t)=\\exp\\left\\{-\\exp(\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi})\\hat{\\lambda}t^{\\hat{\\gamma}}\\right\\}\\end{aligned}\\] 相应的风险函数估计为 \\[\\begin{aligned}\\hat{h}_i(t)&amp;=\\exp(\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi})\\hat{\\lambda}\\hat{\\gamma}t^{\\boldsymbol{\\gamma}-1}\\end{aligned}\\] 这两个函数都是时间 \\(t\\) 的连续函数，对于模型中解释变量具有特定值的个体，该函数可以估计，并关于 \\(t\\) 绘制图形。 将式 (5.28) 中的结果推广到尺度参数为 \\(\\lambda\\exp(\\boldsymbol{\\beta&#39;x_i})\\) 的 Weibull 分布的情况，解释变量向量为 \\(\\boldsymbol x_i\\) 的个体生存时间分布的第 \\(p\\) 个百分位数估计为 \\[\\begin{align} \\hat{t}(p)=\\left\\{\\frac{1}{\\hat{\\lambda}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol x_i)}\\log\\left(\\frac{100}{100-p}\\right)\\right\\}^{1/\\hat{\\gamma}} \\tag{5.47} \\end{align}\\] 因此，该个体中位生存时间估计为 \\[\\begin{align} \\hat{t}(50)=\\left\\{\\frac{\\log2}{\\hat{\\lambda}\\exp(\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i)}\\right\\}^{1/\\hat{\\gamma}} \\tag{5.48} \\end{align}\\] \\(\\hat t(p)\\) 的标准误和 \\(t(p)\\) 的相应区间估计在 5.6.2 节中推导。 5.6.2 Weibull 模型百分位数的标准误 如 5.4.3 节所述，Weibull 比例风险模型生存时间分布的第 \\(p\\) 个百分位数估计的标准误 \\(\\hat{t}(p)\\)，如式 (5.47) 所示，是根据 \\(\\log \\hat t(p)\\) 的方差中得出的。记 \\[\\begin{aligned}c_p=\\log\\log\\left(\\frac{100}{100-p}\\right)\\end{aligned}\\] 我们根据式 (5.47) 得到 \\[\\begin{align} \\log\\hat{t}(p)=\\frac1{\\hat{\\gamma}}\\left(c_p-\\log\\hat{\\lambda}-\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i\\right) \\tag{5.49} \\end{align}\\] 这是 \\(p + 2\\) 个参数估计 \\(\\hat{\\lambda},\\hat{\\gamma}\\) 和 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 的函数，该函数的近似方差可以通过式 (5.30) 中结果的进一步推广来求出，这种推广最好用矩阵形式表示。 假设 \\(\\hat{\\boldsymbol \\theta}\\) 是由 \\(k\\) 个参数估计 \\(\\hat{\\theta}_1,\\hat{\\theta}_2,\\ldots,\\hat{\\theta}_k\\) 构成的向量，\\(g(\\hat{\\boldsymbol \\theta})\\) 是这 \\(k\\) 个估计的函数，则 \\(g(\\hat{\\boldsymbol \\theta})\\) 的近似方差由下式给出： \\[\\begin{align} \\operatorname{var}\\left\\{g(\\hat{\\boldsymbol{\\theta}})\\right\\}\\approx\\boldsymbol{d}(\\hat{\\boldsymbol{\\theta}})&#39;\\operatorname{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\boldsymbol{d}(\\hat{\\boldsymbol{\\theta}}) \\tag{5.50} \\end{align}\\] 其中 \\(\\operatorname{var}(\\hat{\\boldsymbol{\\theta}})\\) 为 \\(\\hat{\\boldsymbol \\theta}\\) 中的估计的 \\(k\\times k\\) 方差-协方差阵，\\(\\boldsymbol{d}(\\hat{\\boldsymbol{\\theta}})\\) 为具有 \\(k\\) 个分量的向量，其中第 \\(i\\) 个元素为 \\[\\left.\\frac{\\partial g(\\hat{\\boldsymbol{\\theta}})}{\\partial\\hat{\\theta}_i}\\right|_{\\hat{\\boldsymbol{\\theta}}}\\] 其中 \\(i=1,2,\\ldots,k\\)。 我们现在将 \\(\\boldsymbol V\\) 记作 \\(\\hat{\\lambda},\\hat{\\gamma}\\) 和 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 的 \\((p +2) \\times (p + 2)\\) 的方差-协方差矩阵。接下来，根据式 (5.49)，\\(\\log \\hat t(p)\\) 关于这些参数估计的导数为： \\[\\begin{aligned} &amp;\\begin{aligned}\\frac{\\partial\\log\\widehat{t}(p)}{\\partial\\hat{\\lambda}}\\end{aligned} =-\\frac1{\\hat{\\lambda}\\hat{\\gamma}} \\\\ &amp;\\begin{aligned}\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\gamma}}\\end{aligned} =-\\frac{c_p-\\log\\hat{\\lambda}-\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i}{\\hat{\\gamma}^2} \\\\ &amp;\\begin{aligned}\\frac{\\partial\\log\\hat{t}(p)}{\\partial\\hat{\\beta}_j}\\end{aligned} =-\\frac{x_{ji}}{\\hat{\\gamma}} \\end{aligned}\\] 其中 \\(j=1,2,\\ldots,p\\)，\\(x_{ji}\\) 为 \\(\\boldsymbol x_i\\) 的第 \\(j\\) 个分量。式 (5.50) 中的向量 \\(\\boldsymbol{d}(\\hat{\\boldsymbol{\\theta}})\\) 可表示为 \\(-\\hat{\\gamma}^{-1}\\boldsymbol{d}_0\\)，其中 \\(\\boldsymbol{d}_0\\) 的分量为 \\(\\hat{\\lambda}^{-1},\\hat{\\gamma}^{-1}\\{c_p-\\log\\hat{\\lambda}-\\hat{\\boldsymbol{\\beta}}&#39;\\boldsymbol{x}_i\\}\\) 以及 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\)。那么 \\(\\log \\hat t(p)\\) 的标准误为 \\[\\begin{align} \\text{se }\\left\\{\\log\\hat{t}(p)\\right\\}=\\hat{\\gamma}^{-1}√\\left(\\boldsymbol{d&#39;}_0\\boldsymbol{Vd}_0\\right) \\tag{5.51} \\end{align}\\] 其中 \\(\\hat t(p)\\) 本身的标准误由下式获得： \\[\\begin{align} \\text{se}\\left\\{\\hat{t}(p)\\right\\}=\\hat{t}(p)\\text{ se }\\left\\{\\log\\hat{t}(p)\\right\\} \\tag{5.52} \\end{align}\\] 请注意，对于不包含解释变量的零模型，式 (5.52) 中的标准误 \\(\\hat t(p)\\) 简化为式 (5.53) 中的结果。 \\(\\log t(p)\\) 的置信限可根据 \\(\\log \\hat t(p)\\) 的标准误求出，如式 (5.51) 所示，\\(t(p)\\) 的置信区间可通过对这些置信限进行指数运算得到。 5.6.3 模型的对数线性形式 大多数用于拟合 Weibull 比例风险模型的计算机软件使用的模型形式与 5.6 节中所述的不同。其原因将在 5.11 节中给出，但目前我们观察到式 (5.52) 中的风险函数可表示为 \\[\\begin{align} h_i(t)&amp;=\\frac{1}{\\sigma t}\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right) \\end{align}\\] 式 (5.43) 相应的生存函数为 \\[\\begin{aligned}S_i(t)=\\exp\\left\\{-\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\right\\}\\end{aligned}\\] 在这些式子中，\\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_p\\) 是模型中 \\(p\\) 个解释变量的系数，其中对于第 \\(i\\) 个个体，解释变量的值为 \\(x_{1{i}},x_{2{i}},\\ldots,x_{{pi}}\\)，且 \\(\\mu,\\sigma\\) 为未知参数。模型这两种表示之间的对应关系满足 \\[\\begin{align} \\lambda=\\exp(-\\mu/\\sigma),\\quad\\gamma=\\sigma^{-1},\\quad\\beta_j=-\\alpha_j/\\sigma \\tag{5.53} \\end{align}\\] 其中 \\(j=1,2,\\ldots,p\\)，\\(\\mu,\\sigma\\) 分别称为截距和尺度参数。 一般来说，使用模型的对数线性形式 (log-linear form) 来估计风险函数、生存函数、生存时间分布的百分位数以及它们的标准误会更直接，相关的表达式将在后面 5.12 节中的式 (5.66), (5.67) 和 (5.69) 给出。 这种模型的表示使得在比例风险模型中很难获得对数风险比 \\(\\beta\\) 的置信区间，因为输出中只给出了 \\(\\alpha\\) 的估计的标准误。具体来说，在拟合 Weibull 比例风险模型时，输出通常提供 \\(\\alpha=-\\sigma\\beta\\) 的估计 \\(\\hat{\\alpha}\\) 和 \\(\\hat\\alpha\\) 的标准误。\\(\\beta\\) 的相应估计很容易根据 \\(\\hat{\\beta}=-\\hat{\\alpha}/\\hat{\\sigma}\\) 得到，但 \\(\\hat\\beta\\) 的标准误计算起来比较复杂。 为获得 \\(\\hat\\beta\\) 的标准误，我们可以使用 5.4.3 节式 (5.30) 给出的结果。使用这个结果，函数 \\[g(\\hat{\\alpha},\\hat{\\sigma})=-\\frac{\\hat{\\alpha}}{\\hat{\\sigma}}\\] 的方差的近似为 \\[\\begin{align} \\left(\\frac{\\partial g}{\\partial\\hat{\\alpha}}\\right)^2\\operatorname{var}\\left(\\hat{\\alpha}\\right)+\\left(\\frac{\\partial g}{\\partial\\hat{\\sigma}}\\right)^2\\operatorname{var}\\left(\\hat{\\sigma}\\right)+2\\left(\\frac{\\partial g}{\\partial\\hat{\\alpha}}\\frac{\\partial g}{\\partial\\hat{\\sigma}}\\right)\\operatorname{cov}\\left(\\hat{\\alpha},\\hat{\\sigma}\\right) \\tag{5.54} \\end{align}\\] \\(g\\big(\\hat{\\alpha},\\hat{\\sigma}\\big)\\) 关于 \\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 的导数由下式给出 \\[\\begin{aligned}\\frac{\\partial g}{\\partial\\hat{\\alpha}}=-\\frac{1}{\\hat{\\sigma}},\\quad\\frac{\\partial g}{\\partial\\hat{\\sigma}}=\\frac{\\hat{\\alpha}}{\\hat{\\sigma}^2}\\end{aligned}\\] 因此使用式 (5.54) \\[\\begin{aligned}\\operatorname{var}\\left(-\\frac{\\hat{\\alpha}}{\\hat{\\sigma}}\\right)&amp;\\approx\\left(-\\frac{1}{\\hat{\\sigma}}\\right)^2\\operatorname{var}\\left(\\hat{\\alpha}\\right)+\\left(\\frac{\\hat{\\alpha}}{\\hat{\\sigma}^2}\\right)^2\\operatorname{var}\\left(\\hat{\\sigma}\\right)+2\\left(-\\frac{1}{\\hat{\\sigma}}\\right)\\left(\\frac{\\hat{\\alpha}}{\\hat{\\sigma}^2}\\right)\\operatorname{cov}\\left(\\hat{\\alpha},\\hat{\\sigma}\\right)\\end{aligned}\\] 经代数计算后，近似方差变为 \\[\\begin{align} \\frac1{\\hat{\\sigma}^4}\\left\\{\\hat{\\sigma}^2\\operatorname{var}\\left(\\hat{\\alpha}\\right)+\\hat{\\alpha}^2\\operatorname{var}\\left(\\hat{\\sigma}\\right)-2\\hat{\\alpha}\\hat{\\sigma}\\operatorname{cov}\\left(\\hat{\\alpha},\\hat{\\sigma}\\right)\\right\\} \\tag{5.55} \\end{align}\\] 该函数的平方根就是 \\(\\hat \\beta\\) 的标准误。 示例 5.8 (患乳腺癌妇女的预后) 现在使用两组乳腺癌患者的生存时间数据来说明对数风险比标准误的计算。在此示例中，使用 Weibull 比例风险模型的对数线性形式拟合的计算机输出来说明风险比的估计以及估计的标准误的计算。 在拟合包含治疗效应（用变量 \\(X\\) 表示，对于阴性染色的女性，\\(X = 0\\)，对于阳性染色，\\(X = 1\\)）的模型时，我们发现 \\(X\\) 的系数估计为 \\(\\hat \\alpha = -0.9967\\)。此外，\\(\\mu\\) 和 \\(\\sigma\\) 的估计分别为 \\(\\hat\\mu = 5.8544\\) 和 \\(\\hat\\sigma = 1.0668\\)。阳性染色女性 (\\(X = 1\\)) 相对于阴性染色女性 (\\(X = 0\\)) 的对数风险比估计为 \\[\\begin{aligned}\\hat{\\beta}&amp;=-\\frac{-0.9967}{1.0668}=0.9343\\end{aligned}\\] 相应的风险比 \\(\\operatorname{exp}(\\hat{\\beta})=2.55\\)，如示例 5.7 所示。 \\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 的标准误通常包含在标准计算机输出中，分别为 0.5441 和 0.1786. 因此，\\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 的方差估计分别为 0.2960 和 0.0319. \\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 之间的协方差通常也可以从计算机软件中找到，尽管它通常不是默认输出的一部分。发现其值为 -0.0213. 将 \\(\\hat\\alpha\\) 和 \\(\\hat\\sigma\\) 及其方差和协方差代入表达式 (5.55)，我们得到 \\[\\begin{aligned}\\text{var }(\\hat{\\beta})\\approx0.2498\\end{aligned}\\] 因此 \\(\\hat\\beta\\) 的标准误为 \\(\\text{se}\\left(\\hat{\\beta}\\right)=0.4998\\)。这可以用于构建相应真实风险比的置信区间。 5.6.4 探索性分析 当我们面对单个生存数据样本时，或者当组别数量较少且每组中有相当多的个体时，用于评估数据是否可以通过 Weibull 分布建模，以及比例风险假设是否有效的图形程序（如 5.2 节和 5.5.1 节所述）非常有效。但是，在死亡数较少且组数相对较多时，可能无法估计每组的生存函数，从而估计对数累积风险函数。 例如，考虑表 3.6 给出的肾癌患者的生存时间数据。在这里，根据年龄组和是否进行了肾切除术对个体进行分类，可得到年龄组和肾切除术状态的六种组合。为检验各组生存时间的 Weibull 分布假设，以及各组之间的比例风险假设，需要为每组绘制对数累积风险图。每个年龄组中未进行肾切除术的患者数量都很小，因此无法准确估计这些组的生存函数。如果研究中有更多的人死亡且未进行肾切除术，就有可能可以绘制对数累积风险图。如果该图具有六条平行直线，Weibull 比例风险模型可能是令人满意的。 当模型包含连续变量时，首先需要对它们的值进行分组，然后才能获得对数累积风险图。这也可能导致某些组中的个体数量不足，无法估计对数累积风险函数。 构建对数累积风险图时，除了使用每种因素水平的组合外，唯一的替代方案就是忽略一些因素。然而，由此产生的图形可能非常具有误导性。例如，若按照 \\(A\\) 的水平分组（忽略 \\(B\\)），或者按照 \\(B\\) 的水平分组（忽略 \\(A\\)），所得对数累积风险图可能并不会让人怀疑 Weibull 假设或比例风险假设。然而，如果在 \\(A\\) 和 \\(B\\) 水平的每个组合下绘制对数累积风险图，该图可能不会显示四条平行线。同理，当忽略 \\(A\\) 或 \\(B\\) 时，得到的对数累积风险图可能并不会显示一系列平行的直线，但为 \\(A\\) 和 \\(B\\) 的所有组合绘图时，可能会出现平行线。通过以下示例说明这一特性。 示例 5.9 (数值说明) 假设将若干个体按照 \\(A\\)，\\(B\\) 两因素的水平进行分类，各有两个水平，其生存时间如表 5.1 所示。 表 5.1 图 5.16 所示的对数累积风险图是根据 \\(A\\) 的两个水平分类绘制的，忽略了因素 \\(B\\) 的水平。而图 5.17 则是根据 \\(B\\) 的水平绘制，忽略 \\(A\\) 的水平。 图 5.16 图 5.17 根据图 5.16，没有理由怀疑 \\(A\\) 的两个水平上的生存时间的 Weibull 分布假设，并且比例风险的假设显然是站得住脚的。然而，图 5.17 显示的交叉线却强烈表明，当个体根据 \\(B\\) 的水平进行分类时，风险不成比例。当根据 \\(A\\) 和 \\(B\\) 的水平对 37 个生存时间进行分类时，出现了不同的情况。基于这四组的对数累积风险图如图 5.18 所示。这四条平行线表明，各组之间比例风险假设的有效性是毋庸置疑的。 图 5.18 在这个例子中，\\(B\\) （忽略 \\(A\\)）的对数累积风险图之所以具有误导性，是因为 \\(A\\) 和 \\(B\\) 之间存在交互作用。查看数据后可发现，平均而言，对于 \\(B=1\\) 和 \\(B=2\\) 患者之间生存时间的差异，\\(A=2\\) 时的差异大于 \\(A=1\\) 的差异。 即使对数累积风险图没有理由怀疑 Weibull 比例风险模型的假设，也需要使用 7 章描述的方法来检查拟合模型的有效性。当无法使用对数累积风险图来探索 Weibull 分布是否为生存时间提供了合理的模型时，第 3 章描述的基于 Cox 回归模型的程序可能会有所帮助，即，使用 3.10 节中描述的程序拟合包含所有有意义的解释变量的 Cox 回归模型，并估计基线风险函数。该函数的图形可以表明 Weibull 分布的假设是否成立。具体来说，如果 Cox 模型中估计的基线风险函数递增或递减，则 Weibull 模型可以提供比 Cox 回归模型更简明的基线风险函数的总结。 由于拟合的 Cox 模型的基线风险函数估计可能有些不规则，因此将拟合的 Cox 回归模型所得的基线累积风险函数估计或基线生存函数与 Weibull 模型所得的相应函数估计进行比较可能会更有成效。 5.7 比较替代的 Weibull 比例风险模型 为了确定 Weibull 比例风险模型中应包括哪些解释变量，需要对替代模型进行比较。不同 Weibull 模型之间的比较可以使用类似于 3.5 节中描述的针对 Cox 回归模型的方法。 假设一个模型包含另一个模型的解释变量的子集，因此这两个模型是嵌套的。那么可以根据统计量 \\(-2 \\log \\hat{L}\\) 来比较两个模型，其中 \\(\\hat L\\) 是拟合模型下似然函数的最大值。对于包含 \\(p\\) 个解释变量的模型，样本似然是 \\(p + 2\\) 个未知参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p,\\lambda\\) 和 \\(\\gamma\\) 的函数。似然函数的最大值就是似然函数取这些参数的估计 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p,\\hat{\\lambda}\\) 和 \\(\\hat \\gamma\\) 时的函数值。 更具体地说，假设模型 (1) 包含 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\)，另一个模型 (2) 包含额外 \\(q\\) 个解释变量 \\(X_{p+1},X_{p+2},\\ldots,X_{p+q}\\)。在这两个模型下第 \\(i\\) 个个体的风险函数估计为： 模型 (1)：\\(h_i(t)=\\exp\\{\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi}\\}\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}-1}\\) 模型 (2)：\\(h_i(t)=\\exp\\{\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_{p+q}x_{p+q,i}\\}\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}-1}\\) 其中 \\(x_{1i},x_{2i},\\ldots,x_{p+q,i}\\) 为第 \\(i\\) 个个体 \\(p+q\\) 个解释变量的值。模型 (1) 和模型 (2) 下的最大似然值分别用 \\(\\hat L_1\\) 和 \\(\\hat L_2\\) 表示。\\(-2\\log\\hat{L}_1\\) 与 \\(-2\\log\\hat{L}\\) 值之差，\\(-2\\{\\log\\hat{L}_1-\\log\\hat{L}_2\\}\\)，在声称额外 \\(q\\) 个变量的系数均为零的原假设下，服从自由度为 \\(q\\) 的近似卡方分布。如果与卡方分布的百分位点相比，该差非常大，我们将推断模型中除了已包含的 \\(p\\) 个项之外还需要额外的 \\(q\\) 个项。由于在比较模型时使用了 \\(-2\\log\\hat{L}\\) 的值之差，因此在具体计算 \\(-2\\log\\hat{L}_2\\) 的值时使用的最大对数似然是基于式 (5.45) 还是 (5.46) 并不重要。 第 3.5 - 3.8 节中描述的建模过程同样适用于基于 Weibull 比例风险模型的模型，此处不再重复。然而，将使用两个示例说明变量选择策略。 示例 5.10 (肾癌的治疗) 第 3 章示例 3.4 介绍了 36 名患者的生存时间数据，这些患者根据年龄组和是否接受肾切除术进行了分类。在该示例中，使用 Cox 比例风险模型对数据进行了分析。在这里，使用 Weibull 比例风险模型进行分析。与示例 3.4 一样，第 \\(j\\) 个年龄组的效应表示为 \\(\\alpha_j\\)，与是否进行肾切除术相关的效应表示为 \\(\\nu_k\\)。第 \\(i\\) 个个体的风险函数 \\(h_i(t)\\) 有五个可能的模型，如下所示： 模型 (1)：\\(h_{{i}}(t) =h_0(t)\\) 模型 (2)：\\(h_{{i}}(t) =\\exp\\{\\alpha_j\\}h_0(t)\\) 模型 (3)：\\(h_{{i}}(t) =\\exp\\{\\nu_k\\}h_0(t)\\) 模型 (4)：\\(h_{{i}}(t) =\\exp\\{\\alpha_j+\\nu_k\\}h_0(t)\\) 模型 (5)：\\(h_{i}(t)=\\exp\\{\\alpha_j+\\nu_k+(\\alpha\\nu)_{jk}\\}h_0(t)\\) 在这些模型中，\\(h_0(t)=\\lambda\\gamma t^{{\\gamma}-1}\\) 为基线风险函数，\\(\\lambda\\) 和 \\(\\gamma\\) 必须与模型的线性部分一起估计。这五个模型的解释在示例 3.4 中给出，可以通过构建与年龄组和肾切除状态对应的指示变量来拟合，如示例 3.4 所示，或使用允许直接拟合因素的软件。 为数据拟合 Weibull 比例风险模型后，可得到 \\(-2\\log\\hat{L}\\) 的值。表 5.2 给出了五个感兴趣的模型。 表 5.2 表 5.2 和本书其他示例中的 \\(-2\\log\\hat{L}\\) 统计量的值是使用式 (5.46) 中的对数似然计算的。因此，这些值可能与某些计算机软件包给出的值相差 \\(2\\sum_{i=1}^n\\delta_i\\log t_i\\)，在本例中其值为 136.3733. 为模型 (4) 添加交互作用项后，\\(-2\\log\\hat{L}\\) 的值在两个自由度上减小了 4.69. 这种检查下在 10% 的水平上是显著的 (\\(P = 0.096\\))，因此存在一些证明表明年龄组和肾切除状态之间存在交互作用。作为比较，请注意，在示例 3.4 中拟合 Cox 回归模型时，交互作用并不显著 (\\(P = 0.220\\))。 通过检查模型下的风险比，可以更详细地研究交互作用。在模型 (5) 下，第 \\(i\\) 个个体的风险函数估计为 \\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{\\hat{\\alpha}_j+\\hat{\\nu}_k+\\widehat{(\\alpha\\nu)}_{jk}\\}\\hat{h}_0(t)\\end{aligned}\\] 其中 \\[\\begin{aligned}\\hat{h}_0(t)=\\hat{\\lambda}\\hat{\\gamma}t^{\\boldsymbol{\\gamma}-1}\\end{aligned}\\] 为基线风险函数估计。由于基线风险函数相互抵消，第 \\(j(j = 1, 2, 3)\\) 个年龄组以及第 \\(k(k=1,2)\\) 个肾切除状态水平中的个体，相对于最年轻年龄组以及没有接受过肾切除术的个体，风险比的对数为 \\[\\begin{align} \\hat{\\alpha}_j+\\hat{\\nu}_k+\\widehat{(\\alpha\\nu)}_{jk}-\\hat{\\alpha}_1-\\hat{\\nu}_1-\\widehat{(\\alpha\\nu)}_{11} \\tag{5.56} \\end{align}\\] 如示例 3.4 所示，可以通过定义年龄组的指示变量 \\(A_2\\) 和 \\(A_3\\) 以及肾切除状态的指示变量 \\(N\\) 来拟合数据。在该示例中，\\(A_2\\) 对于第二年龄组中的个体来说是 1，否则为 0；\\(A_3\\) 对于第三年龄组中的个体来说是 1，否则为 0；如果已经进行了肾切除术，则 \\(N\\) 是 1，否则为 0. 因此，拟合项 \\(\\alpha_j\\) 对应于拟合变量 \\(A_2\\) 和 \\(A_3\\)，拟合项 \\(\\nu_k\\) 对应于拟合 \\(N\\)，拟合交互项 \\((\\alpha\\nu)_{jk}\\) 对应于拟合乘积 \\(A_2N = A_2 × N\\) 和 \\(A_3N = A_3 × N\\)。为了拟合模型 (5)，需在模型中包含五个变量 \\(A_2,A_3,N,A_2N,A_3N\\)。通过这种指示变量的选择，当 \\(j\\) 或 \\(k\\) 为 1 时，\\(\\hat{\\alpha}_1=0,\\hat{\\nu}_1=0\\) 以及 \\(\\widehat{\\left(\\alpha\\nu\\right)}_{{j}k}=0\\)。其他的 \\(\\hat{\\alpha}_j,\\hat{\\nu}_k\\) 和 \\(\\widehat{\\left(\\alpha\\nu\\right)}_{jk}\\) 的值是 \\(A_2,A_3,N,A_2N,A_3N\\) 的系数，如表 5.3 所示。 表 5.3 许多计算机软件包隐式地 (internally) 设置指示变量，因此可以直接从输出中获得表 5.3 中的估计。然而，此处重复先前给出的警告，当使用软件包来拟合因子时，如果要正确解释输出结果，则必须知道用于定义指示变量的编码。 当使用上面指定的指示变量时，式 (5.56) 中给出的风险比对数简化为 \\[\\hat{\\alpha}_j+\\hat{\\nu}_k+\\widehat{(\\alpha\\nu)}_{jk}\\] 其中 \\(j=1,2,3,k=1,2\\)。表 5.4 给出了相对于基线风险的个体风险。基线风险对应于未接受肾切除术的最年轻年龄组中的个体，因此这些个体的风险比为 1. 表 5.4 该表有助于解释年龄组和肾切除状态之间的交互作用，因为肾切除术的效应对于三个年龄组中的每个个体是不同的。对于两个最小年龄组的患者，肾切除术大大降低了任何特定时间的死亡风险。但对 70 岁以上的患者，进行肾切除术对死亡风险没有太大影响。我们还发现，对于那些未进行肾切除术的患者，年龄对死亡风险影响不大。 可以通过类似的方式得到中位生存时间估计。使用式 (5.48)，第 \\(j(j=1,2,3)\\) 个年龄组和第 \\(k(k=1,2)\\) 个肾切除状态的患者的中位生存时间估计为 \\[\\hat t(50)=\\left\\{\\frac{\\log2}{\\hat\\lambda\\exp\\{\\hat\\alpha_j+\\hat\\nu_k+\\widehat{(\\alpha\\nu)}_{jk}\\}}\\right\\}^{1/\\hat\\gamma}\\] 当对数据拟合包含交互项的模型时，基线风险函数的参数估计为 \\(\\hat\\lambda=0.0188\\) 和 \\(\\hat\\gamma=1.5538\\)。表 5.5 给出了每个年龄组和肾切除状态组合的个体的中位生存时间估计（以月为单位）。 表 5.5 该表显示，肾切除术可使 70 岁以下患者的中位生存时间延长四倍以上。 70 岁以上患者的中位生存时间受肾切除术影响不大。 我们以一个警告来结束这个例子。对于年龄组和肾切除状态的某些组合，特别是未进行肾切除术的个体，风险比和中位生存时间是基于少量的生存时间进行估计的。因此，这类量的标准误估计将会很大（此处未给出）。 示例 5.11 (卵巢癌患者的化疗) 卵巢癌患者术后可能会接受一个疗程的化疗。在一项关于两种不同形式化疗的研究中，Edmunson et al. (1979) 比较了单独使用环磷酰胺和环磷酰胺联用阿霉素的抗肿瘤作用。该试验涉及 26 名女性，她们体内仅残留少量肿瘤，且所有直径大于 2 厘米的肿瘤均已经手术切除。术后，根据残留病灶是否完全切除或部分切除，对患者进行分类。在试验开始时还记录了患者的年龄及其表现状态。反应变量为随机接受两种化疗方案之一后的生存天数。数据集中的变量如下： \\(Time\\)：生存时间天数 \\(Status\\)：事件指示（0 = 删失，1 = 非删失） \\(Treat\\)：治疗（1 = 单独，2 = 联合） \\(Age\\)：患者年龄 \\(Rdisease\\)：残留病灶的程度（1 = 不完全，2 = 完全） \\(Perf\\)：表现状态（1 = 良好，2 = 糟糕） 表 5.6 列出了从 Therneau (1986) 获取的数据。 表 5.6 在对这些数据进行建模时，因素 Treat, RDisease 和 Perf 各有两个水平，并将作为变量进行拟合，这些变量采用表 5.6 中给出的值。当然，这意味着基线风险函数不能直接解释，因为不可能存在这些变量的值都为零的个体。 从计算和解释的角度来看，重新定义 (relocate) 变量 Age, Rdisease, Perf 和 Treat 的值更方便。如果使用变量 Age − 50 来代替 Age，并将 Rdisease, Perf 和 Treat 减去 1，则基线风险对应于 50 岁、有不完全残留病灶、表现良好且分配到环磷酰胺组的个体的风险。但是，在本例中将使用原始变量。 我们首先确定哪些预后因素与患者的生存时间相关。表 5.7 给出了为该数据拟合一系列模型的统计量 \\(-2\\operatorname{log}\\hat{L}\\) 的值。 表 5.7 当拟合仅包含 Age, Rdisease 和 Perf 之一的 Weibull 模型时，我们发现 Age 和 Rdisease 都会导致 \\(-2\\operatorname{log}\\hat{L}\\) 的值减小，且在 5% 的水平上显著。在拟合 Age 后，变量 Rdisease 和 Perf 分别进一步将 \\(-2\\operatorname{log}\\hat{L}\\) 减小了 1.903 和 0.048，这两个变量在 10% 的水平上都不显著。此外，当将 Age 添加到已包含 Rdisease 的模型中时，在 1 个自由度上，\\(-2\\operatorname{log}\\hat{L}\\) 的减小量为 13.719，这是非常显著的（\\(P&lt;0.001\\)）。这使我们得出结论：Age 是唯一需要纳入模型的预后变量。 现在为模型添加与治疗效应相关的项。在 1 个自由度上，\\(-2\\operatorname{log}\\hat{L}\\) 的值减小了 2.440，不足以使其在 10% 的水平上显著（\\(P=0.118\\)）。因此，只有非常微弱的证据表明两种化疗对死亡风险的效应存在差异。相比之下，当单独的 Treat 被添加到零模型中时，\\(-2\\operatorname{log}\\hat{L}\\) 的值从 59.534 减小为 58.355。与 1 个自由度的卡方分布的百分点相比，1.179 的减小当然并不显著。因此，忽略 Age 会低估治疗效应的大小。 为了探讨治疗差异是否随着年龄的增长而一致，为模型添加以 Age 和 Treat 的乘积形成的交互作用项。此时，\\(-2\\operatorname{log}\\hat{L}\\) 仅减小 1.419. 这种减小远未达到显著性，因此没有必要在模型中包括交互作用项。 变量 Treat 将保留在模型中，因为兴趣集中在治疗效应的大小上。那么第 \\(i\\) 个个体在时间 \\(t\\) 时死亡风险的拟合模型为 \\[\\begin{aligned}\\hat{h}_i(t)&amp;=\\exp\\{0.144\\,Age_i-1.023\\,Treat_i\\}\\hat{\\lambda}\\hat{\\gamma}t^{\\hat{\\gamma}-1}\\end{aligned}\\] 其中 \\(\\hat{\\lambda}=5.645\\times10^{-9}\\) 以及 \\(\\hat{\\gamma}=1.822\\)。在该模型中，\\(Treat=1\\) 表示单独治疗，\\(Treat=2\\) 表示联合治疗。因此，相对于联合治疗的患者，接受单独治疗的患者的风险的估计为 \\[\\begin{aligned}\\hat{\\psi}&amp;=\\exp\\{(-1.023\\times1)-(-1.023\\times2)\\}=2.78\\end{aligned}\\] 这意味着接受单独治疗的患者在任何特定时间死亡的可能性是接受联合治疗的患者的近三倍。以这种方式表达，联合化疗治疗的益处似乎是巨大的。从这一表述来看，联合治疗的好处似乎相当大。然而，考虑到这些数据本身固有的变异，这种相对风险仅在 12% 的水平上显著大于 1（\\(P=0.118\\)）。 可以根据下式估计给定年龄的患者接受给定治疗的中位生存时间 \\[\\hat t(50)=\\left\\{\\frac{\\log2}{\\hat\\lambda\\exp(0.144\\,Age-1.023\\,Treat)}\\right\\}^{1/\\hat\\gamma}\\] 例如，一名 60 岁（Age = 60）的女性单独服用环磷酰胺（Treat = 1），中位生存时间估计为 423 天。然而，同龄但接受联合治疗的患者的中位生存时间估计为 741 天，几乎是接受单一治疗患者的两倍。这些估计的置信区间可以使用示例 5.7 中说明的方法得到。 5.8 Gompertz 比例风险模型 尽管 Weibull 模型是使用最广泛的参数比例风险模型，但 Gompertz 模型已在人口学和生物科学中得到应用。 很容易看出 Gompertz 分布具有 5.5.1 节中描述的比例风险性，因为如果我们取 \\(h_0(t)=\\lambda e^{\\theta t}\\)，则 \\(\\psi h_0(t)\\) 也是一个 Gompertz 风险函数，参数为 \\(\\psi\\lambda\\) 和 \\(\\theta\\)。 第 \\(i\\) 个个体在时间 \\(t\\) 的死亡风险用一般 Gompertz 比例风险模型可表示为 \\[\\begin{aligned}h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})\\lambda e^{\\theta t}\\end{aligned}\\] 其中 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\) 为第 \\(i\\) 个个体 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 的值，\\(i=1,2,\\ldots,n\\)，以及 \\(\\beta,\\lambda\\) 和 \\(\\theta\\) 是未知参数。该模型可以通过最大化式 (5.14) 或 (5.15) 中给出的似然函数来拟合。\\(\\beta\\) 系数可解释为对数风险比，使用 5.7 节中描述的方法来比较替代模型。不涉及新的原则。 示例 5.12 (卵巢癌患者的化疗) 在关于卵巢癌患者生存时间的示例 5.11 中，拟合了包含变量 Age 和 Treat 的 Weibull 比例风险模型。为进行比较，现在拟合包含这两个变量的 Gompertz 比例风险模型。在此模型下，第 \\(i\\) 个患者的拟合风险函数为 \\[\\begin{aligned}\\hat{h}_i(t)=\\exp\\{0.122Age_i-0.848Treat_i\\}\\hat{\\lambda}\\exp(\\hat{\\theta}t)\\end{aligned}\\] 其中 \\(\\hat{\\lambda}=1.706\\times10^{-6}\\) 以及 \\(\\hat{\\theta}=0.00138\\)。将 Treat 添加到仅包含 Age 的 Gompertz 比例风险模型后，\\(-2\\operatorname{log}\\hat{L}\\) 值的变化现在为 1.686 (\\(P = 0.184\\))。因此，与 Weibull 模型相比，该模型下治疗效应的风险比现在为 \\(\\exp(0.848) = 2.34\\)，更小且不那么显著。 5.9 模型选择 生存数据比例风险模型的一大吸引力在于，不必对生存时间采用特定的概率分布。然而，当 Weibull 分布适用于的观测生存数据时，比例风险模型的参数版本为数据建模提供了更合适的基础。 5.5.1 节中描述的基于对数累积风险函数的诊断图可能会揭示 Weibull 生存时间的假设是否合理，但正如已经指出的那样，在存在影响生存时间的解释变量的情况下，这种技术往往提供很少的信息。在这种情况下，为了帮助在 Cox 和 Weibull 比例风险模型之间进行选择，拟合 Cox 回归模型并检查基线风险函数的形状是有用的。拟合的 Weibull 基线累积风险函数或拟合的基线生存函数也可以与 Cox 回归模型的相应估计进行比较，如 5.6.4 节所述。 第 7 章将讨论的残差分析可用于研究一个模型是否比另一个模型拟合得更好。然而只有在特殊情况下，模型检查诊断才能提供令人信服的证据，以证明其中一个或另一个更容易被接受。 一般来说，除非样本数据包含大量死亡时间，否则很难区分 Cox 和 Weibull 比例风险模型。当两模型拟合优度相差无几时，可以比较两模型线性部分的 \\(\\beta\\) 参数估计的标准误。如果 Weibull 模型的标准误明显小于 Cox 模型的标准误，那么基于效能 (efficiency) 的考虑，应优先选择 Weibull 模型。另一方面，如果这些标准误相似，鉴于 Cox 模型的假设限制性较少，Cox 模型可能是首选模型。 "],["参数回归模型.html", "►参数回归模型 5.10 用于两组比较的加速失效时间模型 5.11 一般加速失效时间模型 5.12 参数加速失效时间模型 5.13 拟合并比较加速失效时间模型 5.14 参数模型中解释的变异的度量 5.15 比例几率模型 5.16 治愈率建模 5.17 协变量调整的影响 5.18 延伸阅读", " ►参数回归模型 5.10 用于两组比较的加速失效时间模型 加速失效时间模型 (accelerated failure time model) 是一种通用的生存数据模型，其中假设在个体上测量的解释变量会在时间尺度上起乘性作用 (act multiplicatively)，从而影响个体在时间轴上前进的速率。这意味着模型可以从疾病进展速度的角度来解释，这种解释具有直观的吸引力。在 5.11 节介绍模型的一般形式之前，先详细描述用于比较两组患者生存时间的加速失效时间模型。 假设患者随机接受两种疗法之一，标准疗法 S 或新疗法 N. 在加速失效时间模型下，接受新疗法的个体的生存时间视为接受标准疗法的个体的生存时间的倍数。因此，新疗法的效应是“加速”或“减慢”时间的流逝。在此假设下，接受新疗法的个体在时间 \\(t\\) 后生存的概率就是接受标准疗法的个体在时间 \\(t/\\phi\\) 后生存的概率，其中 \\(\\phi\\) 是未知的正的常数。 现在令 \\(S_S(t)\\) 和 \\(S_N(t)\\) 是两个治疗组中个体的生存函数。那么，对于生存时间 \\(t\\) 的任何值，加速失效时间模型指定 \\[\\begin{aligned}S_N(t)=S_S(t/\\phi)\\end{aligned}\\] 对该模型的一种解释是，接受新疗法的个体的寿命是该个体在标准疗法下的寿命的 \\(\\phi\\) 倍。因此，参数 \\(\\phi\\) 反映了新疗法对生存时间的影响，称为时间比 (time ratio). 当关注的终点是患者的死亡时，与接受标准疗法的患者相比，\\(ϕ&lt;1\\) 对应于接受新疗法的患者死亡时间的加速。因此，从延长寿命的角度来看，标准疗法会更合适。另一方面，当终点是从某种疾病状态恢复时，当新疗法的效应是加快恢复时间时，会得到 \\(\\phi&lt;1\\)。此时，新疗法将优于标准疗法。量 \\(\\phi^{-1}\\) 是时间比的倒数，是新疗法生存时间相对于标准疗法生存时间的加速或减速的因子，称为加速因子 (acceleration factor). 时间比或加速因子也可用新疗法和标准疗法的患者中位生存时间 \\(t_N (50)\\) 和 \\(t_S(50)\\) 来解释。这些值满足 \\(S_N\\{t_N(50)\\}=S_S\\{t_S(50)\\}=0.5\\)。现在，在加速失效时间模型下，\\(S_N\\{t_N(50)\\}=S_S\\{t_N(50)/\\phi\\}\\)，因此可以得出 \\(t_N (50) = \\phi t_S(50)\\)。换句话说，在加速失效时间模型下，接受新疗法的患者的中位生存时间是接受标准疗法的患者的 \\(\\phi\\) 倍。事实上，同样的论证可用于生存时间分布的任何百分位数。这意味着接受新疗法的患者的生存时间分布的第 \\(p\\) 个百分位数 \\(t_N (p)\\) 满足 \\(t_N (p) = \\phi t_S(p)\\)，其中 \\(t_S(p)\\) 是标准疗法的第 \\(p\\) 个百分位数。该模型的这种解释对临床医生特别有吸引力。 根据式 (1.4) 中给出的生存函数、概率密度函数和风险函数之间的关系，两个治疗组中个体的密度和风险函数的关系为 \\[\\begin{aligned}f_N(t)=\\phi^{-1}f_S(t/\\phi)\\end{aligned}\\] 以及 \\[\\begin{aligned}h_N(t)=\\phi^{-1}h_S(t/\\phi)\\end{aligned}\\] 现在，让 \\(X\\) 是一个指示变量，对于接受标准疗法的个体，它的值为 0，而对于接受新疗法的个体，它的值为 1. 第 \\(i\\) 个个体的风险函数可以表示为 \\[\\begin{align} h_i(t)=\\phi^{-x_i}h_0(t/\\phi^{x_i}) \\tag{5.57} \\end{align}\\] 其中 \\(x_i\\) 是研究中第 \\(i\\) 个个体的 \\(X\\) 值。将 \\(x_i=0\\) 代入此表达式，可以看出函数 \\(h_0(t)\\) 是接受标准疗法的个体的风险函数。这再次被称为基线风险函数。接受新治疗个体的风险函数则为 \\(\\phi^{-1}h_0(t/\\phi)\\)。 参数 \\(\\phi\\) 必须为非负，因此可以方便地设置 \\(\\phi = e^\\alpha\\)。式 (5.57) 中的加速失效时间模型则变为 \\[\\begin{align} h_{{i}}(t)=e^{{-}\\alpha x_{{i}}}h_{{0}}(t/e^{\\alpha x_{{i}}}) \\tag{5.58} \\end{align}\\] 因此，新疗法中个体的风险函数现在为 \\(e^{\\large-\\alpha}h_0(t/e^{\\large\\alpha})\\)。 5.10.1 与比例风险模型的比较 为了说明比例风险模型和加速失效时间模型之间的差异，再次假设要对两组（例如 Group I 和 Group II）中的个体的生存时间进行建模。进一步假设对于 Group I 中的个体，风险函数由下式给出 \\[\\left.h_0(t)=\\left\\{\\begin{array}{l}0.5\\text{ if }t\\leqslant1\\\\1.0\\text{ if }t&gt;1\\end{array}\\right.\\right.\\] 其中时间以月为单位。这种类型的风险函数源自分段指数模型 (piecewise exponential model)，因为在每个时间段内的恒定风险意味着生存时间呈指数分布，但两个时间段的均值不同。该模型提供了一种表示可变 (variable) 风险函数的简单方法，并可能适用于存在短期风险恒定但在阈值时间后风险突然增加的情况。 现在让 \\(h_P (t)\\) 和 \\(h_A(t)\\) 分别表示比例风险模型和加速失效时间模型下 Group II 个体的风险函数。因此，我们可以写处两个风险函数 \\[\\begin{aligned}h_P(t)=\\psi h_0(t)\\end{aligned}\\] 以及 \\[\\begin{aligned}h_A(t)=\\phi^{-1}h_0(t/\\phi)\\end{aligned}\\] 两种模型下 Group II 个体对应的生存函数分别为 \\[S_P(t)=\\left[S_0(t)\\right]^\\psi \\] 以及 \\[\\begin{aligned}S_A(t)=S_0(t/\\phi)\\end{aligned}\\] 使用 \\(S(t)=\\exp\\{-\\int_0^th(u)\\mathrm{d}u\\}\\) 这一结果，基线生存函数为 \\[\\left.S_0(t)=\\left\\{\\begin{array}{ll}e^{-0.5t}&amp;\\text{if }t\\leqslant1\\\\e^{-0.5-(t-1)}&amp;\\text{if }t&gt;1\\end{array}\\right.\\right.\\] 由于如果 \\(t\\le 1\\) 则 \\(S_0(t)\\geqslant0.61\\)，因此中位数 \\(t\\) 出现在生存函数的第二部分，即满足 \\(\\exp\\{-0.5-(t-1)\\}=0.5\\)。因此，Group I 患者的中位生存时间为 1.19 个月。 为了说明比例风险模型和加速失效时间模型下的风险函数之间的差异，请考虑 \\(\\psi=\\phi^{-1}=2.0\\) 的特殊情况。在比例风险模型下，Group II 个体的中位生存时间为 0.69 个月，在加速失效时间模型下为 0.60 个月。两种模型下两组的风险函数如图 5.19 所示，相应的生存函数如图 5.20 所示。 图 5.19 图 5.20 在加速失效时间模型中，Group II 个体的风险从 1.0 增加到 2.0 的时间比比例风险模型更早发生。在加速失效时间模型下，生存函数的“拐点”也发生得更早。 5.10.2 百分位-百分位图 百分位-百分位图 (percentile-percentile plot)，也称为分位数-分位数图 (quantile-quantile plot) 或 Q-Q 图，提供了一种用于评估两组生存数据的加速失效时间模型有效性的探索性方法。回想一下，分布的第 \\(p\\) 个百分位数是值 \\(t(p)\\)，\\(p\\) 的取值区间为 \\((0, 100)\\)。因此，第 \\(p\\) 个百分位数满足 \\[\\begin{aligned}t(p)&amp;=S^{-1}\\left(\\frac{100-p}{100}\\right)\\end{aligned}\\] 现在令 \\(t_0(p)\\) 和 \\(t_1(p)\\) 为根据两组生存数据的生存函数估计的第 \\(p\\) 个百分位数。\\(p\\) 的值可以取为 10, 20,…, 90，只要每组的观测数不是太少。因此，两组的百分位数可以表示为 \\[\\begin{aligned}t_0(p)=S_0^{-1}\\left(\\frac{100-p}{100}\\right),\\quad t_1(p)=S_1^{-1}\\left(\\frac{100-p}{100}\\right)\\end{aligned}\\] 其中 \\(S_0(t)\\) 和 \\(S_1(t)\\) 为两组的生存函数。对于任何给定的 \\(p\\) 值，有 \\[\\begin{align} S_1\\{t_1(p)\\}=S_0\\{t_0(p)\\} \\tag{5.59} \\end{align}\\] 在加速失效时间模型下，\\(S_1(t) = S_0(t/\\phi)\\)，因此第二组的第 \\(p\\) 个百分位数 \\(t_1(p)\\) 满足 \\[\\begin{aligned}S_1\\{t_1(p)\\}=S_0\\{t_1(p)/\\phi\\}\\end{aligned}\\] 使用式 (5.59) \\[\\begin{aligned}S_0\\left\\{t_0(p)\\right\\}=S_0\\left\\{t_1(p)/\\phi\\right\\}\\end{aligned}\\] 因此 \\[\\begin{aligned}t_0(p)=\\phi^{-1}t_1(p)\\end{aligned}\\] 现在令 \\(\\hat{t}_0(p),\\hat{t}_1(p)\\) 表示两组的百分位数估计，因此 \\[\\begin{aligned}\\hat{t}_0(p)=\\hat{S}_0^{-1}\\left(\\frac{100-p}{100}\\right),\\quad\\hat{t}_1(p)=\\hat{S}_1^{-1}\\left(\\frac{100-p}{100}\\right)\\end{aligned}\\] 如果加速失效时间模型合适，对于适当选择的 \\(p\\) 值，\\(\\hat{t}_0(p)\\) 关于 \\(\\hat{t}_1(p)\\) 的图形应给出一条穿过原点的直线。这条线的斜率将是加速因子 \\(\\phi^{−1}\\) 的估计。因此，该图可用于对加速失效时间模型的充分性 (adequacy) 进行探索性评估。从这个意义上说，它类似于对数累积风险图，后者在 4.4.1 节中用于检查比例风险模型的有效性。 示例 5.13 (患乳腺癌妇女的预后) 在本例中，最初在第 1 章示例 1.2 给出的阴性或阳性乳腺癌女性的生存时间数据用于说明百分位图。每组生存时间分布的百分位数可以通过各自生存函数的 Kaplan-Meier 估计来估计。这些数据列在表 5.8 中。 表 5.8 相对较少的死亡次数，以及这两组女性数据的删失模式，意味着并非所有的百分位数都可以估计。因此，百分位图将只有四对点，如图 5.21 所示。这些点落在一条相当直的线上，这表明加速失效时间模型并非不合适。然而，鉴于图中的点数有限，必须谨慎对待这一结论。 图 5.21 图 5.21 中各点之间的直线的斜率大约为 3，这是加速因子的粗略估计。对此的解释是，与肿瘤呈阴性染色的妇女相比，肿瘤呈阳性染色的妇女的疾病进展加速了三倍。 等价地，时间比约为三分之一，因此肿瘤呈阳性染色的女性的寿命约为肿瘤染色呈阴性的女性的三分之一。我们还可以说，肿瘤呈阳性染色的女性的中位生存时间估计约为肿瘤呈阴性染色的女性的三分之一。 5.11 一般加速失效时间模型 式 (5.58) 中的加速失效时间模型可以推广到研究中每个个体的 \\(p\\) 个解释变量的值已被记录的情况。根据一般加速失效时间模型 (general accelerated failure time model)，第 \\(i\\) 个个体在时刻 \\(t\\) 的风险函数 \\(h_i(t)\\) 为 \\[\\begin{align} h_i(t)=e^{-\\eta_i}h_0(t/e^{\\eta_i}) \\tag{5.60} \\end{align}\\] 其中 \\[\\begin{aligned}\\eta_i=\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\end{aligned}\\] 为模型的线性部分，其中 \\(x_{ji}\\) 是第 \\(i(i=1,2,\\ldots,n)\\) 个个体第 \\(j\\) 个解释变量 \\(X_j(j=1,2,\\ldots,p)\\) 的值。与比例风险模型一样，基线风险函数 \\(h_0(t)\\) 是 \\(p\\) 个解释变量值全为零的个体在时间 \\(t\\) 的死亡风险。该基线风险是这些个体的生存时间的假定概率分布的风险函数。第 \\(i\\) 个个体对应的生存函数为 \\[\\begin{aligned}S_i(t)=S_0\\{t/\\exp(\\eta_i)\\}\\end{aligned}\\] 其中 \\(S_0(t)\\) 是基线生存函数。 参数加速失效时间模型在后文中统一采用模型的对数线性表示。这种表示表明，生存数据的加速失效时间模型与回归分析中使用的一般线性模型密切相关。此外，大多数计算机软件包都采用这种形式的模型来进行加速失效时间建模。 5.11.1 加速失效时间模型的对数线性形式 考虑随机变量 \\(T_i\\) 的对数线性模型，该模型与生存研究中第 \\(i\\) 个个体的寿命相关，模型为 \\[\\begin{align} \\log T_i=\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i \\tag{5.61} \\end{align}\\] 在此模型中，\\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_p\\) 是 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 值的未知系数，其中第 \\(i\\) 个个体的值为 \\(x_{1i}, x_{2i},...,x_{pi}\\)，\\(\\mu,\\sigma\\) 是另外两个参数，分别称为截距和尺度参数。量 \\(\\epsilon_i\\) 是一个随机变量，用于对 \\(\\log T_i\\) 值与模型线性部分的偏差进行建模，并假设 \\(\\epsilon_i\\) 服从特定的概率分布。在该模型的表述中，\\(\\alpha\\) 参数反映了每个解释变量对生存时间的效应；正值表明生存时间随解释变量值的增加而增加，反之亦然。 为了阐明模型的这种表示与式 (5.60) 中的表示之间的关系，考虑 \\(T_i\\) 的生存函数，其中 \\(T_i\\) 是与第 \\(i\\) 个个体的生存时间相关的随机变量，使用式 (5.61)，这由下式给出 \\[\\begin{align} S_i(t)=\\mathrm{P}(T_i\\geqslant t)=\\mathrm{P}\\left\\{\\exp(\\mu+\\boldsymbol{\\alpha&#39;x}_i+\\sigma\\epsilon_i)\\geqslant t\\right\\} \\tag{5.62} \\end{align}\\] 其中 \\(\\boldsymbol{\\alpha}&#39;\\boldsymbol{x}_i=\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\)。 现在，根据式 (5.62)，\\(S_i(t)\\) 可写为如下形式 \\[\\begin{aligned}S_i(t)&amp;=\\text{P}\\left\\{\\exp(\\mu+\\sigma\\epsilon_i)\\geqslant t/\\exp(\\boldsymbol{\\alpha&#39;x}_i)\\right\\}\\end{aligned}\\] 以及基线生存函数 \\(S_0(t)\\)，即 \\(\\boldsymbol x=\\boldsymbol 0\\) 的个体的生存函数，为 \\[S_0(t)=\\text{P }\\{\\exp(\\mu+\\sigma\\epsilon_i)\\geqslant t\\}\\] 那么有 \\[\\begin{align} S_i(t)=S_0\\{t/\\exp(\\boldsymbol{\\alpha&#39;x}_i)\\} \\tag{5.63} \\end{align}\\] 这是加速失效时间模型中第 \\(i\\) 个个体生存函数的一般形式。 使用第 1 章的式 (1.5) 可获得风险函数之间的对应关系。具体来说，对式 (5.63) 两边取对数，乘以 −1，并对 \\(t\\) 进行微分，得到 \\[\\begin{aligned}h_i(t)=\\exp(-\\boldsymbol{\\alpha&#39;x}_i)h_0\\{t/\\exp(\\boldsymbol{\\alpha&#39;x}_i)\\}\\end{aligned}\\] 这就是式 (5.60) 中的模型，其中 \\(\\eta_i=\\boldsymbol{\\alpha&#39;x}_i\\)。 第 \\(i\\) 个个体的生存时间分布的第 \\(p\\) 个百分位数满足 \\[S_i\\{t_i(p)\\}=\\frac{100-p}{100}\\] 并根据式 (5.63) \\[\\begin{aligned}S_i\\{t_i(p)\\}&amp;=S_0\\{t_i(p)/(\\exp(\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi})\\}\\end{aligned}\\] 用 \\(t_0(p)\\) 表示基线生存函数 \\(S_0(t)\\) 的第 \\(p\\) 个百分位数，这样 \\(t_0(p)\\) 就是所有解释变量都取值为零的个体的第 \\(p\\) 个百分位数。 \\[\\begin{aligned}t_i(p)=\\exp(\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi})t_0(p)\\end{aligned}\\] 这证实了系数 \\(\\alpha\\) 可以根据解释变量对生存时间分布百分位数的效应来解释。 在加速失效时间模型中，第 \\(i\\) 个个体的时间比为 \\(\\exp(\\boldsymbol{\\alpha&#39;x}_i)\\)。根据式 (5.61)，单个解释变量 \\(X_j(j = 1, 2,...,p)\\) 的值增加一个单位，会导致 \\(\\log T_i\\) 增加 \\(\\alpha_j\\)。这意味着生存时间增加了 \\(\\exp(\\alpha_j)\\) 倍。因此，对数线性加速失效时间模型中解释变量系数的指数 (exponentiated coefficients) 可以直接解释为时间比。 模型的对数线性公式也可给出第 \\(i\\) 个个体生存函数的一般形式，即 \\[\\begin{aligned}S_i(t)=\\mathrm{P}(T_i\\geqslant t)=\\mathrm{P}(\\log T_i\\geqslant\\log t)\\end{aligned}\\] 根据式 (5.61) \\[\\begin{align} S_{i}(t) x&amp;=\\mathrm{P}(\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i\\geqslant\\log t)\\\\ &amp;=\\mathrm{P}\\left(\\epsilon_i\\geqslant\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}\\sigma\\right) \\tag{5.64} \\end{align}\\] 如果我们现在将式 (5.61) 的对数线性模型中的随机变量 \\(\\epsilon_i\\) 的生存函数写为 \\(S_{\\epsilon_i} (\\epsilon)\\)，则根据式 (5.64)，第 \\(i\\) 个个体的生存函数可以表示为 \\[\\begin{align} S_i(t)&amp;=S_{\\epsilon_i}\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right) \\tag{5.65} \\end{align}\\] 该结果显示了如何从 \\(\\epsilon_i\\) 分布的生存函数中找到 \\(T_i\\) 的生存函数，反之亦然。结果还表明，可以从 \\(\\epsilon_i\\) 的许多概率分布中导出加速失效时间模型，尽管有些分布比其他分布更容易处理。 下一节将描述一些特定的加速失效时间模型。 5.12 参数加速失效时间模型 加速失效时间模型的对数线性公式中 \\(\\epsilon_i\\) 分布的特定选择（如 5.11 节所述）将得到与第 \\(i\\) 个个体生存时间相关的随机变量的分布。然而，式 (5.61) 中模型的表示所得模型的参数化与 5.1 节中给出的模型不同。基于生存时间的 Weibull, log-logistic 和 log-normal 分布的参数加速失效时间模型在实践中最常用，因此对这些模型进行详细描述。 5.12.1 Weibull 加速失效时间模型 假设生存时间具有尺度参数 \\(\\lambda\\) 和形状参数 \\(\\gamma\\) 的 Weibull 分布，写作 \\(W(\\lambda, \\gamma)\\)，因此基线风险函数为 \\[\\begin{aligned}h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\end{aligned}\\] 那么第 \\(i\\) 个个体的风险函数由式 (5.60) 给出 \\[\\begin{aligned}h_i(t)=e^{-\\eta_i}\\lambda\\gamma(e^{-\\eta_i}t)^{\\gamma-1}=(e^{-\\eta_i})^\\gamma\\lambda\\gamma t^{\\gamma-1}\\end{aligned}\\] 使得该个体的生存时间服从 \\(W(\\lambda e^{-\\gamma\\eta_i},\\gamma)\\) 分布。因此，Weibull 分布具有加速失效时间性 (accelerated failure time property). 事实上，它是唯一具有比例风险和加速失效时间性的概率分布。 由于 Weibull 分布同时具有比例风险性和加速失效时间性，因此两模型的参数之间存在直接的对应关系。如果基线风险是 \\(W(\\lambda,\\gamma)\\) 分布的风险函数，则在式 (5.41) 中的一般比例风险模型下的生存时间具有 \\(W(\\lambda\\exp(\\boldsymbol{\\beta&#39;x}_i),\\gamma)\\) 的分布，而加速失效时间模型下的生存时间具有 \\(W(\\lambda\\exp(-\\gamma\\boldsymbol{\\alpha&#39;x}_i),\\gamma)\\) 的分布。因此，将加速失效时间模型线性部分的解释变量系数乘以 \\(-\\gamma\\) 时，我们得到了比例风险模型中相应的系数 \\(\\beta\\)。在对两组进行比较的特殊情况下，加速失效时间模型下 \\(\\phi=e^{\\alpha}\\) 的时间比对应于比例风险模型中 \\(\\phi^{-\\gamma}=e^{-\\gamma\\alpha}\\) 的风险比。 对于式 (5.61) 中模型的对数线性表示，如果 \\(T_i\\) 具有 Weibull 分布，则 \\(\\epsilon_i\\) 实际上具有一种称为 Gumbel 分布的极值分布 (extreme value distribution)。这是一个不对称分布，均值为 0.5772（欧拉常数），方差为 \\(\\pi^2/6\\)。Gumbel 分布的生存函数为 \\[\\begin{aligned}S_{\\epsilon_i}(\\epsilon)=\\exp(-e^{\\epsilon})\\end{aligned}\\] 其中 \\(-\\infty&lt;\\epsilon&lt;\\infty\\)。该分布的累计风险和风险函数分别为 \\(H_{{\\epsilon_i}}(\\epsilon)=e^{{\\epsilon}}\\) 和 \\(h_{{\\epsilon}_i}(\\epsilon)=e^\\epsilon\\)。 为了证明随机变量 \\(T_i=\\exp(\\mu+\\boldsymbol{\\alpha&#39;x}_i+\\sigma\\epsilon_i)\\) 具有 Weibull 分布，根据式 (5.65)，\\(T_i\\) 的生存函数为 \\[\\begin{align} S_i(t)=\\exp\\left\\{-\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\right\\} \\tag{5.66} \\end{align}\\] 这可以表示为如下形式 \\[\\begin{aligned}S_i(t)=\\exp\\left(-\\lambda_it^{1/\\sigma}\\right)\\end{aligned}\\] 其中 \\[\\begin{aligned}\\lambda_i=\\exp\\left\\{-(\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi})/\\sigma\\right\\}\\end{aligned}\\] 根据式 (5.5)，它是具有尺度参数 \\(\\lambda_i\\) 和形状参数 \\(\\sigma^{−1}\\) 的 Weibull 分布的生存函数。因此，式 (5.66) 是 5.6 节中描述的 Weibull 模型生存函数的加速失效时间表示。 Weibull 加速失效时间模型的累积风险函数可以直接从式 (5.66) 中的生存函数中找到，并由下式给出 \\[\\begin{aligned}H_i(t)=-\\log S_i(t)=\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}\\sigma\\right)\\end{aligned}\\] 也可以表示为 \\(\\lambda_it^{1/\\sigma}\\)，相应的风险函数由下式给出 \\[\\begin{align} h_i(t)&amp;=\\frac{1}{\\sigma t}\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right) \\tag{5.67} \\end{align}\\] 或 \\(h_{{i}}(t)=\\lambda_{{i}}\\sigma^{-1}t^{\\sigma^{-1}-1}\\) 现在，我们将这种形式的模型与 Weibull 比例风险模型的形式进行协调。根据式 (5.43)，第 \\(i\\) 个个体的生存函数为 \\[\\begin{align} S_i(t)=\\exp\\left\\{-\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})\\lambda t^\\gamma\\right\\} \\tag{5.68} \\end{align}\\] 其中 \\(\\lambda\\) 和 \\(\\gamma\\) 是 Weibull 基线风险函数的参数。式 (5.68) 可以写成以下形式 \\[\\begin{align} S_i(t)=\\exp\\left\\{-\\exp(\\gamma\\log t+\\log\\lambda+\\boldsymbol{\\beta&#39;x}_i)\\right\\} \\end{align}\\] 这表明式 (5.66) 和式 (5.68) 之间存在直接对应关系，即 \\[\\begin{aligned}\\lambda=\\exp(-\\mu/\\sigma),\\quad\\gamma=\\sigma^{-1},\\quad\\beta_j=-\\alpha_j/\\sigma\\end{aligned}\\] 其中 \\(j=1,2,\\ldots,p\\)。 在这种形式的模型中，第 \\(i\\) 个个体生存时间分布的第 \\(p\\) 个百分位数为 \\(t_i(p)\\)，其中 \\(S_i\\{t_i(p)\\}=1-(p/100)\\)，\\(S_i(t)\\) 由式 (5.66) 给出。经直接的代数计算后得到，对该个体，有 \\[\\begin{align} t_i(p)&amp;=\\exp\\left[\\sigma\\log\\left\\{-\\log\\left(\\frac{100-p}{100}\\right)\\right\\}+\\mu+\\boldsymbol{\\alpha}&#39;\\boldsymbol{x}_i\\right] \\tag{5.69} \\end{align}\\] 5.12.2 log-logistic 加速失效时间模型 现在假设生存时间具有 log-logistic 分布。如果式 (5.60) 中的一般加速失效时间模型中的基线风险函数是从参数为 \\(\\theta,\\kappa\\) 的 log-logistic 分布中导出的，则该函数由下式给出 \\[\\begin{aligned}h_0(t)=\\frac{e^\\theta\\kappa t^{\\kappa-1}}{1+e^\\theta t^\\kappa}\\end{aligned}\\] 在加速失效时间模型下，第 \\(i\\) 个个体在时间 \\(t\\) 的死亡风险为 \\[\\begin{aligned}h_i(t)=e^{-\\eta_i}h_0(e^{-\\eta_i}t)\\end{aligned}\\] 其中 \\(\\eta_i=\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\) 是第 \\(i\\) 个个体 \\(p\\) 个解释变量值的线性组合。因此 \\[\\begin{aligned}h_i(t)&amp;=\\frac{e^{-\\eta_i}e^\\theta\\kappa(e^{-\\eta_i}t)^{\\kappa-1}}{1+e^\\theta(e^{-\\eta_i}t)^\\kappa}\\end{aligned}\\] 即 \\[\\begin{aligned}h_i(t)=\\frac{e^{\\theta-\\kappa\\eta_i}\\kappa t^{\\kappa-1}}{1+e^{\\theta-\\kappa\\eta_i}t^\\kappa}\\end{aligned}\\] 那么，第 \\(i\\) 个个体的生存时间也具有 log-logistic 分布，参数为 \\(\\theta-\\kappa\\eta_i\\) 和 \\(\\kappa\\)。因此，log-logistic 分布也具有加速失效时间性。然而，这种分布不具有比例风险性。 式 (5.61) 中加速失效时间模型的对数线性形式也提供了 log-logistic 分布的表示。现在假设在这个公式中，\\(\\epsilon_i\\) 服从均值为零、方差为 \\(\\pi^2/3\\) 的 logistic 分布，因此 \\(\\epsilon_i\\) 的生存函数为 \\[S_{\\epsilon_i}(\\epsilon)=\\frac1{1+e^\\epsilon}\\] 使用式 (5.65)，\\(T_i\\) 的生存函数为 \\[\\begin{align} S_i(t)&amp;=\\left\\{1+\\exp\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\right\\}^{-1} \\tag{5.70} \\end{align}\\] 根据式 (5.9)，当 \\(T_i\\) 具有参数为 \\(\\theta-\\kappa\\eta_{{i}},\\kappa\\) 的 logistic 分布时，其中 \\(\\eta_{i}=\\alpha_{1}x_{1i}+\\alpha_{2}x_{2i}+\\cdots+\\alpha_{p}x_{pi}\\)，\\(T_i\\) 的生存函数为 \\[\\begin{aligned}S_i(t)&amp;=\\frac{1}{1+e^{\\theta-\\kappa\\eta_i}t^\\kappa}\\end{aligned}\\] 通过将该式与式 (5.70) 中生存函数的表达式进行比较，我们发现参数 \\(\\theta\\) 和 \\(\\kappa\\) 可以用 \\(\\mu\\) 和 \\(\\sigma\\) 表示，即 \\[\\begin{aligned}\\theta=-\\mu/\\sigma,\\quad\\kappa=\\sigma^{-1}\\end{aligned}\\] 这表明具有 log-logistic 生存时间的加速失效时间模型也可以用对数线性模型来表示。这是计算机软件通常采用的模型形式，因此基于计算机的参数估计通常是 \\(\\mu\\) 和 \\(\\sigma\\) 的估计，而不是 \\(\\theta\\) 和 \\(\\kappa\\) 的估计。 使用 \\(H_i(t)=-\\log S_i(t)\\) 得到累积风险函数，微分后得到风险函数 \\[\\begin{align} h_i(t)&amp;=\\frac{1}{\\sigma t}\\left\\{1+\\exp\\left[-\\left(\\frac{\\log t-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi}}{\\sigma}\\right)\\right]\\right\\}^{-1} \\tag{5.71} \\end{align}\\] 时间比或中位生存时间等量的估计可以直接从 \\(\\mu,\\sigma\\) 和 \\(\\alpha\\) 的估计中获得。例如，第 \\(i\\) 个个体的时间比为 \\(\\exp(\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi})\\)，根据式 (5.70)，生存时间分布的第 \\(p\\) 个百分位数为 \\[\\begin{aligned}t_i(p)&amp;=\\exp\\left\\{\\sigma\\log\\left(\\frac{p}{100-p}\\right)+\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\right\\}\\end{aligned}\\] 中位生存时间简单地为 \\[\\begin{align} t_i(50)&amp;=\\exp\\left\\{\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\right\\} \\tag{5.72} \\end{align}\\] 因此可以直接从模型的参数估计中获得中位数的估计。 5.12.3 log-normal 加速失效时间模型 如果假设生存时间具有 log-normal 分布，则基线生存函数由下式给出 \\[S_0(t)=1-\\Phi\\left(\\frac{\\log t-\\mu}\\sigma\\right)\\] 其中 \\(\\mu\\) 和 \\(\\sigma\\) 是两个未知参数。在加速失效时间模型下，第 \\(i\\) 个个体的生存函数为 \\[\\begin{aligned}S_i(t)=S_0(e^{-\\eta_i}t)\\end{aligned}\\] 其中 \\(\\eta_i=\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\) 为第 \\(i\\) 个个体 \\(p\\) 个解释变量值的线性组合。因此 \\[\\begin{align} S_i(t)=1-\\Phi\\left(\\frac{\\log t-\\eta_i-\\mu}\\sigma\\right) \\tag{5.73} \\end{align}\\] 这是个体 \\(i\\) 的生存函数，其生存时间具有参数 \\(\\mu + \\eta_i\\) 和 \\(\\sigma\\) 的 log-normal 分布。因此，log-normal 分布具有加速失效时间性。 在模型的对数线性公式中，如果 \\(\\log T_i\\) 服从正态分布，则与第 \\(i\\) 个个体生存时间相关的随机变量服从 log-normal 分布。因此，我们取式 (5.61) 中的 \\(\\epsilon_i\\) 服从标准正态分布，因此 \\(\\epsilon_i\\) 的生存函数为 \\[\\begin{aligned}S_{\\epsilon_i}(\\epsilon)=1-\\Phi(\\epsilon)\\end{aligned}\\] 那么，式 (5.65) 可直接导出式 (5.73)，并且 \\(T_i\\) 分布的第 \\(p\\) 个百分位可通过令 \\(S_i\\{t_i(p)\\}\\) 等于 \\(1 − (p/100)\\) 得出，从而得出 \\[\\begin{aligned}t_i(p)&amp;=\\exp\\left\\{\\sigma\\Phi^{-1}(p/100)+\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}\\right\\}\\end{aligned}\\] 特别地，\\(t(50)=\\operatorname{exp}(\\mu+\\boldsymbol{\\alpha&#39;x}_i)\\) 是第 \\(i\\) 个个体的中位生存时间。 风险函数也可根据式 (5.73) 中的生存函数中得出，但它的形式比较复杂。 5.13 拟合并比较加速失效时间模型 使用最大似然法拟合加速失效时间模型。似然函数最好从模型的对数线性表示中导出，然后使用迭代方法获得估计值。\\(n\\) 个观测生存时间 \\(t_1,t_2,\\ldots,t_n\\) 的似然由式 (5.14) 给出，即 \\[\\begin{aligned}L(\\boldsymbol{\\alpha},\\mu,\\sigma)&amp;=\\prod_{i=1}^n\\left\\{f_i(t_i)\\right\\}^{\\delta_i}\\left\\{S_i(t_i)\\right\\}^{1\\boldsymbol{-}\\delta_i}\\end{aligned}\\] 其中 \\(f_{i}(t_{i})\\) 和 \\(S_{{i}}(t_{{i}})\\) 为第 \\(i\\) 个个体在 \\(t_i\\) 处的密度函数和生存函数，以及 \\(\\delta_i\\) 是第 \\(i\\) 个观测的事件指示符，若第 \\(i\\) 个观测为事件则 \\(\\delta_i=1\\)，若为删失则为 0. 现在，根据式 (5.65) \\[\\begin{aligned}S_i(t_i)=S_{\\epsilon_i}(z_i)\\end{aligned}\\] 其中 \\(z_i=(\\log t_i-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi})/\\sigma\\)，将上式关于 \\(t\\) 的微分给出 \\[f_i(t_i)=\\frac{1}{\\sigma t_i}f_{\\epsilon_i}(z_i)\\] 那么，似然函数可以用 \\(\\epsilon_i\\) 的生存函数和密度函数来表示 \\[\\begin{aligned}L(\\boldsymbol{\\alpha},\\mu,\\sigma)&amp;=\\prod_{i=1}^n(\\sigma t_i)^{-\\delta_i}\\left\\{f_{\\epsilon_i}\\left(z_i\\right)\\right\\}^{\\delta_i}\\left\\{S_{\\epsilon_i}\\left(z_i\\right)\\right\\}^{1-\\delta_i}\\end{aligned}\\] 那么对数似然为 \\[\\begin{align} \\log L(\\boldsymbol{\\alpha},\\mu,\\sigma)=\\sum_{i=1}^n\\left\\{-\\delta_i\\log\\sigma-\\delta_i\\log t_i+\\delta_i\\log f_{\\epsilon_i}(z_i)+(1-\\delta_i)\\log S_{\\epsilon_i}(z_i)\\right\\} \\tag{5.74} \\end{align}\\] \\(p + 2\\) 个未知参数 \\(\\mu,\\sigma\\) 和 \\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_p\\) 的最大似然估计是通过使用 3.3.3 节中描述的 Newton-Raphson 程序最大化该函数来找到的。 请注意，式 (5.74) 中对数似然函数的表达式包含项 \\(-\\sum_{i=1}^n\\delta_i\\log t_i\\) ，不涉及任何未知参数。因此，该项可以从对数似然函数中省略，如 5.6.1 节中 Weibull 比例风险模型中所述。事实上，大多数计算机软件给出的用于加速失效时间建模的对数似然值不包括 \\(-\\sum_{i=1}^n\\delta_i\\log t_i\\) 的值。 拟合模型后，可以计算统计量 \\(-2\\operatorname{log}\\hat{L}\\) 的值，并将其用于嵌套模型之间的比较，就像之前在比例风险模型中做的一样。具体来说，为了比较两个嵌套模型，计算两个模型的统计量 \\(-2\\operatorname{log}\\hat{L}\\) 值之差，并与卡方分布的百分位点进行比较，其自由度等于模型线性部分中包含的 \\(\\alpha\\) 参数的数量。 一旦确定了合适的模型，就可以获得并绘制生存函数和风险函数的估计。拟合的模型可以根据解释变量影响的时间比或加速因子的估计，或根据生存时间分布的中位数和其他百分位数来解释。 示例 5.14 (患乳腺癌妇女的预后) 在此示例中，为患乳腺癌妇女生存时间数据拟合加速失效时间模型。首先考虑 Weibull 加速失效时间模型。与第 \\(i\\) 个女性生存时间 \\(T_i\\) 相关的随机变量的对数线性模型如下： \\[\\begin{aligned}\\log T_i=\\mu+\\alpha x_i+\\sigma\\epsilon_i\\end{aligned}\\] 其中 \\(\\epsilon_i\\) 具有 Gumbel 分布，\\(\\mu,\\sigma\\) 和 \\(\\alpha\\) 是未知参数，\\(x_i\\) 是与染色相关的解释变量 \\(X\\) 的值，使得如果第 \\(i\\) 个女性的肿瘤呈阴性染色，则 \\(x_i = 0\\)，如果肿瘤染色呈阳性，则 \\(x_i = 1\\)。拟合该模型后，我们得到 \\(\\hat{\\mu}=5.854,\\hat{\\sigma}=1.067\\) 以及 \\(\\hat\\alpha = -0.997\\)。 对于染色呈阳性的女性，时间比 \\(e^{\\alpha x_i}\\) 的估计为 \\(e^{\\large-0.997}=0.37\\)。因此，肿瘤染色呈阳性的女性的死亡时间约为肿瘤染色呈阴性的女性的三分之一。等价地，在该模型下，阳性染色可将死亡时间加快约 2.7 倍。这与示例 5.13 中发现的百分位-百分位图的斜率估计一致。 第 \\(i\\) 个女性的生存函数估计由式 (5.66) 给出 \\[\\hat{S_i}(t)=\\exp\\left\\{-\\exp\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}x_i}{\\hat{\\sigma}}\\right)\\right\\}\\] 并且对于 \\(x_i\\) 的两个值，可以绘制生存函数关于 \\(t\\) 的图形。使用式 (5.69)，在 Weibull 加速失效时间模型下，第 \\(i\\) 名女性的中位生存时间为 \\[\\begin{aligned}t_i(50)=\\exp\\left\\{\\sigma\\log(\\log2)+\\mu+\\alpha x_i\\right\\}\\end{aligned}\\] 阴性染色 (\\(x_i = 0\\)) 的女性的中位生存时间估计为 236 天，而阳性染色 (\\(x_i = 1\\)) 的女性的中位生存时间估计为 87 天，正如示例 5.7 所示。注意两个中位数的比值为 0.37，这是时间比。因此，肿瘤呈阳性染色的女性的中位生存时间约为肿瘤呈阴性染色的女性的三分之一。 第 \\(i\\) 个女性的风险函数估计由式 (5.67) 给出： \\[\\begin{aligned}\\hat{h}_i(t)=\\hat{\\sigma}^{-1}t^{\\hat{\\sigma}^{-1}-1}\\exp\\left(\\frac{-\\hat{\\mu}-\\hat{\\alpha}x_i}{\\hat{\\sigma}}\\right)\\end{aligned}\\] 即 \\[\\begin{aligned}\\hat{h}_i(t)&amp;=0.937t^{-0.063}\\exp(-5.488+0.934x_i)\\end{aligned}\\] 图 5.22 显示了两组妇女的这一函数图。 图 5.22 在 5.6 节给出的 Weibull 模型的比例风险表示中，第 \\(i\\) 名女性在时间 \\(t\\) 的死亡风险为 \\[h_{\\boldsymbol{i}}(t)=e^{\\boldsymbol{\\beta}x_{\\boldsymbol{i}}}h_{\\boldsymbol{0}}(t)\\] 若第 \\(i\\) 位女性的肿瘤染色呈阴性，\\(x_i\\) 的值为零，若肿瘤染色呈阳性，则为一。对于 Weibull 分布，基线风险函数为 \\[\\begin{aligned}h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\end{aligned}\\] 这是肿瘤染色呈阴性的女性的风险函数，因此 \\[\\begin{aligned}h_i(t)=e^{\\beta x_i}\\lambda\\gamma t^{\\gamma-1}\\end{aligned}\\] 参数 \\(\\lambda,\\gamma\\) 和 \\(\\beta\\) 的相应估计为 \\(\\hat \\lambda=\\exp(-\\hat{\\mu}/\\hat{\\sigma})=0.00414,\\hat{\\gamma}=1/\\hat{\\sigma}=0.937\\) 以及 \\(\\hat{\\beta}=-\\hat{\\alpha}/\\hat{\\sigma}=0.997\\)。Weibull 加速失效时间模型与 Weibull 比例风险模型之间的对应关系意味着后者模型下的风险比为 \\(e^{-\\alpha/\\sigma}=e^{\\beta}\\)，估计为 2.55。这与示例 5.7 中的值一致。 我们现在为相同数据集拟合 log-logistic 加速失效时间模型。根据模型的对数线性形式现在得到 \\(\\hat\\mu = 5.461,\\hat \\sigma = 0.805\\) 和 \\(\\hat\\alpha = −1.149\\)。时间比为 \\(e^\\alpha\\)，估计值为 \\(0.32\\)。这略小于 Weibull 加速失效时间模型下的结果。 根据式 (5.72)，该模型下第 \\(i\\) 名女性的中位生存时间由下式给出 \\[\\exp(\\mu+\\alpha x_i)\\] 其中阴性染色女性的中位生存时间估计为 235 天，阳性染色女性的中位生存时间估计为 75 天，这些值与 Weibull 加速失效时间模型所得值非常接近。 根据式 (5.71)，第 \\(i\\) 名女性的风险函数估计为 \\[\\begin{aligned}\\hat{h}_i(t)=\\frac{1}{\\hat{\\sigma}t}\\left\\{1+\\exp\\left[-\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}x_i}{\\hat{\\sigma}}\\right)\\right]\\right\\}^{-1}\\end{aligned}\\] 这是 \\[\\hat{h}_i(t)=1.243t^{-1}\\left\\{1+t^{-1.243}\\exp\\left(6.787-1.428x_i\\right)\\right\\}^{-1}\\] 图 5.23 显示了两组妇女的这一函数图。这可以与图 5.22 进行比较。 图 5.23 在这两种模型下，阴性染色者的风险函数非常相似。然而，log-logistic 模型下阳性染色者的风险函数与 Weibull 模型下的风险函数不同。拟合的 Weibull 和 log-logistic 模型的 \\(-2\\operatorname{log}\\hat{L}\\) 统计量的值分别为 121.77 和 118.495. 在此基础上，log-logistic 模型提供了稍好的拟合。第 7 章讨论的残差分析可能有助于在这两个模型之间进行选择，尽管对于这个小数据集，这样的分析不太可能提供非常丰富的信息。 最后，根据 5.1.2 节给出的模型参数化，基线风险函数为 \\[\\begin{aligned}h_0(t)=\\frac{e^\\theta\\kappa t^{\\kappa-1}}{1+e^\\theta t^\\kappa}\\end{aligned}\\] 因此研究中第 \\(i\\) 个女性的风险函数是 \\[\\begin{aligned}h_i(t)=\\frac{e^{\\theta-\\kappa\\alpha x_i}\\kappa t^{\\kappa-1}}{1+e^{\\theta-\\kappa\\alpha x_i}t^\\kappa}\\end{aligned}\\] \\(\\theta,\\kappa\\) 的相应估计为 \\(\\hat\\theta=-\\hat\\mu/\\hat\\sigma=-6.787,\\hat{\\kappa}=1/\\hat{\\sigma}=1.243\\)。 示例 5.15 (前列腺癌两种疗法的比较) 使用 log-logistic 加速失效时间模型进一步说明生存数据建模，这里考虑比较前列腺癌两种疗法的临床试验数据。这些数据首先在示例 1.4 中给出，并在示例 3.6 和 3.12 中使用 Cox 回归模型进行了分析。为了确定在 log-logistic 加速失效时间模型线性部分中应包含的项，可以再次遵循示例 3.6 中描述的程序。表 5.9 显示了具有四个预后变量（Age、Shb、Size 和 Index）所有组合的拟合模型的 \\(-2\\log\\hat{L}\\) 统计量的值。 表 5.9 正如示例 3.6，模型中需要变量 Size 和 Index. 当省略这两个变量中的任何一个时，\\(-2\\log\\hat{L}\\) 值的相应增量是显著的，当 Age 或 Shb 添加到模型中时，\\(-2\\log\\hat{L}\\) 都不会显著减小。 当在包含 Size 和 Index 的模型中加入与治疗效应对应的项 Treat 时，\\(-2\\log\\hat{L}\\) 减小为 21.245. 将该 1.867 的减小量与自由度为一的卡方分布的百分位点相比时，在 10% 的水平上并不显著 (\\(P=0.172\\))。也没有证据表明 Treat 与预后变量 Size 和 Index 之间有任何交互作用，因此结论为：治疗效应在统计学上不显著。 治疗效应的大小可以用时间比或加速因子来评估。根据模型的对数线性形式，与第 \\(i\\) 个患者的生存时间 \\(T_i\\) 相关的随机变量为： \\[\\begin{aligned}\\log T_i=\\mu+\\alpha_1\\textit{Size}_i+\\alpha_2\\textit{Inde}x_i+\\alpha_3\\textit{Treat}_i+\\sigma\\epsilon_i\\end{aligned}\\] 其中 \\(\\epsilon_i\\) 具有 logistic 分布，\\(Size_i\\) 和 \\(Index_i\\) 是第 \\(i\\) 个个体的肿瘤大小和 Gleason 指数的值，如果第 \\(i\\) 个个体在安慰剂组，则 \\(Treat_i\\) 为零，如果在治疗组，则为一。该模型中未知参数的最大似然估计为 \\(\\hat{\\mu}=7.661,\\hat{\\sigma}=0.338,\\hat{\\alpha}_1=-0.029,\\hat{\\alpha}_2=-0.293\\) 和 \\(\\hat{\\alpha}_3=0.573\\)。\\(\\alpha\\) 的值表明，肿瘤大小和肿瘤指数越大，生存时间往往越短，而接受活性治疗的个体生存时间往往越长。 使用式 (5.70)，第 \\(i\\) 个患者拟合的生存函数为 \\[\\begin{aligned}\\hat{S}_i(t)=\\left[1+\\exp\\left\\{\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}_1\\textit{Size}_i-\\hat{\\alpha}_2\\textit{Index}_i-\\hat{\\alpha}_3\\textit{Treat}_i}{\\hat{\\sigma}}\\right\\}\\right]^{-1}\\end{aligned}\\] 可以写成以下形式 \\[\\hat{S_i}(t)=\\left\\{1+t^{1/\\hat{\\sigma}}\\exp\\left(\\hat{\\zeta_i}\\right)\\right\\}^{-1}\\] 其中 \\[\\begin{aligned}\\hat{\\zeta}_i&amp;=\\frac{1}{\\hat{\\sigma}}\\left\\{-\\hat{\\mu}-\\hat{\\alpha}_1\\textit{Size}_i-\\hat{\\alpha}_2\\textit{Inde}x_i-\\hat{\\alpha}_3\\textit{Treat}_i\\right\\}\\end{aligned}\\] 也就是 \\[\\begin{aligned}\\hat{\\zeta}_i&amp;=-22.645+0.085\\textit{ Size}_i+0.865\\text{ }Index_i-1.693\\textit{ Treat}_i\\end{aligned}\\] 对累积风险函数估计 \\(\\hat{H_{i}}(t)=-\\operatorname{log}\\hat{S_{i}}(t)\\) 关于 \\(t\\) 微分，可以得到相应的风险函数估计。这给出了 \\[\\hat{h}_i(t)=\\frac1{\\hat{\\sigma}t}\\left\\{1+t^{-1/\\hat{\\sigma}}\\exp\\left(-\\hat{\\zeta}_i\\right)\\right\\}^{-1}\\] 也可直接从式 (5.71) 给出的风险函数获得该结果。 治疗组中的个体相对于对照组中的个体的时间比估计为 \\(e^{0.573}=1.77\\)。对这一结果的解释是，考虑到肿瘤的大小和指数后，己烯雌酚治疗的效应是使生存时间几乎翻倍。这种效应可能具有临床重要性，尽管它在统计上并不显著。然而，在接受这种解释之前，应使用适当的诊断来检查拟合模型的充分性。 通过对时间比对数的置信限求指数来找到时间比的置信区间。在此示例中，治疗效应时间比对数是风险函数模型中 \\(Treat\\) 的系数估计 -0.573，该标准误估计为 0.473. 因此，时间比的 95% 置信限为 \\(\\exp\\{0.573\\pm1.96\\times0.473\\}\\)，所求区间为 0.70 到 4.48. 请注意，此区间估计包括 1，这与之前发现的非显著治疗效应一致。 最后，根据 5.1.2 节的模型的参数化，第 \\(i(i=1,2,\\ldots,38)\\) 个患者的拟合风险函数为 \\[\\hat{h}_i(t)=e^{\\boldsymbol{-}\\hat{\\eta}_i}\\hat{h}_0(e^{\\boldsymbol{-}\\hat{\\eta}_i}t)\\] 其中 \\[\\begin{aligned}\\hat{\\eta_i}=-0.029\\text{ }Size_i-0.293\\text{ }Index_i+0.573\\text{ }Treat_i\\end{aligned}\\] 并且根据式 (5.8) \\[\\begin{aligned}\\hat{h}_0(t)=\\frac{e^{{\\hat{\\theta}}}\\hat{\\kappa}t^{{\\hat{\\kappa}}-1}}{1+e^{\\hat{\\theta}}t^{\\hat{\\kappa}}}\\end{aligned}\\] 这种形式的基线风险函数估计 \\(\\hat{h}_0(t)\\) 的参数估计为 \\(\\hat{\\theta}=-22.644\\) 和 \\(\\hat{\\kappa}=2.956\\)，该函数的图形如图 5.24 所示。 图 5.24 该图表明基线风险随着时间的推移而增加。与拟合的 Weibull 模型的基线风险函数的比较（也在图中）表明，在 log-logistic 模型下，基线风险函数估计不会增加得那么快。 5.14 参数模型中解释的变异的度量 Cox 回归模型中解释的变异的度量在第 3 章 3.12 节中进行了描述。本节将描述与参数加速失效时间模型中解释的变异的一般度量方法。根据式 (5.61)，该模型有 \\[\\begin{aligned}Y_i=\\log T_i=\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i\\end{aligned}\\] 其形式类似于第 3 章式 (3.33) 中的一般线性模型。然而，一般线性模型中的项 \\(\\epsilon_i\\) 被 \\(\\sigma\\epsilon_i\\) 取代，其中 \\(\\sigma\\) 是加速失效时间模型中的尺度参数，而 \\(\\epsilon_i\\) 的分布取决于生存时间的假定分布。类似于式 (3.35) 中 \\(R^2\\) 的统计量为 \\[\\begin{align} R_{P}^{2}=\\frac{\\hat{V}_{P}}{\\hat{V}_{P}+\\hat{\\sigma}^{2}\\operatorname{var}\\left(\\epsilon_{i}\\right)} \\tag{5.75} \\end{align}\\] 其中，如第 3 章 3.12.4 节所述，\\(\\hat{V}_P\\) 是拟合的加速失效时间模型中风险评分的样本方差，而 \\(\\hat{\\sigma}^{2}\\) 是尺度参数估计。 在 Weibull 分布的特殊情况下，\\(\\operatorname{var}\\left(\\epsilon_i\\right)=\\pi^2/6\\)，这来自 5.12.1 节。通过取 \\(\\sigma=1\\)，这种解释的变异的度量也可用于 Cox 比例风险模型，这是第 3 章式 (3.35) 中的 \\(R^2_P\\) 统计量。 当为具有 log-logistic 分布的生存时间拟合加速失效时间模型，式 (5.75) 中 \\(\\mathrm{var}\\left(\\epsilon_{\\boldsymbol{i}}\\right)=\\pi^{2}/3\\)，而对于 log-normal 生存时间 \\(\\mathrm{var}\\left(\\epsilon_{i}\\right)=1\\)。 \\(R^2_D\\) 统计量（在第 3 章的 3.12.4 节中描述）可以以类似的方式适用于参数生存模型。得到 \\[\\begin{aligned}R_D^2&amp;=\\frac{D_0^2}{D_0^2+\\hat{\\sigma}^2\\operatorname{var}\\left(\\epsilon_i\\right)}\\end{aligned}\\] 其中 \\(D_0\\) 是仅包含此项的 Cox 回归模型中正态得分变量的系数。 示例 5.16 (多发性骨髓瘤患者的生存率) 为了说明如何使用生存数据 Weibull 模型的解释的变异的度量，考虑多发性骨髓瘤患者生存时间数据，示例 3.17 中给出了拟合 Cox 回归模型的三个 \\(R^2\\) 统计量。对于包含变量 Hb 和 Bun 的 Weibull 模型，\\(R^2_P = 0.25\\) 且 \\(R^2_D = 0.23\\)。对于包含所有 7 个变量的模型，\\(R^2_P = 0.30\\) 以及 \\(R^2_D = 0.34\\)。这些值与拟合相应的 Cox 回归模型得到的值非常相似，因此 Cox 和 Weibull 模型具有相似的解释力。 5.14.1 参数模型的预测能力 第 3 章 3.13.4 节描述了在评估 Cox 回归模型预测能力时使用的时依 ROC. 事实上，一旦估计了风险评分，这项技术就可以用于任何生存数据模型。不涉及新的原则。 5.15 比例几率模型 在一般比例几率模型 (general proportional odds model) 中，个体生存超过时间 \\(t\\) 的几率 (odds) 表示为 \\[\\begin{align} \\frac{S_i(t)}{1-S_i(t)}&amp;=e^{\\eta_i}\\frac{S_0(t)}{1-S_0(t)} \\tag{5.76} \\end{align}\\] 其中 \\[\\begin{aligned}\\eta_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\end{aligned}\\] 为在第 \\(i\\) 个个体上测量的 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 值的线性组合，基线生存函数 \\(S_0(t)\\)，是解释变量都取零值的个体的生存函数。 在该模型中，解释变量对生存超过 \\(t\\) 的几率起乘性作用。因此，相对于解释变量全部为零的个体，第 \\(i\\) 个个体生存超过 \\(t\\) 的几率之比的对数就是 \\(\\eta_i\\)。因此，该模型是对数几率比 (log-odds ratio) 的线性模型。 现在考虑有两个组别的研究的特殊情况，在该研究中，个体接受标准治疗或新治疗。如果一个个体接受标准治疗，则让指示变量 \\(X\\) 取零，如果接受新治疗，则取一。则第 \\(i\\) 个个体生存超过时间 \\(t\\) 的几率为 \\[\\begin{aligned}\\frac{S_i(t)}{1-S_i(t)}&amp;=e^{\\beta x_i}\\frac{S_0(t)}{1-S_0(t)}\\end{aligned}\\] 其中 \\(x_i\\) 是第 \\(i(i=1,2,\\ldots,n)\\) 个个体的 \\(X\\) 值。因此，如果 \\(S_N (t)\\) 和 \\(S_S(t)\\) 分别是新治疗和标准治疗个体的生存函数，则 \\[\\begin{aligned}\\frac{S_N(t)}{1-S_N(t)}&amp;=e^\\beta\\frac{S_S(t)}{1-S_S(t)}\\end{aligned}\\] 对数几率比就是 \\(\\beta\\)。因此，模型线性部分的参数具有直接的解释。 对于比例风险模型，可以获得基线风险函数的非参数估计。通过从数据中估计模型线性部分的 \\(\\beta\\) 参数以及基线生存函数来拟合模型。比例几率模型的全参数版本可以通过使用生存时间的特定概率分布来导出。下面 5.15.1 节描述了一种这样的模型。 比例几率模型的一个特别重要的性质涉及第 \\(i\\) 个个体的风险函数与基线风险的比值 \\(h_{{i}}(t)/h_{0}(t)\\)。可以证明，在时间 \\(t = 0\\) 时该比值为 \\(e^{-\\eta_i}\\) 而在 \\(t = \\infty\\) 时该比值收敛为 \\(1\\)。为了证明这一点，式 (5.76) 中的模型可以改写为 \\[S_i(t)=S_0(t)\\left\\{e^{-\\eta_i}+(1-e^{-\\eta_i})S_0(t)\\right\\}^{-1}\\] 取对数得到 \\[\\begin{align} \\log S_i(t)=\\log S_0(t)-\\log\\left\\{e^{-\\eta_i}+(1-e^{-\\eta_i})S_0(t)\\right\\} \\tag{5.77} \\end{align}\\] 使用式 (1.5) 的一般结果，风险函数为： \\[\\begin{aligned}h_i(t)=-\\frac{\\mathrm{d}}{\\mathrm{d}t}\\log S_{{i}}(t)\\end{aligned}\\] 因此将式 (5.77) 的两边关于 \\(t\\) 微分 \\[\\begin{aligned}h_i(t)&amp;=h_0(t)-\\frac{(1-e^{-\\eta_i})f_0(t)}{e^{-\\eta_i}+(1-e^{-\\eta_i})S_0(t)}\\end{aligned}\\] 其中 \\(f_0(t)\\) 是基线概率密度函数。再改写该式，得到 \\[\\begin{align} h_i(t)&amp;=h_0(t)-\\frac{f_0(t)}{(e^{\\eta_i}-1)^{-1}+S_0(t)} \\tag{5.78} \\end{align}\\] 根据式 (1.4) 中，我们还得到 \\(h_0(t)=f_0(t)/S_0(t)\\)，并将 \\(f_0(t)\\) 代入式 (5.78)，得到 \\[h_i(t)=h_0(t)\\left\\{1-\\frac{S_0(t)}{(e^{\\eta_i}-1)^{-1}+S_0(t)}\\right\\}\\] 最后再改写，风险比由下式给出： \\[\\begin{aligned}\\frac{h_i(t)}{h_0(t)}&amp;=\\{1+(e^{\\eta_i}-1)S_0(t)\\}^{-1}\\end{aligned}\\] 当 \\(t\\) 从 \\(0\\) 增加到 \\(\\infty\\) 时，基线生存函数从 \\(1\\) 单调减小到 \\(0\\)。当 \\(S_0(t)= 1\\) 时，风险比为 \\(e^{-\\eta_i}\\)，当 \\(t\\) 增加到 \\(\\infty\\) 时，风险比收敛为 \\(1\\)。 在实际应用中，两组或多组患者的风险函数通常随时间收敛。例如，在临床试验对患者进行的随访研究中，治疗对生存率的影响，或疾病的初始阶段可能会逐渐消失。同样，在将患有某种疾病的患者组与无疾病个体的对照组进行比较的研究中，有效的疗法会使每组的生存经历随时间变得更加相似。这表明比例几率模型收敛风险函数的性质，可能是相当有价值的。然而，这个通用模型在实践中没有得到广泛应用的原因有两个。其一，计算机软件一般不能用于拟合基线生存函数形式未指定的比例几率模型。其二，该模型可能得到与含时依变量的 Cox 回归模型相似的结果，该时依协变量能产生非比例风险，4.4.3 节提及了这种为非比例风险生存数据建模的特殊方法，这将在第 8 章进行全面考虑。 5.15.1 log-logistic 比例几率模型 若假设个体的生存时间具有 log-logistic 分布，则基线生存函数为 \\[\\left.S_0(t)=\\left\\{\\begin{matrix}1+e^\\theta t^\\kappa\\end{matrix}\\right.\\right\\}^{-1}\\] 其中 \\(\\theta\\) 和 \\(\\kappa\\) 为未知参数。生存超过时间 \\(t\\) 的基线几率由下式给出 \\[\\begin{aligned}\\frac{S_0(t)}{1-S_0(t)}&amp;=e^{\\large-\\theta}t^{\\large-\\kappa}\\end{aligned}\\] 因此，第 \\(i\\) 个个体生存超过时间 \\(t\\) 的几率为 \\[\\begin{aligned}\\frac{S_i(t)}{1-S_i(t)}&amp;=e^{\\eta_i-\\theta}t^{-\\kappa}\\end{aligned}\\] 因此，第 \\(i\\) 个个体的生存时间具有参数为 \\(\\theta-\\eta_i\\) 和 \\(\\kappa\\) 的 log-logistic 分布。因此，log-logistic 分布具有比例几率性 (proportional odds property)，该分布是与比例几率模型结合使用的自然分布。事实上，这是唯一同时具有加速失效时间性和比例几率性的分布。 该结果还意味着，式 (5.76) 中比例几率模型线性部分中的 \\(β\\) 系数估计可以通过将式 (5.70) 的 log-logistic 加速失效时间模型中的 \\(\\alpha\\) 系数乘以 \\(\\hat{\\kappa}=\\hat{\\sigma}^{-1}\\)，其中 \\(\\hat\\sigma\\) 是参数 \\(\\sigma\\) 的估计。那么可以根据加速失效时间模型获得比例几率模型解释变量的系数，反之亦然。因此，基于比例几率模型的生存分析结果可以用时间比、加速因子或生存超过一定时间的几率比来解释，以更方便的为准。 如其他生存数据模型一样，可以使用最大似然法拟合比例几率模型。然后，可以在统计量 \\(-2 \\log \\hat{L}\\) 的基础上对替代模型进行比较。 在具有两个组别的研究中，可以很容易地对模型的适用性进行初步检查。第 \\(i\\) 个个体生存超过时间 \\(t\\) 的对数几率为 \\[\\begin{aligned}\\log\\left\\{\\frac{S_i(t)}{1-S_i(t)}\\right\\}&amp;=\\beta x_i-\\theta-\\kappa\\log t\\end{aligned}\\] 其中 \\(x_i\\) 是一个指标变量的值，如果一个个体在一个组中，则该值为零，如果在另一组中，那么该值为一。然后为每组中的个体获得生存函数的 Kaplan-Meier 估计，并绘制生存超过时间 \\(t\\) 的对数几率估计 \\(\\log\\left\\{\\hat{S}_i(t)/[1-\\hat{S}_i(t)]\\right\\}\\) 关于 \\(\\log t\\) 的图形。如果图中显示了两条平行的直线，则表明 log-logistic 模型是合适的。如果线是直的但不平行，这表明模型中的参数 \\(\\kappa\\) 在两个治疗组中不相同。若显示了平行的曲线，则表明尽管比例几率假设是有效的，但生存时间不能视为具有 log-logistic 分布。 示例 5.17 (患乳腺癌妇女的预后) 在本示例中，为了说明比例几率模型的使用，为乳腺癌症患者生存时间数据拟合该模型。为评估比例几率模型的适用性，计算了肿瘤呈阴性和阳性染色的女性的生存函数的 Kaplan-Meier 估计。对于这两组女性，估计了生存超过时间 \\(t\\) 的对数几率，并绘制其关于 \\(\\log t\\) 的图形，如图 5.25 所示。这些线是相当直且平行的，因此我们继续使用 log-logistic 比例几率模型来总结这些数据。 图 5.25 可以使用用于拟合 log-logistic 加速失效时间模型的软件来拟合该模型。在示例 5.14 中为癌症患者生存数据拟合了前者模型。比例几率模型中 \\(\\kappa\\) 和 \\(\\theta\\) 的估计分别为 1.243 和 −6.787，与加速失效时间模型中的估计相同。然而，比例几率模型线性部分中 \\(\\beta\\) 的估计为 \\(\\hat{\\beta}=-1.149\\times1.243=-1.428\\)。这是相对于阴性染色女性，阳性染色女性生存超过时间 \\(t\\) 的几率比的对数的估计。相应的几率比为 \\(e^{-1.428}=0.24\\)。因此，相比肿瘤染色呈阳性的女性，肿瘤染色呈阴性的女性生存超过 \\(t\\) 的几率大约是其四倍。 5.16 治愈率建模 在生存分析中，通常假设如果随访时间足够长，所有个体最终都会经历兴趣终点。如果终点是因任何原因的死亡，情况必然如此。然而，在一些研究中，相当一部分人可能在研究结束之前没有经历终点。这可能是因为治疗有效地治愈了患者。例如，在癌症试验中，兴趣可能集中在两种疗法的比较上，其中终点是死于特定类型的癌症。如果治疗有效，在相对较长的随访期内，将会有许多患者免死于癌症。这可能导致删失观测的比例比通常遇到的更大，这种情况有时称为重删失 (heavy censoring). 然而，严格来说，在随访期间未死亡个体的时间是删失的，而那些被治愈的个体不会死于所研究的疾病。 已被治愈的个体，或更一般地说，那些无法再经历所研究事件的个体，最终会因某种原因而失效 (fail)，但可能会存活很长一段时间。在这种情况下，根据一组个体估计的生存函数将倾向于在某个正值处趋于平稳。那么可以假设总体由个体混合而成：易受终点影响的人，和那些不易受终点影响的人。后者对应于治愈的个体，长期生存的比例称为治愈分数 (cured fraction). 然后可以采用生存分析的标准方法，以便对治愈概率与事件发生时间同时建模。 事件发生时间的模型可以扩展为包含治愈分数 \\(\\pi\\)，即治愈概率。在全参数模型中，生存函数变为 \\[\\begin{align} S(t)=(1-\\pi)S_n(t)+\\pi \\tag{5.79} \\end{align}\\] 其中 \\(S_n(t)\\) 是未治愈个体的生存函数。在式 (5.79) 中，\\(S(t)\\) 是由治愈和未治愈个体组成的群体的总体生存函数，该模型称为参数混合模型 (parametric mixture model). 当 \\(t \\rightarrow \\infty\\) 时，未治愈个体的生存函数趋于零，因此，根据式 (5.79)，\\(S(t)\\) 趋于 \\(\\pi\\)，即治愈概率 (probability of cure). 整个群体对应的风险函数为 \\[\\begin{align} h(t)&amp;=-\\frac{\\text{d}\\log S(t)}{\\text{d}t}=\\frac{f_n(t)}{S_n(t)+\\pi/(1-\\pi)} \\tag{5.80} \\end{align}\\] 其中 \\[\\begin{aligned}f_n(t)=-\\frac{\\mathrm{d}}{\\mathrm{d}t}S_n(t)\\end{aligned}\\] 是未治愈个体的密度函数。 如果对未治愈个体的生存时间假定一个比例风险模型，则该个体在时间 \\(t\\) 时的死亡风险为 \\[h_{{n}{i}}(t)=\\exp(\\boldsymbol{\\beta&#39;x}_{\\boldsymbol{i}})h_{{n}0}(t)\\] 其中 \\(\\boldsymbol{\\beta&#39;x}_i=\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi}\\) 为在该个体上测量的 \\(p\\) 个解释变量 \\(X_1, X_2,...,X_p\\) 值的线性组合。\\(h_{n0}(t)\\) 为未治愈个体的基线风险函数。那么未治愈个体的生存函数为 \\[S_{ni}(t)=[S_{n0}(t)]^{\\exp(\\boldsymbol{\\beta&#39;x}_i)}\\] 其中 \\(S_{n0}(t)=\\exp\\{-\\int_0^th_{n0}(u)\\mathrm{d}u\\}\\) 为其基线生存函数。 此外，治愈概率可能取决于许多解释变量（尤其是与治疗组相关的变量），表示为 \\(Z_1,Z_2,\\ldots,Z_p\\)。然后，可以通过对治愈分数进行 logistic 变换，使其成为变量值 \\(z_{1i},z_{2i},\\ldots,z_{pi}\\) 的线性组合，来为第 \\(i\\) 个个体的治愈概率关于这些变量的依赖性进行建模。那么 \\[\\begin{aligned}\\text{logit }(\\pi_i)=\\log\\left(\\frac{\\pi_i}{1-\\pi_i}\\right)=\\phi_0+\\boldsymbol{\\phi&#39;z}_i\\end{aligned}\\] 其中 \\(i=1,2,\\ldots,n,\\boldsymbol{\\phi&#39;z}_i=\\phi_0+\\phi_1z_{1i}+\\phi_2z_{2i}+\\cdots+\\phi_pz_{pi}\\)。\\(\\phi_0,\\phi_1,\\ldots,\\phi_p\\) 为未知参数。那么治愈概率为 \\[\\begin{aligned}\\pi_i=\\{1+\\exp(-\\boldsymbol{\\phi&#39;z}_i)\\}^{-1}\\end{aligned}\\] 未治愈个体的生存模型和治愈概率模型可能会出现相同的解释变量。此外，与生存模型不同，治愈概率模型通常包含一个常数项 \\(\\phi_0\\)，这是在模型中没有其他解释变量时，共同治愈概率 (common cure probability) 的 logistic 变换。 现假设未治愈个体的生存时间可以使用 Weibull 分布进行建模，基线风险函数为 \\(h_{\\boldsymbol{n}0}(t)=\\lambda\\gamma t^{{\\gamma}-1}\\)。未治愈个体的风险函数为 \\[\\begin{align} h_{ni}(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)\\lambda\\gamma t^{\\gamma-1} \\tag{5.81} \\end{align}\\] 相应的生存函数为 \\[\\begin{align} S_{ni}(t)=[\\exp(-\\lambda t^\\gamma)]^{\\exp(\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i)}=\\exp\\{-e^{\\boldsymbol{\\beta}^{\\prime}\\boldsymbol{x}_i}\\lambda t^\\gamma\\} \\tag{5.82} \\end{align}\\] 如同本章描述的其他模型，可以使用最大似然法拟合包含治愈分数的模型。假设数据由 \\(n\\) 个生存时间 \\(t_1,t_2,\\ldots,t_n\\) 组成，并且 \\(δ_i\\) 是第 \\(i\\) 个个体的事件指示符，因此如果第 \\(i\\) 个个人死亡，则 \\(δ_i=1\\)，否则为 0. 根据式 (5.44)，似然函数为 \\[L(\\boldsymbol{\\beta},\\boldsymbol{\\phi},\\lambda,\\gamma)=\\prod_{i=1}^n\\left\\{h_i(t_i)\\right\\}^{\\delta_i}S_i(t_i)\\] 这里，通过将式 (5.81) 和 (5.82) 中的 \\(h_{ni}(t_i)\\) 和 \\(S_{ni}(t_i)\\) 代入式 (5.79) 和 (5.80) 从而得到 \\(h_i(t_i)\\) 和 \\(S_i(t_i)\\)。 然后可以使用计算机软件来最大化相应对数似然函数 \\(\\log L(\\boldsymbol{\\beta},\\boldsymbol{\\phi},\\lambda,\\gamma)\\) 以进行数值优化。这一过程得到未知参数 \\(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{\\phi}},\\hat{\\lambda},\\hat{{\\gamma}}\\) 的估计及其标准误。此外，在治愈概率模型或未治愈个体的生存模型中具有不同解释变量的模型，可以以通常的方式使用统计量 \\(-2\\log L(\\hat{\\boldsymbol{\\beta}},\\hat{\\boldsymbol{\\phi}},\\hat{\\lambda},\\hat{\\gamma})\\) 的值进行模型比较。 可以对该模型进行许多扩展。例如，可以使用加速失效时间模型来代替未治愈个体的比例风险模型。 5.17 协变量调整的影响 作为本章的结尾，以一个示例来说明生存数据参数模型开发过程中可能遇到的一个重要特征。在线性回归分析中，向模型添加协变量的一个效果是减小残差均方，从而提高基于模型的估计（如治疗效应）的精度。经解释变量调整的治疗效应估计，相比未调整的，具有更小的标准误。然而在生存数据建模中，包含有意义的 (relevant) 解释变量通常对参数估计的标准误影响甚微。事实上在调整协变量后，治疗效应估计的标准误甚至会更大。本质上，这是因为在是否包含协变量的两个模型中，治疗效应的解释不同，这一观点来自 Ford, Norrie and Ahmadi (1995). 尽管如此，将有意义的解释变量纳入模型，并检查拟合模型是否合适，以确保获得治疗效应的准确估计，仍然是非常重要的。 为了更详细地说明这一点，假设 \\(t_i\\) 是随机变量 \\(T_i\\) 的观测值，它与第 \\(i(i=1,2,\\ldots,n)\\) 个个体的生存时间相关。我们将考虑这样的情况：有两个治疗组，每组有 \\(n/2\\) 个个体，有一个可用于每个个体的解释变量。这两个解释变量标记为 \\(X_1,X_2\\)，其中 \\(X_1\\) 表示治疗效应，取值为 0 或 1. 第 \\(i\\) 个个体的 \\(X_1,X_2\\) 的值分别表示为 \\(x_{1i},x_{2i}\\)，并且我们写 \\(z_{ji}=x_{ji}-\\bar{x}_{j}\\)，其中 \\(\\bar x_j\\) 是解释变量 \\(X_j\\) 的样本均值，\\(j=1,2\\)。将采用比例风险模型来计算第 \\(i\\) 个个体在时间 \\(t\\) 时的死亡风险关于 \\(z_{1i},z_{2i}\\) 值的依赖性，其中基线风险是恒定值 \\(\\lambda\\)。因此，风险函数可表示为 \\[\\begin{align} h_i(t)=\\lambda\\exp(\\beta_1z_{1{i}}+\\beta_2z_{2{i}}) \\tag{5.83} \\end{align}\\] 在此模型下，生存时间服从均值为 \\(\\{\\lambda\\exp(\\beta_1z_{1i}+\\beta_2z_{2i})\\}^{-1}\\) 指数分布，使用 5.12.1 节给出的结果，该模型也可用加速失效时间形式表示为 \\[\\begin{align} \\log T_i=\\mu-\\beta_1z_{1i}-\\beta_2z_{2i}+\\epsilon_i \\tag{5.84} \\end{align}\\] 其中 \\(\\mu=-\\operatorname{log}\\lambda\\) 并且 \\(\\epsilon_i\\) 具有 Gumbel 分布，即 \\(\\log \\epsilon_i\\) 具有单位指数分布。式 (5.83) 或 (5.84) 所示的模型将称为模型 (1). 使用附录 A 中给出的最大似然估计结果，可证明模型 (1) 中治疗效应估计 \\(\\hat{\\beta}_{1}\\) 的近似方差为 \\[\\begin{aligned}\\text{var }(\\hat{\\beta}_1)&amp;=\\frac{1}{[1-\\{\\text{ corr }(z_1,z_2)\\}^2]\\sum_{i=1}^nz_{1i}^2}\\end{aligned}\\] 其中 \\(\\mathrm{corr}\\left(z_1,z_2\\right)\\) 是 \\(z_{1i}\\) 和 \\(z_{2i}\\) 值之间的样本相关系数。由于 \\(z_{1i}\\) 要么为 -0.5 要么为 0.5，并且两组个体数相等，则 \\(\\sum_{{i}=1}^nz_{1{i}}^2=n/4\\)，所以 \\[\\begin{align} \\text{var }(\\hat{\\beta}_1)&amp;=\\frac{4}{n[1-\\{\\text{ corr }(z_1,z_2)\\}^2]} \\tag{5.85} \\end{align}\\] 现在考虑只包括与治疗效应相关的变量 \\(X_1\\) 的模型，因此 \\[\\begin{align} h_i(t)=\\lambda\\exp(\\beta_1z_{1{i}}) \\tag{5.86} \\end{align}\\] 或等价地 \\[\\begin{align} \\log T_i=\\mu-\\beta_1z_{1i}+\\epsilon_i \\tag{5.87} \\end{align}\\] 其中 \\(\\log \\epsilon_i\\) 也具有单位指数分布。式 (5.86) 或 (5.87) 描述的模型称为模型 (2). 在该模型中，\\(\\hat \\beta_1\\) 的近似方差为 \\(\\text{var }(\\hat{\\beta}_1)=4n^{{-}1}\\)。由于式 (5.85) 中的项 \\(1-\\{\\text{ corr }(z_1,z_2)\\}^2\\) 始终小于等于 1，因此模型 (1) 中 \\(\\hat \\beta_1\\) 的方差大于等于模型 (2) 中 \\(\\hat \\beta_1\\) 的方差。因此，在模型 (1) 中添加解释变量 \\(X_2\\) 并不能减小治疗效应估计的方差。 究其原因，在于模型 (1) 和模型 (2) 不能同时对同一数据集有效。如果模型 (1) 是正确的，但实际拟合了模型 (2)，则式 (5.87) 中的残差项不是 \\(\\epsilon_i\\)，而是 \\(\\epsilon_i−\\beta_2 z_{2i}\\)。类似地，模型 (2) 是正确的，但实际拟合了模型 (1)，我们不能假设式 (5.84) 中的 \\(\\log \\epsilon_i\\) 具有单位指数分布。此外，由于模型中包含冗余参数 \\(\\beta_2\\)，反而降低了参数 \\(\\beta_1\\) 估计的精度。 Ford, Norrie and Ahmadi (1995) 的论文中给出了更详细的分析和模拟研究，这些研究证实了一个普遍的观点：在生存数据模型中包含解释变量不能预期增加治疗效应估计的精度。 5.18 延伸阅读 Johnson, Kotz and Balakrishnan (1994) 给出了指数分布、Weibull 分布和其他连续分布的性质。Chhikara and Folks (1989) 对逆高斯分布进行了详细的研究。Gaver and Acar (1979) 讨论了二次风险函数的使用，Hjorth (1980) 提出了浴缸风险函数。 Barnett (1999), Cox and Hinkley (1974) 对最大似然估计理论进行了深入的讨论，Hinkley, Reid and Snell (1991) 对主要结果进行了有用的总结。Everitt (1987) 和 Thisted (1988) 描述了用于获得最大似然估计的数值方法，特别是 Newton-Raphson 程序；另请参见第 3 章 3.3.3 节的说明。Byar (1982) 提供了 Cox 和 Weibull 比例风险模型的比较。 Cox and Oakes (1984) 表明，Weibull 分布是唯一同时具有比例风险性和加速失效时间性的分布。他们还证明，log-logistic 分布是唯一具有加速失效时间性和比例几率性的分布。另一种具有比例风险性的分布是 Pareto 分布。该模型在实践中很少使用，可参阅 Davis and Feldstein (1979) 了解更多详细信息。 许多关于生存分析的主要教科书都包含对生存数据的对数线性模型的描述；特别是 Cox and Oakes (1984), Kalbfleisch and Prentice (2002), Klein and Moeschberger (2005) 和 Lawless (2002). Wei (1992) 引入了加速失效时间模型的非参数版本，它不需要指定生存数据的概率分布。该文以及 Fisher (1992) 的讨论，包含了是否应更广泛地在生存数据分析中使用加速失效时间模型的评论。 Crowder et al. (1991) 描述了加速失效时间和比例几率模型在可靠性数据分析中的应用。Bennett (1983a) 引入了生存数据的一般比例几率模型，Bennett (1983b) 描述了 log-logistic 比例几率模型。该模型由 Yang and Prentice (1999) 进一步发展。 定义并比较 Weibull 模型解释的变异的度量的论文包括 Kent and O’Quigley (1988) 以及 Royston and Sauerbrei (2004) 的论文，详见第 3 章。Chan, Xu and Chambers (2018) 研究了式 (5.75)中关于解释的变异的度量 \\(R^2_P\\) 在不同加速失效时间模型中的性能。 对生存数据进行建模的一种更通用的方法是使用一系列生存时间分布，其中以 Weibull 和 log-logistic 作为特殊情况。那么可以在似然框架内做出替代分布之间的选择。具体来说，指数分布, Weibull 分布, log-logistic 分布, log-normal 分布和 gamma 分布是 Kalbfleisch and Prentice (2002) 描述的广义 F 分布的特例。然而，这种方法只会在分析死亡数相对较多的数据集时富有信息。 RamlauHansen (1983) 以及 Klein and Moeschberger (2005) 的文章中描述了基于核平滑的风险函数的估计。许多作者描述了包含治愈分数的参数混合模型及其对半参数模型的扩展，如 Fareway (1982), Kuk and Chen (1992), Taylor (1995), Sy and Taylor (2000) 以及 Peng and Dear (2000). "],["chap6.html", "第 6 章 灵活的参数模型 6.1 分段指数模型 6.2 使用样条函数建模 6.3 风险函数的灵活模型 6.4 对数累积风险函数的灵活模型 6.5 灵活的比例几率模型 6.6 延伸阅读", " 第 6 章 灵活的参数模型 第 5 章描述的生存分析参数模型的基线风险函数仅依赖于少量未知参数，因此捕获基线风险潜在形式的能力有限。相比之下，Cox 回归模型的主要优点通常被认为是基线风险函数的灵活性，因为它可以适应任何特定数据集所需的模式。Cox 模型的这一优势常常被夸大了。由于 Cox 模型中的基线风险函数是根据数据估计的，以给出在每个事件时间都有跳跃的阶跃函数，因此它的表现可能非常不稳定，如第 3 章的示例 3.14. 此外，个体的生存函数估计在事件时间之间是恒定的，因此可能无法估计精确时间处的生存率。此外，无法估计超过数据集最远事件时间的生存率。灵活的参数模型弥补了 Cox 半参数模型和全参数模型之间的差距，当标准参数模型不能令人满意地描述潜在的基线风险或生存函数时，该模型可能具有很大的价值。 6.1 分段指数模型 在 Cox 回归模型中，第 \\(i\\) 个个体的风险函数为 \\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)h_0(t)\\end{aligned}\\] 其中 \\(\\boldsymbol x_i\\) 是 \\(p\\) 个解释变量的值向量，\\(\\boldsymbol \\beta\\) 是它们的系数向量，\\(h_0(t)\\) 是基线风险函数。通过最大化不依赖于 \\(h_0(t)\\) 的偏似然函数来拟合模型，这得到了 \\(\\boldsymbol \\beta\\) 的估计。随后，可以通过随事件时间变化的阶跃函数来估计风险、累积风险和生存函数。我们现在考虑该模型的一个版本：基线风险函数通过使用每个事件时间区间的参数进行显式建模。 假设 \\(n\\) 个个体的生存时间由 \\(r\\) 个有序事件时间 \\(t_{(1)}&lt;t_{(2)}&lt;\\cdots&lt;t_{(r)}\\) 和 \\(n − r\\) 个右删失时间组成。在相邻事件时间之间基线风险恒定的模型中，我们可以设 \\[\\begin{align} h_0(t)=\\lambda_j \\tag{6.1} \\end{align}\\] 其中 \\(t_{(j-1)}\\leqslant t&lt;t_{(j)},\\lambda_j&gt;0,j=1,2,\\ldots,r\\) 且 \\(t_{(0)}=0\\)。因为 \\(\\lambda_j&gt;0\\)，该模型通常通过设 \\(\\lambda_j=\\exp(\\phi_j)\\) 并将 \\(\\phi\\) 视为基线风险中的未知参数来进行参数化。式 (6.1) 中的风险函数在每个时间区间内是分段常数，因此对应于在每个时间区间内拟合单个指数模型。因此，该模型称为分段指数模型 (piecewise exponential model). 风险函数变化的时间点是 \\(t_{(1)},t_{(2)},\\ldots,t_{(r-1)}\\)，这些点称为分割点或结 (cut points or knots). 为估计该模型的未知参数，我们可以使用最大似然法，如第 3 章 3.3 节所述。全参数模型 (fully parametric model) 的似然函数为 \\[\\begin{align} \\prod_{i=1}^n\\left\\{h_i(t_i)\\right\\}^{\\delta_i}S_i(t_i) \\tag{6.2} \\end{align}\\] 这首次在第 4 章的式 (5.15) 中给出，其中 \\(h_i(t_i)\\) 和 \\(S_i(t_i)\\) 是第 \\(i\\) 个个体在时间 \\(t_i\\) 的风险和生存函数，\\(i=1,2,\\ldots,n\\)，\\(\\delta_i\\) 是事件指示符。在式 (6.1) 中对基线风险函数进行积分后，累积基线风险为 \\[\\begin{align} H_0(t)=\\sum_{j=1}^r\\lambda_j\\Delta_j(t) \\tag{6.3} \\end{align}\\] 其中 \\[\\left.\\Delta_j(t)=\\left\\{\\begin{array}{ll}0&amp;t&lt;t_{(j-1)},\\\\t-t_{(j-1)}&amp;t_{(j-1)}\\leqslant t&lt;t_{(j)},\\\\t_{(j)}-t_{(j-1)}&amp;t\\geqslant t_{(j)}\\end{array}\\right.\\right.\\] 该累积风险函数由每个区间内的直线段组成。第 \\(i\\) 个个体的相应累积风险函数为 \\(H_{{i}}(t)=\\operatorname{exp}(\\boldsymbol{\\beta&#39;x}_{{i}})H_{0}(t)\\)，然后可以使用第 1 章的式 (1.6) 中给出的关系式 \\(S_{{i}}(t)=\\operatorname{exp}\\{-H_{i}(t)\\}\\) 来得到生存函数。 原则上，基线风险函数的未知参数 \\(\\lambda_1,\\lambda_2,\\ldots,\\lambda_r\\) 可以通过最大化式 (6.2) 中似然函数的对数与 \\(\\beta\\) 一起估计。当数据中的每个区间都有一个单独的参数 \\(\\lambda\\)，试图最大化该对数似然函数时可能会出现实质性的数值问题，尤其是有较多的事件时间时。然而，现在可以使用快速有效的算法来完成计算。这些算法主要是为处理区间删失数据而开发的（如第 ?? 章所述），但由于右删失是区间删失的特殊情况，因此这里可以使用相同的算法。即便如此，这些方法对计算的要求仍然很高。此外，基于信息矩阵、在附录 A 中描述的构建估计的标准误的通常方法是不稳定的，因此通常使用模拟方法。被称为 bootstrapping 的模拟过程涉及从数据集中有放回地抽取 \\(n\\) 个观测值，并为该样本估计未知参数。该过程会重复很多次，可能是 500 或更多次，根据各个 bootstrap 估计来计算每个估计的样本标准差。然后使用这些标准差来总结参数估计的精度。 除了计算困难之外，为每个区间提供一个单独的参数并不能真正有效地总结潜在的风险。在构建分段恒定基线风险时，采用更少的时间区间是优选的且更简单的。实际区间数将取决于数据集的大小，但通常不需要超过 10 个区间。另一个问题是将区间的端点定位于何处。一种常用的方法是将研究的时间段划分为这些区间：每个区间包含相似数量的事件时间。或者，也可以选择这样一种方式来划分时间区间：风险变化较快时，时间区间较窄；风险变化较慢时，时间区间较宽。合理选择区间边界应能为任何基线风险提供合理的近似值。 下面的示例说明了分段指数模型的使用。 示例 6.1 (肾癌的治疗) 第 3 章示例 3.4 中描述了一项涉及 36 名肾癌患者生存时间数据的研究。拟合了包括年龄组和肾切除术状态的 Cox 回归模型，并在示例 3.14 中给出了风险函数的估计。肾切除术状态的风险比为 \\(\\exp(−1.412)=0.244\\)，60 - 70 岁人群和 70 岁以上人群相对于 60 岁以下人群的风险比分别为 \\(\\exp(0.013)=1.013\\) 和 \\(\\exp(1.342)=3.825\\)。 在 23 个有序事件时间之间拟合具有恒定风险的分段指数模型时，所得肾切除状态和年龄组的风险比分别为 0.215, 1.124 和 4.518，这与根据 Cox 回归模型获得的风险比非常相似。基线风险函数中 \\(\\lambda\\) 参数的估计与第 3 章表 3.19 给出的值大致相似，尽管两组估计都非常不精确。拟合的分段指数模型的风险函数如图 6.1 所示。这与 Cox 模型的模式类似，如第 3 章图 3.4 所示。 表 3.19 图 6.1 图 3.4 估计的基线风险函数有 22 个不同的参数，对于这种规模的数据集来说，它被严重地过度参数化了。为了说明，还拟合了仅具有五个区间的分段指数模型，其中以时间 12, 26, 56 和 84 个月为划分定义了区间。 这四个分割点或结，介于最短事件时间 5 个月和最长事件时间 115 个月之间，大致对应于事件时间的五分位数。肾切除术状态和年龄组的风险比现在分别为 0.236, 1.179 和 4.944，这与具有 22 个区间的模型所得结果非常相似。 可以使用第 3 章式 (3.14) 中定义的 AIC 统计量来比较这两个分段指数模型。具有 22 个区间的模型的未知参数数量 \\(q\\) 为 22+3=25，该模型的 AIC 值为 298.70. 对于具有五个区间的模型，参数数量为 8，AIC 值为 283.48. 因此，应优选更简单的模型。请注意，拟合的 Cox 回归模型的 AIC 统计量是基于最大偏似然值构建的，因此不能与基于完全似然值的分段指数模型的 AIC 值进行比较。 图 6.1 表明每个区间内的五个单独的风险非常相似，因此基线风险实际上可能是恒定的。那么数据将呈指数分布，拟合该模型后得到的恒定基线风险为 0.058. 相应的 AIC 统计量值为 298.76，因此该模型无法像具有五个区间的更复杂的分段模型一样拟合这些数据。 在拟合的 Cox 回归模型中，很难识别出基线风险函数估计的模式，因为每个事件时间的风险是由该时间的事件数量和风险数量确定的。潜在的风险函数是阶梯式的可能性很小，因此需要对该函数进行平滑估计，这可以通过对累积基线风险估计应用平滑过程来实现，然后进行数值微分从而给出风险函数本身的平滑估计。尽管该估计在描述性分析中很有用，但使用拟合曲线来估计（或验证）拟合模型的生存率并不简单，更令人满意的方法是使用基于平滑参数函数的风险模型，并且这些将在随后的部分中描述。 6.2 使用样条函数建模 样条函数 (spline functions) 在生物医学研究中广泛应用，以为时间的非线性函数建模。它们是通过将时间尺度划分为若干个区间，并在每个区间内拟合生存时间 \\(t\\) 的多项式函数来构建的。这样做的目的是使函数在区间边界处（结, knot）能够平滑连接。定义区间的结的集合称为结序列 (knot sequence). 在最简单的情况下，我们取 \\(t\\) 的最小值和最大值，并将时间范围分为两半。那么在 \\(t\\) 的极值处会有两个边界结 (boundary knots)，以及在它们之间有一个内部结 (internal knot). 增加内部结的数量会得到更复杂的曲线。样条函数的阶定义为构成它的多项式函数的阶。通常使用三次样条函数 (spline functions of degree three)，也称为立方样条 (cubic splines)，因为它们是简单性和灵活性的折衷。它们还易于计算，数值稳定，并产生平滑的曲线，因此我们将重点关注这些函数。 为了说明样条函数，假设 \\(t\\) 的取值范围是从 \\(t_{\\text{min}}\\) 到 \\(t_{\\text{max}}\\)，并在 \\(t=t_1\\) 的点上指定了一个内部结。那么，可为 \\(t_{\\min}\\leqslant t\\leqslant t_1\\) 和 \\(t_1\\leqslant t\\leqslant t_{\\max}\\) 定义 \\(t\\) 的三次表达式。然后，约束这两个三次表达式在内部结 \\(t_1\\) 处平滑连接，从而得到一个立方样条。现考虑一个在变量 \\(t\\) 取值范围内定义的立方样条函数，其中 \\(m\\) 个内部结定义在 \\(t_1,t_2,\\ldots,t_m\\) 处，且 \\(t\\) 的最小值和最大值分别为边界结 \\(t_{\\text{min}}\\) 和 \\(t_{\\text{max}}\\)。那么将有 \\(m+1\\) 个区间，并在这些区间上拟合三次表达式。每个单独的三次函数，称为基函数 (basis function)，被约束：在内部结处平滑地连接相邻函数。所需的基函数数量随着内部结数量的增加而增加，这些基函数的线性组合就是样条函数。在模型拟合过程中，对构成样条函数的基函数的未知系数进行估计。 样条函数有许多不同类型，但我们只关注那些最常用于生存数据建模的函数上。 6.2.1 B 样条 具有 \\(m\\) 个内部结的 \\(k\\) 阶 B 样条函数由 \\(m + k + 1\\) 个基函数（每个基函数都为 \\(k\\) 阶）构造而成。这些基函数的任何线性组合都会产生一条平滑曲线，可用于对 \\(t\\) 的特定函数进行建模，例如风险函数或生存函数。\\(t\\) 的 B 样条函数由下式给出 \\[\\begin{align} B(t)=\\sum_{j=1}^{m+k+1}\\alpha_jB_{j,k}(t),\\quad t_{\\min}\\leqslant t\\leqslant t_{\\max} \\tag{6.4} \\end{align}\\] 其中 \\(B_{j,k}(t)\\) 为 \\(k\\) 阶基函数，系数为 \\(\\alpha_j,j=1,2,\\ldots,m+k+1\\)。 当式 (6.4) 中的 \\(k = 3\\)，得到一个立方样条函数 \\[\\begin{align} B(t)=\\sum_{j=1}^{m+4}\\alpha_jB_{j,3}(t),\\quad t_{\\min}\\leqslant t\\leqslant t_{\\max} \\tag{6.5} \\end{align}\\] 其具有 \\(m + 4\\) 个三阶基函数 \\(B_{j,3}(t)\\)。通过为观测数据拟合该函数来估计该函数中的 \\(m + 4\\) 个未知 \\(\\alpha\\) 参数。 立方样条的第 \\(j\\) 个基函数 \\(B_{j,3}(t)\\) 是通过递归关系 (recurrence relationship) 来定义的。但首先，为了让递归关系得到完全定义，需在结序列中添加三个下边界结和三个上边界结。那么完全结序列 (full knot sequence) 为 \\[t_{\\min},t_{\\min},t_{\\min},t_{\\min},t_{1},t_{2},\\ldots,t_{m},t_{\\max},t_{\\max},t_{\\max},t_{\\max}\\] 这些 \\(m+8\\) 个扩展后的结现在表示为 \\(\\tau_{1},\\tau_{2},\\ldots,\\tau_{m+8}\\)。对于该序列中的每个结，使用递归关系来获得 B 样条基函数 \\(B_{j,3}(t)\\)。首先，令 \\[\\left.B_{j,0}(t)=\\left\\{\\begin{array}{ll}1&amp;&amp;\\text{if }\\tau_j\\leqslant t&lt;\\tau_{j+1},\\\\0&amp;&amp;\\text{otherwise},\\end{array}\\right.\\right.\\] 以给出第 \\(j\\) 个零阶基函数。然后，利用递归关系得到 1, 2 和 3 阶基函数 \\[\\begin{align} B_{j,k+1}(t)=\\omega_{j,k+1}(t)B_{j,k}(t)+\\{1-\\omega_{j+1,k+1}(t)\\}B_{j+1,k}(t) \\tag{6.6} \\end{align}\\] 其中 \\[\\left.\\omega_{j,k}(t)=\\left\\{\\begin{array}{ll}(t-\\tau_j)/(\\tau_{j+k}-\\tau_j)&amp;\\quad\\text{if }\\tau_{j+k}\\neq\\tau_j\\\\0&amp;\\quad\\text{otherwise},\\end{array}\\right.\\right.\\] \\(j=1,2,\\ldots,m+4\\)。通过在式 (6.6) 中依次设 \\(k = 0, 1, 2\\)，该递归过程得到 \\(m + 4\\) 个三阶 B 样条基函数 \\(B_{j,3}(t),j=1,2,\\ldots,m+4\\)。将这些函数代入式 (6.5) 中，我们就得到了可拟合观测数据的三次 B 样条函数。该递归参数如示例 6.2 所示。 示例 6.2 (一个样条函数的说明) 为了说明构建 B 样条的过程，假设数据集包含范围为 0 到 10 个单位的生存时间。此外，假设时间 \\(t\\) 的三次 B 样条函数仅用一个内部结来构造，即在式 (6.5) 中 \\(m=1\\)。将该结置于时间尺度的中点 \\(t = 5\\)。边界结置于 0 和 10 处，重复边界结以给出扩展的结序列 \\((0,0,0,0,5,10,10,10,10)\\)。 样条函数将有五个基函数 \\(B_{j,3}(t)\\)，使用式 (6.6) 中的递归关系，通过取 \\(k = 0,1,2\\) 和 \\(j = 1,2,\\ldots,5\\) 来构造。经过大量代数运算，得到如下的基函数 \\[ \\left. \\begin{aligned} B_{1,3}(t)&amp;=\\left\\{\\begin{array}{ll}(-t^3+15t^2-75t+125)/125&amp;\\quad\\quad\\:\\:\\:\\:\\:0\\leqslant t&lt;5\\\\0&amp;\\quad\\quad\\:\\:\\:\\:\\:5\\leqslant t&lt;10\\end{array}\\right.\\\\ B_{2,3}(t)&amp;=\\left\\{\\begin{array}{ll}t(7t^2-90t+300)/500&amp;\\quad\\:\\:\\:\\:\\:0\\leqslant t&lt;5\\\\(-t^3+30t^2-300t+1000)/500&amp;\\quad\\:\\:\\:\\:\\:5\\leqslant t&lt;10\\end{array}\\right.\\\\ B_{3,3}(t)&amp;=\\left\\{\\begin{array}{ll}t^2(-2t+15)/250&amp;\\quad\\quad\\,\\,\\,\\,\\:0\\leqslant t&lt;5\\\\(2t^3-45t^2+300t-500)/250&amp;\\quad\\quad\\,\\,\\,\\,\\:5\\leqslant t&lt;10\\end{array}\\right.\\\\ B_{4,3}(t)&amp;=\\left\\{\\begin{array}{ll}t^3/500&amp;\\,\\quad0\\leqslant t&lt;5\\\\(-7t^3+120t^2-600t+1000)/500&amp;\\quad\\,5\\leqslant t&lt;10\\end{array}\\right.\\\\ B_{5,3}(t)&amp;=\\left\\{\\begin{array}{ll}0&amp;\\quad\\quad\\quad\\quad0\\leqslant t&lt;5\\\\(t^3-15t^2+75t-125)/125&amp;\\quad\\quad\\quad\\quad5\\leqslant t&lt;10\\end{array}\\right. \\end{aligned}\\right. \\] 每个基函数都是定义在范围 \\((0,10)\\) 内的 \\(t\\) 的三次表达式，在内部结的位置有光滑的连接，这些基函数在图 6.2 中以虚线表示，该图显示了三次表达式在内部结 \\(t = 5\\) 两侧如何光滑相连。 图 6.2 现假设使用样条函数 \\(B(t)=\\sum_{j=1}^5\\alpha_jB_{j,3}(t)\\) 对 \\(t\\) 的函数进行建模，样条基函数的五个系数 \\(\\alpha_1,\\alpha_2,\\ldots,\\alpha_5\\) 的估计分别为 0.8, -0.3, 1.2, 0.5 和 0.4. 所得的拟合函数如图 6.2 中的实线所示。该图所示的 B 样条函数先减小后增大，在 \\(t = 6\\) 左右到达峰值，然后缓慢减小。该图还说明了基函数值的线性组合如何产生平滑的样条函数。不同的 \\(\\alpha\\) 系数值的集合将得到不同的样条曲线。以这种方式构造的样条函数可用于表示各种函数形式，并且在对基线风险函数或其对数进行建模时特别有用。 6.2.2 限制性立方样条 多项式样条，如 B 样条，在生存时间 \\(t\\) 的观测值范围极值处（即边界结附近）可能会表现得不稳定。此外，B 样条函数在这些边界结之外是未定义的。这限制了模型在观测值范围之外预测的有效性。这可以通过使用限制性或自然 (restricted or nature) 立方样条来解决：使用 \\(m\\) 个内部结将 \\(t\\) 值的范围再次划分为 \\(m+1\\) 个区间，并在每个区间内拟合一个三次表达式，同时在结处平滑连接。此外，当 \\(t&lt;k_{\\min}\\) 和 \\(t&gt;k_{\\max}\\) 时，假设 \\(t\\) 有一个线性项。这得到了比 B 样条模型更简单的表示，因为对于给定数量的内部结，所需基函数的数量减少了。图 6.3 显示了一个限制性立方样条，其边界结位于 \\(k_\\min\\) 和 \\(k_\\max\\)，内部结位于 \\(k_1\\)。 图 6.3 当有 \\(m\\) 个内部结时，限制性立方样条具有 \\(m\\) 个基函数，记为 \\(\\nu_1(t),\\nu_2(t),\\ldots,\\nu_m(t)\\)。此限制性立方样条为 \\[\\begin{align} \\gamma_0+\\gamma_1t+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(t) \\tag{6.7} \\end{align}\\] 在该表达式中，第 \\(j\\) 个基函数 \\(\\nu_j(t)\\) 由下式给出 \\[\\begin{align} \\nu_j(t)=(t-k_j)_+^3-\\lambda_j(t-k_{\\min})_+^3-(1-\\lambda_j)(t-k_{\\max})_+^3 \\tag{6.8} \\end{align}\\] 其中 \\(k_j\\) 是第 \\(j\\) 个内部结，\\(j = 1,2,\\ldots,m\\) \\[\\begin{align} \\lambda_j=\\frac{k_{\\max}-k_j}{k_{\\max}-k_{\\min}} \\tag{6.9} \\end{align}\\] 以及对于 \\(a\\) 的任意值 \\((t-a)_+^3=\\max\\{0,(t-a)^3\\}\\)，即 \\((t-a)_+^3\\) 为 \\(0\\) 和 \\((t-a)^3\\) 中的较大者。该样条函数有 \\(m + 2\\) 个未知的 \\(\\gamma\\) 参数，通过为观测数据拟合样条函数来估计。在 \\(m = 0\\) 的特殊情况下，即没有内部结的情况下，得到的限制性立方样条只是 \\(t\\) 的线性函数 \\(\\gamma_0+\\gamma_1t\\)。 示例 6.3 (一个样条函数的说明) 在示例 6.2 中，为由范围在 0 到 10 个单位的生存时间 \\(t\\) 组成的数据构造了一个 B 样条函数，其中在 \\(t = 5\\) 处有一个内部结。本实例得到了相应的限制性立方样条函数的表达式。边界结分别为 \\(k_\\min = 0\\) 和 \\(k_\\max = 10\\)，内部结位于 \\(k_1 = 5\\) 处。具有一个内部结的限制性立方样条只有一个基函数，根据式 (6.8)，这由下式给出： \\[\\begin{aligned}\\nu_1(t)=(t-5)_+^3-\\lambda_1(t-0)_+^3-(1-\\lambda_1)(t-10)_+^3\\end{aligned}\\] 其中根据式 (6.9) \\[\\begin{aligned}\\lambda_1=(10-5)/(10-0)=0.5\\end{aligned}\\] 因此当 \\(t\\leqslant10\\) 时，基函数为 \\[\\begin{aligned}\\nu_1(t)=(t-5)_+^3-0.5t^3-0.5(t-10)_+^3\\end{aligned}\\] 因此 \\[\\left.\\nu_1(t)=\\left\\{\\begin{array}{ll}-0.5t^3&amp;\\quad0\\leqslant t&lt;5\\\\(t-5)^3-0.5t^3&amp;\\quad5\\leqslant t&lt;10\\end{array}\\right.\\right.\\] 对于 \\(t&gt;10\\) \\[\\begin{aligned}\\nu_1(t)=(t-5)^3-0.5t^3-0.5(t-10)^3\\end{aligned}\\] 它可化简为 \\(\\nu_1(t)=375-75t\\)，因此 \\(\\nu_1(t)\\)，即限制性样条函数，对于上边界结之外的 \\(t\\) 是线性的。 对于式 (6.7) 中的 \\(\\gamma_{0},\\gamma_{1}\\) 和 \\(\\gamma_2\\) 的任何值，限制性立方样条函数为 \\(\\gamma_0+\\gamma_1t+\\gamma_2\\nu_1(t)\\)，它在 \\(t &gt; 10\\) 时是线性的，在 \\(0 \\leqslant t &lt; 5\\) 和 \\(5 \\leqslant t &lt; 10\\) 时是三次表达式。与 B 样条函数不同，限制性立方样条函数为所有 \\(t\\) 值都有定义，而不仅仅是边界结之间的值。 此处描述的样条函数可用于对风险或累积风险函数建模，并为生存数据生成极其灵活的参数模型。 6.2.3 结数和位置 无论使用什么样条函数，结数和位置都会对拟合函数的形式产生一些影响。尽管一些作者建议使用自动或数据驱动的程序来确定结的放置位置，但也有其他人对此提出警告，因为它们可能会受到数据集局部特征的过度影响，在构造参数估计的标准误时很难考虑到这一点。相反，通常建议边界结是数据集中观测事件时间的最小值和最大值，内部结则按照未删失事件时间分布的百分位数进行等距分布。具体来说，一个内部结应位于观测生存时间的未删失值的中位数，两个内部结应分别位于 33% 和 67% 的百分位数，三个内部结应位于四分位数，以此类推。在实际应用中，通常不需要超过 4 或 5 个结。 为了确定要使用的结数，我们首先从两个边界结开始。然后拟合一个具有一个内部结的模型，并将其与没有内部结的模型进行比较。接下来，拟合一个具有两个内部结的模型，并将其与具有一个内部结的模型进行比较，以此类推。由于结的位置会随着其数量的增加而改变，例如从一个内部结到两个内部结，其位置从事件时间分布的中位数变为分布的 33% 和 67% 的百分位数，因此具有不同结数的模型并不一定是嵌套的。这意味着 \\(−2 \\log \\hat L\\) 统计量通常不能用于确定增加结数是否能显著提高模型的拟合度。相反，可以使用第 3 章 3.6.1 节中介绍的 AIC 统计量。AIC 统计量为 \\(−2 \\log \\hat L + 2q\\)，其中 \\(q\\) 是拟合模型中未知参数的总数，包括与样条函数相关的参数。例如，当在包含 \\(p\\) 个解释变量的生存时间模型中使用具有 \\(m\\) 个内部结的限制性立方样条模型时，样条函数中将有 \\(p\\) 个 \\(\\beta\\) 参数和 \\(m + 2\\) 个 \\(\\gamma\\) 系数，因此 \\(q=p+m+2\\)。AIC 统计量最小的模型通常是最合适的，因此增加结数直到 AIC 统计量无法进一步减小。也可以使用 BIC 统计量以类似的方式比较模型，该统计量也在第 3 章的 3.6.1 节中定义。 6.3 风险函数的灵活模型 基线风险函数的样条模型为参数建模提供了一种灵活的方法。考虑一个比例风险模型，其中第 \\(i\\) 个个体在时间 \\(t\\) 发生事件的风险为 \\[h_i(t)=\\exp(\\eta_i)h_0(t)\\] 以及 \\(\\eta_i=\\boldsymbol \\beta&#39;\\boldsymbol x_i\\)，其中 \\(\\boldsymbol\\beta\\) 是 \\(p\\) 个解释变量的系数。为了确保拟合的风险函数始终非负，模型是根据基线风险函数的对数构建的。如果将具有 \\(m\\) 个内部结的时间的三次 B 样条函数用于对数基线风险 \\(\\log h_0(t)\\)，那么使用的式 (6.5) 中样条函数 \\[\\begin{aligned}\\log h_0(t)=\\sum_{j=1}^{m+4}\\alpha_jB_{j,3}(t)\\end{aligned}\\] 第 \\(i\\) 个个体对数风险函数的样条模型为 \\[\\begin{align} \\log h_i(t)=\\eta_i+\\sum_{j=1}^{m+4}\\alpha_jB_{j,3}(t) \\tag{6.10} \\end{align}\\] 该模型可以通过最大化观测数据的似然函数来拟合，如式 (6.2) 所示。为此，可以通过首先对基线风险函数进行积分来获得累积基线风险 \\(H_0(t)\\)，然后得到生存函数 \\(S_i(t)\\)。这必须以数值方式完成，因为使用的是对数风险尺度上的 B 样条曲线。那么 \\(S_i(t) = \\exp\\{−e^{\\eta_i}H_0(t)\\}\\)。 如 6.2.3 节所述，通过用不断增加的结数来拟合模型，以实现建模程序。对于每个模型，使用诸如 AIC 或 BIC 统计量之类的模型充分性的度量来识别具有这些最小统计量值的模型。 该模型的一个重要特例是使用零阶 B 样条基函数，即式 (6.4) 中的 \\(k = 0\\)。此时，有 \\(m + 1\\) 个样条基函数 \\(B_{j,0}(t)\\)，对于 \\(t_j\\leqslant t&lt;t_{j+1},j=1,2,\\ldots,m+1\\) 它们为 1，其中 \\(t_1=t_{\\min},t_{m+2}=t_\\max\\)，否则为 0. 那么，B 样条函数在 \\(m+1\\) 个时间区间中的每个时间区间中是恒定的。风险函数的相应模型为 \\[h_0(t)=\\exp\\left\\{\\sum_{j=1}^{m+1}\\alpha_jB_{j,0}(t)\\right\\}\\] 因此在第 \\(j(j=1,2,\\ldots,m+1)\\) 个时间区间中 \\(h_0(t)=\\exp(\\alpha_j)\\)。这是 6.1 节描述的分段指数模型的另一种形式，并且当结数和位置为事件时间数及其位置时，该模型就是 Cox 回归模型。 示例 6.4 (肾癌的治疗) 在示例 6.1 中，为肾癌患者数据拟合了分段指数风险函数，现在我们考虑使用式 (6.10) 中的模型，用基于样条函数的参数模型对基线风险进行建模，拟合包含年龄组和肾切除状态的比例风险模型，其中对数基线风险函数是三次 B 样条函数。 在拟合模型时，如果模型中的内部结书不断增加，位于事件时间的百分位数，我们发现，对于具有两个内部结的模型，AIC 统计量的值最小。拟合的基线风险函数是六个基函数的线性组合的指数，由下式给出 \\[\\begin{aligned}\\hat{h}_0(t)=\\exp\\{\\hat{\\alpha}_1B_{1,3}(t)+\\hat{\\alpha}_2B_{2,3}(t)+\\cdots+\\hat{\\alpha}_6B_{6,3}(t)\\}\\end{aligned}\\] 其中函数 \\(B_{j,3}(t),j=1,2,\\ldots,6\\) 为 \\(t\\) 的三次表达式。这得到了一个相当复杂的关于 \\(t\\) 的函数，如图 6.4 所示。 图 6.4 该图中的基线风险函数估计在 10 天和 40 天左右达到峰值，此后下降。在图 6.1 的分段指数回归模型的基线风险函数图中，这两个峰值也隐约可见。对于该模型，肾切除状态的风险比为 0.250，60 - 70 岁和 70 岁以上患者相对于 60 岁以下患者的风险比分别为 0.962 和 3.974。这些与示例 6.1 中拟合的分段指数模型发现的结果非常相似，因此基线风险函数估计的精确形式对估计风险比几乎没有影响。然而，具有两个内部结的 B 样条模型的 AIC 统计量值为 292.83，该值大于示例 6.1 中拟合的具有四个内部结的分段指数模型的相应值。因此，基于样条的风险函数不能改进拟合。 6.4 对数累积风险函数的灵活模型 当使用样条模型对风险函数进行建模时，在最短和最长事件时间附近总是存在异常表现的风险。为对数累积风险或生存函数开发的模型不太容易受到这种影响。 对数累积风险函数的灵活模型通常基于 6.2.2 节中描述的限制性立方样条，并且在没有内部结的特定情况下模型简化为 Weibull 模型。为了看出这一点，第 \\(i\\) 个个体在时间 \\(t\\) 的 Weibull 风险函数为 \\[\\begin{aligned}h_i(t)=\\exp(\\boldsymbol{\\beta&#39;x}_i)h_0(t)\\end{aligned}\\] 其中 \\(\\boldsymbol x_i\\) 是 \\(p\\) 个解释变量的值向量，系数为 \\(\\boldsymbol \\beta\\)，基线风险函数为 \\(h_0(t)=\\lambda\\gamma t^{\\gamma-1}\\)。参数 \\(\\lambda\\) 和 \\(\\gamma\\) 确定了基线 Weibull 分布的尺度和形状。对应的累积风险函数为 \\[H_i(t)=\\int_0^th_i(u)\\mathrm{d}u=\\exp(\\eta_i)\\lambda t^\\gamma \\] 其中 \\(\\eta_i=\\boldsymbol\\beta&#39;\\boldsymbol x_i\\)，对数累积风险函数为 \\[\\log H_i(t)=\\eta_i+\\log\\lambda+\\gamma\\log t\\] 设 \\(\\gamma_{0}=\\operatorname{log}\\lambda,\\gamma_{1}=\\gamma\\) 以及 \\(y=\\log t\\)，Weibull 模型的对数累积风险函数可以写成 \\[\\log H_i(t)=\\eta_i+\\gamma_0+\\gamma_1y\\] 该式表明，对数累积风险函数关于 \\(y = \\log t\\) 呈线性。 根据式 (6.7)，具有 \\(m\\) 个内部结的对数基线累积风险的限制性立方样条模型可用 \\(y = \\log t\\) 表示为 \\[\\begin{align} \\operatorname{log}H_{0}(t)=\\gamma_{0}+\\gamma_{1}y+\\sum_{j=1}^{m}\\gamma_{j+1}\\nu_{j}(y) \\tag{6.11} \\end{align}\\] 在此式中，对于 \\(k_j\\) 处的第 \\(j(j = 1, 2,...,m)\\) 个内部结， \\[\\begin{align} \\nu_j(y)=(y-k_j)_+^3-\\lambda_j(y-k_{\\min})_+^3-(1-\\lambda_j)(y-k_{\\max})_+^3 \\tag{6.12} \\end{align}\\] \\(k_\\min,k_\\max\\) 为边界结，\\((y-a)_+^3=\\max\\{0,(y-a)^3\\}\\) 以及 \\[\\lambda_j=\\frac{k_{\\max}-k_j}{k_{\\max}-k_{\\min}}\\] 第 \\(j\\) 个基函数 \\(\\nu_j (y)\\) 可以详细表示为 \\[\\left.\\nu_j(y)=\\begin{cases}0&amp;y&lt;k_{\\min},\\\\-\\lambda_j(y-k_{\\min})^3&amp;k_{\\min}\\leqslant y\\leqslant k_j,\\\\(y-k_j)^3-\\lambda_j(y-k_{\\min})^3&amp;k_j\\leqslant y\\leqslant k_{\\max},\\\\(y-k_j)^3-\\lambda_j(y-k_{\\min})^3-(1-\\lambda_j)(y-k_{\\max})^3&amp;y&gt;k_{\\max}\\end{cases}\\right.\\] 当 \\(y&gt;k_\\max\\) 时，\\(\\nu_j (y)\\) 的表达式简化为 \\[(k_\\mathrm{max}-k_j)(k_\\mathrm{min}-k_j)(3y-k_\\mathrm{min}-k_j-k_\\mathrm{max})\\] 这证实了当 \\(y&gt;k_\\max\\) 时基函数是 \\(y\\) 的线性函数，对于在 \\(k_\\min\\) 和 \\(k_\\max\\) 之间的 \\(y\\) 值的基函数是 \\(y\\) 的三次函数。 比例风险模型中第 \\(i\\) 个个体的累积风险函数为 \\[\\begin{aligned}H_i(t)=\\int_0^t\\exp(\\eta_i)h_0(u)\\mathrm{d}u=\\exp(\\eta_i)H_0(t)\\end{aligned}\\] 因此 \\(\\log H_i(t)\\) 的限制性立方样条模型由下式给出 \\[\\begin{align} \\log H_i(t)=\\eta_i+\\gamma_0+\\gamma_1y+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(y) \\tag{6.13} \\end{align}\\] 其中，当为观测数据拟合模型时，\\(\\gamma\\) 参数与 \\(\\beta\\) 参数一起估计。式 (6.13) 定义的模型首先由 Royston and Parmar (2002) 提出，通常称为 Royston and Parmar 模型。对数累积风险函数的这种扩展参数形式意味着该模型下的生存时间不再具有 Weibull 分布，也不再具有任何其他可识别的分布，尽管该模型仍然假设解释变量之间存在比例风险。 式 (6.13) 中的模型也可以用生存函数 \\(S_i(t)\\) 来表示，使用 \\(S_i(t)=\\exp\\{-H_i(t)\\}\\) 这一结果给出 \\[\\begin{align} S_i(t)=\\exp\\{-\\exp[\\eta_i+\\gamma_0+\\gamma_1y+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(y)]\\} \\tag{6.14} \\end{align}\\] 等价地 \\[S_i(t)=\\{S_0(t)\\}^{\\exp(\\eta_i)}\\] 其中 \\(S_0(t)=\\exp\\{-H_0(t)\\}\\) 为基线生存函数，\\(H_0(t)\\) 根据式 (6.11) 得出。在对数累积风险尺度上使用样条的一个优势在于，可以很容易地获得相应的生存函数。 风险函数的模型 \\(h_i(t)=\\exp(\\eta_i)h_0(t)\\) 也可以根据基线风险函数 \\(h_0(t)\\) 的相应参数模型得到。对 \\(\\log H_0(t)\\)关于 \\(t\\) 求导，给出 \\[\\frac{\\operatorname{d}\\log H_0(t)}{\\operatorname{d}t}=\\frac1{H_0(t)}\\frac{\\operatorname{d}H_0(t)}{\\operatorname{d}t}=\\frac1{H_0(t)}h_0(t)\\] 因此基线风险函数为 \\[h_0(t)=H_0(t)\\frac{\\operatorname{d}\\log H_0(t)}{\\operatorname{d}t}\\] 式 (6.11) 中的 \\(\\log H_0(t)\\) 关于 \\(t\\) 的导数为 \\[\\frac{\\operatorname{d}\\log H_0(t)}{\\operatorname{d}t}=\\frac{\\operatorname{d}\\log H_0(t)}{\\operatorname{d}y}\\frac{\\operatorname{d}y}{\\operatorname{d}t}=\\{\\gamma_1+\\gamma_2\\nu_1^{\\prime}(y)+\\cdots+\\gamma_{m+1}\\nu_m^{\\prime}(y)\\}t^{-1}\\] 其中 \\[\\nu_j^{\\prime}(y)=\\begin{cases}0&amp;y\\leqslant k_{\\min},\\\\-3\\lambda_j(y-k_{\\min})^2&amp;k_{\\min}\\leqslant y\\leqslant k_j,\\\\3(y-k_j)^2-3\\lambda_j(y-k_{\\min})^2&amp;k_j\\leqslant y\\leqslant k_{\\max},\\\\3(y-k_j)^2-3\\lambda_j(y-k_{\\min})^2-3(1-\\lambda_j)(y-k_{\\max})^2&amp;y\\geqslant k_{\\max}\\end{cases}\\] 是 \\(\\nu_j(y)\\) 关于 \\(y=\\log t,j=1,2,\\ldots,m\\) 的一阶导数。因此， \\[\\begin{align} h_i(t)=e^{\\eta_i}h_0(t)=e^{\\eta_i}\\left\\{\\gamma_1+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j^{\\prime}(y)\\right\\}t^{-1}H_0(t) \\tag{6.15} \\end{align}\\] 其中 \\(H_0(t)\\) 为全参数比例风险模型，由式 (6.11) 给出，其中基线风险是 \\(t=e^y\\) 的光滑函数，具有 \\(m+2\\) 个未知参数 \\(\\gamma_0,\\gamma_1,\\ldots,\\gamma_{m+1}\\)。 式 (6.13) 中的对数累积风险函数模型可用最大似然法进行拟合。似然函数是式 (6.2) 中的函数，并且在式 (6.14) 和 (6.15) 中给出了第 \\(i\\) 个个体在时间 \\(t_i\\) 处的生存函数和风险函数 \\(S_i(t_i),h_i(t_i)\\)。该似然函数的对数可以使用标准优化程序来最大化，这得到了拟合的生存和风险函数，它们是生存时间 \\(t\\) 的平滑函数。拟合过程还得到参数估计及其标准误，还有它们的函数，例如在任何给定时间的风险和生存函数的估计。 使用这些参数模型的经验表明，结数几乎不受协变量调整的影响。这意味着变量选择过程可以基于标准 Weibull 或 Cox 模型。一旦确定了 Royston and Parmar 模型中包含的解释变量，就可以拟合包含这些变量的限制性三次样条模型。同样，随着内部结数不断增加，首选模型是具有最小 AIC 或 BIC 统计量值的模型。 示例 6.5 (乳腺癌患者的无复发生存率) German Breast Cancer Study Group 在大量医院进行了一项针对乳腺癌的队列研究，目的是比较三个周期与六个周期的化疗效果，并调查额外激素治疗（每日服用 30mg 他莫昔芬 (tamoxifen) ，持续两年）的影响。研究中的患者均为经组织学证实为非转移性、淋巴结阳性的原发性乳腺癌患者，且已接受乳房切除术治疗。感兴趣的响应变量是无复发生存期 (recurrence-free survival)，即从研究入组到癌症复发或死亡的时间。早期的数据分析表明，无复发生存期不受化疗周期数的影响，因此本例中仅包含与患者是否接受他莫昔芬相关的因素。除了这一治疗因素外，还提供了患者年龄、绝经状态、肿瘤大小和分级、阳性淋巴结数、孕酮和雌激素受体状态的数据。Schumacher et al. (1994) 给出了这项研究的背景信息。 本例中的数据涉及来自 41 个中心和 686 名患者的完整数据，并包含在 Sauerbrei and Royston (1999) 中。该数据集中的变量如下： \\(Id\\)：患者编号 \\(Treat\\)：激素治疗（0 = 无他莫昔芬，1 = 他莫昔芬） \\(Age\\)：患者年龄 \\(Men\\)：绝经状态（1 = 绝经前，2 = 绝经后） \\(Size\\)：肿瘤大小（mm） \\(Grade\\)：肿瘤分级（1, 2, 3） \\(Nodes\\)：阳性淋巴结数 \\(Prog\\)：孕酮受体状态（毫飞摩尔，femtomole = 10-15 mol） \\(Oest\\)：雌激素受体状态（毫飞摩尔，femtomole = 10-15 mol） \\(Time\\)：无复发生存时间（天） \\(Status\\)：事件指示符（0 = 删失，1 = 复发或死亡） 这项研究共 686 名患者，其中 20 名患者的数据显示在表 6.1 中。在分析这些数据时，我们可能感兴趣的是在调整其他解释变量后的治疗效应，并估计两个治疗组调整的风险函数。 表 6.1 作为分析这些数据的第一步，使用按治疗组分层的对数累积风险图来研究 Weibull 模型的适用性。虽然其他解释变量的存在阻碍了对只有一个因素的此类曲线图的解释，但两个处理组的对数累计风险图（图 6.5）并没有显示两条直线。因此，生存时间服从 Weibull 分布的假设是不合适的。然而，图中两条曲线的垂直间隔似乎是恒定的，这表明关于治疗效应的比例风险假设是有效的。 图 6.5 在这一阶段，可以使用变量选择过程来确定除了治疗因素（Treat）外，还需要哪些其他解释因素（如 Age, Men, Size, Grade, Nodes, Prog 和 Oest）纳入模型，但在这个例子中，我们将把它们全部包括在内。然后拟合具有不断增加的内部结的 Royston and Parmar 模型。表 6.2 给出了拟合模型的 AIC 统计量，其中零结点的模型为标准 Weibull 模型。在拟合具有一个内部结的限制性立方样条时，AIC 统计量的值大幅减小，这表明该模型相对于标准 Weibull 模型有了实质性的改进。在添加第二个和第三个结时，AIC 统计量进一步减小，但减小的幅度远小于添加第一个结时。在添加第四个内部结时，AIC 统计量增加。这一分析表明，最好的拟合模型有三个结，尽管这与只有一个结的模型相比并没有明显的改善。该模型最简单的表示方式是以第 \\(i\\) 个患者的对数累积风险函数估计来表示，由下式给出 \\[\\begin{aligned}\\log\\hat{H}_i(t)=&amp;\\,\\hat{\\beta}_1Treat_i+\\hat{\\beta}_2Age_i+\\hat{\\beta}_3Men_i+\\hat{\\beta}_4Size_i+\\hat{\\beta}_5Grade_i\\\\&amp;+\\hat{\\beta}_6Nodes_i+\\hat{\\beta}_7Prog_i+\\hat{\\beta}_8Oest_i+\\log\\hat{H}_0(t)\\end{aligned}\\] 其中 \\[\\log\\hat{H}_0(t)=\\hat{\\gamma}_0+\\hat{\\gamma}_1y+\\hat{\\gamma}_2\\nu_1(y)+\\hat{\\gamma}_3\\nu_2(y)+\\hat{\\gamma}_4\\nu_3(y)\\] 是具有三个内部结的模型的基线累积风险函数，\\(y=\\log t\\) 以及函数 \\(\\nu_1(y),\\nu_2(y),\\nu_3(y)\\) 在式 (6.12) 中定义。 表 6.2 Royston and Parmar 模型拟合的直观总结如图 6.6 所示。该图展示了在拟合包含 8 个解释变量的 Cox 回归模型时调整的基线生存函数，显示为阶跃函数。此外，还展示了 Weibull 模型调整的基线生存函数，以及具有一个和三个内部结的模型的调整的基线生存函数。该图证实了 Cox 模型中的风险调整的基线生存函数无法很好地用 Weibull 模型来拟合。具有一个结的 Royston and Parmar 模型更紧密地追踪了 Cox 基线生存函数估计，而具有三个结的模型在远期生存时间提供了更好的性能。 图 6.6 具有三个结的 Royston and Parmar 模型的参数估计及其标准误如表 6.3 所示。该表还显示了拟合的 Cox 模型中的 \\(\\beta\\) 参数估计及其标准误。两个模型的估计及其标准误差非常相似。在两种模型下，服用他莫昔芬的患者与未服用他莫昔芬的患者相比，调整的风险比均为 0.71，因此服用他莫昔芬的患者癌症复发或死亡的风险较低。 表 6.3 Royston and Parmar 模型的优点是提供基线风险的参数估计。对于 Weibull 模型以及具有一个和三个结的 Royston and Parmar 样条模型，针对八个解释变量进行调整后的拟合基线风险函数如图 6.7 所示。 Royston and Parmar 模型表明潜在的风险函数是单峰的，因此 Weibull 模型拟合不佳也就不足为奇了。 图 6.7 6.5 灵活的比例几率模型 基于三次样条的参数模型也可以与第 5 章 5.15 节中描述的比例几率模型结合使用。关于生存超过时间 \\(t\\) 的几率的一般比例几率模型 (general proportional odds model) \\(S_i(t)/\\{1-S_i(t)\\}\\) 满足 \\[\\frac{S_i(t)}{1-S_i(t)}=\\exp\\{\\boldsymbol{\\beta}&#39;\\boldsymbol{x}_i\\}\\frac{S_0(t)}{1-S_0(t)}\\] 其中 \\(\\boldsymbol x_i\\) 是第 \\(i\\) 个个体的解释变量的值向量，\\(S_0(t)\\) 是基线幸存者函数，即解释变量全部取零值的个体的生存函数。如果假设生存时间采用参数为 \\(\\theta,\\kappa\\) 的 log-logistic 模型（如 5.15.1 节所示），则根据生存超过时间 \\(t\\) 的对数几率为，根据式 (5.9)，\\(S(t)=\\left\\{1+e^\\theta t^\\kappa\\right\\}^{-1}\\)。令 \\(S_0(t)\\) 为基线生存函数，其满足 \\[\\log\\left(\\frac{S_0(t)}{1-S_0(t)}\\right)=-\\theta-\\kappa\\log t=\\gamma_0+\\gamma_1y\\] 其中 \\(\\gamma_0=-\\theta,\\gamma_1=-\\kappa\\)，模型关于 \\(y = \\log t\\) 呈线性。通过纳入非线性项来扩展该模型，以给出具有 \\(m\\) 个内部结的限制性立方样条，并使用与式 (6.13) 中相同的符号，我们得到 \\[\\log\\left(\\frac{S_0(t)}{1-S_0(t)}\\right)=\\gamma_0+\\gamma_1y+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(y)\\] 这类似于式 (6.11) 中对数累积基线风险函数的表达式。包含样条项的比例几率模型可以表示为 \\[\\begin{aligned}\\log\\left(\\frac{S_i(t)}{1-S_i(t)}\\right)&amp;=\\eta_i+\\gamma_0+\\gamma_1y+\\sum_{j=1}^m\\gamma_{j+1}\\nu_j(y)\\end{aligned}\\] 其中 \\(\\eta_i=\\boldsymbol{\\beta}&#39;\\boldsymbol{x}_i\\)。 这种灵活的比例几率模型的使用方式与灵活的比例风险模型相同，特别适合风险函数为单峰的情况。该模型还可以用时间 \\(t\\) 之前发生事件的几率 \\(\\log[F(t)/\\{1-F(t)\\}]\\) 来表示，其实这就是 \\(-\\log[S(t)/\\{1-S(t)\\}]\\)，得到的参数估计仅在符号上有所不同。 该模型使用最大似然法进行拟合，并得出生存函数的估计。然后可以直接获得相应风险和累积风险函数的估计。 示例 6.6 (乳腺癌患者的无复发生存率) 示例 6.5 中确定的单峰风险函数表明，log-logistic 模型可能更适于拟合乳腺癌女性的无复发生存时间。表 6.4 给出了生存超过时间 \\(t\\) 的对数几率模型的 AIC 统计量值，该模型具有灵活的基线生存函数，其中零结模型是标准的比例几率模型。如示例 6.5 所示，除了治疗因素 Treat 之外，模型中还包括解释变量 Age, Men, Size, Grade, Nodes, Prog 和 Oest. 请注意，对于具有 1, 2 和 3 个结的模型，AIC 统计量的值表现有些不稳定，添加第四个结时统计量的值会略有增加。当所拟合的模型几乎无法区分时，就会出现如此现象，并且由于这些模型结数增加但位置不同，因此并非所有模型都是嵌套的。在这种情况下，包含三个结的生存超过时间 \\(t\\) 的对数几率模型提供了最好的拟合，尽管该模型的拟合非常类似于只有一个结的模型。此外，由于表 6.4 中的 AIC 统计量小于表 6.2 中相应比例风险模型的 AIC 统计量，因此选择比例几率模型。 表 6.4 对于三结点模型，与处理效应相关的参数估计为 0.5287. 服用他莫昔芬的患者生存超过时间 \\(t\\) 的几率与未服用他莫昔芬的患者的几率之比为 \\(\\exp(0.5287)=1.7\\)，因此服用他莫昔芬的患者生存超过任何给定时间的几率是未接受该治疗的患者的 1.7%. 这一结果与示例 6.5 中给出的治疗效应的相应风险比完全一致。 6.6 延伸阅读 分段指数模型由 Breslow (1974) 提出，并指出它等价于每次死亡时间之间风险恒定的 Cox 回归模型。Friedman (1982) 更详细地描述了该模型，而 Lawless (2002) 提供了数学处理较少的描述。用于拟合分段指数模型的有效数值优化方法包括 Dempster, Laird 和 Rubin (1977) 描述的期望最大化 (expectation-maximisation, EM) 算法、Groeneboom and Wellner (1992) 描述的 Iterative Convex Minorant (ICM) 算法以及由 Wellner and Zahn (1997) 描述的 EM 和 ICM 算法的结合。 de Boor (2001) 详细介绍了样条函数，而 Racine (2021) 和 Perperoglou et al. (2019) 提供了回归模型中样条函数的易于理解的概述。Durrleman and Simon (1989) 以及 Sleeper and Harrington (1989) 描述了三次样条在回归模型中的使用。Eilers and Marx (1996) 包含了 B 样条的概述，Rosenberg (1995) 描述了基线风险函数的加性 B 样条模型。Royston and Parmar (2002) 描述了基于限制性立方样条的比例风险和比例几率模型的灵活参数模型。 Royston and Lambert (2011) 对该模型及其在 Stata 中的实现进行了全面介绍。 "],["chap7.html", "第 7 章 参数模型的模型检查 7.1 参数模型的残差 7.2 特定参数模型的残差 7.3 比较观测的的和拟合的生存函数 7.4 识别有影响的观测 7.5 检验 Weibull 模型的比例风险 7.6 延伸阅读", " 第 7 章 参数模型的模型检查 评估模型充分性的诊断程序对于参数模型与 Cox 回归模型一样重要。基于残差的程序尤为重要，因此，本章首先定义了参数模型的残差，其中一些残差来源于第 4 章描述的 Cox 回归模型。接着，对假设为 Weibull 分布，log-logistic 分布和 lognormal 分布的模型对数据的适用性，提供了图形程序的总结。随后，考虑其他检验参数回归模型拟合度的方法，以及检测有影响的观测的方法。最后总结了如何在拟合 Weibull 比例风险模型后检验比例风险假设。 7.1 参数模型的残差 假设 \\(T_i\\) 是与第 \\(i\\) 个个体生存时间相关的随机变量，\\(i=1,2,\\ldots,n\\)，并且 \\(x_{1i},x_{2i},\\ldots,x_{pi}\\) 是该个体的 \\(p\\) 个解释变量 \\(X_1,X_2,\\ldots,X_p\\) 的值。为 \\(T_i\\) 假定加速失效时间模型，我们有 \\[\\begin{aligned}\\log T_i=\\mu+\\alpha_1x_{1i}+\\alpha_2x_{2i}+\\cdots+\\alpha_px_{pi}+\\sigma\\epsilon_i\\end{aligned}\\] 其中 \\(\\epsilon_i\\) 是一个随机变量，其概率分布取决于 \\(T_i\\) 采用的分布，并且 \\(\\mu,\\sigma\\) 和 \\(\\alpha_j,j=1,2,\\ldots,p\\) 是未知参数。如果第 \\(i\\) 个个体的观测生存时间删失，相应的残差也将删失，使这些量的解释变得复杂。 7.1.1 标准化残差 加速失效时间建模中采用的残差的自然形式是标准化残差 (standardized residual)，定义为 \\[\\begin{align} r_{Si}=\\left\\{\\log t_{i}-\\hat{\\mu}-\\hat{\\alpha}_{1}x_{1i}-\\hat{\\alpha}_{2}x_{2i}-\\cdots-\\hat{\\alpha}_{p}x_{pi}\\right\\}/\\hat{\\sigma} \\tag{7.1} \\end{align}\\] 其中 \\(t_i\\) 是第 \\(i\\) 个个体的观测生存时间， \\(\\hat{\\mu},\\hat{\\sigma},\\hat{\\alpha}_j\\) 是拟合的加速失效时间模型的参数估计，\\(j=1,2,\\ldots,p\\)。这个残差具有“观测值-拟合值”的形式，如果模型是正确的，则预期它具有与加速失效时间模型中的 \\(\\epsilon_i\\) 相同的分布。例如，如果 \\(T_i\\) 采用 Weibull 分布，如果拟合模型是正确的，则预期 \\(r_{Si}\\) 的表现就好像它们是来自 Gumbel 分布的删失样本。残差的生存函数估计将类似于 \\(\\epsilon_i\\) 的生存函数，即 \\(S_{\\epsilon_i}(\\epsilon)\\)。使用第 4 章 4.1.1 节中的一般结果，\\(− \\log S_{\\epsilon_i}(\\epsilon)\\) 具有单位指数分布，因此如果拟合模型是合适的，则 \\(− \\log S_{\\epsilon_i}(\\epsilon)\\) 将具有近似单位指数分布。这为可用于评估模型充分性的诊断图提供了基础，如第 7.2.4 节所述。 7.1.2 Cox-Snell 残差 第 4 章 4.1.1 节中为 Cox 回归模型定义的 Cox-Snell 残差本质上是第 \\(i\\) 个观测在相应事件时间 \\(t_i\\) 时的累积风险函数的估计。类似形式的残差也可用于评估参数模型的充分性。主要区别在于，现在生存函数和风险函数是参数函数，取决于生存时间采用的分布。 参数模型的 Cox-Snell 残差定义为 \\[\\begin{align} r_{C{i}}=\\hat{H}_{{i}}(t_{{i}})=-\\log\\hat{S}_{{i}}(t_{{i}}) \\tag{7.2} \\end{align}\\] 其中 \\(\\hat H_i(t_i),\\hat Si (t_i)\\) 分别为 \\(t_i\\) 处的累积风险函数和生存函数估计。使用第 5 章的式 (5.65) 拟合加速失效时间模型，第 \\(i\\) 个个体的生存函数估计为 \\[\\begin{align} \\hat{S}_i(t)&amp;=S_{\\epsilon_i}\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}_1x_{1i}-\\hat{\\alpha}_2x_{2i}-\\cdots-\\hat{\\alpha}_px_{pi}}{\\hat{\\sigma}}\\right) \\tag{7.3} \\end{align}\\] 其中 \\(S_{\\epsilon_i}(\\epsilon)\\) 是加速失效时间模型中 \\(\\epsilon_i\\) 的生存函数，\\(\\hat \\alpha_j\\) 是 \\(x_{ji}\\) 的系数估计，\\(j = 1, 2,...,p\\)，\\(\\hat{\\mu},\\hat{\\sigma}\\) 是 \\({\\mu},{\\sigma}\\) 的估计。第 5 章 5.12 节描述了一些常用的 \\(T_i\\) 分布的 \\(S_{\\epsilon_i}(\\epsilon)\\) 形式。 与 Cox 回归模型的情况一样，当拟合了正确的模型时，Cox-Snell 残差可视为具有单位指数分布，且删失观测得到删失残差；详细信息请参见 4.1.1 节。式 (7.2) 中的 Cox-Snell 残差也与式 (7.1) 中的标准化残差非常密切相关，因为从式 (7.3) 中，我们可看出 \\(r_{Ci}=-\\log S_{\\epsilon_{i}}\\left(r_{Si}\\right)\\)。因此，评估标准化残差是否具有特定分布相当于评估相应的 Cox-Snell 残差是否具有单位指数分布。 7.1.3 鞅残差 鞅残差度量了在区间 \\((0, t_i)\\) 内的实际观测死亡数（0 或 1）与模型预测值之间的差异。对具有异常大的鞅残差的观测，模型拟合效果不佳。类似于第 4 章式 (4.6) 中为 Cox 回归模型定义的鞅残差 (martingale residuals) \\[\\begin{align} r_{Mi}=\\delta_i-r_{Ci} \\tag{7.4} \\end{align}\\] 其中，\\(\\delta_i\\) 是第 \\(i\\) 个观测的事件指示符，若该观测是事件则 \\(\\delta_i=1\\)，若为删失则为 \\(\\delta_i=0\\)；\\(r_{Ci}\\) 是式 (7.2) 中给出的 Cox-Snell 残差。 由于 7.2.1 节给出的原因，参数加速失效时间模型的鞅残差之和为零，但并非关于零对称分布。严格来说，将这些残差称为鞅残差是不合适的，因为它们的推导是基于鞅方法的，不能延伸到加速失效时间模型。然而，为了语义上的方便，我们将仍将式 (7.4) 中的量称为鞅残差。 7.1.4 偏差残差 偏差残差 (deviance residuals) 在第 4 章式 (4.7) 中首次提出，可看作是使鞅残差在零附近对称分布的一种尝试，定义为 \\[\\begin{align} r_{Di}=\\operatorname{sgn}(r_{Mi})\\left[-2\\left\\{r_{Mi}+\\delta_i\\log(\\delta_i-r_{Mi})\\right\\}\\right]^{\\frac{1}{2}} \\tag{7.5} \\end{align}\\] 由此定义得到的残差偏差通常与可比的 Cox 回归模型的残差相似。然而，式 (7.5) 中的 \\(r_{Di}\\) 值通常与式 (7.1) 中的标准化残差 \\(r_{Si}\\) 具有相反的符号。这是因为参数加速失效时间模型基于生存时间的对数，而不是风险函数。因此，将加速失效时间模型的偏差残差定义为值 \\(-r_{Di}\\) 更为合适，该在一些生存分析软件包中使用。还需要注意的是，式 (7.5) 中的偏差残差不是拟合的参数模型偏差的组成部分，但为方便起见，仍将其称为偏差残差。 7.1.5 得分残差 与 Cox 回归模型中的得分残差或 Schoenfeld 残差类似，得分残差 (score residuals) 可以针对任何参数模型进行定义。得分残差是对数似然函数关于未知参数 \\(\\mu,\\sigma\\) 和 \\(\\alpha_j(j=1,2,\\ldots,p)\\) 的导数的组成部分，并在这些参数的最大似然估计值 \\(\\hat{\\mu},\\hat{\\sigma}\\) 和 \\(\\hat \\alpha_j\\) 处进行求值。根据第 5 章的式 (5.74) ，\\(n\\) 个观测的对数似然函数为 \\[\\begin{aligned}\\log L(\\boldsymbol{\\alpha},\\mu,\\sigma)&amp;=\\sum_{i=1}^n\\left\\{-\\delta_i\\log(\\sigma t_i)+\\delta_i\\log f_{\\epsilon_i}(z_i)+(1-\\delta_i)\\log S_{\\epsilon_i}(z_i)\\right\\}\\end{aligned}\\] 其中 \\(z_i=(\\log t_i-\\mu-\\alpha_1x_{1i}-\\alpha_2x_{2i}-\\cdots-\\alpha_px_{pi})/\\sigma,f_{\\epsilon_i}(\\epsilon)\\) 和 \\(S_{\\epsilon_i}(\\epsilon)\\) 分别为 \\(\\epsilon_i\\) 的密度和生存函数，\\(\\delta_i\\) 为事件指示符。 对该对数似然函数关于参数 \\(\\mu,\\sigma\\) 和 \\(\\alpha_j(j=1,2,\\ldots,p)\\) 进行微分，得到导数 \\[\\begin{aligned} &amp;\\begin{aligned}\\frac{\\partial\\log L}{\\partial\\mu}\\end{aligned} \\begin{aligned}=\\sigma^{-1}\\sum_{i=1}^ng(z_i),\\end{aligned} \\\\ &amp;\\begin{aligned}\\frac{\\partial\\log L}{\\partial\\sigma}\\end{aligned} =\\left.\\sigma^{-1}\\sum_{i=1}^n\\left\\{z_ig(z_i)-\\delta_i\\right\\},\\right. \\\\ &amp;\\begin{aligned}\\frac{\\partial\\log L}{\\partial\\alpha_j}\\end{aligned} =\\sigma^{-1}\\sum_{i=1}^nx_{ji}g(z_i) \\end{aligned}\\] 其中函数 \\(g(z_i)\\) 为 \\[\\begin{align} g(z_i)=\\frac{(1-\\delta_i)f_{\\epsilon_i}(z_i)}{S_{\\epsilon_i}\\left(z_i\\right)}-\\frac{\\delta_if_{\\epsilon_i}^{\\prime}\\left(z_i\\right)}{f_{\\epsilon_i}\\left(z_i\\right)} \\tag{7.6} \\end{align}\\] 其中 \\(f&#39;_{{i}}(z_{{i}})\\) 为 \\(f_{{i}}\\left(z_{{i}}\\right)\\) 关于 \\(z_i\\) 的导数。那么，每个导数在未知参数最大似然估计处的值，其第 \\(i\\) 个分量就是相应项的残差得分。因此，根据式 (7.1) 中的标准化残差的定义，\\(\\mu\\) 的第 \\(i\\) 个得分残差为 \\[\\hat{\\sigma}^{-1}g(r_{S{i}})\\] 尺度参数 \\(\\sigma\\) 的第 \\(i\\) 个得分残差为 \\[\\hat{\\sigma}^{-1}\\left\\{r_{Si}\\left.g(r_{Si})-\\delta_i\\right\\}\\right.\\] 模型中的第 \\(j\\) 个解释变量 \\(X_j\\) 的第 \\(i\\) 个得分残差为 \\[r_{U{j}i}=\\hat{\\sigma}^{{-}1}x_{{j}{i}}g(r_{S{i}})\\] 其中，\\(X_j\\) 的得分残差是最重要的，在 4.1.6 节中表示为 \\(r_{U{j}i}\\)。这些残差的特定表达式将在后续部分针对一些特定的参数模型给出。由于得分残差的和是对数似然函数在其最大值处的导数，因此这些残差之和必为零。 7.2 特定参数模型的残差 在本节中，描述了基于 Weibull, log-logistic 和 log-normal 分布的生存时间参数模型的残差形式。 7.2.1 Weibull 分布 7.1 节中描述的残差可以与 Weibull 模型的比例风险或加速失效时间的表示法结合使用。我们从第 5 章中描述的比例风险模型开始，根据该模型，第 \\(i\\) 个个体在时间 \\(t\\) 时的死亡风险为 \\[\\begin{aligned}h_i(t)=\\exp(\\beta_1x_{1i}+\\beta_2x_{2i}+\\cdots+\\beta_px_{pi})h_0(t)\\end{aligned}\\] 其中 \\(h_0(t)=\\lambda\\gamma t^{\\boldsymbol{\\gamma}-1}\\) 为基线风险函数。累积风险函数的相应估计为 \\[\\begin{aligned}\\hat{H}_i(t)&amp;=\\exp(\\hat{\\beta}_1x_{1i}+\\hat{\\beta}_2x_{2i}+\\cdots+\\hat{\\beta}_px_{pi})\\hat{\\lambda}t\\hat{\\gamma}\\end{aligned}\\] 它们是如式 (7.2) 定义的 Cox-Snell 残差。 在模型的加速失效时间版本中，\\(\\epsilon_i\\) 具有 Gumbel 分布，其生存函数为 \\[\\begin{align} S_{\\epsilon_{i}}(\\epsilon)=\\operatorname{exp}(-e^{\\epsilon}) \\tag{7.7} \\end{align}\\] 标准化残差如式 (7.1) 所示，如果拟合了适当的模型，则预期这些残差将表现为来自 Gumbel 分布的可能删失样本。这相当于评估 Cox-Snell 残差（定义如下）是否具有单位指数分布。 根据式 (7.7)，Cox-Snell 残差 \\(r_{Ci}=-\\log S_{\\epsilon_{i}}\\left(r_{Si}\\right)\\) 是标准化残差的指数，即 \\(r_{Ci}=\\exp(r_{Si})\\)。使用式 (7.4) 和 (7.5)，这些残差将立即得到 Weibull 模型的鞅残差和偏差残差。 Weibull 模型的得分残差可从 7.1.5 节的一般结果中得出。这里，根据式 (7.7) 中的 \\(S_{\\epsilon_i}(z_i)=\\exp(-e^{{z_i}})\\)，对 \\(S_{\\epsilon_i}(z_i)\\) 求导并乘以 -1 得到 \\(f_{\\epsilon_i}(z_i)=e^{z_i}\\exp(-e^{z_i})\\)。此外由 \\(f&#39;_{\\epsilon_i}(z_i)=(1-e^{z_i})f_{\\epsilon_i}(z_i)\\)，将其代入式 (7.6) 后，经过一些代数计算后可得到 \\(g(z_i)=e^{z_i}-\\delta_i\\)。模型中第 \\(j\\) 个解释变量 \\(X_j\\) 的第 \\(i\\) 个得分残差为 \\[\\begin{aligned}r_{Uji}=\\hat{\\sigma}^{-1}x_{ji}\\left(e^{r_{Si}}-\\delta_{i}\\right)\\end{aligned}\\] 其中 \\(r_{Si}\\) 是第 \\(i\\) 个标准化残差，\\(\\delta_i\\) 是事件指示符。 我们还注意到，\\(\\mu\\) 的第 \\(i\\) 个得分残差是 \\(\\hat{\\sigma}^{-1}(e^{r_{S}i}-\\delta_{i})\\)，即 \\(\\hat{\\sigma}^{-1}(r_{Ci}-\\delta_{i})\\)。由于这些得分残差之和为零，因此式 (7.4) 中定义的鞅残差之和在 Weibull 模型中必为零。 7.2.2 Log-logistic 分布 在 log-logistic 加速失效时间模型中，随机变量 \\(\\epsilon_i\\) 具有 logistic 分布，其生存函数为 \\[\\begin{aligned}S_{\\epsilon_i}(\\epsilon)=\\left(1+e^{\\epsilon}\\right)^{-1}\\end{aligned}\\] 因此，如果拟合模型正确，根据式 (7.1) 获得的标准化残差应该表现为 logistic 分布的样本。等价地，log-logistic 加速失效时间模型的 Cox-Snell 残差由下式给出 \\[\\begin{aligned}r_{Ci}=-\\log S_{\\epsilon_i}(r_{Si})\\end{aligned}\\] 即 \\[\\begin{aligned}r_{Ci}=\\log\\left\\{1+\\exp\\left(r_{Si}\\right)\\right\\}\\end{aligned}\\] 其中 \\(r_{Si}\\) 是第 \\(i\\) 个标准化残差。得分残差根据 7.1.5 节一般结果得出，使用式 (7.6) 我们发现模型中第 \\(j\\) 个解释变量的第 \\(i\\) 个得分残差为 \\[r_{Uji}=\\hat{\\sigma}^{-1}x_{ji}\\left\\{\\frac{\\exp(r_{Si})-\\delta_i}{1+\\exp(r_{Si})}\\right\\}\\] 7.2.3 Log-normal 分布 若假定生存时间呈 log-normal 分布，则加速失效时间模型的对数线性公式中的 \\(\\epsilon_i\\) 呈正态分布。根据式 (5.73) ，第 \\(i\\) 个个体的生存函数估计为 \\[\\begin{aligned}\\hat{S}_i(t)&amp;=1-\\Phi\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}_1x_{1i}-\\hat{\\alpha}_2x_{2i}-\\cdots-\\hat{\\alpha}_px_{pi}}{\\hat{\\sigma}}\\right)\\end{aligned}\\] 因此 Cox-Snell 残差变为 \\[\\begin{aligned}r_{Ci}=-\\log\\left\\{1-\\Phi\\left(r_{Si}\\right)\\right\\}\\end{aligned}\\] 如往常一样，\\(r_{Si}\\) 是式 (7.1) 中的第 \\(i\\) 个标准化残差。同样，鞅残差和偏差残差也是从这些标准化残差中得出的，而得分残差则是根据 7.1.5 节的结果中得出的。具体来说，\\(X_j\\) 的第 \\(i\\) 个得分残差是 \\[r_{Uji}=\\hat{\\sigma}^{-1}\\left\\{\\frac{(1-\\delta_i)f_{\\epsilon_i}(r_{Si})}{1-\\Phi(r_{Si})}+\\delta_ir_{Si}\\right\\}\\] 其中 \\(f_{\\epsilon_i}(r_{Si})\\) 是 \\(r_{Si}\\) 处的标准正态密度函数，\\(\\Phi(r_{Si})\\) 是相应的分布函数。 7.2.4 残差分析 在为生存数据拟合参数模型后进行残差分析时，将 Cox-Snell 残差的分布与单位指数分布进行比较是最有用的方式之一。如 7.1.1 节所述，这相当于将标准化残差的分布与加速失效时间模型的对数线性形式中的随机变量 \\(\\epsilon_i\\) 的分布进行比较。这种比较是通过绘制残差的累积风险或对数累积风险图来完成的，如第 4 章 4.2.1 节所示，其中使用 Cox 回归模型的残差说明了该图形的用途。总之，获得了 Cox-Snell 残差的生存函数的 Kaplan-Meier 估计 \\(\\hat{S}(r_{Ci})\\)，并绘制 \\(-\\log\\hat S(r_{Ci})\\) 关于 \\(r_{Ci}\\) 的图形。若得到单位斜率和零截距的直线，则表明拟合的模型是合适的。或者，若拟合的生存模型令人满意，残差的对数累积风险图，即 \\(\\log\\{-\\log\\hat{S}(r_{Ci})\\}\\) 关于 \\(\\log r_{Ci}\\) 的图形，也将呈现一条具有单位斜率和零截距的直线。 在 4.2.1 节对这种图表的使用提出了许多批评。然而，对于参数模型得出的残差，这些批评没有那么大的影响。其原因在于，Cox 回归模型中使用的基线累积风险函数的非参数估计现在被参数函数的估计所取代。该函数通常仅取决于两个参数 \\(\\mu,\\sigma\\)，因此当为生存数据拟合加速失效时间模型时，需估计的参数较少。因此，当拟合了正确的模型时，参数模型的 Cox-Snell 残差更有可能通过单位指数分布来近似。 其他有用的残差图包括鞅残差或偏差残差的索引图，可用于识别模型未能很好拟合的观测。鞅残差或偏差残差与生存时间、生存时间秩次或解释变量的图形，可以显示模型在特定时间或解释变量的特定值上是否拟合不佳。鞅残差或偏差残差关于加速因子估计 \\(\\operatorname{exp}(-\\hat{\\boldsymbol{\\alpha}}^{\\prime}\\boldsymbol{x}_i)\\)、时间比估计 \\(\\operatorname{exp}(\\hat{\\boldsymbol{\\alpha}}^{\\prime}\\boldsymbol{x}_i)\\) 或加速失效时间模型的线性分量估计 \\(\\hat{\\boldsymbol{\\alpha}}^{\\prime}\\boldsymbol{x}_i\\) 的图形，也提供了关于残差与个体可能的生存时间之间关系的信息。那些加速因子估计较大的个体往往生存时间较短。得分残差的索引图，或得分残差关于生存时间、生存时间的秩次的图形，可在对模型充分性进行更全面的评估时进行检查。 示例 7.1 (卵巢癌患者的化疗) 第 5 章的示例 5.11 提供了卵巢癌患者生存时间的数据。使用 Weibull 比例风险模型对数据进行分析，所选模型包含与女性年龄（Age）和女性所属治疗组（Treat）对应的变量。在模型的加速失效时间表示中，第 \\(i\\) 个女性的生存函数估计为 \\[\\begin{aligned}\\hat{S}_i(t)&amp;=S_{\\epsilon_i}\\left(\\frac{\\log t-\\hat{\\mu}-\\hat{\\alpha}_1Age_i-\\hat{\\alpha}_2Treat_i}{\\hat{\\sigma}}\\right)\\end{aligned}\\] 其中 \\(S_{\\epsilon_i}(\\epsilon)=\\exp(-e^{\\epsilon})\\)，因此 \\[\\begin{aligned}\\hat{S_i}(t)&amp;=\\exp\\left\\{-\\exp\\left(\\frac{\\log t-10.4254+0.0790Age_i-0.5615Treat_i}{0.5489}\\right)\\right\\}\\end{aligned}\\] 标准化残差值为 \\[\\begin{aligned}r_{Si}&amp;=(\\log t_i-10.4254+0.0790Age_i-0.5615Treat_i)/0.5489\\end{aligned}\\] 其中 \\(i=1,2,\\ldots,26\\)。这些值在表 7.1 中给出，还给出了 Cox-Snell 残差的值，对于 Weibull 模型，这些值为 \\(r_{Ci}=\\exp(r_{S{i}})\\)。 表 7.1 图 7.1 给出了 Cox-Snell 残差的累积风险图。在此图中，绘制的点位于截距和斜率分别接近于零和一的直线上。然而也有一些证据表明存在系统性偏离直线的情况，这让人对拟合模型的充分性产生了一些担忧。 图 7.1 鞅残差和偏差残差 \\(r_{Mi}\\) 和 \\(r_{Di}\\) 关于生存时间秩次的图形分别如图 7.2 和 7.3 所示。两图表均显示出，具有较长生存时间的观测往往具有较小的残差，但这些观测也是删失观测。 图 7.2 图 7.3 图 7.4 显示了模型中的变量 Age 和 Treat 的得分残差关于生存时间秩次的图形。Age 的得分残差图显示，存在三个具有相对较大残差的观测，它们对应于表 5.6 原始数据集中的患者 14, 4 和 26. 然而，这些观测似乎并没有什么异常之处。患者 26 的 Treat 得分残差也比其他患者稍大。这表明该模型未能很好地拟合患者 14, 4 和 26 的数据。 图 7.4 7.3 比较观测的的和拟合的生存函数 在参数建模中，生存函数估计是生存时间 \\(t\\) 的连续函数，因此可针对模型中包含的解释变量的特定值绘制该函数。当只有一个生存数据样本且没有解释变量时，拟合的生存函数可以直接与生存函数的 Kaplan-Meier 估计进行比较，如第 2 章 2.1.2 节所述。如果拟合的生存函数接近 Kaplan-Meier 估计（这是一个阶跃函数），拟合的模型是数据的合适总结。同样，假设模型包含一两个因素，这些因素根据治疗组对个体进行分类，或提供治疗组和性别之间的交叉分类。对于由模型中各因素水平的组合定义的每一组个体，可以将拟合的生存函数与相应的生存函数的 Kaplan-Meier 估计进行比较。 在记录多个解释变量值的情况下，会根据拟合模型的线性部分的估计值形成个体组。对于第 \\(i\\) 个个体（其在模型中解释变量的值为 \\(\\boldsymbol x_i\\)），此线性部分在比例风险模型中就是风险评分 \\(\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{x}_i\\)，在加速失效时间模型中则是 \\(\\hat{\\boldsymbol{\\alpha}}^{\\prime}\\boldsymbol{x}_i\\)。接下来的讨论基于风险评分进行，其中较大的正值对应较高的风险，但同样也可以基于加速失效时间模型的线性部分、加速因子值或时间比值来进行。 将每个个体的风险评分值按升序排列，并将个体根据这些值分为若干组。例如，如果考虑三个组，就会有风险评分值低、中、高的个体。以这种方式形成的实际组数将取决于数据集的大小。对于较大的数据集，可能构建五个甚至七个组。具体来说，如果有五个组，那么每个组中将有 20% 的个体；风险评分值最低和最高的个体将分别处于低风险和高风险，而中间的 20% 的个体将处于中风险。 下一步是比较每组中观测的和拟合的生存函数。假设 \\(\\hat{S}_{ij}(t)\\) 是第 \\(j\\) 组中第 \\(i\\) 个个体基于模型的生存函数估计。然后根据下式获得每个组（或仅获得具有最小、中等和最高风险评分的组）的平均生存函数 \\[\\bar{S}_j(t)=\\frac1{n_j}\\sum_{i=1}^{n_j}\\hat{S}_{ij}(t)\\] 其中 \\(n_j\\) 是第 \\(j\\) 组的观测数。对于一系列 \\(t\\) 值，我们会得到 \\(\\bar{S}_j(t)\\) 的值，因此，对于每个 \\(j\\) 值，将 \\(\\bar{S}_j(t)\\) 的值关于 \\(t\\) 值作图，可以得到一条平滑曲线。而对于特定组，对应的观测生存函数是该组个体生存函数的 Kaplan-Meier 估计。将这两组估计叠加在一起，可以直观地表示观测生存函数与拟合生存函数之间的一致性。此程序与 3.11.1 节中描述的用于 Cox 回归模型的程序类似。 使用这种方法，通常比基于残差的图形更容易检测出与拟合模型的偏差。然而，该程序可能因使用相同的拟合模型来定义组并获得每组的生存函数估计而受到批评。如果数据集足够大，则可以根据一半数据估计生存函数，并根据另一半数据评估模型的拟合度。此外，由于该方法基于风险评分的值，事实上，有可能存在具有不同解释变量值但碰巧具有相同风险评分值的个体，该方法没有考虑到这些个体的差异。 示例 7.2 (卵巢癌患者的化疗) 在本例中，我们检查 Weibull 比例风险模型对 26 名卵巢癌女性患者接受治疗后的生存时间数据的拟合情况。拟合包含变量 Age 和 Treat 的 Weibull 模型，如示例 5.11 所示，因此第 \\(i\\) 个个体拟合的生存函数为 \\[\\begin{align} \\hat{S}_i(t)=\\exp\\left\\{-e^{\\hat{\\eta}_i}\\hat{\\lambda}t^{\\hat{\\gamma}}\\right\\} \\tag{7.8} \\end{align}\\] 其中 \\(\\hat{\\eta}_i=0.144\\,Age_i-1.023\\,Treat_i\\) 为风险评分，\\(i=1,2,\\ldots,26\\)。这等价于示例 7.1 使用的模型的加速失效时间表示。然后将 \\(\\hat \\eta_i\\) 的值按升序排列并分为三组，如表 7.2 所示。 表 7.2 下一步是通过对三组患者的生存函数估计值进行平均，来获得每组的平均生存函数（如式 (7.8) 所示），其中考虑的时间点有 \\(t = 0, 1,..., 1230\\)。三个平均生存函数如图 7.5 所示。然后计算表 7.2 中所示的三组中每个个体的生存函数的 Kaplan-Meier 估计，这也显示在图 7.5 中。 图 7.5 从该图中，我们看到该模型对高危组患者的拟合很好。但对于中等风险组，观测生存函数和拟合生存函数之间的一致性不太好，因为拟合模型对生存函数的估计有点过高。事实上，该组的患者具有最大的鞅残差值，这也表明拟合模型没有充分总结这些个体的死亡时间。低风险组中只有 1 例死亡，因此模型对于这组患者的拟合情况几乎无从得知。 7.4 识别有影响的观测 与拟合 Cox 回归模型时一样，识别对特定参数估计或整组参数估计产生不当影响的观测非常重要。本节依次考虑这两个方面的影响。 Weibull 比例风险模型的许多影响诊断可从模型的加速失效时间表示中导出，但它们也适用于该系列的其他模型。这些诊断是根据模型中所有 \\(p + 2\\) 个 的估计参数及其方差-协方差阵计算得出的。为了方便起见，\\(p + 2\\) 个参数的向量将用 \\(\\boldsymbol \\theta\\) 表示，因此 \\(\\boldsymbol{\\theta&#39;}=(\\mu,\\alpha_1,\\alpha_2,\\ldots,\\alpha_p,\\sigma)\\)。向量 \\(\\hat{\\boldsymbol \\theta}&#39;\\) 表示参数估计的相应向量。 7.4.1 观测对单个参数估计的影响 在省略第 \\(i\\) 个观测的情况下，\\(\\boldsymbol \\theta\\) 向量的第 \\(j\\) 个分量 \\(\\boldsymbol \\theta_j\\) 估计值变化量近似为如下 \\((p + 2) × 1\\) 矢量的第 \\(j\\) 个分量 \\[\\begin{align} \\mathrm{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\boldsymbol{u}_i \\tag{7.9} \\end{align}\\] 在式 (7.9) 中，\\(\\mathrm{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\) 是 \\(\\boldsymbol \\theta\\) 参数估计的方差-协方差阵，\\(\\boldsymbol u_i\\) 是第 \\(i\\) 个观测的对数似然关于 \\(\\boldsymbol \\theta\\) 中 \\(p+2\\) 个参数的一阶偏导数值的 \\((p + 2) × 1\\) 向量，在 \\(\\hat{\\boldsymbol \\theta}\\) 处求值。 而 \\(\\boldsymbol u_i\\) 是一个 \\((p + 2) × 1\\) 向量，包含了第 \\(i\\) 个观测的对数似然函数关于 \\(\\boldsymbol \\theta\\) 中 \\(p+2\\) 个参数的一阶偏导数在 \\(\\hat{\\boldsymbol \\theta}\\) 处的值。 因此，向量 \\(\\boldsymbol u_i\\) 是第 \\(i\\) 个观测的得分残差值向量，在 7.1.5 节中定义。 量 \\(\\Delta_i\\hat{\\alpha}_j\\) 是式 (7.9) 中向量的第 \\(2\\) 至第 \\(p − 1\\) 个分量，但我们继续将其称为 delta-betas 而不是 delta-alphas. 这些值可以通过除以 \\(\\hat\\alpha_j\\) 的标准误来标准化，从而得到标准化的 delta-betas. 索引图或 \\(\\Delta_i\\hat{\\alpha}_j\\) 标准化或非标准化值的图形提供了这方面的影响的信息性总结。 7.4.2 观测对参数估计集的影响 参数生存模型中 \\(n\\) 个观测中的每一个对参数估计集的影响可以使用似然位移 (likelihood displacement) 来度量。这在第 4 章 4.3 节中结合 Cox 回归模型进行了描述，它只是为完整数据集拟合的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值与为移除第 i 行的数据集拟合的模型的 \\(-2\\operatorname{log}\\hat{L}\\) 值之差，\\(i = 1, 2,...,n\\)。实际上该统计量为矩阵 \\(\\boldsymbol{U}\\operatorname{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\boldsymbol{U}^{\\prime}\\) 的对角元，这是最简单的计算方式，其中 \\(\\boldsymbol{U}\\) 为 \\(n \\times (p + 2)\\) 矩阵，其元素为 \\(\\partial\\log L_i/\\partial\\theta_j,j=1,2,\\ldots,p{+}2\\), 其中 \\(\\theta_j\\) 是参数向量 \\(\\boldsymbol \\theta\\) 的第 \\(j\\) 个参数估计，\\(\\mathrm{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\) 是参数估计的方差-协方差阵，\\(L_i\\) 是第 \\(i\\) 个观测的似然贡献。该统计量的较大值表明相应的观测对拟合模型中的参数估计有所影响。 Hall, Rogers and Pregibon (1982) 提出了另外两个度量第 \\(i\\) 个观测对构成向量 \\(\\boldsymbol \\theta\\) 的参数集的影响的总结指标：统计量 \\(F_i\\) 和 \\(C_i\\)。量 \\(F_i\\) 由下式给出 \\[\\begin{align} F_i=\\frac{\\boldsymbol{u&#39;}_i\\boldsymbol{R^{-1}}\\boldsymbol{u}_i}{(p+2)\\{1-\\boldsymbol{u&#39;}_i\\boldsymbol{R^{-1}}\\boldsymbol{u}_i\\}} \\tag{7.10} \\end{align}\\] 其中 \\((p + 2) \\times (p + 2)\\) 矩阵 \\(\\boldsymbol R\\) 为得分残差的叉乘矩阵，即 \\(\\boldsymbol R = \\sum_{i=1}^n\\boldsymbol{u}_i\\boldsymbol{u}_i^{\\prime}\\)。等价地，\\(\\boldsymbol{R}=\\boldsymbol{U&#39;U}\\)，其中 \\(\\boldsymbol{U}\\) 是 \\(n \\times (p + 2)\\) 矩阵，其第 \\(i\\) 行是得分残差向量 \\(\\boldsymbol u&#39;_i\\) 的转置。第 \\(i\\) 个观测对参数估计集影响的另一个度量是统计量 \\[\\begin{align} C_i=\\frac{\\boldsymbol{u&#39;}_i\\mathrm{var}\\left(\\boldsymbol{\\theta}\\right)\\boldsymbol{u}_i}{\\{1-\\boldsymbol{u&#39;}_i\\mathrm{var}\\left(\\hat{\\boldsymbol{\\theta}}\\right)\\boldsymbol{u}_i\\}^2} \\tag{7.11} \\end{align}\\] 统计量 \\(F_i\\) 和 \\(C_i\\) 的通常具有截然不同的值。然而，在每种情况下，较大的统计量表明相应的观测是有影响的。需要通过从数据集中省略该观测并重新拟合模型来研究这些观测究竟如何影响了估计。 示例 7.3 (卵巢癌患者的化疗) 我们现在继续研究卵巢癌化疗后的生存时间数据中是否存在任何有影响的观测。年龄和治疗的非标准化 delta-betas，关于生存时间的秩次制图，如图 7.6 和 7.7 所示。 图 7.6 图 7.7 在图 7.6 中，两个观测的 Age 的 delta-betas 值相对较大，对应于原始数据集的患者 4 和 5 中。这两名女性的生存时间都很短，而且其中一名年龄相对较大，为 74 岁，另一名相对年轻，为 43 岁。图 7.7 中显示的 Treat 的 delta-betas 没有显示任何异常特征。 接下来我们研究每个观测对参数估计集的影响。图 7.8 显示了似然位移统计量关于生存时间秩次的图形。 图 7.8 式 (7.10) 和 (7.11) 中定义的 \\(F_i\\) 和 \\(C_i\\) 的值关于生存时间秩次的图形绘制在图 7.9 和 7.10 中。图 7.9 清晰地表明与患者 5 对应的观测是有影响的，并且应更详细地研究患者 1, 4, 14 和 26 的影响。图 7.10 强烈表明患者 5 和 26 的数据是有影响的。 图 7.9 图 7.10 在为所有 26 名患者拟合的模型中，拟合的风险函数的线性部分为 \\[0.144\\textit{ Age}_i-1.023\\textit{ Treat}_i\\] 而依次省略观测 1, 4, 5, 14 和 26 后成为： 省略患者 1： \\(\\text{ }0.142\\,Age_i-1.016\\,Treat_i\\) 省略患者 4： \\(\\text{ }0.175\\,Age_i-1.190\\,Treat_i\\) 省略患者 5： \\(\\text{ }0.177\\,Age_i-0.710\\,Treat_i\\) 省略患者 14：\\(0.149\\,Age_i-1.318\\,Treat_i\\) 省略患者 26：\\(0.159\\,Age_i-0.697\\,Treat_i\\) 这些结果表明，省略患者 1 的数据对参数估计的影响很小。当省略患者 4 的数据时，Age 的系数估计受影响最大，而当省略患者 14 的数据时，Treat 的系数变化最大。如果省略患者 5 或 26 的数据，这两个估计都会受到相当大的影响。 当为所有 26 名患者拟合模型时，接受联合治疗 (Treat = 2) 的患者相对于接受单一治疗 (Treat = 1) 的患者的风险比估计为 \\(e^{-1.023}=0.36\\)。当依次省略患者 1, 4, 5, 14 和 26 的观测时，经年龄调整的风险比估计分别为 0.36, 0.30, 0.49, 0.27 和 0.50。患者 5 和 26 的数据显然对风险比估计影响最大；在每种情况下，估计值都会增加，而治疗效应会减小。忽略患者 4 或 14 的数据会降低风险比估计，从而增加治疗效应估计。 7.5 检验 Weibull 模型的比例风险 Weibull 模型最常用作参数比例风险模型，因此检验比例风险假设是否成立非常重要。在第 4 章的 4.4.3 节展示了如何使用时依变量变量来检验 Cox 回归模型中风险的比例性。包含时依变量的参数模型更加复杂，并且由于用于拟合此类模型的软件尚未广泛使用，因此此处将不再给出有关此方法的进一步细节。 在 Weibull 模型中，多组（例如 \\(g\\) 组）之间比例风险的假设对应于每组基线风险函数的形状参数 \\(\\gamma\\) 相同的假设。检验这一假设的一种方法是对每组拟合一个单独的 Weibull 模型，其中模型的线性部分在每组中都是相同的。为每组数据拟合的模型将具有不同的形状参数以及不同的尺度参数。然后，将这 \\(g\\) 个单独模型的统计量 \\(-2\\operatorname{log}\\hat{L}\\) 的值相加，这对应于每组具有不同形状参数的模型的 \\(-2\\operatorname{log}\\hat{L}\\)，记作 \\(-2\\operatorname{log}\\hat{L}_1\\)。然后，我们将这 \\(g\\) 组数据合并并拟合一个 Weibull 比例风险模型，该模型包括与组别效应相关的因素，以及该因素与模型中其他项之间的交互作用。那么，该模型对应于每组具有共同的形状参数。在模型中考虑了组别效应，使得每组有不同的尺度参数。然后，将该模型的 \\(-2\\operatorname{log}\\hat{L}\\) 的值（记作 \\(-2\\operatorname{log}\\hat{L}_0\\)）与 \\(-2\\operatorname{log}\\hat{L}_1\\) 比较。这两个统计量之差是因将 Weibull 形状参数限制为相等而导致的 \\(-2\\operatorname{log}\\hat{L}\\) 的变化，并可与自由度为 \\(g−1\\) 的卡方分布的分位点相比较。如果差值不大，则比例风险假设是合理的。 示例 7.4 (卵巢癌患者的化疗) 第 5 章示例 5.11 中给了卵巢癌治疗后生存研究的数据，现用该数据说明检验两个治疗组中每个患者的 Weibull 形状参数相同这一假设的程序。第一步是为每个治疗组的数据拟合仅包含 Age 的 Weibull 比例风险模型。当为单一化疗组数据拟合该模型时，统计量 \\(-2\\operatorname{log}\\hat{L}\\) 的值为 22.851，而接受联合治疗组的模型统计量为 16.757. 两 \\(-2\\operatorname{log}\\hat{L}\\) 值之和为 39.608，这是两个治疗组具有不同形状参数且每组具有不同 Age 系数的 Weibull 模型的统计量。对于每个治疗组具有不同年龄效应、治疗效应和共同形状参数的模型，\\(-2\\operatorname{log}\\hat{L}\\) 的值为 39.708。因此，将形状参数限制为相等时，\\(-2\\operatorname{log}\\hat{L}\\) 的变化为 0.10，与一个自由度的卡方分布相比，该变化并不显著。因此可以认为两个形状参数是相等的。 第 6 章描述了比例风险模型的一些替代模型，第 ?? 章进一步探讨了如何处理风险不成比例的情况。 7.6 延伸阅读 与 Cox 回归模型的模型检查文献相比，关于参数生存模型中模型检查的文献相对较少。Hall, Rogers and Pregibon (1982) 描述了 Weibull 比例风险模型的残差和影响的度量。Hollander and Proschan (1979) 展示了如何评估一组未删失的观测样本是否来自特定的概率分布。Weissfeld and Schneider (1994) 描述并展示了一些可用于生存数据参数模型的残差。Cohen and Barnett (1995) 描述了如何使用模拟包络线 (simulated envelopes) 来帮助解释残差的累积危险图。Weissfeld and Schneider (1990) 以及 Escobar and Meeker (1992) 给出了用于参数生存建模的影响诊断方法。这些论文涉及基于局部影响 (local influence) 的观点，Cook (1986) 对此进行了一般性的探讨，Rancel and Sierra (2001) 给出了综述。Ciampi and Etezadi-Amoli (1985) 提出了一种根据风险函数的一般模型检验比例风险和加速失效时间假设的方法。Copas and Heydari (1997) 给出了参数模型的一个有趣的应用，该模型基于假释囚犯再次犯罪的时间的数据，其中包括模型的检验。 "],["chap8.html", "第 8 章 时依变量 8.1 时依变量的类型 8.2 时变变量的建模", " 第 8 章 时依变量 当解释变量纳入生存数据模型时，这些变量所取的值是在研究开始时记录的那些值。例如，考虑一项研究，以比较第 1 章示例 1.4 中首次描述的两种前列腺癌治疗方法。在这里，患者的年龄、血清血红蛋白水平、肿瘤大小、Gleason 指数的值还有治疗组，都是在患者进入研究时记录的。然后评估这些变量对死亡风险的影响。 在许多产生生存数据的研究中，个体在研究期间被监测。在此期间，可以定期记录某些解释变量的值。因此，在前列腺癌的例子中，可以以频繁的区间记录肿瘤的大小和其他变量。如果能够考虑到这些解释变量随时间推移而变化的情况，则可以得到更令人满意的死亡风险模型。比如，在与前列腺癌的研究中，比起研究起始时肿瘤大小的值，最近的大小可能更能准确地预测未来的预期寿命。 值随时间变化的变量称为时依变量 (time-dependent variables)，在本章，我们将看到如何将这些变量纳入生存数据分析所使用的模型。 8.1 时依变量的类型 考虑两种类型的时依变量，它们称为内部变量 (internal variables) 和外部变量 (external variables). 内部变量与研究中的特定个体相关，并且只能在患者存活时进行测量。当随着时间的推移对患者的某些特征进行重复测量时，就会产生此类数据，例子包括肺功能的测量，例如肺活量和峰值流速、白细胞计数、收缩压和血清胆固醇水平；描述患者状态变化的变量也属于此类。例如，在骨髓移植后，患者可能容易发生移植物抗宿主病 (graft versus host disease). 表示患者在任何给定时间是否遭受这种危及生命的副作用的二元解释变量是内部变量的另一个例子。在每种情况下，这些变量都反映了患者的状况，它们的值很可能与患者的生存时间有关。 外部变量也是时依变量，其存在不一定要求患者存活。其中一种特定类型的外部变量是其值会按预设方式随时间变化，因此在未来任何时间点其值都可以提前得知。例如，在研究过程中以预定方式调整的药物剂量，或者在器官移植后计划更改使用的免疫抑制剂类型等。 另一种类型的外部变量是完全独立于任何特定个体存在的变量，例如大气中二氧化硫的水平或空气温度。例如在有关某些类型呼吸系统疾病患者管理的研究中，这些数值的变化很可能对个人的寿命产生影响。 8.1.1 时依系数 在时固 (time-constant) 解释变量的系数是时间的函数的情况下，也会出现时依变量。在第 3 章 3.9 节解释了 Cox 比例风险模型中解释变量的系数是对数风险比，在该模型下，风险比是恒定的。如果这种风险比实际上是时间的函数，那么时依解释变量的系数就称为时变 (time-varying) 系数。在这种情况下，在这种情况下，对数风险比不是恒定的，因此我们不再有比例风险模型。 更正式地说，假设解释变量 \\(X\\) 的系数是时间 \\(t\\) 的线性函数，因此我们可以将该项写为 \\(\\beta tX\\)。这意味着 \\(X\\) 值的单位增加对应的对数风险比是 \\(\\beta t\\)，它是时间的线性函数。在模型中引入了这种形式的项，以检验第 4 章 4.4.3 节的比例风险假设。该项也可以写为 \\(\\beta X(t)\\)，其中 \\(X(t) = Xt\\) 是时依变量。一般来说，假设模型包含解释变量 \\(X\\)，其时变系数的形式为 \\(\\beta(t)\\)。模型中对应的项是 \\(\\beta (t)X\\)，可以表示为 \\(\\beta X(t)\\)。换句话说，涉及时变系数的项可以表示为具有恒定系数的时依变量。然而，如果 \\(\\beta(t)\\) 是一个或多个未知参数的非线性函数，例如 \\(\\beta_0 \\exp(\\beta_1t)\\)，则该项不太容易在模型中拟合。 这样的变量不能直接纳入通过最大化偏似然函数进行拟合的 Cox 回归模型。要了解原因，请考虑一个包含变量 \\(X_1=X_0t\\) 的模型，其中 \\(X_0\\) 是数据集中的一个变量，\\(X_1\\) 是该变量与生存时间的乘积。如果将 \\(X_1\\) 像任何时固解释变量一样包含在模型中，\\(X_1\\) 的系数可能显著小于零。这可能被解释为：对于 \\(X_1\\) 值较高的个体，在任何时间的死亡风险较低，或者等价地说，\\(X_1\\) 值较大的个体生存时间更长。但当然，生存时间较长的个体具有更大的生存时间值，因此 \\(X_1\\) 的值也更大。因此，\\(X_1\\) 是生存的重要预测因子就不足为奇了。相反，\\(X_1\\) 应作为时依变量包含在模型中。 所有这些不同类型的时依变量都可以按照下节描述的方式引入 Cox 回归模型。 8.2 时变变量的建模 根据第 3 章描述的 Cox 比例风险模型，研究中第 \\(i\\) 个人在 \\(t\\) 时刻的死亡风险可以写成以下形式 \\[h_i(t)=\\exp\\left\\{\\sum_{j=1}^p\\beta_jx_{ji}\\right\\}h_0(t)\\] 其中 \\(x_{ji}\\) 为第 \\(i\\) 个个体第 \\(j\\) 个解释变量 \\(X_j\\) 的基线值，\\(j=1,2,\\ldots,p\\)，\\(\\beta_j\\) 为 \\(x_{ji}\\) 的系数，\\(h_0(t)\\) 为基线风险函数。将此模型推广到部分或全部解释变量为时依变量的情况，我们将第 \\(i\\) 个个体中第 \\(j\\) 个解释变量在时间 \\(t\\) 的值写为 \\(x_{ji}(t)\\)。Cox 回归模型则变为 \\[\\begin{align} h_i(t)=\\exp\\left\\{\\sum_{j=1}^p\\beta_jx_{ji}(t)\\right\\}h_0(t). \\tag{8.1} \\end{align}\\] 在此模型中，基线风险函数 \\(h_0(t)\\) 解释为在起点处所有变量都为零且随时间保持此值的个体的风险函数。 由于式 (8.1) 给出的模型中变量 \\(x_{ji}(t)\\) 的值取决于时间 \\(t\\)，因此相对风险 \\(h_i(t)/h_0(t)\\) 也是时依的。这意味着时间 \\(t\\) 的死亡风险不再与基线风险成比例，并且该模型不再是比例风险模型。 为了解释该模型中的 \\(\\beta\\) 参数，请考虑两个个体，例如第 \\(r\\) 个和第 \\(s\\) 个，在时间 \\(t\\) 的风险函数之比 \\[\\begin{aligned}\\frac{h_{r}(t)}{h_{s}(t)}&amp;=\\exp\\left[\\beta_{1}\\{x_{1r}(t)-x_{1s}(t)\\}+\\cdots+\\beta_{p}\\{x_{pr}(t)-x_{ps}(t)\\}\\right]\\end{aligned}\\] 因此，系数 \\(\\beta_j, j = 1, 2,...,p\\) 可以解释为两个个体的对数风险比，这两个个体在给定时间 \\(t\\) 的第 \\(j\\) 个解释变量的值相差一个单位，同时这两个个体所有其他 \\(p−1\\) 变量具有相同的值。 8.2.1 拟合含时依变量的模型 "],["A.html", "A 最大似然估计 A.1 关于单个未知参数的推断 A.2 关于未知参数向量的推断", " A 最大似然估计 本附录总结了与生存分析相关的最大似然估计结果。给出的结果同样适用于基于偏似然函数的推断，因此可以与第 3 章中介绍的 Cox 回归模型以及第 5 章和第 6 章中描述的全参数模型结合使用。Cox and Hinkley (1974) 给出了最大似然估计和似然比检验。 A.1 关于单个未知参数的推断 假设 \\(n\\) 个观察到的生存时间 \\(t_1,t_2,\\ldots,t_n\\) 的似然是单个未知参数 \\(\\beta\\) 的函数，记作 \\(L(\\beta)\\)。\\(\\beta\\) 的最大似然估计 (maximum likelihood estimate) 就是使该函数达到最大值的值 \\(\\hat\\beta\\)。在几乎所有应用中，使用似然函数的自然对数 \\(\\log L(\\beta)\\) 更为方便。使对数似然最大化的值 \\(\\hat\\beta\\) 与使似然函数本身最大化的值相同，通常使用微分来求出。 具体来说，\\(\\hat\\beta\\) 是 \\(\\log L(\\beta)\\) 关于 \\(\\beta\\) 的导数等于 0 时 \\(\\beta\\) 的值。换句话说，\\(\\hat\\beta\\) 满足 \\[\\frac{\\mathrm{d}\\log L(\\beta)}{\\mathrm{d}\\beta}\\Bigg|_{\\hat{\\beta}}=0\\] \\(\\log L(\\beta)\\) 关于 \\(\\beta\\) 的一阶导数称为 \\(\\beta\\) 的有效得分 (efficient score)，记作 \\(u(\\beta)\\)。因此 \\[\\begin{aligned}u(\\beta)&amp;=\\frac{\\mathrm{d}\\log L(\\beta)}{\\mathrm{d}\\beta}\\end{aligned}\\] 因此 \\(\\beta\\) 的最大似然估计 \\(\\hat\\beta\\) 满足 \\[\\begin{aligned}u(\\hat{\\beta})=0\\end{aligned}\\] \\(\\beta\\) 最大似然估计的渐近方差根据下式得出 \\[\\begin{equation} \\left(-\\operatorname{E}\\left\\{\\frac{\\operatorname{d}^2\\log L(\\beta)}{\\operatorname{d}\\beta^2}\\right\\}\\right)^{-1} \\tag{A.1} \\end{equation}\\] 或等价地根据下式得出 \\[\\left(\\text{ E }\\left\\{\\frac{\\mathrm{d}\\log L(\\beta)}{\\mathrm{d}\\beta}\\right\\}^2\\right)^{-1}\\] 从这两个式子中得出的方差都可视为 \\(\\hat\\beta\\) 的近似方差，但是使用式 (A.1) 通常更直接。当式 (A.1) 中导数的期望值难以获得时，通过计算在 \\(\\hat\\beta\\) 处的导数来找到 \\(\\hat\\beta\\) 的方差的进一步近似。这由下式给出 \\[\\begin{equation} \\text{var }(\\hat{\\beta})\\approx\\left.-\\left(\\frac{\\mathrm{d}^2\\log L(\\beta)}{\\mathrm{d}\\beta^2}\\right)^{-1}\\right|_{\\hat{\\beta}} \\tag{A.2} \\end{equation}\\] 对数似然函数的二阶导数有时称为 Hessian，量 \\[-\\text{ E }\\left\\{\\frac{\\text{d}^2\\log L(\\beta)}{\\text{d}\\beta^2}\\right\\}\\] 称为信息函数。由于信息函数是由 \\(\\log L(\\beta)\\) 二阶导数的期望值形成的，因此有时称为期望信息函数 (expected information function). 相反，对数似然函数本身的负二阶导数称为观测信息函数 (observed information function). 将后者记作 \\(i(\\beta)\\)，因此 \\[i(\\beta)=-\\left\\{\\frac{\\mathrm{d}^2\\log L(\\beta)}{\\mathrm{d}\\beta^2}\\right\\}\\] 该函数的倒数在 \\(\\hat\\beta\\) 处的值就是式 (A.2) 中给出的 \\(\\hat\\beta\\) 的近似方差，即 \\[\\mathrm{var~}(\\hat{\\beta})\\approx\\frac1{i(\\hat{\\beta})}\\] \\(\\hat\\beta\\) 的标准误，即 \\(\\hat\\beta\\) 方差估计的平方根，为 \\[\\begin{aligned}\\operatorname{se}\\left(\\hat{\\beta}\\right)&amp;=\\frac1{\\sqrt{\\{i(\\hat{\\beta})\\}}}\\end{aligned}\\] 该标准误可用于构造 \\(\\beta\\) 的置信区间。 为检验 \\(\\beta=0\\) 的原假设，可以使用三种检验统计量。似然比检验统计量 (likelihood ratio test statistic) 为 \\(-2\\log L(\\hat{\\beta})\\) 和 \\(-2\\log L(0)\\) 之差。Wald 检验 (Wald test) 基于统计量 \\[\\hat{\\beta}^2i(\\hat{\\beta})\\] 以及得分检验统计量 (score test statistic) 为 \\[\\begin{aligned}\\frac{\\{u(0)\\}^2}{i(0)}\\end{aligned}\\] 在 \\(\\beta=0\\) 的原假设下，这些统计量都渐近服从自由度为一的卡方分布。请注意，Wald 统计量等价于统计量 \\[\\begin{aligned}\\frac{\\hat{\\beta}}{\\text{se }(\\hat{\\beta})}\\end{aligned}\\] 其渐近分布于标准正态分布。 A.2 关于未知参数向量的推断 A.1 节中的结果可以扩展到使用 \\(n\\) 个观测值来估计 \\(p\\) 个未知参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p\\) 的值的情况。这些参数可以组装成一个 \\(p×1\\) 的向量 \\(\\beta\\)，相应的似然函数为 \\(L(\\boldsymbol{\\beta})\\)。使 \\(L(\\boldsymbol{\\beta})\\) 最大化的 \\(p\\) 个未知参数的最大似然估计为 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\)。它们是通过同时求解 \\(p\\) 个方程得到的 \\[\\left.\\frac{\\mathrm{d}\\log L(\\boldsymbol{\\beta})}{\\mathrm{d}\\beta_j}\\right|_{\\boldsymbol{\\hat{\\beta}}}=0\\] 其中 \\(j=1,2,\\ldots,p\\)。 由 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\) 组成的向量记为 \\({\\boldsymbol{\\hat{\\beta}}}\\)，因此最大似然为 \\(L(\\hat{\\boldsymbol{\\beta}})\\)。\\(\\beta_j(j=1,2,\\ldots,p)\\) 的有效得分为 \\[u(\\beta_j)=\\frac{\\mathrm{d}\\log L(\\boldsymbol{\\beta})}{\\mathrm{d}\\beta_j}\\] 这些量可以组合起来得到有效得分的 \\(p×1\\) 向量，记作 \\(\\boldsymbol{u}(\\boldsymbol{\\beta})\\)。因此，最大似然估计向量满足 \\[\\boldsymbol{u}(\\hat{\\boldsymbol{\\beta}})=\\boldsymbol{0}\\] 其中 \\(\\boldsymbol 0\\) 为\\(p×1\\) 零向量。 现在令矩阵 \\(\\boldsymbol H(\\boldsymbol \\beta)\\) 为对数似然函数 \\(\\log L(\\hat{\\boldsymbol{\\beta}})\\) 的二阶偏导数的 \\(p × p\\) 矩阵。\\(\\boldsymbol H(\\boldsymbol \\beta)\\) 的第 \\((j, k)\\) 个元素为 \\[\\begin{aligned}\\frac{\\partial^2\\log L(\\hat{\\boldsymbol{\\beta}})}{\\partial\\beta_j\\partial\\beta_k}\\end{aligned}\\] 其中 \\(j=1,2,\\ldots,p,k=1,2,\\ldots,p\\)。\\(\\boldsymbol H(\\boldsymbol \\beta)\\) 称为 Hessian 矩阵。矩阵 \\[\\boldsymbol{I}(\\boldsymbol{\\beta})=-\\boldsymbol{H}(\\boldsymbol{\\beta})\\] 称为观测信息矩阵 (observed information matrix)。相应期望信息矩阵 (expected information matrix) 的第 \\((j, k)\\) 个元素为 \\[\\begin{aligned}-\\operatorname{E}\\left(\\frac{\\partial^2\\log L(\\boldsymbol{\\beta})}{\\partial\\beta_j\\partial\\beta_k}\\right)\\end{aligned}\\] 最大似然估计的方差-协方差阵 \\(\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_p\\)，写作 \\(\\operatorname{var}(\\hat{\\boldsymbol{\\beta}})\\)，可以通过观测信息矩阵的逆在 \\(\\hat{\\boldsymbol\\beta}\\) 处的值来近似，即 \\[\\mathrm{var~}(\\hat{\\boldsymbol{\\beta}})\\approx\\boldsymbol{I}^{-1}(\\hat{\\boldsymbol{\\beta}})\\] 该矩阵第 \\((j, j)\\) 个元素的平方根可视为 \\(\\hat{\\beta}_{j}\\) 的标准误，其中 \\(j=1,2,\\ldots,p\\)。 A.1 节中给出的检验统计量可以推广到多参数的情况。考虑关于原假设的检验，即拟合模型中的所有 \\(\\beta\\) 参数都等于 0. 似然比检验统计量的值为 \\[2\\left\\{\\log L(\\hat{\\boldsymbol{\\beta}})-\\log L(\\mathbf{0})\\right\\}\\] Wald 检验基于 \\[\\hat{\\boldsymbol{\\beta}}^{\\prime}\\boldsymbol{I}(\\hat{\\boldsymbol{\\beta}})\\hat{\\boldsymbol{\\beta}}\\] 得分检验统计量为 \\[\\boldsymbol{u}&#39;(\\boldsymbol{0})\\boldsymbol{I}^{-1}(\\boldsymbol{0})\\boldsymbol{u}(\\boldsymbol{0})\\] 在原假设 \\(\\boldsymbol\\beta = \\boldsymbol0\\) 下，这些统计量中都服从自由度为一的卡方分布。 在比较替代模型时，人们的兴趣集中于这样的假设：模型中的某些 \\(\\beta\\) 参数为零。为检验该假设，似然比检验是最合适的，所以我们在这里只考虑这个程序。假设将包含 \\(p + q\\) 个参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p,\\beta_{p+1},\\ldots,\\beta_{p+q}\\) 的模型与仅包含 \\(p\\) 个参数 \\(\\beta_1,\\beta_2,\\ldots,\\beta_p\\) 的模型进行比较。这相当于检验原假设：具有 \\(p + q\\) 个未知参数的模型中 \\(q\\) 个参数 \\(\\beta_{p+1},\\beta_{p+2},\\ldots,\\beta_{p+q}\\) 均等于 0. 令 \\(\\hat{\\boldsymbol\\beta}_1\\) 表示具有 \\(p + q\\) 个参数的模型的向量估计，\\(\\hat{\\boldsymbol\\beta}_2\\) 表示仅具有 \\(p\\) 参数的模型的向量估计。那么，在具有 \\(p + q\\) 参数的模型中，有关原假设 \\(\\beta_{p+1},\\beta_{p+2},\\ldots,\\beta_{p+q}=0\\) 的似然比检验基于统计量 \\[2\\left\\{\\log L(\\hat{\\boldsymbol{\\beta}}_1)-\\log L(\\hat{\\boldsymbol{\\beta}}_2)\\right\\}\\] 在原假设下，它在服从自由度为 \\(q\\) 的卡方分布。该检验构成了比较替代模型的基础，并在第 3 章 3.5 节中进行了更详细的描述。 "]]
